import{a as Je}from"./chunk-B6XUQAAW.js";import{a as X}from"./chunk-EFHJHWTA.js";import{a as C,b as me,d as j,e as fe,f as Me,h as Z,j as q,k as ze,m as Q,n as b,o as J,p as He,r as Y,t as Ge,w as Ze,x as qe,y as Qe}from"./chunk-MMPXYFCE.js";import{A as s,Aa as ve,B as u,Bb as Ne,C as re,D as se,Db as je,E as L,Ea as R,Eb as G,F as m,Fa as D,Fb as Ue,G as O,H as le,I as pe,J as ge,M as g,Ma as W,N as E,O as ce,Qa as be,S as f,Sa as V,T as M,Ta as F,U as S,Ua as Oe,Va as Te,Wa as Le,X as y,Xa as Ee,Y as v,Z as K,_a as Re,aa as he,ba as N,bb as De,ea as de,f as te,fb as We,g as ie,i as ne,ib as Ve,jb as Fe,kb as xe,l as P,la as ue,m as I,ma as U,na as z,oa as Se,ob as H,pb as Be,q as l,qb as x,r as c,s as T,sa as _e,t as ae,ta as we,ua as ye,ub as Ae,v as w,vb as ke,wb as Ke,x as oe,xa as Pe,y as p,ya as Ie,z as r,za as Ce,zb as B}from"./chunk-EBSCITWR.js";import{g as h}from"./chunk-2R6CW7ES.js";function mt(a,d){if(a&1){let e=L();r(0,"p",21),u(1,"ion-icon",22),g(2," One or more filters are currently being applied. "),r(3,"ion-button",23),m("click",function(){P(e);let t=O();return I(t.clearFilters())}),u(4,"ion-icon",24),r(5,"ion-label"),g(6,"Clear"),s()()()}}function ft(a,d){if(a&1&&(r(0,"ion-select-option",27),g(1),s()),a&2){let e=d.$implicit;p("value",e.ID),l(),E(e.Title)}}function Mt(a,d){if(a&1){let e=L();r(0,"ion-item")(1,"ion-select",25),y(2,"translate"),S("ngModelChange",function(t){P(e);let o=O();return M(o.searchSettings.FilterOptionsByCountryId,t)||(o.searchSettings.FilterOptionsByCountryId=t),I(t)}),m("ionChange",function(){P(e);let t=O();return I(t.onCountryChange())}),r(3,"ion-select",26),g(4,"(All Countries)"),s(),w(5,ft,2,2,"ion-select-option",5),s()()}if(a&2){let e=O();l(),p("label",v(2,3,"ocm.search.countries")),f("ngModel",e.searchSettings.FilterOptionsByCountryId),l(4),p("ngForOf",e.countries)}}function St(a,d){if(a&1&&(r(0,"ion-select-option",27),g(1),y(2,"nullableTranslate"),s()),a&2){let e=d.$implicit;p("value",e.ID),l(),E(K(2,2,"ocm.reference.usageType.value_"+e.ID,e))}}function _t(a,d){if(a&1&&(r(0,"ion-select-option",27),g(1),y(2,"nullableTranslate"),s()),a&2){let e=d.$implicit;p("value",e.ID),l(),E(K(2,2,"ocm.reference.statusType.value_"+e.ID,e))}}function wt(a,d){if(a&1&&(r(0,"ion-select-option",27),g(1),y(2,"nullableTranslate"),s()),a&2){let e=d.$implicit;p("value",e.ID),l(),E(K(2,2,"ocm.reference.connectionType.value_"+e.ID,e))}}function yt(a,d){if(a&1&&(r(0,"ion-select-option",27),g(1),s()),a&2){let e=d.$implicit;p("value",e.code),l(),E(e.title)}}var Xe=(()=>{class a{appManager;poiManager;mapping;modalController;events;searchSettings;maxPower=1e3;powerRange={lower:0,upper:this.maxPower};constructor(e,n,t,o,i){this.appManager=e,this.poiManager=n,this.mapping=t,this.modalController=o,this.events=i,this.searchSettings=e.searchSettings}ngOnInit(){return h(this,null,function*(){this.searchSettings.MinPowerKW!=null&&(this.powerRange.lower=this.searchSettings.MinPowerKW),this.searchSettings.MaxPowerKW!=null&&(this.powerRange.upper=this.searchSettings.MaxPowerKW),this.powerRange.upper==0&&(this.powerRange.upper=this.maxPower),this.appManager.analytics.viewEvent("Settings"),this.useFilteredOptions&&(yield this.onCountryChange())})}get useFilteredOptions(){return this.searchSettings.FilterOptionsByCountryId>0}clearFilters(){this.searchSettings.ClearActiveFilters(),this.powerRange={lower:0,upper:this.maxPower},this.searchSettings.CheckForActiveFilters()}get operators(){return this.appManager.referenceDataManager.getNetworkOperators(this.useFilteredOptions)}get connectionTypes(){return this.appManager.referenceDataManager.getConnectionTypes(this.useFilteredOptions)}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes(this.useFilteredOptions)}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes(this.useFilteredOptions)}get countries(){return this.appManager.referenceDataManager.getCountries(this.useFilteredOptions)}get isCountryFilterFeatureEnabled(){return b.isFeatureEnabled("FILTER_OPTIONS_BY_COUNTRY")}_languages=[];get languages(){return this._languages.length>0?this._languages:(this._languages=this.appManager.getLanguages(),this._languages)}ionViewWillLeave(){this.searchSettings.Language!=null&&this.appManager.setLanguage(this.searchSettings.Language),this.searchSettings.MinPowerKW=this.powerRange.lower,this.searchSettings.MaxPowerKW=this.powerRange.upper,this.searchSettings.MinPowerKW==1&&(this.searchSettings.MinPowerKW=null),this.searchSettings.MaxPowerKW==this.maxPower&&(this.searchSettings.MaxPowerKW=null),this.appManager.searchSettings=this.searchSettings,this.appManager.saveSearchSettings(),this.events.publish("ocm:poiList:cleared")}onLanguageChange(){this.searchSettings.Language!=null&&this.searchSettings.Language!=""&&this.appManager.setLanguage(this.searchSettings.Language)}onCountryChange(){return h(this,null,function*(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.searchSettings.FilterOptionsByCountryId]})})}onMapTypeChange(){return h(this,null,function*(){this.mapping.setMapType(this.searchSettings.MapType)})}onOperatorSelected(e=null){return h(this,null,function*(){e!=null&&(this.searchSettings.OperatorList.find(n=>n==e.ID)||this.searchSettings.OperatorList.push(e.ID))})}onOperatorRemoved(e){return h(this,null,function*(){this.searchSettings.OperatorList=this.searchSettings.OperatorList.filter(n=>n!=e)})}close(){this.modalController.dismiss()}static \u0275fac=function(n){return new(n||a)(c(Q),c(q),c(Y),c(B),c(Z))};static \u0275cmp=T({type:a,selectors:[["ng-component"]],standalone:!1,decls:60,vars:41,consts:[[1,"settings-page","ion-padding"],["danger","",4,"ngIf"],[4,"ngIf"],["mode","multi",3,"operatorRemoved","operatorChanged","operatorList","useFilteredOperators"],["multiple","true","cancelText","Cancel","okText","OK","placeholder","All",3,"ngModelChange","label","ngModel"],[3,"value",4,"ngFor","ngForOf"],["labelPlacement","start","label","Power (kW)","dualKnobs","true","pin","true",3,"ngModelChange","ngModel","ticks","snaps","min","max"],["slot","start","size","small","name","flash"],["slot","end","name","flash"],["lines","none"],["slot","start","type","number","labelPlacement","stacked","label","Min. kW","min","0",3,"ngModelChange","ngModel","max"],["slot","end","type","number","labelPlacement","stacked","label","Max. kW",3,"ngModelChange","ngModel","min","max"],["label","Language","multiple","false","placeholder","Select",3,"ngModelChange","ionChange","ngModel"],["multiple","false","cancelText","Cancel","okText","OK","placeholder","Select",3,"ngModelChange","ionChange","label","ngModel"],["value","ROADMAP"],["value","SATELLITE"],[3,"ngModelChange","ngModel"],["label","Max Results","type","number","placeholder","500","min","100","max","10000",3,"ngModelChange","ngModel"],["slot","end"],[3,"click"],["name","close","slot","start"],["danger",""],["name","alert"],["size","small","color","light",3,"click"],["slot","start","name","close"],["multiple","false","cancelText","Cancel","okText","OK","placeholder","All",3,"ngModelChange","ionChange","label","ngModel"],["value",""],[3,"value"]],template:function(n,t){n&1&&(r(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),g(3),y(4,"translate"),s()()(),r(5,"ion-content",0)(6,"h2"),g(7,"Search Filters"),s(),r(8,"p"),g(9,"Note: Filters will remove usable charging locations from your search results if we do not have complete data (i.e Operator or Power Levels)."),s(),w(10,mt,7,0,"p",1),r(11,"ion-list"),w(12,Mt,6,5,"ion-item",2),r(13,"app-operator-lookup",3),m("operatorRemoved",function(i){return t.onOperatorRemoved(i)})("operatorChanged",function(i){return t.onOperatorSelected(i)}),s(),r(14,"ion-item")(15,"ion-select",4),y(16,"translate"),S("ngModelChange",function(i){return M(t.searchSettings.UsageTypeList,i)||(t.searchSettings.UsageTypeList=i),i}),w(17,St,3,5,"ion-select-option",5),s()(),r(18,"ion-item")(19,"ion-select",4),y(20,"translate"),S("ngModelChange",function(i){return M(t.searchSettings.StatusTypeList,i)||(t.searchSettings.StatusTypeList=i),i}),w(21,_t,3,5,"ion-select-option",5),s()(),r(22,"ion-item")(23,"ion-select",4),y(24,"translate"),S("ngModelChange",function(i){return M(t.searchSettings.ConnectionTypeList,i)||(t.searchSettings.ConnectionTypeList=i),i}),w(25,wt,3,5,"ion-select-option",5),s()(),r(26,"ion-item")(27,"ion-range",6),S("ngModelChange",function(i){return M(t.powerRange,i)||(t.powerRange=i),i}),r(28,"ion-icon",7),g(29,"0"),s(),u(30,"ion-icon",8),s()(),r(31,"ion-item",9)(32,"ion-input",10),S("ngModelChange",function(i){return M(t.powerRange.lower,i)||(t.powerRange.lower=i),i}),s(),r(33,"ion-input",11),S("ngModelChange",function(i){return M(t.powerRange.upper,i)||(t.powerRange.upper=i),i}),s()()(),r(34,"h2"),g(35," General Settings "),s(),r(36,"ion-item")(37,"ion-select",12),S("ngModelChange",function(i){return M(t.searchSettings.Language,i)||(t.searchSettings.Language=i),i}),m("ionChange",function(){return t.onLanguageChange()}),w(38,yt,2,2,"ion-select-option",5),s()(),r(39,"ion-item")(40,"ion-select",13),y(41,"translate"),S("ngModelChange",function(i){return M(t.searchSettings.MapType,i)||(t.searchSettings.MapType=i),i}),m("ionChange",function(){return t.onMapTypeChange()}),r(42,"ion-select-option",14),g(43,"Road Map"),s(),r(44,"ion-select-option",15),g(45,"Satellite"),s()()(),r(46,"ion-item")(47,"ion-toggle",16),S("ngModelChange",function(i){return M(t.searchSettings.EnableAdvancedEditorFeatures,i)||(t.searchSettings.EnableAdvancedEditorFeatures=i),i}),g(48,"Enable Advanced Editor Options"),s()(),r(49,"ion-item")(50,"ion-toggle",16),S("ngModelChange",function(i){return M(t.searchSettings.EnablePOIPendingApproval,i)||(t.searchSettings.EnablePOIPendingApproval=i),i}),g(51,"Show POIs Pending Approval"),s()(),r(52,"ion-item")(53,"ion-input",17),S("ngModelChange",function(i){return M(t.searchSettings.MaxResults,i)||(t.searchSettings.MaxResults=i),i}),s()()(),r(54,"ion-footer")(55,"ion-toolbar")(56,"ion-buttons",18)(57,"ion-button",19),m("click",function(){return t.close()}),u(58,"ion-icon",20),g(59," Close "),s()()()()),n&2&&(l(3),ce(" ",v(4,31,"ocm.general.settings")," "),l(7),p("ngIf",t.searchSettings.HasActiveFilters==!0),l(2),p("ngIf",t.isCountryFilterFeatureEnabled),l(),p("operatorList",t.searchSettings.OperatorList)("useFilteredOperators",!1),l(2),p("label",v(16,33,"ocm.search.usageTypes")),f("ngModel",t.searchSettings.UsageTypeList),l(2),p("ngForOf",t.usageTypes),l(2),p("label",v(20,35,"ocm.search.operationalStatusTypes")),f("ngModel",t.searchSettings.StatusTypeList),l(2),p("ngForOf",t.statusTypes),l(2),p("label",v(24,37,"ocm.search.connectionTypes")),f("ngModel",t.searchSettings.ConnectionTypeList),l(2),p("ngForOf",t.connectionTypes),l(2),f("ngModel",t.powerRange),p("ticks",!1)("snaps",!1)("min",0)("max",t.maxPower),l(5),f("ngModel",t.powerRange.lower),p("max",t.powerRange.upper),l(),f("ngModel",t.powerRange.upper),p("min",t.powerRange.lower)("max",t.maxPower),l(4),f("ngModel",t.searchSettings.Language),l(),p("ngForOf",t.languages),l(2),p("label",v(41,39,"ocm.details.location.map")),f("ngModel",t.searchSettings.MapType),l(7),f("ngModel",t.searchSettings.EnableAdvancedEditorFeatures),l(3),f("ngModel",t.searchSettings.EnablePOIPendingApproval),l(3),f("ngModel",t.searchSettings.MaxResults))},dependencies:[he,N,U,z,R,D,W,be,V,F,Oe,Te,Le,Ee,De,Ve,Fe,H,Be,x,Pe,Ie,Ce,ke,Ae,Ge,G,qe],encapsulation:2})}return a})();var $e=(()=>{class a{modalController;hasNavbar=!1;constructor(e){this.modalController=e}close(){this.modalController.dismiss()}static \u0275fac=function(n){return new(n||a)(c(B))};static \u0275cmp=T({type:a,selectors:[["ng-component"]],standalone:!1,decls:10,vars:0,consts:[["slot","end"],[3,"click"],["name","close","slot","end"],[1,"route-planner","ion-padding"]],template:function(n,t){n&1&&(r(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),g(3," Route Planner "),s(),r(4,"ion-buttons",0)(5,"ion-button",1),m("click",function(){return t.close()}),u(6,"ion-icon",2),g(7," Close "),s()()()(),r(8,"ion-content",3),u(9,"route-planner"),s())},dependencies:[R,D,W,V,F,H,x,Ze],encapsulation:2})}return a})();function Pt(a){a.CapacitorUtils.Synapse=new Proxy({},{get(d,e){return new Proxy({},{get(n,t){return(o,i,_)=>{let A=a.Capacitor.Plugins[e];if(A===void 0){_(new Error(`Capacitor plugin ${e} not found`));return}if(typeof A[t]!="function"){_(new Error(`Method ${t} not found in Capacitor plugin ${e}`));return}h(null,null,function*(){try{let k=yield A[t](o);i(k)}catch(k){_(k)}})}}})}})}function It(a){a.CapacitorUtils.Synapse=new Proxy({},{get(d,e){return a.cordova.plugins[e]}})}function et(a=!1){window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!a?Pt(window):window.cordova!==void 0&&It(window)}var ee=Je("Geolocation",{web:()=>import("./chunk-IJYVLKS5.js").then(a=>new a.GeolocationWeb)});et();function Ct(a,d){a&1&&u(0,"ion-icon",13)}function vt(a,d){a&1&&u(0,"ion-spinner")}function bt(a,d){if(a&1){let e=L();r(0,"ion-button",4),m("click",function(){P(e);let t=O();return I(t.openSideView())}),u(1,"ion-icon",14),s()}}function Ot(a,d){a&1&&(re(0),r(1,"div",15)(2,"p"),g(3,"There was a problem communicating with Open Charge Map. Please check your data connection."),s()(),se())}var tt=(()=>{class a{appManager;nav;events;translate;platform;poiManager;mapping;journeyManager;zone;modalController;alertController;logging;mapDisplayed=!1;debouncedRefreshMapResults;mapCanvasID;initialResultsShown=!1;searchOnDemand=!1;poiViewMode="modal";sideViewAvailable=!1;searchPolyline;routePlanningMode=!0;searchKeyword="";selectedPOI;appConfig=new He;defaultMapZoom=15;defaultStartPos=new j(37.415328,-122.076575);placeSearchMapPOI;constructor(e,n,t,o,i,_,A,k,it,nt,at,ot){this.appManager=e,this.nav=n,this.events=t,this.translate=o,this.platform=i,this.poiManager=_,this.mapping=A,this.journeyManager=k,this.zone=it,this.modalController=nt,this.alertController=at,this.logging=ot,this.mapCanvasID="map-canvas",this.mapping.setMapType(e.searchSettings.MapType),this.mapping.setMapAPI(ue.defaultMapProvider),te(window,"resize").pipe(ie(500)).subscribe(Lt=>{let rt={width:b.getClientHeight(),height:b.getClientWidth()};this.events.publish("ocm:window:resized",[rt])})}ionViewDidEnter(){this.logging.log("Entered search page.",C.VERBOSE),this.mapping.focusMap(),this.mapping.updateMapSize()}ionViewWillLeave(){this.logging.log("Leaving search page.",C.VERBOSE),this.mapping.unfocusMap()}getPreferredMapHeight(e){return e==null&&(e=b.getClientHeight()),e-56}enforceMapHeight(e){this.logging.log("Would resize map:"+e.width+" "+e.height,C.VERBOSE);let n=this.getPreferredMapHeight(e[0]);document.getElementById(this.mapCanvasID).offsetHeight!==n&&(document.getElementById(this.mapCanvasID).style.height=n+"px"),this.mapping&&(this.logging.log("Map height:"+n,C.VERBOSE),this.mapping.updateMapSize())}initialiseMapping(){return h(this,null,function*(){yield this.platform.ready(),this.debouncedRefreshMapResults=b.debounce(this.refreshMapResults,1e3,!1),this.events.subscribe("ocm:mapping:ready",()=>h(this,null,function*(){if(this.logging.log("init map: mapping ready"),this.mapping&&this.mapping.updateMapSize(),!this.initialResultsShown)if(this.appManager.searchSettings.StartSearchPosition&&!this.appManager.searchSettings.StartViewPoiId)this.searchOnDemand=!0,this.mapping.updateMapCentrePos(this.appManager.searchSettings.StartSearchPosition.latitude,this.appManager.searchSettings.StartSearchPosition.longitude,!0,this.defaultMapZoom);else{let e=localStorage.getItem("_locationEnabled");this.appManager.isEmbeddedMode==!0&&e!="true"?yield(yield this.alertController.create({header:"Search using your location?",message:"Select OK to continue.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>h(this,null,function*(){yield this.useFallbackPosition()})},{text:"OK",handler:()=>h(this,null,function*(){yield this.locateUser()})}]})).present():(yield this.locateUser(),this.mapping&&this.mapping.updateMapSize())}})),this.events.subscribe("ocm:mapping:zoom",()=>{this.debouncedRefreshMapResults()}),this.events.subscribe("ocm:mapping:dragend",()=>{this.debouncedRefreshMapResults()}),this.events.subscribe("ocm:poiList:updated",e=>{this.showPOIListOnMap(e)}),this.events.subscribe("ocm:poiList:cleared",()=>{this.mapping.clearMarkers(),setTimeout(()=>{this.debouncedRefreshMapResults()},500)}),this.events.subscribe("ocm:window:resized",e=>{e!=null&&e.length>0&&this.enforceMapHeight(e[0])}),this.events.subscribe("ocm:poi:selected",e=>{e.poi?this.viewPOIDetails(e,e.poi):this.viewPOIDetails(e,null,!0)}),this.mapping.initMap(this.mapCanvasID)})}ngAfterViewInit(){return h(this,null,function*(){yield this.initialiseMapping()})}ngOnInit(){return h(this,null,function*(){this.logging.log("Refreshing reference data ..",C.VERBOSE),(yield this.appManager.referenceDataManager.refreshReferenceData(this.appManager.api))||(this.appManager.isOffline=!0)})}showPOIListOnMap(e){let n=this.getPreferredMapHeight(null);this.mapping.refreshMapView(n,this.poiManager.poiList,null),this.mapDisplayed||(this.mapDisplayed=!0)}getIconForPOI(e){return b.getIconForPOI(e)}getPOIByID(e){let n=this.poiManager.poiList;for(let t=0;t<n.length;t++)if(n[t].ID===e)return n[t];return null}refreshMapResults(){return h(this,null,function*(){if(this.searchOnDemand)this.logging.log("Refreshing Results..",C.VERBOSE);else{this.logging.log("Skipping refresh, search on demand disabled..",C.VERBOSE);return}let e=new Me,n=null;if(this.appManager.searchSettings.StartViewPoiId){let o=this.appManager.searchSettings.StartViewPoiId;this.appManager.searchSettings.StartViewPoiId=null;let i=yield this.poiManager.getPOIById(o,!0);i&&(this.events.publish("ocm:poi:selected",{poiId:i.ID,poi:i}),this.mapping.updateMapCentrePos(i.AddressInfo.Latitude,i.AddressInfo.Longitude,!0,this.defaultMapZoom))}if(this.appManager.searchSettings.StartSearchPosition&&(n=new fe(this.appManager.searchSettings.StartSearchPosition.latitude,this.appManager.searchSettings.StartSearchPosition.longitude),this.appManager.searchSettings.StartSearchPosition=null),n&&n.coords.latitude==0&&n.coords.longitude==0){this.logging.log("Map center is zero. No query will be performed",C.WARNING);return}if(n!=null)e.latitude=n.coords.latitude,e.longitude=n.coords.longitude,e.distance=25,e.boundingbox=null,this.appManager.searchSettings.LastSearchPosition=new j(n.coords.latitude,n.coords.longitude);else{e.latitude=null,e.longitude=null;let o=yield this.mapping.getMapBounds().toPromise();e.boundingbox="("+o[0].latitude+","+o[0].longitude+"),("+o[1].latitude+","+o[1].longitude+")",this.logging.log(JSON.stringify(o),C.VERBOSE)}e.includeComments=!0,e.enableCaching=!0,this.appManager.searchSettings!=null&&(this.appManager.searchSettings.ConnectionTypeList!=null&&(e.connectionTypeIdList=this.appManager.searchSettings.ConnectionTypeList),this.appManager.searchSettings.UsageTypeList!=null&&(e.usageTypeIdList=this.appManager.searchSettings.UsageTypeList),this.appManager.searchSettings.StatusTypeList!=null&&(e.statusTypeIdList=this.appManager.searchSettings.StatusTypeList),this.appManager.searchSettings.OperatorList!=null&&(e.operatorIdList=this.appManager.searchSettings.OperatorList),this.appManager.searchSettings.MinPowerKW!=null&&this.appManager.searchSettings.MinPowerKW>0&&(e.minPowerKW=this.appManager.searchSettings.MinPowerKW),this.appManager.searchSettings.MaxPowerKW!=null&&this.appManager.searchSettings.MaxPowerKW>0&&(e.maxPowerKW=this.appManager.searchSettings.MaxPowerKW),this.appManager.searchSettings.MaxResults!=null&&this.appManager.searchSettings.MaxResults>0&&this.appManager.searchSettings.MaxResults<=1e4&&(e.maxResults=this.appManager.searchSettings.MaxResults),this.journeyManager.getRoutePolyline()!=null&&(e.polyline=this.journeyManager.getRoutePolyline(),e.boundingbox=null,e.levelOfDetail=null,e.latitude=null,e.longitude=null)),this.appManager.searchSettings.EnablePOIPendingApproval&&(e.submissionStatusTypeIdList=[1,100,200]),this.appManager.isRequestInProgress=!0;let t=yield this.poiManager.refreshPOIList(e);this.appManager.isRequestInProgress=!1,this.initialResultsShown=!0,t>=e.maxResults&&this.appManager.showToastNotification("A maximum of "+t+" results are returned per search. Zoom in for details.")})}viewPOIDetails(e,n,t=!1){this.logging.log("Viewing/fetching ["+this.poiViewMode+"] POI Details "+e.poiId),n!=null?(this.mapping.unfocusMap(),this.modalController.create({component:X,componentProps:{item:n}}).then(o=>{o.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),o.present()}),t&&this.mapping.updateMapCentrePos(n.AddressInfo.Latitude,n.AddressInfo.Longitude,!0,this.defaultMapZoom)):this.poiManager.getPOIById(e.poiId,!0).then(o=>{this.logging.log("Got POI Details "+o.ID),this.poiViewMode==="modal"&&(this.searchOnDemand=!1,this.modalController.create({component:X,componentProps:{item:o}}).then(i=>{i.onDidDismiss().then(()=>{this.logging.log("Dismissing POI Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),i.present()}),this.mapping.unfocusMap(),t&&this.mapping.updateMapCentrePos(o.AddressInfo.Latitude,o.AddressInfo.Longitude,!0,this.defaultMapZoom)),this.poiViewMode==="side"&&(this.selectedPOI=o)},o=>{this.appManager.showToastNotification("POI Details not available")})}closePOIDetails(){this.selectedPOI=null}openRoutePlannerModal(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:$e}).then(e=>{e.onDidDismiss().then(n=>{this.logging.log("Dismissing Route Planner Details."),this.mapping.focusMap(),this.searchOnDemand=!0}),e.present()})}openSearchOptions(){this.searchOnDemand=!1,this.mapping.unfocusMap(),this.modalController.create({component:Xe}).then(e=>{e.onDidDismiss().then(n=>{this.mapping.focusMap(),this.searchOnDemand=!0}),e.present()})}openSideView(){this.poiViewMode="side",this.mapping.updateMapSize()}closeSideView(){this.poiViewMode="modal",this.mapping.updateMapSize()}planRoute(){this.routePlanningMode=!0}search(e){this.placeSearchMapPOI.getPlacesAutoComplete(e,"poiSearch")}useFallbackPosition(){let e=this.defaultStartPos;this.appManager.searchSettings.LastSearchPosition!=null&&(e=this.appManager.searchSettings.LastSearchPosition),this.appManager.searchSettings.StartSearchPosition=e,this.appManager.searchSettings.LastSearchPosition=null,this.searchOnDemand=!0,this.mapping.updateMapCentrePos(e.latitude,e.longitude,!0,this.defaultMapZoom)}_watchId=null;getPosition(){return h(this,arguments,function*(e={}){return new Promise((n,t)=>{this._watchId=ee.watchPosition(e,(o,i)=>{if(this._watchId&&ee.clearWatch({id:this._watchId}),i){t(i);return}n(o)})})})}locateUser(){return h(this,null,function*(){this.useFallbackPosition();try{this.logging.log("Attempting to locate user..");let e=yield this.getPosition({timeout:1e4});if(!e)throw"Failed to get user location.";return this.logging.log("Got user location."),this.appManager.searchSettings.StartSearchPosition=new j(e.coords.latitude,e.coords.longitude),this.searchOnDemand=!0,this.mapping.updateMapCentrePos(e.coords.latitude,e.coords.longitude,!0,this.defaultMapZoom),localStorage.setItem("_locationEnabled","true"),!0}catch(e){return this.logging.log("Failed to get user location. Searching using default or last position."+e),this.appManager.showToastNotification("Your location could not be determined."),this.useFallbackPosition(),!1}})}placeSelected(e){if(this.searchKeyword=e.Address,this.logging.log("Got place details:"+e.Address),this.mapping.focusMap(),e.Location!=null)this.mapping.updateMapCentrePos(e.Location.latitude,e.Location.longitude,!0);else if(e.ReferenceID!=null&&e.ReferenceID.startsWith("OCM-")){let n=e.ReferenceID.replace("OCM-","");this.events.publish("ocm:poi:selected",{poiId:n,poi:null})}this.debouncedRefreshMapResults()}static \u0275fac=function(n){return new(n||a)(c(Q),c(ye),c(Z),c(je),c(we),c(q),c(Y),c(ze),c(oe),c(B),c(Ke),c(me))};static \u0275cmp=T({type:a,selectors:[["ng-component"]],viewQuery:function(n,t){if(n&1&&le(J,7),n&2){let o;pe(o=ge())&&(t.placeSearchMapPOI=o.first)}},standalone:!1,decls:18,vars:10,consts:[["placeSearchMapPOI",""],["slot","start"],["autocapitalize","on","autocomplete","on",3,"ngModelChange","ionInput","ngModel","placeholder","debounce"],["slot","end"],[3,"click"],["name","locate","slot","start",4,"ngIf"],[4,"ngIf"],[3,"click","color"],["name","options","slot","end"],[3,"click",4,"ngIf"],[1,"search-page"],[3,"placeChanged"],["id","map-canvas",2,"height","100%","width","100%","min-height","300px"],["name","locate","slot","start"],["name","car","title","Route","slot","end"],[2,"position","absolute"]],template:function(n,t){if(n&1){let o=L();r(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),u(3,"ion-menu-button"),s(),r(4,"ion-searchbar",2),y(5,"translate"),S("ngModelChange",function(_){return P(o),M(t.searchKeyword,_)||(t.searchKeyword=_),I(_)}),m("ionInput",function(_){return P(o),I(t.search(_))}),s(),r(6,"ion-buttons",3)(7,"ion-button",4),m("click",function(){return P(o),I(t.locateUser())}),w(8,Ct,1,0,"ion-icon",5)(9,vt,1,0,"ion-spinner",6),s(),r(10,"ion-button",7),m("click",function(){return P(o),I(t.openSearchOptions())}),u(11,"ion-icon",8),s(),w(12,bt,2,0,"ion-button",9),s()()(),r(13,"ion-content",10)(14,"place-search",11,0),m("placeChanged",function(_){return P(o),I(t.placeSelected(_))}),s(),w(16,Ot,4,0,"ng-container",6),u(17,"div",12),s()}n&2&&(l(4),f("ngModel",t.searchKeyword),p("placeholder",v(5,8,"ocm.search.performSearch"))("debounce",500),l(4),p("ngIf",!t.appManager.isRequestInProgress),l(),p("ngIf",t.appManager.isRequestInProgress),l(),p("color",t.appManager.searchSettings.HasActiveFilters?"danger":"default"),l(2),p("ngIf",t.sideViewAvailable==!0&&t.poiViewMode=="modal"),l(4),p("ngIf",t.appManager.isOffline))},dependencies:[N,U,z,R,D,W,V,F,Re,We,xe,x,ve,J,G],styles:[".search-page[_ngcontent-%COMP%]   #map-canvas[_ngcontent-%COMP%]{width:100%;height:98%}.search-page[_ngcontent-%COMP%]   #place-search[_ngcontent-%COMP%]{min-height:300px;position:absolute;z-index:100;width:100%}.search-page[_ngcontent-%COMP%]   scroll-content[_ngcontent-%COMP%]{overflow-y:hidden}.search-page[_ngcontent-%COMP%]   .banner[_ngcontent-%COMP%]{padding-left:2em}.search-page[_ngcontent-%COMP%]   .sideview[_ngcontent-%COMP%]{background:#eee;background:linear-gradient(to bottom,#eee,#fff)}"]})}return a})();var Vi=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=ae({type:a});static \u0275inj=ne({imports:[de,Se,Ne,Ue,Qe,_e.forChild([{path:"",component:tt}])]})}return a})();export{Xe as a,$e as b,Vi as c};
