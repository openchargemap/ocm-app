import{$ as $v,A as K,Aa as pu,Ab as Bs,B as Ye,Ba as wr,Bb as Ir,C as ii,Ca as ir,Cb as l1,D as ni,Db as c1,E as Pt,Ea as Fs,F as rt,Fa as Jd,Fb as js,G as be,Ga as Fi,Gb as vu,H as Fv,Ha as nr,Hb as u1,I as Bv,Ia as Yd,J as jv,Ja as Qd,K as Ol,Ka as Kv,L as Kd,La as Xv,M as pe,Ma as Jv,N as yt,Na as du,O as mt,Oa as ho,P as Uv,Pa as Yv,Q as Nv,Qa as Qv,R as Vv,Ra as e1,S as vt,Sa as po,T as _t,Ta as mu,U as xt,Ua as mo,V as Fl,Va as Bi,Wa as Sr,X as Ai,Xa as Qi,Y as Sn,Ya as Rn,Z as Bl,Za as rr,_ as zs,_a as t1,a as Gd,aa as kn,b as qd,ba as Yi,c as kv,ca as Gv,cb as fu,d as Ng,da as jl,db as i1,e as Lv,ea as qv,eb as n1,fb as r1,gb as gu,h as gi,ha as Wv,hb as em,i as Wd,ia as tr,ib as _u,j as Dv,ja as Zv,jb as yu,k as Ct,kb as pa,l as Ue,la as Os,lb as da,m as Ne,ma as Xd,mb as tm,n as Rv,na as dr,o as Zd,oa as Ln,ob as o1,p as zl,pa as Dn,q as Y,qa as Hv,qb as fo,r as ot,s as Ti,sa as lu,sb as or,t as Hd,u as zv,v as it,va as cu,w as Gn,wa as uu,wb as a1,x as Ov,xa as hu,xb as im,y as Ce,yb as nm,z as q,zb as s1}from"./chunk-CH565GVL.js";import{a as Xt,b as ha,e as Ev,f as dS,g as Av,h as Be}from"./chunk-B4AJQJMI.js";var _1=Ev((Wg,Zg)=>{(function(l,s){typeof Wg=="object"&&typeof Zg<"u"?Zg.exports=s():typeof define=="function"&&define.amd?define(s):(l=typeof globalThis<"u"?globalThis:l||self,l.maplibregl=s())})(Wg,function(){"use strict";var l={},s={};function i(u,r,x){if(s[u]=x,u==="index"){var C="var sharedModule = {}; ("+s.shared+")(sharedModule); ("+s.worker+")(sharedModule);",A={};return s.shared(A),s.index(l,A),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([C],{type:"text/javascript"}))),l}}i("shared",["exports"],function(u){"use strict";function r(o,t,n,c){return new(n||(n=Promise))(function(d,_){function y(T){try{w(c.next(T))}catch(M){_(M)}}function b(T){try{w(c.throw(T))}catch(M){_(M)}}function w(T){var M;T.done?d(T.value):(M=T.value,M instanceof n?M:new n(function(k){k(M)})).then(y,b)}w((c=c.apply(o,t||[])).next())})}function x(o,t){this.x=o,this.y=t}function C(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var A,R;typeof SuppressedError=="function"&&SuppressedError,x.prototype={clone(){return new x(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,t){return this.clone()._rotateAround(o,t)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){let t=o.x-this.x,n=o.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,t){return Math.atan2(this.x*t-this.y*o,this.x*o+this.y*t)},_matMult(o){let t=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=t,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){let o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){let t=Math.cos(o),n=Math.sin(o),c=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=c,this},_rotateAround(o,t){let n=Math.cos(o),c=Math.sin(o),d=t.y+c*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-c*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:x},x.convert=function(o){if(o instanceof x)return o;if(Array.isArray(o))return new x(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new x(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};var U=(function(){if(R)return A;function o(t,n,c,d){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=c,this.p2y=d}return R=1,A=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,d=0;d<8;d++){var _=this.sampleCurveX(c)-t;if(Math.abs(_)<n)return c;var y=this.sampleCurveDerivativeX(c);if(Math.abs(y)<1e-6)break;c-=_/y}var b=0,w=1;for(c=t,d=0;d<20&&(_=this.sampleCurveX(c),!(Math.abs(_-t)<n));d++)t>_?b=c:w=c,c=.5*(w-b)+b;return c},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},A})(),F=C(U);let le,se;function fe(){return le==null&&(le=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),le}function xe(){if(se==null&&(se=!1,fe())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<25;c++){let d=4*c;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}let n=t.getImageData(0,0,5,5).data;for(let c=0;c<100;c++)if(c%4!=3&&n[c]!==c){se=!0;break}}}return se||!1}var Le=1e-6,Fe=typeof Float32Array<"u"?Float32Array:Array;function $e(){var o=new Fe(9);return Fe!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function nt(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function je(){var o=new Fe(3);return Fe!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function ht(o){return Math.hypot(o[0],o[1],o[2])}function Et(o,t,n){var c=new Fe(3);return c[0]=o,c[1]=t,c[2]=n,c}function Ui(o,t,n){return o[0]=t[0]+n[0],o[1]=t[1]+n[1],o[2]=t[2]+n[2],o}function mi(o,t,n){return o[0]=t[0]*n,o[1]=t[1]*n,o[2]=t[2]*n,o}function On(o,t,n){var c=t[0],d=t[1],_=t[2],y=n[0],b=n[1],w=n[2];return o[0]=d*w-_*b,o[1]=_*y-c*w,o[2]=c*b-d*y,o}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});var In,Hn=ht;function To(o,t,n){var c=t[0],d=t[1],_=t[2],y=t[3];return o[0]=n[0]*c+n[4]*d+n[8]*_+n[12]*y,o[1]=n[1]*c+n[5]*d+n[9]*_+n[13]*y,o[2]=n[2]*c+n[6]*d+n[10]*_+n[14]*y,o[3]=n[3]*c+n[7]*d+n[11]*_+n[15]*y,o}function Ar(){var o=new Fe(4);return Fe!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function kr(o,t,n,c){var d=.5*Math.PI/180;t*=d,n*=d,c*=d;var _=Math.sin(t),y=Math.cos(t),b=Math.sin(n),w=Math.cos(n),T=Math.sin(c),M=Math.cos(c);return o[0]=_*w*M-y*b*T,o[1]=y*b*M+_*w*T,o[2]=y*w*T-_*b*M,o[3]=y*w*M+_*b*T,o}function Lr(){var o=new Fe(2);return Fe!=Float32Array&&(o[0]=0,o[1]=0),o}function es(o,t){var n=new Fe(2);return n[0]=o,n[1]=t,n}je(),In=new Fe(4),Fe!=Float32Array&&(In[0]=0,In[1]=0,In[2]=0,In[3]=0),je(),Et(1,0,0),Et(0,1,0),Ar(),Ar(),$e(),Lr();let ri=8192;function Co(o,t,n){return t*(ri/(o.tileSize*Math.pow(2,n-o.tileID.overscaledZ)))}function Tn(o,t){return(o%t+t)%t}function va(o,t,n){return o*(1-n)+t*n}function to(o){if(o<=0)return 0;if(o>=1)return 1;let t=o*o,n=t*o;return 4*(o<.5?n:3*(o-t)+n-.75)}function $o(o,t,n,c){let d=new F(o,t,n,c);return _=>d.solve(_)}let xa=$o(.25,.1,.25,1);function Kn(o,t,n){return Math.min(n,Math.max(t,o))}function ts(o,t,n){let c=n-t,d=((o-t)%c+c)%c+t;return d===t?n:d}function _r(o,...t){for(let n of t)for(let c in n)o[c]=n[c];return o}let Dr=1;function is(o,t,n){let c={};for(let d in o)c[d]=t.call(this,o[d],d,o);return c}function ns(o,t,n){let c={};for(let d in o)t.call(this,o[d],d,o)&&(c[d]=o[d]);return c}function ar(o){return Array.isArray(o)?o.map(ar):typeof o=="object"&&o?is(o,ar):o}let Di={};function Ni(o){Di[o]||(typeof console<"u"&&console.warn(o),Di[o]=!0)}function Rr(o,t,n){return(n.y-o.y)*(t.x-o.x)>(t.y-o.y)*(n.x-o.x)}function io(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let ba=null;function no(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}let ro="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function rs(o,t,n,c,d){return r(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let _=new VideoFrame(o,{timestamp:0});try{let y=_?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);let b=y.startsWith("BGR"),w=new Uint8ClampedArray(c*d*4);if(yield _.copyTo(w,(function(T,M,k,z,B){let j=4*Math.max(-M,0),$=(Math.max(0,k)-k)*z*4+j,Z=4*z,Q=Math.max(0,M),de=Math.max(0,k);return{rect:{x:Q,y:de,width:Math.min(T.width,M+z)-Q,height:Math.min(T.height,k+B)-de},layout:[{offset:$,stride:Z}]}})(o,t,n,c,d)),b)for(let T=0;T<w.length;T+=4){let M=w[T];w[T]=w[T+2],w[T+2]=M}return w}finally{_.close()}})}let Go,qo;function Wo(o,t,n,c){return o.addEventListener(t,n,c),{unsubscribe:()=>{o.removeEventListener(t,n,c)}}}function wa(o){return o*Math.PI/180}function Zo(o){return o/Math.PI*180}let Ho={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ko={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},os="AbortError";function me(){return new Error(os)}let V={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function G(o){return V.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}let W="global-dispatcher";class ne extends Error{constructor(t,n,c,d){super(`AJAXError: ${n} (${t}): ${c}`),this.status=t,this.statusText=n,this.url=c,this.body=d}}let he=()=>io(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ge=function(o,t){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){let c=G(o.url);if(c)return c(o,t);if(io(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:W},t)}if(!(/^file:/.test(n=o.url)||/^file:/.test(he())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(c,d){return r(this,void 0,void 0,function*(){let _=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:he(),signal:d.signal}),y,b;c.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{y=yield fetch(_)}catch(T){throw new ne(0,T.message,c.url,new Blob)}if(!y.ok){let T=yield y.blob();throw new ne(y.status,y.statusText,c.url,T)}b=c.type==="arrayBuffer"||c.type==="image"?y.arrayBuffer():c.type==="json"?y.json():y.text();let w=yield b;if(d.signal.aborted)throw me();return{data:w,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})})(o,t);if(io(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:W},t)}var n;return(function(c,d){return new Promise((_,y)=>{var b;let w=new XMLHttpRequest;w.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(w.responseType="arraybuffer");for(let T in c.headers)w.setRequestHeader(T,c.headers[T]);c.type==="json"&&(w.responseType="text",!((b=c.headers)===null||b===void 0)&&b.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=c.credentials==="include",w.onerror=()=>{y(new Error(w.statusText))},w.onload=()=>{if(!d.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let T=w.response;if(c.type==="json")try{T=JSON.parse(w.response)}catch(M){return void y(M)}_({data:T,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{let T=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});y(new ne(w.status,w.statusText,c.url,T))}},d.signal.addEventListener("abort",()=>{w.abort(),y(me())}),w.send(c.body)})})(o,t)};function Te(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;let t=new URL(o),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ye(o,t,n){n[o]&&n[o].indexOf(t)!==-1||(n[o]=n[o]||[],n[o].push(t))}function Ae(o,t,n){if(n&&n[o]){let c=n[o].indexOf(t);c!==-1&&n[o].splice(c,1)}}class Oe{constructor(t,n={}){_r(this,n),this.type=t}}class De extends Oe{constructor(t,n={}){super("error",_r({error:t},n))}}class ct{on(t,n){return this._listeners=this._listeners||{},ye(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Ae(t,n,this._listeners),Ae(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ye(t,n,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,n){typeof t=="string"&&(t=new Oe(t,n||{}));let c=t.type;if(this.listens(c)){t.target=this;let d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(let b of d)b.call(this,t);let _=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(let b of _)Ae(c,b,this._oneTimeListeners),b.call(this,t);let y=this._eventedParent;y&&(_r(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof De&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Tt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ft(o,t){let n={};for(let c in o)c!=="ref"&&(n[c]=o[c]);return Tt.forEach(c=>{c in t&&(n[c]=t[c])}),n}function dt(o,t){if(Array.isArray(o)){if(!Array.isArray(t)||o.length!==t.length)return!1;for(let n=0;n<o.length;n++)if(!dt(o[n],t[n]))return!1;return!0}if(typeof o=="object"&&o!==null&&t!==null){if(typeof t!="object"||Object.keys(o).length!==Object.keys(t).length)return!1;for(let n in o)if(!dt(o[n],t[n]))return!1;return!0}return o===t}function kt(o,t){o.push(t)}function fi(o,t,n){kt(n,{command:"addSource",args:[o,t[o]]})}function tn(o,t,n){kt(t,{command:"removeSource",args:[o]}),n[o]=!0}function nn(o,t,n,c){tn(o,n,c),fi(o,t,n)}function Vi(o,t,n){let c;for(c in o[n])if(Object.prototype.hasOwnProperty.call(o[n],c)&&c!=="data"&&!dt(o[n][c],t[n][c]))return!1;for(c in t[n])if(Object.prototype.hasOwnProperty.call(t[n],c)&&c!=="data"&&!dt(o[n][c],t[n][c]))return!1;return!0}function Vt(o,t,n,c,d,_){o=o||{},t=t||{};for(let y in o)Object.prototype.hasOwnProperty.call(o,y)&&(dt(o[y],t[y])||n.push({command:_,args:[c,y,t[y],d]}));for(let y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(o,y)&&(dt(o[y],t[y])||n.push({command:_,args:[c,y,t[y],d]}))}function Ht(o){return o.id}function Wi(o,t){return o[t.id]=t,o}class Ge{constructor(t,n,c,d){this.message=(t?`${t}: `:"")+c,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)}}function Cn(o,...t){for(let n of t)for(let c in n)o[c]=n[c];return o}class Ci extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Xo{constructor(t,n=[]){this.parent=t,this.bindings={};for(let[c,d]of n)this.bindings[c]=d}concat(t){return new Xo(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let as={kind:"null"},Qe={kind:"number"},Bt={kind:"string"},zt={kind:"boolean"},yn={kind:"color"},Sa={kind:"projectionDefinition"},Jo={kind:"object"},Dt={kind:"value"},sc={kind:"collator"},Yo={kind:"formatted"},lc={kind:"padding"},oo={kind:"colorArray"},ss={kind:"numberArray"},Ri={kind:"resolvedImage"},cc={kind:"variableAnchorOffsetCollection"};function Xn(o,t){return{kind:"array",itemType:o,N:t}}function ui(o){if(o.kind==="array"){let t=ui(o.itemType);return typeof o.N=="number"?`array<${t}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${t}>`}return o.kind}let Rp=[as,Qe,Bt,zt,yn,Sa,Yo,Jo,Xn(Dt),lc,ss,oo,Ri,cc];function tl(o,t){if(t.kind==="error")return null;if(o.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!tl(o.itemType,t.itemType))&&(typeof o.N!="number"||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if(o.kind==="value"){for(let n of Rp)if(!tl(n,t))return null}}return`Expected ${ui(o)} but found ${ui(t)} instead.`}function Nu(o,t){return t.some(n=>n.kind===o.kind)}function Qo(o,t){return t.some(n=>n==="null"?o===null:n==="array"?Array.isArray(o):n==="object"?o&&!Array.isArray(o)&&typeof o=="object":n===typeof o)}function ea(o,t){return o.kind==="array"&&t.kind==="array"?o.itemType.kind===t.itemType.kind&&typeof o.N=="number":o.kind===t.kind}let Vu=.96422,zp=.82521,Op=4/29,ls=6/29,Fp=3*ls*ls,Pf=ls*ls*ls,Mf=Math.PI/180,Ef=180/Math.PI;function $u(o){return(o%=360)<0&&(o+=360),o}function cs([o,t,n,c]){let d,_,y=qu((.2225045*(o=Gu(o))+.7168786*(t=Gu(t))+.0606169*(n=Gu(n)))/1);o===t&&t===n?d=_=y:(d=qu((.4360747*o+.3850649*t+.1430804*n)/Vu),_=qu((.0139322*o+.0971045*t+.7141733*n)/zp));let b=116*y-16;return[b<0?0:b,500*(d-y),200*(y-_),c]}function Gu(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function qu(o){return o>Pf?Math.pow(o,1/3):o/Fp+Op}function us([o,t,n,c]){let d=(o+16)/116,_=isNaN(t)?d:d+t/500,y=isNaN(n)?d:d-n/200;return d=1*Zu(d),_=Vu*Zu(_),y=zp*Zu(y),[Wu(3.1338561*_-1.6168667*d-.4906146*y),Wu(-.9787684*_+1.9161415*d+.033454*y),Wu(.0719453*_-.2289914*d+1.4052427*y),c]}function Wu(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function Zu(o){return o>ls?o*o*o:Fp*(o-Op)}let Af=Object.hasOwn||function(o,t){return Object.prototype.hasOwnProperty.call(o,t)};function hs(o,t){return Af(o,t)?o[t]:void 0}function il(o){return parseInt(o.padEnd(2,o),16)/255}function zr(o,t){return jt(t?o/100:o,0,1)}function jt(o,t,n){return Math.min(Math.max(t,o),n)}function Ia(o){return!o.some(Number.isNaN)}let ta={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Po(o,t,n){return o+n*(t-o)}function Ta(o,t,n){return o.map((c,d)=>Po(c,t[d],n))}class Ut{constructor(t,n,c,d=1,_=!0){this.r=t,this.g=n,this.b=c,this.a=d,_||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,n,c,d]))}static parse(t){if(t instanceof Ut)return t;if(typeof t!="string")return;let n=(function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];let d=hs(ta,c);if(d){let[y,b,w]=d;return[y/255,b/255,w/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){let y=c.length<6?1:2,b=1;return[il(c.slice(b,b+=y)),il(c.slice(b,b+=y)),il(c.slice(b,b+=y)),il(c.slice(b,b+y)||"ff")]}if(c.startsWith("rgb")){let y=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){let[b,w,T,M,k,z,B,j,$,Z,Q,de]=y,oe=[M||" ",B||" ",Z].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){let ce=[T,z,$].join(""),Ie=ce==="%%%"?100:ce===""?255:0;if(Ie){let Ee=[jt(+w/Ie,0,1),jt(+k/Ie,0,1),jt(+j/Ie,0,1),Q?zr(+Q,de):1];if(Ia(Ee))return Ee}}return}}let _=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){let[y,b,w,T,M,k,z,B,j]=_,$=[w||" ",M||" ",z].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){let Z=[+b,jt(+T,0,100),jt(+k,0,100),B?zr(+B,j):1];if(Ia(Z))return(function([Q,de,oe,ce]){function Ie(Ee){let ze=(Ee+Q/30)%12,Je=de*Math.min(oe,1-oe);return oe-Je*Math.max(-1,Math.min(ze-3,9-ze,1))}return Q=$u(Q),de/=100,oe/=100,[Ie(0),Ie(8),Ie(4),ce]})(Z)}}})(t);return n?new Ut(...n,!1):void 0}get rgb(){let{r:t,g:n,b:c,a:d}=this,_=d||1/0;return this.overwriteGetter("rgb",[t/_,n/_,c/_,d])}get hcl(){return this.overwriteGetter("hcl",(function(t){let[n,c,d,_]=cs(t),y=Math.sqrt(c*c+d*d);return[Math.round(1e4*y)?$u(Math.atan2(d,c)*Ef):NaN,y,n,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",cs(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){let[t,n,c,d]=this.rgb;return`rgba(${[t,n,c].map(_=>Math.round(255*_)).join(",")},${d})`}static interpolate(t,n,c,d="rgb"){switch(d){case"rgb":{let[_,y,b,w]=Ta(t.rgb,n.rgb,c);return new Ut(_,y,b,w,!1)}case"hcl":{let[_,y,b,w]=t.hcl,[T,M,k,z]=n.hcl,B,j;if(isNaN(_)||isNaN(T))isNaN(_)?isNaN(T)?B=NaN:(B=T,b!==1&&b!==0||(j=M)):(B=_,k!==1&&k!==0||(j=y));else{let oe=T-_;T>_&&oe>180?oe-=360:T<_&&_-T>180&&(oe+=360),B=_+c*oe}let[$,Z,Q,de]=(function([oe,ce,Ie,Ee]){return oe=isNaN(oe)?0:oe*Mf,us([Ie,Math.cos(oe)*ce,Math.sin(oe)*ce,Ee])})([B,j??Po(y,M,c),Po(b,k,c),Po(w,z,c)]);return new Ut($,Z,Q,de,!1)}case"lab":{let[_,y,b,w]=us(Ta(t.lab,n.lab,c));return new Ut(_,y,b,w,!1)}}}}Ut.black=new Ut(0,0,0,1),Ut.white=new Ut(1,1,1,1),Ut.transparent=new Ut(0,0,0,0),Ut.red=new Ut(1,0,0,1);class Ca{constructor(t,n,c){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let uc=["bottom","center","top"];class hc{constructor(t,n,c,d,_,y){this.text=t,this.image=n,this.scale=c,this.fontStack=d,this.textColor=_,this.verticalAlign=y}}class Fn{constructor(t){this.sections=t}static fromString(t){return new Fn([new hc(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Fn?t:Fn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class ln{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ln)return t;if(typeof t=="number")return new ln([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ln(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){return new ln(Ta(t.values,n.values,c))}}class Bn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Bn)return t;if(typeof t=="number")return new Bn([t]);if(Array.isArray(t)){for(let n of t)if(typeof n!="number")return;return new Bn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){return new Bn(Ta(t.values,n.values,c))}}class Zi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Zi)return t;if(typeof t=="string"){let c=Ut.parse(t);return c?new Zi([c]):void 0}if(!Array.isArray(t))return;let n=[];for(let c of t){if(typeof c!="string")return;let d=Ut.parse(c);if(!d)return;n.push(d)}return new Zi(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c,d="rgb"){let _=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let y=0;y<t.values.length;y++)_.push(Ut.interpolate(t.values[y],n.values[y],c,d));return new Zi(_)}}class hi extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}let Bp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class jn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof jn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){let c=t[n],d=t[n+1];if(typeof c!="string"||!Bp.has(c)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new jn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){let d=t.values,_=n.values;if(d.length!==_.length)throw new hi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);let y=[];for(let b=0;b<d.length;b+=2){if(d[b]!==_[b])throw new hi(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${d[b]}, to[${b}]: ${_[b]}`);y.push(d[b]);let[w,T]=d[b+1],[M,k]=_[b+1];y.push([Po(w,M,c),Po(T,k,c)])}return new jn(y)}}class sr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new sr({name:t,available:!1}):null}}class Pn{constructor(t,n,c){this.from=t,this.to=n,this.transition=c}static interpolate(t,n,c){return new Pn(t,n,c)}static parse(t){return t instanceof Pn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Pn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Pn(t.from,t.to,t.transition):typeof t=="string"?new Pn(t,t,1):void 0}}function _i(o,t,n,c){return typeof o=="number"&&o>=0&&o<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[o,t,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[o,t,n,c]:[o,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Pa(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Pn||o instanceof Ut||o instanceof Ca||o instanceof Fn||o instanceof ln||o instanceof Bn||o instanceof Zi||o instanceof jn||o instanceof sr)return!0;if(Array.isArray(o)){for(let t of o)if(!Pa(t))return!1;return!0}if(typeof o=="object"){for(let t in o)if(!Pa(o[t]))return!1;return!0}return!1}function wt(o){if(o===null)return as;if(typeof o=="string")return Bt;if(typeof o=="boolean")return zt;if(typeof o=="number")return Qe;if(o instanceof Ut)return yn;if(o instanceof Pn)return Sa;if(o instanceof Ca)return sc;if(o instanceof Fn)return Yo;if(o instanceof ln)return lc;if(o instanceof Bn)return ss;if(o instanceof Zi)return oo;if(o instanceof jn)return cc;if(o instanceof sr)return Ri;if(Array.isArray(o)){let t=o.length,n;for(let c of o){let d=wt(c);if(n){if(n===d)continue;n=Dt;break}n=d}return Xn(n||Dt,t)}return Jo}function At(o){let t=typeof o;return o===null?"":t==="string"||t==="number"||t==="boolean"?String(o):o instanceof Ut||o instanceof Pn||o instanceof Fn||o instanceof ln||o instanceof Bn||o instanceof Zi||o instanceof jn||o instanceof sr?o.toString():JSON.stringify(o)}class Mo{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Pa(t[1]))return n.error("invalid value");let c=t[1],d=wt(c),_=n.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Mo(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let Kt={string:Bt,number:Qe,boolean:zt,object:Jo};class lr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c,d=1,_=t[0];if(_==="array"){let b,w;if(t.length>2){let T=t[1];if(typeof T!="string"||!(T in Kt)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Kt[T],d++}else b=Dt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);w=t[2],d++}c=Xn(b,w)}else{if(!Kt[_])throw new Error(`Types doesn't contain name = ${_}`);c=Kt[_]}let y=[];for(;d<t.length;d++){let b=n.parse(t[d],d,Dt);if(!b)return null;y.push(b)}return new lr(c,y)}evaluate(t){for(let n=0;n<this.args.length;n++){let c=this.args[n].evaluate(t);if(!tl(this.type,wt(c)))return c;if(n===this.args.length-1)throw new hi(`Expected value to be of type ${ui(this.type)}, but found ${ui(wt(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let ao={"to-boolean":zt,"to-color":yn,"to-number":Qe,"to-string":Bt};class so{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c=t[0];if(!ao[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return n.error("Expected one argument.");let d=ao[c],_=[];for(let y=1;y<t.length;y++){let b=n.parse(t[y],y,Dt);if(!b)return null;_.push(b)}return new so(d,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,c;for(let d of this.args){if(n=d.evaluate(t),c=null,n instanceof Ut)return n;if(typeof n=="string"){let _=t.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:_i(n[0],n[1],n[2],n[3]),!c))return new Ut(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new hi(c||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(let c of this.args){n=c.evaluate(t);let d=ln.parse(n);if(d)return d}throw new hi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(let c of this.args){n=c.evaluate(t);let d=Bn.parse(n);if(d)return d}throw new hi(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(let c of this.args){n=c.evaluate(t);let d=Zi.parse(n);if(d)return d}throw new hi(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(let c of this.args){n=c.evaluate(t);let d=jn.parse(n);if(d)return d}throw new hi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(let c of this.args){if(n=c.evaluate(t),n===null)return 0;let d=Number(n);if(!isNaN(d))return d}throw new hi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Fn.fromString(At(this.args[0].evaluate(t)));case"resolvedImage":return sr.fromString(At(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return At(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let pc=["Unknown","Point","LineString","Polygon"];class Hu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=Ut.parse(t),this._parseColorCache.set(t,n)),n}}class ps{constructor(t,n,c=[],d,_=new Xo,y=[]){this.registry=t,this.path=c,this.key=c.map(b=>`[${b}]`).join(""),this.scope=_,this.errors=y,this.expectedType=d,this._isConstant=n}parse(t,n,c,d,_={}){return n?this.concat(n,c,d)._parse(t,_):this._parse(t,_)}_parse(t,n){function c(d,_,y){return y==="assert"?new lr(_,[d]):y==="coerce"?new so(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let _=this.registry[d];if(_){let y=_.parse(t,this);if(!y)return null;if(this.expectedType){let b=this.expectedType,w=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||w.kind!=="value"){if(b.kind==="projectionDefinition"&&["string","array"].includes(w.kind)||["color","formatted","resolvedImage"].includes(b.kind)&&["value","string"].includes(w.kind)||["padding","numberArray"].includes(b.kind)&&["value","number","array"].includes(w.kind)||b.kind==="colorArray"&&["value","string","array"].includes(w.kind)||b.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(w.kind))y=c(y,b,n.typeAnnotation||"coerce");else if(this.checkSubtype(b,w))return null}else y=c(y,b,n.typeAnnotation||"assert")}if(!(y instanceof Mo)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){let b=new Hu;try{y=new Mo(y.type,y.evaluate(b))}catch(w){return this.error(w.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,c){let d=typeof t=="number"?this.path.concat(t):this.path,_=c?this.scope.concat(c):this.scope;return new ps(this.registry,this._isConstant,d,n||null,_,this.errors)}error(t,...n){let c=`${this.key}${n.map(d=>`[${d}]`).join("")}`;this.errors.push(new Ci(c,t))}checkSubtype(t,n){let c=tl(t,n);return c&&this.error(c),c}}class nl{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let c=[];for(let _=1;_<t.length-1;_+=2){let y=t[_];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);let b=n.parse(t[_+1],_+1);if(!b)return null;c.push([y,b])}let d=n.parse(t[t.length-1],t.length-1,n.expectedType,c);return d?new nl(c,d):null}outputDefined(){return this.result.outputDefined()}}class dc{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let c=t[1];return n.scope.has(c)?new dc(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class mc{constructor(t,n,c){this.type=t,this.index=n,this.input=c}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let c=n.parse(t[1],1,Qe),d=n.parse(t[2],2,Xn(n.expectedType||Dt));return c&&d?new mc(d.type.itemType,c,d):null}evaluate(t){let n=this.index.evaluate(t),c=this.input.evaluate(t);if(n<0)throw new hi(`Array index out of bounds: ${n} < 0.`);if(n>=c.length)throw new hi(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n!==Math.floor(n))throw new hi(`Array index must be an integer, but found ${n} instead.`);return c[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class fc{constructor(t,n){this.type=zt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let c=n.parse(t[1],1,Dt),d=n.parse(t[2],2,Dt);return c&&d?Nu(c.type,[zt,Bt,Qe,as,Dt])?new fc(c,d):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ui(c.type)} instead`):null}evaluate(t){let n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!Qo(n,["boolean","string","number","null"]))throw new hi(`Expected first argument to be of type boolean, string, number or null, but found ${ui(wt(n))} instead.`);if(!Qo(c,["string","array"]))throw new hi(`Expected second argument to be of type array or string, but found ${ui(wt(c))} instead.`);return c.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Or{constructor(t,n,c){this.type=Qe,this.needle=t,this.haystack=n,this.fromIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let c=n.parse(t[1],1,Dt),d=n.parse(t[2],2,Dt);if(!c||!d)return null;if(!Nu(c.type,[zt,Bt,Qe,as,Dt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ui(c.type)} instead`);if(t.length===4){let _=n.parse(t[3],3,Qe);return _?new Or(c,d,_):null}return new Or(c,d)}evaluate(t){let n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Qo(n,["boolean","string","number","null"]))throw new hi(`Expected first argument to be of type boolean, string, number or null, but found ${ui(wt(n))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(t)),Qo(c,["string"])){let _=c.indexOf(n,d);return _===-1?-1:[...c.slice(0,_)].length}if(Qo(c,["array"]))return c.indexOf(n,d);throw new hi(`Expected second argument to be of type array or string, but found ${ui(wt(c))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class cn{constructor(t,n,c,d,_,y){this.inputType=t,this.type=n,this.input=c,this.cases=d,this.outputs=_,this.otherwise=y}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let c,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);let _={},y=[];for(let T=2;T<t.length-1;T+=2){let M=t[T],k=t[T+1];Array.isArray(M)||(M=[M]);let z=n.concat(T);if(M.length===0)return z.error("Expected at least one branch label.");for(let j of M){if(typeof j!="number"&&typeof j!="string")return z.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return z.error("Numeric branch labels must be integer values.");if(c){if(z.checkSubtype(c,wt(j)))return null}else c=wt(j);if(_[String(j)]!==void 0)return z.error("Branch labels must be unique.");_[String(j)]=y.length}let B=n.parse(k,T,d);if(!B)return null;d=d||B.type,y.push(B)}let b=n.parse(t[1],1,Dt);if(!b)return null;let w=n.parse(t[t.length-1],t.length-1,d);return w?b.type.kind!=="value"&&n.concat(1).checkSubtype(c,b.type)?null:new cn(c,d,b,_,y,w):null}evaluate(t){let n=this.input.evaluate(t);return(wt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class ds{constructor(t,n,c){this.type=t,this.branches=n,this.otherwise=c}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);let d=[];for(let y=1;y<t.length-1;y+=2){let b=n.parse(t[y],y,zt);if(!b)return null;let w=n.parse(t[y+1],y+1,c);if(!w)return null;d.push([b,w]),c=c||w.type}let _=n.parse(t[t.length-1],t.length-1,c);if(!_)return null;if(!c)throw new Error("Can't infer output type");return new ds(c,d,_)}evaluate(t){for(let[n,c]of this.branches)if(n.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[n,c]of this.branches)t(n),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class rl{constructor(t,n,c,d){this.type=t,this.input=n,this.beginIndex=c,this.endIndex=d}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let c=n.parse(t[1],1,Dt),d=n.parse(t[2],2,Qe);if(!c||!d)return null;if(!Nu(c.type,[Xn(Dt),Bt,Dt]))return n.error(`Expected first argument to be of type array or string, but found ${ui(c.type)} instead`);if(t.length===4){let _=n.parse(t[3],3,Qe);return _?new rl(c.type,c,d,_):null}return new rl(c.type,c,d)}evaluate(t){let n=this.input.evaluate(t),c=this.beginIndex.evaluate(t),d;if(this.endIndex&&(d=this.endIndex.evaluate(t)),Qo(n,["string"]))return[...n].slice(c,d).join("");if(Qo(n,["array"]))return n.slice(c,d);throw new hi(`Expected first argument to be of type array or string, but found ${ui(wt(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ma(o,t){let n=o.length-1,c,d,_=0,y=n,b=0;for(;_<=y;)if(b=Math.floor((_+y)/2),c=o[b],d=o[b+1],c<=t){if(b===n||t<d)return b;_=b+1}else{if(!(c>t))throw new hi("Input is not a number.");y=b-1}return 0}class zi{constructor(t,n,c){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(let[d,_]of c)this.labels.push(d),this.outputs.push(_)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");let c=n.parse(t[1],1,Qe);if(!c)return null;let d=[],_=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let y=1;y<t.length;y+=2){let b=y===1?-1/0:t[y],w=t[y+1],T=y,M=y+1;if(typeof b!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(d.length&&d[d.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);let k=n.parse(w,M,_);if(!k)return null;_=_||k.type,d.push([b,k])}return new zi(_,c,d)}evaluate(t){let n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);let d=this.input.evaluate(t);if(d<=n[0])return c[0].evaluate(t);let _=n.length;return d>=n[_-1]?c[_-1].evaluate(t):c[Ma(n,d)].evaluate(t)}eachChild(t){t(this.input);for(let n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function jp(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ol,Ku,kf=(function(){if(Ku)return ol;function o(t,n,c,d){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=c,this.p2y=d}return Ku=1,ol=o,o.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,d=0;d<8;d++){var _=this.sampleCurveX(c)-t;if(Math.abs(_)<n)return c;var y=this.sampleCurveDerivativeX(c);if(Math.abs(y)<1e-6)break;c-=_/y}var b=0,w=1;for(c=t,d=0;d<20&&(_=this.sampleCurveX(c),!(Math.abs(_-t)<n));d++)t>_?b=c:w=c,c=.5*(w-b)+b;return c},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},ol})(),ms=jp(kf);class vn{constructor(t,n,c,d,_){this.type=t,this.operator=n,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(let[y,b]of _)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(t,n,c,d){let _=0;if(t.name==="exponential")_=al(n,t.base,c,d);else if(t.name==="linear")_=al(n,1,c,d);else if(t.name==="cubic-bezier"){let y=t.controlPoints;_=new ms(y[0],y[1],y[2],y[3]).solve(al(n,1,c,d))}return _}static parse(t,n){let[c,d,_,...y]=t;if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){let T=d[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(d[0])}`,1,0);{let T=d.slice(1);if(T.length!==4||T.some(M=>typeof M!="number"||M<0||M>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,Qe),!_)return null;let b=[],w=null;c!=="interpolate-hcl"&&c!=="interpolate-lab"||n.expectedType==oo?n.expectedType&&n.expectedType.kind!=="value"&&(w=n.expectedType):w=yn;for(let T=0;T<y.length;T+=2){let M=y[T],k=y[T+1],z=T+3,B=T+4;if(typeof M!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(b.length&&b[b.length-1][0]>=M)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);let j=n.parse(k,B,w);if(!j)return null;w=w||j.type,b.push([M,j])}return ea(w,Qe)||ea(w,Sa)||ea(w,yn)||ea(w,lc)||ea(w,ss)||ea(w,oo)||ea(w,cc)||ea(w,Xn(Qe))?new vn(w,c,d,_,b):n.error(`Type ${ui(w)} is not interpolatable.`)}evaluate(t){let n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);let d=this.input.evaluate(t);if(d<=n[0])return c[0].evaluate(t);let _=n.length;if(d>=n[_-1])return c[_-1].evaluate(t);let y=Ma(n,d),b=vn.interpolationFactor(this.interpolation,d,n[y],n[y+1]),w=c[y].evaluate(t),T=c[y+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Po(w,T,b);case"color":return Ut.interpolate(w,T,b);case"padding":return ln.interpolate(w,T,b);case"colorArray":return Zi.interpolate(w,T,b);case"numberArray":return Bn.interpolate(w,T,b);case"variableAnchorOffsetCollection":return jn.interpolate(w,T,b);case"array":return Ta(w,T,b);case"projectionDefinition":return Pn.interpolate(w,T,b)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ut.interpolate(w,T,b,"hcl");case"colorArray":return Zi.interpolate(w,T,b,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ut.interpolate(w,T,b,"lab");case"colorArray":return Zi.interpolate(w,T,b,"lab")}}}eachChild(t){t(this.input);for(let n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function al(o,t,n,c){let d=c-n,_=o-n;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}let lo={color:Ut.interpolate,number:Po,padding:ln.interpolate,numberArray:Bn.interpolate,colorArray:Zi.interpolate,variableAnchorOffsetCollection:jn.interpolate,array:Ta};class sl{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c=null,d=n.expectedType;d&&d.kind!=="value"&&(c=d);let _=[];for(let b of t.slice(1)){let w=n.parse(b,1+_.length,c,void 0,{typeAnnotation:"omit"});if(!w)return null;c=c||w.type,_.push(w)}if(!c)throw new Error("No output type");let y=d&&_.some(b=>tl(d,b.type));return new sl(y?Dt:c,_)}evaluate(t){let n,c=null,d=0;for(let _ of this.args)if(d++,c=_.evaluate(t),c&&c instanceof sr&&!c.available&&(n||(n=c.name),c=null,d===this.args.length&&(c=n)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function ll(o,t){return o==="=="||o==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function cl(o,t,n,c){return c.compare(t,n)===0}function Mn(o,t,n){let c=o!=="=="&&o!=="!=";return class g1{constructor(_,y,b){this.type=zt,this.lhs=_,this.rhs=y,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");let b=_[0],w=y.parse(_[1],1,Dt);if(!w)return null;if(!ll(b,w.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${ui(w.type)}'.`);let T=y.parse(_[2],2,Dt);if(!T)return null;if(!ll(b,T.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${ui(T.type)}'.`);if(w.type.kind!==T.type.kind&&w.type.kind!=="value"&&T.type.kind!=="value")return y.error(`Cannot compare types '${ui(w.type)}' and '${ui(T.type)}'.`);c&&(w.type.kind==="value"&&T.type.kind!=="value"?w=new lr(T.type,[w]):w.type.kind!=="value"&&T.type.kind==="value"&&(T=new lr(w.type,[T])));let M=null;if(_.length===4){if(w.type.kind!=="string"&&T.type.kind!=="string"&&w.type.kind!=="value"&&T.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(_[3],3,sc),!M)return null}return new g1(w,T,M)}evaluate(_){let y=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(c&&this.hasUntypedArgument){let w=wt(y),T=wt(b);if(w.kind!==T.kind||w.kind!=="string"&&w.kind!=="number")throw new hi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${w.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){let w=wt(y),T=wt(b);if(w.kind!=="string"||T.kind!=="string")return t(_,y,b)}return this.collator?n(_,y,b,this.collator.evaluate(_)):t(_,y,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}let Up=Mn("==",function(o,t,n){return t===n},cl),gc=Mn("!=",function(o,t,n){return t!==n},function(o,t,n,c){return!cl(0,t,n,c)}),Lf=Mn("<",function(o,t,n){return t<n},function(o,t,n,c){return c.compare(t,n)<0}),Xu=Mn(">",function(o,t,n){return t>n},function(o,t,n,c){return c.compare(t,n)>0}),Df=Mn("<=",function(o,t,n){return t<=n},function(o,t,n,c){return c.compare(t,n)<=0}),Rf=Mn(">=",function(o,t,n){return t>=n},function(o,t,n,c){return c.compare(t,n)>=0});class _c{constructor(t,n,c){this.type=sc,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");let c=t[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");let d=n.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,zt);if(!d)return null;let _=n.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,zt);if(!_)return null;let y=null;return c.locale&&(y=n.parse(c.locale,1,Bt),!y)?null:new _c(d,_,y)}evaluate(t){return new Ca(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ju{constructor(t,n,c,d,_){this.type=Bt,this.number=t,this.locale=n,this.currency=c,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");let c=n.parse(t[1],1,Qe);if(!c)return null;let d=t[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=n.parse(d.locale,1,Bt),!_))return null;let y=null;if(d.currency&&(y=n.parse(d.currency,1,Bt),!y))return null;let b=null;if(d["min-fraction-digits"]&&(b=n.parse(d["min-fraction-digits"],1,Qe),!b))return null;let w=null;return d["max-fraction-digits"]&&(w=n.parse(d["max-fraction-digits"],1,Qe),!w)?null:new Ju(c,_,y,b,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ea{constructor(t){this.type=Yo,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c=t[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");let d=[],_=!1;for(let y=1;y<=t.length-1;++y){let b=t[y];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let w=null;if(b["font-scale"]&&(w=n.parse(b["font-scale"],1,Qe),!w))return null;let T=null;if(b["text-font"]&&(T=n.parse(b["text-font"],1,Xn(Bt)),!T))return null;let M=null;if(b["text-color"]&&(M=n.parse(b["text-color"],1,yn),!M))return null;let k=null;if(b["vertical-align"]){if(typeof b["vertical-align"]=="string"&&!uc.includes(b["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${b["vertical-align"]}' instead.`);if(k=n.parse(b["vertical-align"],1,Bt),!k)return null}let z=d[d.length-1];z.scale=w,z.font=T,z.textColor=M,z.verticalAlign=k}else{let w=n.parse(t[y],1,Dt);if(!w)return null;let T=w.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:w,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ea(d)}evaluate(t){return new Fn(this.sections.map(n=>{let c=n.content.evaluate(t);return wt(c)===Ri?new hc("",c,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new hc(At(c),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)}))}eachChild(t){for(let n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Yu{constructor(t){this.type=Ri,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");let c=n.parse(t[1],1,Bt);return c?new Yu(c):n.error("No image name provided.")}evaluate(t){let n=this.input.evaluate(t),c=sr.fromString(n);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(n)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class yc{constructor(t){this.type=Qe,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);let c=n.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ui(c.type)} instead.`):new yc(c):null}evaluate(t){let n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new hi(`Expected value to be of type string or array, but found ${ui(wt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Fr=8192;function zf(o,t){let n=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(n*d*Fr),Math.round(c*d*Fr)]}function vc(o,t){let n=Math.pow(2,t.z);return[(d=(o[0]/Fr+t.x)/n,360*d-180),(c=(o[1]/Fr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90)];var c,d}function ul(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function hl(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function Of(o,t,n){let c=o[0]-t[0],d=o[1]-t[1],_=o[0]-n[0],y=o[1]-n[1];return c*y-_*d==0&&c*_<=0&&d*y<=0}function xc(o,t,n,c){return(d=[c[0]-n[0],c[1]-n[1]])[0]*(_=[t[0]-o[0],t[1]-o[1]])[1]-d[1]*_[0]!=0&&!(!Vp(o,t,n,c)||!Vp(n,c,o,t));var d,_}function Ff(o,t,n){for(let c of n)for(let d=0;d<c.length-1;++d)if(xc(o,t,c[d],c[d+1]))return!0;return!1}function Aa(o,t,n=!1){let c=!1;for(let b of t)for(let w=0;w<b.length-1;w++){if(Of(o,b[w],b[w+1]))return n;(_=b[w])[1]>(d=o)[1]!=(y=b[w+1])[1]>d[1]&&d[0]<(y[0]-_[0])*(d[1]-_[1])/(y[1]-_[1])+_[0]&&(c=!c)}var d,_,y;return c}function Np(o,t){for(let n of t)if(Aa(o,n))return!0;return!1}function Qu(o,t){for(let n of o)if(!Aa(n,t))return!1;for(let n=0;n<o.length-1;++n)if(Ff(o[n],o[n+1],t))return!1;return!0}function Bf(o,t){for(let n of t)if(Qu(o,n))return!0;return!1}function Vp(o,t,n,c){let d=c[0]-n[0],_=c[1]-n[1],y=(o[0]-n[0])*_-d*(o[1]-n[1]),b=(t[0]-n[0])*_-d*(t[1]-n[1]);return y>0&&b<0||y<0&&b>0}function eh(o,t,n){let c=[];for(let d=0;d<o.length;d++){let _=[];for(let y=0;y<o[d].length;y++){let b=zf(o[d][y],n);ul(t,b),_.push(b)}c.push(_)}return c}function $p(o,t,n){let c=[];for(let d=0;d<o.length;d++){let _=eh(o[d],t,n);c.push(_)}return c}function bc(o,t,n,c){if(o[0]<n[0]||o[0]>n[2]){let d=.5*c,_=o[0]-n[0]>d?-c:n[0]-o[0]>d?c:0;_===0&&(_=o[0]-n[2]>d?-c:n[2]-o[0]>d?c:0),o[0]+=_}ul(t,o)}function Gp(o,t,n,c){let d=Math.pow(2,c.z)*Fr,_=[c.x*Fr,c.y*Fr],y=[];for(let b of o)for(let w of b){let T=[w.x+_[0],w.y+_[1]];bc(T,t,n,d),y.push(T)}return y}function qp(o,t,n,c){let d=Math.pow(2,c.z)*Fr,_=[c.x*Fr,c.y*Fr],y=[];for(let w of o){let T=[];for(let M of w){let k=[M.x+_[0],M.y+_[1]];ul(t,k),T.push(k)}y.push(T)}if(t[2]-t[0]<=d/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let w of y)for(let T of w)bc(T,t,n,d)}var b;return y}class ka{constructor(t,n){this.type=zt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Pa(t[1])){let c=t[1];if(c.type==="FeatureCollection"){let d=[];for(let _ of c.features){let{type:y,coordinates:b}=_.geometry;y==="Polygon"&&d.push(b),y==="MultiPolygon"&&d.push(...b)}if(d.length)return new ka(c,{type:"MultiPolygon",coordinates:d})}else if(c.type==="Feature"){let d=c.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new ka(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new ka(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,c){let d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(c.type==="Polygon"){let b=eh(c.coordinates,_,y),w=Gp(n.geometry(),d,_,y);if(!hl(d,_))return!1;for(let T of w)if(!Aa(T,b))return!1}if(c.type==="MultiPolygon"){let b=$p(c.coordinates,_,y),w=Gp(n.geometry(),d,_,y);if(!hl(d,_))return!1;for(let T of w)if(!Np(T,b))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,c){let d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(c.type==="Polygon"){let b=eh(c.coordinates,_,y),w=qp(n.geometry(),d,_,y);if(!hl(d,_))return!1;for(let T of w)if(!Qu(T,b))return!1}if(c.type==="MultiPolygon"){let b=$p(c.coordinates,_,y),w=qp(n.geometry(),d,_,y);if(!hl(d,_))return!1;for(let T of w)if(!Bf(T,b))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let th=class{constructor(o=[],t=(n,c)=>n<c?-1:n>c?1:0){if(this.data=o,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;let o=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),o}peek(){return this.data[0]}_up(o){let{data:t,compare:n}=this,c=t[o];for(;o>0;){let d=o-1>>1,_=t[d];if(n(c,_)>=0)break;t[o]=_,o=d}t[o]=c}_down(o){let{data:t,compare:n}=this,c=this.length>>1,d=t[o];for(;o<c;){let _=1+(o<<1),y=_+1;if(y<this.length&&n(t[y],t[_])<0&&(_=y),n(t[_],d)>=0)break;t[o]=t[_],o=_}t[o]=d}};function ih(o,t,n=0,c=o.length-1,d=jf){for(;c>n;){if(c-n>600){let w=c-n+1,T=t-n+1,M=Math.log(w),k=.5*Math.exp(2*M/3),z=.5*Math.sqrt(M*k*(w-k)/w)*(T-w/2<0?-1:1);ih(o,t,Math.max(n,Math.floor(t-T*k/w+z)),Math.min(c,Math.floor(t+(w-T)*k/w+z)),d)}let _=o[t],y=n,b=c;for(pl(o,n,t),d(o[c],_)>0&&pl(o,n,c);y<b;){for(pl(o,y,b),y++,b--;d(o[y],_)<0;)y++;for(;d(o[b],_)>0;)b--}d(o[n],_)===0?pl(o,n,b):(b++,pl(o,b,c)),b<=t&&(n=b+1),t<=b&&(c=b-1)}}function pl(o,t,n){let c=o[t];o[t]=o[n],o[n]=c}function jf(o,t){return o<t?-1:o>t?1:0}function dl(o,t){if(o.length<=1)return[o];let n=[],c,d;for(let _ of o){let y=Uf(_);y!==0&&(_.area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(c&&n.push(c),c=[_]):c.push(_))}if(c&&n.push(c),t>1)for(let _=0;_<n.length;_++)n[_].length<=t||(ih(n[_],t,1,n[_].length-1,Wp),n[_]=n[_].slice(0,t));return n}function Wp(o,t){return t.area-o.area}function Uf(o){let t=0;for(let n,c,d=0,_=o.length,y=_-1;d<_;y=d++)n=o[d],c=o[y],t+=(c.x-n.x)*(n.y+c.y);return t}let Zp=1/298.257223563,Hp=Zp*(2-Zp),nh=Math.PI/180;class rh{constructor(t){let n=6378.137*nh*1e3,c=Math.cos(t*nh),d=1/(1-Hp*(1-c*c)),_=Math.sqrt(d);this.kx=n*_*c,this.ky=n*_*d*(1-Hp)}distance(t,n){let c=this.wrap(t[0]-n[0])*this.kx,d=(t[1]-n[1])*this.ky;return Math.sqrt(c*c+d*d)}pointOnLine(t,n){let c,d,_,y,b=1/0;for(let w=0;w<t.length-1;w++){let T=t[w][0],M=t[w][1],k=this.wrap(t[w+1][0]-T)*this.kx,z=(t[w+1][1]-M)*this.ky,B=0;k===0&&z===0||(B=(this.wrap(n[0]-T)*this.kx*k+(n[1]-M)*this.ky*z)/(k*k+z*z),B>1?(T=t[w+1][0],M=t[w+1][1]):B>0&&(T+=k/this.kx*B,M+=z/this.ky*B)),k=this.wrap(n[0]-T)*this.kx,z=(n[1]-M)*this.ky;let j=k*k+z*z;j<b&&(b=j,c=T,d=M,_=w,y=B)}return{point:[c,d],index:_,t:Math.max(0,Math.min(1,y))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Kp(o,t){return t[0]-o[0]}function wc(o){return o[1]-o[0]+1}function Eo(o,t){return o[1]>=o[0]&&o[1]<t}function Yt(o,t){if(o[0]>o[1])return[null,null];let n=wc(o);if(t){if(n===2)return[o,null];let d=Math.floor(n/2);return[[o[0],o[0]+d],[o[0]+d,o[1]]]}if(n===1)return[o,null];let c=Math.floor(n/2)-1;return[[o[0],o[0]+c],[o[0]+c+1,o[1]]]}function oh(o,t){if(!Eo(t,o.length))return[1/0,1/0,-1/0,-1/0];let n=[1/0,1/0,-1/0,-1/0];for(let c=t[0];c<=t[1];++c)ul(n,o[c]);return n}function ah(o){let t=[1/0,1/0,-1/0,-1/0];for(let n of o)for(let c of n)ul(t,c);return t}function Xp(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function sh(o,t,n){if(!Xp(o)||!Xp(t))return NaN;let c=0,d=0;return o[2]<t[0]&&(c=t[0]-o[2]),o[0]>t[2]&&(c=o[0]-t[2]),o[1]>t[3]&&(d=o[1]-t[3]),o[3]<t[1]&&(d=t[1]-o[3]),n.distance([0,0],[c,d])}function La(o,t,n){let c=n.pointOnLine(t,o);return n.distance(o,c.point)}function lh(o,t,n,c,d){let _=Math.min(La(o,[n,c],d),La(t,[n,c],d)),y=Math.min(La(n,[o,t],d),La(c,[o,t],d));return Math.min(_,y)}function Nf(o,t,n,c,d){if(!Eo(t,o.length)||!Eo(c,n.length))return 1/0;let _=1/0;for(let y=t[0];y<t[1];++y){let b=o[y],w=o[y+1];for(let T=c[0];T<c[1];++T){let M=n[T],k=n[T+1];if(xc(b,w,M,k))return 0;_=Math.min(_,lh(b,w,M,k,d))}}return _}function Vf(o,t,n,c,d){if(!Eo(t,o.length)||!Eo(c,n.length))return NaN;let _=1/0;for(let y=t[0];y<=t[1];++y)for(let b=c[0];b<=c[1];++b)if(_=Math.min(_,d.distance(o[y],n[b])),_===0)return _;return _}function $f(o,t,n){if(Aa(o,t,!0))return 0;let c=1/0;for(let d of t){let _=d[0],y=d[d.length-1];if(_!==y&&(c=Math.min(c,La(o,[y,_],n)),c===0))return c;let b=n.pointOnLine(d,o);if(c=Math.min(c,n.distance(o,b.point)),c===0)return c}return c}function Gf(o,t,n,c){if(!Eo(t,o.length))return NaN;for(let _=t[0];_<=t[1];++_)if(Aa(o[_],n,!0))return 0;let d=1/0;for(let _=t[0];_<t[1];++_){let y=o[_],b=o[_+1];for(let w of n)for(let T=0,M=w.length,k=M-1;T<M;k=T++){let z=w[k],B=w[T];if(xc(y,b,z,B))return 0;d=Math.min(d,lh(y,b,z,B,c))}}return d}function Jp(o,t){for(let n of o)for(let c of n)if(Aa(c,t,!0))return!0;return!1}function qf(o,t,n,c=1/0){let d=ah(o),_=ah(t);if(c!==1/0&&sh(d,_,n)>=c)return c;if(hl(d,_)){if(Jp(o,t))return 0}else if(Jp(t,o))return 0;let y=1/0;for(let b of o)for(let w=0,T=b.length,M=T-1;w<T;M=w++){let k=b[M],z=b[w];for(let B of t)for(let j=0,$=B.length,Z=$-1;j<$;Z=j++){let Q=B[Z],de=B[j];if(xc(k,z,Q,de))return 0;y=Math.min(y,lh(k,z,Q,de,n))}}return y}function Yp(o,t,n,c,d,_){if(!_)return;let y=sh(oh(c,_),d,n);y<t&&o.push([y,_,[0,0]])}function Sc(o,t,n,c,d,_,y){if(!_||!y)return;let b=sh(oh(c,_),oh(d,y),n);b<t&&o.push([b,_,y])}function Ic(o,t,n,c,d=1/0){let _=Math.min(c.distance(o[0],n[0][0]),d);if(_===0)return _;let y=new th([[0,[0,o.length-1],[0,0]]],Kp),b=ah(n);for(;y.length>0;){let w=y.pop();if(w[0]>=_)continue;let T=w[1],M=t?50:100;if(wc(T)<=M){if(!Eo(T,o.length))return NaN;if(t){let k=Gf(o,T,n,c);if(isNaN(k)||k===0)return k;_=Math.min(_,k)}else for(let k=T[0];k<=T[1];++k){let z=$f(o[k],n,c);if(_=Math.min(_,z),_===0)return 0}}else{let k=Yt(T,t);Yp(y,_,c,o,b,k[0]),Yp(y,_,c,o,b,k[1])}}return _}function Tc(o,t,n,c,d,_=1/0){let y=Math.min(_,d.distance(o[0],n[0]));if(y===0)return y;let b=new th([[0,[0,o.length-1],[0,n.length-1]]],Kp);for(;b.length>0;){let w=b.pop();if(w[0]>=y)continue;let T=w[1],M=w[2],k=t?50:100,z=c?50:100;if(wc(T)<=k&&wc(M)<=z){if(!Eo(T,o.length)&&Eo(M,n.length))return NaN;let B;if(t&&c)B=Nf(o,T,n,M,d),y=Math.min(y,B);else if(t&&!c){let j=o.slice(T[0],T[1]+1);for(let $=M[0];$<=M[1];++$)if(B=La(n[$],j,d),y=Math.min(y,B),y===0)return y}else if(!t&&c){let j=n.slice(M[0],M[1]+1);for(let $=T[0];$<=T[1];++$)if(B=La(o[$],j,d),y=Math.min(y,B),y===0)return y}else B=Vf(o,T,n,M,d),y=Math.min(y,B)}else{let B=Yt(T,t),j=Yt(M,c);Sc(b,y,d,o,n,B[0],j[0]),Sc(b,y,d,o,n,B[0],j[1]),Sc(b,y,d,o,n,B[1],j[0]),Sc(b,y,d,o,n,B[1],j[1])}}return y}function ch(o){return o.type==="MultiPolygon"?o.coordinates.map(t=>({type:"Polygon",coordinates:t})):o.type==="MultiLineString"?o.coordinates.map(t=>({type:"LineString",coordinates:t})):o.type==="MultiPoint"?o.coordinates.map(t=>({type:"Point",coordinates:t})):[o]}class Da{constructor(t,n){this.type=Qe,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Pa(t[1])){let c=t[1];if(c.type==="FeatureCollection")return new Da(c,c.features.map(d=>ch(d.geometry)).flat());if(c.type==="Feature")return new Da(c,ch(c.geometry));if("type"in c&&"coordinates"in c)return new Da(c,ch(c))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,c){let d=n.geometry(),_=d.flat().map(w=>vc([w.x,w.y],n.canonical));if(d.length===0)return NaN;let y=new rh(_[0][1]),b=1/0;for(let w of c){switch(w.type){case"Point":b=Math.min(b,Tc(_,!1,[w.coordinates],!1,y,b));break;case"LineString":b=Math.min(b,Tc(_,!1,w.coordinates,!0,y,b));break;case"Polygon":b=Math.min(b,Ic(_,!1,w.coordinates,y,b))}if(b===0)return b}return b})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,c){let d=n.geometry(),_=d.flat().map(w=>vc([w.x,w.y],n.canonical));if(d.length===0)return NaN;let y=new rh(_[0][1]),b=1/0;for(let w of c){switch(w.type){case"Point":b=Math.min(b,Tc(_,!0,[w.coordinates],!1,y,b));break;case"LineString":b=Math.min(b,Tc(_,!0,w.coordinates,!0,y,b));break;case"Polygon":b=Math.min(b,Ic(_,!0,w.coordinates,y,b))}if(b===0)return b}return b})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,c){let d=n.geometry();if(d.length===0||d[0].length===0)return NaN;let _=dl(d,0).map(w=>w.map(T=>T.map(M=>vc([M.x,M.y],n.canonical)))),y=new rh(_[0][0][0][1]),b=1/0;for(let w of c)for(let T of _){switch(w.type){case"Point":b=Math.min(b,Ic([w.coordinates],!1,T,y,b));break;case"LineString":b=Math.min(b,Ic(w.coordinates,!0,T,y,b));break;case"Polygon":b=Math.min(b,qf(T,w.coordinates,y,b))}if(b===0)return b}return b})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ml{constructor(t){this.type=Dt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);let c=t[1];return c==null?n.error("Global state property must be defined."):typeof c!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new ml(c)}evaluate(t){var n;let c=(n=t.globals)===null||n===void 0?void 0:n.globalState;return c&&Object.keys(c).length!==0?hs(c,this.key):null}eachChild(){}outputDefined(){return!1}}let fs={"==":Up,"!=":gc,">":Xu,"<":Lf,">=":Rf,"<=":Df,array:lr,at:mc,boolean:lr,case:ds,coalesce:sl,collator:_c,format:Ea,image:Yu,in:fc,"index-of":Or,interpolate:vn,"interpolate-hcl":vn,"interpolate-lab":vn,length:yc,let:nl,literal:Mo,match:cn,number:lr,"number-format":Ju,object:lr,slice:rl,step:zi,string:lr,"to-boolean":so,"to-color":so,"to-number":so,"to-string":so,var:dc,within:ka,distance:Da,"global-state":ml};class yr{constructor(t,n,c,d){this.name=t,this.type=n,this._evaluate=c,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){let c=t[0],d=yr.definitions[c];if(!d)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);let _=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=y.filter(([T])=>!Array.isArray(T)||T.length===t.length-1),w=null;for(let[T,M]of b){w=new ps(n.registry,Cc,n.path,null,n.scope);let k=[],z=!1;for(let B=1;B<t.length;B++){let j=t[B],$=Array.isArray(T)?T[B-1]:T.type,Z=w.parse(j,1+k.length,$);if(!Z){z=!0;break}k.push(Z)}if(!z)if(Array.isArray(T)&&T.length!==k.length)w.error(`Expected ${T.length} arguments, but found ${k.length} instead.`);else{for(let B=0;B<k.length;B++){let j=Array.isArray(T)?T[B]:T.type,$=k[B];w.concat(B+1).checkSubtype(j,$.type)}if(w.errors.length===0)return new yr(c,_,M,k)}}if(b.length===1)n.errors.push(...w.errors);else{let T=(b.length?b:y).map(([k])=>{return z=k,Array.isArray(z)?`(${z.map(ui).join(", ")})`:`(${ui(z.type)}...)`;var z}).join(" | "),M=[];for(let k=1;k<t.length;k++){let z=n.parse(t[k],1+M.length);if(!z)return null;M.push(ui(z.type))}n.error(`Expected arguments of type ${T}, but found (${M.join(", ")}) instead.`)}return null}static register(t,n){yr.definitions=n;for(let c in n)t[c]=yr}}function Qp(o,[t,n,c,d]){t=t.evaluate(o),n=n.evaluate(o),c=c.evaluate(o);let _=d?d.evaluate(o):1,y=_i(t,n,c,_);if(y)throw new hi(y);return new Ut(t/255,n/255,c/255,_,!1)}function ed(o,t){return o in t}function uh(o,t){let n=t[o];return n===void 0?null:n}function Ra(o){return{type:o}}function Cc(o){if(o instanceof dc)return Cc(o.boundExpression);if(o instanceof yr&&o.name==="error"||o instanceof _c||o instanceof ka||o instanceof Da||o instanceof ml)return!1;let t=o instanceof so||o instanceof lr,n=!0;return o.eachChild(c=>{n=t?n&&Cc(c):n&&c instanceof Mo}),!!n&&Pc(o)&&Mc(o,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Pc(o){if(o instanceof yr&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ka||o instanceof Da)return!1;let t=!0;return o.eachChild(n=>{t&&!Pc(n)&&(t=!1)}),t}function fl(o){if(o instanceof yr&&o.name==="feature-state")return!1;let t=!0;return o.eachChild(n=>{t&&!fl(n)&&(t=!1)}),t}function Mc(o,t){if(o instanceof yr&&t.indexOf(o.name)>=0)return!1;let n=!0;return o.eachChild(c=>{n&&!Mc(c,t)&&(n=!1)}),n}function td(o){return{result:"success",value:o}}function gs(o){return{result:"error",value:o}}function ia(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function id(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function hh(o){return!!o.expression&&o.expression.interpolated}function $t(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function gl(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)&&wt(o)===Jo}function Wf(o){return o}function nd(o,t){let n=o.stops&&typeof o.stops[0][0]=="object",c=n||!(n||o.property!==void 0),d=o.type||(hh(t)?"exponential":"interval"),_=(function(M){switch(M.type){case"color":return Ut.parse;case"padding":return ln.parse;case"numberArray":return Bn.parse;case"colorArray":return Zi.parse;default:return null}})(t);if(_&&((o=Cn({},o)).stops&&(o.stops=o.stops.map(M=>[M[0],_(M[1])])),o.default=_(o.default?o.default:t.default)),o.colorSpace&&(y=o.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var y;let b=(function(M){switch(M){case"exponential":return od;case"interval":return Zf;case"categorical":return rd;case"identity":return Hf;default:throw new Error(`Unknown function type "${M}"`)}})(d),w,T;if(d==="categorical"){w=Object.create(null);for(let M of o.stops)w[M[0]]=M[1];T=typeof o.stops[0][0]}if(n){let M={},k=[];for(let j=0;j<o.stops.length;j++){let $=o.stops[j],Z=$[0].zoom;M[Z]===void 0&&(M[Z]={zoom:Z,type:o.type,property:o.property,default:o.default,stops:[]},k.push(Z)),M[Z].stops.push([$[0].value,$[1]])}let z=[];for(let j of k)z.push([M[j].zoom,nd(M[j],t)]);let B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:vn.interpolationFactor.bind(void 0,B),zoomStops:z.map(j=>j[0]),evaluate:({zoom:j},$)=>od({stops:z,base:o.base},t,j).evaluate(j,$)}}if(c){let M=d==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:vn.interpolationFactor.bind(void 0,M),zoomStops:o.stops.map(k=>k[0]),evaluate:({zoom:k})=>b(o,t,k,w,T)}}return{kind:"source",evaluate(M,k){let z=k&&k.properties?k.properties[o.property]:void 0;return z===void 0?na(o.default,t.default):b(o,t,z,w,T)}}}function na(o,t,n){return o!==void 0?o:t!==void 0?t:n!==void 0?n:void 0}function rd(o,t,n,c,d){return na(typeof n===d?c[n]:void 0,o.default,t.default)}function Zf(o,t,n){if($t(n)!=="number")return na(o.default,t.default);let c=o.stops.length;if(c===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[c-1][0])return o.stops[c-1][1];let d=Ma(o.stops.map(_=>_[0]),n);return o.stops[d][1]}function od(o,t,n){let c=o.base!==void 0?o.base:1;if($t(n)!=="number")return na(o.default,t.default);let d=o.stops.length;if(d===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[d-1][0])return o.stops[d-1][1];let _=Ma(o.stops.map(M=>M[0]),n),y=(function(M,k,z,B){let j=B-z,$=M-z;return j===0?0:k===1?$/j:(Math.pow(k,$)-1)/(Math.pow(k,j)-1)})(n,c,o.stops[_][0],o.stops[_+1][0]),b=o.stops[_][1],w=o.stops[_+1][1],T=lo[t.type]||Wf;return typeof b.evaluate=="function"?{evaluate(...M){let k=b.evaluate.apply(void 0,M),z=w.evaluate.apply(void 0,M);if(k!==void 0&&z!==void 0)return T(k,z,y,o.colorSpace)}}:T(b,w,y,o.colorSpace)}function Hf(o,t,n){switch(t.type){case"color":n=Ut.parse(n);break;case"formatted":n=Fn.fromString(n.toString());break;case"resolvedImage":n=sr.fromString(n.toString());break;case"padding":n=ln.parse(n);break;case"colorArray":n=Zi.parse(n);break;case"numberArray":n=Bn.parse(n);break;default:$t(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return na(n,o.default,t.default)}yr.register(fs,{error:[{kind:"error"},[Bt],(o,[t])=>{throw new hi(t.evaluate(o))}],typeof:[Bt,[Dt],(o,[t])=>ui(wt(t.evaluate(o)))],"to-rgba":[Xn(Qe,4),[yn],(o,[t])=>{let[n,c,d,_]=t.evaluate(o).rgb;return[255*n,255*c,255*d,_]}],rgb:[yn,[Qe,Qe,Qe],Qp],rgba:[yn,[Qe,Qe,Qe,Qe],Qp],has:{type:zt,overloads:[[[Bt],(o,[t])=>ed(t.evaluate(o),o.properties())],[[Bt,Jo],(o,[t,n])=>ed(t.evaluate(o),n.evaluate(o))]]},get:{type:Dt,overloads:[[[Bt],(o,[t])=>uh(t.evaluate(o),o.properties())],[[Bt,Jo],(o,[t,n])=>uh(t.evaluate(o),n.evaluate(o))]]},"feature-state":[Dt,[Bt],(o,[t])=>uh(t.evaluate(o),o.featureState||{})],properties:[Jo,[],o=>o.properties()],"geometry-type":[Bt,[],o=>o.geometryType()],id:[Dt,[],o=>o.id()],zoom:[Qe,[],o=>o.globals.zoom],"heatmap-density":[Qe,[],o=>o.globals.heatmapDensity||0],elevation:[Qe,[],o=>o.globals.elevation||0],"line-progress":[Qe,[],o=>o.globals.lineProgress||0],accumulated:[Dt,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Qe,Ra(Qe),(o,t)=>{let n=0;for(let c of t)n+=c.evaluate(o);return n}],"*":[Qe,Ra(Qe),(o,t)=>{let n=1;for(let c of t)n*=c.evaluate(o);return n}],"-":{type:Qe,overloads:[[[Qe,Qe],(o,[t,n])=>t.evaluate(o)-n.evaluate(o)],[[Qe],(o,[t])=>-t.evaluate(o)]]},"/":[Qe,[Qe,Qe],(o,[t,n])=>t.evaluate(o)/n.evaluate(o)],"%":[Qe,[Qe,Qe],(o,[t,n])=>t.evaluate(o)%n.evaluate(o)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(o,[t,n])=>Math.pow(t.evaluate(o),n.evaluate(o))],sqrt:[Qe,[Qe],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[Qe,[Qe],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[Qe,[Qe],(o,[t])=>Math.log(t.evaluate(o))],log2:[Qe,[Qe],(o,[t])=>Math.log(t.evaluate(o))/Math.LN2],sin:[Qe,[Qe],(o,[t])=>Math.sin(t.evaluate(o))],cos:[Qe,[Qe],(o,[t])=>Math.cos(t.evaluate(o))],tan:[Qe,[Qe],(o,[t])=>Math.tan(t.evaluate(o))],asin:[Qe,[Qe],(o,[t])=>Math.asin(t.evaluate(o))],acos:[Qe,[Qe],(o,[t])=>Math.acos(t.evaluate(o))],atan:[Qe,[Qe],(o,[t])=>Math.atan(t.evaluate(o))],min:[Qe,Ra(Qe),(o,t)=>Math.min(...t.map(n=>n.evaluate(o)))],max:[Qe,Ra(Qe),(o,t)=>Math.max(...t.map(n=>n.evaluate(o)))],abs:[Qe,[Qe],(o,[t])=>Math.abs(t.evaluate(o))],round:[Qe,[Qe],(o,[t])=>{let n=t.evaluate(o);return n<0?-Math.round(-n):Math.round(n)}],floor:[Qe,[Qe],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[Qe,[Qe],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[zt,[Bt,Dt],(o,[t,n])=>o.properties()[t.value]===n.value],"filter-id-==":[zt,[Dt],(o,[t])=>o.id()===t.value],"filter-type-==":[zt,[Bt],(o,[t])=>o.geometryType()===t.value],"filter-<":[zt,[Bt,Dt],(o,[t,n])=>{let c=o.properties()[t.value],d=n.value;return typeof c==typeof d&&c<d}],"filter-id-<":[zt,[Dt],(o,[t])=>{let n=o.id(),c=t.value;return typeof n==typeof c&&n<c}],"filter->":[zt,[Bt,Dt],(o,[t,n])=>{let c=o.properties()[t.value],d=n.value;return typeof c==typeof d&&c>d}],"filter-id->":[zt,[Dt],(o,[t])=>{let n=o.id(),c=t.value;return typeof n==typeof c&&n>c}],"filter-<=":[zt,[Bt,Dt],(o,[t,n])=>{let c=o.properties()[t.value],d=n.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[zt,[Dt],(o,[t])=>{let n=o.id(),c=t.value;return typeof n==typeof c&&n<=c}],"filter->=":[zt,[Bt,Dt],(o,[t,n])=>{let c=o.properties()[t.value],d=n.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[zt,[Dt],(o,[t])=>{let n=o.id(),c=t.value;return typeof n==typeof c&&n>=c}],"filter-has":[zt,[Dt],(o,[t])=>t.value in o.properties()],"filter-has-id":[zt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[zt,[Xn(Bt)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[zt,[Xn(Dt)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[zt,[Bt,Xn(Dt)],(o,[t,n])=>n.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[zt,[Bt,Xn(Dt)],(o,[t,n])=>(function(c,d,_,y){for(;_<=y;){let b=_+y>>1;if(d[b]===c)return!0;d[b]>c?y=b-1:_=b+1}return!1})(o.properties()[t.value],n.value,0,n.value.length-1)],all:{type:zt,overloads:[[[zt,zt],(o,[t,n])=>t.evaluate(o)&&n.evaluate(o)],[Ra(zt),(o,t)=>{for(let n of t)if(!n.evaluate(o))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],(o,[t,n])=>t.evaluate(o)||n.evaluate(o)],[Ra(zt),(o,t)=>{for(let n of t)if(n.evaluate(o))return!0;return!1}]]},"!":[zt,[zt],(o,[t])=>!t.evaluate(o)],"is-supported-script":[zt,[Bt],(o,[t])=>{let n=o.globals&&o.globals.isSupportedScript;return!n||n(t.evaluate(o))}],upcase:[Bt,[Bt],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[Bt,[Bt],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[Bt,Ra(Dt),(o,t)=>t.map(n=>At(n.evaluate(o))).join("")],"resolved-locale":[Bt,[sc],(o,[t])=>t.evaluate(o).resolvedLocale()]});class ph{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new Hu,this._defaultValue=n?(function(c){if(c.type==="color"&&gl(c.default))return new Ut(0,0,0,0);switch(c.type){case"color":return Ut.parse(c.default)||null;case"padding":return ln.parse(c.default)||null;case"numberArray":return Bn.parse(c.default)||null;case"colorArray":return Zi.parse(c.default)||null;case"variableAnchorOffsetCollection":return jn.parse(c.default)||null;case"projectionDefinition":return Pn.parse(c.default)||null;default:return c.default===void 0?null:c.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,c,d,_,y){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,n,c,d,_,y){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new hi(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Ec(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in fs}function _l(o,t){let n=new ps(fs,Cc,[],t?(function(d){let _={color:yn,string:Bt,number:Qe,enum:Bt,boolean:zt,formatted:Yo,padding:lc,numberArray:ss,colorArray:oo,projectionDefinition:Sa,resolvedImage:Ri,variableAnchorOffsetCollection:cc};return d.type==="array"?Xn(_[d.value]||Dt,d.length):_[d.type]})(t):void 0),c=n.parse(o,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?td(new ph(c,t)):gs(n.errors)}class yl{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!fl(n.expression),this.globalStateRefs=bl(n.expression)}evaluateWithoutErrorHandling(t,n,c,d,_,y){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,d,_,y)}evaluate(t,n,c,d,_,y){return this._styleExpression.evaluate(t,n,c,d,_,y)}}class dh{constructor(t,n,c,d){this.kind=t,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!fl(n.expression),this.globalStateRefs=bl(n.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,n,c,d,_,y){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,d,_,y)}evaluate(t,n,c,d,_,y){return this._styleExpression.evaluate(t,n,c,d,_,y)}interpolationFactor(t,n,c){return this.interpolationType?vn.interpolationFactor(this.interpolationType,t,n,c):0}}function ad(o,t){let n=_l(o,t);if(n.result==="error")return n;let c=n.value.expression,d=Pc(c);if(!d&&!ia(t))return gs([new Ci("","data expressions not supported")]);let _=Mc(c,["zoom"]);if(!_&&!id(t))return gs([new Ci("","zoom expressions not supported")]);let y=xl(c);return y||_?y instanceof Ci?gs([y]):y instanceof vn&&!hh(t)?gs([new Ci("",'"interpolate" expressions cannot be used with this property')]):td(y?new dh(d?"camera":"composite",n.value,y.labels,y instanceof vn?y.interpolation:void 0):new yl(d?"constant":"source",n.value)):gs([new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class vl{constructor(t,n){this._parameters=t,this._specification=n,Cn(this,nd(this._parameters,this._specification))}static deserialize(t){return new vl(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function xl(o){let t=null;if(o instanceof nl)t=xl(o.result);else if(o instanceof sl){for(let n of o.args)if(t=xl(n),t)break}else(o instanceof zi||o instanceof vn)&&o.input instanceof yr&&o.input.name==="zoom"&&(t=o);return t instanceof Ci||o.eachChild(n=>{let c=xl(n);c instanceof Ci?t=c:!t&&c?t=new Ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function bl(o,t=new Set){return o instanceof ml&&t.add(o.key),o.eachChild(n=>{bl(n,t)}),t}function Ac(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(let t of o.slice(1))if(!Ac(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let mh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function za(o){if(o==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ac(o)||(o=Oa(o));let t=_l(o,mh);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,c,d)=>t.value.evaluate(n,c,{},d),needGeometry:kc(o),getGlobalStateRefs:()=>bl(t.value.expression)}}function fh(o,t){return o<t?-1:o>t?1:0}function kc(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let t=1;t<o.length;t++)if(kc(o[t]))return!0;return!1}function Oa(o){if(!o)return!0;let t=o[0];return o.length<=1?t!=="any":t==="=="?gh(o[1],o[2],"=="):t==="!="?Lc(gh(o[1],o[2],"==")):t==="<"||t===">"||t==="<="||t===">="?gh(o[1],o[2],t):t==="any"?(n=o.slice(1),["any"].concat(n.map(Oa))):t==="all"?["all"].concat(o.slice(1).map(Oa)):t==="none"?["all"].concat(o.slice(1).map(Oa).map(Lc)):t==="in"?sd(o[1],o.slice(2)):t==="!in"?Lc(sd(o[1],o.slice(2))):t==="has"?ld(o[1]):t!=="!has"||Lc(ld(o[1]));var n}function gh(o,t,n){switch(o){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,o,t]}}function sd(o,t){if(t.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",o,["literal",t.sort(fh)]]:["filter-in-small",o,["literal",t]]}}function ld(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Lc(o){return["!",o]}function _h(o){let t=typeof o;if(t==="number"||t==="boolean"||t==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let d="[";for(let _ of o)d+=`${_h(_)},`;return`${d}]`}let n=Object.keys(o).sort(),c="{";for(let d=0;d<n.length;d++)c+=`${JSON.stringify(n[d])}:${_h(o[n[d]])},`;return`${c}}`}function Kf(o){let t="";for(let n of Tt)t+=`/${_h(o[n])}`;return t}function yh(o){let t=o.value;return t?[new Ge(o.key,t,"constants have been deprecated as of v8")]:[]}function Pi(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function co(o){if(Array.isArray(o))return o.map(co);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){let t={};for(let n in o)t[n]=co(o[n]);return t}return Pi(o)}function vr(o){let t=o.key,n=o.value,c=o.valueSpec||{},d=o.objectElementValidators||{},_=o.style,y=o.styleSpec,b=o.validateSpec,w=[],T=$t(n);if(T!=="object")return[new Ge(t,n,`object expected, ${T} found`)];for(let M in n){let k=M.split(".")[0],z=hs(c,k)||c["*"],B;if(hs(d,k))B=d[k];else if(hs(c,k))B=b;else if(d["*"])B=d["*"];else{if(!c["*"]){w.push(new Ge(t,n[M],`unknown property "${M}"`));continue}B=b}w=w.concat(B({key:(t&&`${t}.`)+M,value:n[M],valueSpec:z,style:_,styleSpec:y,object:n,objectKey:M,validateSpec:b},n))}for(let M in c)d[M]||c[M].required&&c[M].default===void 0&&n[M]===void 0&&w.push(new Ge(t,n,`missing required property "${M}"`));return w}function Dc(o){let t=o.value,n=o.valueSpec,c=o.style,d=o.styleSpec,_=o.key,y=o.arrayElementValidator||o.validateSpec;if($t(t)!=="array")return[new Ge(_,t,`array expected, ${$t(t)} found`)];if(n.length&&t.length!==n.length)return[new Ge(_,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ge(_,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let b={type:n.value,values:n.values};d.$version<7&&(b.function=n.function),$t(n.value)==="object"&&(b=n.value);let w=[];for(let T=0;T<t.length;T++)w=w.concat(y({array:t,arrayIndex:T,value:t[T],valueSpec:b,validateSpec:o.validateSpec,style:c,styleSpec:d,key:`${_}[${T}]`}));return w}function wl(o){let t=o.key,n=o.value,c=o.valueSpec,d=$t(n);return d==="number"&&n!=n&&(d="NaN"),d!=="number"?[new Ge(t,n,`number expected, ${d} found`)]:"minimum"in c&&n<c.minimum?[new Ge(t,n,`${n} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&n>c.maximum?[new Ge(t,n,`${n} is greater than the maximum value ${c.maximum}`)]:[]}function cd(o){let t=o.valueSpec,n=Pi(o.value.type),c,d,_,y={},b=n!=="categorical"&&o.value.property===void 0,w=!b,T=$t(o.value.stops)==="array"&&$t(o.value.stops[0])==="array"&&$t(o.value.stops[0][0])==="object",M=vr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(B){if(n==="identity")return[new Ge(B.key,B.value,'identity function may not have a "stops" property')];let j=[],$=B.value;return j=j.concat(Dc({key:B.key,value:$,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:k})),$t($)==="array"&&$.length===0&&j.push(new Ge(B.key,$,"array must have at least one stop")),j},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return n==="identity"&&b&&M.push(new Ge(o.key,o.value,'missing required property "property"')),n==="identity"||o.value.stops||M.push(new Ge(o.key,o.value,'missing required property "stops"')),n==="exponential"&&o.valueSpec.expression&&!hh(o.valueSpec)&&M.push(new Ge(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(w&&!ia(o.valueSpec)?M.push(new Ge(o.key,o.value,"property functions not supported")):b&&!id(o.valueSpec)&&M.push(new Ge(o.key,o.value,"zoom functions not supported"))),n!=="categorical"&&!T||o.value.property!==void 0||M.push(new Ge(o.key,o.value,'"property" property is required')),M;function k(B){let j=[],$=B.value,Z=B.key;if($t($)!=="array")return[new Ge(Z,$,`array expected, ${$t($)} found`)];if($.length!==2)return[new Ge(Z,$,`array length 2 expected, length ${$.length} found`)];if(T){if($t($[0])!=="object")return[new Ge(Z,$,`object expected, ${$t($[0])} found`)];if($[0].zoom===void 0)return[new Ge(Z,$,"object stop key must have zoom")];if($[0].value===void 0)return[new Ge(Z,$,"object stop key must have value")];if(_&&_>Pi($[0].zoom))return[new Ge(Z,$[0].zoom,"stop zoom values must appear in ascending order")];Pi($[0].zoom)!==_&&(_=Pi($[0].zoom),d=void 0,y={}),j=j.concat(vr({key:`${Z}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:wl,value:z}}))}else j=j.concat(z({key:`${Z}[0]`,value:$[0],validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},$));return Ec(co($[1]))?j.concat([new Ge(`${Z}[1]`,$[1],"expressions are not allowed in function stops.")]):j.concat(B.validateSpec({key:`${Z}[1]`,value:$[1],valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function z(B,j){let $=$t(B.value),Z=Pi(B.value),Q=B.value!==null?B.value:j;if(c){if($!==c)return[new Ge(B.key,Q,`${$} stop domain type must match previous stop domain type ${c}`)]}else c=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new Ge(B.key,Q,"stop domain value must be a number, string, or boolean")];if($!=="number"&&n!=="categorical"){let de=`number expected, ${$} found`;return ia(t)&&n===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ge(B.key,Q,de)]}return n!=="categorical"||$!=="number"||isFinite(Z)&&Math.floor(Z)===Z?n!=="categorical"&&$==="number"&&d!==void 0&&Z<d?[new Ge(B.key,Q,"stop domain values must appear in ascending order")]:(d=Z,n==="categorical"&&Z in y?[new Ge(B.key,Q,"stop domain values must be unique")]:(y[Z]=!0,[])):[new Ge(B.key,Q,`integer expected, found ${Z}`)]}}function Fa(o){let t=(o.expressionContext==="property"?ad:_l)(co(o.value),o.valueSpec);if(t.result==="error")return t.value.map(c=>new Ge(`${o.key}${c.key}`,o.value,c.message));let n=t.value.expression||t.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!n.outputDefined())return[new Ge(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!fl(n))return[new Ge(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!fl(n))return[new Ge(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Mc(n,["zoom","feature-state"]))return[new Ge(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Pc(n))return[new Ge(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Rc(o){let t=o.key,n=o.value,c=$t(n);return c!=="string"?[new Ge(t,n,`color expected, ${c} found`)]:Ut.parse(String(n))?[]:[new Ge(t,n,`color expected, "${n}" found`)]}function Ao(o){let t=o.key,n=o.value,c=o.valueSpec,d=[];return Array.isArray(c.values)?c.values.indexOf(Pi(n))===-1&&d.push(new Ge(t,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(Pi(n))===-1&&d.push(new Ge(t,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),d}function vh(o){return Ac(co(o.value))?Fa(Cn({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ud(o)}function ud(o){let t=o.value,n=o.key;if($t(t)!=="array")return[new Ge(n,t,`array expected, ${$t(t)} found`)];let c=o.styleSpec,d,_=[];if(t.length<1)return[new Ge(n,t,"filter array must have at least 1 element")];switch(_=_.concat(Ao({key:`${n}[0]`,value:t[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Pi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Pi(t[1])==="$type"&&_.push(new Ge(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new Ge(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=$t(t[1]),d!=="string"&&_.push(new Ge(`${n}[1]`,t[1],`string expected, ${d} found`)));for(let y=2;y<t.length;y++)d=$t(t[y]),Pi(t[1])==="$type"?_=_.concat(Ao({key:`${n}[${y}]`,value:t[y],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new Ge(`${n}[${y}]`,t[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)_=_.concat(ud({key:`${n}[${y}]`,value:t[y],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":d=$t(t[1]),t.length!==2?_.push(new Ge(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new Ge(`${n}[1]`,t[1],`string expected, ${d} found`))}return _}function hd(o,t){let n=o.key,c=o.validateSpec,d=o.style,_=o.styleSpec,y=o.value,b=o.objectKey,w=_[`${t}_${o.layerType}`];if(!w)return[];let T=b.match(/^(.*)-transition$/);if(t==="paint"&&T&&w[T[1]]&&w[T[1]].transition)return c({key:n,value:y,valueSpec:_.transition,style:d,styleSpec:_});let M=o.valueSpec||w[b];if(!M)return[new Ge(n,y,`unknown property "${b}"`)];let k;if($t(y)==="string"&&ia(M)&&!M.tokens&&(k=/^{([^}]+)}$/.exec(y)))return[new Ge(n,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];let z=[];return o.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&z.push(new Ge(n,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&gl(co(y))&&Pi(y.type)==="identity"&&z.push(new Ge(n,y,'"text-font" does not support identity functions'))),z.concat(c({key:o.key,value:y,valueSpec:M,style:d,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b}))}function pd(o){return hd(o,"paint")}function dd(o){return hd(o,"layout")}function md(o){let t=[],n=o.value,c=o.key,d=o.style,_=o.styleSpec;if($t(n)!=="object")return[new Ge(c,n,`object expected, ${$t(n)} found`)];n.type||n.ref||t.push(new Ge(c,n,'either "type" or "ref" is required'));let y=Pi(n.type),b=Pi(n.ref);if(n.id){let w=Pi(n.id);for(let T=0;T<o.arrayIndex;T++){let M=d.layers[T];Pi(M.id)===w&&t.push(new Ge(c,n.id,`duplicate layer id "${n.id}", previously used at line ${M.id.__line__}`))}}if("ref"in n){let w;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&t.push(new Ge(c,n[T],`"${T}" is prohibited for ref layers`))}),d.layers.forEach(T=>{Pi(T.id)===b&&(w=T)}),w?w.ref?t.push(new Ge(c,n.ref,"ref cannot reference another ref layer")):y=Pi(w.type):t.push(new Ge(c,n.ref,`ref layer "${b}" not found`))}else if(y!=="background")if(n.source){let w=d.sources&&d.sources[n.source],T=w&&Pi(w.type);w?T==="vector"&&y==="raster"?t.push(new Ge(c,n.source,`layer "${n.id}" requires a raster source`)):T!=="raster-dem"&&y==="hillshade"||T!=="raster-dem"&&y==="color-relief"?t.push(new Ge(c,n.source,`layer "${n.id}" requires a raster-dem source`)):T==="raster"&&y!=="raster"?t.push(new Ge(c,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?t.push(new Ge(c,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]||T==="geojson"&&w.lineMetrics||t.push(new Ge(c,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ge(c,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ge(c,n.source,`source "${n.source}" not found`))}else t.push(new Ge(c,n,'missing required property "source"'));return t=t.concat(vr({key:c,value:n,valueSpec:_.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${c}.type`,value:n.type,valueSpec:_.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:n,objectKey:"type"}),filter:vh,layout:w=>vr({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":T=>dd(Cn({layerType:y},T))}}),paint:w=>vr({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":T=>pd(Cn({layerType:y},T))}})}})),t}function Br(o){let t=o.value,n=o.key,c=$t(t);return c!=="string"?[new Ge(n,t,`string expected, ${c} found`)]:[]}let _s={promoteId:function({key:o,value:t}){if($t(t)==="string")return Br({key:o,value:t});{let n=[];for(let c in t)n.push(...Br({key:`${o}.${c}`,value:t[c]}));return n}}};function Jn(o){let t=o.value,n=o.key,c=o.styleSpec,d=o.style,_=o.validateSpec;if(!t.type)return[new Ge(n,t,'"type" is required')];let y=Pi(t.type),b;switch(y){case"vector":case"raster":return b=vr({key:n,value:t,valueSpec:c[`source_${y.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:_s,validateSpec:_}),b;case"raster-dem":return b=(function(w){var T;let M=(T=w.sourceName)!==null&&T!==void 0?T:"",k=w.value,z=w.styleSpec,B=z.source_raster_dem,j=w.style,$=[],Z=$t(k);if(k===void 0)return $;if(Z!=="object")return $.push(new Ge("source_raster_dem",k,`object expected, ${Z} found`)),$;let Q=Pi(k.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],oe=w.value.encoding?`"${w.value.encoding}"`:"Default";for(let ce in k)!Q&&de.includes(ce)?$.push(new Ge(ce,k[ce],`In "${M}": "${ce}" is only valid when "encoding" is set to "custom". ${oe} encoding found`)):B[ce]?$=$.concat(w.validateSpec({key:ce,value:k[ce],valueSpec:B[ce],validateSpec:w.validateSpec,style:j,styleSpec:z})):$.push(new Ge(ce,k[ce],`unknown property "${ce}"`));return $})({sourceName:n,value:t,style:o.style,styleSpec:c,validateSpec:_}),b;case"geojson":if(b=vr({key:n,value:t,valueSpec:c.source_geojson,style:d,styleSpec:c,validateSpec:_,objectElementValidators:_s}),t.cluster)for(let w in t.clusterProperties){let[T,M]=t.clusterProperties[w],k=typeof T=="string"?[T,["accumulated"],["get",w]]:T;b.push(...Fa({key:`${n}.${w}.map`,value:M,expressionContext:"cluster-map"})),b.push(...Fa({key:`${n}.${w}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return b;case"video":return vr({key:n,value:t,valueSpec:c.source_video,style:d,validateSpec:_,styleSpec:c});case"image":return vr({key:n,value:t,valueSpec:c.source_image,style:d,validateSpec:_,styleSpec:c});case"canvas":return[new Ge(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ao({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ys(o){let t=o.value,n=o.styleSpec,c=n.light,d=o.style,_=[],y=$t(t);if(t===void 0)return _;if(y!=="object")return _=_.concat([new Ge("light",t,`object expected, ${y} found`)]),_;for(let b in t){let w=b.match(/^(.*)-transition$/);_=_.concat(w&&c[w[1]]&&c[w[1]].transition?o.validateSpec({key:b,value:t[b],valueSpec:n.transition,validateSpec:o.validateSpec,style:d,styleSpec:n}):c[b]?o.validateSpec({key:b,value:t[b],valueSpec:c[b],validateSpec:o.validateSpec,style:d,styleSpec:n}):[new Ge(b,t[b],`unknown property "${b}"`)])}return _}function xh(o){let t=o.value,n=o.styleSpec,c=n.sky,d=o.style,_=$t(t);if(t===void 0)return[];if(_!=="object")return[new Ge("sky",t,`object expected, ${_} found`)];let y=[];for(let b in t)y=y.concat(c[b]?o.validateSpec({key:b,value:t[b],valueSpec:c[b],style:d,styleSpec:n}):[new Ge(b,t[b],`unknown property "${b}"`)]);return y}function fd(o){let t=o.value,n=o.styleSpec,c=n.terrain,d=o.style,_=[],y=$t(t);if(t===void 0)return _;if(y!=="object")return _=_.concat([new Ge("terrain",t,`object expected, ${y} found`)]),_;for(let b in t)_=_.concat(c[b]?o.validateSpec({key:b,value:t[b],valueSpec:c[b],validateSpec:o.validateSpec,style:d,styleSpec:n}):[new Ge(b,t[b],`unknown property "${b}"`)]);return _}function gd(o){let t=[],n=o.value,c=o.key;if(Array.isArray(n)){let d=[],_=[];for(let y in n)n[y].id&&d.includes(n[y].id)&&t.push(new Ge(c,n,`all the sprites' ids must be unique, but ${n[y].id} is duplicated`)),d.push(n[y].id),n[y].url&&_.includes(n[y].url)&&t.push(new Ge(c,n,`all the sprites' URLs must be unique, but ${n[y].url} is duplicated`)),_.push(n[y].url),t=t.concat(vr({key:`${c}[${y}]`,value:n[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return t}return Br({key:c,value:n})}function vs(o){return t=o.value,t&&t.constructor===Object?[]:[new Ge(o.key,o.value,`object expected, ${$t(o.value)} found`)];var t}let bh={"*":()=>[],array:Dc,boolean:function(o){let t=o.value,n=o.key,c=$t(t);return c!=="boolean"?[new Ge(n,t,`boolean expected, ${c} found`)]:[]},number:wl,color:Rc,constants:yh,enum:Ao,filter:vh,function:cd,layer:md,object:vr,source:Jn,light:ys,sky:xh,terrain:fd,projection:function(o){let t=o.value,n=o.styleSpec,c=n.projection,d=o.style,_=$t(t);if(t===void 0)return[];if(_!=="object")return[new Ge("projection",t,`object expected, ${_} found`)];let y=[];for(let b in t)y=y.concat(c[b]?o.validateSpec({key:b,value:t[b],valueSpec:c[b],style:d,styleSpec:n}):[new Ge(b,t[b],`unknown property "${b}"`)]);return y},projectionDefinition:function(o){let t=o.key,n=o.value;n=n instanceof String?n.valueOf():n;let c=$t(n);return c!=="array"||(function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"})(n)||(function(d){return!!["interpolate","step","literal"].includes(d[0])})(n)?["array","string"].includes(c)?[]:[new Ge(t,n,`projection expected, invalid type "${c}" found`)]:[new Ge(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Br,formatted:function(o){return Br(o).length===0?[]:Fa(o)},resolvedImage:function(o){return Br(o).length===0?[]:Fa(o)},padding:function(o){let t=o.key,n=o.value;if($t(n)==="array"){if(n.length<1||n.length>4)return[new Ge(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];let c={type:"number"},d=[];for(let _=0;_<n.length;_++)d=d.concat(o.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:o.validateSpec,valueSpec:c}));return d}return wl({key:t,value:n,valueSpec:{}})},numberArray:function(o){let t=o.key,n=o.value;if($t(n)==="array"){let c={type:"number"};if(n.length<1)return[new Ge(t,n,"array length at least 1 expected, length 0 found")];let d=[];for(let _=0;_<n.length;_++)d=d.concat(o.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:o.validateSpec,valueSpec:c}));return d}return wl({key:t,value:n,valueSpec:{}})},colorArray:function(o){let t=o.key,n=o.value;if($t(n)==="array"){if(n.length<1)return[new Ge(t,n,"array length at least 1 expected, length 0 found")];let c=[];for(let d=0;d<n.length;d++)c=c.concat(Rc({key:`${t}[${d}]`,value:n[d]}));return c}return Rc({key:t,value:n})},variableAnchorOffsetCollection:function(o){let t=o.key,n=o.value,c=$t(n),d=o.styleSpec;if(c!=="array"||n.length<1||n.length%2!=0)return[new Ge(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let y=0;y<n.length;y+=2)_=_.concat(Ao({key:`${t}[${y}]`,value:n[y],valueSpec:d.layout_symbol["text-anchor"]})),_=_.concat(Dc({key:`${t}[${y+1}]`,value:n[y+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:d}));return _},sprite:gd,state:vs};function xs(o){let t=o.value,n=o.valueSpec,c=o.styleSpec;return o.validateSpec=xs,n.expression&&gl(Pi(t))?cd(o):n.expression&&Ec(co(t))?Fa(o):n.type&&bh[n.type]?bh[n.type](o):vr(Cn({},o,{valueSpec:n.type?c[n.type]:n}))}function _d(o){let t=o.value,n=o.key,c=Br(o);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new Ge(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new Ge(n,t,'"glyphs" url must include a "{range}" token'))),c}function Yn(o,t=ve){let n=[];return n=n.concat(xs({key:"",value:o,valueSpec:t.$root,styleSpec:t,style:o,validateSpec:xs,objectElementValidators:{glyphs:_d,"*":()=>[]}})),o.constants&&(n=n.concat(yh({key:"constants",value:o.constants}))),bs(n)}function jr(o){return function(t){return o(ha(Xt({},t),{validateSpec:xs}))}}function bs(o){return[].concat(o).sort((t,n)=>t.line-n.line)}function Ur(o){return function(...t){return bs(o.apply(this,t))}}Yn.source=Ur(jr(Jn)),Yn.sprite=Ur(jr(gd)),Yn.glyphs=Ur(jr(_d)),Yn.light=Ur(jr(ys)),Yn.sky=Ur(jr(xh)),Yn.terrain=Ur(jr(fd)),Yn.state=Ur(jr(vs)),Yn.layer=Ur(jr(md)),Yn.filter=Ur(jr(vh)),Yn.paintProperty=Ur(jr(pd)),Yn.layoutProperty=Ur(jr(dd));let ws=Yn,Xf=ws.light,Sl=ws.sky,Jf=ws.paintProperty,Yf=ws.layoutProperty;function Il(o,t){let n=!1;if(t&&t.length)for(let c of t)o.fire(new De(new Error(c.message))),n=!0;return n}class Tl{constructor(t,n,c){let d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(n=y[1])+2*(c=y[2]);for(let w=0;w<this.d*this.d;w++){let T=y[3+w],M=y[3+w+1];d.push(T===M?null:y.subarray(T,M))}let b=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],b),this.bboxes=y.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*c;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=c,this.scale=n/t,this.uid=0;let _=c/n*t;this.min=-_,this.max=t+_}insert(t,n,c,d,_){this._forEachCell(n,c,d,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,c,d,_,y){this.cells[_].push(y)}query(t,n,c,d,_){let y=this.min,b=this.max;if(t<=y&&n<=y&&b<=c&&b<=d&&!_)return Array.prototype.slice.call(this.keys);{let w=[];return this._forEachCell(t,n,c,d,this._queryCell,w,{},_),w}}_queryCell(t,n,c,d,_,y,b,w){let T=this.cells[_];if(T!==null){let M=this.keys,k=this.bboxes;for(let z=0;z<T.length;z++){let B=T[z];if(b[B]===void 0){let j=4*B;(w?w(k[j+0],k[j+1],k[j+2],k[j+3]):t<=k[j+2]&&n<=k[j+3]&&c>=k[j+0]&&d>=k[j+1])?(b[B]=!0,y.push(M[B])):b[B]=!1}}}}_forEachCell(t,n,c,d,_,y,b,w){let T=this._convertToCellCoord(t),M=this._convertToCellCoord(n),k=this._convertToCellCoord(c),z=this._convertToCellCoord(d);for(let B=T;B<=k;B++)for(let j=M;j<=z;j++){let $=this.d*j+B;if((!w||w(this._convertFromCellCoord(B),this._convertFromCellCoord(j),this._convertFromCellCoord(B+1),this._convertFromCellCoord(j+1)))&&_.call(this,t,n,c,d,$,y,b,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,n=3+this.cells.length+1+1,c=0;for(let y=0;y<this.cells.length;y++)c+=this.cells[y].length;let d=new Int32Array(n+c+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let _=n;for(let y=0;y<t.length;y++){let b=t[y];d[3+y]=_,d.set(b,_),_+=b.length}return d[3+t.length]=_,d.set(this.keys,_),_+=this.keys.length,d[3+t.length+1]=_,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer}static serialize(t,n){let c=t.toArrayBuffer();return n&&n.push(c),{buffer:c}}static deserialize(t){return new Tl(t.buffer)}}let Nr={};function tt(o,t,n={}){if(Nr[o])throw new Error(`${o} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:o,writeable:!1}),Nr[o]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}tt("Object",Object),tt("Set",Set),tt("TransferableGridIndex",Tl),tt("Color",Ut),tt("Error",Error),tt("AJAXError",ne),tt("ResolvedImage",sr),tt("StylePropertyFunction",vl),tt("StyleExpression",ph,{omit:["_evaluator"]}),tt("ZoomDependentExpression",dh),tt("ZoomConstantExpression",yl),tt("CompoundExpression",yr,{omit:["_evaluate"]});for(let o in fs)fs[o]._classRegistryKey||tt(`Expression_${o}`,fs[o]);function wh(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function zc(o){return o.$name||o.constructor._classRegistryKey}function Sh(o){return!(function(t){if(t===null||typeof t!="object")return!1;let n=zc(t);return!(!n||n==="Object")})(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||wh(o)||no(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function Ss(o,t){if(Sh(o))return(wh(o)||no(o))&&t&&t.push(o),ArrayBuffer.isView(o)&&t&&t.push(o.buffer),o instanceof ImageData&&t&&t.push(o.data.buffer),o;if(Array.isArray(o)){let _=[];for(let y of o)_.push(Ss(y,t));return _}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);let n=zc(o);if(!n)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Nr[n])throw new Error(`${n} is not registered.`);let{klass:c}=Nr[n],d=c.serialize?c.serialize(o,t):{};if(c.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let _ in o){if(!o.hasOwnProperty(_)||Nr[n].omit.indexOf(_)>=0)continue;let y=o[_];d[_]=Nr[n].shallow.indexOf(_)>=0?y:Ss(y,t)}o instanceof Error&&(d.message=o.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(d.$name=n),d}function Ba(o){if(Sh(o))return o;if(Array.isArray(o))return o.map(Ba);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);let t=zc(o)||"Object";if(!Nr[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:n}=Nr[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(o);let c=Object.create(n.prototype);for(let d of Object.keys(o)){if(d==="$name")continue;let _=o[d];c[d]=Nr[t].shallow.indexOf(d)>=0?_:Ba(_)}return c}class Oc{constructor(){this.first=!0}update(t,n){let c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}let qt={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Hangul Syllables":o=>o>=44032&&o<=55215,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Fc(o){for(let t of o)if(Th(t.charCodeAt(0)))return!0;return!1}function Qf(o){for(let t of o)if(!yd(t.charCodeAt(0)))return!1;return!0}function Bc(o){let t=o.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}let eg=Bc(["Arab","Dupl","Mong","Ougr","Syrc"]);function yd(o){return!eg.test(String.fromCodePoint(o))}let Ih=Bc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Th(o){return!(o!==746&&o!==747&&(o<4352||!(qt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||qt["CJK Compatibility"](o)||qt["CJK Strokes"](o)||!(!qt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||qt["Enclosed CJK Letters and Months"](o)||qt["Ideographic Description Characters"](o)||qt.Kanbun(o)||qt.Katakana(o)&&o!==12540||!(!qt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!qt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||qt["Vertical Forms"](o)||qt["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||Ih.test(String.fromCodePoint(o)))))}function vd(o){return!(Th(o)||(function(t){return!!(qt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||qt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||qt["Letterlike Symbols"](t)||qt["Number Forms"](t)||qt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||qt["Control Pictures"](t)&&t!==9251||qt["Optical Character Recognition"](t)||qt["Enclosed Alphanumerics"](t)||qt["Geometric Shapes"](t)||qt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||qt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||qt["CJK Symbols and Punctuation"](t)||qt.Katakana(t)||qt["Private Use Area"](t)||qt["CJK Compatibility Forms"](t)||qt["Small Form Variants"](t)||qt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(o))}let xd=Bc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ch(o){return xd.test(String.fromCodePoint(o))}function bd(o,t){return!(!t&&Ch(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||qt.Khmer(o))}function wd(o){for(let t of o)if(Ch(t.charCodeAt(0)))return!0;return!1}let Vr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){if(Vr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(o,t){return r(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(o.pluginStatus!=="loading")return this.setState(o),o;let n=o.pluginURL,c=new Promise(_=>{this.loadScriptResolve=_});t(n);let d=new Promise(_=>setTimeout(()=>_(),this.TIMEOUT));if(yield Promise.race([c,d]),this.isParsed()){let _={pluginStatus:"loaded",pluginURL:n};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)})}};class xi{constructor(t,n){this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new Oc,this.transition=n.transition||{},this.globalState=n.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Oc,this.transition={},this.globalState={})}isSupportedScript(t){return(function(n,c){for(let d of n)if(!bd(d.charCodeAt(0),c))return!1;return!0})(t,Vr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,n=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*n}}}class Is{constructor(t,n){this.property=t,this.value=n,this.expression=(function(c,d){if(gl(c))return new vl(c,d);if(Ec(c)){let _=ad(c,d);if(_.result==="error")throw new Error(_.value.map(y=>`${y.key}: ${y.message}`).join(", "));return _.value}{let _=c;return d.type==="color"&&typeof c=="string"?_=Ut.parse(c):d.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?d.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?d.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?_=jn.parse(c):d.type==="projectionDefinition"&&typeof c=="string"&&(_=Pn.parse(c)):_=Zi.parse(c):_=Bn.parse(c):_=ln.parse(c),{globalStateRefs:new Set,kind:"constant",evaluate:()=>_}}})(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,c){return this.property.possiblyEvaluate(this,t,n,c)}}class Ph{constructor(t){this.property=t,this.value=new Is(t,void 0)}transitioned(t,n){return new Mh(this.property,this.value,n,_r({},t.transition,this.transition),t.now)}untransitioned(){return new Mh(this.property,this.value,null,{},0)}}class Sd{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ar(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ph(this._values[t].property)),this._values[t].value=new Is(this._values[t].property,n===null?void 0:ar(n))}getTransition(t){return ar(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ph(this._values[t].property)),this._values[t].transition=ar(n)||void 0}serialize(){let t={};for(let n of Object.keys(this._values)){let c=this.getValue(n);c!==void 0&&(t[n]=c);let d=this.getTransition(n);d!==void 0&&(t[`${n}-transition`]=d)}return t}transitioned(t,n){let c=new Eh(this._properties);for(let d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(t,n._values[d]);return c}untransitioned(){let t=new Eh(this._properties);for(let n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Mh{constructor(t,n,c,d,_){this.property=t,this.value=n,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(t,n,c){let d=t.now||0,_=this.value.possiblyEvaluate(t,n,c),y=this.prior;if(y){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return y.possiblyEvaluate(t,n,c);{let b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,n,c),_,to(b))}}return _}}class Eh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,c){let d=new jc(this._properties);for(let _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,n,c);return d}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Id{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ar(this._values[t].value)}setValue(t,n){this._values[t]=new Is(this._values[t].property,n===null?void 0:ar(n))}serialize(){let t={};for(let n of Object.keys(this._values)){let c=this.getValue(n);c!==void 0&&(t[n]=c)}return t}possiblyEvaluate(t,n,c){let d=new jc(this._properties);for(let _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,n,c);return d}}class uo{constructor(t,n,c){this.property=t,this.value=n,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,c,d){return this.property.evaluate(this.value,this.parameters,t,n,c,d)}}class jc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ut{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,c){let d=lo[this.specification.type];return d?d(t,n,c):t}}class bt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,c,d){return new uo(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},c,d)}:t.expression,n)}interpolate(t,n,c){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new uo(this,{kind:"constant",value:void 0},t.parameters);let d=lo[this.specification.type];if(d){let _=d(t.value.value,n.value.value,c);return new uo(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,n,c,d,_,y){return t.kind==="constant"?t.value:t.evaluate(n,c,d,_,y)}}class Uc extends bt{possiblyEvaluate(t,n,c,d){if(t.value===void 0)return new uo(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){let _=t.expression.evaluate(n,null,{},c,d),y=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,b=this._calculate(y,y,y,n);return new uo(this,{kind:"constant",value:b},n)}if(t.expression.kind==="camera"){let _=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new uo(this,{kind:"constant",value:_},n)}return new uo(this,t.expression,n)}evaluate(t,n,c,d,_,y){if(t.kind==="source"){let b=t.evaluate(n,c,d,_,y);return this._calculate(b,b,b,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},c,d),t.evaluate({zoom:Math.floor(n.zoom)},c,d),t.evaluate({zoom:Math.floor(n.zoom)+1},c,d),n):t.value}_calculate(t,n,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:c,to:n}}interpolate(t){return t}}class ra{constructor(t){this.specification=t}possiblyEvaluate(t,n,c,d){if(t.value!==void 0){if(t.expression.kind==="constant"){let _=t.expression.evaluate(n,null,{},c,d);return this._calculate(_,_,_,n)}return this._calculate(t.expression.evaluate(new xi(Math.floor(n.zoom-1),n)),t.expression.evaluate(new xi(Math.floor(n.zoom),n)),t.expression.evaluate(new xi(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:c,to:n}}interpolate(t){return t}}class Nc{constructor(t){this.specification=t}possiblyEvaluate(t,n,c,d){return!!t.expression.evaluate(n,null,{},c,d)}interpolate(){return!1}}class Un{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let n in t){let c=t[n];c.specification.overridable&&this.overridableProperties.push(n);let d=this.defaultPropertyValues[n]=new Is(c,void 0),_=this.defaultTransitionablePropertyValues[n]=new Ph(c);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=d.possiblyEvaluate({})}}}tt("DataDrivenProperty",bt),tt("DataConstantProperty",ut),tt("CrossFadedDataDrivenProperty",Uc),tt("CrossFadedProperty",ra),tt("ColorRampProperty",Nc);let Td="-transition";class xr extends ct{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=za(t.filter)),n.layout&&(this._unevaluatedLayout=new Id(n.layout)),n.paint)){this._transitionablePaint=new Sd(n.paint);for(let c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(let c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jc(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=za(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){let t=new Set;if(this._unevaluatedLayout)for(let n in this._unevaluatedLayout._values){let c=this._unevaluatedLayout._values[n];for(let d of c.getGlobalStateRefs())t.add(d)}for(let n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}setLayoutProperty(t,n,c={}){n!=null&&this._validate(Yf,`layers.${this.id}.layout.${t}`,t,n,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Td)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,c={}){if(n!=null&&this._validate(Jf,`layers.${this.id}.paint.${t}`,t,n,c))return!1;if(t.endsWith(Td))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{let d=this._transitionablePaint._values[t],_=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);let w=this._transitionablePaint._values[t].value;return w.isDataDriven()||y||_||this._handleOverridablePaintPropertyUpdate(t,b,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ns(t,(n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length))}_validate(t,n,c,d,_={}){return(!_||_.validate!==!1)&&Il(this,t.call(ws,{key:n,layerType:this.type,objectKey:c,value:d,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let n=this.paint.get(t);if(n instanceof uo&&ia(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let tg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cl{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ai{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Oi(o,t=1){let n=0,c=0;return{members:o.map(d=>{let _=tg[d.type].BYTES_PER_ELEMENT,y=n=Vc(n,Math.max(t,_)),b=d.components||1;return c=Math.max(c,_),n+=_*b,{name:d.name,type:d.type,components:b,offset:y}}),size:Vc(n,Math.max(c,t)),alignment:t}}function Vc(o,t){return Math.ceil(o/t)*t}class Ts extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){let c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){let d=2*t;return this.int16[d+0]=n,this.int16[d+1]=c,t}}Ts.prototype.bytesPerElement=4,tt("StructArrayLayout2i4",Ts);class Cs extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c){let d=this.length;return this.resize(d+1),this.emplace(d,t,n,c)}emplace(t,n,c,d){let _=3*t;return this.int16[_+0]=n,this.int16[_+1]=c,this.int16[_+2]=d,t}}Cs.prototype.bytesPerElement=6,tt("StructArrayLayout3i6",Cs);class Ah extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d){let _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,d)}emplace(t,n,c,d,_){let y=4*t;return this.int16[y+0]=n,this.int16[y+1]=c,this.int16[y+2]=d,this.int16[y+3]=_,t}}Ah.prototype.bytesPerElement=8,tt("StructArrayLayout4i8",Ah);class Ps extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,t,n,c,d,_,y)}emplace(t,n,c,d,_,y,b){let w=6*t;return this.int16[w+0]=n,this.int16[w+1]=c,this.int16[w+2]=d,this.int16[w+3]=_,this.int16[w+4]=y,this.int16[w+5]=b,t}}Ps.prototype.bytesPerElement=12,tt("StructArrayLayout2i4i12",Ps);class ja extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,t,n,c,d,_,y)}emplace(t,n,c,d,_,y,b){let w=4*t,T=8*t;return this.int16[w+0]=n,this.int16[w+1]=c,this.uint8[T+4]=d,this.uint8[T+5]=_,this.uint8[T+6]=y,this.uint8[T+7]=b,t}}ja.prototype.bytesPerElement=8,tt("StructArrayLayout2i4ub8",ja);class Pl extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){let c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){let d=2*t;return this.float32[d+0]=n,this.float32[d+1]=c,t}}Pl.prototype.bytesPerElement=8,tt("StructArrayLayout2f8",Pl);class $c extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y,b,w,T,M){let k=this.length;return this.resize(k+1),this.emplace(k,t,n,c,d,_,y,b,w,T,M)}emplace(t,n,c,d,_,y,b,w,T,M,k){let z=10*t;return this.uint16[z+0]=n,this.uint16[z+1]=c,this.uint16[z+2]=d,this.uint16[z+3]=_,this.uint16[z+4]=y,this.uint16[z+5]=b,this.uint16[z+6]=w,this.uint16[z+7]=T,this.uint16[z+8]=M,this.uint16[z+9]=k,t}}$c.prototype.bytesPerElement=20,tt("StructArrayLayout10ui20",$c);class Ua extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y,b,w,T,M,k,z){let B=this.length;return this.resize(B+1),this.emplace(B,t,n,c,d,_,y,b,w,T,M,k,z)}emplace(t,n,c,d,_,y,b,w,T,M,k,z,B){let j=12*t;return this.int16[j+0]=n,this.int16[j+1]=c,this.int16[j+2]=d,this.int16[j+3]=_,this.uint16[j+4]=y,this.uint16[j+5]=b,this.uint16[j+6]=w,this.uint16[j+7]=T,this.int16[j+8]=M,this.int16[j+9]=k,this.int16[j+10]=z,this.int16[j+11]=B,t}}Ua.prototype.bytesPerElement=24,tt("StructArrayLayout4i4ui4i24",Ua);class kh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c){let d=this.length;return this.resize(d+1),this.emplace(d,t,n,c)}emplace(t,n,c,d){let _=3*t;return this.float32[_+0]=n,this.float32[_+1]=c,this.float32[_+2]=d,t}}kh.prototype.bytesPerElement=12,tt("StructArrayLayout3f12",kh);class Lh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Lh.prototype.bytesPerElement=4,tt("StructArrayLayout1ul4",Lh);class Gc extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y,b,w,T){let M=this.length;return this.resize(M+1),this.emplace(M,t,n,c,d,_,y,b,w,T)}emplace(t,n,c,d,_,y,b,w,T,M){let k=10*t,z=5*t;return this.int16[k+0]=n,this.int16[k+1]=c,this.int16[k+2]=d,this.int16[k+3]=_,this.int16[k+4]=y,this.int16[k+5]=b,this.uint32[z+3]=w,this.uint16[k+8]=T,this.uint16[k+9]=M,t}}Gc.prototype.bytesPerElement=20,tt("StructArrayLayout6i1ul2ui20",Gc);class Dh extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,t,n,c,d,_,y)}emplace(t,n,c,d,_,y,b){let w=6*t;return this.int16[w+0]=n,this.int16[w+1]=c,this.int16[w+2]=d,this.int16[w+3]=_,this.int16[w+4]=y,this.int16[w+5]=b,t}}Dh.prototype.bytesPerElement=12,tt("StructArrayLayout2i2i2i12",Dh);class f extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_){let y=this.length;return this.resize(y+1),this.emplace(y,t,n,c,d,_)}emplace(t,n,c,d,_,y){let b=4*t,w=8*t;return this.float32[b+0]=n,this.float32[b+1]=c,this.float32[b+2]=d,this.int16[w+6]=_,this.int16[w+7]=y,t}}f.prototype.bytesPerElement=16,tt("StructArrayLayout2f1f2i16",f);class e extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y){let b=this.length;return this.resize(b+1),this.emplace(b,t,n,c,d,_,y)}emplace(t,n,c,d,_,y,b){let w=16*t,T=4*t,M=8*t;return this.uint8[w+0]=n,this.uint8[w+1]=c,this.float32[T+1]=d,this.float32[T+2]=_,this.int16[M+6]=y,this.int16[M+7]=b,t}}e.prototype.bytesPerElement=16,tt("StructArrayLayout2ub2f2i16",e);class a extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c){let d=this.length;return this.resize(d+1),this.emplace(d,t,n,c)}emplace(t,n,c,d){let _=3*t;return this.uint16[_+0]=n,this.uint16[_+1]=c,this.uint16[_+2]=d,t}}a.prototype.bytesPerElement=6,tt("StructArrayLayout3ui6",a);class h extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y,b,w,T,M,k,z,B,j,$,Z,Q){let de=this.length;return this.resize(de+1),this.emplace(de,t,n,c,d,_,y,b,w,T,M,k,z,B,j,$,Z,Q)}emplace(t,n,c,d,_,y,b,w,T,M,k,z,B,j,$,Z,Q,de){let oe=24*t,ce=12*t,Ie=48*t;return this.int16[oe+0]=n,this.int16[oe+1]=c,this.uint16[oe+2]=d,this.uint16[oe+3]=_,this.uint32[ce+2]=y,this.uint32[ce+3]=b,this.uint32[ce+4]=w,this.uint16[oe+10]=T,this.uint16[oe+11]=M,this.uint16[oe+12]=k,this.float32[ce+7]=z,this.float32[ce+8]=B,this.uint8[Ie+36]=j,this.uint8[Ie+37]=$,this.uint8[Ie+38]=Z,this.uint32[ce+10]=Q,this.int16[oe+22]=de,t}}h.prototype.bytesPerElement=48,tt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",h);class m extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d,_,y,b,w,T,M,k,z,B,j,$,Z,Q,de,oe,ce,Ie,Ee,ze,Je,qe,Ke,pt,He){let Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,t,n,c,d,_,y,b,w,T,M,k,z,B,j,$,Z,Q,de,oe,ce,Ie,Ee,ze,Je,qe,Ke,pt,He)}emplace(t,n,c,d,_,y,b,w,T,M,k,z,B,j,$,Z,Q,de,oe,ce,Ie,Ee,ze,Je,qe,Ke,pt,He,Xe){let ke=32*t,St=16*t;return this.int16[ke+0]=n,this.int16[ke+1]=c,this.int16[ke+2]=d,this.int16[ke+3]=_,this.int16[ke+4]=y,this.int16[ke+5]=b,this.int16[ke+6]=w,this.int16[ke+7]=T,this.uint16[ke+8]=M,this.uint16[ke+9]=k,this.uint16[ke+10]=z,this.uint16[ke+11]=B,this.uint16[ke+12]=j,this.uint16[ke+13]=$,this.uint16[ke+14]=Z,this.uint16[ke+15]=Q,this.uint16[ke+16]=de,this.uint16[ke+17]=oe,this.uint16[ke+18]=ce,this.uint16[ke+19]=Ie,this.uint16[ke+20]=Ee,this.uint16[ke+21]=ze,this.uint16[ke+22]=Je,this.uint32[St+12]=qe,this.float32[St+13]=Ke,this.float32[St+14]=pt,this.uint16[ke+30]=He,this.uint16[ke+31]=Xe,t}}m.prototype.bytesPerElement=64,tt("StructArrayLayout8i15ui1ul2f2ui64",m);class g extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}g.prototype.bytesPerElement=4,tt("StructArrayLayout1f4",g);class v extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c){let d=this.length;return this.resize(d+1),this.emplace(d,t,n,c)}emplace(t,n,c,d){let _=3*t;return this.uint16[6*t+0]=n,this.float32[_+1]=c,this.float32[_+2]=d,t}}v.prototype.bytesPerElement=12,tt("StructArrayLayout1ui2f12",v);class S extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c){let d=this.length;return this.resize(d+1),this.emplace(d,t,n,c)}emplace(t,n,c,d){let _=4*t;return this.uint32[2*t+0]=n,this.uint16[_+2]=c,this.uint16[_+3]=d,t}}S.prototype.bytesPerElement=8,tt("StructArrayLayout1ul2ui8",S);class I extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){let c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){let d=2*t;return this.uint16[d+0]=n,this.uint16[d+1]=c,t}}I.prototype.bytesPerElement=4,tt("StructArrayLayout2ui4",I);class P extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}P.prototype.bytesPerElement=2,tt("StructArrayLayout1ui2",P);class E extends ai{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,d){let _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,d)}emplace(t,n,c,d,_){let y=4*t;return this.float32[y+0]=n,this.float32[y+1]=c,this.float32[y+2]=d,this.float32[y+3]=_,t}}E.prototype.bytesPerElement=16,tt("StructArrayLayout4f16",E);class D extends Cl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new x(this.anchorPointX,this.anchorPointY)}}D.prototype.size=20;class L extends Gc{get(t){return new D(this,t)}}tt("CollisionBoxArray",L);class O extends Cl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}O.prototype.size=48;class N extends h{get(t){return new O(this,t)}}tt("PlacedSymbolArray",N);class X extends Cl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}X.prototype.size=64;class H extends m{get(t){return new X(this,t)}}tt("SymbolInstanceArray",H);class J extends g{getoffsetX(t){return this.float32[1*t+0]}}tt("GlyphOffsetArray",J);class ee extends Cs{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}tt("SymbolLineVertexArray",ee);class re extends Cl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}re.prototype.size=12;class te extends v{get(t){return new re(this,t)}}tt("TextAnchorOffsetArray",te);class ae extends Cl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ae.prototype.size=8;class ue extends S{get(t){return new ae(this,t)}}tt("FeatureIndexArray",ue);class ie extends Ts{}class _e extends Ts{}class Me extends Ts{}class we extends Ps{}class Se extends ja{}class Pe extends Pl{}class Ve extends $c{}class We extends Ua{}class Re extends kh{}class st extends Lh{}class Rt extends Dh{}class Qt extends e{}class si extends a{}class oi extends I{}let Si=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mi}=Si;class Lt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,c,d){let _=this.segments[this.segments.length-1];return t>Lt.MAX_VERTEX_ARRAY_LENGTH&&Ni(`Max vertices per segment is ${Lt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Lt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+t>Lt.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d?this.createNewSegment(n,c,d):_}createNewSegment(t,n,c){let d={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return c!==void 0&&(d.sortKey=c),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(t,n,c){return this.prepareSegment(0,t,n,c)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let t of this.segments)for(let n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,c,d){return new Lt([{vertexOffset:t,primitiveOffset:n,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}function li(o,t){return 256*(o=Kn(Math.floor(o),0,255))+Kn(Math.floor(t),0,255)}Lt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tt("SegmentVector",Lt);let Hi=Oi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rn,un,Nn,$r={exports:{}},oa={exports:{}},aa={exports:{}},Ms=(function(){if(Nn)return $r.exports;Nn=1;var o=(rn||(rn=1,oa.exports=function(n,c){var d,_,y,b,w,T,M,k;for(_=n.length-(d=3&n.length),y=c,w=3432918353,T=461845907,k=0;k<_;)M=255&n.charCodeAt(k)|(255&n.charCodeAt(++k))<<8|(255&n.charCodeAt(++k))<<16|(255&n.charCodeAt(++k))<<24,++k,y=27492+(65535&(b=5*(65535&(y=(y^=M=(65535&(M=(M=(65535&M)*w+(((M>>>16)*w&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(M=0,d){case 3:M^=(255&n.charCodeAt(k+2))<<16;case 2:M^=(255&n.charCodeAt(k+1))<<8;case 1:y^=M=(65535&(M=(M=(65535&(M^=255&n.charCodeAt(k)))*w+(((M>>>16)*w&65535)<<16)&4294967295)<<15|M>>>17))*T+(((M>>>16)*T&65535)<<16)&4294967295}return y^=n.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),oa.exports),t=(un||(un=1,aa.exports=function(n,c){for(var d,_=n.length,y=c^_,b=0;_>=4;)d=1540483477*(65535&(d=255&n.charCodeAt(b)|(255&n.charCodeAt(++b))<<8|(255&n.charCodeAt(++b))<<16|(255&n.charCodeAt(++b))<<24))+((1540483477*(d>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++b;switch(_){case 3:y^=(255&n.charCodeAt(b+2))<<16;case 2:y^=(255&n.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&n.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),aa.exports);return $r.exports=o,$r.exports.murmur3=o,$r.exports.murmur2=t,$r.exports})(),Es=C(Ms);class Na{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,c,d){this.ids.push(Va(t)),this.positions.push(n,c,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let n=Va(t),c=0,d=this.ids.length-1;for(;c<d;){let y=c+d>>1;this.ids[y]>=n?d=y:c=y+1}let _=[];for(;this.ids[c]===n;)_.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return _}static serialize(t,n){let c=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Qn(c,d,0,c.length-1),n&&n.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(t){let n=new Na;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Va(o){let t=+o;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Es(String(o))}function Qn(o,t,n,c){for(;n<c;){let d=o[n+c>>1],_=n-1,y=c+1;for(;;){do _++;while(o[_]<d);do y--;while(o[y]>d);if(_>=y)break;Gr(o,_,y),Gr(t,3*_,3*y),Gr(t,3*_+1,3*y+1),Gr(t,3*_+2,3*y+2)}y-n<c-y?(Qn(o,t,n,y),n=y+1):(Qn(o,t,y+1,c),c=y)}}function Gr(o,t,n){let c=o[t];o[t]=o[n],o[n]=c}tt("FeaturePositionMap",Na);class Vn{constructor(t,n){this.gl=t.gl,this.location=n}}class sa extends Vn{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ki extends Vn{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class on extends Vn{constructor(t,n){super(t,n),this.current=Ut.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let br=new Float32Array(16);function Xi(o){return[li(255*o.r,255*o.g),li(255*o.b,255*o.a)]}class Ml{constructor(t,n,c){this.value=t,this.uniformNames=n.map(d=>`u_${d}`),this.type=c}setUniform(t,n,c){t.set(c.constantOr(this.value))}getBinding(t,n,c){return this.type==="color"?new on(t,n):new sa(t,n)}}class As{constructor(t,n){this.uniformNames=n.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,c,d){let _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,n,c){return c.substr(0,9)==="u_pattern"?new Ki(t,n):new sa(t,n)}}class ko{constructor(t,n,c,d){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(t,n,c,d,_){let y=this.paintVertexArray.length,b=this.expression.evaluate(new xi(0),n,{},d,[],_);this.paintVertexArray.resize(t),this._setPaintValue(y,t,b)}updatePaintArray(t,n,c,d){let _=this.expression.evaluate({zoom:0},c,d);this._setPaintValue(t,n,_)}_setPaintValue(t,n,c){if(this.type==="color"){let d=Xi(c);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qr{constructor(t,n,c,d,_,y){this.expression=t,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,n,c,d,_){let y=this.expression.evaluate(new xi(this.zoom),n,{},d,[],_),b=this.expression.evaluate(new xi(this.zoom+1),n,{},d,[],_),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,y,b)}updatePaintArray(t,n,c,d){let _=this.expression.evaluate({zoom:this.zoom},c,d),y=this.expression.evaluate({zoom:this.zoom+1},c,d);this._setPaintValue(t,n,_,y)}_setPaintValue(t,n,c,d){if(this.type==="color"){let _=Xi(c),y=Xi(d);for(let b=t;b<n;b++)this.paintVertexArray.emplace(b,_[0],_[1],y[0],y[1])}else{for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){let c=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,d=Kn(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,n,c){return new sa(t,n)}}class la{constructor(t,n,c,d,_,y){this.expression=t,this.type=n,this.useIntegerZoom=c,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,n,c){let d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(t,n,c,d,_){this._setPaintValues(t,n,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(t,n,c,d){if(!d||!c)return;let{min:_,mid:y,max:b}=c,w=d[_],T=d[y],M=d[b];if(w&&T&&M)for(let k=t;k<n;k++)this.zoomInPaintVertexArray.emplace(k,T.tl[0],T.tl[1],T.br[0],T.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],T.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,T.tl[0],T.tl[1],T.br[0],T.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],T.pixelRatio,M.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Hi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Hi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Cd{constructor(t,n,c){this.binders={},this._buffers=[];let d=[];for(let _ in t.paint._values){if(!c(_))continue;let y=t.paint.get(_);if(!(y instanceof uo&&ia(y.property.specification)))continue;let b=Pd(_,t.type),w=y.value,T=y.property.specification.type,M=y.property.useIntegerZoom,k=y.property.specification["property-type"],z=k==="cross-faded"||k==="cross-faded-data-driven";if(w.kind==="constant")this.binders[_]=z?new As(w.value,b):new Ml(w.value,b,T),d.push(`/u_${_}`);else if(w.kind==="source"||z){let B=Rh(_,T,"source");this.binders[_]=z?new la(w,T,M,n,B,t.id):new ko(w,b,T,B),d.push(`/a_${_}`)}else{let B=Rh(_,T,"composite");this.binders[_]=new qr(w,b,T,M,n,B),d.push(`/z_${_}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){let n=this.binders[t];return n instanceof ko||n instanceof qr?n.maxValue:0}populatePaintArrays(t,n,c,d,_){for(let y in this.binders){let b=this.binders[y];(b instanceof ko||b instanceof qr||b instanceof la)&&b.populatePaintArray(t,n,c,d,_)}}setConstantPatternPositions(t,n){for(let c in this.binders){let d=this.binders[c];d instanceof As&&d.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,c,d,_){let y=!1;for(let b in t){let w=n.getPositions(b);for(let T of w){let M=c.feature(T.index);for(let k in this.binders){let z=this.binders[k];if((z instanceof ko||z instanceof qr||z instanceof la)&&z.expression.isStateDependent===!0){let B=d.paint.get(k);z.expression=B.value,z.updatePaintArray(T.start,T.end,M,t[b],_),y=!0}}}}return y}defines(){let t=[];for(let n in this.binders){let c=this.binders[n];(c instanceof Ml||c instanceof As)&&t.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return t}getBinderAttributes(){let t=[];for(let n in this.binders){let c=this.binders[n];if(c instanceof ko||c instanceof qr)for(let d=0;d<c.paintVertexAttributes.length;d++)t.push(c.paintVertexAttributes[d].name);else if(c instanceof la)for(let d=0;d<Hi.members.length;d++)t.push(Hi.members[d].name)}return t}getBinderUniforms(){let t=[];for(let n in this.binders){let c=this.binders[n];if(c instanceof Ml||c instanceof As||c instanceof qr)for(let d of c.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){let c=[];for(let d in this.binders){let _=this.binders[d];if(_ instanceof Ml||_ instanceof As||_ instanceof qr){for(let y of _.uniformNames)if(n[y]){let b=_.getBinding(t,n[y],y);c.push({name:y,property:d,binding:b})}}}return c}setUniforms(t,n,c,d){for(let{name:_,property:y,binding:b}of n)this.binders[y].setUniform(b,d,c.get(y),_)}updatePaintBuffers(t){this._buffers=[];for(let n in this.binders){let c=this.binders[n];if(t&&c instanceof la){let d=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(c instanceof ko||c instanceof qr)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(let n in this.binders){let c=this.binders[n];(c instanceof ko||c instanceof qr||c instanceof la)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let n=this.binders[t];(n instanceof ko||n instanceof qr||n instanceof la)&&n.destroy()}}}class cr{constructor(t,n,c=()=>!0){this.programConfigurations={};for(let d of t)this.programConfigurations[d.id]=new Cd(d,n,c);this.needsUpload=!1,this._featureMap=new Na,this._bufferOffset=0}populatePaintArrays(t,n,c,d,_,y){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(t,n,d,_,y);n.id!==void 0&&this._featureMap.add(n.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,c,d){for(let _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,n,_,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Pd(o,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}function Rh(o,t,n){let c={color:{source:Pl,composite:E},number:{source:g,composite:Pl}},d=(function(_){return{"line-pattern":{source:Ve,composite:Ve},"fill-pattern":{source:Ve,composite:Ve},"fill-extrusion-pattern":{source:Ve,composite:Ve}}[_]})(o);return d&&d[n]||c[t][n]}tt("ConstantBinder",Ml),tt("CrossFadedConstantBinder",As),tt("SourceExpressionBinder",ko),tt("CrossFadedCompositeBinder",la),tt("CompositeExpressionBinder",qr),tt("ProgramConfiguration",Cd,{omit:["_buffers"]}),tt("ProgramConfigurationSet",cr);let qc=Math.pow(2,14)-1,Wc=-qc-1;function ca(o){let t=ri/o.extent,n=o.loadGeometry();for(let c=0;c<n.length;c++){let d=n[c];for(let _=0;_<d.length;_++){let y=d[_],b=Math.round(y.x*t),w=Math.round(y.y*t);y.x=Kn(b,Wc,qc),y.y=Kn(w,Wc,qc),(b<y.x||b>y.x+1||w<y.y||w>y.y+1)&&Ni("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Lo(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?ca(o):[]}}let K_=-32768;function vw(o,t,n,c,d){o.emplaceBack(K_+8*t+c,K_+8*n+d)}class ig{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new _e,this.indexArray=new si,this.segments=new Lt,this.programConfigurations=new cr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,c){let d=this.layers[0],_=[],y=null,b=!1,w=d.type==="heatmap";if(d.type==="circle"){let M=d;y=M.layout.get("circle-sort-key"),b=!y.isConstant(),w=w||M.paint.get("circle-pitch-alignment")==="map"}let T=w?n.subdivisionGranularity.circle:1;for(let{feature:M,id:k,index:z,sourceLayerIndex:B}of t){let j=this.layers[0]._featureFilter.needGeometry,$=Lo(M,j);if(!this.layers[0]._featureFilter.filter(new xi(this.zoom,{globalState:this.globalState}),$,c))continue;let Z=b?y.evaluate($,{},c):void 0,Q={id:k,properties:M.properties,type:M.type,sourceLayerIndex:B,index:z,geometry:j?$.geometry:ca(M),patterns:{},sortKey:Z};_.push(Q)}b&&_.sort((M,k)=>M.sortKey-k.sortKey);for(let M of _){let{geometry:k,index:z,sourceLayerIndex:B}=M,j=t[z].feature;this.addFeature(M,k,z,c,T),n.featureIndex.insert(j,k,z,B,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,c,d,_=1){let y;switch(_){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}let b=y.length;for(let w of n)for(let T of w){let M=T.x,k=T.y;if(M<0||M>=ri||k<0||k>=ri)continue;let z=this.segments.prepareSegment(b*b,this.layoutVertexArray,this.indexArray,t.sortKey),B=z.vertexLength;for(let j=0;j<b;j++)for(let $=0;$<b;$++)vw(this.layoutVertexArray,M,k,y[$],y[j]);for(let j=0;j<b-1;j++)for(let $=0;$<b-1;$++){let Z=B+j*b+$,Q=B+(j+1)*b+$;this.indexArray.emplaceBack(Z,Q+1,Z+1),this.indexArray.emplaceBack(Z,Q,Q+1)}z.vertexLength+=b*b,z.primitiveLength+=(b-1)*(b-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},d)}}function X_(o,t){for(let n=0;n<o.length;n++)if(Zc(t,o[n]))return!0;for(let n=0;n<t.length;n++)if(Zc(o,t[n]))return!0;return!!ng(o,t)}function xw(o,t,n){return!!Zc(o,t)||!!rg(t,o,n)}function J_(o,t){if(o.length===1)return Q_(t,o[0]);for(let n=0;n<t.length;n++){let c=t[n];for(let d=0;d<c.length;d++)if(Zc(o,c[d]))return!0}for(let n=0;n<o.length;n++)if(Q_(t,o[n]))return!0;for(let n=0;n<t.length;n++)if(ng(o,t[n]))return!0;return!1}function bw(o,t,n){if(o.length>1){if(ng(o,t))return!0;for(let c=0;c<t.length;c++)if(rg(t[c],o,n))return!0}for(let c=0;c<o.length;c++)if(rg(o[c],t,n))return!0;return!1}function ng(o,t){if(o.length===0||t.length===0)return!1;for(let n=0;n<o.length-1;n++){let c=o[n],d=o[n+1];for(let _=0;_<t.length-1;_++)if(ww(c,d,t[_],t[_+1]))return!0}return!1}function ww(o,t,n,c){return Rr(o,n,c)!==Rr(t,n,c)&&Rr(o,t,n)!==Rr(o,t,c)}function rg(o,t,n){let c=n*n;if(t.length===1)return o.distSqr(t[0])<c;for(let d=1;d<t.length;d++)if(Y_(o,t[d-1],t[d])<c)return!0;return!1}function Y_(o,t,n){let c=t.distSqr(n);if(c===0)return o.distSqr(t);let d=((o.x-t.x)*(n.x-t.x)+(o.y-t.y)*(n.y-t.y))/c;return o.distSqr(d<0?t:d>1?n:n.sub(t)._mult(d)._add(t))}function Q_(o,t){let n,c,d,_=!1;for(let y=0;y<o.length;y++){n=o[y];for(let b=0,w=n.length-1;b<n.length;w=b++)c=n[b],d=n[w],c.y>t.y!=d.y>t.y&&t.x<(d.x-c.x)*(t.y-c.y)/(d.y-c.y)+c.x&&(_=!_)}return _}function Zc(o,t){let n=!1;for(let c=0,d=o.length-1;c<o.length;d=c++){let _=o[c],y=o[d];_.y>t.y!=y.y>t.y&&t.x<(y.x-_.x)*(t.y-_.y)/(y.y-_.y)+_.x&&(n=!n)}return n}function Sw(o,t,n){let c=n[0],d=n[2];if(o.x<c.x&&t.x<c.x||o.x>d.x&&t.x>d.x||o.y<c.y&&t.y<c.y||o.y>d.y&&t.y>d.y)return!1;let _=Rr(o,t,n[0]);return _!==Rr(o,t,n[1])||_!==Rr(o,t,n[2])||_!==Rr(o,t,n[3])}function zh(o,t,n){let c=t.paint.get(o).value;return c.kind==="constant"?c.value:n.programConfigurations.get(t.id).getMaxValue(o)}function Md(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ed(o,t,n,c,d){if(!t[0]&&!t[1])return o;let _=x.convert(t)._mult(d);n==="viewport"&&_._rotate(-c);let y=[];for(let b=0;b<o.length;b++)y.push(o[b].sub(_));return y}let ey,ty;tt("CircleBucket",ig,{omit:["layers"]});var Iw={get paint(){return ty=ty||new Un({"circle-radius":new bt(ve.paint_circle["circle-radius"]),"circle-color":new bt(ve.paint_circle["circle-color"]),"circle-blur":new bt(ve.paint_circle["circle-blur"]),"circle-opacity":new bt(ve.paint_circle["circle-opacity"]),"circle-translate":new ut(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bt(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bt(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bt(ve.paint_circle["circle-stroke-opacity"])})},get layout(){return ey=ey||new Un({"circle-sort-key":new bt(ve.layout_circle["circle-sort-key"])})}};class Tw extends xr{constructor(t){super(t,Iw)}createBucket(t){return new ig(t)}queryRadius(t){let n=t;return zh("circle-radius",this,n)+zh("circle-stroke-width",this,n)+Md(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:d,transform:_,pixelsToTileUnits:y,unwrappedTileID:b,getElevation:w}){let T=Ed(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,y),M=this.paint.get("circle-radius").evaluate(n,c)+this.paint.get("circle-stroke-width").evaluate(n,c),k=this.paint.get("circle-pitch-alignment")==="map",z=k?T:(function(j,$,Z,Q){return j.map(de=>iy(de,$,Z,Q))})(T,_,b,w),B=k?M*y:M;for(let j of d)for(let $ of j){let Z=k?$:iy($,_,b,w),Q=B,de=_.projectTileCoordinates($.x,$.y,b,w).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Q*=de/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Q*=_.cameraToCenterDistance/de),xw(z,Z,Q))return!0}return!1}}function iy(o,t,n,c){let d=t.projectTileCoordinates(o.x,o.y,n,c).point;return new x((.5*d.x+.5)*t.width,(.5*-d.y+.5)*t.height)}class ny extends ig{}let ry;tt("HeatmapBucket",ny,{omit:["layers"]});var Cw={get paint(){return ry=ry||new Un({"heatmap-radius":new bt(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bt(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nc(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(ve.paint_heatmap["heatmap-opacity"])})}};function og(o,{width:t,height:n},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*n*c)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*n*c}`)}else d=new Uint8Array(t*n*c);return o.width=t,o.height=n,o.data=d,o}function oy(o,{width:t,height:n},c){if(t===o.width&&n===o.height)return;let d=og({},{width:t,height:n},c);ag(o,d,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,t),height:Math.min(o.height,n)},c),o.width=t,o.height=n,o.data=d.data}function ag(o,t,n,c,d,_){if(d.width===0||d.height===0)return t;if(d.width>o.width||d.height>o.height||n.x>o.width-d.width||n.y>o.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||c.x>t.width-d.width||c.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");let y=o.data,b=t.data;if(y===b)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<d.height;w++){let T=((n.y+w)*o.width+n.x)*_,M=((c.y+w)*t.width+c.x)*_;for(let k=0;k<d.width*_;k++)b[M+k]=y[T+k]}return t}class Oh{constructor(t,n){og(this,t,1,n)}resize(t){oy(this,t,1)}clone(){return new Oh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,d,_){ag(t,n,c,d,_,1)}}class ur{constructor(t,n){og(this,t,4,n)}resize(t){oy(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ur({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,d,_){ag(t,n,c,d,_,4)}setPixel(t,n,c){let d=4*(t*this.width+n);this.data[d+0]=Math.round(255*c.r/c.a),this.data[d+1]=Math.round(255*c.g/c.a),this.data[d+2]=Math.round(255*c.b/c.a),this.data[d+3]=Math.round(255*c.a)}}function ay(o){let t={},n=o.resolution||256,c=o.clips?o.clips.length:1,d=o.image||new ur({width:n,height:c});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);let _=(y,b,w)=>{t[o.evaluationKey]=w;let T=o.expression.evaluate(t);d.setPixel(y/4/n,b/4,T)};if(o.clips)for(let y=0,b=0;y<c;++y,b+=4*n)for(let w=0,T=0;w<n;w++,T+=4){let M=w/(n-1),{start:k,end:z}=o.clips[y];_(b,T,k*(1-M)+z*M)}else for(let y=0,b=0;y<n;y++,b+=4)_(0,b,y/(n-1));return d}tt("AlphaImage",Oh),tt("RGBAImage",ur);let sg="big-fb";class Pw extends xr{createBucket(t){return new ny(t)}constructor(t){super(t,Cw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ay({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(sg)&&this.heatmapFbos.delete(sg)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let sy;var Mw={get paint(){return sy=sy||new Un({"hillshade-illumination-direction":new ut(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ut(ve.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ut(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(ve.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ut(ve.paint_hillshade["hillshade-method"])})}};class Ew extends xr{constructor(t){super(t,Mw),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,c=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values,_=Math.max(t.length,n.length,c.length,d.length);t=t.concat(Array(_-t.length).fill(t.at(-1))),n=n.concat(Array(_-n.length).fill(n.at(-1))),c=c.concat(Array(_-c.length).fill(c.at(-1))),d=d.concat(Array(_-d.length).fill(d.at(-1)));let y=n.map(wa);return{directionRadians:t.map(wa),altitudeRadians:y,shadowColor:d,highlightColor:c}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let ly;var Aw={get paint(){return ly=ly||new Un({"color-relief-opacity":new ut(ve["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Nc(ve["paint_color-relief"]["color-relief-color"])})}};class lg{constructor(t,n,c,d){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(n,d)}update(t,n,c){let{width:d,height:_}=t,y=!(this.size&&this.size[0]===d&&this.size[1]===_||c),{context:b}=this,{gl:w}=b;if(this.useMipmap=!!(n&&n.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[d,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||no(t)?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,t):w.texImage2D(w.TEXTURE_2D,0,this.format,d,_,0,this.format,w.UNSIGNED_BYTE,t.data);else{let{x:T,y:M}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||no(t)?w.texSubImage2D(w.TEXTURE_2D,0,T,M,w.RGBA,w.UNSIGNED_BYTE,t):w.texSubImage2D(w.TEXTURE_2D,0,T,M,d,_,w.RGBA,w.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D),b.pixelStoreUnpackFlipY.setDefault(),b.pixelStoreUnpack.setDefault(),b.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,c){let{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),c!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,c||t),this.filter=t),n!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class cy{constructor(t,n,c,d=1,_=1,y=1,b=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void Ni(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;let w=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=_,this.blueFactor=y,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<w;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(w,T)]=this.data[this._idx(w-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,w)]=this.data[this._idx(T,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<w;T++)for(let M=0;M<w;M++){let k=this.get(T,M);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(t,n){let c=new Uint8Array(this.data.buffer),d=4*this._idx(t,n);return this.unpack(c[d],c[d+1],c[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,c){return t*this.redFactor+n*this.greenFactor+c*this.blueFactor-this.baseShift}pack(t){return uy(t,this.getUnpackVector())}getPixels(){return new ur({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=n*this.dim,_=n*this.dim+this.dim,y=c*this.dim,b=c*this.dim+this.dim;switch(n){case-1:d=_-1;break;case 1:_=d+1}switch(c){case-1:y=b-1;break;case 1:b=y+1}let w=-n*this.dim,T=-c*this.dim;for(let M=y;M<b;M++)for(let k=d;k<_;k++)this.data[this._idx(k,M)]=t.data[this._idx(k+w,M+T)]}}function uy(o,t){let n=t[0],c=t[1],d=t[2],_=t[3],y=Math.min(n,c,d),b=Math.round((o+_)/y);return{r:Math.floor(b*y/n)%256,g:Math.floor(b*y/c)%256,b:Math.floor(b*y/d)%256}}tt("DEMData",cy);class kw extends xr{constructor(t){super(t,Aw)}_createColorRamp(t){let n={elevationStops:[],colorStops:[]},c=this._transitionablePaint._values["color-relief-color"].value.expression;if(c instanceof yl&&c._styleExpression.expression instanceof vn){this.colorRampExpression=c;let y=c._styleExpression.expression;n.elevationStops=y.labels,n.colorStops=[];for(let b of n.elevationStops)n.colorStops.push(y.evaluate({globals:{elevation:b}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[Ut.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;let d={elevationStops:[],colorStops:[]},_=(n.elevationStops.length-1)/(t-1);for(let y=0;y<n.elevationStops.length-.5;y+=_)d.elevationStops.push(n.elevationStops[Math.round(y)]),d.colorStops.push(n.colorStops[Math.round(y)]);return Ni(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,c){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let d=this._createColorRamp(n),_=new ur({width:d.colorStops.length,height:1}),y=new ur({width:d.colorStops.length,height:1});for(let b=0;b<d.elevationStops.length;b++){let w=uy(d.elevationStops[b],c);y.setPixel(0,b,new Ut(w.r/255,w.g/255,w.b/255,1)),_.setPixel(0,b,d.colorStops[b])}return this.colorRampTextures={elevationTexture:new lg(t,y,t.gl.RGBA),colorTexture:new lg(t,_,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}let Lw=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dw}=Lw;function cg(o,t,n){let c=n.patternDependencies,d=!1;for(let _ of t){let y=_.paint.get(`${o}-pattern`);y.isConstant()||(d=!0);let b=y.constantOr(null);b&&(d=!0,c[b.to]=!0,c[b.from]=!0)}return d}function ug(o,t,n,c,d){let _=d.patternDependencies;for(let y of t){let b=y.paint.get(`${o}-pattern`).value;if(b.kind!=="constant"){let w=b.evaluate({zoom:c-1},n,{},d.availableImages),T=b.evaluate({zoom:c},n,{},d.availableImages),M=b.evaluate({zoom:c+1},n,{},d.availableImages);w=w&&w.name?w.name:w,T=T&&T.name?T.name:T,M=M&&M.name?M.name:M,_[w]=!0,_[T]=!0,_[M]=!0,n.patterns[y.id]={min:w,mid:T,max:M}}}return n}function hy(o,t,n,c,d){let _;if(d===(function(y,b,w,T){let M=0;for(let k=b,z=w-T;k<w;k+=T)M+=(y[z]-y[k])*(y[k+1]+y[z+1]),z=k;return M})(o,t,n,c)>0)for(let y=t;y<n;y+=c)_=fy(y/c|0,o[y],o[y+1],_);else for(let y=n-c;y>=t;y-=c)_=fy(y/c|0,o[y],o[y+1],_);return _&&Hc(_,_.next)&&(Uh(_),_=_.next),_}function El(o,t){if(!o)return o;t||(t=o);let n,c=o;do if(n=!1,c.steiner||!Hc(c,c.next)&&$i(c.prev,c,c.next)!==0)c=c.next;else{if(Uh(c),c=t=c.prev,c===c.next)break;n=!0}while(n||c!==t);return t}function Fh(o,t,n,c,d,_,y){if(!o)return;!y&&_&&(function(w,T,M,k){let z=w;do z.z===0&&(z.z=hg(z.x,z.y,T,M,k)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==w);z.prevZ.nextZ=null,z.prevZ=null,(function(B){let j,$=1;do{let Z,Q=B;B=null;let de=null;for(j=0;Q;){j++;let oe=Q,ce=0;for(let Ee=0;Ee<$&&(ce++,oe=oe.nextZ,oe);Ee++);let Ie=$;for(;ce>0||Ie>0&&oe;)ce!==0&&(Ie===0||!oe||Q.z<=oe.z)?(Z=Q,Q=Q.nextZ,ce--):(Z=oe,oe=oe.nextZ,Ie--),de?de.nextZ=Z:B=Z,Z.prevZ=de,de=Z;Q=oe}de.nextZ=null,$*=2}while(j>1)})(z)})(o,c,d,_);let b=o;for(;o.prev!==o.next;){let w=o.prev,T=o.next;if(_?zw(o,c,d,_):Rw(o))t.push(w.i,o.i,T.i),Uh(o),o=T.next,b=T.next;else if((o=T)===b){y?y===1?Fh(o=Ow(El(o),t),t,n,c,d,_,2):y===2&&Fw(o,t,n,c,d,_):Fh(El(o),t,n,c,d,_,1);break}}}function Rw(o){let t=o.prev,n=o,c=o.next;if($i(t,n,c)>=0)return!1;let d=t.x,_=n.x,y=c.x,b=t.y,w=n.y,T=c.y,M=Math.min(d,_,y),k=Math.min(b,w,T),z=Math.max(d,_,y),B=Math.max(b,w,T),j=c.next;for(;j!==t;){if(j.x>=M&&j.x<=z&&j.y>=k&&j.y<=B&&Bh(d,b,_,w,y,T,j.x,j.y)&&$i(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function zw(o,t,n,c){let d=o.prev,_=o,y=o.next;if($i(d,_,y)>=0)return!1;let b=d.x,w=_.x,T=y.x,M=d.y,k=_.y,z=y.y,B=Math.min(b,w,T),j=Math.min(M,k,z),$=Math.max(b,w,T),Z=Math.max(M,k,z),Q=hg(B,j,t,n,c),de=hg($,Z,t,n,c),oe=o.prevZ,ce=o.nextZ;for(;oe&&oe.z>=Q&&ce&&ce.z<=de;){if(oe.x>=B&&oe.x<=$&&oe.y>=j&&oe.y<=Z&&oe!==d&&oe!==y&&Bh(b,M,w,k,T,z,oe.x,oe.y)&&$i(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,ce.x>=B&&ce.x<=$&&ce.y>=j&&ce.y<=Z&&ce!==d&&ce!==y&&Bh(b,M,w,k,T,z,ce.x,ce.y)&&$i(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;oe&&oe.z>=Q;){if(oe.x>=B&&oe.x<=$&&oe.y>=j&&oe.y<=Z&&oe!==d&&oe!==y&&Bh(b,M,w,k,T,z,oe.x,oe.y)&&$i(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;ce&&ce.z<=de;){if(ce.x>=B&&ce.x<=$&&ce.y>=j&&ce.y<=Z&&ce!==d&&ce!==y&&Bh(b,M,w,k,T,z,ce.x,ce.y)&&$i(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function Ow(o,t){let n=o;do{let c=n.prev,d=n.next.next;!Hc(c,d)&&dy(c,n,n.next,d)&&jh(c,d)&&jh(d,c)&&(t.push(c.i,n.i,d.i),Uh(n),Uh(n.next),n=o=d),n=n.next}while(n!==o);return El(n)}function Fw(o,t,n,c,d,_){let y=o;do{let b=y.next.next;for(;b!==y.prev;){if(y.i!==b.i&&Vw(y,b)){let w=my(y,b);return y=El(y,y.next),w=El(w,w.next),Fh(y,t,n,c,d,_,0),void Fh(w,t,n,c,d,_,0)}b=b.next}y=y.next}while(y!==o)}function Bw(o,t){let n=o.x-t.x;return n===0&&(n=o.y-t.y,n===0)&&(n=(o.next.y-o.y)/(o.next.x-o.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function jw(o,t){let n=(function(d,_){let y=_,b=d.x,w=d.y,T,M=-1/0;if(Hc(d,y))return y;do{if(Hc(d,y.next))return y.next;if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){let $=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if($<=b&&$>M&&(M=$,T=y.x<y.next.x?y:y.next,$===b))return T}y=y.next}while(y!==_);if(!T)return null;let k=T,z=T.x,B=T.y,j=1/0;y=T;do{if(b>=y.x&&y.x>=z&&b!==y.x&&py(w<B?b:M,w,z,B,w<B?M:b,w,y.x,y.y)){let $=Math.abs(w-y.y)/(b-y.x);jh(y,d)&&($<j||$===j&&(y.x>T.x||y.x===T.x&&Uw(T,y)))&&(T=y,j=$)}y=y.next}while(y!==k);return T})(o,t);if(!n)return t;let c=my(n,o);return El(c,c.next),El(n,n.next)}function Uw(o,t){return $i(o.prev,o,t.prev)<0&&$i(t.next,o,o.next)<0}function hg(o,t,n,c,d){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-n)*d|0)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Nw(o){let t=o,n=o;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==o);return n}function py(o,t,n,c,d,_,y,b){return(d-y)*(t-b)>=(o-y)*(_-b)&&(o-y)*(c-b)>=(n-y)*(t-b)&&(n-y)*(_-b)>=(d-y)*(c-b)}function Bh(o,t,n,c,d,_,y,b){return!(o===y&&t===b)&&py(o,t,n,c,d,_,y,b)}function Vw(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!(function(n,c){let d=n;do{if(d.i!==n.i&&d.next.i!==n.i&&d.i!==c.i&&d.next.i!==c.i&&dy(d,d.next,n,c))return!0;d=d.next}while(d!==n);return!1})(o,t)&&(jh(o,t)&&jh(t,o)&&(function(n,c){let d=n,_=!1,y=(n.x+c.x)/2,b=(n.y+c.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&y<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==n);return _})(o,t)&&($i(o.prev,o,t.prev)||$i(o,t.prev,t))||Hc(o,t)&&$i(o.prev,o,o.next)>0&&$i(t.prev,t,t.next)>0)}function $i(o,t,n){return(t.y-o.y)*(n.x-t.x)-(t.x-o.x)*(n.y-t.y)}function Hc(o,t){return o.x===t.x&&o.y===t.y}function dy(o,t,n,c){let d=kd($i(o,t,n)),_=kd($i(o,t,c)),y=kd($i(n,c,o)),b=kd($i(n,c,t));return d!==_&&y!==b||!(d!==0||!Ad(o,n,t))||!(_!==0||!Ad(o,c,t))||!(y!==0||!Ad(n,o,c))||!(b!==0||!Ad(n,t,c))}function Ad(o,t,n){return t.x<=Math.max(o.x,n.x)&&t.x>=Math.min(o.x,n.x)&&t.y<=Math.max(o.y,n.y)&&t.y>=Math.min(o.y,n.y)}function kd(o){return o>0?1:o<0?-1:0}function jh(o,t){return $i(o.prev,o,o.next)<0?$i(o,t,o.next)>=0&&$i(o,o.prev,t)>=0:$i(o,t,o.prev)<0||$i(o,o.next,t)<0}function my(o,t){let n=pg(o.i,o.x,o.y),c=pg(t.i,t.x,t.y),d=o.next,_=t.prev;return o.next=t,t.prev=o,n.next=d,d.prev=n,c.next=n,n.prev=c,_.next=c,c.prev=_,c}function fy(o,t,n,c){let d=pg(o,t,n);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function Uh(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function pg(o,t,n){return{i:o,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Kc{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Ld{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Ld.noSubdivision=new Ld({fill:new Kc(0,0),line:new Kc(0,0),tile:new Kc(0,0),stencil:new Kc(0,0),circle:1}),tt("SubdivisionGranularityExpression",Kc),tt("SubdivisionGranularitySetting",Ld);let Xc=-32768,Nh=32767;class $w{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ri/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let c=0|Math.round(t),d=0|Math.round(n),_=this._getKey(c,d);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);let y=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,y),this._vertexBuffer.push(c,d),y}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(d,_){let y=[];for(let b=0;b<_.length;b+=3){let w=_[b],T=_[b+1],M=_[b+2],k=d[2*w],z=d[2*w+1];(d[2*T]-k)*(d[2*M+1]-z)-(d[2*T+1]-z)*(d[2*M]-k)>0?(y.push(w),y.push(M),y.push(T)):(y.push(w),y.push(T),y.push(M))}return y})(this._vertexBuffer,t);let n=[],c=t.length;for(let d=0;d<c;d+=3){let _=[t[d+0],t[d+1],t[d+2]],y=[this._vertexBuffer[2*t[d+0]+0],this._vertexBuffer[2*t[d+0]+1],this._vertexBuffer[2*t[d+1]+0],this._vertexBuffer[2*t[d+1]+1],this._vertexBuffer[2*t[d+2]+0],this._vertexBuffer[2*t[d+2]+1]],b=1/0,w=1/0,T=-1/0,M=-1/0;for(let $=0;$<3;$++){let Z=y[2*$],Q=y[2*$+1];b=Math.min(b,Z),T=Math.max(T,Z),w=Math.min(w,Q),M=Math.max(M,Q)}if(b===T||w===M)continue;let k=Math.floor(b/this._granularityCellSize),z=Math.ceil(T/this._granularityCellSize),B=Math.floor(w/this._granularityCellSize),j=Math.ceil(M/this._granularityCellSize);if(k!==z||B!==j)for(let $=B;$<j;$++){let Z=this._scanlineGenerateVertexRingForCellRow($,y,_);Gw(this._vertexBuffer,Z,n)}else n.push(..._)}return n}_scanlineGenerateVertexRingForCellRow(t,n,c){let d=t*this._granularityCellSize,_=d+this._granularityCellSize,y=[];for(let b=0;b<3;b++){let w=n[2*b],T=n[2*b+1],M=n[2*(b+1)%6],k=n[(2*(b+1)+1)%6],z=n[2*(b+2)%6],B=n[(2*(b+2)+1)%6],j=M-w,$=k-T,Z=j===0,Q=$===0,de=(d-T)/$,oe=(_-T)/$,ce=Math.min(de,oe),Ie=Math.max(de,oe);if(!Q&&(ce>=1||Ie<=0)||Q&&(T<d||T>_)){k>=d&&k<=_&&y.push(c[(b+1)%3]);continue}!Q&&ce>0&&y.push(this._vertexToIndex(w+j*ce,T+$*ce));let Ee=w+j*Math.max(ce,0),ze=w+j*Math.min(Ie,1);Z||this._generateIntraEdgeVertices(y,w,T,M,k,Ee,ze),!Q&&Ie<1&&y.push(this._vertexToIndex(w+j*Ie,T+$*Ie)),(Q||k>=d&&k<=_)&&y.push(c[(b+1)%3]),!Q&&(k<=d||k>=_)&&this._generateInterEdgeVertices(y,w,T,M,k,z,B,ze,d,_)}return y}_generateIntraEdgeVertices(t,n,c,d,_,y,b){let w=d-n,T=_-c,M=T===0,k=M?Math.min(n,d):Math.min(y,b),z=M?Math.max(n,d):Math.max(y,b),B=Math.floor(k/this._granularityCellSize)+1,j=Math.ceil(z/this._granularityCellSize)-1;if(M?n<d:y<b)for(let $=B;$<=j;$++){let Z=$*this._granularityCellSize;t.push(this._vertexToIndex(Z,c+T*(Z-n)/w))}else for(let $=j;$>=B;$--){let Z=$*this._granularityCellSize;t.push(this._vertexToIndex(Z,c+T*(Z-n)/w))}}_generateInterEdgeVertices(t,n,c,d,_,y,b,w,T,M){let k=_-c,z=y-d,B=b-_,j=(T-_)/B,$=(M-_)/B,Z=Math.min(j,$),Q=Math.max(j,$),de=d+z*Z,oe=Math.floor(Math.min(de,w)/this._granularityCellSize)+1,ce=Math.ceil(Math.max(de,w)/this._granularityCellSize)-1,Ie=w<de,Ee=B===0;if(Ee&&(b===T||b===M))return;if(Ee||Z>=1||Q<=0){let Je=c-b,qe=y+(n-y)*Math.min((T-b)/Je,(M-b)/Je);oe=Math.floor(Math.min(qe,w)/this._granularityCellSize)+1,ce=Math.ceil(Math.max(qe,w)/this._granularityCellSize)-1,Ie=w<qe}let ze=k>0?M:T;if(Ie)for(let Je=oe;Je<=ce;Je++)t.push(this._vertexToIndex(Je*this._granularityCellSize,ze));else for(let Je=ce;Je>=oe;Je--)t.push(this._vertexToIndex(Je*this._granularityCellSize,ze))}_generateOutline(t){let n=[];for(let c of t){let d=Al(c,this._granularity,!0),_=this._pointArrayToIndices(d),y=[];for(let b=1;b<_.length;b++)y.push(_[b-1]),y.push(_[b]);n.push(y)}return n}_handlePoles(t){let n=!1,c=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(c=!0)),(n||c)&&this._fillPoles(t,n,c)}_ensureNoPoleVertices(){let t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){let c=t[n+1];c===Xc&&(t[n+1]=-32767),c===Nh&&(t[n+1]=32766)}}_generatePoleQuad(t,n,c,d,_,y){d>_!=(y===Xc)?(t.push(n),t.push(c),t.push(this._vertexToIndex(d,y)),t.push(c),t.push(this._vertexToIndex(_,y)),t.push(this._vertexToIndex(d,y))):(t.push(c),t.push(n),t.push(this._vertexToIndex(d,y)),t.push(this._vertexToIndex(_,y)),t.push(c),t.push(this._vertexToIndex(d,y)))}_fillPoles(t,n,c){let d=this._vertexBuffer,_=ri,y=t.length;for(let b=2;b<y;b+=3){let w=t[b-2],T=t[b-1],M=t[b],k=d[2*w],z=d[2*w+1],B=d[2*T],j=d[2*T+1],$=d[2*M],Z=d[2*M+1];n&&(z===0&&j===0&&this._generatePoleQuad(t,w,T,k,B,Xc),j===0&&Z===0&&this._generatePoleQuad(t,T,M,B,$,Xc),Z===0&&z===0&&this._generatePoleQuad(t,M,w,$,k,Xc)),c&&(z===_&&j===_&&this._generatePoleQuad(t,w,T,k,B,Nh),j===_&&Z===_&&this._generatePoleQuad(t,T,M,B,$,Nh),Z===_&&z===_&&this._generatePoleQuad(t,M,w,$,k,Nh))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:c,holeIndices:d}=(function(b){let w=[],T=[];for(let M of b)if(M.length!==0){M!==b[0]&&w.push(T.length/2);for(let k=0;k<M.length;k++)T.push(M[k].x),T.push(M[k].y)}return{flattened:T,holeIndices:w}})(t),_;this._initializeVertices(c);try{let b=(function(T,M,k=2){let z=M&&M.length,B=z?M[0]*k:T.length,j=hy(T,0,B,k,!0),$=[];if(!j||j.next===j.prev)return $;let Z,Q,de;if(z&&(j=(function(oe,ce,Ie,Ee){let ze=[];for(let Je=0,qe=ce.length;Je<qe;Je++){let Ke=hy(oe,ce[Je]*Ee,Je<qe-1?ce[Je+1]*Ee:oe.length,Ee,!1);Ke===Ke.next&&(Ke.steiner=!0),ze.push(Nw(Ke))}ze.sort(Bw);for(let Je=0;Je<ze.length;Je++)Ie=jw(ze[Je],Ie);return Ie})(T,M,j,k)),T.length>80*k){Z=T[0],Q=T[1];let oe=Z,ce=Q;for(let Ie=k;Ie<B;Ie+=k){let Ee=T[Ie],ze=T[Ie+1];Ee<Z&&(Z=Ee),ze<Q&&(Q=ze),Ee>oe&&(oe=Ee),ze>ce&&(ce=ze)}de=Math.max(oe-Z,ce-Q),de=de!==0?32767/de:0}return Fh(j,$,k,Z,Q,de,0),$})(c,d),w=this._convertIndices(c,b);_=this._subdivideTrianglesScanline(w)}catch(b){console.error(b)}let y=[];return n&&(y=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:y}}_convertIndices(t,n){let c=[];for(let d=0;d<n.length;d++)c.push(this._vertexToIndex(t[2*n[d]],t[2*n[d]+1]));return c}_pointArrayToIndices(t){let n=[];for(let c=0;c<t.length;c++){let d=t[c];n.push(this._vertexToIndex(d.x,d.y))}return n}}function gy(o,t,n,c=!0){return new $w(n,t).subdividePolygonInternal(o,c)}function Al(o,t,n=!1){if(!o||o.length<1)return[];if(o.length<2)return[];let c=o[0],d=o[o.length-1],_=n&&(c.x!==d.x||c.y!==d.y);if(t<2)return _?[...o,o[0]]:[...o];let y=Math.floor(ri/t),b=[];b.push(new x(o[0].x,o[0].y));let w=o.length,T=_?w:w-1;for(let M=0;M<T;M++){let k=o[M],z=M<w-1?o[M+1]:o[0],B=k.x,j=k.y,$=z.x,Z=z.y,Q=B!==$,de=j!==Z;if(!Q&&!de)continue;let oe=$-B,ce=Z-j,Ie=Math.abs(oe),Ee=Math.abs(ce),ze=B,Je=j;for(;;){let Ke=oe>0?(Math.floor(ze/y)+1)*y:(Math.ceil(ze/y)-1)*y,pt=ce>0?(Math.floor(Je/y)+1)*y:(Math.ceil(Je/y)-1)*y,He=Math.abs(ze-Ke),Xe=Math.abs(Je-pt),ke=Math.abs(ze-$),St=Math.abs(Je-Z),It=Q?He/Ie:Number.POSITIVE_INFINITY,ft=de?Xe/Ee:Number.POSITIVE_INFINITY;if((ke<=He||!Q)&&(St<=Xe||!de))break;if(It<ft&&Q||!de){ze=Ke,Je+=ce*It;let lt=new x(ze,Math.round(Je));b[b.length-1].x===lt.x&&b[b.length-1].y===lt.y||b.push(lt)}else{ze+=oe*ft,Je=pt;let lt=new x(Math.round(ze),Je);b[b.length-1].x===lt.x&&b[b.length-1].y===lt.y||b.push(lt)}}let qe=new x($,Z);b[b.length-1].x===qe.x&&b[b.length-1].y===qe.y||b.push(qe)}return b}function Gw(o,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let c=0,d=o[2*t[0]];for(let w=1;w<t.length;w++){let T=o[2*t[w]];T<d&&(d=T,c=w)}let _=t.length,y=c,b=(y+1)%_;for(;;){let w=y-1>=0?y-1:_-1,T=(b+1)%_,M=o[2*t[w]],k=o[2*t[T]],z=o[2*t[y]],B=o[2*t[y]+1],j=o[2*t[b]+1],$=!1;if(M<k)$=!0;else if(M>k)$=!1;else{let Z=j-B,Q=-(o[2*t[b]]-z),de=B<j?1:-1;((M-z)*Z+(o[2*t[w]+1]-B)*Q)*de>((k-z)*Z+(o[2*t[T]+1]-B)*Q)*de&&($=!0)}if($){let Z=t[w],Q=t[y],de=t[b];Z!==Q&&Z!==de&&Q!==de&&n.push(de,Q,Z),y--,y<0&&(y=_-1)}else{let Z=t[T],Q=t[y],de=t[b];Z!==Q&&Z!==de&&Q!==de&&n.push(de,Q,Z),b++,b>=_&&(b=0)}if(w===T)break}}function _y(o,t,n,c,d,_,y,b,w){let T=d.length/2,M=y&&b&&w;if(T<Lt.MAX_VERTEX_ARRAY_LENGTH){let k=t.prepareSegment(T,n,c),z=k.vertexLength;for(let $=0;$<_.length;$+=3)c.emplaceBack(z+_[$],z+_[$+1],z+_[$+2]);let B,j;k.vertexLength+=T,k.primitiveLength+=_.length/3,M&&(j=y.prepareSegment(T,n,b),B=j.vertexLength,j.vertexLength+=T);for(let $=0;$<d.length;$+=2)o(d[$],d[$+1]);if(M)for(let $=0;$<w.length;$++){let Z=w[$];for(let Q=1;Q<Z.length;Q+=2)b.emplaceBack(B+Z[Q-1],B+Z[Q]);j.primitiveLength+=Z.length/2}}else(function(k,z,B,j,$,Z){let Q=[];for(let Ee=0;Ee<j.length/2;Ee++)Q.push(-1);let de={count:0},oe=0,ce=k.getOrCreateLatestSegment(z,B),Ie=ce.vertexLength;for(let Ee=2;Ee<$.length;Ee+=3){let ze=$[Ee-2],Je=$[Ee-1],qe=$[Ee],Ke=Q[ze]<oe,pt=Q[Je]<oe,He=Q[qe]<oe;ce.vertexLength+((Ke?1:0)+(pt?1:0)+(He?1:0))>Lt.MAX_VERTEX_ARRAY_LENGTH&&(ce=k.createNewSegment(z,B),oe=de.count,Ke=!0,pt=!0,He=!0,Ie=0);let Xe=Vh(Q,j,Z,de,ze,Ke,ce),ke=Vh(Q,j,Z,de,Je,pt,ce),St=Vh(Q,j,Z,de,qe,He,ce);B.emplaceBack(Ie+Xe-oe,Ie+ke-oe,Ie+St-oe),ce.primitiveLength++}})(t,n,c,d,_,o),M&&(function(k,z,B,j,$,Z){let Q=[];for(let Ee=0;Ee<j.length/2;Ee++)Q.push(-1);let de={count:0},oe=0,ce=k.getOrCreateLatestSegment(z,B),Ie=ce.vertexLength;for(let Ee=0;Ee<$.length;Ee++){let ze=$[Ee];for(let Je=1;Je<$[Ee].length;Je+=2){let qe=ze[Je-1],Ke=ze[Je],pt=Q[qe]<oe,He=Q[Ke]<oe;ce.vertexLength+((pt?1:0)+(He?1:0))>Lt.MAX_VERTEX_ARRAY_LENGTH&&(ce=k.createNewSegment(z,B),oe=de.count,pt=!0,He=!0,Ie=0);let Xe=Vh(Q,j,Z,de,qe,pt,ce),ke=Vh(Q,j,Z,de,Ke,He,ce);B.emplaceBack(Ie+Xe-oe,Ie+ke-oe),ce.primitiveLength++}}})(y,n,b,d,w,o),t.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function Vh(o,t,n,c,d,_,y){if(_){let b=c.count;return n(t[2*d],t[2*d+1]),o[d]=c.count,c.count++,y.vertexLength++,b}return o[d]}class dg{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Me,this.indexArray=new si,this.indexArray2=new oi,this.programConfigurations=new cr(t.layers,t.zoom),this.segments=new Lt,this.segments2=new Lt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,c){this.hasPattern=cg("fill",this.layers,n);let d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),y=[];for(let{feature:b,id:w,index:T,sourceLayerIndex:M}of t){let k=this.layers[0]._featureFilter.needGeometry,z=Lo(b,k);if(!this.layers[0]._featureFilter.filter(new xi(this.zoom,{globalState:this.globalState}),z,c))continue;let B=_?d.evaluate(z,{},c,n.availableImages):void 0,j={id:w,properties:b.properties,type:b.type,sourceLayerIndex:M,index:T,geometry:k?z.geometry:ca(b),patterns:{},sortKey:B};y.push(j)}_&&y.sort((b,w)=>b.sortKey-w.sortKey);for(let b of y){let{geometry:w,index:T,sourceLayerIndex:M}=b;if(this.hasPattern){let k=ug("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(b,w,T,c,{},n.subdivisionGranularity);n.featureIndex.insert(t[T].feature,w,T,M,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}addFeatures(t,n,c){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,c,d,_,y){for(let b of dl(n,500)){let w=gy(b,d,y.fill.getGranularityForZoomLevel(d.z)),T=this.layoutVertexArray;_y((M,k)=>{T.emplaceBack(M,k)},this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles,this.segments2,this.indexArray2,w.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,d)}}let yy,vy;tt("FillBucket",dg,{omit:["layers","patternFeatures"]});var qw={get paint(){return vy=vy||new Un({"fill-antialias":new ut(ve.paint_fill["fill-antialias"]),"fill-opacity":new bt(ve.paint_fill["fill-opacity"]),"fill-color":new bt(ve.paint_fill["fill-color"]),"fill-outline-color":new bt(ve.paint_fill["fill-outline-color"]),"fill-translate":new ut(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Uc(ve.paint_fill["fill-pattern"])})},get layout(){return yy=yy||new Un({"fill-sort-key":new bt(ve.layout_fill["fill-sort-key"])})}};class Ww extends xr{constructor(t){super(t,qw)}recalculate(t,n){super.recalculate(t,n);let c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new dg(t)}queryRadius(){return Md(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:c,pixelsToTileUnits:d}){return J_(Ed(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-c.bearingInRadians,d),n)}isTileClipped(){return!0}}let Zw=Oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Hw=Oi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Kw}=Zw;class Jc{constructor(t,n,c,d,_){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=_,t.readFields(Xw,this,n)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let n=t.readVarint()+t.pos,c=[],d,_=1,y=0,b=0,w=0;for(;t.pos<n;){if(y<=0){let T=t.readVarint();_=7&T,y=T>>3}if(y--,_===1||_===2)b+=t.readSVarint(),w+=t.readSVarint(),_===1&&(d&&c.push(d),d=[]),d&&d.push(new x(b,w));else{if(_!==7)throw new Error(`unknown command ${_}`);d&&d.push(d[0].clone())}}return d&&c.push(d),c}bbox(){let t=this._pbf;t.pos=this._geometry;let n=t.readVarint()+t.pos,c=1,d=0,_=0,y=0,b=1/0,w=-1/0,T=1/0,M=-1/0;for(;t.pos<n;){if(d<=0){let k=t.readVarint();c=7&k,d=k>>3}if(d--,c===1||c===2)_+=t.readSVarint(),y+=t.readSVarint(),_<b&&(b=_),_>w&&(w=_),y<T&&(T=y),y>M&&(M=y);else if(c!==7)throw new Error(`unknown command ${c}`)}return[b,T,w,M]}toGeoJSON(t,n,c){let d=this.extent*Math.pow(2,c),_=this.extent*t,y=this.extent*n,b=this.loadGeometry();function w(z){return[360*(z.x+_)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(z.y+y)/d)*Math.PI))-90]}function T(z){return z.map(w)}let M;if(this.type===1){let z=[];for(let j of b)z.push(j[0]);let B=T(z);M=z.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){let z=b.map(T);M=z.length===1?{type:"LineString",coordinates:z[0]}:{type:"MultiLineString",coordinates:z}}else{if(this.type!==3)throw new Error("unknown feature type");{let z=(function(j){let $=j.length;if($<=1)return[j];let Z=[],Q,de;for(let oe=0;oe<$;oe++){let ce=Jw(j[oe]);ce!==0&&(de===void 0&&(de=ce<0),de===ce<0?(Q&&Z.push(Q),Q=[j[oe]]):Q&&Q.push(j[oe]))}return Q&&Z.push(Q),Z})(b),B=[];for(let j of z)B.push(j.map(T));M=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}let k={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(k.id=this.id),k}}function Xw(o,t,n){o===1?t.id=n.readVarint():o===2?(function(c,d){let _=c.readVarint()+c.pos;for(;c.pos<_;){let y=d._keys[c.readVarint()],b=d._values[c.readVarint()];d.properties[y]=b}})(n,t):o===3?t.type=n.readVarint():o===4&&(t._geometry=n.pos)}function Jw(o){let t=0;for(let n,c,d=0,_=o.length,y=_-1;d<_;y=d++)n=o[d],c=o[y],t+=(c.x-n.x)*(n.y+c.y);return t}Jc.types=["Unknown","Point","LineString","Polygon"];class xy{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Yw,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let n=this._pbf.readVarint()+this._pbf.pos;return new Jc(this._pbf,n,this.extent,this._keys,this._values)}}function Yw(o,t,n){o===15?t.version=n.readVarint():o===1?t.name=n.readString():o===5?t.extent=n.readVarint():o===2?t._features.push(n.pos):o===3?t._keys.push(n.readString()):o===4&&t._values.push((function(c){let d=null,_=c.readVarint()+c.pos;for(;c.pos<_;){let y=c.readVarint()>>3;d=y===1?c.readString():y===2?c.readFloat():y===3?c.readDouble():y===4?c.readVarint64():y===5?c.readVarint():y===6?c.readSVarint():y===7?c.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(n))}class by{constructor(t,n){this.layers=t.readFields(Qw,{},n)}}function Qw(o,t,n){if(o===3){let c=new xy(n,n.readVarint()+n.pos);c.length&&(t[c.name]=c)}}let mg=Math.pow(2,13);function $h(o,t,n,c,d,_,y,b){o.emplaceBack(t,n,2*Math.floor(c*mg)+y,d*mg*2,_*mg*2,Math.round(b))}class fg{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new we,this.centroidVertexArray=new ie,this.indexArray=new si,this.programConfigurations=new cr(t.layers,t.zoom),this.segments=new Lt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,c){this.features=[],this.hasPattern=cg("fill-extrusion",this.layers,n);for(let{feature:d,id:_,index:y,sourceLayerIndex:b}of t){let w=this.layers[0]._featureFilter.needGeometry,T=Lo(d,w);if(!this.layers[0]._featureFilter.filter(new xi(this.zoom,{globalState:this.globalState}),T,c))continue;let M={id:_,sourceLayerIndex:b,index:y,geometry:w?T.geometry:ca(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(ug("fill-extrusion",this.layers,M,this.zoom,n)):this.addFeature(M,M.geometry,y,c,{},n.subdivisionGranularity),n.featureIndex.insert(d,M.geometry,y,b,this.index,!0)}}addFeatures(t,n,c){for(let d of this.features){let{geometry:_}=d;this.addFeature(d,_,d.index,n,c,t.subdivisionGranularity)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kw),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Hw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,c,d,_,y){for(let b of dl(n,500)){let w={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(w,d,t,b,y);let M=this.layoutVertexArray.length-T,k=Math.floor(w.x/w.sampleCount),z=Math.floor(w.y/w.sampleCount);for(let B=0;B<M;B++)this.centroidVertexArray.emplaceBack(k,z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,d)}processPolygon(t,n,c,d,_){if(d.length<1||wy(d[0]))return;for(let k of d)k.length!==0&&e2(t,k);let y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},b=_.fill.getGranularityForZoomLevel(n.z),w=Jc.types[c.type]==="Polygon";for(let k of d){if(k.length===0||wy(k))continue;let z=Al(k,b,w);this._generateSideFaces(z,y)}if(!w)return;let T=gy(d,n,b,!1),M=this.layoutVertexArray;_y((k,z)=>{$h(M,k,z,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(t,n){let c=0;for(let d=1;d<t.length;d++){let _=t[d],y=t[d-1];if(t2(_,y))continue;n.segment.vertexLength+4>Lt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let b=_.sub(y)._perp()._unit(),w=y.dist(_);c+w>32768&&(c=0),$h(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,0,c),$h(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,1,c),c+=w,$h(this.layoutVertexArray,y.x,y.y,b.x,b.y,0,0,c),$h(this.layoutVertexArray,y.x,y.y,b.x,b.y,0,1,c);let T=n.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function e2(o,t){for(let n=0;n<t.length;n++){let c=t[n];n===t.length-1&&t[0].x===c.x&&t[0].y===c.y||(o.x+=c.x,o.y+=c.y,o.sampleCount++)}}function t2(o,t){return o.x===t.x&&(o.x<0||o.x>ri)||o.y===t.y&&(o.y<0||o.y>ri)}function wy(o){return o.every(t=>t.x<0)||o.every(t=>t.x>ri)||o.every(t=>t.y<0)||o.every(t=>t.y>ri)}let Sy;tt("FillExtrusionBucket",fg,{omit:["layers","features"]});var i2={get paint(){return Sy=Sy||new Un({"fill-extrusion-opacity":new ut(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bt(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Uc(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bt(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bt(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ut(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class n2 extends xr{constructor(t){super(t,i2)}createBucket(t){return new fg(t)}queryRadius(){return Md(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:d,transform:_,pixelsToTileUnits:y,pixelPosMatrix:b}){let w=Ed(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,y),T=this.paint.get("fill-extrusion-height").evaluate(n,c),M=this.paint.get("fill-extrusion-base").evaluate(n,c),k=(function(B,j){let $=[];for(let Z of B){let Q=[Z.x,Z.y,0,1];To(Q,Q,j),$.push(new x(Q[0]/Q[3],Q[1]/Q[3]))}return $})(w,b),z=(function(B,j,$,Z){let Q=[],de=[],oe=Z[8]*j,ce=Z[9]*j,Ie=Z[10]*j,Ee=Z[11]*j,ze=Z[8]*$,Je=Z[9]*$,qe=Z[10]*$,Ke=Z[11]*$;for(let pt of B){let He=[],Xe=[];for(let ke of pt){let St=ke.x,It=ke.y,ft=Z[0]*St+Z[4]*It+Z[12],lt=Z[1]*St+Z[5]*It+Z[13],Wt=Z[2]*St+Z[6]*It+Z[14],Ei=Z[3]*St+Z[7]*It+Z[15],an=Wt+Ie,An=Ei+Ee,Zr=ft+ze,hr=lt+Je,xn=Wt+qe,Ii=Ei+Ke,pn=new x((ft+oe)/An,(lt+ce)/An);pn.z=an/An,He.push(pn);let bn=new x(Zr/Ii,hr/Ii);bn.z=xn/Ii,Xe.push(bn)}Q.push(He),de.push(Xe)}return[Q,de]})(d,M,T,b);return(function(B,j,$){let Z=1/0;J_($,j)&&(Z=Iy($,j[0]));for(let Q=0;Q<j.length;Q++){let de=j[Q],oe=B[Q];for(let ce=0;ce<de.length-1;ce++){let Ie=de[ce],Ee=[Ie,de[ce+1],oe[ce+1],oe[ce],Ie];X_($,Ee)&&(Z=Math.min(Z,Iy($,Ee)))}}return Z!==1/0&&Z})(z[0],z[1],k)}}function Gh(o,t){return o.x*t.x+o.y*t.y}function Iy(o,t){if(o.length===1){let n=0,c=t[n++],d;for(;!d||c.equals(d);)if(d=t[n++],!d)return 1/0;for(;n<t.length;n++){let _=t[n],y=o[0],b=d.sub(c),w=_.sub(c),T=y.sub(c),M=Gh(b,b),k=Gh(b,w),z=Gh(w,w),B=Gh(T,b),j=Gh(T,w),$=M*z-k*k,Z=(z*B-k*j)/$,Q=(M*j-k*B)/$,de=c.z*(1-Z-Q)+d.z*Z+_.z*Q;if(isFinite(de))return de}return 1/0}{let n=1/0;for(let c of t)n=Math.min(n,c.z);return n}}let r2=Oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:o2}=r2,a2=Oi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:s2}=a2,l2=Math.cos(Math.PI/180*37.5),Ty=Math.pow(2,14)/.5;class gg{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Se,this.layoutVertexArray2=new Pe,this.indexArray=new si,this.programConfigurations=new cr(t.layers,t.zoom),this.segments=new Lt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,c){this.hasPattern=cg("line",this.layers,n);let d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),y=[];for(let{feature:b,id:w,index:T,sourceLayerIndex:M}of t){let k=this.layers[0]._featureFilter.needGeometry,z=Lo(b,k);if(!this.layers[0]._featureFilter.filter(new xi(this.zoom,{globalState:this.globalState}),z,c))continue;let B=_?d.evaluate(z,{},c):void 0,j={id:w,properties:b.properties,type:b.type,sourceLayerIndex:M,index:T,geometry:k?z.geometry:ca(b),patterns:{},sortKey:B};y.push(j)}_&&y.sort((b,w)=>b.sortKey-w.sortKey);for(let b of y){let{geometry:w,index:T,sourceLayerIndex:M}=b;if(this.hasPattern){let k=ug("line",this.layers,b,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(b,w,T,c,{},n.subdivisionGranularity);n.featureIndex.insert(t[T].feature,w,T,M,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}addFeatures(t,n,c){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,s2)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,o2),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,c,d,_,y){let b=this.layers[0].layout,w=b.get("line-join").evaluate(t,{}),T=b.get("line-cap"),M=b.get("line-miter-limit"),k=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let z of n)this.addLine(z,t,w,T,M,k,d,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,d)}addLine(t,n,c,d,_,y,b,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Al(t,b?w.line.getGranularityForZoomLevel(b.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<t.length-1;oe++)this.totalDistance+=t[oe].dist(t[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let T=Jc.types[n.type]==="Polygon",M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let k=0;for(;k<M-1&&t[k].equals(t[k+1]);)k++;if(M<(T?3:2))return;c==="bevel"&&(_=1.05);let z=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray),j,$,Z,Q,de;this.e1=this.e2=-1,T&&(j=t[M-2],de=t[k].sub(j)._unit()._perp());for(let oe=k;oe<M;oe++){if(Z=oe===M-1?T?t[k+1]:void 0:t[oe+1],Z&&t[oe].equals(Z))continue;de&&(Q=de),j&&($=j),j=t[oe],de=Z?Z.sub(j)._unit()._perp():Q,Q=Q||de;let ce=Q.add(de);ce.x===0&&ce.y===0||ce._unit();let Ie=Q.x*de.x+Q.y*de.y,Ee=ce.x*de.x+ce.y*de.y,ze=Ee!==0?1/Ee:1/0,Je=2*Math.sqrt(2-2*Ee),qe=Ee<l2&&$&&Z,Ke=Q.x*de.y-Q.y*de.x>0;if(qe&&oe>k){let Xe=j.dist($);if(Xe>2*z){let ke=j.sub(j.sub($)._mult(z/Xe)._round());this.updateDistance($,ke),this.addCurrentVertex(ke,Q,0,0,B),$=ke}}let pt=$&&Z,He=pt?c:T?"butt":d;if(pt&&He==="round"&&(ze<y?He="miter":ze<=2&&(He="fakeround")),He==="miter"&&ze>_&&(He="bevel"),He==="bevel"&&(ze>2&&(He="flipbevel"),ze<_&&(He="miter")),$&&this.updateDistance($,j),He==="miter")ce._mult(ze),this.addCurrentVertex(j,ce,0,0,B);else if(He==="flipbevel"){if(ze>100)ce=de.mult(-1);else{let Xe=ze*Q.add(de).mag()/Q.sub(de).mag();ce._perp()._mult(Xe*(Ke?-1:1))}this.addCurrentVertex(j,ce,0,0,B),this.addCurrentVertex(j,ce.mult(-1),0,0,B)}else if(He==="bevel"||He==="fakeround"){let Xe=-Math.sqrt(ze*ze-1),ke=Ke?Xe:0,St=Ke?0:Xe;if($&&this.addCurrentVertex(j,Q,ke,St,B),He==="fakeround"){let It=Math.round(180*Je/Math.PI/20);for(let ft=1;ft<It;ft++){let lt=ft/It;if(lt!==.5){let Ei=lt-.5;lt+=lt*Ei*(lt-1)*((1.0904+Ie*(Ie*(3.55645-1.43519*Ie)-3.2452))*Ei*Ei+(.848013+Ie*(.215638*Ie-1.06021)))}let Wt=de.sub(Q)._mult(lt)._add(Q)._unit()._mult(Ke?-1:1);this.addHalfVertex(j,Wt.x,Wt.y,!1,Ke,0,B)}}Z&&this.addCurrentVertex(j,de,-ke,-St,B)}else if(He==="butt")this.addCurrentVertex(j,ce,0,0,B);else if(He==="square"){let Xe=$?1:-1;this.addCurrentVertex(j,ce,Xe,Xe,B)}else He==="round"&&($&&(this.addCurrentVertex(j,Q,0,0,B),this.addCurrentVertex(j,Q,1,1,B,!0)),Z&&(this.addCurrentVertex(j,de,-1,-1,B,!0),this.addCurrentVertex(j,de,0,0,B)));if(qe&&oe<M-1){let Xe=j.dist(Z);if(Xe>2*z){let ke=j.add(Z.sub(j)._mult(z/Xe)._round());this.updateDistance(j,ke),this.addCurrentVertex(ke,de,0,0,B),j=ke}}}}addCurrentVertex(t,n,c,d,_,y=!1){let b=n.y*d-n.x,w=-n.y-n.x*d;this.addHalfVertex(t,n.x+n.y*c,n.y-n.x*c,y,!1,c,_),this.addHalfVertex(t,b,w,y,!0,-d,_),this.distance>Ty/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,c,d,_,y))}addHalfVertex({x:t,y:n},c,d,_,y,b,w){let T=.5*(this.lineClips?this.scaledDistance*(Ty-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(n<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let M=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,M,this.e2),w.primitiveLength++),y?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let Cy,Py;tt("LineBucket",gg,{omit:["layers","patternFeatures"]});var My={get paint(){return Py=Py||new Un({"line-opacity":new bt(ve.paint_line["line-opacity"]),"line-color":new bt(ve.paint_line["line-color"]),"line-translate":new ut(ve.paint_line["line-translate"]),"line-translate-anchor":new ut(ve.paint_line["line-translate-anchor"]),"line-width":new bt(ve.paint_line["line-width"]),"line-gap-width":new bt(ve.paint_line["line-gap-width"]),"line-offset":new bt(ve.paint_line["line-offset"]),"line-blur":new bt(ve.paint_line["line-blur"]),"line-dasharray":new ra(ve.paint_line["line-dasharray"]),"line-pattern":new Uc(ve.paint_line["line-pattern"]),"line-gradient":new Nc(ve.paint_line["line-gradient"])})},get layout(){return Cy=Cy||new Un({"line-cap":new ut(ve.layout_line["line-cap"]),"line-join":new bt(ve.layout_line["line-join"]),"line-miter-limit":new ut(ve.layout_line["line-miter-limit"]),"line-round-limit":new ut(ve.layout_line["line-round-limit"]),"line-sort-key":new bt(ve.layout_line["line-sort-key"])})}};class c2 extends bt{possiblyEvaluate(t,n){return n=new xi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,c,d){return n=_r({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,c,d)}}let Dd;class u2 extends xr{constructor(t){super(t,My),this.gradientVersion=0,Dd||(Dd=new c2(My.paint.properties["line-width"].specification),Dd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let n=this.gradientExpression();this.stepInterpolant=!!(function(c){return c._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof zi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Dd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new gg(t)}queryRadius(t){let n=t,c=Ey(zh("line-width",this,n),zh("line-gap-width",this,n)),d=zh("line-offset",this,n);return c/2+Math.abs(d)+Md(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:d,transform:_,pixelsToTileUnits:y}){let b=Ed(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,y),w=y/2*Ey(this.paint.get("line-width").evaluate(n,c),this.paint.get("line-gap-width").evaluate(n,c)),T=this.paint.get("line-offset").evaluate(n,c);return T&&(d=(function(M,k){let z=[];for(let B=0;B<M.length;B++){let j=M[B],$=[];for(let Z=0;Z<j.length;Z++){let Q=j[Z-1],de=j[Z],oe=j[Z+1],ce=Z===0?new x(0,0):de.sub(Q)._unit()._perp(),Ie=Z===j.length-1?new x(0,0):oe.sub(de)._unit()._perp(),Ee=ce._add(Ie)._unit(),ze=Ee.x*Ie.x+Ee.y*Ie.y;ze!==0&&Ee._mult(1/ze),$.push(Ee._mult(k)._add(de))}z.push($)}return z})(d,T*y)),(function(M,k,z){for(let B=0;B<k.length;B++){let j=k[B];if(M.length>=3){for(let $=0;$<j.length;$++)if(Zc(M,j[$]))return!0}if(bw(M,j,z))return!0}return!1})(b,d,w)}isTileClipped(){return!0}}function Ey(o,t){return t>0?t+2*o:o}let h2=Oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),p2=Oi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let d2=Oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Oi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let Ay=Oi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),m2=Oi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function f2(o,t,n){return o.sections.forEach(c=>{c.text=(function(d,_,y){let b=_.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),Vr.applyArabicShaping&&(d=Vr.applyArabicShaping(d)),d})(c.text,t,n)}),o}Oi([{name:"triangle",components:3,type:"Uint16"}]),Oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Oi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Oi([{type:"Float32",name:"offsetX"}]),Oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Oi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let qh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var hn=24;let _g=4294967296,ky=1/_g,Ly=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class yg{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,c=this.length){for(;this.pos<c;){let d=this.readVarint(),_=d>>3,y=this.pos;this.type=7&d,t(_,n,this),this.pos===y&&this.skip(d)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*_g;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*_g;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let n=this.buf,c,d;return d=n[this.pos++],c=127&d,d<128?c:(d=n[this.pos++],c|=(127&d)<<7,d<128?c:(d=n[this.pos++],c|=(127&d)<<14,d<128?c:(d=n[this.pos++],c|=(127&d)<<21,d<128?c:(d=n[this.pos],c|=(15&d)<<28,(function(_,y,b){let w=b.buf,T,M;if(M=w[b.pos++],T=(112&M)>>4,M<128||(M=w[b.pos++],T|=(127&M)<<3,M<128)||(M=w[b.pos++],T|=(127&M)<<10,M<128)||(M=w[b.pos++],T|=(127&M)<<17,M<128)||(M=w[b.pos++],T|=(127&M)<<24,M<128)||(M=w[b.pos++],T|=(1&M)<<31,M<128))return Yc(_,T,y);throw new Error("Expected varint not more than 10 bytes")})(c,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&Ly?Ly.decode(this.buf.subarray(n,t)):(function(c,d,_){let y="",b=d;for(;b<_;){let w=c[b],T,M,k,z=null,B=w>239?4:w>223?3:w>191?2:1;if(b+B>_)break;B===1?w<128&&(z=w):B===2?(T=c[b+1],(192&T)==128&&(z=(31&w)<<6|63&T,z<=127&&(z=null))):B===3?(T=c[b+1],M=c[b+2],(192&T)==128&&(192&M)==128&&(z=(15&w)<<12|(63&T)<<6|63&M,(z<=2047||z>=55296&&z<=57343)&&(z=null))):B===4&&(T=c[b+1],M=c[b+2],k=c[b+3],(192&T)==128&&(192&M)==128&&(192&k)==128&&(z=(15&w)<<18|(63&T)<<12|(63&M)<<6|63&k,(z<=65535||z>=1114112)&&(z=null))),z===null?(z=65533,B=1):z>65535&&(z-=65536,y+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),y+=String.fromCharCode(z),b+=B}return y})(this.buf,n,t)}readBytes(){let t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){let c=this.readPackedEnd();for(;this.pos<c;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){let n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){let c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ky),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*ky),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(n,c){let d,_;if(n>=0?(d=n%4294967296|0,_=n/4294967296|0):(d=~(-n%4294967296),_=~(-n/4294967296),4294967295^d?d=d+1|0:(d=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),(function(y,b,w){w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,w.buf[w.pos]=127&(y>>>=7)})(d,0,c),(function(y,b){let w=(7&y)<<4;b.buf[b.pos++]|=w|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))})(_,c)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;let n=this.pos;this.pos=(function(d,_,y){for(let b,w,T=0;T<_.length;T++){if(b=_.charCodeAt(T),b>55295&&b<57344){if(!w){b>56319||T+1===_.length?(d[y++]=239,d[y++]=191,d[y++]=189):w=b;continue}if(b<56320){d[y++]=239,d[y++]=191,d[y++]=189,w=b;continue}b=w-55296<<10|b-56320|65536,w=null}else w&&(d[y++]=239,d[y++]=191,d[y++]=189,w=null);b<128?d[y++]=b:(b<2048?d[y++]=b>>6|192:(b<65536?d[y++]=b>>12|224:(d[y++]=b>>18|240,d[y++]=b>>12&63|128),d[y++]=b>>6&63|128),d[y++]=63&b|128)}return y})(this.buf,t,this.pos);let c=this.pos-n;c>=128&&Dy(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let n=t.length;this.writeVarint(n),this.realloc(n);for(let c=0;c<n;c++)this.buf[this.pos++]=t[c]}writeRawMessage(t,n){this.pos++;let c=this.pos;t(n,this);let d=this.pos-c;d>=128&&Dy(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d}writeMessage(t,n,c){this.writeTag(t,2),this.writeRawMessage(n,c)}writePackedVarint(t,n){n.length&&this.writeMessage(t,g2,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,_2,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,x2,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,y2,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,v2,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,b2,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,w2,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,S2,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,I2,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function Yc(o,t,n){return n?4294967296*t+(o>>>0):4294967296*(t>>>0)+(o>>>0)}function Dy(o,t,n){let c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(c);for(let d=n.pos-1;d>=o;d--)n.buf[d+c]=n.buf[d]}function g2(o,t){for(let n=0;n<o.length;n++)t.writeVarint(o[n])}function _2(o,t){for(let n=0;n<o.length;n++)t.writeSVarint(o[n])}function y2(o,t){for(let n=0;n<o.length;n++)t.writeFloat(o[n])}function v2(o,t){for(let n=0;n<o.length;n++)t.writeDouble(o[n])}function x2(o,t){for(let n=0;n<o.length;n++)t.writeBoolean(o[n])}function b2(o,t){for(let n=0;n<o.length;n++)t.writeFixed32(o[n])}function w2(o,t){for(let n=0;n<o.length;n++)t.writeSFixed32(o[n])}function S2(o,t){for(let n=0;n<o.length;n++)t.writeFixed64(o[n])}function I2(o,t){for(let n=0;n<o.length;n++)t.writeSFixed64(o[n])}function T2(o,t,n){o===1&&n.readMessage(C2,t)}function C2(o,t,n){if(o===3){let{id:c,bitmap:d,width:_,height:y,left:b,top:w,advance:T}=n.readMessage(P2,{});t.push({id:c,bitmap:new Oh({width:_+6,height:y+6},d),metrics:{width:_,height:y,left:b,top:w,advance:T}})}}function P2(o,t,n){o===1?t.id=n.readVarint():o===2?t.bitmap=n.readBytes():o===3?t.width=n.readVarint():o===4?t.height=n.readVarint():o===5?t.left=n.readSVarint():o===6?t.top=n.readSVarint():o===7&&(t.advance=n.readVarint())}function Ry(o){let t=0,n=0;for(let y of o)t+=y.w*y.h,n=Math.max(n,y.w);o.sort((y,b)=>b.h-y.h);let c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}],d=0,_=0;for(let y of o)for(let b=c.length-1;b>=0;b--){let w=c[b];if(!(y.w>w.w||y.h>w.h)){if(y.x=w.x,y.y=w.y,_=Math.max(_,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===w.w&&y.h===w.h){let T=c.pop();T&&b<c.length&&(c[b]=T)}else y.h===w.h?(w.x+=y.w,w.w-=y.w):y.w===w.w?(w.y+=y.h,w.h-=y.h):(c.push({x:w.x+y.w,y:w.y,w:w.w-y.w,h:y.h}),w.y+=y.h,w.h-=y.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}class vg{constructor(t,{pixelRatio:n,version:c,stretchX:d,stretchY:_,content:y,textFitWidth:b,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=d,this.stretchY=_,this.content=y,this.version=c,this.textFitWidth=b,this.textFitHeight=w}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class zy{constructor(t,n){let c={},d={};this.haveRenderCallbacks=[];let _=[];this.addImages(t,c,_),this.addImages(n,d,_);let{w:y,h:b}=Ry(_),w=new ur({width:y||1,height:b||1});for(let T in t){let M=t[T],k=c[T].paddedRect;ur.copy(M.data,w,{x:0,y:0},{x:k.x+1,y:k.y+1},M.data)}for(let T in n){let M=n[T],k=d[T].paddedRect,z=k.x+1,B=k.y+1,j=M.data.width,$=M.data.height;ur.copy(M.data,w,{x:0,y:0},{x:z,y:B},M.data),ur.copy(M.data,w,{x:0,y:$-1},{x:z,y:B-1},{width:j,height:1}),ur.copy(M.data,w,{x:0,y:0},{x:z,y:B+$},{width:j,height:1}),ur.copy(M.data,w,{x:j-1,y:0},{x:z-1,y:B},{width:1,height:$}),ur.copy(M.data,w,{x:0,y:0},{x:z+j,y:B},{width:1,height:$})}this.image=w,this.iconPositions=c,this.patternPositions=d}addImages(t,n,c){for(let d in t){let _=t[d],y={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(y),n[d]=new vg(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),n),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),n)}patchUpdatedImage(t,n,c){if(!t||!n||t.version===n.version)return;t.version=n.version;let[d,_]=t.tl;c.update(n.data,void 0,{x:d,y:_})}}var ks;tt("ImagePosition",vg),tt("ImageAtlas",zy),u.ao=void 0,(ks=u.ao||(u.ao={}))[ks.none=0]="none",ks[ks.horizontal=1]="horizontal",ks[ks.vertical=2]="vertical",ks[ks.horizontalOnly=3]="horizontalOnly";class Wh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,c){let d=new Wh;return d.scale=t||1,d.fontStack=n,d.verticalAlign=c||"bottom",d}static forImage(t,n){let c=new Wh;return c.imageName=t,c.verticalAlign=n||"bottom",c}}class Qc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){let c=new Qc;for(let d=0;d<t.sections.length;d++){let _=t.sections[d];_.image?c.addImageSection(_):c.addTextSection(_,n)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let n="";for(let c=0;c<t.length;c++){let d=t.charCodeAt(c+1)||null,_=t.charCodeAt(c-1)||null;n+=d&&vd(d)&&!qh[t[c+1]]||_&&vd(_)&&!qh[t[c-1]]||!qh[t[c]]?t[c]:qh[t[c]]}return n})(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&zd[this.text.charCodeAt(c)];c++)t++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&zd[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){let c=new Qc;return c.text=this.text.substring(t,n),c.sectionIndex=this.sectionIndex.slice(t,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}getMaxImageSize(t){let n=0,c=0;for(let d=0;d<this.length();d++){let _=this.getSection(d);if(_.imageName){let y=t[_.imageName];if(!y)continue;let b=y.displaySize;n=Math.max(n,b[0]),c=Math.max(c,b[1])}}return{maxImageWidth:n,maxImageHeight:c}}addTextSection(t,n){this.text+=t.text,this.sections.push(Wh.forText(t.scale,t.fontStack||n,t.verticalAlign));let c=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(c)}addImageSection(t){let n=t.image?t.image.name:"";if(n.length===0)return void Ni("Can't add FormattedSection with an empty image.");let c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Wh.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ni("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Rd(o,t,n,c,d,_,y,b,w,T,M,k,z,B,j){let $=Qc.fromFeature(o,d),Z;k===u.ao.vertical&&$.verticalizePunctuation();let{processBidirectionalText:Q,processStyledBidirectionalText:de}=Vr;if(Q&&$.sections.length===1){Z=[];let Ie=Q($.toString(),xg($,T,_,t,c,B));for(let Ee of Ie){let ze=new Qc;ze.text=Ee,ze.sections=$.sections;for(let Je=0;Je<Ee.length;Je++)ze.sectionIndex.push(0);Z.push(ze)}}else if(de){Z=[];let Ie=de($.text,$.sectionIndex,xg($,T,_,t,c,B));for(let Ee of Ie){let ze=new Qc;ze.text=Ee[0],ze.sectionIndex=Ee[1],ze.sections=$.sections,Z.push(ze)}}else Z=(function(Ie,Ee){let ze=[],Je=Ie.text,qe=0;for(let Ke of Ee)ze.push(Ie.substring(qe,Ke)),qe=Ke;return qe<Je.length&&ze.push(Ie.substring(qe,Je.length)),ze})($,xg($,T,_,t,c,B));let oe=[],ce={positionedLines:oe,text:$.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:k,iconsInText:!1,verticalizable:!1};return(function(Ie,Ee,ze,Je,qe,Ke,pt,He,Xe,ke,St,It){let ft=0,lt=0,Wt=0,Ei=0,an=He==="right"?1:He==="left"?0:.5,An=hn/It,Zr=0;for(let Ii of qe){Ii.trim();let pn=Ii.getMaxScale(),bn={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[Zr]=bn;let wn=bn.positionedGlyphs,er=0;if(!Ii.length()){lt+=Ke,++Zr;continue}let Hr=k2(Je,Ii,An);for(let pr=0;pr<Ii.length();pr++){let sn=Ii.getSection(pr),mn=Ii.getSectionIndex(pr),fn=Ii.getCharCode(pr),Ji=L2(Xe,St,fn),yi;if(sn.imageName){if(Ie.iconsInText=!0,sn.scale=sn.scale*An,yi=R2(sn,Ji,pn,Hr,Je),!yi)continue;er=Math.max(er,yi.imageOffset)}else if(yi=D2(sn,fn,Ji,Hr,Ee,ze),!yi)continue;let{rect:Do,metrics:nu,baselineOffset:Ro}=yi;wn.push({glyph:fn,imageName:sn.imageName,x:ft,y:lt+Ro+-17,vertical:Ji,scale:sn.scale,fontStack:sn.fontStack,sectionIndex:mn,metrics:nu,rect:Do}),Ji?(Ie.verticalizable=!0,ft+=(sn.imageName?nu.advance:hn)*sn.scale+ke):ft+=nu.advance*sn.scale+ke}wn.length!==0&&(Wt=Math.max(ft-ke,Wt),z2(wn,0,wn.length-1,an)),ft=0,bn.lineOffset=Math.max(er,(pn-1)*hn);let dn=Ke*pn+er;lt+=dn,Ei=Math.max(dn,Ei),++Zr}let{horizontalAlign:hr,verticalAlign:xn}=bg(pt);(function(Ii,pn,bn,wn,er,Hr,dn,pr,sn){let mn=(pn-bn)*er,fn=0;fn=Hr!==dn?-pr*wn- -17:-wn*sn*dn+.5*dn;for(let Ji of Ii)for(let yi of Ji.positionedGlyphs)yi.x+=mn,yi.y+=fn})(Ie.positionedLines,an,hr,xn,Wt,Ei,Ke,lt,qe.length),Ie.top+=-xn*lt,Ie.bottom=Ie.top+lt,Ie.left+=-hr*Wt,Ie.right=Ie.left+Wt})(ce,t,n,c,Z,y,b,w,k,T,z,j),!(function(Ie){for(let Ee of Ie)if(Ee.positionedGlyphs.length!==0)return!1;return!0})(oe)&&ce}let zd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},M2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},E2={40:!0};function Oy(o,t,n,c,d,_){if(t.imageName){let y=c[t.imageName];return y?y.displaySize[0]*t.scale*hn/_+d:0}{let y=n[t.fontStack],b=y&&y[o];return b?b.metrics.advance*t.scale+d:0}}function Fy(o,t,n,c){let d=Math.pow(o-t,2);return c?o<t?d/2:2*d:d+Math.abs(n)*n}function A2(o,t,n){let c=0;return o===10&&(c-=1e4),n&&(c+=150),o!==40&&o!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function By(o,t,n,c,d,_){let y=null,b=Fy(t,n,d,_);for(let w of c){let T=Fy(t-w.x,n,d,_)+w.badness;T<=b&&(y=w,b=T)}return{index:o,x:t,priorBreak:y,badness:b}}function jy(o){return o?jy(o.priorBreak).concat(o.index):[]}function xg(o,t,n,c,d,_){if(!o)return[];let y=[],b=(function(k,z,B,j,$,Z){let Q=0;for(let de=0;de<k.length();de++){let oe=k.getSection(de);Q+=Oy(k.getCharCode(de),oe,j,$,z,Z)}return Q/Math.max(1,Math.ceil(Q/B))})(o,t,n,c,d,_),w=o.text.indexOf("\u200B")>=0,T=0;for(let k=0;k<o.length();k++){let z=o.getSection(k),B=o.getCharCode(k);if(zd[B]||(T+=Oy(B,z,c,d,t,_)),k<o.length()-1){let j=!((M=B)<11904)&&(!!qt["CJK Compatibility Forms"](M)||!!qt["CJK Compatibility"](M)||!!qt["CJK Strokes"](M)||!!qt["CJK Symbols and Punctuation"](M)||!!qt["Enclosed CJK Letters and Months"](M)||!!qt["Halfwidth and Fullwidth Forms"](M)||!!qt["Ideographic Description Characters"](M)||!!qt["Vertical Forms"](M)||Ih.test(String.fromCodePoint(M)));(M2[B]||j||z.imageName||k!==o.length()-2&&E2[o.getCharCode(k+1)])&&y.push(By(k+1,T,b,y,A2(B,o.getCharCode(k+1),j&&w),!1))}}var M;return jy(By(o.length(),T,b,y,0,!0))}function bg(o){let t=.5,n=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function k2(o,t,n){let c=t.getMaxScale()*hn,{maxImageWidth:d,maxImageHeight:_}=t.getMaxImageSize(o),y=Math.max(c,_*n);return{verticalLineContentWidth:Math.max(c,d*n),horizontalLineContentHeight:y}}function Uy(o){switch(o){case"top":return 0;case"center":return .5;default:return 1}}function L2(o,t,n){return!(o===u.ao.horizontal||!t&&!Th(n)||t&&(zd[n]||(c=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(c)))));var c}function D2(o,t,n,c,d,_){let y=_[o.fontStack],b=(function(T,M,k,z){if(T&&T.rect)return T;let B=M[k.fontStack],j=B&&B[z];return j?{rect:null,metrics:j.metrics}:null})(y&&y[t],d,o,t);if(b===null)return null;let w;if(n)w=c.verticalLineContentWidth-o.scale*hn;else{let T=Uy(o.verticalAlign);w=(c.horizontalLineContentHeight-o.scale*hn)*T}return{rect:b.rect,metrics:b.metrics,baselineOffset:w}}function R2(o,t,n,c,d){let _=d[o.imageName];if(!_)return null;let y=_.paddedRect,b=_.displaySize,w={width:b[0],height:b[1],left:1,top:-3,advance:t?b[1]:b[0]},T;if(t)T=c.verticalLineContentWidth-b[1]*o.scale;else{let M=Uy(o.verticalAlign);T=(c.horizontalLineContentHeight-b[1]*o.scale)*M}return{rect:y,metrics:w,baselineOffset:T,imageOffset:(t?b[0]:b[1])*o.scale-hn*n}}function z2(o,t,n,c){if(c===0)return;let d=o[n],_=(o[n].x+d.metrics.advance*d.scale)*c;for(let y=t;y<=n;y++)o[y].x-=_}function O2(o,t,n){let{horizontalAlign:c,verticalAlign:d}=bg(n),_=t[0]-o.displaySize[0]*c,y=t[1]-o.displaySize[1]*d;return{image:o,top:y,bottom:y+o.displaySize[1],left:_,right:_+o.displaySize[0]}}function Ny(o){var t,n;let c=o.left,d=o.top,_=o.right-c,y=o.bottom-d,b=(t=o.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(n=o.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",T=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(w==="proportional"){if(b==="stretchOnly"&&_/y<T||b==="proportional"){let M=Math.ceil(y*T);c*=M/_,_=M}}else if(b==="proportional"&&w==="stretchOnly"&&T!==0&&_/y>T){let M=Math.ceil(_/T);d*=M/y,y=M}return{x1:c,y1:d,x2:c+_,y2:d+y}}function Vy(o,t,n,c,d,_){let y=o.image,b;if(y.content){let Z=y.content,Q=y.pixelRatio||1;b=[Z[0]/Q,Z[1]/Q,y.displaySize[0]-Z[2]/Q,y.displaySize[1]-Z[3]/Q]}let w=t.left*_,T=t.right*_,M,k,z,B;n==="width"||n==="both"?(B=d[0]+w-c[3],k=d[0]+T+c[1]):(B=d[0]+(w+T-y.displaySize[0])/2,k=B+y.displaySize[0]);let j=t.top*_,$=t.bottom*_;return n==="height"||n==="both"?(M=d[1]+j-c[0],z=d[1]+$+c[2]):(M=d[1]+(j+$-y.displaySize[1])/2,z=M+y.displaySize[1]),{image:y,top:M,right:k,bottom:z,left:B,collisionPadding:b}}let $a=128,Ls=32640;function $y(o,t){let{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new xi(o+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:c,interpolationType:d}=n,_=0;for(;_<c.length&&c[_]<=o;)_++;_=Math.max(0,_-1);let y=_;for(;y<c.length&&c[y]<o+1;)y++;y=Math.min(c.length-1,y);let b=c[_],w=c[y];return n.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:w,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:w,minSize:n.evaluate(new xi(b)),maxSize:n.evaluate(new xi(w)),interpolationType:d}}}function wg(o,t,n){let c="never",d=o.get(t);return d?c=d:o.get(n)&&(c="always"),c}let F2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Od(o,t,n,c,d,_,y,b,w,T,M,k,z){let B=b?Math.min(Ls,Math.round(b[0])):0,j=b?Math.min(Ls,Math.round(b[1])):0;o.emplaceBack(t,n,Math.round(32*c),Math.round(32*d),_,y,(B<<1)+(w?1:0),j,16*T,16*M,256*k,256*z)}function Sg(o,t,n){o.emplaceBack(t.x,t.y,n),o.emplaceBack(t.x,t.y,n),o.emplaceBack(t.x,t.y,n),o.emplaceBack(t.x,t.y,n)}function B2(o){for(let t of o.sections)if(wd(t.text))return!0;return!1}class Ig{constructor(t){this.layoutVertexArray=new We,this.indexArray=new si,this.programConfigurations=t,this.segments=new Lt,this.dynamicLayoutVertexArray=new Re,this.opacityVertexArray=new st,this.hasVisibleVertices=!1,this.placedSymbolArray=new N}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,h2.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,p2.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,F2,!0),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}tt("SymbolBuffers",Ig);class Tg{constructor(t,n,c){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new c,this.segments=new Lt,this.collisionVertexArray=new Qt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,d2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}tt("CollisionBuffers",Tg);class eu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$y(this.zoom,n["text-size"]),this.iconSizeData=$y(this.zoom,n["icon-size"]);let c=this.layers[0].layout,d=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=wg(c,"text-overlap","text-allow-overlap")!=="never"||wg(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(y=>u.ao[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new Ig(new cr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Ig(new cr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new J,this.lineVertexArray=new ee,this.symbolInstances=new H,this.textAnchorOffsets=new te}calculateGlyphDependencies(t,n,c,d,_){for(let y=0;y<t.length;y++)if(n[t.charCodeAt(y)]=!0,(c||d)&&_){let b=qh[t.charAt(y)];b&&(n[b.charCodeAt(0)]=!0)}}populate(t,n,c){let d=this.layers[0],_=d.layout,y=_.get("text-font"),b=_.get("text-field"),w=_.get("icon-image"),T=(b.value.kind!=="constant"||b.value.value instanceof Fn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),M=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,k=_.get("symbol-sort-key");if(this.features=[],!T&&!M)return;let z=n.iconDependencies,B=n.glyphDependencies,j=n.availableImages,$=new xi(this.zoom,{globalState:this.globalState});for(let{feature:Z,id:Q,index:de,sourceLayerIndex:oe}of t){let ce=d._featureFilter.needGeometry,Ie=Lo(Z,ce);if(!d._featureFilter.filter($,Ie,c))continue;let Ee,ze;if(ce||(Ie.geometry=ca(Z)),T){let qe=d.getValueAndResolveTokens("text-field",Ie,c,j),Ke=Fn.factory(qe),pt=this.hasRTLText=this.hasRTLText||B2(Ke);(!pt||Vr.getRTLTextPluginStatus()==="unavailable"||pt&&Vr.isParsed())&&(Ee=f2(Ke,d,Ie))}if(M){let qe=d.getValueAndResolveTokens("icon-image",Ie,c,j);ze=qe instanceof sr?qe:sr.fromString(qe)}if(!Ee&&!ze)continue;let Je=this.sortFeaturesByKey?k.evaluate(Ie,{},c):void 0;if(this.features.push({id:Q,text:Ee,icon:ze,index:de,sourceLayerIndex:oe,geometry:Ie.geometry,properties:Z.properties,type:Jc.types[Z.type],sortKey:Je}),ze&&(z[ze.name]=!0),Ee){let qe=y.evaluate(Ie,{},c).join(","),Ke=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ao.vertical)>=0;for(let pt of Ee.sections)if(pt.image)z[pt.image.name]=!0;else{let He=Fc(Ee.toString()),Xe=pt.fontStack||qe,ke=B[Xe]=B[Xe]||{};this.calculateGlyphDependencies(pt.text,ke,Ke,this.allowVerticalPlacement,He)}}}_.get("symbol-placement")==="line"&&(this.features=(function(Z){let Q={},de={},oe=[],ce=0;function Ie(qe){oe.push(Z[qe]),ce++}function Ee(qe,Ke,pt){let He=de[qe];return delete de[qe],de[Ke]=He,oe[He].geometry[0].pop(),oe[He].geometry[0]=oe[He].geometry[0].concat(pt[0]),He}function ze(qe,Ke,pt){let He=Q[Ke];return delete Q[Ke],Q[qe]=He,oe[He].geometry[0].shift(),oe[He].geometry[0]=pt[0].concat(oe[He].geometry[0]),He}function Je(qe,Ke,pt){let He=pt?Ke[0][Ke[0].length-1]:Ke[0][0];return`${qe}:${He.x}:${He.y}`}for(let qe=0;qe<Z.length;qe++){let Ke=Z[qe],pt=Ke.geometry,He=Ke.text?Ke.text.toString():null;if(!He){Ie(qe);continue}let Xe=Je(He,pt),ke=Je(He,pt,!0);if(Xe in de&&ke in Q&&de[Xe]!==Q[ke]){let St=ze(Xe,ke,pt),It=Ee(Xe,ke,oe[St].geometry);delete Q[Xe],delete de[ke],de[Je(He,oe[It].geometry,!0)]=It,oe[St].geometry=null}else Xe in de?Ee(Xe,ke,pt):ke in Q?ze(Xe,ke,pt):(Ie(qe),Q[Xe]=ce-1,de[ke]=ce-1)}return oe.filter(qe=>qe.geometry)})(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,Q)=>Z.sortKey-Q.sortKey)}update(t,n,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){let c=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(n[t.segment+1]),_=t.dist(n[t.segment]),y={};for(let b=t.segment+1;b<n.length;b++)y[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:d},b<n.length-1&&(d+=n[b+1].dist(n[b]));for(let b=t.segment||0;b>=0;b--)y[b]={x:n[b].x,y:n[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=n[b-1].dist(n[b]));for(let b=0;b<n.length;b++){let w=y[b];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,n,c,d,_,y,b,w,T,M,k,z){let B=t.indexArray,j=t.layoutVertexArray,$=t.segments.prepareSegment(4*n.length,j,B,this.canOverlap?y.sortKey:void 0),Z=this.glyphOffsetArray.length,Q=$.vertexLength,de=this.allowVerticalPlacement&&b===u.ao.vertical?Math.PI/2:0,oe=y.text&&y.text.sections;for(let ce=0;ce<n.length;ce++){let{tl:Ie,tr:Ee,bl:ze,br:Je,tex:qe,pixelOffsetTL:Ke,pixelOffsetBR:pt,minFontScaleX:He,minFontScaleY:Xe,glyphOffset:ke,isSDF:St,sectionIndex:It}=n[ce],ft=$.vertexLength,lt=ke[1];Od(j,w.x,w.y,Ie.x,lt+Ie.y,qe.x,qe.y,c,St,Ke.x,Ke.y,He,Xe),Od(j,w.x,w.y,Ee.x,lt+Ee.y,qe.x+qe.w,qe.y,c,St,pt.x,Ke.y,He,Xe),Od(j,w.x,w.y,ze.x,lt+ze.y,qe.x,qe.y+qe.h,c,St,Ke.x,pt.y,He,Xe),Od(j,w.x,w.y,Je.x,lt+Je.y,qe.x+qe.w,qe.y+qe.h,c,St,pt.x,pt.y,He,Xe),Sg(t.dynamicLayoutVertexArray,w,de),B.emplaceBack(ft,ft+2,ft+1),B.emplaceBack(ft+1,ft+2,ft+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ke[0]),ce!==n.length-1&&It===n[ce+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,y,y.index,{},z,oe&&oe[It])}t.placedSymbolArray.emplaceBack(w.x,w.y,Z,this.glyphOffsetArray.length-Z,Q,T,M,w.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],b,0,!1,0,k)}_addCollisionDebugVertex(t,n,c,d,_,y){return n.emplaceBack(0,0),t.emplaceBack(c.x,c.y,d,_,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,n,c,d,_,y,b){let w=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),T=w.vertexLength,M=_.layoutVertexArray,k=_.collisionVertexArray,z=b.anchorX,B=b.anchorY;this._addCollisionDebugVertex(M,k,y,z,B,new x(t,n)),this._addCollisionDebugVertex(M,k,y,z,B,new x(c,n)),this._addCollisionDebugVertex(M,k,y,z,B,new x(c,d)),this._addCollisionDebugVertex(M,k,y,z,B,new x(t,d)),w.vertexLength+=4;let j=_.indexArray;j.emplaceBack(T,T+1),j.emplaceBack(T+1,T+2),j.emplaceBack(T+2,T+3),j.emplaceBack(T+3,T),w.primitiveLength+=4}addDebugCollisionBoxes(t,n,c,d){for(let _=t;_<n;_++){let y=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Tg(Rt,Ay.members,oi),this.iconCollisionBox=new Tg(Rt,Ay.members,oi);for(let t=0;t<this.symbolInstances.length;t++){let n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,c,d,_,y,b,w,T){let M={};for(let k=n;k<c;k++){let z=t.get(k);M.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.textFeatureIndex=z.featureIndex;break}for(let k=d;k<_;k++){let z=t.get(k);M.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.verticalTextFeatureIndex=z.featureIndex;break}for(let k=y;k<b;k++){let z=t.get(k);M.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.iconFeatureIndex=z.featureIndex;break}for(let k=w;k<T;k++){let z=t.get(k);M.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},M.verticalIconFeatureIndex=z.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){let c=t.placedSymbolArray.get(n),d=c.vertexStartIndex+4*c.numGlyphs;for(let _=c.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+2,_+1),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(t),c=Math.cos(t),d=[],_=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);let w=this.symbolInstances.get(b);d.push(0|Math.round(n*w.anchorX+c*w.anchorY)),_.push(w.featureIndex)}return y.sort((b,w)=>d[b]-d[w]||_[w]-_[b]),y}addToSortKeyRanges(t,n){let c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((d,_,y)=>{d>=0&&y.indexOf(d)===_&&this.addIndicesForPlacedSymbol(this.text,d)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Gy,qy;tt("SymbolBucket",eu,{omit:["layers","collisionBoxArray","features","compareText"]}),eu.MAX_GLYPHS=65535,eu.addDynamicAttributes=Sg;var Cg={get paint(){return qy=qy||new Un({"icon-opacity":new bt(ve.paint_symbol["icon-opacity"]),"icon-color":new bt(ve.paint_symbol["icon-color"]),"icon-halo-color":new bt(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new bt(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bt(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new bt(ve.paint_symbol["text-opacity"]),"text-color":new bt(ve.paint_symbol["text-color"],{runtimeType:yn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new bt(ve.paint_symbol["text-halo-color"]),"text-halo-width":new bt(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new bt(ve.paint_symbol["text-halo-blur"]),"text-translate":new ut(ve.paint_symbol["text-translate"]),"text-translate-anchor":new ut(ve.paint_symbol["text-translate-anchor"])})},get layout(){return Gy=Gy||new Un({"symbol-placement":new ut(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bt(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ut(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ut(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ut(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new bt(ve.layout_symbol["icon-size"]),"icon-text-fit":new ut(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new bt(ve.layout_symbol["icon-image"]),"icon-rotate":new bt(ve.layout_symbol["icon-rotate"]),"icon-padding":new bt(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new bt(ve.layout_symbol["icon-offset"]),"icon-anchor":new bt(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(ve.layout_symbol["text-rotation-alignment"]),"text-field":new bt(ve.layout_symbol["text-field"]),"text-font":new bt(ve.layout_symbol["text-font"]),"text-size":new bt(ve.layout_symbol["text-size"]),"text-max-width":new bt(ve.layout_symbol["text-max-width"]),"text-line-height":new ut(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new bt(ve.layout_symbol["text-letter-spacing"]),"text-justify":new bt(ve.layout_symbol["text-justify"]),"text-radial-offset":new bt(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new bt(ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new bt(ve.layout_symbol["text-anchor"]),"text-max-angle":new ut(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(ve.layout_symbol["text-writing-mode"]),"text-rotate":new bt(ve.layout_symbol["text-rotate"]),"text-padding":new ut(ve.layout_symbol["text-padding"]),"text-keep-upright":new ut(ve.layout_symbol["text-keep-upright"]),"text-transform":new bt(ve.layout_symbol["text-transform"]),"text-offset":new bt(ve.layout_symbol["text-offset"]),"text-allow-overlap":new ut(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new ut(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new ut(ve.layout_symbol["text-ignore-placement"]),"text-optional":new ut(ve.layout_symbol["text-optional"])})}};class Wy{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:as,this.defaultValue=t}evaluate(t){if(t.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tt("FormatSectionOverride",Wy,{omit:["defaultValue"]});class Fd extends xr{constructor(t){super(t,Cg)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let c=this.layout.get("text-writing-mode");if(c){let d=[];for(let _ of c)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,c,d){let _=this.layout.get(t).evaluate(n,{},c,d),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||Ec(y.value)||!_?_:(function(b,w){return w.replace(/{([^{}]+)}/g,(T,M)=>b&&M in b?String(b[M]):"")})(n.properties,_)}createBucket(t){return new eu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of Cg.paint.overridableProperties){if(!Fd.hasPaintOverride(this.layout,t))continue;let n=this.paint.get(t),c=new Wy(n),d=new ph(c,n.property.specification),_=null;_=n.value.kind==="constant"||n.value.kind==="source"?new yl("source",d):new dh("composite",d,n.value.zoomStops),this.paint._values[t]=new uo(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&Fd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){let c=t.get("text-field"),d=Cg.paint.properties[n],_=!1,y=b=>{for(let w of b)if(d.overrides&&d.overrides.hasOverride(w))return void(_=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Fn)y(c.value.value.sections);else if(c.value.kind==="source"){let b=T=>{_||(T instanceof Mo&&wt(T.value)===Yo?y(T.value.sections):T instanceof Ea?y(T.sections):T.eachChild(b))},w=c.value;w._styleExpression&&b(w._styleExpression.expression)}return _}}let Zy;var j2={get paint(){return Zy=Zy||new Un({"background-color":new ut(ve.paint_background["background-color"]),"background-pattern":new ra(ve.paint_background["background-pattern"]),"background-opacity":new ut(ve.paint_background["background-opacity"])})}};class U2 extends xr{constructor(t){super(t,j2)}}let Hy;var N2={get paint(){return Hy=Hy||new Un({"raster-opacity":new ut(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new ut(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(ve.paint_raster["raster-saturation"]),"raster-contrast":new ut(ve.paint_raster["raster-contrast"]),"raster-resampling":new ut(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(ve.paint_raster["raster-fade-duration"])})}};class V2 extends xr{constructor(t){super(t,N2)}}class $2 extends xr{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class G2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let q2={once:!0},Pg=63710088e-1;class Ds{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ds(ts(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let n=Math.PI/180,c=this.lat*n,d=t.lat*n,_=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((t.lng-this.lng)*n);return Pg*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof Ds)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ds(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ds(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let Ky=2*Math.PI*Pg;function Xy(o){return Ky*Math.cos(o*Math.PI/180)}function Jy(o){return(180+o)/360}function Yy(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Qy(o,t){return o/Xy(t)}function Mg(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function ev(o,t){return o*Xy(Mg(t))}class Zh{constructor(t,n,c=0){this.x=+t,this.y=+n,this.z=+c}static fromLngLat(t,n=0){let c=Ds.convert(t);return new Zh(Jy(c.lng),Yy(c.lat),Qy(n,c.lat))}toLngLat(){return new Ds(360*this.x-180,Mg(this.y))}toAltitude(){return ev(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ky*(t=Mg(this.y),1/Math.cos(t*Math.PI/180));var t}}function tv(o,t,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[o*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class Eg{constructor(t,n,c){if(!(function(d,_,y){return!(d<0||d>25||y<0||y>=Math.pow(2,d)||_<0||_>=Math.pow(2,d))})(t,n,c))throw new Error(`x=${n}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=c,this.key=tu(0,t,t,n,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,c){let d=(y=this.y,b=this.z,w=tv(256*(_=this.x),256*(y=Math.pow(2,b)-y-1),b),T=tv(256*(_+1),256*(y+1),b),w[0]+","+w[1]+","+T[0]+","+T[1]);var _,y,b,w,T;let M=(function(k,z,B){let j,$="";for(let Z=k;Z>0;Z--)j=1<<Z-1,$+=(z&j?1:0)+(B&j?2:0);return $})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){let n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){let n=Math.pow(2,this.z);return new x((t.x*n-this.x)*ri,(t.y*n-this.y)*ri)}toString(){return`${this.z}/${this.x}/${this.y}`}}class iv{constructor(t,n){this.wrap=t,this.canonical=n,this.key=tu(t,n.z,n.z,n.x,n.y)}}class Wr{constructor(t,n,c,d,_){if(this.terrainRttPosMatrix32f=null,t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Eg(c,+d,+_),this.key=tu(n,t,c,d,_)}clone(){return new Wr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let n=this.canonical.z-t;return t>this.canonical.z?new Wr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wr(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let c=this.canonical.z-t;return t>this.canonical.z?tu(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):tu(this.wrap*+n,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Wr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new Wr(n,this.wrap,n,c,d),new Wr(n,this.wrap,n,c+1,d),new Wr(n,this.wrap,n,c,d+1),new Wr(n,this.wrap,n,c+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Wr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Wr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new iv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Zh(t.x-this.wrap,t.y))}}function tu(o,t,n,c,d){(o*=2)<0&&(o=-1*o-1);let _=1<<n;return(_*_*o+_*d+c).toString(36)+n.toString(36)+t.toString(36)}function Hh(o,t){return t?o.properties[t]:o.id}tt("CanonicalTileID",Eg),tt("OverscaledTileID",Wr,{omit:["terrainRttPosMatrix32f"]});class kl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){let n=new kl;return n.extend(t(new x(this.minX,this.minY))),n.extend(t(new x(this.maxX,this.minY))),n.extend(t(new x(this.minX,this.maxY))),n.extend(t(new x(this.maxX,this.maxY))),n}static fromPoints(t){let n=new kl;for(let c of t)n.extend(c);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class nv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){let c=t[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class rv{constructor(t,n,c,d,_){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=c,t._y=d,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class ov{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Tl(ri,16,0),this.grid3D=new Tl(ri,16,0),this.featureIndexArray=new ue,this.promoteId=n}insert(t,n,c,d,_,y){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,_);let w=y?this.grid3D:this.grid;for(let T=0;T<n.length;T++){let M=n[T],k=[1/0,1/0,-1/0,-1/0];for(let z=0;z<M.length;z++){let B=M[z];k[0]=Math.min(k[0],B.x),k[1]=Math.min(k[1],B.y),k[2]=Math.max(k[2],B.x),k[3]=Math.max(k[3],B.y)}k[0]<ri&&k[1]<ri&&k[2]>=0&&k[3]>=0&&w.insert(b,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new by(new yg(this.rawTileData)).layers,this.sourceLayerCoder=new nv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,c,d){this.loadVTLayers();let _=t.params,y=ri/t.tileSize/t.scale,b=za(_.filter),w=t.queryGeometry,T=t.queryPadding*y,M=kl.fromPoints(w),k=this.grid.query(M.minX-T,M.minY-T,M.maxX+T,M.maxY+T),z=kl.fromPoints(t.cameraQueryGeometry).expandBy(T),B=this.grid3D.query(z.minX,z.minY,z.maxX,z.maxY,(Z,Q,de,oe)=>(function(ce,Ie,Ee,ze,Je){for(let Ke of ce)if(Ie<=Ke.x&&Ee<=Ke.y&&ze>=Ke.x&&Je>=Ke.y)return!0;let qe=[new x(Ie,Ee),new x(Ie,Je),new x(ze,Je),new x(ze,Ee)];if(ce.length>2){for(let Ke of qe)if(Zc(ce,Ke))return!0}for(let Ke=0;Ke<ce.length-1;Ke++)if(Sw(ce[Ke],ce[Ke+1],qe))return!0;return!1})(t.cameraQueryGeometry,Z-T,Q-T,de+T,oe+T));for(let Z of B)k.push(Z);k.sort(W2);let j={},$;for(let Z=0;Z<k.length;Z++){let Q=k[Z];if(Q===$)continue;$=Q;let de=this.featureIndexArray.get(Q),oe=null;this.loadMatchingFeature(j,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,b,_.layers,_.availableImages,n,c,d,(ce,Ie,Ee)=>(oe||(oe=ca(ce)),Ie.queryIntersectsFeature({queryGeometry:w,feature:ce,featureState:Ee,geometry:oe,zoom:this.z,transform:t.transform,pixelsToTileUnits:y,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return j}loadMatchingFeature(t,n,c,d,_,y,b,w,T,M,k){let z=this.bucketLayerIDs[n];if(y&&!z.some(Z=>y.has(Z)))return;let B=this.sourceLayerCoder.decode(c),j=this.vtLayers[B].feature(d);if(_.needGeometry){let Z=Lo(j,!0);if(!_.filter(new xi(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!_.filter(new xi(this.tileID.overscaledZ),j))return;let $=this.getId(j,B);for(let Z=0;Z<z.length;Z++){let Q=z[Z];if(y&&!y.has(Q))continue;let de=w[Q];if(!de)continue;let oe={};$&&M&&(oe=M.getState(de.sourceLayer||"_geojsonTileLayer",$));let ce=_r({},T[Q]);ce.paint=av(ce.paint,de.paint,j,oe,b),ce.layout=av(ce.layout,de.layout,j,oe,b);let Ie=!k||k(j,de,oe);if(!Ie)continue;let Ee=new rv(j,this.z,this.x,this.y,$);Ee.layer=ce;let ze=t[Q];ze===void 0&&(ze=t[Q]=[]),ze.push({featureIndex:d,feature:Ee,intersectionZ:Ie})}}lookupSymbolFeatures(t,n,c,d,_,y,b,w){let T={};this.loadVTLayers();let M=za(_);for(let k of t)this.loadMatchingFeature(T,c,d,k,M,y,b,w,n);return T}hasLayer(t){for(let n of this.bucketLayerIDs)for(let c of n)if(t===c)return!0;return!1}getId(t,n){var c;let d=t.id;return this.promoteId&&(d=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((c=t.properties)===null||c===void 0)&&c.cluster)&&this.promoteId&&(d=Number(t.properties.cluster_id))),d}}function av(o,t,n,c,d){return is(o,(_,y)=>{let b=t instanceof jc?t.get(y):null;return b&&b.evaluate?b.evaluate(n,c,d):b})}function W2(o,t){return t-o}function sv(o,t,n,c,d){let _=[];for(let y=0;y<o.length;y++){let b=o[y],w;for(let T=0;T<b.length-1;T++){let M=b[T],k=b[T+1];M.x<t&&k.x<t||(M.x<t?M=new x(t,M.y+(t-M.x)/(k.x-M.x)*(k.y-M.y))._round():k.x<t&&(k=new x(t,M.y+(t-M.x)/(k.x-M.x)*(k.y-M.y))._round()),M.y<n&&k.y<n||(M.y<n?M=new x(M.x+(n-M.y)/(k.y-M.y)*(k.x-M.x),n)._round():k.y<n&&(k=new x(M.x+(n-M.y)/(k.y-M.y)*(k.x-M.x),n)._round()),M.x>=c&&k.x>=c||(M.x>=c?M=new x(c,M.y+(c-M.x)/(k.x-M.x)*(k.y-M.y))._round():k.x>=c&&(k=new x(c,M.y+(c-M.x)/(k.x-M.x)*(k.y-M.y))._round()),M.y>=d&&k.y>=d||(M.y>=d?M=new x(M.x+(d-M.y)/(k.y-M.y)*(k.x-M.x),d)._round():k.y>=d&&(k=new x(M.x+(d-M.y)/(k.y-M.y)*(k.x-M.x),d)._round()),w&&M.equals(w[w.length-1])||(w=[M],_.push(w)),w.push(k)))))}}return _}tt("FeatureIndex",ov,{omit:["rawTileData","sourceLayerCoder"]});class Rs extends x{constructor(t,n,c,d){super(t,n),this.angle=c,d!==void 0&&(this.segment=d)}clone(){return new Rs(this.x,this.y,this.angle,this.segment)}}function lv(o,t,n,c,d){if(t.segment===void 0||n===0)return!0;let _=t,y=t.segment+1,b=0;for(;b>-n/2;){if(y--,y<0)return!1;b-=o[y].dist(_),_=o[y]}b+=o[y].dist(o[y+1]),y++;let w=[],T=0;for(;b<n/2;){let M=o[y],k=o[y+1];if(!k)return!1;let z=o[y-1].angleTo(M)-M.angleTo(k);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:b,angleDelta:z}),T+=z;b-w[0].distance>c;)T-=w.shift().angleDelta;if(T>d)return!1;y++,b+=M.dist(k)}return!0}function cv(o){let t=0;for(let n=0;n<o.length-1;n++)t+=o[n].dist(o[n+1]);return t}function uv(o,t,n){return o?.6*t*n:0}function hv(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function Z2(o,t,n,c,d,_){let y=uv(n,d,_),b=hv(n,c)*_,w=0,T=cv(o)/2;for(let M=0;M<o.length-1;M++){let k=o[M],z=o[M+1],B=k.dist(z);if(w+B>T){let j=(T-w)/B,$=lo.number(k.x,z.x,j),Z=lo.number(k.y,z.y,j),Q=new Rs($,Z,z.angleTo(k),M);return Q._round(),!y||lv(o,Q,b,y,t)?Q:void 0}w+=B}}function H2(o,t,n,c,d,_,y,b,w){let T=uv(c,_,y),M=hv(c,d),k=M*y,z=o[0].x===0||o[0].x===w||o[0].y===0||o[0].y===w;return t-k<t/4&&(t=k+t/4),pv(o,z?t/2*b%t:(M/2+2*_)*y*b%t,t,T,n,k,z,!1,w)}function pv(o,t,n,c,d,_,y,b,w){let T=_/2,M=cv(o),k=0,z=t-n,B=[];for(let j=0;j<o.length-1;j++){let $=o[j],Z=o[j+1],Q=$.dist(Z),de=Z.angleTo($);for(;z+n<k+Q;){z+=n;let oe=(z-k)/Q,ce=lo.number($.x,Z.x,oe),Ie=lo.number($.y,Z.y,oe);if(ce>=0&&ce<w&&Ie>=0&&Ie<w&&z-T>=0&&z+T<=M){let Ee=new Rs(ce,Ie,de,j);Ee._round(),c&&!lv(o,Ee,_,c,d)||B.push(Ee)}}k+=Q}return b||B.length||y||(B=pv(o,k/2,n,c,d,_,y,!0,w)),B}function dv(o,t,n,c){let d=[],_=o.image,y=_.pixelRatio,b=_.paddedRect.w-2,w=_.paddedRect.h-2,T={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom},M=_.stretchX||[[0,b]],k=_.stretchY||[[0,w]],z=(ke,St)=>ke+St[1]-St[0],B=M.reduce(z,0),j=k.reduce(z,0),$=b-B,Z=w-j,Q=0,de=B,oe=0,ce=j,Ie=0,Ee=$,ze=0,Je=Z;if(_.content&&c){let ke=_.content,St=ke[2]-ke[0],It=ke[3]-ke[1];(_.textFitWidth||_.textFitHeight)&&(T=Ny(o)),Q=Bd(M,0,ke[0]),oe=Bd(k,0,ke[1]),de=Bd(M,ke[0],ke[2]),ce=Bd(k,ke[1],ke[3]),Ie=ke[0]-Q,ze=ke[1]-oe,Ee=St-de,Je=It-ce}let qe=T.x1,Ke=T.y1,pt=T.x2-qe,He=T.y2-Ke,Xe=(ke,St,It,ft)=>{let lt=jd(ke.stretch-Q,de,pt,qe),Wt=Ud(ke.fixed-Ie,Ee,ke.stretch,B),Ei=jd(St.stretch-oe,ce,He,Ke),an=Ud(St.fixed-ze,Je,St.stretch,j),An=jd(It.stretch-Q,de,pt,qe),Zr=Ud(It.fixed-Ie,Ee,It.stretch,B),hr=jd(ft.stretch-oe,ce,He,Ke),xn=Ud(ft.fixed-ze,Je,ft.stretch,j),Ii=new x(lt,Ei),pn=new x(An,Ei),bn=new x(An,hr),wn=new x(lt,hr),er=new x(Wt/y,an/y),Hr=new x(Zr/y,xn/y),dn=t*Math.PI/180;if(dn){let mn=Math.sin(dn),fn=Math.cos(dn),Ji=[fn,-mn,mn,fn];Ii._matMult(Ji),pn._matMult(Ji),wn._matMult(Ji),bn._matMult(Ji)}let pr=ke.stretch+ke.fixed,sn=St.stretch+St.fixed;return{tl:Ii,tr:pn,bl:wn,br:bn,tex:{x:_.paddedRect.x+1+pr,y:_.paddedRect.y+1+sn,w:It.stretch+It.fixed-pr,h:ft.stretch+ft.fixed-sn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:er,pixelOffsetBR:Hr,minFontScaleX:Ee/y/pt,minFontScaleY:Je/y/He,isSDF:n}};if(c&&(_.stretchX||_.stretchY)){let ke=mv(M,$,B),St=mv(k,Z,j);for(let It=0;It<ke.length-1;It++){let ft=ke[It],lt=ke[It+1];for(let Wt=0;Wt<St.length-1;Wt++)d.push(Xe(ft,St[Wt],lt,St[Wt+1]))}}else d.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:w+1}));return d}function Bd(o,t,n){let c=0;for(let d of o)c+=Math.max(t,Math.min(n,d[1]))-Math.max(t,Math.min(n,d[0]));return c}function mv(o,t,n){let c=[{fixed:-1,stretch:0}];for(let[d,_]of o){let y=c[c.length-1];c.push({fixed:d-y.stretch,stretch:y.stretch}),c.push({fixed:d-y.stretch,stretch:y.stretch+(_-d)})}return c.push({fixed:t+1,stretch:n}),c}function jd(o,t,n,c){return o/t*n+c}function Ud(o,t,n,c){return o-t*n/c}tt("Anchor",Rs);class Nd{constructor(t,n,c,d,_,y,b,w,T,M){var k;if(this.boxStartIndex=t.length,T){let z=y.top,B=y.bottom,j=y.collisionPadding;j&&(z-=j[1],B+=j[3]);let $=B-z;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let z=!((k=y.image)===null||k===void 0)&&k.content&&(y.image.textFitWidth||y.image.textFitHeight)?Ny(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};z.y1=z.y1*b-w[0],z.y2=z.y2*b+w[2],z.x1=z.x1*b-w[3],z.x2=z.x2*b+w[1];let B=y.collisionPadding;if(B&&(z.x1-=B[0]*b,z.y1-=B[1]*b,z.x2+=B[2]*b,z.y2+=B[3]*b),M){let j=new x(z.x1,z.y1),$=new x(z.x2,z.y1),Z=new x(z.x1,z.y2),Q=new x(z.x2,z.y2),de=M*Math.PI/180;j._rotate(de),$._rotate(de),Z._rotate(de),Q._rotate(de),z.x1=Math.min(j.x,$.x,Z.x,Q.x),z.x2=Math.max(j.x,$.x,Z.x,Q.x),z.y1=Math.min(j.y,$.y,Z.y,Q.y),z.y2=Math.max(j.y,$.y,Z.y,Q.y)}t.emplaceBack(n.x,n.y,z.x1,z.y1,z.x2,z.y2,c,d,_)}this.boxEndIndex=t.length}}class K2{constructor(t=[],n=(c,d)=>c<d?-1:c>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:n,compare:c}=this,d=n[t];for(;t>0;){let _=t-1>>1,y=n[_];if(c(d,y)>=0)break;n[t]=y,t=_}n[t]=d}_down(t){let{data:n,compare:c}=this,d=this.length>>1,_=n[t];for(;t<d;){let y=1+(t<<1),b=y+1;if(b<this.length&&c(n[b],n[y])<0&&(y=b),c(n[y],_)>=0)break;n[t]=n[y],t=y}n[t]=_}}function X2(o,t=1,n=!1){let c=kl.fromPoints(o[0]),d=Math.min(c.width(),c.height()),_=d/2,y=new K2([],J2),{minX:b,minY:w,maxX:T,maxY:M}=c;if(d===0)return new x(b,w);for(let B=b;B<T;B+=d)for(let j=w;j<M;j+=d)y.push(new iu(B+_,j+_,_,o));let k=(function(B){let j=0,$=0,Z=0,Q=B[0];for(let de=0,oe=Q.length,ce=oe-1;de<oe;ce=de++){let Ie=Q[de],Ee=Q[ce],ze=Ie.x*Ee.y-Ee.x*Ie.y;$+=(Ie.x+Ee.x)*ze,Z+=(Ie.y+Ee.y)*ze,j+=3*ze}return new iu($/j,Z/j,0,B)})(o),z=y.length;for(;y.length;){let B=y.pop();(B.d>k.d||!k.d)&&(k=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,z)),B.max-k.d<=t||(_=B.h/2,y.push(new iu(B.p.x-_,B.p.y-_,_,o)),y.push(new iu(B.p.x+_,B.p.y-_,_,o)),y.push(new iu(B.p.x-_,B.p.y+_,_,o)),y.push(new iu(B.p.x+_,B.p.y+_,_,o)),z+=4)}return n&&(console.log(`num probes: ${z}`),console.log(`best distance: ${k.d}`)),k.p}function J2(o,t){return t.max-o.max}function iu(o,t,n,c){this.p=new x(o,t),this.h=n,this.d=(function(d,_){let y=!1,b=1/0;for(let w=0;w<_.length;w++){let T=_[w];for(let M=0,k=T.length,z=k-1;M<k;z=M++){let B=T[M],j=T[z];B.y>d.y!=j.y>d.y&&d.x<(j.x-B.x)*(d.y-B.y)/(j.y-B.y)+B.x&&(y=!y),b=Math.min(b,Y_(d,B,j))}}return(y?1:-1)*Math.sqrt(b)})(this.p,c),this.max=this.d+this.h*Math.SQRT2}var En;u.aE=void 0,(En=u.aE||(u.aE={}))[En.center=1]="center",En[En.left=2]="left",En[En.right=3]="right",En[En.top=4]="top",En[En.bottom=5]="bottom",En[En["top-left"]=6]="top-left",En[En["top-right"]=7]="top-right",En[En["bottom-left"]=8]="bottom-left",En[En["bottom-right"]=9]="bottom-right";let Ag=Number.POSITIVE_INFINITY;function fv(o,t){return t[1]!==Ag?(function(n,c,d){let _=0,y=0;switch(c=Math.abs(c),d=Math.abs(d),n){case"top-right":case"top-left":case"top":y=d-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-d}switch(n){case"top-right":case"bottom-right":case"right":_=-c;break;case"top-left":case"bottom-left":case"left":_=c}return[_,y]})(o,t[0],t[1]):(function(n,c){let d=0,_=0;c<0&&(c=0);let y=c/Math.SQRT2;switch(n){case"top-right":case"top-left":_=y-7;break;case"bottom-right":case"bottom-left":_=7-y;break;case"bottom":_=7-c;break;case"top":_=c-7}switch(n){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=c;break;case"right":d=-c}return[d,_]})(o,t[0])}function gv(o,t,n){var c;let d=o.layout,_=(c=d.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},n);if(_){let b=_.values,w=[];for(let T=0;T<b.length;T+=2){let M=w[T]=b[T],k=b[T+1].map(z=>z*hn);M.startsWith("top")?k[1]-=7:M.startsWith("bottom")&&(k[1]+=7),w[T+1]=k}return new jn(w)}let y=d.get("text-variable-anchor");if(y){let b;b=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},n)*hn,Ag]:d.get("text-offset").evaluate(t,{},n).map(T=>T*hn);let w=[];for(let T of y)w.push(T,fv(T,b));return new jn(w)}return null}function kg(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Y2(o,t,n,c,d,_,y,b,w,T,M,k){let z=_.textMaxSize.evaluate(t,{});z===void 0&&(z=y);let B=o.layers[0].layout,j=B.get("icon-offset").evaluate(t,{},M),$=yv(n.horizontal),Z=y/24,Q=o.tilePixelRatio*Z,de=o.tilePixelRatio*z/24,oe=o.tilePixelRatio*b,ce=o.tilePixelRatio*B.get("symbol-spacing"),Ie=B.get("text-padding")*o.tilePixelRatio,Ee=(function(It,ft,lt,Wt=1){let Ei=It.get("icon-padding").evaluate(ft,{},lt),an=Ei&&Ei.values;return[an[0]*Wt,an[1]*Wt,an[2]*Wt,an[3]*Wt]})(B,t,M,o.tilePixelRatio),ze=B.get("text-max-angle")/180*Math.PI,Je=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",qe=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Ke=B.get("symbol-placement"),pt=ce/2,He=B.get("icon-text-fit"),Xe;c&&He!=="none"&&(o.allowVerticalPlacement&&n.vertical&&(Xe=Vy(c,n.vertical,He,B.get("icon-text-fit-padding"),j,Z)),$&&(c=Vy(c,$,He,B.get("icon-text-fit-padding"),j,Z)));let ke=M?k.line.getGranularityForZoomLevel(M.z):1,St=(It,ft)=>{ft.x<0||ft.x>=ri||ft.y<0||ft.y>=ri||(function(lt,Wt,Ei,an,An,Zr,hr,xn,Ii,pn,bn,wn,er,Hr,dn,pr,sn,mn,fn,Ji,yi,Do,nu,Ro,tS){let ru=lt.addToLineVertexArray(Wt,Ei),Ll,ou,au,su,wv=0,Sv=0,Iv=0,Tv=0,jg=-1,Ug=-1,Ga={},Cv=Es("");if(lt.allowVerticalPlacement&&an.vertical){let $n=xn.layout.get("text-rotate").evaluate(yi,{},Ro)+90;au=new Nd(Ii,Wt,pn,bn,wn,an.vertical,er,Hr,dn,$n),hr&&(su=new Nd(Ii,Wt,pn,bn,wn,hr,sn,mn,dn,$n))}if(An){let $n=xn.layout.get("icon-rotate").evaluate(yi,{}),Kr=xn.layout.get("icon-text-fit")!=="none",Dl=dv(An,$n,nu,Kr),Oo=hr?dv(hr,$n,nu,Kr):void 0;ou=new Nd(Ii,Wt,pn,bn,wn,An,sn,mn,!1,$n),wv=4*Dl.length;let Rl=lt.iconSizeData,ua=null;Rl.kind==="source"?(ua=[$a*xn.layout.get("icon-size").evaluate(yi,{})],ua[0]>Ls&&Ni(`${lt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Rl.kind==="composite"&&(ua=[$a*Do.compositeIconSizes[0].evaluate(yi,{},Ro),$a*Do.compositeIconSizes[1].evaluate(yi,{},Ro)],(ua[0]>Ls||ua[1]>Ls)&&Ni(`${lt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),lt.addSymbols(lt.icon,Dl,ua,Ji,fn,yi,u.ao.none,Wt,ru.lineStartIndex,ru.lineLength,-1,Ro),jg=lt.icon.placedSymbolArray.length-1,Oo&&(Sv=4*Oo.length,lt.addSymbols(lt.icon,Oo,ua,Ji,fn,yi,u.ao.vertical,Wt,ru.lineStartIndex,ru.lineLength,-1,Ro),Ug=lt.icon.placedSymbolArray.length-1)}let Pv=Object.keys(an.horizontal);for(let $n of Pv){let Kr=an.horizontal[$n];if(!Ll){Cv=Es(Kr.text);let Oo=xn.layout.get("text-rotate").evaluate(yi,{},Ro);Ll=new Nd(Ii,Wt,pn,bn,wn,Kr,er,Hr,dn,Oo)}let Dl=Kr.positionedLines.length===1;if(Iv+=_v(lt,Wt,Kr,Zr,xn,dn,yi,pr,ru,an.vertical?u.ao.horizontal:u.ao.horizontalOnly,Dl?Pv:[$n],Ga,jg,Do,Ro),Dl)break}an.vertical&&(Tv+=_v(lt,Wt,an.vertical,Zr,xn,dn,yi,pr,ru,u.ao.vertical,["vertical"],Ga,Ug,Do,Ro));let iS=Ll?Ll.boxStartIndex:lt.collisionBoxArray.length,nS=Ll?Ll.boxEndIndex:lt.collisionBoxArray.length,rS=au?au.boxStartIndex:lt.collisionBoxArray.length,oS=au?au.boxEndIndex:lt.collisionBoxArray.length,aS=ou?ou.boxStartIndex:lt.collisionBoxArray.length,sS=ou?ou.boxEndIndex:lt.collisionBoxArray.length,lS=su?su.boxStartIndex:lt.collisionBoxArray.length,cS=su?su.boxEndIndex:lt.collisionBoxArray.length,zo=-1,$d=($n,Kr)=>$n&&$n.circleDiameter?Math.max($n.circleDiameter,Kr):Kr;zo=$d(Ll,zo),zo=$d(au,zo),zo=$d(ou,zo),zo=$d(su,zo);let Mv=zo>-1?1:0;Mv&&(zo*=tS/hn),lt.glyphOffsetArray.length>=eu.MAX_GLYPHS&&Ni("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yi.sortKey!==void 0&&lt.addToSortKeyRanges(lt.symbolInstances.length,yi.sortKey);let uS=gv(xn,yi,Ro),[hS,pS]=(function($n,Kr){let Dl=$n.length,Oo=Kr?.values;if(Oo?.length>0)for(let Rl=0;Rl<Oo.length;Rl+=2){let ua=Oo[Rl+1];$n.emplaceBack(u.aE[Oo[Rl]],ua[0],ua[1])}return[Dl,$n.length]})(lt.textAnchorOffsets,uS);lt.symbolInstances.emplaceBack(Wt.x,Wt.y,Ga.right>=0?Ga.right:-1,Ga.center>=0?Ga.center:-1,Ga.left>=0?Ga.left:-1,Ga.vertical||-1,jg,Ug,Cv,iS,nS,rS,oS,aS,sS,lS,cS,pn,Iv,Tv,wv,Sv,Mv,0,er,zo,hS,pS)})(o,ft,It,n,c,d,Xe,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,Q,[Ie,Ie,Ie,Ie],Je,w,oe,Ee,qe,j,t,_,T,M,y)};if(Ke==="line")for(let It of sv(t.geometry,0,0,ri,ri)){let ft=Al(It,ke),lt=H2(ft,ce,ze,n.vertical||$,c,24,de,o.overscaling,ri);for(let Wt of lt)$&&Q2(o,$.text,pt,Wt)||St(ft,Wt)}else if(Ke==="line-center"){for(let It of t.geometry)if(It.length>1){let ft=Al(It,ke),lt=Z2(ft,ze,n.vertical||$,c,24,de);lt&&St(ft,lt)}}else if(t.type==="Polygon")for(let It of dl(t.geometry,0)){let ft=X2(It,16);St(Al(It[0],ke,!0),new Rs(ft.x,ft.y,0))}else if(t.type==="LineString")for(let It of t.geometry){let ft=Al(It,ke);St(ft,new Rs(ft[0].x,ft[0].y,0))}else if(t.type==="Point")for(let It of t.geometry)for(let ft of It)St([ft],new Rs(ft.x,ft.y,0))}function _v(o,t,n,c,d,_,y,b,w,T,M,k,z,B,j){let $=(function(de,oe,ce,Ie,Ee,ze,Je,qe){let Ke=Ie.layout.get("text-rotate").evaluate(ze,{})*Math.PI/180,pt=[];for(let He of oe.positionedLines)for(let Xe of He.positionedGlyphs){if(!Xe.rect)continue;let ke=Xe.rect||{},St=4,It=!0,ft=1,lt=0,Wt=(Ee||qe)&&Xe.vertical,Ei=Xe.metrics.advance*Xe.scale/2;if(qe&&oe.verticalizable&&(lt=He.lineOffset/2-(Xe.imageName?-(hn-Xe.metrics.width*Xe.scale)/2:(Xe.scale-1)*hn)),Xe.imageName){let mn=Je[Xe.imageName];It=mn.sdf,ft=mn.pixelRatio,St=1/ft}let an=Ee?[Xe.x+Ei,Xe.y]:[0,0],An=Ee?[0,0]:[Xe.x+Ei+ce[0],Xe.y+ce[1]-lt],Zr=[0,0];Wt&&(Zr=An,An=[0,0]);let hr=Xe.metrics.isDoubleResolution?2:1,xn=(Xe.metrics.left-St)*Xe.scale-Ei+An[0],Ii=(-Xe.metrics.top-St)*Xe.scale+An[1],pn=xn+ke.w/hr*Xe.scale/ft,bn=Ii+ke.h/hr*Xe.scale/ft,wn=new x(xn,Ii),er=new x(pn,Ii),Hr=new x(xn,bn),dn=new x(pn,bn);if(Wt){let mn=new x(-Ei,Ei- -17),fn=-Math.PI/2,Ji=12-Ei,yi=new x(22-Ji,-(Xe.imageName?Ji:0)),Do=new x(...Zr);wn._rotateAround(fn,mn)._add(yi)._add(Do),er._rotateAround(fn,mn)._add(yi)._add(Do),Hr._rotateAround(fn,mn)._add(yi)._add(Do),dn._rotateAround(fn,mn)._add(yi)._add(Do)}if(Ke){let mn=Math.sin(Ke),fn=Math.cos(Ke),Ji=[fn,-mn,mn,fn];wn._matMult(Ji),er._matMult(Ji),Hr._matMult(Ji),dn._matMult(Ji)}let pr=new x(0,0),sn=new x(0,0);pt.push({tl:wn,tr:er,bl:Hr,br:dn,tex:ke,writingMode:oe.writingMode,glyphOffset:an,sectionIndex:Xe.sectionIndex,isSDF:It,pixelOffsetTL:pr,pixelOffsetBR:sn,minFontScaleX:0,minFontScaleY:0})}return pt})(0,n,b,d,_,y,c,o.allowVerticalPlacement),Z=o.textSizeData,Q=null;Z.kind==="source"?(Q=[$a*d.layout.get("text-size").evaluate(y,{})],Q[0]>Ls&&Ni(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Z.kind==="composite"&&(Q=[$a*B.compositeTextSizes[0].evaluate(y,{},j),$a*B.compositeTextSizes[1].evaluate(y,{},j)],(Q[0]>Ls||Q[1]>Ls)&&Ni(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,$,Q,b,_,y,T,t,w.lineStartIndex,w.lineLength,z,j);for(let de of M)k[de]=o.text.placedSymbolArray.length-1;return 4*$.length}function yv(o){for(let t in o)return o[t];return null}function Q2(o,t,n,c){let d=o.compareText;if(t in d){let _=d[t];for(let y=_.length-1;y>=0;y--)if(c.dist(_[y])<n)return!0}else d[t]=[];return d[t].push(c),!1}let vv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Lg{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,c]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let d=c>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);let _=vv[15&c];if(!_)throw new Error("Unrecognized array type.");let[y]=new Uint16Array(t,2,1),[b]=new Uint32Array(t,4,1);return new Lg(b,y,_,t)}constructor(t,n=64,c=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let _=vv.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,b=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${c}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){let c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=n,c}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Dg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:_,coords:y,nodeSize:b}=this,w=[0,_.length-1,0],T=[];for(;w.length;){let M=w.pop()||0,k=w.pop()||0,z=w.pop()||0;if(k-z<=b){for(let Z=z;Z<=k;Z++){let Q=y[2*Z],de=y[2*Z+1];Q>=t&&Q<=c&&de>=n&&de<=d&&T.push(_[Z])}continue}let B=z+k>>1,j=y[2*B],$=y[2*B+1];j>=t&&j<=c&&$>=n&&$<=d&&T.push(_[B]),(M===0?t<=j:n<=$)&&(w.push(z),w.push(B-1),w.push(1-M)),(M===0?c>=j:d>=$)&&(w.push(B+1),w.push(k),w.push(1-M))}return T}within(t,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:_,nodeSize:y}=this,b=[0,d.length-1,0],w=[],T=c*c;for(;b.length;){let M=b.pop()||0,k=b.pop()||0,z=b.pop()||0;if(k-z<=y){for(let Z=z;Z<=k;Z++)bv(_[2*Z],_[2*Z+1],t,n)<=T&&w.push(d[Z]);continue}let B=z+k>>1,j=_[2*B],$=_[2*B+1];bv(j,$,t,n)<=T&&w.push(d[B]),(M===0?t-c<=j:n-c<=$)&&(b.push(z),b.push(B-1),b.push(1-M)),(M===0?t+c>=j:n+c>=$)&&(b.push(B+1),b.push(k),b.push(1-M))}return w}}function Dg(o,t,n,c,d,_){if(d-c<=n)return;let y=c+d>>1;xv(o,t,y,c,d,_),Dg(o,t,n,c,y-1,1-_),Dg(o,t,n,y+1,d,1-_)}function xv(o,t,n,c,d,_){for(;d>c;){if(d-c>600){let T=d-c+1,M=n-c+1,k=Math.log(T),z=.5*Math.exp(2*k/3),B=.5*Math.sqrt(k*z*(T-z)/T)*(M-T/2<0?-1:1);xv(o,t,n,Math.max(c,Math.floor(n-M*z/T+B)),Math.min(d,Math.floor(n+(T-M)*z/T+B)),_)}let y=t[2*n+_],b=c,w=d;for(Kh(o,t,c,n),t[2*d+_]>y&&Kh(o,t,c,d);b<w;){for(Kh(o,t,b,w),b++,w--;t[2*b+_]<y;)b++;for(;t[2*w+_]>y;)w--}t[2*c+_]===y?Kh(o,t,c,w):(w++,Kh(o,t,w,d)),w<=n&&(c=w+1),n<=w&&(d=w-1)}}function Kh(o,t,n,c){Rg(o,n,c),Rg(t,2*n,2*c),Rg(t,2*n+1,2*c+1)}function Rg(o,t,n){let c=o[t];o[t]=o[n],o[n]=c}function bv(o,t,n,c){let d=o-n,_=t-c;return d*d+_*_}var zg;u.cx=void 0,(zg=u.cx||(u.cx={})).create="create",zg.load="load",zg.fullLoad="fullLoad";let Vd=null,Xh=[],Og=1e3/60,Fg="loadTime",Bg="fullLoadTime",eS={mark(o){performance.mark(o)},frame(o){let t=o;Vd!=null&&Xh.push(t-Vd),Vd=t},clearMetrics(){Vd=null,Xh=[],performance.clearMeasures(Fg),performance.clearMeasures(Bg);for(let o in u.cx)performance.clearMarks(u.cx[o])},getPerformanceMetrics(){performance.measure(Fg,u.cx.create,u.cx.load),performance.measure(Bg,u.cx.create,u.cx.fullLoad);let o=performance.getEntriesByName(Fg)[0].duration,t=performance.getEntriesByName(Bg)[0].duration,n=Xh.length,c=1/(Xh.reduce((_,y)=>_+y,0)/n/1e3),d=Xh.filter(_=>_>Og).reduce((_,y)=>_+(y-Og)/Og,0);return{loadTime:o,fullLoadTime:t,fps:c,percentDroppedFrames:d/(n+d)*100,totalFrames:n}}};u.$=ri,u.A=Fe,u.B=function([o,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:o*Math.cos(t)*Math.sin(n),y:o*Math.sin(t)*Math.sin(n),z:o*Math.cos(n)}},u.C=lo,u.D=ut,u.E=ct,u.F=xi,u.G=Sl,u.H=function(o){if(ba==null){let t=o.navigator?o.navigator.userAgent:null;ba=!!o.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ba},u.I=vg,u.J=class{constructor(o,t){this.target=o,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new G2(()=>this.process()),this.subscription=Wo(this.target,"message",n=>this.receive(n),!1),this.globalScope=io(self)?o:window}registerMessageHandler(o,t){this.messageHandlers[o]=t}sendAsync(o,t){return new Promise((n,c)=>{let d=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=t?Wo(t.signal,"abort",()=>{_?.unsubscribe(),delete this.resolveRejects[d];let w={id:d,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},q2):null;this.resolveRejects[d]={resolve:w=>{_?.unsubscribe(),n(w)},reject:w=>{_?.unsubscribe(),c(w)}};let y=[],b=Object.assign(Object.assign({},o),{id:d,sourceMapId:this.mapId,origin:location.origin,data:Ss(o.data,y)});this.target.postMessage(b,{transfer:y})})}receive(o){let t=o.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];let c=this.abortControllers[n];return delete this.abortControllers[n],void(c&&c.abort())}if(io(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;let o=this.taskQueue.shift(),t=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(o,t)}processTask(o,t){return r(this,void 0,void 0,function*(){if(t.type==="<response>"){let d=this.resolveRejects[o];return delete this.resolveRejects[o],d?void(t.error?d.reject(Ba(t.error)):d.resolve(Ba(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let n=Ba(t.data),c=new AbortController;this.abortControllers[o]=c;try{let d=yield this.messageHandlers[t.type](t.sourceMapId,n,c);this.completeTask(o,null,d)}catch(d){this.completeTask(o,d)}})}completeTask(o,t,n){let c=[];delete this.abortControllers[o];let d={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ss(t):null,data:Ss(n,c)};this.target.postMessage(d,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.K=W,u.L=function(){var o=new Fe(16);return Fe!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},u.M=function(o,t,n){var c,d,_,y,b,w,T,M,k,z,B,j,$=n[0],Z=n[1],Q=n[2];return t===o?(o[12]=t[0]*$+t[4]*Z+t[8]*Q+t[12],o[13]=t[1]*$+t[5]*Z+t[9]*Q+t[13],o[14]=t[2]*$+t[6]*Z+t[10]*Q+t[14],o[15]=t[3]*$+t[7]*Z+t[11]*Q+t[15]):(d=t[1],_=t[2],y=t[3],b=t[4],w=t[5],T=t[6],M=t[7],k=t[8],z=t[9],B=t[10],j=t[11],o[0]=c=t[0],o[1]=d,o[2]=_,o[3]=y,o[4]=b,o[5]=w,o[6]=T,o[7]=M,o[8]=k,o[9]=z,o[10]=B,o[11]=j,o[12]=c*$+b*Z+k*Q+t[12],o[13]=d*$+w*Z+z*Q+t[13],o[14]=_*$+T*Z+B*Q+t[14],o[15]=y*$+M*Z+j*Q+t[15]),o},u.N=function(o,t,n){var c=n[0],d=n[1],_=n[2];return o[0]=t[0]*c,o[1]=t[1]*c,o[2]=t[2]*c,o[3]=t[3]*c,o[4]=t[4]*d,o[5]=t[5]*d,o[6]=t[6]*d,o[7]=t[7]*d,o[8]=t[8]*_,o[9]=t[9]*_,o[10]=t[10]*_,o[11]=t[11]*_,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},u.O=function(o,t,n){var c=t[0],d=t[1],_=t[2],y=t[3],b=t[4],w=t[5],T=t[6],M=t[7],k=t[8],z=t[9],B=t[10],j=t[11],$=t[12],Z=t[13],Q=t[14],de=t[15],oe=n[0],ce=n[1],Ie=n[2],Ee=n[3];return o[0]=oe*c+ce*b+Ie*k+Ee*$,o[1]=oe*d+ce*w+Ie*z+Ee*Z,o[2]=oe*_+ce*T+Ie*B+Ee*Q,o[3]=oe*y+ce*M+Ie*j+Ee*de,o[4]=(oe=n[4])*c+(ce=n[5])*b+(Ie=n[6])*k+(Ee=n[7])*$,o[5]=oe*d+ce*w+Ie*z+Ee*Z,o[6]=oe*_+ce*T+Ie*B+Ee*Q,o[7]=oe*y+ce*M+Ie*j+Ee*de,o[8]=(oe=n[8])*c+(ce=n[9])*b+(Ie=n[10])*k+(Ee=n[11])*$,o[9]=oe*d+ce*w+Ie*z+Ee*Z,o[10]=oe*_+ce*T+Ie*B+Ee*Q,o[11]=oe*y+ce*M+Ie*j+Ee*de,o[12]=(oe=n[12])*c+(ce=n[13])*b+(Ie=n[14])*k+(Ee=n[15])*$,o[13]=oe*d+ce*w+Ie*z+Ee*Z,o[14]=oe*_+ce*T+Ie*B+Ee*Q,o[15]=oe*y+ce*M+Ie*j+Ee*de,o},u.P=x,u.Q=function(o,t){let n={};for(let c=0;c<t.length;c++){let d=t[c];d in o&&(n[d]=o[d])}return n},u.R=ur,u.S=Ds,u.T=lg,u.U=Yy,u.V=Jy,u.W=fe,u.X=xe,u.Y=rs,u.Z=Wr,u._=r,u.a=V,u.a$=Hn,u.a0=function(o,t){var n,c,d,_;if(!o)return t??{};if(!t)return o;let y=Object.assign({},o);if(t.removeAll&&(y.removeAll=!0),t.remove){let b=new Set(y.remove?y.remove.concat(t.remove):t.remove);y.remove=Array.from(b.values())}if(t.add){let b=y.add?y.add.concat(t.add):t.add,w=new Map(b.map(T=>[T.id,T]));y.add=Array.from(w.values())}if(t.update){let b=new Map((n=y.update)===null||n===void 0?void 0:n.map(w=>[w.id,w]));for(let w of t.update){let T=(c=b.get(w.id))!==null&&c!==void 0?c:{id:w.id};w.newGeometry&&(T.newGeometry=w.newGeometry),w.addOrUpdateProperties&&(T.addOrUpdateProperties=((d=T.addOrUpdateProperties)!==null&&d!==void 0?d:[]).concat(w.addOrUpdateProperties)),w.removeProperties&&(T.removeProperties=((_=T.removeProperties)!==null&&_!==void 0?_:[]).concat(w.removeProperties)),w.removeAllProperties&&(T.removeAllProperties=!0),b.set(w.id,T)}y.update=Array.from(b.values())}return y},u.a1=Zh,u.a2=kl,u.a3=25,u.a4=Eg,u.a5=o=>{let t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(let c of o){let d=window.document.createElement("source");Te(c)||(t.crossOrigin="Anonymous"),d.src=c,t.appendChild(d)}})},u.a6=Ge,u.a7=function(){return Dr++},u.a8=L,u.a9=eu,u.aA=function(o){let t=1/0,n=1/0,c=-1/0,d=-1/0;for(let _ of o)t=Math.min(t,_.x),n=Math.min(n,_.y),c=Math.max(c,_.x),d=Math.max(d,_.y);return[t,n,c,d]},u.aB=hn,u.aC=Co,u.aD=function(o,t,n,c,d=!1){if(!n[0]&&!n[1])return[0,0];let _=d?c==="map"?-o.bearingInRadians:0:c==="viewport"?o.bearingInRadians:0;if(_){let y=Math.sin(_),b=Math.cos(_);n=[n[0]*b-n[1]*y,n[0]*y+n[1]*b]}return[d?n[0]:Co(t,n[0],o.zoom),d?n[1]:Co(t,n[1],o.zoom)]},u.aF=wg,u.aG=kg,u.aH=bg,u.aI=Lg,u.aJ=Oi,u.aK=Ld,u.aL=ie,u.aM=Lt,u.aN=si,u.aO=ts,u.aP=Zo,u.aQ=ev,u.aR=mi,u.aS=Ui,u.aT=function(o){var t=new Fe(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t},u.aU=function(o,t,n){return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],o},u.aV=function(o,t){var n=t[0],c=t[1],d=t[2],_=n*n+c*c+d*d;return _>0&&(_=1/Math.sqrt(_)),o[0]=t[0]*_,o[1]=t[1]*_,o[2]=t[2]*_,o},u.aW=On,u.aX=function(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]},u.aY=function(o,t,n){return o[0]=t[0]*n[0],o[1]=t[1]*n[1],o[2]=t[2]*n[2],o[3]=t[3]*n[3],o},u.aZ=ht,u.a_=function(o,t,n){let c=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return c===0?null:(-(o[0]*n[0]+o[1]*n[1]+o[2]*n[2])-n[3])/c},u.aa=za,u.ab=Lo,u.ac=rv,u.ad=function(o){let t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,c,d,_)=>{let y=d||_;return t[c]=!y||y.toLowerCase(),""}),t["max-age"]){let n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},u.ae=wa,u.af=function(o){return Math.pow(2,o)},u.ag=nt,u.ah=Kn,u.ai=85.051129,u.aj=Qy,u.ak=function(o){return Math.log(o)/Math.LN2},u.al=function(o){var t=o[0],n=o[1];return t*t+n*n},u.am=function(o,t){let n=[];for(let c in o)c in t||n.push(c);return n},u.an=function(o,t){let n=0,c=0;if(o.kind==="constant")c=o.layoutSize;else if(o.kind!=="source"){let{interpolationType:d,minZoom:_,maxZoom:y}=o,b=d?Kn(vn.interpolationFactor(d,t,_,y),0,1):0;o.kind==="camera"?c=lo.number(o.minSize,o.maxSize,b):n=b}return{uSizeT:n,uSize:c}},u.ap=function(o,{uSize:t,uSizeT:n},{lowerSize:c,upperSize:d}){return o.kind==="source"?c/$a:o.kind==="composite"?lo.number(c/$a,d/$a,n):t},u.aq=function(o,t){var n=t[0],c=t[1],d=t[2],_=t[3],y=t[4],b=t[5],w=t[6],T=t[7],M=t[8],k=t[9],z=t[10],B=t[11],j=t[12],$=t[13],Z=t[14],Q=t[15],de=n*b-c*y,oe=n*w-d*y,ce=n*T-_*y,Ie=c*w-d*b,Ee=c*T-_*b,ze=d*T-_*w,Je=M*$-k*j,qe=M*Z-z*j,Ke=M*Q-B*j,pt=k*Z-z*$,He=k*Q-B*$,Xe=z*Q-B*Z,ke=de*Xe-oe*He+ce*pt+Ie*Ke-Ee*qe+ze*Je;return ke?(o[0]=(b*Xe-w*He+T*pt)*(ke=1/ke),o[1]=(d*He-c*Xe-_*pt)*ke,o[2]=($*ze-Z*Ee+Q*Ie)*ke,o[3]=(z*Ee-k*ze-B*Ie)*ke,o[4]=(w*Ke-y*Xe-T*qe)*ke,o[5]=(n*Xe-d*Ke+_*qe)*ke,o[6]=(Z*ce-j*ze-Q*oe)*ke,o[7]=(M*ze-z*ce+B*oe)*ke,o[8]=(y*He-b*Ke+T*Je)*ke,o[9]=(c*Ke-n*He-_*Je)*ke,o[10]=(j*Ee-$*ce+Q*de)*ke,o[11]=(k*ce-M*Ee-B*de)*ke,o[12]=(b*qe-y*pt-w*Je)*ke,o[13]=(n*pt-c*qe+d*Je)*ke,o[14]=($*oe-j*Ie-Z*de)*ke,o[15]=(M*Ie-k*oe+z*de)*ke,o):null},u.ar=Lr,u.as=function(o){return Math.hypot(o[0],o[1])},u.at=function(o){return o[0]=0,o[1]=0,o},u.au=function(o,t,n){return o[0]=t[0]*n,o[1]=t[1]*n,o},u.av=Sg,u.aw=To,u.ax=function(o,t,n,c){let d=t.y-o.y,_=t.x-o.x,y=c.y-n.y,b=c.x-n.x,w=y*_-b*d;if(w===0)return null;let T=(b*(o.y-n.y)-y*(o.x-n.x))/w;return new x(o.x+T*_,o.y+T*d)},u.ay=sv,u.az=X_,u.b=no,u.b$=class extends f{},u.b0=function(o,t,n){return o[0]=t[0]*n,o[1]=t[1]*n,o[2]=t[2]*n,o[3]=t[3]*n,o},u.b1=function(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]+o[3]},u.b2=iv,u.b3=tu,u.b4=function(o,t,n,c,d){var _,y=1/Math.tan(t/2);return o[0]=y/n,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=y,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,d!=null&&d!==1/0?(o[10]=(d+c)*(_=1/(c-d)),o[14]=2*d*c*_):(o[10]=-1,o[14]=-2*c),o},u.b5=function(o){var t=new Fe(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},u.b6=function(o,t,n){var c=Math.sin(n),d=Math.cos(n),_=t[0],y=t[1],b=t[2],w=t[3],T=t[4],M=t[5],k=t[6],z=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=_*d+T*c,o[1]=y*d+M*c,o[2]=b*d+k*c,o[3]=w*d+z*c,o[4]=T*d-_*c,o[5]=M*d-y*c,o[6]=k*d-b*c,o[7]=z*d-w*c,o},u.b7=function(o,t,n){var c=Math.sin(n),d=Math.cos(n),_=t[4],y=t[5],b=t[6],w=t[7],T=t[8],M=t[9],k=t[10],z=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=_*d+T*c,o[5]=y*d+M*c,o[6]=b*d+k*c,o[7]=w*d+z*c,o[8]=T*d-_*c,o[9]=M*d-y*c,o[10]=k*d-b*c,o[11]=z*d-w*c,o},u.b8=function(){let o=new Float32Array(16);return nt(o),o},u.b9=function(){let o=new Float64Array(16);return nt(o),o},u.bA=function(o,t){let n=Tn(o,360),c=Tn(t,360),d=c-n,_=c>n?d-360:d+360;return Math.abs(d)<Math.abs(_)?d:_},u.bB=function(o){return o[0]=0,o[1]=0,o[2]=0,o},u.bC=function(o,t,n,c){let d=Math.sqrt(o*o+t*t),_=Math.sqrt(n*n+c*c);o/=d,t/=d,n/=_,c/=_;let y=Math.acos(o*n+t*c);return-t*n+o*c>0?y:-y},u.bD=function(o,t){let n=Tn(o,2*Math.PI),c=Tn(t,2*Math.PI);return Math.min(Math.abs(n-c),Math.abs(n-c+2*Math.PI),Math.abs(n-c-2*Math.PI))},u.bE=function(){let o={},t=ve.$version;for(let n in ve.$root){let c=ve.$root[n];if(c.required){let d=null;d=n==="version"?t:c.type==="array"?[]:{},d!=null&&(o[n]=d)}}return o},u.bF=Oc,u.bG=he,u.bH=function o(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let c=0;c<t.length;c++)if(!o(t[c],n[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(let c in t)if(!o(t[c],n[c]))return!1;return!0}return t===n},u.bI=function(o){o=o.slice();let t=Object.create(null);for(let n=0;n<o.length;n++)t[o[n].id]=o[n];for(let n=0;n<o.length;n++)"ref"in o[n]&&(o[n]=Ft(o[n],t[o[n].ref]));return o},u.bJ=function(o){if(o.type==="custom")return new $2(o);switch(o.type){case"background":return new U2(o);case"circle":return new Tw(o);case"color-relief":return new kw(o);case"fill":return new Ww(o);case"fill-extrusion":return new n2(o);case"heatmap":return new Pw(o);case"hillshade":return new Ew(o);case"line":return new u2(o);case"raster":return new V2(o);case"symbol":return new Fd(o)}},u.bK=ar,u.bL=function(o,t){if(!o)return[{command:"setStyle",args:[t]}];let n=[];try{if(!dt(o.version,t.version))return[{command:"setStyle",args:[t]}];dt(o.center,t.center)||n.push({command:"setCenter",args:[t.center]}),dt(o.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),dt(o.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),dt(o.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),dt(o.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),dt(o.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),dt(o.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),dt(o.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),dt(o.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),dt(o.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),dt(o.light,t.light)||n.push({command:"setLight",args:[t.light]}),dt(o.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),dt(o.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),dt(o.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});let c={},d=[];(function(y,b,w,T){let M;for(M in b=b||{},y=y||{})Object.prototype.hasOwnProperty.call(y,M)&&(Object.prototype.hasOwnProperty.call(b,M)||tn(M,w,T));for(M in b)Object.prototype.hasOwnProperty.call(b,M)&&(Object.prototype.hasOwnProperty.call(y,M)?dt(y[M],b[M])||(y[M].type==="geojson"&&b[M].type==="geojson"&&Vi(y,b,M)?kt(w,{command:"setGeoJSONSourceData",args:[M,b[M].data]}):nn(M,b,w,T)):fi(M,b,w))})(o.sources,t.sources,d,c);let _=[];o.layers&&o.layers.forEach(y=>{"source"in y&&c[y.source]?n.push({command:"removeLayer",args:[y.id]}):_.push(y)}),n=n.concat(d),(function(y,b,w){b=b||[];let T=(y=y||[]).map(Ht),M=b.map(Ht),k=y.reduce(Wi,{}),z=b.reduce(Wi,{}),B=T.slice(),j=Object.create(null),$,Z,Q,de,oe;for(let ce=0,Ie=0;ce<T.length;ce++)$=T[ce],Object.prototype.hasOwnProperty.call(z,$)?Ie++:(kt(w,{command:"removeLayer",args:[$]}),B.splice(B.indexOf($,Ie),1));for(let ce=0,Ie=0;ce<M.length;ce++)$=M[M.length-1-ce],B[B.length-1-ce]!==$&&(Object.prototype.hasOwnProperty.call(k,$)?(kt(w,{command:"removeLayer",args:[$]}),B.splice(B.lastIndexOf($,B.length-Ie),1)):Ie++,de=B[B.length-ce],kt(w,{command:"addLayer",args:[z[$],de]}),B.splice(B.length-ce,0,$),j[$]=!0);for(let ce=0;ce<M.length;ce++)if($=M[ce],Z=k[$],Q=z[$],!j[$]&&!dt(Z,Q))if(dt(Z.source,Q.source)&&dt(Z["source-layer"],Q["source-layer"])&&dt(Z.type,Q.type)){for(oe in Vt(Z.layout,Q.layout,w,$,null,"setLayoutProperty"),Vt(Z.paint,Q.paint,w,$,null,"setPaintProperty"),dt(Z.filter,Q.filter)||kt(w,{command:"setFilter",args:[$,Q.filter]}),dt(Z.minzoom,Q.minzoom)&&dt(Z.maxzoom,Q.maxzoom)||kt(w,{command:"setLayerZoomRange",args:[$,Q.minzoom,Q.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&(oe.indexOf("paint.")===0?Vt(Z[oe],Q[oe],w,$,oe.slice(6),"setPaintProperty"):dt(Z[oe],Q[oe])||kt(w,{command:"setLayerProperty",args:[$,oe,Q[oe]]}));for(oe in Q)Object.prototype.hasOwnProperty.call(Q,oe)&&!Object.prototype.hasOwnProperty.call(Z,oe)&&oe!=="layout"&&oe!=="paint"&&oe!=="filter"&&oe!=="metadata"&&oe!=="minzoom"&&oe!=="maxzoom"&&(oe.indexOf("paint.")===0?Vt(Z[oe],Q[oe],w,$,oe.slice(6),"setPaintProperty"):dt(Z[oe],Q[oe])||kt(w,{command:"setLayerProperty",args:[$,oe,Q[oe]]}))}else kt(w,{command:"removeLayer",args:[$]}),de=B[B.lastIndexOf($)+1],kt(w,{command:"addLayer",args:[Q,de]})})(_,t.layers,n)}catch(c){console.warn("Unable to compute style diff:",c),n=[{command:"setStyle",args:[t]}]}return n},u.bM=function(o){let t=[],n=o.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),o.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},u.bN=is,u.bO=ns,u.bP=class extends Vn{constructor(o,t){super(o,t),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},u.bQ=on,u.bR=class extends Vn{constructor(o,t){super(o,t),this.current=br}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let t=1;t<16;t++)if(o[t]!==this.current[t]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},u.bS=Ki,u.bT=class extends Vn{constructor(o,t){super(o,t),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},u.bU=class extends Vn{constructor(o,t){super(o,t),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},u.bV=$e,u.bW=function(o,t){var n=Math.sin(t),c=Math.cos(t);return o[0]=c,o[1]=n,o[2]=0,o[3]=-n,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},u.bX=function(o,t,n){var c=t[0],d=t[1],_=t[2];return o[0]=c*n[0]+d*n[3]+_*n[6],o[1]=c*n[1]+d*n[4]+_*n[7],o[2]=c*n[2]+d*n[5]+_*n[8],o},u.bY=function(o,t,n,c,d,_,y){var b=1/(t-n),w=1/(c-d),T=1/(_-y);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*T,o[11]=0,o[12]=(t+n)*b,o[13]=(d+c)*w,o[14]=(y+_)*T,o[15]=1,o},u.bZ=class extends Vn{constructor(o,t){super(o,t),this.current=new Array}set(o){if(o!=this.current){this.current=o;let t=new Float32Array(4*o.length);for(let n=0;n<o.length;n++)t[4*n]=o[n].r,t[4*n+1]=o[n].g,t[4*n+2]=o[n].b,t[4*n+3]=o[n].a;this.gl.uniform4fv(this.location,t)}}},u.b_=class extends Vn{constructor(o,t){super(o,t),this.current=new Array}set(o){if(o!=this.current){this.current=o;let t=new Float32Array(o);this.gl.uniform1fv(this.location,t)}}},u.ba=function(){return new Float64Array(16)},u.bb=function(o,t,n){let c=new Float64Array(4);return kr(c,o,t-90,n),c},u.bc=function(o,t,n,c){var d,_,y,b,w,T=t[0],M=t[1],k=t[2],z=t[3],B=n[0],j=n[1],$=n[2],Z=n[3];return(_=T*B+M*j+k*$+z*Z)<0&&(_=-_,B=-B,j=-j,$=-$,Z=-Z),1-_>Le?(d=Math.acos(_),y=Math.sin(d),b=Math.sin((1-c)*d)/y,w=Math.sin(c*d)/y):(b=1-c,w=c),o[0]=b*T+w*B,o[1]=b*M+w*j,o[2]=b*k+w*$,o[3]=b*z+w*Z,o},u.bd=function(o){let t=new Float64Array(9);var n,c,d,_,y,b,w,T,M,k,z,B,j,$,Z,Q,de,oe;k=(d=(c=o)[0])*(w=d+d),z=(_=c[1])*w,j=(y=c[2])*w,$=y*(T=_+_),Q=(b=c[3])*w,de=b*T,oe=b*(M=y+y),(n=t)[0]=1-(B=_*T)-(Z=y*M),n[3]=z-oe,n[6]=j+de,n[1]=z+oe,n[4]=1-k-Z,n[7]=$-Q,n[2]=j-de,n[5]=$+Q,n[8]=1-k-B;let ce=Zo(-Math.asin(Kn(t[2],-1,1))),Ie,Ee;return Math.hypot(t[5],t[8])<.001?(Ie=0,Ee=-Zo(Math.atan2(t[3],t[4]))):(Ie=Zo(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Ee=Zo(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Ie,pitch:ce+90,bearing:Ee}},u.be=function(o,t){return o.roll==t.roll&&o.pitch==t.pitch&&o.bearing==t.bearing},u.bf=Ut,u.bg=sa,u.bh=Xc,u.bi=Nh,u.bj=Kc,u.bk=va,u.bl=to,u.bm=Pn,u.bn=function(o,t,n,c,d){return va(c,d,Kn((o-t)/(n-t),0,1))},u.bo=Tn,u.bp=function(){return new Float64Array(3)},u.bq=function(o,t,n,c){return o[0]=t[0]+n[0]*c,o[1]=t[1]+n[1]*c,o[2]=t[2]+n[2]*c,o},u.br=kr,u.bs=function(o,t,n){var c=n[0],d=n[1],_=n[2],y=t[0],b=t[1],w=t[2],T=d*w-_*b,M=_*y-c*w,k=c*b-d*y,z=d*k-_*M,B=_*T-c*k,j=c*M-d*T,$=2*n[3];return M*=$,k*=$,B*=2,j*=2,o[0]=y+(T*=$)+(z*=2),o[1]=b+M+B,o[2]=w+k+j,o},u.bt=function(o,t,n){let c=(d=[o[0],o[1],o[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((M=d[8])*(y=d[4])-(b=d[5])*(T=d[7]))+d[1]*(-M*(_=d[3])+b*(w=d[6]))+d[2]*(T*_-y*w);var d,_,y,b,w,T,M;if(c===0)return null;let k=On([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),z=On([],[n[0],n[1],n[2]],[o[0],o[1],o[2]]),B=On([],[o[0],o[1],o[2]],[t[0],t[1],t[2]]),j=mi([],k,-o[3]);return Ui(j,j,mi([],z,-t[3])),Ui(j,j,mi([],B,-n[3])),mi(j,j,1/c),j},u.bu=Pg,u.bv=function(){return new Float64Array(4)},u.bw=function(o,t,n,c){var d=[],_=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],_[0]=d[0]*Math.cos(c)-d[1]*Math.sin(c),_[1]=d[0]*Math.sin(c)+d[1]*Math.cos(c),_[2]=d[2],o[0]=_[0]+n[0],o[1]=_[1]+n[1],o[2]=_[2]+n[2],o},u.bx=function(o,t,n,c){var d=[],_=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],_[0]=d[0],_[1]=d[1]*Math.cos(c)-d[2]*Math.sin(c),_[2]=d[1]*Math.sin(c)+d[2]*Math.cos(c),o[0]=_[0]+n[0],o[1]=_[1]+n[1],o[2]=_[2]+n[2],o},u.by=function(o,t,n,c){var d=[],_=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],_[0]=d[2]*Math.sin(c)+d[0]*Math.cos(c),_[1]=d[1],_[2]=d[2]*Math.cos(c)-d[0]*Math.sin(c),o[0]=_[0]+n[0],o[1]=_[1]+n[1],o[2]=_[2]+n[2],o},u.bz=function(o,t,n){var c=Math.sin(n),d=Math.cos(n),_=t[0],y=t[1],b=t[2],w=t[3],T=t[8],M=t[9],k=t[10],z=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=_*d-T*c,o[1]=y*d-M*c,o[2]=b*d-k*c,o[3]=w*d-z*c,o[8]=_*c+T*d,o[9]=y*c+M*d,o[10]=b*c+k*d,o[11]=w*c+z*d,o},u.c=me,u.c0=m2,u.c1=class extends a{},u.c2=sg,u.c3=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},u.c4=ay,u.c5=function(o,t,n){var c=t[0],d=t[1],_=t[2],y=n[3]*c+n[7]*d+n[11]*_+n[15];return o[0]=(n[0]*c+n[4]*d+n[8]*_+n[12])/(y=y||1),o[1]=(n[1]*c+n[5]*d+n[9]*_+n[13])/y,o[2]=(n[2]*c+n[6]*d+n[10]*_+n[14])/y,o},u.c6=class extends Ah{},u.c7=class extends P{},u.c8=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]&&o[4]===t[4]&&o[5]===t[5]&&o[6]===t[6]&&o[7]===t[7]&&o[8]===t[8]&&o[9]===t[9]&&o[10]===t[10]&&o[11]===t[11]&&o[12]===t[12]&&o[13]===t[13]&&o[14]===t[14]&&o[15]===t[15]},u.c9=function(o,t){var n=o[0],c=o[1],d=o[2],_=o[3],y=o[4],b=o[5],w=o[6],T=o[7],M=o[8],k=o[9],z=o[10],B=o[11],j=o[12],$=o[13],Z=o[14],Q=o[15],de=t[0],oe=t[1],ce=t[2],Ie=t[3],Ee=t[4],ze=t[5],Je=t[6],qe=t[7],Ke=t[8],pt=t[9],He=t[10],Xe=t[11],ke=t[12],St=t[13],It=t[14],ft=t[15];return Math.abs(n-de)<=Le*Math.max(1,Math.abs(n),Math.abs(de))&&Math.abs(c-oe)<=Le*Math.max(1,Math.abs(c),Math.abs(oe))&&Math.abs(d-ce)<=Le*Math.max(1,Math.abs(d),Math.abs(ce))&&Math.abs(_-Ie)<=Le*Math.max(1,Math.abs(_),Math.abs(Ie))&&Math.abs(y-Ee)<=Le*Math.max(1,Math.abs(y),Math.abs(Ee))&&Math.abs(b-ze)<=Le*Math.max(1,Math.abs(b),Math.abs(ze))&&Math.abs(w-Je)<=Le*Math.max(1,Math.abs(w),Math.abs(Je))&&Math.abs(T-qe)<=Le*Math.max(1,Math.abs(T),Math.abs(qe))&&Math.abs(M-Ke)<=Le*Math.max(1,Math.abs(M),Math.abs(Ke))&&Math.abs(k-pt)<=Le*Math.max(1,Math.abs(k),Math.abs(pt))&&Math.abs(z-He)<=Le*Math.max(1,Math.abs(z),Math.abs(He))&&Math.abs(B-Xe)<=Le*Math.max(1,Math.abs(B),Math.abs(Xe))&&Math.abs(j-ke)<=Le*Math.max(1,Math.abs(j),Math.abs(ke))&&Math.abs($-St)<=Le*Math.max(1,Math.abs($),Math.abs(St))&&Math.abs(Z-It)<=Le*Math.max(1,Math.abs(Z),Math.abs(It))&&Math.abs(Q-ft)<=Le*Math.max(1,Math.abs(Q),Math.abs(ft))},u.cA=function(o,t){V.REGISTERED_PROTOCOLS[o]=t},u.cB=function(o){delete V.REGISTERED_PROTOCOLS[o]},u.cC=function(o,t){let n={};for(let d=0;d<o.length;d++){let _=t&&t[o[d].id]||Kf(o[d]);t&&(t[o[d].id]=_);let y=n[_];y||(y=n[_]=[]),y.push(o[d])}let c=[];for(let d in n)c.push(n[d]);return c},u.cD=tt,u.cE=nv,u.cF=ov,u.cG=zy,u.cH=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ri/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;let t=o.bucket.layers[0],n=t.layout,c=t._unevaluatedLayout._values,d={layoutIconSize:c["icon-size"].possiblyEvaluate(new xi(o.bucket.zoom+1),o.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new xi(o.bucket.zoom+1),o.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new xi(18))};if(o.bucket.textSizeData.kind==="composite"){let{minZoom:T,maxZoom:M}=o.bucket.textSizeData;d.compositeTextSizes=[c["text-size"].possiblyEvaluate(new xi(T),o.canonical),c["text-size"].possiblyEvaluate(new xi(M),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){let{minZoom:T,maxZoom:M}=o.bucket.iconSizeData;d.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new xi(T),o.canonical),c["icon-size"].possiblyEvaluate(new xi(M),o.canonical)]}let _=n.get("text-line-height")*hn,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",b=n.get("text-keep-upright"),w=n.get("text-size");for(let T of o.bucket.features){let M=n.get("text-font").evaluate(T,{},o.canonical).join(","),k=w.evaluate(T,{},o.canonical),z=d.layoutTextSize.evaluate(T,{},o.canonical),B=d.layoutIconSize.evaluate(T,{},o.canonical),j={horizontal:{},vertical:void 0},$=T.text,Z,Q=[0,0];if($){let ce=$.toString(),Ie=n.get("text-letter-spacing").evaluate(T,{},o.canonical)*hn,Ee=Qf(ce)?Ie:0,ze=n.get("text-anchor").evaluate(T,{},o.canonical),Je=gv(t,T,o.canonical);if(!Je){let He=n.get("text-radial-offset").evaluate(T,{},o.canonical);Q=He?fv(ze,[He*hn,Ag]):n.get("text-offset").evaluate(T,{},o.canonical).map(Xe=>Xe*hn)}let qe=y?"center":n.get("text-justify").evaluate(T,{},o.canonical),Ke=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(T,{},o.canonical)*hn:1/0,pt=()=>{o.bucket.allowVerticalPlacement&&Fc(ce)&&(j.vertical=Rd($,o.glyphMap,o.glyphPositions,o.imagePositions,M,Ke,_,ze,"left",Ee,Q,u.ao.vertical,!0,z,k))};if(!y&&Je){let He=new Set;if(qe==="auto")for(let ke=0;ke<Je.values.length;ke+=2)He.add(kg(Je.values[ke]));else He.add(qe);let Xe=!1;for(let ke of He)if(!j.horizontal[ke])if(Xe)j.horizontal[ke]=j.horizontal[0];else{let St=Rd($,o.glyphMap,o.glyphPositions,o.imagePositions,M,Ke,_,"center",ke,Ee,Q,u.ao.horizontal,!1,z,k);St&&(j.horizontal[ke]=St,Xe=St.positionedLines.length===1)}pt()}else{qe==="auto"&&(qe=kg(ze));let He=Rd($,o.glyphMap,o.glyphPositions,o.imagePositions,M,Ke,_,ze,qe,Ee,Q,u.ao.horizontal,!1,z,k);He&&(j.horizontal[qe]=He),pt(),Fc(ce)&&y&&b&&(j.vertical=Rd($,o.glyphMap,o.glyphPositions,o.imagePositions,M,Ke,_,ze,qe,Ee,Q,u.ao.vertical,!1,z,k))}}let de=!1;if(T.icon&&T.icon.name){let ce=o.imageMap[T.icon.name];ce&&(Z=O2(o.imagePositions[T.icon.name],n.get("icon-offset").evaluate(T,{},o.canonical),n.get("icon-anchor").evaluate(T,{},o.canonical)),de=!!ce.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=de:o.bucket.sdfIcons!==de&&Ni("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ce.pixelRatio!==o.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}let oe=yv(j.horizontal)||j.vertical;o.bucket.iconsInText=!!oe&&oe.iconsInText,(oe||Z)&&Y2(o.bucket,T,j,Z,o.imageMap,d,z,B,Q,de,o.canonical,o.subdivisionGranularity)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},u.cI=gg,u.cJ=dg,u.cK=fg,u.cL=by,u.cM=yg,u.cN=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},u.cO=function(o,t,n,c,d){return r(this,void 0,void 0,function*(){if(xe())try{return yield rs(o,t,n,c,d)}catch{}return(function(_,y,b,w,T){let M=_.width,k=_.height;Go&&qo||(Go=new OffscreenCanvas(M,k),qo=Go.getContext("2d",{willReadFrequently:!0})),Go.width=M,Go.height=k,qo.drawImage(_,0,0,M,k);let z=qo.getImageData(y,b,w,T);return qo.clearRect(0,0,M,k),z.data})(o,t,n,c,d)})},u.cP=cy,u.cQ=C,u.cR=xy,u.cS=Jc,u.cT=_l,u.cU=function(o,t){let n=new Map;if(o!=null)if(o.type==="Feature")n.set(Hh(o,t),o);else for(let c of o.features)n.set(Hh(c,t),c);return n},u.cV=function(o,t){if(o==null)return!0;if(o.type==="Feature")return Hh(o,t)!=null;if(o.type==="FeatureCollection"){let n=new Set;for(let c of o.features){let d=Hh(c,t);if(d==null||n.has(d))return!1;n.add(d)}return!0}return!1},u.cW=function(o,t,n){var c,d,_,y;if(t.removeAll&&o.clear(),t.remove)for(let b of t.remove)o.delete(b);if(t.add)for(let b of t.add){let w=Hh(b,n);w!=null&&o.set(w,b)}if(t.update)for(let b of t.update){let w=o.get(b.id);if(w==null)continue;let T=!b.removeAllProperties&&(((c=b.removeProperties)===null||c===void 0?void 0:c.length)>0||((d=b.addOrUpdateProperties)===null||d===void 0?void 0:d.length)>0);if((b.newGeometry||b.removeAllProperties||T)&&(w=Object.assign({},w),o.set(b.id,w),T&&(w.properties=Object.assign({},w.properties))),b.newGeometry&&(w.geometry=b.newGeometry),b.removeAllProperties)w.properties={};else if(((_=b.removeProperties)===null||_===void 0?void 0:_.length)>0)for(let M of b.removeProperties)Object.prototype.hasOwnProperty.call(w.properties,M)&&delete w.properties[M];if(((y=b.addOrUpdateProperties)===null||y===void 0?void 0:y.length)>0)for(let{key:M,value:k}of b.addOrUpdateProperties)w.properties[M]=k}},u.cX=Vr,u.ca=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},u.cb=o=>o.type==="symbol",u.cc=o=>o.type==="circle",u.cd=o=>o.type==="heatmap",u.ce=o=>o.type==="line",u.cf=o=>o.type==="fill",u.cg=o=>o.type==="fill-extrusion",u.ch=o=>o.type==="hillshade",u.ci=o=>o.type==="color-relief",u.cj=o=>o.type==="raster",u.ck=o=>o.type==="background",u.cl=o=>o.type==="custom",u.cm=$o,u.cn=function(o,t,n){let c=es(t.x-n.x,t.y-n.y),d=es(o.x-n.x,o.y-n.y);var _,y;return Zo(Math.atan2(c[0]*d[1]-c[1]*d[0],(_=c)[0]*(y=d)[0]+_[1]*y[1]))},u.co=xa,u.cp=function(o,t){return Ko[t]&&(o instanceof MouseEvent||o instanceof WheelEvent)},u.cq=function(o,t){return Ho[t]&&"touches"in o},u.cr=function(o){return Ho[o]||Ko[o]},u.cs=function(o,t,n){var c=t[0],d=t[1];return o[0]=n[0]*c+n[4]*d+n[12],o[1]=n[1]*c+n[5]*d+n[13],o},u.ct=function(o,t){let{x:n,y:c}=Zh.fromLngLat(t);return!(o<0||o>25||c<0||c>=1||n<0||n>=1)},u.cu=function(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},u.cv=class extends Cs{},u.cw=eS,u.cy=function(o){return o.message===os},u.cz=ne,u.d=Te,u.e=_r,u.f=o=>r(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.g=G,u.h=o=>new Promise((t,n)=>{let c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=ro})},c.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let d=new Blob([new Uint8Array(o)],{type:"image/png"});c.src=o.byteLength?URL.createObjectURL(d):ro}),u.i=io,u.j=(o,t)=>ge(_r(o,{type:"json"}),t),u.k=De,u.l=Oe,u.m=ge,u.n=(o,t)=>ge(_r(o,{type:"arrayBuffer"}),t),u.o=function(o){return new yg(o).readFields(T2,[])},u.p=Ry,u.q=Oh,u.r=Un,u.s=Wo,u.t=Sd,u.u=qt,u.v=ve,u.w=Ni,u.x=Xf,u.y=Il,u.z=ws}),i("worker",["./shared"],function(u){"use strict";class r{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,G){for(let ne of V){this._layerConfigs[ne.id]=ne;let he=this._layers[ne.id]=u.bJ(ne);he._featureFilter=u.aa(he.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(let ne of G)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};let W=u.cC(Object.values(this._layerConfigs),this.keyCache);for(let ne of W){let he=ne.map(De=>this._layers[De.id]),ge=he[0];if(ge.visibility==="none")continue;let Te=ge.source||"",ye=this.familiesBySource[Te];ye||(ye=this.familiesBySource[Te]={});let Ae=ge.sourceLayer||"_geojsonTileLayer",Oe=ye[Ae];Oe||(Oe=ye[Ae]=[]),Oe.push(he)}}}class x{constructor(V){let G={},W=[];for(let Te in V){let ye=V[Te],Ae=G[Te]={};for(let Oe in ye){let De=ye[+Oe];if(!De||De.bitmap.width===0||De.bitmap.height===0)continue;let ct={x:0,y:0,w:De.bitmap.width+2,h:De.bitmap.height+2};W.push(ct),Ae[Oe]={rect:ct,metrics:De.metrics}}}let{w:ne,h:he}=u.p(W),ge=new u.q({width:ne||1,height:he||1});for(let Te in V){let ye=V[Te];for(let Ae in ye){let Oe=ye[+Ae];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;let De=G[Te][Ae].rect;u.q.copy(Oe.bitmap,ge,{x:0,y:0},{x:De.x+1,y:De.y+1},Oe.bitmap)}}this.image=ge,this.positions=G}}u.cD("GlyphAtlas",x);class C{constructor(V){this.tileID=new u.Z(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.globalState=V.globalState}parse(V,G,W,ne,he){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new u.a8;let ge=new u.cE(Object.keys(V.layers).sort()),Te=new u.cF(this.tileID,this.promoteId);Te.bucketLayerIDs=[];let ye={},Ae={featureIndex:Te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W,subdivisionGranularity:he},Oe=G.familiesBySource[this.source];for(let Vt in Oe){let Ht=V.layers[Vt];if(!Ht)continue;Ht.version===1&&u.w(`Vector tile source "${this.source}" layer "${Vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Wi=ge.encode(Vt),Ge=[];for(let Cn=0;Cn<Ht.length;Cn++){let Ci=Ht.feature(Cn),Xo=Te.getId(Ci,Vt);Ge.push({feature:Ci,id:Xo,index:Cn,sourceLayerIndex:Wi})}for(let Cn of Oe[Vt]){let Ci=Cn[0];Ci.source!==this.source&&u.w(`layer.source = ${Ci.source} does not equal this.source = ${this.source}`),Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(A(Cn,this.zoom,W),(ye[Ci.id]=Ci.createBucket({index:Te.bucketLayerIDs.length,layers:Cn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wi,sourceID:this.source,globalState:this.globalState})).populate(Ge,Ae,this.tileID.canonical),Te.bucketLayerIDs.push(Cn.map(Xo=>Xo.id)))}}let De=u.bN(Ae.glyphDependencies,Vt=>Object.keys(Vt).map(Number));this.inFlightDependencies.forEach(Vt=>Vt?.abort()),this.inFlightDependencies=[];let ct=Promise.resolve({});if(Object.keys(De).length){let Vt=new AbortController;this.inFlightDependencies.push(Vt),ct=ne.sendAsync({type:"GG",data:{stacks:De,source:this.source,tileID:this.tileID,type:"glyphs"}},Vt)}let ve=Object.keys(Ae.iconDependencies),Tt=Promise.resolve({});if(ve.length){let Vt=new AbortController;this.inFlightDependencies.push(Vt),Tt=ne.sendAsync({type:"GI",data:{icons:ve,source:this.source,tileID:this.tileID,type:"icons"}},Vt)}let Ft=Object.keys(Ae.patternDependencies),dt=Promise.resolve({});if(Ft.length){let Vt=new AbortController;this.inFlightDependencies.push(Vt),dt=ne.sendAsync({type:"GI",data:{icons:Ft,source:this.source,tileID:this.tileID,type:"patterns"}},Vt)}let[kt,fi,tn]=yield Promise.all([ct,Tt,dt]),nn=new x(kt),Vi=new u.cG(fi,tn);for(let Vt in ye){let Ht=ye[Vt];Ht instanceof u.a9?(A(Ht.layers,this.zoom,W),u.cH({bucket:Ht,glyphMap:kt,glyphPositions:nn.positions,imageMap:fi,imagePositions:Vi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ae.subdivisionGranularity})):Ht.hasPattern&&(Ht instanceof u.cI||Ht instanceof u.cJ||Ht instanceof u.cK)&&(A(Ht.layers,this.zoom,W),Ht.addFeatures(Ae,this.tileID.canonical,Vi.patternPositions))}return this.status="done",{buckets:Object.values(ye).filter(Vt=>!Vt.isEmpty()),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nn.image,imageAtlas:Vi,glyphMap:this.returnDependencies?kt:null,iconMap:this.returnDependencies?fi:null,glyphPositions:this.returnDependencies?nn.positions:null}})}}function A(me,V,G){let W=new u.F(V);for(let ne of me)ne.recalculate(W,G)}class R{constructor(V,G,W){this.actor=V,this.layerIndex=G,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,G){return u._(this,void 0,void 0,function*(){let W=yield u.n(V.request,G);try{return{vectorTile:new u.cL(new u.cM(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(ne){let he=new Uint8Array(W.data),ge=`Unable to parse the tile at ${V.request.url}, `;throw ge+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ne.message}`,new Error(ge)}})}loadTile(V){return u._(this,void 0,void 0,function*(){let G=V.uid,W=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.cN(V.request),ne=new C(V);this.loading[G]=ne;let he=new AbortController;ne.abort=he;try{let ge=yield this.loadVectorTile(V,he);if(delete this.loading[G],!ge)return null;let Te=ge.rawData,ye={};ge.expires&&(ye.expires=ge.expires),ge.cacheControl&&(ye.cacheControl=ge.cacheControl);let Ae={};if(W){let De=W.finish();De&&(Ae.resourceTiming=JSON.parse(JSON.stringify(De)))}ne.vectorTile=ge.vectorTile;let Oe=ne.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[G]=ne,this.fetching[G]={rawTileData:Te,cacheControl:ye,resourceTiming:Ae};try{let De=yield Oe;return u.e({rawTileData:Te.slice(0)},De,ye,Ae)}finally{delete this.fetching[G]}}catch(ge){throw delete this.loading[G],ne.status="done",this.loaded[G]=ne,ge}})}reloadTile(V){return u._(this,void 0,void 0,function*(){let G=V.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let W=this.loaded[G];if(W.showCollisionBoxes=V.showCollisionBoxes,W.globalState=V.globalState,W.status==="parsing"){let ne=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity),he;if(this.fetching[G]){let{rawTileData:ge,cacheControl:Te,resourceTiming:ye}=this.fetching[G];delete this.fetching[G],he=u.e({rawTileData:ge.slice(0)},ne,Te,ye)}else he=ne;return he}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)})}abortTile(V){return u._(this,void 0,void 0,function*(){let G=this.loading,W=V.uid;G&&G[W]&&G[W].abort&&(G[W].abort.abort(),delete G[W])})}removeTile(V){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class U{constructor(){this.loaded={}}loadTile(V){return u._(this,void 0,void 0,function*(){let{uid:G,encoding:W,rawImageData:ne,redFactor:he,greenFactor:ge,blueFactor:Te,baseShift:ye}=V,Ae=ne.width+2,Oe=ne.height+2,De=u.b(ne)?new u.R({width:Ae,height:Oe},yield u.cO(ne,-1,-1,Ae,Oe)):ne,ct=new u.cP(G,De,W,he,ge,Te,ye);return this.loaded=this.loaded||{},this.loaded[G]=ct,ct})}removeTile(V){let G=this.loaded,W=V.uid;G&&G[W]&&delete G[W]}}var F,le,se=(function(){if(le)return F;function me(G,W){if(G.length!==0){V(G[0],W);for(var ne=1;ne<G.length;ne++)V(G[ne],!W)}}function V(G,W){for(var ne=0,he=0,ge=0,Te=G.length,ye=Te-1;ge<Te;ye=ge++){var Ae=(G[ge][0]-G[ye][0])*(G[ye][1]+G[ge][1]),Oe=ne+Ae;he+=Math.abs(ne)>=Math.abs(Ae)?ne-Oe+Ae:Ae-Oe+ne,ne=Oe}ne+he>=0!=!!W&&G.reverse()}return le=1,F=function G(W,ne){var he,ge=W&&W.type;if(ge==="FeatureCollection")for(he=0;he<W.features.length;he++)G(W.features[he],ne);else if(ge==="GeometryCollection")for(he=0;he<W.geometries.length;he++)G(W.geometries[he],ne);else if(ge==="Feature")G(W.geometry,ne);else if(ge==="Polygon")me(W.coordinates,ne);else if(ge==="MultiPolygon")for(he=0;he<W.coordinates.length;he++)me(W.coordinates[he],ne);return W}})(),fe=u.cQ(se);class xe extends u.cS{constructor(V,G){super(new u.cM,0,G,[],[]),this.feature=V,this.type=V.type,this.properties=V.tags?V.tags:{},"id"in V&&(typeof V.id=="string"?this.id=parseInt(V.id,10):typeof V.id!="number"||isNaN(V.id)||(this.id=V.id))}loadGeometry(){let V=[],G=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let W of G){let ne=[];for(let he of W)ne.push(new u.P(he[0],he[1]));V.push(ne)}return V}}class Le extends u.cR{constructor(V,G){super(new u.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=G?G.version:1,this.extent=G?G.extent:4096,this.length=V.length,this.features=V}feature(V){return new xe(this.features[V],this.extent)}}function Fe(me,V){V.writeVarintField(15,me.version||1),V.writeStringField(1,me.name||""),V.writeVarintField(5,me.extent||4096);let G={keys:[],values:[],keycache:{},valuecache:{}};for(let he=0;he<me.length;he++)G.feature=me.feature(he),V.writeMessage(2,$e,G);let W=G.keys;for(let he of W)V.writeStringField(3,he);let ne=G.values;for(let he of ne)V.writeMessage(4,Ui,he)}function $e(me,V){if(!me.feature)return;let G=me.feature;G.id!==void 0&&V.writeVarintField(1,G.id),V.writeMessage(2,nt,me),V.writeVarintField(3,G.type),V.writeMessage(4,Et,G)}function nt(me,V){for(let G in me.feature?.properties){let W=me.feature.properties[G],ne=me.keycache[G];if(W===null)continue;ne===void 0&&(me.keys.push(G),ne=me.keys.length-1,me.keycache[G]=ne),V.writeVarint(ne),typeof W!="string"&&typeof W!="boolean"&&typeof W!="number"&&(W=JSON.stringify(W));let he=typeof W+":"+W,ge=me.valuecache[he];ge===void 0&&(me.values.push(W),ge=me.values.length-1,me.valuecache[he]=ge),V.writeVarint(ge)}}function je(me,V){return(V<<3)+(7&me)}function ht(me){return me<<1^me>>31}function Et(me,V){let G=me.loadGeometry(),W=me.type,ne=0,he=0;for(let ge of G){let Te=1;W===1&&(Te=ge.length),V.writeVarint(je(1,Te));let ye=W===3?ge.length-1:ge.length;for(let Ae=0;Ae<ye;Ae++){Ae===1&&W!==1&&V.writeVarint(je(2,ye-1));let Oe=ge[Ae].x-ne,De=ge[Ae].y-he;V.writeVarint(ht(Oe)),V.writeVarint(ht(De)),ne+=Oe,he+=De}me.type===3&&V.writeVarint(je(7,1))}}function Ui(me,V){let G=typeof me;G==="string"?V.writeStringField(1,me):G==="boolean"?V.writeBooleanField(7,me):G==="number"&&(me%1!=0?V.writeDoubleField(3,me):me<0?V.writeSVarintField(6,me):V.writeVarintField(5,me))}let mi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},On=Math.fround||(In=new Float32Array(1),me=>(In[0]=+me,In[0]));var In;class Hn{constructor(V){this.options=Object.assign(Object.create(mi),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){let{log:G,minZoom:W,maxZoom:ne}=this.options;G&&console.time("total time");let he=`prepare ${V.length} points`;G&&console.time(he),this.points=V;let ge=[];for(let ye=0;ye<V.length;ye++){let Ae=V[ye];if(!Ae.geometry)continue;let[Oe,De]=Ae.geometry.coordinates,ct=On(kr(Oe)),ve=On(Lr(De));ge.push(ct,ve,1/0,ye,-1,1),this.options.reduce&&ge.push(0)}let Te=this.trees[ne+1]=this._createTree(ge);G&&console.timeEnd(he);for(let ye=ne;ye>=W;ye--){let Ae=+Date.now();Te=this.trees[ye]=this._createTree(this._cluster(Te,ye)),G&&console.log("z%d: %d clusters in %dms",ye,Te.numItems,+Date.now()-Ae)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let W=((V[0]+180)%360+360)%360-180,ne=Math.max(-90,Math.min(90,V[1])),he=V[2]===180?180:((V[2]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)W=-180,he=180;else if(W>he){let De=this.getClusters([W,ne,180,ge],G),ct=this.getClusters([-180,ne,he,ge],G);return De.concat(ct)}let Te=this.trees[this._limitZoom(G)],ye=Te.range(kr(W),Lr(ge),kr(he),Lr(ne)),Ae=Te.data,Oe=[];for(let De of ye){let ct=this.stride*De;Oe.push(Ae[ct+5]>1?To(Ae,ct,this.clusterProps):this.points[Ae[ct+3]])}return Oe}getChildren(V){let G=this._getOriginId(V),W=this._getOriginZoom(V),ne="No cluster with the specified id.",he=this.trees[W];if(!he)throw new Error(ne);let ge=he.data;if(G*this.stride>=ge.length)throw new Error(ne);let Te=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ye=he.within(ge[G*this.stride],ge[G*this.stride+1],Te),Ae=[];for(let Oe of ye){let De=Oe*this.stride;ge[De+4]===V&&Ae.push(ge[De+5]>1?To(ge,De,this.clusterProps):this.points[ge[De+3]])}if(Ae.length===0)throw new Error(ne);return Ae}getLeaves(V,G,W){let ne=[];return this._appendLeaves(ne,V,G=G||10,W=W||0,0),ne}getTile(V,G,W){let ne=this.trees[this._limitZoom(V)],he=Math.pow(2,V),{extent:ge,radius:Te}=this.options,ye=Te/ge,Ae=(W-ye)/he,Oe=(W+1+ye)/he,De={features:[]};return this._addTileFeatures(ne.range((G-ye)/he,Ae,(G+1+ye)/he,Oe),ne.data,G,W,he,De),G===0&&this._addTileFeatures(ne.range(1-ye/he,Ae,1,Oe),ne.data,he,W,he,De),G===he-1&&this._addTileFeatures(ne.range(0,Ae,ye/he,Oe),ne.data,-1,W,he,De),De.features.length?De:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){let W=this.getChildren(V);if(G++,W.length!==1)break;V=W[0].properties.cluster_id}return G}_appendLeaves(V,G,W,ne,he){let ge=this.getChildren(G);for(let Te of ge){let ye=Te.properties;if(ye&&ye.cluster?he+ye.point_count<=ne?he+=ye.point_count:he=this._appendLeaves(V,ye.cluster_id,W,ne,he):he<ne?he++:V.push(Te),V.length===W)break}return he}_createTree(V){let G=new u.aI(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<V.length;W+=this.stride)G.add(V[W],V[W+1]);return G.finish(),G.data=V,G}_addTileFeatures(V,G,W,ne,he,ge){for(let Te of V){let ye=Te*this.stride,Ae=G[ye+5]>1,Oe,De,ct;if(Ae)Oe=Ar(G,ye,this.clusterProps),De=G[ye],ct=G[ye+1];else{let Ft=this.points[G[ye+3]];Oe=Ft.properties;let[dt,kt]=Ft.geometry.coordinates;De=kr(dt),ct=Lr(kt)}let ve={type:1,geometry:[[Math.round(this.options.extent*(De*he-W)),Math.round(this.options.extent*(ct*he-ne))]],tags:Oe},Tt;Tt=Ae||this.options.generateId?G[ye+3]:this.points[G[ye+3]].id,Tt!==void 0&&(ve.id=Tt),ge.features.push(ve)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,G){let{radius:W,extent:ne,reduce:he,minPoints:ge}=this.options,Te=W/(ne*Math.pow(2,G)),ye=V.data,Ae=[],Oe=this.stride;for(let De=0;De<ye.length;De+=Oe){if(ye[De+2]<=G)continue;ye[De+2]=G;let ct=ye[De],ve=ye[De+1],Tt=V.within(ye[De],ye[De+1],Te),Ft=ye[De+5],dt=Ft;for(let kt of Tt){let fi=kt*Oe;ye[fi+2]>G&&(dt+=ye[fi+5])}if(dt>Ft&&dt>=ge){let kt,fi=ct*Ft,tn=ve*Ft,nn=-1,Vi=(De/Oe<<5)+(G+1)+this.points.length;for(let Vt of Tt){let Ht=Vt*Oe;if(ye[Ht+2]<=G)continue;ye[Ht+2]=G;let Wi=ye[Ht+5];fi+=ye[Ht]*Wi,tn+=ye[Ht+1]*Wi,ye[Ht+4]=Vi,he&&(kt||(kt=this._map(ye,De,!0),nn=this.clusterProps.length,this.clusterProps.push(kt)),he(kt,this._map(ye,Ht)))}ye[De+4]=Vi,Ae.push(fi/dt,tn/dt,1/0,Vi,-1,dt),he&&Ae.push(nn)}else{for(let kt=0;kt<Oe;kt++)Ae.push(ye[De+kt]);if(dt>1)for(let kt of Tt){let fi=kt*Oe;if(!(ye[fi+2]<=G)){ye[fi+2]=G;for(let tn=0;tn<Oe;tn++)Ae.push(ye[fi+tn])}}}}return Ae}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G,W){if(V[G+5]>1){let ge=this.clusterProps[V[G+6]];return W?Object.assign({},ge):ge}let ne=this.points[V[G+3]].properties,he=this.options.map(ne);return W&&he===ne?Object.assign({},he):he}}function To(me,V,G){return{type:"Feature",id:me[V+3],properties:Ar(me,V,G),geometry:{type:"Point",coordinates:[(W=me[V],360*(W-.5)),es(me[V+1])]}};var W}function Ar(me,V,G){let W=me[V+5],ne=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,he=me[V+6],ge=he===-1?{}:Object.assign({},G[he]);return Object.assign(ge,{cluster:!0,cluster_id:me[V+3],point_count:W,point_count_abbreviated:ne})}function kr(me){return me/360+.5}function Lr(me){let V=Math.sin(me*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function es(me){let V=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function ri(me,V,G,W){let ne=W,he=V+(G-V>>1),ge,Te=G-V,ye=me[V],Ae=me[V+1],Oe=me[G],De=me[G+1];for(let ct=V+3;ct<G;ct+=3){let ve=Co(me[ct],me[ct+1],ye,Ae,Oe,De);if(ve>ne)ge=ct,ne=ve;else if(ve===ne){let Tt=Math.abs(ct-he);Tt<Te&&(ge=ct,Te=Tt)}}ne>W&&(ge-V>3&&ri(me,V,ge,W),me[ge+2]=ne,G-ge>3&&ri(me,ge,G,W))}function Co(me,V,G,W,ne,he){let ge=ne-G,Te=he-W;if(ge!==0||Te!==0){let ye=((me-G)*ge+(V-W)*Te)/(ge*ge+Te*Te);ye>1?(G=ne,W=he):ye>0&&(G+=ge*ye,W+=Te*ye)}return ge=me-G,Te=V-W,ge*ge+Te*Te}function Tn(me,V,G,W){let ne={id:me??null,type:V,geometry:G,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")va(ne,G);else if(V==="Polygon")va(ne,G[0]);else if(V==="MultiLineString")for(let he of G)va(ne,he);else if(V==="MultiPolygon")for(let he of G)va(ne,he[0]);return ne}function va(me,V){for(let G=0;G<V.length;G+=3)me.minX=Math.min(me.minX,V[G]),me.minY=Math.min(me.minY,V[G+1]),me.maxX=Math.max(me.maxX,V[G]),me.maxY=Math.max(me.maxY,V[G+1])}function to(me,V,G,W){if(!V.geometry)return;let ne=V.geometry.coordinates;if(ne&&ne.length===0)return;let he=V.geometry.type,ge=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),Te=[],ye=V.id;if(G.promoteId?ye=V.properties[G.promoteId]:G.generateId&&(ye=W||0),he==="Point")$o(ne,Te);else if(he==="MultiPoint")for(let Ae of ne)$o(Ae,Te);else if(he==="LineString")xa(ne,Te,ge,!1);else if(he==="MultiLineString"){if(G.lineMetrics){for(let Ae of ne)Te=[],xa(Ae,Te,ge,!1),me.push(Tn(ye,"LineString",Te,V.properties));return}Kn(ne,Te,ge,!1)}else if(he==="Polygon")Kn(ne,Te,ge,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(let Ae of V.geometry.geometries)to(me,{id:ye,geometry:Ae,properties:V.properties},G,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Ae of ne){let Oe=[];Kn(Ae,Oe,ge,!0),Te.push(Oe)}}me.push(Tn(ye,he,Te,V.properties))}function $o(me,V){V.push(ts(me[0]),_r(me[1]),0)}function xa(me,V,G,W){let ne,he,ge=0;for(let ye=0;ye<me.length;ye++){let Ae=ts(me[ye][0]),Oe=_r(me[ye][1]);V.push(Ae,Oe,0),ye>0&&(ge+=W?(ne*Oe-Ae*he)/2:Math.sqrt(Math.pow(Ae-ne,2)+Math.pow(Oe-he,2))),ne=Ae,he=Oe}let Te=V.length-3;V[2]=1,ri(V,0,Te,G),V[Te+2]=1,V.size=Math.abs(ge),V.start=0,V.end=V.size}function Kn(me,V,G,W){for(let ne=0;ne<me.length;ne++){let he=[];xa(me[ne],he,G,W),V.push(he)}}function ts(me){return me/360+.5}function _r(me){let V=Math.sin(me*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Dr(me,V,G,W,ne,he,ge,Te){if(W/=V,he>=(G/=V)&&ge<W)return me;if(ge<G||he>=W)return null;let ye=[];for(let Ae of me){let Oe=Ae.geometry,De=Ae.type,ct=ne===0?Ae.minX:Ae.minY,ve=ne===0?Ae.maxX:Ae.maxY;if(ct>=G&&ve<W){ye.push(Ae);continue}if(ve<G||ct>=W)continue;let Tt=[];if(De==="Point"||De==="MultiPoint")is(Oe,Tt,G,W,ne);else if(De==="LineString")ns(Oe,Tt,G,W,ne,!1,Te.lineMetrics);else if(De==="MultiLineString")Di(Oe,Tt,G,W,ne,!1);else if(De==="Polygon")Di(Oe,Tt,G,W,ne,!0);else if(De==="MultiPolygon")for(let Ft of Oe){let dt=[];Di(Ft,dt,G,W,ne,!0),dt.length&&Tt.push(dt)}if(Tt.length){if(Te.lineMetrics&&De==="LineString"){for(let Ft of Tt)ye.push(Tn(Ae.id,De,Ft,Ae.tags));continue}De!=="LineString"&&De!=="MultiLineString"||(Tt.length===1?(De="LineString",Tt=Tt[0]):De="MultiLineString"),De!=="Point"&&De!=="MultiPoint"||(De=Tt.length===3?"Point":"MultiPoint"),ye.push(Tn(Ae.id,De,Tt,Ae.tags))}}return ye.length?ye:null}function is(me,V,G,W,ne){for(let he=0;he<me.length;he+=3){let ge=me[he+ne];ge>=G&&ge<=W&&Ni(V,me[he],me[he+1],me[he+2])}}function ns(me,V,G,W,ne,he,ge){let Te=ar(me),ye=ne===0?Rr:io,Ae,Oe,De=me.start;for(let dt=0;dt<me.length-3;dt+=3){let kt=me[dt],fi=me[dt+1],tn=me[dt+2],nn=me[dt+3],Vi=me[dt+4],Vt=ne===0?kt:fi,Ht=ne===0?nn:Vi,Wi=!1;ge&&(Ae=Math.sqrt(Math.pow(kt-nn,2)+Math.pow(fi-Vi,2))),Vt<G?Ht>G&&(Oe=ye(Te,kt,fi,nn,Vi,G),ge&&(Te.start=De+Ae*Oe)):Vt>W?Ht<W&&(Oe=ye(Te,kt,fi,nn,Vi,W),ge&&(Te.start=De+Ae*Oe)):Ni(Te,kt,fi,tn),Ht<G&&Vt>=G&&(Oe=ye(Te,kt,fi,nn,Vi,G),Wi=!0),Ht>W&&Vt<=W&&(Oe=ye(Te,kt,fi,nn,Vi,W),Wi=!0),!he&&Wi&&(ge&&(Te.end=De+Ae*Oe),V.push(Te),Te=ar(me)),ge&&(De+=Ae)}let ct=me.length-3,ve=me[ct],Tt=me[ct+1],Ft=ne===0?ve:Tt;Ft>=G&&Ft<=W&&Ni(Te,ve,Tt,me[ct+2]),ct=Te.length-3,he&&ct>=3&&(Te[ct]!==Te[0]||Te[ct+1]!==Te[1])&&Ni(Te,Te[0],Te[1],Te[2]),Te.length&&V.push(Te)}function ar(me){let V=[];return V.size=me.size,V.start=me.start,V.end=me.end,V}function Di(me,V,G,W,ne,he){for(let ge of me)ns(ge,V,G,W,ne,he,!1)}function Ni(me,V,G,W){me.push(V,G,W)}function Rr(me,V,G,W,ne,he){let ge=(he-V)/(W-V);return Ni(me,he,G+(ne-G)*ge,1),ge}function io(me,V,G,W,ne,he){let ge=(he-G)/(ne-G);return Ni(me,V+(W-V)*ge,he,1),ge}function ba(me,V){let G=[];for(let W=0;W<me.length;W++){let ne=me[W],he=ne.type,ge;if(he==="Point"||he==="MultiPoint"||he==="LineString")ge=no(ne.geometry,V);else if(he==="MultiLineString"||he==="Polygon"){ge=[];for(let Te of ne.geometry)ge.push(no(Te,V))}else if(he==="MultiPolygon"){ge=[];for(let Te of ne.geometry){let ye=[];for(let Ae of Te)ye.push(no(Ae,V));ge.push(ye)}}G.push(Tn(ne.id,he,ge,ne.tags))}return G}function no(me,V){let G=[];G.size=me.size,me.start!==void 0&&(G.start=me.start,G.end=me.end);for(let W=0;W<me.length;W+=3)G.push(me[W]+V,me[W+1],me[W+2]);return G}function ro(me,V){if(me.transformed)return me;let G=1<<me.z,W=me.x,ne=me.y;for(let he of me.features){let ge=he.geometry,Te=he.type;if(he.geometry=[],Te===1)for(let ye=0;ye<ge.length;ye+=2)he.geometry.push(rs(ge[ye],ge[ye+1],V,G,W,ne));else for(let ye=0;ye<ge.length;ye++){let Ae=[];for(let Oe=0;Oe<ge[ye].length;Oe+=2)Ae.push(rs(ge[ye][Oe],ge[ye][Oe+1],V,G,W,ne));he.geometry.push(Ae)}}return me.transformed=!0,me}function rs(me,V,G,W,ne,he){return[Math.round(G*(me*W-ne)),Math.round(G*(V*W-he))]}function Go(me,V,G,W,ne){let he=V===ne.maxZoom?0:ne.tolerance/((1<<V)*ne.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:me.length,source:null,x:G,y:W,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Te of me)qo(ge,Te,he,ne);return ge}function qo(me,V,G,W){let ne=V.geometry,he=V.type,ge=[];if(me.minX=Math.min(me.minX,V.minX),me.minY=Math.min(me.minY,V.minY),me.maxX=Math.max(me.maxX,V.maxX),me.maxY=Math.max(me.maxY,V.maxY),he==="Point"||he==="MultiPoint")for(let Te=0;Te<ne.length;Te+=3)ge.push(ne[Te],ne[Te+1]),me.numPoints++,me.numSimplified++;else if(he==="LineString")Wo(ge,ne,me,G,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let Te=0;Te<ne.length;Te++)Wo(ge,ne[Te],me,G,he==="Polygon",Te===0);else if(he==="MultiPolygon")for(let Te=0;Te<ne.length;Te++){let ye=ne[Te];for(let Ae=0;Ae<ye.length;Ae++)Wo(ge,ye[Ae],me,G,!0,Ae===0)}if(ge.length){let Te=V.tags||null;if(he==="LineString"&&W.lineMetrics){Te={};for(let Ae in V.tags)Te[Ae]=V.tags[Ae];Te.mapbox_clip_start=ne.start/ne.size,Te.mapbox_clip_end=ne.end/ne.size}let ye={geometry:ge,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:Te};V.id!==null&&(ye.id=V.id),me.features.push(ye)}}function Wo(me,V,G,W,ne,he){let ge=W*W;if(W>0&&V.size<(ne?ge:W))return void(G.numPoints+=V.length/3);let Te=[];for(let ye=0;ye<V.length;ye+=3)(W===0||V[ye+2]>ge)&&(G.numSimplified++,Te.push(V[ye],V[ye+1])),G.numPoints++;ne&&(function(ye,Ae){let Oe=0;for(let De=0,ct=ye.length,ve=ct-2;De<ct;ve=De,De+=2)Oe+=(ye[De]-ye[ve])*(ye[De+1]+ye[ve+1]);if(Oe>0===Ae)for(let De=0,ct=ye.length;De<ct/2;De+=2){let ve=ye[De],Tt=ye[De+1];ye[De]=ye[ct-2-De],ye[De+1]=ye[ct-1-De],ye[ct-2-De]=ve,ye[ct-1-De]=Tt}})(Te,he),me.push(Te)}let wa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Zo{constructor(V,G){let W=(G=this.options=(function(he,ge){for(let Te in ge)he[Te]=ge[Te];return he})(Object.create(wa),G)).debug;if(W&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let ne=(function(he,ge){let Te=[];if(he.type==="FeatureCollection")for(let ye=0;ye<he.features.length;ye++)to(Te,he.features[ye],ge,ye);else to(Te,he.type==="Feature"?he:{geometry:he},ge);return Te})(V,G);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=(function(he,ge){let Te=ge.buffer/ge.extent,ye=he,Ae=Dr(he,1,-1-Te,Te,0,-1,2,ge),Oe=Dr(he,1,1-Te,2+Te,0,-1,2,ge);return(Ae||Oe)&&(ye=Dr(he,1,-Te,1+Te,0,-1,2,ge)||[],Ae&&(ye=ba(Ae,1).concat(ye)),Oe&&(ye=ye.concat(ba(Oe,-1)))),ye})(ne,G),ne.length&&this.splitTile(ne,0,0,0),W&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,G,W,ne,he,ge,Te){let ye=[V,G,W,ne],Ae=this.options,Oe=Ae.debug;for(;ye.length;){ne=ye.pop(),W=ye.pop(),G=ye.pop(),V=ye.pop();let De=1<<G,ct=Ho(G,W,ne),ve=this.tiles[ct];if(!ve&&(Oe>1&&console.time("creation"),ve=this.tiles[ct]=Go(V,G,W,ne,Ae),this.tileCoords.push({z:G,x:W,y:ne}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,W,ne,ve.numFeatures,ve.numPoints,ve.numSimplified),console.timeEnd("creation"));let Wi=`z${G}`;this.stats[Wi]=(this.stats[Wi]||0)+1,this.total++}if(ve.source=V,he==null){if(G===Ae.indexMaxZoom||ve.numPoints<=Ae.indexMaxPoints)continue}else{if(G===Ae.maxZoom||G===he)continue;if(he!=null){let Wi=he-G;if(W!==ge>>Wi||ne!==Te>>Wi)continue}}if(ve.source=null,V.length===0)continue;Oe>1&&console.time("clipping");let Tt=.5*Ae.buffer/Ae.extent,Ft=.5-Tt,dt=.5+Tt,kt=1+Tt,fi=null,tn=null,nn=null,Vi=null,Vt=Dr(V,De,W-Tt,W+dt,0,ve.minX,ve.maxX,Ae),Ht=Dr(V,De,W+Ft,W+kt,0,ve.minX,ve.maxX,Ae);V=null,Vt&&(fi=Dr(Vt,De,ne-Tt,ne+dt,1,ve.minY,ve.maxY,Ae),tn=Dr(Vt,De,ne+Ft,ne+kt,1,ve.minY,ve.maxY,Ae),Vt=null),Ht&&(nn=Dr(Ht,De,ne-Tt,ne+dt,1,ve.minY,ve.maxY,Ae),Vi=Dr(Ht,De,ne+Ft,ne+kt,1,ve.minY,ve.maxY,Ae),Ht=null),Oe>1&&console.timeEnd("clipping"),ye.push(fi||[],G+1,2*W,2*ne),ye.push(tn||[],G+1,2*W,2*ne+1),ye.push(nn||[],G+1,2*W+1,2*ne),ye.push(Vi||[],G+1,2*W+1,2*ne+1)}}getTile(V,G,W){V=+V,G=+G,W=+W;let ne=this.options,{extent:he,debug:ge}=ne;if(V<0||V>24)return null;let Te=1<<V,ye=Ho(V,G=G+Te&Te-1,W);if(this.tiles[ye])return ro(this.tiles[ye],he);ge>1&&console.log("drilling down to z%d-%d-%d",V,G,W);let Ae,Oe=V,De=G,ct=W;for(;!Ae&&Oe>0;)Oe--,De>>=1,ct>>=1,Ae=this.tiles[Ho(Oe,De,ct)];return Ae&&Ae.source?(ge>1&&(console.log("found parent tile z%d-%d-%d",Oe,De,ct),console.time("drilling down")),this.splitTile(Ae.source,Oe,De,ct,V,G,W),ge>1&&console.timeEnd("drilling down"),this.tiles[ye]?ro(this.tiles[ye],he):null):null}}function Ho(me,V,G){return 32*((1<<me)*G+V)+me}class Ko extends R{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,G){return u._(this,void 0,void 0,function*(){let W=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let ne=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ne)return null;let he=new Le(ne.features,{version:2,extent:u.$}),ge=(function(Te){let ye=new u.cM;return(function(Ae,Oe){for(let De in Ae.layers)Oe.writeMessage(3,Fe,Ae.layers[De])})(Te,ye),ye.finish()})(he);return ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),{vectorTile:he,rawData:ge.buffer}})}loadData(V){return u._(this,void 0,void 0,function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();let W=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.cN(V.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest);let ne=yield this._pendingData;this._geoJSONIndex=V.cluster?new Hn((function({superclusterOptions:ge,clusterProperties:Te}){if(!Te||!ge)return ge;let ye={},Ae={},Oe={accumulated:null,zoom:0},De={properties:null},ct=Object.keys(Te);for(let ve of ct){let[Tt,Ft]=Te[ve],dt=u.cT(Ft),kt=u.cT(typeof Tt=="string"?[Tt,["accumulated"],["get",ve]]:Tt);ye[ve]=dt.value,Ae[ve]=kt.value}return ge.map=ve=>{De.properties=ve;let Tt={};for(let Ft of ct)Tt[Ft]=ye[Ft].evaluate(Oe,De);return Tt},ge.reduce=(ve,Tt)=>{De.properties=Tt;for(let Ft of ct)Oe.accumulated=ve[Ft],ve[Ft]=Ae[Ft].evaluate(Oe,De)},ge})(V)).load(ne.features):(function(ge,Te){return new Zo(ge,Te)})(ne,V.geojsonVtOptions),this.loaded={};let he={data:ne};if(W){let ge=W.finish();ge&&(he.resourceTiming={},he.resourceTiming[V.source]=JSON.parse(JSON.stringify(ge)))}return he}catch(ne){if(delete this._pendingRequest,u.cy(ne))return{abandoned:!0};throw ne}})}getData(){return u._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(V){let G=this.loaded;return G&&G[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,G){return u._(this,void 0,void 0,function*(){let W=yield this.loadGeoJSON(V,G);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(fe(W,!0),V.filter){let ne=u.cT(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));W={type:"FeatureCollection",features:W.features.filter(ge=>ne.value.evaluate({zoom:0},ge))}}return W})}loadGeoJSON(V,G){return u._(this,void 0,void 0,function*(){let{promoteId:W}=V;if(V.request){let ne=yield u.j(V.request,G);return this._dataUpdateable=u.cV(ne.data,W)?u.cU(ne.data,W):void 0,ne.data}if(typeof V.data=="string")try{let ne=JSON.parse(V.data);return this._dataUpdateable=u.cV(ne,W)?u.cU(ne,W):void 0,ne}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return u.cW(this._dataUpdateable,V.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(V){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class os{constructor(V){this.self=V,this.actor=new u.J(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(G,W)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=W},this.self.addProtocol=u.cA,this.self.removeProtocol=u.cB,this.self.registerRTLTextPlugin=G=>{u.cX.setMethods(G)},this.actor.registerMessageHandler("LDT",(G,W)=>this._getDEMWorkerSource(G,W.source).loadTile(W)),this.actor.registerMessageHandler("RDT",(G,W)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(G,W.source).removeTile(W)})),this.actor.registerMessageHandler("GCEZ",(G,W)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(G,W.type,W.source).getClusterExpansionZoom(W)})),this.actor.registerMessageHandler("GCC",(G,W)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(G,W.type,W.source).getClusterChildren(W)})),this.actor.registerMessageHandler("GCL",(G,W)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(G,W.type,W.source).getClusterLeaves(W)})),this.actor.registerMessageHandler("LD",(G,W)=>this._getWorkerSource(G,W.type,W.source).loadData(W)),this.actor.registerMessageHandler("GD",(G,W)=>this._getWorkerSource(G,W.type,W.source).getData()),this.actor.registerMessageHandler("LT",(G,W)=>this._getWorkerSource(G,W.type,W.source).loadTile(W)),this.actor.registerMessageHandler("RT",(G,W)=>this._getWorkerSource(G,W.type,W.source).reloadTile(W)),this.actor.registerMessageHandler("AT",(G,W)=>this._getWorkerSource(G,W.type,W.source).abortTile(W)),this.actor.registerMessageHandler("RMT",(G,W)=>this._getWorkerSource(G,W.type,W.source).removeTile(W)),this.actor.registerMessageHandler("RS",(G,W)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[G]||!this.workerSources[G][W.type]||!this.workerSources[G][W.type][W.source])return;let ne=this.workerSources[G][W.type][W.source];delete this.workerSources[G][W.type][W.source],ne.removeSource!==void 0&&ne.removeSource(W)})),this.actor.registerMessageHandler("RM",G=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G]})),this.actor.registerMessageHandler("SR",(G,W)=>u._(this,void 0,void 0,function*(){this.referrer=W})),this.actor.registerMessageHandler("SRPS",(G,W)=>this._syncRTLPluginState(G,W)),this.actor.registerMessageHandler("IS",(G,W)=>u._(this,void 0,void 0,function*(){this.self.importScripts(W)})),this.actor.registerMessageHandler("SI",(G,W)=>this._setImages(G,W)),this.actor.registerMessageHandler("UL",(G,W)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(G).update(W.layers,W.removedIds)})),this.actor.registerMessageHandler("SL",(G,W)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(G).replace(W)}))}_setImages(V,G){return u._(this,void 0,void 0,function*(){this.availableImages[V]=G;for(let W in this.workerSources[V]){let ne=this.workerSources[V][W];for(let he in ne)ne[he].availableImages=G}})}_syncRTLPluginState(V,G){return u._(this,void 0,void 0,function*(){return yield u.cX.syncState(G,this.self.importScripts)})}_getAvailableImages(V){let G=this.availableImages[V];return G||(G=[]),G}_getLayerIndex(V){let G=this.layerIndexes[V];return G||(G=this.layerIndexes[V]=new r),G}_getWorkerSource(V,G,W){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][G]||(this.workerSources[V][G]={}),!this.workerSources[V][G][W]){let ne={sendAsync:(he,ge)=>(he.targetMapId=V,this.actor.sendAsync(he,ge))};switch(G){case"vector":this.workerSources[V][G][W]=new R(ne,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][G][W]=new Ko(ne,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][G][W]=new this.externalWorkerSourceTypes[G](ne,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][G][W]}_getDEMWorkerSource(V,G){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][G]||(this.demWorkerSources[V][G]=new U),this.demWorkerSources[V][G]}}return u.i(self)&&(self.worker=new os(self)),os}),i("index",["exports","./shared"],function(u,r){"use strict";var x="5.6.2";function C(){var f=new r.A(4);return r.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}let A,R,U={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(f,e,a){let h=requestAnimationFrame(g=>{m(),e(g)}),{unsubscribe:m}=r.s(f.signal,"abort",()=>{m(),cancelAnimationFrame(h),a(r.c())},!1)},frameAsync(f){return new Promise((e,a)=>{this.frame(f,e,a)})},getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){let e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,a.drawImage(f,0,0,f.width,f.height),a},resolveURL:f=>(A||(A=document.createElement("a")),A.href=f,A.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(R==null&&(R=matchMedia("(prefers-reduced-motion: reduce)")),R.matches)}};class F{static testProp(e){if(!F.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in F.docStyle)return e[a];return e[0]}static create(e,a,h){let m=window.document.createElement(e);return a!==void 0&&(m.className=a),h&&h.appendChild(m),m}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){F.docStyle&&F.selectProp&&(F.userSelect=F.docStyle[F.selectProp],F.docStyle[F.selectProp]="none")}static enableDrag(){F.docStyle&&F.selectProp&&(F.docStyle[F.selectProp]=F.userSelect)}static setTransform(e,a){e.style[F.transformProp]=a}static addEventListener(e,a,h,m={}){e.addEventListener(a,h,"passive"in m?m:m.capture)}static removeEventListener(e,a,h,m={}){e.removeEventListener(a,h,"passive"in m?m:m.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",F.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",F.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",F.suppressClickInternal,!0)},0)}static getScale(e){let a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,h){let m=a.boundingClientRect;return new r.P((h.clientX-m.left)/a.x-e.clientLeft,(h.clientY-m.top)/a.y-e.clientTop)}static mousePos(e,a){let h=F.getScale(e);return F.getPoint(e,h,a)}static touchPos(e,a){let h=[],m=F.getScale(e);for(let g=0;g<a.length;g++)h.push(F.getPoint(e,m,a[g]));return h}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let a=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),h=a.querySelectorAll("script");for(let m of h)m.remove();return F.clean(a),a.innerHTML}static isPossiblyDangerous(e,a){let h=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!h.includes("javascript:")&&!h.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let a=e.children;for(let h of a)F.removeAttributes(h),F.clean(h)}static removeAttributes(e){for(let{name:a,value:h}of e.attributes)F.isPossiblyDangerous(a,h)&&e.removeAttribute(a)}}F.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,F.selectProp=F.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),F.transformProp=F.testProp(["transform","WebkitTransform"]);let le={supported:!1,testSupport:function(f){!xe&&fe&&(Le?Fe(f):se=f)}},se,fe,xe=!1,Le=!1;function Fe(f){let e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,fe),f.isContextLost())return;le.supported=!0}catch{}f.deleteTexture(e),xe=!0}var $e;typeof document<"u"&&(fe=document.createElement("img"),fe.onload=()=>{se&&Fe(se),se=null,Le=!0},fe.onerror=()=>{xe=!0,se=null},fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(f){let e,a,h,m;f.resetRequestQueue=()=>{e=[],a=0,h=0,m={}},f.addThrottleControl=I=>{let P=h++;return m[P]=I,P},f.removeThrottleControl=I=>{delete m[I],v()},f.getImage=(I,P,E=!0)=>new Promise((D,L)=>{le.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),r.e(I,{type:"image"}),e.push({abortController:P,requestParameters:I,supportImageRefresh:E,state:"queued",onError:O=>{L(O)},onSuccess:O=>{D(O)}}),v()});let g=I=>r._(this,void 0,void 0,function*(){I.state="running";let{requestParameters:P,supportImageRefresh:E,onError:D,onSuccess:L,abortController:O}=I,N=E===!1&&!r.i(self)&&!r.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((J,ee)=>J&&ee==="accept",!0));a++;let X=N?S(P,O):r.m(P,O);try{let J=yield X;delete I.abortController,I.state="completed",J.data instanceof HTMLImageElement||r.b(J.data)?L(J):J.data&&L({data:yield(H=J.data,typeof createImageBitmap=="function"?r.f(H):r.h(H)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete I.abortController,D(J)}finally{a--,v()}var H}),v=()=>{let I=(()=>{for(let P of Object.keys(m))if(m[P]())return!0;return!1})()?r.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:r.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=a;P<I&&e.length>0;P++){let E=e.shift();E.abortController.signal.aborted?P--:g(E)}},S=(I,P)=>new Promise((E,D)=>{let L=new Image,O=I.url,N=I.credentials;N&&N==="include"?L.crossOrigin="use-credentials":(N&&N==="same-origin"||!r.d(O))&&(L.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{L.src="",D(r.c())}),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,E({data:L})},L.onerror=()=>{L.onerror=L.onload=null,P.signal.aborted||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=O})})($e||($e={})),$e.resetRequestQueue();class nt{constructor(e){this._transformRequestFn=e??null}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function je(f){let e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){let a=[];for(let{id:h,url:m}of f){let g=`${h}${m}`;a.indexOf(g)===-1&&(a.push(g),e.push({id:h,url:m}))}}return e}function ht(f,e,a){try{let h=new URL(f);return h.pathname+=`${e}${a}`,h.toString()}catch{throw new Error(`Invalid sprite URL "${f}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Et(f){let{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Ui extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new r.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:a,promiseResolve:h}of this.requestors)h(this._getImagesForIds(a));this.requestors=[]}}getImage(e){let a=this.images[e];if(a&&!a.data&&a.spriteData){let h=a.spriteData;a.data=new r.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let h=!0,m=a.data||a.spriteData;return this._validateStretch(a.stretchX,m&&m.width)||(this.fire(new r.k(new Error(`Image "${e}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,m&&m.height)||(this.fire(new r.k(new Error(`Image "${e}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new r.k(new Error(`Image "${e}" has invalid "content" value`))),h=!1),h}_validateStretch(e,a){if(!e)return!0;let h=0;for(let m of e){if(m[0]<h||m[1]<m[0]||a<m[1])return!1;h=m[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;let h=a.spriteData,m=h&&h.width||a.data.width,g=h&&h.height||a.data.height;return!(e[0]<0||m<e[0]||e[1]<0||g<e[1]||e[2]<0||m<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,h=!0){let m=this.getImage(e);if(h&&(m.data.width!==a.data.width||m.data.height!==a.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=m.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){let a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((a,h)=>{let m=!0;if(!this.isLoaded())for(let g of e)this.images[g]||(m=!1);this.isLoaded()||m?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})})}_getImagesForIds(e){let a={};for(let h of e){let m=this.getImage(h);m||(this.fire(new r.l("styleimagemissing",{id:h})),m=this.getImage(h)),m?a[h]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:r.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){let{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){let a=this.patterns[e],h=this.getImage(e);if(!h)return null;if(a&&a.position.version===h.version)return a.position;if(a)a.position.version=h.version;else{let m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},g=new r.I(m,h);this.patterns[e]={bin:m,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new r.T(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let g in this.patterns)e.push(this.patterns[g].bin);let{w:a,h}=r.p(e),m=this.atlasImage;m.resize({width:a||1,height:h||1});for(let g in this.patterns){let{bin:v}=this.patterns[g],S=v.x+1,I=v.y+1,P=this.getImage(g).data,E=P.width,D=P.height;r.R.copy(P,m,{x:0,y:0},{x:S,y:I},{width:E,height:D}),r.R.copy(P,m,{x:0,y:D-1},{x:S,y:I-1},{width:E,height:1}),r.R.copy(P,m,{x:0,y:0},{x:S,y:I+D},{width:E,height:1}),r.R.copy(P,m,{x:E-1,y:0},{x:S-1,y:I},{width:1,height:D}),r.R.copy(P,m,{x:0,y:0},{x:S+E,y:I},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;let h=this.getImage(a);h||r.w(`Image with ID: "${a}" was not found`),Et(h)&&this.updateImage(a,h)}}}let mi=1e20;function On(f,e,a,h,m,g,v,S,I){for(let P=e;P<e+h;P++)In(f,a*g+P,g,m,v,S,I);for(let P=a;P<a+m;P++)In(f,P*g+e,1,h,v,S,I)}function In(f,e,a,h,m,g,v){g[0]=0,v[0]=-mi,v[1]=mi,m[0]=f[e];for(let S=1,I=0,P=0;S<h;S++){m[S]=f[e+S*a];let E=S*S;do{let D=g[I];P=(m[S]-m[D]+E-D*D)/(S-D)/2}while(P<=v[I]&&--I>-1);I++,g[I]=S,v[I]=P,v[I+1]=mi}for(let S=0,I=0;S<h;S++){for(;v[I+1]<S;)I++;let P=g[I],E=S-P;f[e+S*a]=m[P]+E*E}}class Hn{constructor(e,a){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return r._(this,void 0,void 0,function*(){let a=[];for(let g in e)for(let v of e[g])a.push(this._getAndCacheGlyphsPromise(g,v));let h=yield Promise.all(a),m={};for(let{stack:g,id:v,glyph:S}of h)m[g]||(m[g]={}),m[g][v]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return m})}_getAndCacheGlyphsPromise(e,a){return r._(this,void 0,void 0,function*(){let h=this.entries[e];h||(h=this.entries[e]={glyphs:{},requests:{},ranges:{}});let m=h.glyphs[a];if(m!==void 0)return{stack:e,id:a,glyph:m};if(m=this._tinySDF(h,e,a),m)return h.glyphs[a]=m,{stack:e,id:a,glyph:m};let g=Math.floor(a/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[g])return{stack:e,id:a,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[g]){let S=Hn.loadGlyphRange(e,g,this.url,this.requestManager);h.requests[g]=S}let v=yield h.requests[g];for(let S in v)this._doesCharSupportLocalGlyph(+S)||(h.glyphs[+S]=v[+S]);return h.ranges[g]=!0,{stack:e,id:a,glyph:v[a]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||r.u["CJK Unified Ideographs"](e)||r.u["Hangul Syllables"](e)||r.u.Hiragana(e)||r.u.Katakana(e)||r.u["CJK Symbols and Punctuation"](e)||r.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,a,h){let m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(h))return;let g=e.tinySDF;if(!g){let S="400";/bold/i.test(a)?S="900":/medium/i.test(a)?S="500":/light/i.test(a)&&(S="200"),g=e.tinySDF=new Hn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:S})}let v=g.draw(String.fromCharCode(h));return{id:h,bitmap:new r.q({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}Hn.loadGlyphRange=function(f,e,a,h){return r._(this,void 0,void 0,function*(){let m=256*e,g=m+255,v=h.transformRequest(a.replace("{fontstack}",f).replace("{range}",`${m}-${g}`),"Glyphs"),S=yield r.n(v,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${m}-${g}`);let I={};for(let P of r.o(S.data))I[P.id]=P;return I})},Hn.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:a=8,cutoff:h=.25,fontFamily:m="sans-serif",fontWeight:g="normal",fontStyle:v="normal",lang:S=null}={}){this.buffer=e,this.cutoff=h,this.radius=a,this.lang=S;let I=this.size=f+4*e,P=this._createCanvas(I),E=this.ctx=P.getContext("2d",{willReadFrequently:!0});E.font=`${v} ${g} ${f}px ${m}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(f){let e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){let{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:m,actualBoundingBoxRight:g}=this.ctx.measureText(f),v=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-m))),I=Math.min(this.size-this.buffer,v+Math.ceil(h)),P=S+2*this.buffer,E=I+2*this.buffer,D=Math.max(P*E,0),L=new Uint8ClampedArray(D),O={data:L,width:P,height:E,glyphWidth:S,glyphHeight:I,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(S===0||I===0)return O;let{ctx:N,buffer:X,gridInner:H,gridOuter:J}=this;this.lang&&(N.lang=this.lang),N.clearRect(X,X,S,I),N.fillText(f,X,X+v);let ee=N.getImageData(X,X,S,I);J.fill(mi,0,D),H.fill(0,0,D);for(let re=0;re<I;re++)for(let te=0;te<S;te++){let ae=ee.data[4*(re*S+te)+3]/255;if(ae===0)continue;let ue=(re+X)*P+te+X;if(ae===1)J[ue]=0,H[ue]=mi;else{let ie=.5-ae;J[ue]=ie>0?ie*ie:0,H[ue]=ie<0?ie*ie:0}}On(J,0,0,P,E,P,this.f,this.v,this.z),On(H,X,X,S,I,P,this.f,this.v,this.z);for(let re=0;re<D;re++){let te=Math.sqrt(J[re])-Math.sqrt(H[re]);L[re]=Math.round(255-255*(te/this.radius+this.cutoff))}return O}};class To{constructor(){this.specification=r.v.light.position}possiblyEvaluate(e,a){return r.B(e.expression.evaluate(a))}interpolate(e,a,h){return{x:r.C.number(e.x,a.x,h),y:r.C.number(e.y,a.y,h),z:r.C.number(e.z,a.z,h)}}}let Ar;class kr extends r.E{constructor(e){super(),Ar=Ar||new r.r({anchor:new r.D(r.v.light.anchor),position:new To,color:new r.D(r.v.light.color),intensity:new r.D(r.v.light.intensity)}),this._transitionable=new r.t(Ar),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(r.x,e,a))for(let h in e){let m=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),m):this._transitionable.setValue(h,m)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,h){return(!h||h.validate!==!1)&&r.y(this,e.call(r.z,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.v}))}}let Lr=new r.r({"sky-color":new r.D(r.v.sky["sky-color"]),"horizon-color":new r.D(r.v.sky["horizon-color"]),"fog-color":new r.D(r.v.sky["fog-color"]),"fog-ground-blend":new r.D(r.v.sky["fog-ground-blend"]),"horizon-fog-blend":new r.D(r.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new r.D(r.v.sky["sky-horizon-blend"]),"atmosphere-blend":new r.D(r.v.sky["atmosphere-blend"])});class es extends r.E{constructor(e){super(),this._transitionable=new r.t(Lr),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new r.F(0))}setSky(e,a={}){if(!this._validate(r.G,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let h in e){let m=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),m):this._transitionable.setValue(h,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,h={}){return h?.validate!==!1&&r.y(this,e.call(r.z,r.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ri{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){let h=e.join(",")+String(a);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(e,a)),this.dashEntry[h]}getDashRanges(e,a,h){let m=[],g=e.length%2==1?-e[e.length-1]*h:0,v=e[0]*h,S=!0;m.push({left:g,right:v,isDash:S,zeroLength:e[0]===0});let I=e[0];for(let P=1;P<e.length;P++){S=!S;let E=e[P];g=I*h,I+=E,v=I*h,m.push({left:g,right:v,isDash:S,zeroLength:E===0})}return m}addRoundDash(e,a,h){let m=a/2;for(let g=-h;g<=h;g++){let v=this.width*(this.nextRow+h+g),S=0,I=e[S];for(let P=0;P<this.width;P++){P/I.right>1&&(I=e[++S]);let E=Math.abs(P-I.left),D=Math.abs(P-I.right),L=Math.min(E,D),O,N=g/h*(m+1);if(I.isDash){let X=m-Math.abs(N);O=Math.sqrt(L*L+X*X)}else O=m-Math.sqrt(L*L+N*N);this.data[v+P]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){let I=e[S],P=e[S+1];I.zeroLength?e.splice(S,1):P&&P.isDash===I.isDash&&(P.left=I.left,e.splice(S,1))}let a=e[0],h=e[e.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);let m=this.width*this.nextRow,g=0,v=e[g];for(let S=0;S<this.width;S++){S/v.right>1&&(v=e[++g]);let I=Math.abs(S-v.left),P=Math.abs(S-v.right),E=Math.min(I,P);this.data[m+S]=Math.max(0,Math.min(255,(v.isDash?E:-E)+128))}}addDash(e,a){let h=a?7:0,m=2*h+1;if(this.nextRow+m>this.height)return r.w("LineAtlas out of space"),null;let g=0;for(let S=0;S<e.length;S++)g+=e[S];if(g!==0){let S=this.width/g,I=this.getDashRanges(e,this.width,S);a?this.addRoundDash(I,S,h):this.addRegularDash(I)}let v={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:g};return this.nextRow+=m,this.dirty=!0,v}bind(e){let a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}let Co="maplibre_preloaded_worker_pool";class Tn{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Tn.workerCount;)this.workers.push(new Worker(r.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Co]}numActive(){return Object.keys(this.active).length}}let va=Math.floor(U.hardwareConcurrency/2),to,$o;function xa(){return to||(to=new Tn),to}Tn.workerCount=r.H(globalThis)?Math.max(Math.min(va,3),1):1;class Kn{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;let h=this.workerPool.acquire(a);for(let m=0;m<h.length;m++){let g=new r.J(h[m],a);g.name=`Worker ${m}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){let h=[];for(let m of this.actors)h.push(m.sendAsync({type:e,data:a}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(let h of this.actors)h.registerMessageHandler(e,a)}}function ts(){return $o||($o=new Kn(xa(),r.K),$o.registerMessageHandler("GR",(f,e,a)=>r.m(e,a))),$o}function _r(f,e){let a=r.L();return r.M(a,a,[1,1,0]),r.N(a,a,[.5*f.width,.5*f.height,1]),f.calculatePosMatrix?r.O(a,a,f.calculatePosMatrix(e.toUnwrapped())):a}function Dr(f,e,a,h,m,g,v){var S;let I=(function(L,O,N){if(L)for(let X of L){let H=O[X];if(H&&H.source===N&&H.type==="fill-extrusion")return!0}else for(let X in O){let H=O[X];if(H.source===N&&H.type==="fill-extrusion")return!0}return!1})((S=m?.layers)!==null&&S!==void 0?S:null,e,f.id),P=g.maxPitchScaleFactor(),E=f.tilesIn(h,P,I);E.sort(is);let D=[];for(let L of E)D.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(e,a,f._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,m,g,P,_r(f.transform,L.tileID),v?(O,N)=>v(L.tileID,O,N):void 0)});return(function(L,O){for(let N in L)for(let X of L[N])ns(X,O);return L})((function(L){let O={},N={};for(let X of L){let H=X.queryResults,J=X.wrappedTileID,ee=N[J]=N[J]||{};for(let re in H){let te=H[re],ae=ee[re]=ee[re]||{},ue=O[re]=O[re]||[];for(let ie of te)ae[ie.featureIndex]||(ae[ie.featureIndex]=!0,ue.push(ie))}}return O})(D),f)}function is(f,e){let a=f.tileID,h=e.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}function ns(f,e){let a=f.feature,h=e.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=h}function ar(f,e,a){return r._(this,void 0,void 0,function*(){let h=f;if(f.url?h=(yield r.j(e.transformRequest(f.url,"Source"),a)).data:yield U.frameAsync(a),!h)return null;let m=r.Q(r.e(h,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(m.vectorLayerIds=h.vector_layers.map(g=>g.id)),m})}class Di{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof r.S?new r.S(e.lng,e.lat):r.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof r.S?new r.S(e.lng,e.lat):r.S.convert(e),this}extend(e){let a=this._sw,h=this._ne,m,g;if(e instanceof r.S)m=e,g=e;else{if(!(e instanceof Di))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Di.convert(e)):this.extend(r.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(r.S.convert(e)):this;if(m=e._sw,g=e._ne,!m||!g)return this}return a||h?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),h.lng=Math.max(g.lng,h.lng),h.lat=Math.max(g.lat,h.lat)):(this._sw=new r.S(m.lng,m.lat),this._ne=new r.S(g.lng,g.lat)),this}getCenter(){return new r.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new r.S(this.getWest(),this.getNorth())}getSouthEast(){return new r.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:a,lat:h}=r.S.convert(e),m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m}static convert(e){return e instanceof Di?e:e&&new Di(e)}static fromLngLat(e,a=0){let h=360*a/40075017,m=h/Math.cos(Math.PI/180*e.lat);return new Di(new r.S(e.lng-m,e.lat-h),new r.S(e.lng+m,e.lat+h))}adjustAntiMeridian(){let e=new r.S(this._sw.lng,this._sw.lat),a=new r.S(this._ne.lng,this._ne.lat);return new Di(e,e.lng>a.lng?new r.S(a.lng+360,a.lat):a)}}class Ni{constructor(e,a,h){this.bounds=Di.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=h||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let a=Math.pow(2,e.z),h=Math.floor(r.V(this.bounds.getWest())*a),m=Math.floor(r.U(this.bounds.getNorth())*a),g=Math.ceil(r.V(this.bounds.getEast())*a),v=Math.ceil(r.U(this.bounds.getSouth())*a);return e.x>=h&&e.x<g&&e.y>=m&&e.y<v}}class Rr extends r.E{constructor(e,a,h,m){if(super(),this.id=e,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.e(this,r.Q(a,["url","scheme","tileSize","promoteId"])),this._options=r.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return r._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new r.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield ar(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(r.e(this,e),e.bounds&&(this.tileBounds=new Ni(e.bounds,this.minzoom,this.maxzoom)),this.fire(new r.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new r.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return r.e({},this._options)}loadTile(e){return r._(this,void 0,void 0,function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};h.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((g,v)=>{e.reloadPromise={resolve:g,reject:v}})}else e.actor=this.dispatcher.getActor(),m="LT";e.abortController=new AbortController;try{let g=yield e.actor.sendAsync({type:m,data:h},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){let h=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(h.resolve).catch(h.reject)}}abortTile(e){return r._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return r._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class io extends r.E{constructor(e,a,h,m){super(),this.id=e,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.e({type:"raster"},a),r.e(this,r.Q(a,["url","scheme","tileSize"]))}load(){return r._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new r.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let a=yield ar(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(r.e(this,a),a.bounds&&(this.tileBounds=new Ni(a.bounds,this.minzoom,this.maxzoom)),this.fire(new r.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(a){this._tileJSONRequest=null,this.fire(new r.k(a))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return r.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return r._(this,void 0,void 0,function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let h=yield $e.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});let m=this.map.painter.context,g=m.gl,v=h.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new r.T(m,v,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}abortTile(e){return r._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return r._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class ba extends io{constructor(e,a,h,m){super(e,a,h,m),this.type="raster-dem",this.maxzoom=22,this._options=r.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return r._(this,void 0,void 0,function*(){let a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let m=yield $e.getImage(h,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(m&&m.data){let g=m.data;this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&e.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});let v=r.b(g)&&r.W()?g:yield this.readImageNow(g),S={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let I=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=I,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(m){if(delete e.abortController,e.aborted)e.state="unloaded";else if(m)throw e.state="errored",m}})}readImageNow(e){return r._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&r.X()){let a=e.width+2,h=e.height+2;try{return new r.R({width:a,height:h},yield r.Y(e,-1,-1,a,h))}catch{}}return U.getImageData(e,1)})}_getNeighboringTiles(e){let a=e.canonical,h=Math.pow(2,a.z),m=(a.x-1+h)%h,g=a.x===0?e.wrap-1:e.wrap,v=(a.x+1+h)%h,S=a.x+1===h?e.wrap+1:e.wrap,I={};return I[new r.Z(e.overscaledZ,g,a.z,m,a.y).key]={backfilled:!1},I[new r.Z(e.overscaledZ,S,a.z,v,a.y).key]={backfilled:!1},a.y>0&&(I[new r.Z(e.overscaledZ,g,a.z,m,a.y-1).key]={backfilled:!1},I[new r.Z(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},I[new r.Z(e.overscaledZ,S,a.z,v,a.y-1).key]={backfilled:!1}),a.y+1<h&&(I[new r.Z(e.overscaledZ,g,a.z,m,a.y+1).key]={backfilled:!1},I[new r.Z(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},I[new r.Z(e.overscaledZ,S,a.z,v,a.y+1).key]={backfilled:!1}),I}unloadTile(e){return r._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class no extends r.E{constructor(e,a,h,m){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=h.getActor(),this.setEventedParent(m),this._data=a.data,this._options=r.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&r.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=r.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:r.$,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:r.$,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(r.$/this.tileSize)}_getClusterMaxZoom(e){let a=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||r.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${a}"`),a}load(){return r._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=r.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return r._(this,void 0,void 0,function*(){let e=r.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(a=>a.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return r._(this,void 0,void 0,function*(){let e=new Di,a=yield this.getData(),h;switch(a.type){case"FeatureCollection":h=a.features.map(m=>this.getCoordinatesFromGeometry(m.geometry)).flat(1/0);break;case"Feature":h=this.getCoordinatesFromGeometry(a.geometry);break;default:h=this.getCoordinatesFromGeometry(a)}if(h.length==0)return e;for(let m=0;m<h.length-1;m+=2)e.extend([h[m],h[m+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:h}})}_updateWorkerData(){return r._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;let{data:e,diff:a}=this._pendingWorkerUpdate;if(!e&&!a)return void r.w(`No data or diff provided to GeoJSONSource ${this.id}.`);let h=r.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(h.request=this.map._requestManager.transformRequest(U.resolveURL(e),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):a&&(h.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new r.l("dataloading",{dataType:"source"}));try{let m=yield this.actor.sendAsync({type:"LD",data:h});if(this._isUpdatingWorker=!1,this._removed||m.abandoned)return void this.fire(new r.l("dataabort",{dataType:"source"}));this._data=m.data;let g=null;m.resourceTiming&&m.resourceTiming[this.id]&&(g=m.resourceTiming[this.id].slice(0));let v={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&r.e(v,{resourceTiming:g}),this.fire(new r.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new r.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(m){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new r.l("dataabort",{dataType:"source"}));this.fire(new r.k(m))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return r._(this,void 0,void 0,function*(){let a=e.actor?"RT":"LT";e.actor=this.actor;let h={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;let m=yield this.actor.sendAsync({type:a,data:h},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(m,this.map.painter,a==="RT")})}abortTile(e){return r._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return r._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return r.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ro extends r.E{constructor(e,a,h,m){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=a}load(e){return r._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new r.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let a=yield $e.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new r.k(a))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new r.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let a=e.map(r.a1.fromLngLat);var h;return this.tileID=(function(m){let g=r.a2.fromPoints(m),v=g.width(),S=g.height(),I=Math.max(v,S),P=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),E=Math.pow(2,P);return new r.a4(P,Math.floor((g.minX+g.maxX)/2*E),Math.floor((g.minY+g.maxY)/2*E))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map(m=>this.tileID.getTilePoint(m)._round()),this.flippedWindingOrder=((h=this.tileCoords)[1].x-h[0].x)*(h[2].y-h[0].y)-(h[1].y-h[0].y)*(h[2].x-h[0].x)<0,this.fire(new r.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,a=e.gl;this.texture||(this.texture=new r.T(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let h=!1;for(let m in this.tiles){let g=this.tiles[m];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,h=!0)}h&&this.fire(new r.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return r._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let{minX:a,minY:h,maxX:m,maxY:g}=r.a2.fromPoints(e),v={};for(let S=0;S<=r.a3;S++){let I=Math.pow(2,S),P=Math.floor(a*I),E=Math.floor(h*I),D=Math.floor(m*I),L=Math.floor(g*I);v[S]={minTileX:P,minTileY:E,maxTileX:D,maxTileY:L}}return v}}class rs extends ro{constructor(e,a,h,m){super(e,a,h,m),this.roundZoom=!0,this.type="video",this.options=a}load(){return r._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{let a=yield r.a5(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new r.k(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new r.k(new r.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,a=e.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let h=!1;for(let m in this.tiles){let g=this.tiles[m];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,h=!0)}h&&this.fire(new r.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Go extends ro{constructor(e,a,h,m){super(e,a,h,m),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new r.k(new r.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.k(new r.a6(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new r.k(new r.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new r.k(new r.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.k(new r.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return r._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let a=this.map.painter.context,h=a.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(a,this.canvas,h.RGBA,{premultiply:!0});let m=!1;for(let g in this.tiles){let v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,m=!0)}m&&this.fire(new r.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let qo={},Wo=f=>{switch(f){case"geojson":return no;case"image":return ro;case"raster":return io;case"raster-dem":return ba;case"vector":return Rr;case"video":return rs;case"canvas":return Go}return qo[f]},wa="RTLPluginLoaded";class Zo extends r.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ts()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return r._(this,arguments,void 0,function*(a,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=U.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return r._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new r.l(wa))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ho=null;function Ko(){return Ho||(Ho=new Zo),Ho}class os{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=r.a7(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let a=e+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(m,g){let v={};if(!g)return v;for(let S of m){let I=S.layerIds.map(P=>g.getLayer(P)).filter(Boolean);if(I.length!==0){S.layers=I,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(P=>I.filter(E=>E.id===P)[0]));for(let P of I)v[P.id]=S}}return v})(e.buckets,a?.style),this.hasSymbolBuckets=!1;for(let m in this.buckets){let g=this.buckets[m];if(g instanceof r.a9){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let m in this.buckets){let g=this.buckets[m];if(g instanceof r.a9&&g.hasRTLText){this.hasRTLText=!0,Ko().lazyLoad();break}}this.queryPadding=0;for(let m in this.buckets){let g=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(m).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new r.a8}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let h in this.buckets){let m=this.buckets[h];m.uploadPending()&&m.upload(e)}let a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new r.T(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,h,m,g,v,S,I,P,E,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:g,scale:v,tileSize:this.tileSize,pixelPosMatrix:E,transform:I,params:S,queryPadding:this.queryPadding*P,getElevation:D},e,a,h):{}}querySourceFeatures(e,a){let h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;let m=h.loadVTLayers(),g=a&&a.sourceLayer?a.sourceLayer:"",v=m._geojsonTileLayer||m[g];if(!v)return;let S=r.aa(a&&a.filter),{z:I,x:P,y:E}=this.tileID.canonical,D={z:I,x:P,y:E};for(let L=0;L<v.length;L++){let O=v.feature(L);if(S.needGeometry){let H=r.ab(O,!0);if(!S.filter(new r.F(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!S.filter(new r.F(this.tileID.overscaledZ),O))continue;let N=h.getId(O,g),X=new r.ac(O,I,P,E,N);X.tile=D,e.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let a=this.expirationTime;if(e.cacheControl){let h=r.ad(e.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let h=Date.now(),m=!1;if(this.expirationTime>h)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{let g=this.expirationTime-a;g?this.expirationTime=h+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let h=this.latestFeatureIndex.loadVTLayers();for(let m in this.buckets){if(!a.style.hasLayer(m))continue;let g=this.buckets[m],v=g.layers[0].sourceLayer||"_geojsonTileLayer",S=h[v],I=e[v];if(!S||!I||Object.keys(I).length===0)continue;g.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});let P=a&&a.style&&a.style.getLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<U.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=U.now()+e}setDependencies(e,a){let h={};for(let m of a)h[m]=!0;this.dependencies[e]=h}hasDependency(e,a){for(let h of e){let m=this.dependencies[h];if(m){for(let g of a)if(m[g])return!0}}return!1}}class me{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(let e in this.data)for(let a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,h){let m=e.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);let g={value:a,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},h)),this.data[m].push(g),this.order.push(m),this.order.length>this.max){let v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){let a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;let h=e.wrapped().key,m=a===void 0?0:this.data[h].indexOf(a),g=this.data[h][m];return this.data[h].splice(m,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){let a=[];for(let h in this.data)for(let m of this.data[h])e(m.value)||a.push(m);for(let h of a)this.remove(h.value.tileID,h)}}class V{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,h){let m=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][m]=this.stateChanges[e][m]||{},r.e(this.stateChanges[e][m],h),this.deletedStates[e]===null){this.deletedStates[e]={};for(let g in this.state[e])g!==m&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][m]===null){this.deletedStates[e][m]={};for(let g in this.state[e][m])h[g]||(this.deletedStates[e][m][g]=null)}else for(let g in h)this.deletedStates[e]&&this.deletedStates[e][m]&&this.deletedStates[e][m][g]===null&&delete this.deletedStates[e][m][g]}removeFeatureState(e,a,h){if(this.deletedStates[e]===null)return;let m=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},h&&a!==void 0)this.deletedStates[e][m]!==null&&(this.deletedStates[e][m]=this.deletedStates[e][m]||{},this.deletedStates[e][m][h]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][m])for(h in this.deletedStates[e][m]={},this.stateChanges[e][m])this.deletedStates[e][m][h]=null;else this.deletedStates[e][m]=null;else this.deletedStates[e]=null}getState(e,a){let h=String(a),m=r.e({},(this.state[e]||{})[h],(this.stateChanges[e]||{})[h]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let g=this.deletedStates[e][a];if(g===null)return{};for(let v in g)delete m[v]}return m}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){let h={};for(let m in this.stateChanges){this.state[m]=this.state[m]||{};let g={};for(let v in this.stateChanges[m])this.state[m][v]||(this.state[m][v]={}),r.e(this.state[m][v],this.stateChanges[m][v]),g[v]=this.state[m][v];h[m]=g}for(let m in this.deletedStates){this.state[m]=this.state[m]||{};let g={};if(this.deletedStates[m]===null)for(let v in this.state[m])g[v]={},this.state[m][v]={};else for(let v in this.deletedStates[m]){if(this.deletedStates[m][v]===null)this.state[m][v]={};else for(let S of Object.keys(this.deletedStates[m][v]))delete this.state[m][v][S];g[v]=this.state[m][v]}h[m]=h[m]||{},r.e(h[m],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(let m in e)e[m].setFeatureState(h,a)}}let G=89.25;function W(f,e){let a=r.ah(e.lat,-r.ai,r.ai);return new r.P(r.V(e.lng)*f,r.U(a)*f)}function ne(f,e){return new r.a1(e.x/f,e.y/f).toLngLat()}function he(f){return f.cameraToCenterDistance*Math.min(.85*Math.tan(r.ae(90-f.pitch)),Math.tan(r.ae(G-f.pitch)))}function ge(f,e){let a=f.canonical,h=e/r.af(a.z),m=a.x+Math.pow(2,a.z)*f.wrap,g=r.ag(new Float64Array(16));return r.M(g,g,[m*h,a.y*h,0]),r.N(g,g,[h/r.$,h/r.$,1]),g}function Te(f,e,a,h,m){let g=r.a1.fromLngLat(f,e),v=m*r.aj(1,f.lat),S=v*Math.cos(r.ae(a)),I=Math.sqrt(v*v-S*S),P=I*Math.sin(r.ae(-h)),E=I*Math.cos(r.ae(-h));return new r.a1(g.x+P,g.y+E,g.z+S)}function ye(f,e,a){let h=e.intersectsFrustum(f);if(!a||h===0)return h;let m=e.intersectsPlane(a);return m===0?0:h===2&&m===2?2:1}function Ae(f,e,a){let h=0,m=(a-e)/10;for(let g=0;g<10;g++)h+=m*Math.pow(Math.cos(e+(g+.5)/10*(a-e)),f);return h}function Oe(f,e){return function(a,h,m,g,v){let S=2*((f-1)/r.ak(Math.cos(r.ae(G-v))/Math.cos(r.ae(G)))-1),I=Math.acos(m/g),P=2*Ae(S-1,0,r.ae(v/2)),E=Math.min(r.ae(G),I+r.ae(v/2)),D=Ae(S-1,Math.min(E,I-r.ae(v/2)),E),L=Math.atan(h/m),O=Math.hypot(h,m),N=a;return N+=r.ak(g/O/Math.max(.5,Math.cos(r.ae(v/2)))),N+=S*r.ak(Math.cos(L))/2,N-=r.ak(Math.max(1,D/P/e))/2,N}}let De=Oe(9.314,3);function ct(f,e){let a=(e.roundZoom?Math.round:Math.floor)(f.zoom+r.ak(f.tileSize/e.tileSize));return Math.max(0,a)}function ve(f,e){let a=f.getCameraFrustum(),h=f.getClippingPlane(),m=f.screenPointToMercatorCoordinate(f.getCameraPoint()),g=r.a1.fromLngLat(f.center,f.elevation);m.z=g.z+Math.cos(f.pitchInRadians)*f.cameraToCenterDistance/f.worldSize;let v=f.getCoveringTilesDetailsProvider(),S=v.allowVariableZoom(f,e),I=ct(f,e),P=e.minzoom||0,E=e.maxzoom!==void 0?e.maxzoom:f.maxZoom,D=Math.min(Math.max(0,I),E),L=Math.pow(2,D),O=[L*m.x,L*m.y,0],N=[L*g.x,L*g.y,0],X=Math.hypot(g.x-m.x,g.y-m.y),H=Math.abs(g.z-m.z),J=Math.hypot(X,H),ee=ae=>({zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),re=[],te=[];if(f.renderWorldCopies&&v.allowWorldCopies())for(let ae=1;ae<=3;ae++)re.push(ee(-ae)),re.push(ee(ae));for(re.push(ee(0));re.length>0;){let ae=re.pop(),ue=ae.x,ie=ae.y,_e=ae.fullyVisible,Me={x:ue,y:ie,z:ae.zoom},we=v.getTileBoundingVolume(Me,ae.wrap,f.elevation,e);if(!_e){let We=ye(a,we,h);if(We===0)continue;_e=We===2}let Se=v.distanceToTile2d(m.x,m.y,Me,we),Pe=I;S&&(Pe=(e.calculateTileZoom||De)(f.zoom+r.ak(f.tileSize/e.tileSize),Se,H,J,f.fov)),Pe=(e.roundZoom?Math.round:Math.floor)(Pe),Pe=Math.max(0,Pe);let Ve=Math.min(Pe,E);if(ae.wrap=v.getWrap(g,Me,ae.wrap),ae.zoom>=Ve){if(ae.zoom<P)continue;let We=D-ae.zoom,Re=O[0]-.5-(ue<<We),st=O[1]-.5-(ie<<We),Rt=e.reparseOverscaled?Math.max(ae.zoom,Pe):ae.zoom;te.push({tileID:new r.Z(ae.zoom===E?Rt:ae.zoom,ae.wrap,ae.zoom,ue,ie),distanceSq:r.al([N[0]-.5-ue,N[1]-.5-ie]),tileDistanceToCamera:Math.sqrt(Re*Re+st*st)})}else for(let We=0;We<4;We++)re.push({zoom:ae.zoom+1,x:(ue<<1)+We%2,y:(ie<<1)+(We>>1),wrap:ae.wrap,fullyVisible:_e})}return te.sort((ae,ue)=>ae.distanceSq-ue.distanceSq).map(ae=>ae.tileID)}let Tt=r.a2.fromPoints([new r.P(0,0),new r.P(r.$,r.$)]);class Ft extends r.E{constructor(e,a,h){super(),this.id=e,this.dispatcher=h,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,g,v,S)=>{let I=new(Wo(g.type))(m,g,v,S);if(I.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${I.id}`);return I})(e,a,h,this),this._tiles={},this._cache=new me(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new V,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,h){return r._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,h)}catch(m){e.state="errored",m.status!==404?this._source.fire(new r.k(m,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new r.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let h=this._tiles[a];h.upload(e),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(dt).map(e=>e.key)}getRenderableIds(e){let a=[];for(let h in this._tiles)this._isIdRenderable(h,e)&&a.push(this._tiles[h]);return e?a.sort((h,m)=>{let g=h.tileID,v=m.tileID,S=new r.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),I=new r.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-v.overscaledZ||I.y-S.y||I.x-S.x}).map(h=>h.tileID.key):a.map(h=>h.tileID).sort(dt).map(h=>h.key)}hasRenderableParent(e){let a=this.findLoadedParent(e,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(e,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(a||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let a in this._tiles)e?this._reloadTile(a,"expired"):this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(e,a){return r._(this,void 0,void 0,function*(){let h=this._tiles[e];h&&(h.state!=="loading"&&(h.state=a),yield this._loadTile(h,e,a))})}_tileLoaded(e,a,h){e.timeAdded=U.now(),h==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new r.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let a=this.getRenderableIds();for(let m=0;m<a.length;m++){let g=a[m];if(e.neighboringTiles&&e.neighboringTiles[g]){let v=this.getTileByID(g);h(e,v),h(v,e)}}function h(m,g){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let v=g.tileID.canonical.x-m.tileID.canonical.x,S=g.tileID.canonical.y-m.tileID.canonical.y,I=Math.pow(2,m.tileID.canonical.z),P=g.tileID.key;v===0&&S===0||Math.abs(S)>1||(Math.abs(v)>1&&(Math.abs(v+I)===1?v+=I:Math.abs(v-I)===1&&(v-=I)),g.dem&&m.dem&&(m.dem.backfillBorder(g.dem,v,S),m.neighboringTiles&&m.neighboringTiles[P]&&(m.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a,h,m){for(let g in this._tiles){let v=this._tiles[g];if(m[g]||!v.hasData()||v.tileID.overscaledZ<=a||v.tileID.overscaledZ>h)continue;let S=v.tileID;for(;v&&v.tileID.overscaledZ>a+1;){let P=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[P.key],v&&v.hasData()&&(S=P)}let I=S;for(;I.overscaledZ>a;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]||e[I.canonical.key]){m[S.key]=S;break}}}findLoadedParent(e,a){if(e.key in this._loadedParentTiles){let h=this._loadedParentTiles[e.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=e.overscaledZ-1;h>=a;h--){let m=e.scaledTo(h),g=this._getLoadedTile(m);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let a=this._tiles[e.key];return a&&a.hasData()?a:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let a=Math.ceil(e.width/this._source.tileSize)+1,h=Math.ceil(e.height/this._source.tileSize)+1,m=Math.floor(a*h*(this._maxTileCacheZoomLevels===null?r.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(g)}handleWrapJump(e){let a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){let h={};for(let m in this._tiles){let g=this._tiles[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),h[g.tileID.key]=g}this._tiles=h;for(let m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(let m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(e,a,h,m,g,v){let S={},I={},P=Object.keys(e),E=U.now();for(let D of P){let L=e[D],O=this._tiles[D];if(!O||O.fadeEndTime!==0&&O.fadeEndTime<=E)continue;let N=this.findLoadedParent(L,a),X=this.findLoadedSibling(L),H=N||X||null;H&&(this._addTile(H.tileID),S[H.tileID.key]=H.tileID),I[D]=L}this._retainLoadedChildren(I,m,h,e);for(let D in S)e[D]||(this._coveredTiles[D]=!0,e[D]=S[D]);if(v){let D={},L={};for(let O of g)this._tiles[O.key].hasData()?D[O.key]=O:L[O.key]=O;for(let O in L){let N=L[O].children(this._source.maxzoom);this._tiles[N[0].key]&&this._tiles[N[1].key]&&this._tiles[N[2].key]&&this._tiles[N[3].key]&&(D[N[0].key]=e[N[0].key]=N[0],D[N[1].key]=e[N[1].key]=N[1],D[N[2].key]=e[N[2].key]=N[2],D[N[3].key]=e[N[3].key]=N[3],delete L[O])}for(let O in L){let N=L[O],X=this.findLoadedParent(N,this._source.minzoom),H=this.findLoadedSibling(N),J=X||H||null;if(J){D[J.tileID.key]=e[J.tileID.key]=J.tileID;for(let ee in D)D[ee].isChildOf(J.tileID)&&delete D[ee]}}for(let O in this._tiles)D[O]||(this._coveredTiles[O]=!0)}}update(e,a){if(!this._sourceLoaded||this._paused)return;let h;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new r.Z(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(h=ve(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(h=h.filter(E=>this._source.hasTile(E)))):h=[];let m=ct(e,this._source),g=Math.max(m-Ft.maxOverzooming,this._source.minzoom),v=Math.max(m+Ft.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let E={};for(let D of h)if(D.canonical.z>this._source.minzoom){let L=D.scaledTo(D.canonical.z-1);E[L.key]=L;let O=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));E[O.key]=O}h=h.concat(Object.values(E))}let S=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new r.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let I=this._updateRetainedTiles(h,m);kt(this._source.type)&&this._updateCoveredAndRetainedTiles(I,g,v,m,h,a);for(let E in I)this._tiles[E].clearFadeHold();let P=r.am(this._tiles,I);for(let E of P){let D=this._tiles[E];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var h;let m={},g={},v=Math.max(a-Ft.maxOverzooming,this._source.minzoom),S=Math.max(a+Ft.maxUnderzooming,this._source.minzoom),I={};for(let P of e){let E=this._addTile(P);m[P.key]=P,E.hasData()||a<this._source.maxzoom&&(I[P.key]=P)}this._retainLoadedChildren(I,a,S,m);for(let P of e){let E=this._tiles[P.key];if(E.hasData())continue;if(a+1>this._source.maxzoom){let L=P.children(this._source.maxzoom)[0],O=this.getTile(L);if(O&&O.hasData()){m[L.key]=L;continue}}else{let L=P.children(this._source.maxzoom);if(m[L[0].key]&&m[L[1].key]&&m[L[2].key]&&m[L[3].key])continue}let D=E.wasRequested();for(let L=P.overscaledZ-1;L>=v;--L){let O=P.scaledTo(L);if(g[O.key])break;if(g[O.key]=!0,E=this.getTile(O),!E&&D&&(E=this._addTile(O)),E){let N=E.hasData();if((N||!(!((h=this.map)===null||h===void 0)&&h.cancelPendingTileRequestsWhileZooming)||D)&&(m[O.key]=O),D=E.wasRequested(),N)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let a=[],h,m=this._tiles[e].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){h=this._loadedParentTiles[m.key];break}a.push(m.key);let g=m.scaledTo(m.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;m=g}for(let g of a)this._loadedParentTiles[g]=h}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let a=this._tiles[e].tileID,h=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=h}}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,a)));let h=a;return a||(a=new os(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,h||this._source.fire(new r.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let h=a.getExpiryTimeout();h&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},h))}refreshTiles(e){for(let a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&e.some(h=>h.equals(this._tiles[a].tileID.canonical))&&this._reloadTile(a,"expired")}_removeTile(e){let a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){let a=e.sourceDataType;e.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&a==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,h){let m=[],g=this.transform;if(!g)return m;let v=g.getCoveringTilesDetailsProvider().allowWorldCopies(),S=h?g.getCameraQueryGeometry(e):e,I=O=>g.screenPointToMercatorCoordinate(O,this.terrain),P=this.transformBbox(e,I,!v),E=this.transformBbox(S,I,!v),D=this.getIds(),L=r.a2.fromPoints(E);for(let O=0;O<D.length;O++){let N=this._tiles[D[O]];if(N.holdingForFade())continue;let X=v?[N.tileID]:[N.tileID.unwrapTo(-1),N.tileID.unwrapTo(0)],H=Math.pow(2,g.zoom-N.tileID.overscaledZ),J=a*N.queryPadding*r.$/N.tileSize/H;for(let ee of X){let re=L.map(te=>ee.getTilePoint(new r.a1(te.x,te.y)));if(re.expandBy(J),re.intersects(Tt)){let te=P.map(ue=>ee.getTilePoint(ue)),ae=E.map(ue=>ee.getTilePoint(ue));m.push({tile:N,tileID:v?ee:ee.unwrapTo(0),queryGeometry:te,cameraQueryGeometry:ae,scale:H})}}}return m}transformBbox(e,a,h){let m=e.map(a);if(h){let g=r.a2.fromPoints(e);g.shrinkBy(.001*Math.min(g.width(),g.height()));let v=g.map(a);r.a2.fromPoints(m).covers(v)||(m=m.map(S=>S.x>.5?new r.a1(S.x-1,S.y,S.z):S))}return m}getVisibleCoordinates(e){let a=this.getRenderableIds(e).map(h=>this._tiles[h].tileID);return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(kt(this._source.type)){let e=U.now();for(let a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setFeatureState(e,a,h){this._state.updateState(e=e||"_geojsonTileLayer",a,h)}removeFeatureState(e,a,h){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,h)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,h){let m=this._tiles[e];m&&m.setDependencies(a,h)}reloadTilesForDependencies(e,a){for(let h in this._tiles)this._tiles[h].hasDependency(e,a)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(e,a))}}function dt(f,e){let a=Math.abs(2*f.wrap)-+(f.wrap<0),h=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||h-a||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function kt(f){return f==="raster"||f==="image"||f==="video"}Ft.maxOverzooming=10,Ft.maxUnderzooming=3;class fi{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=r.ah(e,0,1);let a=1,h=this._distances[a],m=e*this.paddedLength+this.padding;for(;h<m&&a<this._distances.length;)h=this._distances[++a];let g=a-1,v=this._distances[g],S=h-v,I=S>0?(m-v)/S:0;return this.points[g].mult(1-I).add(this.points[a].mult(I))}}function tn(f,e){let a=!0;return f==="always"||f!=="never"&&e!=="never"||(a=!1),a}class nn{constructor(e,a,h){let m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/h),this.yCellCount=Math.ceil(a/h);for(let v=0;v<this.xCellCount*this.yCellCount;v++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,h,m,g){this._forEachCell(a,h,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(e,a,h,m){this._forEachCell(a-m,h-m,a+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(h),this.circles.push(m)}_insertBoxCell(e,a,h,m,g,v){this.boxCells[g].push(v)}_insertCircleCell(e,a,h,m,g,v){this.circleCells[g].push(v)}_query(e,a,h,m,g,v,S){if(h<0||e>this.width||m<0||a>this.height)return[];let I=[];if(e<=0&&a<=0&&this.width<=h&&this.height<=m){if(g)return[{key:null,x1:e,y1:a,x2:h,y2:m}];for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){let E=this.circles[3*P],D=this.circles[3*P+1],L=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:E-L,y1:D-L,x2:E+L,y2:D+L})}}else this._forEachCell(e,a,h,m,this._queryCell,I,{hitTest:g,overlapMode:v,seenUids:{box:{},circle:{}}},S);return I}query(e,a,h,m){return this._query(e,a,h,m,!1,null)}hitTest(e,a,h,m,g,v){return this._query(e,a,h,m,!0,g,v).length>0}hitTestCircle(e,a,h,m,g){let v=e-h,S=e+h,I=a-h,P=a+h;if(S<0||v>this.width||P<0||I>this.height)return!1;let E=[];return this._forEachCell(v,I,S,P,this._queryCellCircle,E,{hitTest:!0,overlapMode:m,circle:{x:e,y:a,radius:h},seenUids:{box:{},circle:{}}},g),E.length>0}_queryCell(e,a,h,m,g,v,S,I){let{seenUids:P,hitTest:E,overlapMode:D}=S,L=this.boxCells[g];if(L!==null){let N=this.bboxes;for(let X of L)if(!P.box[X]){P.box[X]=!0;let H=4*X,J=this.boxKeys[X];if(e<=N[H+2]&&a<=N[H+3]&&h>=N[H+0]&&m>=N[H+1]&&(!I||I(J))&&(!E||!tn(D,J.overlapMode))&&(v.push({key:J,x1:N[H],y1:N[H+1],x2:N[H+2],y2:N[H+3]}),E))return!0}}let O=this.circleCells[g];if(O!==null){let N=this.circles;for(let X of O)if(!P.circle[X]){P.circle[X]=!0;let H=3*X,J=this.circleKeys[X];if(this._circleAndRectCollide(N[H],N[H+1],N[H+2],e,a,h,m)&&(!I||I(J))&&(!E||!tn(D,J.overlapMode))){let ee=N[H],re=N[H+1],te=N[H+2];if(v.push({key:J,x1:ee-te,y1:re-te,x2:ee+te,y2:re+te}),E)return!0}}}return!1}_queryCellCircle(e,a,h,m,g,v,S,I){let{circle:P,seenUids:E,overlapMode:D}=S,L=this.boxCells[g];if(L!==null){let N=this.bboxes;for(let X of L)if(!E.box[X]){E.box[X]=!0;let H=4*X,J=this.boxKeys[X];if(this._circleAndRectCollide(P.x,P.y,P.radius,N[H+0],N[H+1],N[H+2],N[H+3])&&(!I||I(J))&&!tn(D,J.overlapMode))return v.push(!0),!0}}let O=this.circleCells[g];if(O!==null){let N=this.circles;for(let X of O)if(!E.circle[X]){E.circle[X]=!0;let H=3*X,J=this.circleKeys[X];if(this._circlesCollide(N[H],N[H+1],N[H+2],P.x,P.y,P.radius)&&(!I||I(J))&&!tn(D,J.overlapMode))return v.push(!0),!0}}}_forEachCell(e,a,h,m,g,v,S,I){let P=this._convertToXCellCoord(e),E=this._convertToYCellCoord(a),D=this._convertToXCellCoord(h),L=this._convertToYCellCoord(m);for(let O=P;O<=D;O++)for(let N=E;N<=L;N++)if(g.call(this,e,a,h,m,this.xCellCount*N+O,v,S,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,h,m,g,v){let S=m-e,I=g-a,P=h+v;return P*P>S*S+I*I}_circleAndRectCollide(e,a,h,m,g,v,S){let I=(v-m)/2,P=Math.abs(e-(m+I));if(P>I+h)return!1;let E=(S-g)/2,D=Math.abs(a-(g+E));if(D>E+h)return!1;if(P<=I||D<=E)return!0;let L=P-I,O=D-E;return L*L+O*O<=h*h}}function Vi(f,e,a){let h=r.L();if(!f){let{vecSouth:D,vecEast:L}=Ht(e),O=C();O[0]=L[0],O[1]=L[1],O[2]=D[0],O[3]=D[1],m=O,(E=(v=(g=O)[0])*(P=g[3])-(I=g[2])*(S=g[1]))&&(m[0]=P*(E=1/E),m[1]=-S*E,m[2]=-I*E,m[3]=v*E),h[0]=O[0],h[1]=O[1],h[4]=O[2],h[5]=O[3]}var m,g,v,S,I,P,E;return r.N(h,h,[1/a,1/a,1]),h}function Vt(f,e,a,h){if(f){let m=r.L();if(!e){let{vecSouth:g,vecEast:v}=Ht(a);m[0]=v[0],m[1]=v[1],m[4]=g[0],m[5]=g[1]}return r.N(m,m,[h,h,1]),m}return a.pixelsToClipSpaceMatrix}function Ht(f){let e=Math.cos(f.rollInRadians),a=Math.sin(f.rollInRadians),h=Math.cos(f.pitchInRadians),m=Math.cos(f.bearingInRadians),g=Math.sin(f.bearingInRadians),v=r.ar();v[0]=-m*h*a-g*e,v[1]=-g*h*a+m*e;let S=r.as(v);S<1e-9?r.at(v):r.au(v,v,1/S);let I=r.ar();I[0]=m*h*e-g*a,I[1]=g*h*e+m*a;let P=r.as(I);return P<1e-9?r.at(I):r.au(I,I,1/P),{vecEast:I,vecSouth:v}}function Wi(f,e,a,h){let m;h?(m=[f,e,h(f,e),1],r.aw(m,m,a)):(m=[f,e,0,1],ss(m,m,a));let g=m[3];return{point:new r.P(m[0]/g,m[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function Ge(f,e){return .5+f/e*.5}function Cn(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function Ci(f,e,a,h,m,g,v,S,I,P,E,D,L){let O=a?f.textSizeData:f.iconSizeData,N=r.an(O,e.transform.zoom),X=[256/e.width*2+1,256/e.height*2+1],H=a?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;H.clear();let J=f.lineVertexArray,ee=a?f.text.placedSymbolArray:f.icon.placedSymbolArray,re=e.transform.width/e.transform.height,te=!1;for(let ae=0;ae<ee.length;ae++){let ue=ee.get(ae);if(ue.hidden||ue.writingMode===r.ao.vertical&&!te){oo(ue.numGlyphs,H);continue}te=!1;let ie=new r.P(ue.anchorX,ue.anchorY),_e={getElevation:L,pitchedLabelPlaneMatrix:h,lineVertexArray:J,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ie,unwrappedTileID:I,width:P,height:E,translation:D},Me=Jo(ue.anchorX,ue.anchorY,_e);if(!Cn(Me.point,X)){oo(ue.numGlyphs,H);continue}let we=Ge(e.transform.cameraToCenterDistance,Me.signedDistanceFromCamera),Se=r.ap(O,N,ue),Pe=g?Se*e.transform.getPitchedTextCorrection(ue.anchorX,ue.anchorY,I)/we:Se*we,Ve=Qe({projectionContext:_e,pitchedLabelPlaneMatrixInverse:m,symbol:ue,fontSize:Pe,flip:!1,keepUpright:v,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:H,aspectRatio:re,rotateToLine:S});te=Ve.useVertical,(Ve.notEnoughRoom||te||Ve.needsFlipping&&Qe({projectionContext:_e,pitchedLabelPlaneMatrixInverse:m,symbol:ue,fontSize:Pe,flip:!0,keepUpright:v,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:H,aspectRatio:re,rotateToLine:S}).notEnoughRoom)&&oo(ue.numGlyphs,H)}a?f.text.dynamicLayoutVertexBuffer.updateData(H):f.icon.dynamicLayoutVertexBuffer.updateData(H)}function Xo(f,e,a,h,m,g,v,S){let I=g.glyphStartIndex+g.numGlyphs,P=g.lineStartIndex,E=g.lineStartIndex+g.lineLength,D=e.getoffsetX(g.glyphStartIndex),L=e.getoffsetX(I-1),O=Yo(f*D,a,h,m,g.segment,P,E,S,v);if(!O)return null;let N=Yo(f*L,a,h,m,g.segment,P,E,S,v);return N?S.projectionCache.anyProjectionOccluded?null:{first:O,last:N}:null}function as(f,e,a,h){return f===r.ao.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*h?{useVertical:!0}:(f===r.ao.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function Qe(f){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:a,symbol:h,fontSize:m,flip:g,keepUpright:v,glyphOffsetArray:S,dynamicLayoutVertexArray:I,aspectRatio:P,rotateToLine:E}=f,D=m/24,L=h.lineOffsetX*D,O=h.lineOffsetY*D,N;if(h.numGlyphs>1){let X=h.glyphStartIndex+h.numGlyphs,H=h.lineStartIndex,J=h.lineStartIndex+h.lineLength,ee=Xo(D,S,L,O,g,h,E,e);if(!ee)return{notEnoughRoom:!0};let re=Sa(ee.first.point.x,ee.first.point.y,e,a),te=Sa(ee.last.point.x,ee.last.point.y,e,a);if(v&&!g){let ae=as(h.writingMode,re,te,P);if(ae)return ae}N=[ee.first];for(let ae=h.glyphStartIndex+1;ae<X-1;ae++){let ue=Yo(D*S.getoffsetX(ae),L,O,g,h.segment,H,J,e,E);if(!ue)return{notEnoughRoom:!0};N.push(ue)}N.push(ee.last)}else{if(v&&!g){let H=yn(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,J=h.lineStartIndex+h.segment+1,ee=new r.P(e.lineVertexArray.getx(J),e.lineVertexArray.gety(J)),re=yn(ee.x,ee.y,e),te=re.signedDistanceFromCamera>0?re.point:Bt(e.tileAnchorPoint,ee,H,1,e),ae=Sa(H.x,H.y,e,a),ue=Sa(te.x,te.y,e,a),ie=as(h.writingMode,ae,ue,P);if(ie)return ie}let X=Yo(D*S.getoffsetX(h.glyphStartIndex),L,O,g,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,e,E);if(!X||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};N=[X]}for(let X of N)r.av(I,X.point,X.angle);return{}}function Bt(f,e,a,h,m){let g=f.add(f.sub(e)._unit()),v=yn(g.x,g.y,m).point,S=a.sub(v);return a.add(S._mult(h/S.mag()))}function zt(f,e,a){let h=e.projectionCache;if(h.projections[f])return h.projections[f];let m=new r.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),g=yn(m.x,m.y,e);if(g.signedDistanceFromCamera>0)return h.projections[f]=g.point,h.anyProjectionOccluded=h.anyProjectionOccluded||g.isOccluded,g.point;let v=f-a.direction;return Bt(a.distanceFromAnchor===0?e.tileAnchorPoint:new r.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),m,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function yn(f,e,a){let h=f+a.translation[0],m=e+a.translation[1],g;return a.pitchWithMap?(g=Wi(h,m,a.pitchedLabelPlaneMatrix,a.getElevation),g.isOccluded=!1):(g=a.transform.projectTileCoordinates(h,m,a.unwrappedTileID,a.getElevation),g.point.x=(.5*g.point.x+.5)*a.width,g.point.y=(.5*-g.point.y+.5)*a.height),g}function Sa(f,e,a,h){if(a.pitchWithMap){let m=[f,e,0,1];return r.aw(m,m,h),a.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],a.unwrappedTileID,a.getElevation).point}return{x:f/a.width*2-1,y:1-e/a.height*2}}function Jo(f,e,a){return a.transform.projectTileCoordinates(f,e,a.unwrappedTileID,a.getElevation)}function Dt(f,e,a){return f._unit()._perp()._mult(e*a)}function sc(f,e,a,h,m,g,v,S,I){if(S.projectionCache.offsets[f])return S.projectionCache.offsets[f];let P=a.add(e);if(f+I.direction<h||f+I.direction>=m)return S.projectionCache.offsets[f]=P,P;let E=zt(f+I.direction,S,I),D=Dt(E.sub(a),v,I.direction),L=a.add(D),O=E.add(D);return S.projectionCache.offsets[f]=r.ax(g,P,L,O)||P,S.projectionCache.offsets[f]}function Yo(f,e,a,h,m,g,v,S,I){let P=h?f-e:f+e,E=P>0?1:-1,D=0;h&&(E*=-1,D=Math.PI),E<0&&(D+=Math.PI);let L,O=E>0?g+m:g+m+1;S.projectionCache.cachedAnchorPoint?L=S.projectionCache.cachedAnchorPoint:(L=yn(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=L);let N,X,H=L,J=L,ee=0,re=0,te=Math.abs(P),ae=[],ue;for(;ee+re<=te;){if(O+=E,O<g||O>=v)return null;ee+=re,J=H,X=N;let Me={absOffsetX:te,direction:E,distanceFromAnchor:ee,previousVertex:J};if(H=zt(O,S,Me),a===0)ae.push(J),ue=H.sub(J);else{let we,Se=H.sub(J);we=Se.mag()===0?Dt(zt(O+E,S,Me).sub(H),a,E):Dt(Se,a,E),X||(X=J.add(we)),N=sc(O,we,H,g,v,X,a,S,Me),ae.push(X),ue=N.sub(X)}re=ue.mag()}let ie=ue._mult((te-ee)/re)._add(X||J),_e=D+Math.atan2(H.y-J.y,H.x-J.x);return ae.push(ie),{point:ie,angle:I?_e:0,path:ae}}let lc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oo(f,e){for(let a=0;a<f;a++){let h=e.length;e.resize(h+4),e.float32.set(lc,3*h)}}function ss(f,e,a){let h=e[0],m=e[1];return f[0]=a[0]*h+a[4]*m+a[12],f[1]=a[1]*h+a[5]*m+a[13],f[3]=a[3]*h+a[7]*m+a[15],f}let Ri=100;class cc{constructor(e,a=new nn(e.width+200,e.height+200,25),h=new nn(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=h,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ri,this.screenBottomBoundary=e.height+Ri,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,h,m,g,v,S,I,P,E,D,L){let O=this.projectAndGetPerspectiveRatio(e.anchorPointX+I[0],e.anchorPointY+I[1],g,E,L),N=h*O.perspectiveRatio,X;if(v||S)X=this._projectCollisionBox(e,N,m,g,v,S,I,O,E,D,L);else{let ue=O.x+(D?D.x*N:0),ie=O.y+(D?D.y*N:0);X={allPointsOccluded:!1,box:[ue+e.x1*N,ie+e.y1*N,ue+e.x2*N,ie+e.y2*N]}}let[H,J,ee,re]=X.box,te=v?X.allPointsOccluded:O.isOccluded,ae=te;return ae||(ae=O.perspectiveRatio<this.perspectiveRatioCutoff),ae||(ae=!this.isInsideGrid(H,J,ee,re)),ae||a!=="always"&&this.grid.hitTest(H,J,ee,re,a,P)?{box:[H,J,ee,re],placeable:!1,offscreen:!1,occluded:te}:{box:[H,J,ee,re],placeable:!0,offscreen:this.isOffscreen(H,J,ee,re),occluded:te}}placeCollisionCircles(e,a,h,m,g,v,S,I,P,E,D,L,O,N){let X=[],H=new r.P(a.anchorX,a.anchorY),J=this.getPerspectiveRatio(H.x,H.y,v,N),ee=(P?g*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,v)/J:g*J)/r.aB,re={getElevation:N,pitchedLabelPlaneMatrix:S,lineVertexArray:h,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:H,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:O},te=Xo(ee,m,a.lineOffsetX*ee,a.lineOffsetY*ee,!1,a,!1,re),ae=!1,ue=!1,ie=!0;if(te){let _e=.5*D*J+L,Me=new r.P(-100,-100),we=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Se=new fi,Pe=te.first,Ve=te.last,We=[];for(let Rt=Pe.path.length-1;Rt>=1;Rt--)We.push(Pe.path[Rt]);for(let Rt=1;Rt<Ve.path.length;Rt++)We.push(Ve.path[Rt]);let Re=2.5*_e;if(P){let Rt=this.projectPathToScreenSpace(We,re);We=Rt.some(Qt=>Qt.signedDistanceFromCamera<=0)?[]:Rt.map(Qt=>Qt.point)}let st=[];if(We.length>0){let Rt=We[0].clone(),Qt=We[0].clone();for(let si=1;si<We.length;si++)Rt.x=Math.min(Rt.x,We[si].x),Rt.y=Math.min(Rt.y,We[si].y),Qt.x=Math.max(Qt.x,We[si].x),Qt.y=Math.max(Qt.y,We[si].y);st=Rt.x>=Me.x&&Qt.x<=we.x&&Rt.y>=Me.y&&Qt.y<=we.y?[We]:Qt.x<Me.x||Rt.x>we.x||Qt.y<Me.y||Rt.y>we.y?[]:r.ay([We],Me.x,Me.y,we.x,we.y)}for(let Rt of st){Se.reset(Rt,.25*_e);let Qt=0;Qt=Se.length<=.5*_e?1:Math.ceil(Se.paddedLength/Re)+1;for(let si=0;si<Qt;si++){let oi=si/Math.max(Qt-1,1),Si=Se.lerp(oi),Mi=Si.x+Ri,Lt=Si.y+Ri;X.push(Mi,Lt,_e,0);let li=Mi-_e,Hi=Lt-_e,rn=Mi+_e,un=Lt+_e;if(ie=ie&&this.isOffscreen(li,Hi,rn,un),ue=ue||this.isInsideGrid(li,Hi,rn,un),e!=="always"&&this.grid.hitTestCircle(Mi,Lt,_e,e,E)&&(ae=!0,!I))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!I&&ae||!ue||J<this.perspectiveRatioCutoff?[]:X,offscreen:ie,collisionDetected:ae}}projectPathToScreenSpace(e,a){let h=(function(m,g){let v=r.L();return r.aq(v,g.pitchedLabelPlaneMatrix),m.map(S=>{let I=Wi(S.x,S.y,v,g.getElevation),P=g.transform.projectTileCoordinates(I.point.x,I.point.y,g.unwrappedTileID,g.getElevation);return P.point.x=(.5*P.point.x+.5)*g.width,P.point.y=(.5*-P.point.y+.5)*g.height,P})})(e,a);return(function(m){let g=0,v=0,S=0,I=0;for(let P=0;P<m.length;P++)m[P].isOccluded?(S=P+1,I=0):(I++,I>v&&(v=I,g=S));return m.slice(g,g+v)})(h)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],h=new r.a2;for(let D of e){let L=new r.P(D.x+Ri,D.y+Ri);h.extend(L),a.push(L)}let{minX:m,minY:g,maxX:v,maxY:S}=h,I=this.grid.query(m,g,v,S).concat(this.ignoredGrid.query(m,g,v,S)),P={},E={};for(let D of I){let L=D.key;if(P[L.bucketInstanceId]===void 0&&(P[L.bucketInstanceId]={}),P[L.bucketInstanceId][L.featureIndex])continue;let O=[new r.P(D.x1,D.y1),new r.P(D.x2,D.y1),new r.P(D.x2,D.y2),new r.P(D.x1,D.y2)];r.az(a,O)&&(P[L.bucketInstanceId][L.featureIndex]=!0,E[L.bucketInstanceId]===void 0&&(E[L.bucketInstanceId]=[]),E[L.bucketInstanceId].push(L.featureIndex))}return E}insertCollisionBox(e,a,h,m,g,v){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:g,collisionGroupID:v,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,h,m,g,v){let S=h?this.ignoredGrid:this.grid,I={bucketInstanceId:m,featureIndex:g,collisionGroupID:v,overlapMode:a};for(let P=0;P<e.length;P+=4)S.insertCircle(I,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,a,h,m,g){if(g){let v;m?(v=[e,a,m(e,a),1],r.aw(v,v,g)):(v=[e,a,0,1],ss(v,v,g));let S=v[3];return{x:(v[0]/S+1)/2*this.transform.width+Ri,y:(-v[1]/S+1)/2*this.transform.height+Ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{let v=this.transform.projectTileCoordinates(e,a,h,m);return{x:(v.point.x+1)/2*this.transform.width+Ri,y:(1-v.point.y)/2*this.transform.height+Ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(e,a,h,m){let g=this.transform.projectTileCoordinates(e,a,h,m);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,a,h,m){return h<Ri||e>=this.screenRightBoundary||m<Ri||a>this.screenBottomBoundary}isInsideGrid(e,a,h,m){return h>=0&&e<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let e=r.ag([]);return r.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,h,m,g,v,S,I,P,E,D){let L=1,O=0,N=0,X=1,H=e.anchorPointX+S[0],J=e.anchorPointY+S[1];if(v&&!g){let We=this.projectAndGetPerspectiveRatio(H+1,J,m,P,D),Re=We.x-I.x,st=Math.atan((We.y-I.y)/Re)+(Re<0?Math.PI:0),Rt=Math.sin(st),Qt=Math.cos(st);L=Qt,O=Rt,N=-Rt,X=Qt}else if(!v&&g){let We=Ht(this.transform);L=We.vecEast[0],O=We.vecEast[1],N=We.vecSouth[0],X=We.vecSouth[1]}let ee=I.x,re=I.y,te=a;g&&(ee=H,re=J,te=Math.pow(2,-(this.transform.zoom-h.overscaledZ)),te*=this.transform.getPitchedTextCorrection(H,J,m),E||(te*=r.ah(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),E&&(ee+=L*E.x*te+N*E.y*te,re+=O*E.x*te+X*E.y*te);let ae=e.x1*te,ue=e.x2*te,ie=(ae+ue)/2,_e=e.y1*te,Me=e.y2*te,we=(_e+Me)/2,Se=[{offsetX:ae,offsetY:_e},{offsetX:ie,offsetY:_e},{offsetX:ue,offsetY:_e},{offsetX:ue,offsetY:we},{offsetX:ue,offsetY:Me},{offsetX:ie,offsetY:Me},{offsetX:ae,offsetY:Me},{offsetX:ae,offsetY:we}],Pe=[];for(let{offsetX:We,offsetY:Re}of Se)Pe.push(new r.P(ee+L*We+N*Re,re+O*We+X*Re));let Ve=!1;if(g){let We=Pe.map(Re=>this.projectAndGetPerspectiveRatio(Re.x,Re.y,m,P,D));Ve=We.some(Re=>!Re.isOccluded),Pe=We.map(Re=>new r.P(Re.x,Re.y))}else Ve=!0;return{box:r.aA(Pe),allPointsOccluded:!Ve}}}class Xn{constructor(e,a,h,m){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class ui{constructor(e,a,h,m,g){this.text=new Xn(e?e.text:null,a,h,g),this.icon=new Xn(e?e.icon:null,a,m,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Rp{constructor(e,a,h){this.text=e,this.icon=a,this.skipFade=h}}class tl{constructor(e,a,h,m,g){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=g}}class Nu{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[e]}}function Qo(f,e,a,h,m){let{horizontalAlign:g,verticalAlign:v}=r.aH(f);return new r.P(-(g-.5)*e+h[0]*m,-(v-.5)*a+h[1]*m)}class ea{constructor(e,a,h,m,g){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new cc(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Nu(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let a=this.terrain;return a?(h,m)=>a.getElevation(e,h,m):null}getBucketParts(e,a,h,m){let g=h.getBucket(a),v=h.latestFeatureIndex;if(!g||!v||a.id!==g.layerIds[0])return;let S=h.collisionBoxArray,I=g.layers[0].layout,P=g.layers[0].paint,E=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),D=h.tileSize/r.$,L=h.tileID.toUnwrapped(),O=I.get("text-rotation-alignment")==="map",N=r.aC(h,1,this.transform.zoom),X=r.aD(this.collisionIndex.transform,h,P.get("text-translate"),P.get("text-translate-anchor")),H=r.aD(this.collisionIndex.transform,h,P.get("icon-translate"),P.get("icon-translate-anchor")),J=Vi(O,this.transform,N);this.retainedQueryData[g.bucketInstanceId]=new tl(g.bucketInstanceId,v,g.sourceLayerIndex,g.index,h.tileID);let ee={bucket:g,layout:I,translationText:X,translationIcon:H,unwrappedTileID:L,pitchedLabelPlaneMatrix:J,scale:E,textPixelRatio:D,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:r.an(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(m)for(let re of g.sortKeyRanges){let{sortKey:te,symbolInstanceStart:ae,symbolInstanceEnd:ue}=re;e.push({sortKey:te,symbolInstanceStart:ae,symbolInstanceEnd:ue,parameters:ee})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(e,a,h,m,g,v,S,I,P,E,D,L,O,N,X,H,J,ee,re,te){let ae=r.aE[e.textAnchor],ue=[e.textOffset0,e.textOffset1],ie=Qo(ae,h,m,ue,g),_e=this.collisionIndex.placeCollisionBox(a,L,I,P,E,S,v,H,D.predicate,re,ie,te);if((!ee||this.collisionIndex.placeCollisionBox(ee,L,I,P,E,S,v,J,D.predicate,re,ie,te).placeable)&&_e.placeable){let Me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(Me=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:ue,width:h,height:m,anchor:ae,textBoxScale:g,prevAnchor:Me},this.markUsedJustification(N,ae,O,X),N.allowVerticalPlacement&&(this.markUsedOrientation(N,X,O),this.placedOrientations[O.crossTileID]=X),{shift:ie,placedGlyphBoxes:_e}}}placeLayerBucketPart(e,a,h){let{bucket:m,layout:g,translationText:v,translationIcon:S,unwrappedTileID:I,pitchedLabelPlaneMatrix:P,textPixelRatio:E,holdingForFade:D,collisionBoxArray:L,partiallyEvaluatedTextSize:O,collisionGroup:N}=e.parameters,X=g.get("text-optional"),H=g.get("icon-optional"),J=r.aF(g,"text-overlap","text-allow-overlap"),ee=J==="always",re=r.aF(g,"icon-overlap","icon-allow-overlap"),te=re==="always",ae=g.get("text-rotation-alignment")==="map",ue=g.get("text-pitch-alignment")==="map",ie=g.get("icon-text-fit")!=="none",_e=g.get("symbol-z-order")==="viewport-y",Me=ee&&(te||!m.hasIconData()||H),we=te&&(ee||!m.hasTextData()||X);!m.collisionArrays&&L&&m.deserializeCollisionBoxes(L);let Se=this.retainedQueryData[m.bucketInstanceId].tileID,Pe=this._getTerrainElevationFunc(Se),Ve=this.transform.getFastPathSimpleProjectionMatrix(Se),We=(Re,st,Rt)=>{var Qt,si;if(a[Re.crossTileID])return;if(D)return void(this.placements[Re.crossTileID]=new Rp(!1,!1,!1));let oi=!1,Si=!1,Mi=!0,Lt=null,li={box:null,placeable:!1,offscreen:null,occluded:!1},Hi={placeable:!1},rn=null,un=null,Nn=null,$r=0,oa=0,aa=0;st.textFeatureIndex?$r=st.textFeatureIndex:Re.useRuntimeCollisionCircles&&($r=Re.featureIndex),st.verticalTextFeatureIndex&&(oa=st.verticalTextFeatureIndex);let Ms=st.textBox;if(Ms){let Qn=Ki=>{let on=r.ao.horizontal;if(m.allowVerticalPlacement&&!Ki&&this.prevPlacement){let br=this.prevPlacement.placedOrientations[Re.crossTileID];br&&(this.placedOrientations[Re.crossTileID]=br,on=br,this.markUsedOrientation(m,on,Re))}return on},Gr=(Ki,on)=>{if(m.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&st.verticalTextBox){for(let br of m.writingModes)if(br===r.ao.vertical?(li=on(),Hi=li):li=Ki(),li&&li.placeable)break}else li=Ki()},Vn=Re.textAnchorOffsetStartIndex,sa=Re.textAnchorOffsetEndIndex;if(sa===Vn){let Ki=(on,br)=>{let Xi=this.collisionIndex.placeCollisionBox(on,J,E,Se,I,ue,ae,v,N.predicate,Pe,void 0,Ve);return Xi&&Xi.placeable&&(this.markUsedOrientation(m,br,Re),this.placedOrientations[Re.crossTileID]=br),Xi};Gr(()=>Ki(Ms,r.ao.horizontal),()=>{let on=st.verticalTextBox;return m.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&on?Ki(on,r.ao.vertical):{box:null,offscreen:null}}),Qn(li&&li.placeable)}else{let Ki=r.aE[(si=(Qt=this.prevPlacement)===null||Qt===void 0?void 0:Qt.variableOffsets[Re.crossTileID])===null||si===void 0?void 0:si.anchor],on=(Xi,Ml,As)=>{let ko=Xi.x2-Xi.x1,qr=Xi.y2-Xi.y1,la=Re.textBoxScale,Cd=ie&&re==="never"?Ml:null,cr=null,Pd=J==="never"?1:2,Rh="never";Ki&&Pd++;for(let qc=0;qc<Pd;qc++){for(let Wc=Vn;Wc<sa;Wc++){let ca=m.textAnchorOffsets.get(Wc);if(Ki&&ca.textAnchor!==Ki)continue;let Lo=this.attemptAnchorPlacement(ca,Xi,ko,qr,la,ae,ue,E,Se,I,N,Rh,Re,m,As,v,S,Cd,Pe);if(Lo&&(cr=Lo.placedGlyphBoxes,cr&&cr.placeable))return oi=!0,Lt=Lo.shift,cr}Ki?Ki=null:Rh=J}return h&&!cr&&(cr={box:this.collisionIndex.placeCollisionBox(Ms,"always",E,Se,I,ue,ae,v,N.predicate,Pe,void 0,Ve).box,offscreen:!1,placeable:!1,occluded:!1}),cr};Gr(()=>on(Ms,st.iconBox,r.ao.horizontal),()=>{let Xi=st.verticalTextBox;return m.allowVerticalPlacement&&(!li||!li.placeable)&&Re.numVerticalGlyphVertices>0&&Xi?on(Xi,st.verticalIconBox,r.ao.vertical):{box:null,occluded:!0,offscreen:null}}),li&&(oi=li.placeable,Mi=li.offscreen);let br=Qn(li&&li.placeable);if(!oi&&this.prevPlacement){let Xi=this.prevPlacement.variableOffsets[Re.crossTileID];Xi&&(this.variableOffsets[Re.crossTileID]=Xi,this.markUsedJustification(m,Xi.anchor,Re,br))}}}if(rn=li,oi=rn&&rn.placeable,Mi=rn&&rn.offscreen,Re.useRuntimeCollisionCircles){let Qn=m.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex),Gr=r.ap(m.textSizeData,O,Qn),Vn=g.get("text-padding");un=this.collisionIndex.placeCollisionCircles(J,Qn,m.lineVertexArray,m.glyphOffsetArray,Gr,I,P,h,ue,N.predicate,Re.collisionCircleDiameter,Vn,v,Pe),un.circles.length&&un.collisionDetected&&!h&&r.w("Collisions detected, but collision boxes are not shown"),oi=ee||un.circles.length>0&&!un.collisionDetected,Mi=Mi&&un.offscreen}if(st.iconFeatureIndex&&(aa=st.iconFeatureIndex),st.iconBox){let Qn=Gr=>this.collisionIndex.placeCollisionBox(Gr,re,E,Se,I,ue,ae,S,N.predicate,Pe,ie&&Lt?Lt:void 0,Ve);Hi&&Hi.placeable&&st.verticalIconBox?(Nn=Qn(st.verticalIconBox),Si=Nn.placeable):(Nn=Qn(st.iconBox),Si=Nn.placeable),Mi=Mi&&Nn.offscreen}let Es=X||Re.numHorizontalGlyphVertices===0&&Re.numVerticalGlyphVertices===0,Na=H||Re.numIconVertices===0;Es||Na?Na?Es||(Si=Si&&oi):oi=Si&&oi:Si=oi=Si&&oi;let Va=Si&&Nn.placeable;if(oi&&rn.placeable&&this.collisionIndex.insertCollisionBox(rn.box,J,g.get("text-ignore-placement"),m.bucketInstanceId,Hi&&Hi.placeable&&oa?oa:$r,N.ID),Va&&this.collisionIndex.insertCollisionBox(Nn.box,re,g.get("icon-ignore-placement"),m.bucketInstanceId,aa,N.ID),un&&oi&&this.collisionIndex.insertCollisionCircles(un.circles,J,g.get("text-ignore-placement"),m.bucketInstanceId,$r,N.ID),h&&this.storeCollisionData(m.bucketInstanceId,Rt,st,rn,Nn,un),Re.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Re.crossTileID]=new Rp((oi||Me)&&!rn?.occluded,(Si||we)&&!Nn?.occluded,Mi||m.justReloaded),a[Re.crossTileID]=!0};if(_e){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Re=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let st=Re.length-1;st>=0;--st){let Rt=Re[st];We(m.symbolInstances.get(Rt),m.collisionArrays[Rt],Rt)}}else for(let Re=e.symbolInstanceStart;Re<e.symbolInstanceEnd;Re++)We(m.symbolInstances.get(Re),m.collisionArrays[Re],Re);m.justReloaded=!1}storeCollisionData(e,a,h,m,g,v){if(h.textBox||h.iconBox){let S,I;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(a)?I=S.get(a):(I={text:null,icon:null},S.set(a,I)),h.textBox&&(I.text=m.box),h.iconBox&&(I.icon=g.box)}if(v){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=[]);for(let I=0;I<v.circles.length;I+=4)S.push(v.circles[I+0]-Ri),S.push(v.circles[I+1]-Ri),S.push(v.circles[I+2]),S.push(v.collisionDetected?1:0)}}markUsedJustification(e,a,h,m){let g;g=m===r.ao.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[r.aG(a)];let v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(let S of v)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=g>=0&&S!==g?0:h.crossTileID)}markUsedOrientation(e,a,h){let m=a===r.ao.horizontal||a===r.ao.horizontalOnly?a:0,g=a===r.ao.vertical?a:0,v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(let S of v)e.text.placedSymbolArray.get(S).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let m=a?a.symbolFadeChange(e):1,g=a?a.opacities:{},v=a?a.variableOffsets:{},S=a?a.placedOrientations:{};for(let I in this.placements){let P=this.placements[I],E=g[I];E?(this.opacities[I]=new ui(E,m,P.text,P.icon),h=h||P.text!==E.text.placed||P.icon!==E.icon.placed):(this.opacities[I]=new ui(null,m,P.text,P.icon,P.skipFade),h=h||P.text||P.icon)}for(let I in g){let P=g[I];if(!this.opacities[I]){let E=new ui(P,m,!1,!1);E.isHidden()||(this.opacities[I]=E,h=h||P.text.placed||P.icon.placed)}}for(let I in v)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=v[I]);for(let I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){let h={};for(let m of a){let g=m.getBucket(e);g&&m.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,m.tileID,h,m.collisionBoxArray)}}updateBucketOpacities(e,a,h,m){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let g=e.layers[0],v=g.layout,S=new ui(null,0,!1,!1,!0),I=v.get("text-allow-overlap"),P=v.get("icon-allow-overlap"),E=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=v.get("text-rotation-alignment")==="map",L=v.get("text-pitch-alignment")==="map",O=v.get("icon-text-fit")!=="none",N=new ui(null,0,I&&(P||!e.hasIconData()||v.get("icon-optional")),P&&(I||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&m&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(m);let X=(J,ee,re)=>{for(let te=0;te<ee/4;te++)J.opacityVertexArray.emplaceBack(re);J.hasVisibleVertices=J.hasVisibleVertices||re!==cs},H=this.collisionBoxArrays.get(e.bucketInstanceId);for(let J=0;J<e.symbolInstances.length;J++){let ee=e.symbolInstances.get(J),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:te,crossTileID:ae}=ee,ue=this.opacities[ae];h[ae]?ue=S:ue||(ue=N,this.opacities[ae]=ue),h[ae]=!0;let ie=ee.numIconVertices>0,_e=this.placedOrientations[ee.crossTileID],Me=_e===r.ao.vertical,we=_e===r.ao.horizontal||_e===r.ao.horizontalOnly;if(re>0||te>0){let Pe=$u(ue.text);X(e.text,re,Me?cs:Pe),X(e.text,te,we?cs:Pe);let Ve=ue.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(st=>{st>=0&&(e.text.placedSymbolArray.get(st).hidden=Ve||Me?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Ve||we?1:0);let We=this.variableOffsets[ee.crossTileID];We&&this.markUsedJustification(e,We.anchor,ee,_e);let Re=this.placedOrientations[ee.crossTileID];Re&&(this.markUsedJustification(e,"left",ee,Re),this.markUsedOrientation(e,Re,ee))}if(ie){let Pe=$u(ue.icon),Ve=!(O&&ee.verticalPlacedIconSymbolIndex&&Me);ee.placedIconSymbolIndex>=0&&(X(e.icon,ee.numIconVertices,Ve?Pe:cs),e.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=ue.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(X(e.icon,ee.numVerticalIconVertices,Ve?cs:Pe),e.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=ue.icon.isHidden())}let Se=H&&H.has(J)?H.get(J):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let Pe=e.collisionArrays[J];if(Pe){let Ve=new r.P(0,0);if(Pe.textBox||Pe.verticalTextBox){let We=!0;if(E){let Re=this.variableOffsets[ae];Re?(Ve=Qo(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textBoxScale),D&&Ve._rotate(L?-this.transform.bearingInRadians:this.transform.bearingInRadians)):We=!1}if(Pe.textBox||Pe.verticalTextBox){let Re;Pe.textBox&&(Re=Me),Pe.verticalTextBox&&(Re=we),Vu(e.textCollisionBox.collisionVertexArray,ue.text.placed,!We||Re,Se.text,Ve.x,Ve.y)}}if(Pe.iconBox||Pe.verticalIconBox){let We=!!(!we&&Pe.verticalIconBox),Re;Pe.iconBox&&(Re=We),Pe.verticalIconBox&&(Re=!We),Vu(e.iconCollisionBox.collisionVertexArray,ue.icon.placed,Re,Se.icon,O?Ve.x:0,O?Ve.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){let h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>e}setStale(){this.stale=!0}}function Vu(f,e,a,h,m,g){h&&h.length!==0||(h=[0,0,0,0]);let v=h[0]-Ri,S=h[1]-Ri,I=h[2]-Ri,P=h[3]-Ri;f.emplaceBack(e?1:0,a?1:0,m||0,g||0,v,S),f.emplaceBack(e?1:0,a?1:0,m||0,g||0,I,S),f.emplaceBack(e?1:0,a?1:0,m||0,g||0,I,P),f.emplaceBack(e?1:0,a?1:0,m||0,g||0,v,P)}let zp=Math.pow(2,25),Op=Math.pow(2,24),ls=Math.pow(2,17),Fp=Math.pow(2,16),Pf=Math.pow(2,9),Mf=Math.pow(2,8),Ef=Math.pow(2,1);function $u(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let e=f.placed?1:0,a=Math.floor(127*f.opacity);return a*zp+e*Op+a*ls+e*Fp+a*Pf+e*Mf+a*Ef+e}let cs=0;class Gu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,h,m,g){let v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(v,m,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<v.length;)if(a.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,g())return!0;return!1}}class qu{constructor(e,a,h,m,g,v,S,I){this.placement=new ea(e,a,v,S,I),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,a,h){let m=U.now(),g=()=>!this._forceFullPlacement&&U.now()-m>2;for(;this._currentPlacementIndex>=0;){let v=a[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=S)&&(!v.maxzoom||v.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Gu(v)),this._inProgressLayer.continuePlacement(h[v.source],this.placement,this._showCollisionBoxes,v,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let us=512/r.$/2;class Wu{constructor(e,a,h){this.tileID=e,this.bucketInstanceId=h,this._symbolsByKey={};let m=new Map;for(let g=0;g<a.length;g++){let v=a.get(g),S=v.key,I=m.get(S);I?I.push(v):m.set(S,[v])}for(let[g,v]of m){let S={positions:v.map(I=>({x:Math.floor(I.anchorX*us),y:Math.floor(I.anchorY*us)})),crossTileIDs:v.map(I=>I.crossTileID)};if(S.positions.length>128){let I=new r.aI(S.positions.length,16,Uint16Array);for(let{x:P,y:E}of S.positions)I.add(P,E);I.finish(),delete S.positions,S.index=I}this._symbolsByKey[g]=S}}getScaledCoordinates(e,a){let{x:h,y:m,z:g}=this.tileID.canonical,{x:v,y:S,z:I}=a.canonical,P=us/Math.pow(2,I-g),E=(S*r.$+e.anchorY)*P,D=m*r.$*us;return{x:Math.floor((v*r.$+e.anchorX)*P-h*r.$*us),y:Math.floor(E-D)}}findMatches(e,a,h){let m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let g=0;g<e.length;g++){let v=e.get(g);if(v.crossTileID)continue;let S=this._symbolsByKey[v.key];if(!S)continue;let I=this.getScaledCoordinates(v,a);if(S.index){let P=S.index.range(I.x-m,I.y-m,I.x+m,I.y+m).sort();for(let E of P){let D=S.crossTileIDs[E];if(!h[D]){h[D]=!0,v.crossTileID=D;break}}}else if(S.positions)for(let P=0;P<S.positions.length;P++){let E=S.positions[P],D=S.crossTileIDs[P];if(Math.abs(E.x-I.x)<=m&&Math.abs(E.y-I.y)<=m&&!h[D]){h[D]=!0,v.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Zu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Af{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let a=Math.round((e-this.lng)/360);if(a!==0)for(let h in this.indexes){let m=this.indexes[h],g={};for(let v in m){let S=m[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+a),g[S.tileID.key]=S}this.indexes[h]=g}this.lng=e}addBucket(e,a,h){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<a.symbolInstances.length;g++)a.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let m=this.usedCrossTileIDs[e.overscaledZ];for(let g in this.indexes){let v=this.indexes[g];if(Number(g)>e.overscaledZ)for(let S in v){let I=v[S];I.tileID.isChildOf(e)&&I.findMatches(a.symbolInstances,e,m)}else{let S=v[e.scaledTo(Number(g)).key];S&&S.findMatches(a.symbolInstances,e,m)}}for(let g=0;g<a.symbolInstances.length;g++){let v=a.symbolInstances.get(g);v.crossTileID||(v.crossTileID=h.generate(),m[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Wu(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(let h of a.getCrossTileIDsLists())for(let m of h)delete this.usedCrossTileIDs[e][m]}removeStaleBuckets(e){let a=!1;for(let h in this.indexes){let m=this.indexes[h];for(let g in m)e[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[g]),delete m[g],a=!0)}return a}}class hs{constructor(){this.layerIndexes={},this.crossTileIDs=new Zu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,h){let m=this.layerIndexes[e.id];m===void 0&&(m=this.layerIndexes[e.id]=new Af);let g=!1,v={};m.handleWrapJump(h);for(let S of a){let I=S.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(S.tileID,I,this.crossTileIDs)&&(g=!0),v[I.bucketInstanceId]=!0)}return m.removeStaleBuckets(v)&&(g=!0),g}pruneUnusedLayers(e){let a={};e.forEach(h=>{a[h]=!0});for(let h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}var il="void main() {fragColor=vec4(1.0);}";let zr={prelude:jt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:jt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:jt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:jt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:jt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:jt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:jt(il,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:jt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:jt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:jt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:jt(il,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:jt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:jt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:jt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:jt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:jt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:jt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:jt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:jt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:jt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:jt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:jt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:jt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:jt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:jt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:jt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:jt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function jt(f,e){let a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=e.match(/in ([\w]+) ([\w]+)/g),m=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=g?g.concat(m):m,S={};return{fragmentSource:f=f.replace(a,(I,P,E,D,L)=>(S[L]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${E} ${D} ${L};
#else
uniform ${E} ${D} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${E} ${D} ${L} = u_${L};
#endif
`)),vertexSource:e=e.replace(a,(I,P,E,D,L)=>{let O=D==="float"?"vec2":"vec4",N=L.match(/color/)?"color":O;return S[L]?P==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${E} ${O} a_${L};
out ${E} ${D} ${L};
#else
uniform ${E} ${D} u_${L};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${E} ${D} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${N}(a_${L}, u_${L}_t);
#else
    ${E} ${D} ${L} = u_${L};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${E} ${O} a_${L};
#else
uniform ${E} ${D} u_${L};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${E} ${D} ${L} = a_${L};
#else
    ${E} ${D} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${E} ${D} ${L} = unpack_mix_${N}(a_${L}, u_${L}_t);
#else
    ${E} ${D} ${L} = u_${L};
#endif
`}),staticAttributes:h,staticUniforms:v}}class Ia{constructor(e,a,h){this.vertexBuffer=e,this.indexBuffer=a,this.segments=h}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ta=r.aJ([{name:"a_pos",type:"Int16",components:2}]);let Po="#define PROJECTION_MERCATOR",Ta="mercator";class Ut{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ta}get shaderDefine(){return Po}get shaderPreludeCode(){return zr.projectionMercator}get vertexShaderPreludeCode(){return zr.projectionMercator.vertexSource}get subdivisionGranularity(){return r.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,a,h,m,g){if(this._cachedMesh)return this._cachedMesh;let v=new r.aL;v.emplaceBack(0,0),v.emplaceBack(r.$,0),v.emplaceBack(0,r.$),v.emplaceBack(r.$,r.$);let S=e.createVertexBuffer(v,ta.members),I=r.aM.simpleSegment(0,0,4,2),P=new r.aN;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3);let E=e.createIndexBuffer(P);return this._cachedMesh=new Ia(S,E,I),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ca{constructor(e=0,a=0,h=0,m=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=h,this.right=m}interpolate(e,a,h){return a.top!=null&&e.top!=null&&(this.top=r.C.number(e.top,a.top,h)),a.bottom!=null&&e.bottom!=null&&(this.bottom=r.C.number(e.bottom,a.bottom,h)),a.left!=null&&e.left!=null&&(this.left=r.C.number(e.left,a.left,h)),a.right!=null&&e.right!=null&&(this.right=r.C.number(e.right,a.right,h)),this}getCenter(e,a){let h=r.ah((this.left+e-this.right)/2,0,e),m=r.ah((this.top+a-this.bottom)/2,0,a);return new r.P(h,m)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function uc(f,e){if(!f.renderWorldCopies||f.lngRange)return;let a=e.lng-f.center.lng;e.lng+=a>180?-360:a<-180?360:0}function hc(f){return Math.max(0,Math.floor(f))}class Fn{constructor(e,a,h,m,g,v){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=a||0,this._maxZoom=h||22,this._minPitch=m??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new r.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=hc(this._zoom),this._scale=r.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ca,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,a,h){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=hc(this._zoom),this._scale=r.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ca(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!h&&e.autoCalculateNearFarZ,a&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let a=r.aO(e,-180,180)*Math.PI/180;var h,m,g,v,S,I,P,E,D;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=C(),h=this._rotationMatrix,g=-this._bearingInRadians,v=(m=this._rotationMatrix)[0],S=m[1],I=m[2],P=m[3],E=Math.sin(g),D=Math.cos(g),h[0]=v*D+I*E,h[1]=S*D+P*E,h[2]=v*-E+I*D,h[3]=S*-E+P*D)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let a=r.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let a=e/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return r.aP(this._fovInRadians)}setFov(e){e=r.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=r.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let a=this.getConstrained(this._center,e).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=r.af(a),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,a){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,h){this._unmodified=!1,this._edgeInsets.interpolate(e,a,h),this._constrain(),this._calcMatrices()}resize(e,a,h=!0){this._width=e,this._height=a,h&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Di([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-r.ai,r.ai])}getConstrained(e,a){return this._callbacks.getConstrained(e,a)}getCameraQueryGeometry(e,a){if(a.length===1)return[a[0],e];{let{minX:h,minY:m,maxX:g,maxY:v}=r.a2.fromPoints(a).extend(e);return[new r.P(h,m),new r.P(g,m),new r.P(g,v),new r.P(h,v),new r.P(h,m)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:a,zoom:h}=this.getConstrained(this.center,this.zoom);this.setCenter(a),this.setZoom(h),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=r.ag(new Float64Array(16));r.N(e,e,[this._width/2,-this._height/2,1]),r.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=r.ag(new Float64Array(16)),r.N(e,e,[1,-1,1]),r.M(e,e,[-1,-1,0]),r.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,a,h,m){let g=h!==void 0?h:this.bearing,v=m=m!==void 0?m:this.pitch,S=r.a1.fromLngLat(e,a),I=-Math.cos(r.ae(v)),P=Math.sin(r.ae(v)),E=P*Math.sin(r.ae(g)),D=-P*Math.cos(r.ae(g)),L=this.elevation,O=a-L,N;I*O>=0||Math.abs(I)<.1?(N=1e4,L=a+N*I):N=-O/I;let X,H,J=r.aQ(1,S.y),ee=0;do{if(ee+=1,ee>10)break;H=N/J,X=new r.a1(S.x+E*H,S.y+D*H),J=1/X.meterInMercatorCoordinateUnits()}while(Math.abs(N-H*J)>1e-12);return{center:X.toLngLat(),elevation:L,zoom:r.ak(this.height/2/Math.tan(this.fovInRadians/2)/H/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let a=r.aj(1,this.center.lat)*this.worldSize,h=this.cameraToCenterDistance/a,m=r.a1.fromLngLat(this.center,this.elevation),g=Te(this.center,this.elevation,this.pitch,this.bearing,h);this._elevation=e;let v=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),r.aQ(g.z,m.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=r.aj(1,this.center.lat)*this.worldSize;return Te(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let a=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/a,e.canonical.y/a,1/a/r.$,1/a/r.$]}}class ln{constructor(e,a){this.min=e,this.max=a,this.center=r.aR([],r.aS([],this.min,this.max),.5)}quadrant(e){let a=[e%2==0,e<2],h=r.aT(this.min),m=r.aT(this.max);for(let g=0;g<a.length;g++)h[g]=a[g]?this.min[g]:this.center[g],m[g]=a[g]?this.center[g]:this.max[g];return m[2]=this.max[2],new ln(h,m)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let a=!0;for(let h=0;h<e.planes.length;h++){let m=this.intersectsPlane(e.planes[h]);if(m===0)return 0;m===1&&(a=!1)}return a?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let a=e[3],h=e[3];for(let m=0;m<3;m++)e[m]>0?(a+=e[m]*this.min[m],h+=e[m]*this.max[m]):(h+=e[m]*this.min[m],a+=e[m]*this.max[m]);return a>=0?2:h<0?0:1}}class Bn{distanceToTile2d(e,a,h,m){let g=m.distanceX([e,a]),v=m.distanceY([e,a]);return Math.hypot(g,v)}getWrap(e,a,h){return h}getTileBoundingVolume(e,a,h,m){var g,v;let S=0,I=0;if(m?.terrain){let E=new r.Z(e.z,a,e.z,e.x,e.y),D=m.terrain.getMinMaxElevation(E);S=(g=D.minElevation)!==null&&g!==void 0?g:Math.min(0,h),I=(v=D.maxElevation)!==null&&v!==void 0?v:Math.max(0,h)}let P=1<<e.z;return new ln([a+e.x/P,e.y/P,S],[a+(e.x+1)/P,(e.y+1)/P,I])}allowVariableZoom(e,a){let h=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,m=r.ah(78.5-h/2,0,60);return!!a.terrain||e.pitch>m}allowWorldCopies(){return!0}prepareNextFrame(){}}class Zi{constructor(e,a,h){this.points=e,this.planes=a,this.aabb=h}static fromInvProjectionMatrix(e,a=1,h=0,m,g){let v=g?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,h),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>(function(O,N,X,H){let J=r.aw([],O,N),ee=1/J[3]/X*H;return r.aY(J,J,[ee,ee,1/J[3],ee])})(L,e,a,S));m&&(function(L,O,N,X){let H=X?4:0,J=X?0:4,ee=0,re=[],te=[];for(let ie=0;ie<4;ie++){let _e=r.aU([],L[ie+J],L[ie+H]),Me=r.aZ(_e);r.aR(_e,_e,1/Me),re.push(Me),te.push(_e)}for(let ie=0;ie<4;ie++){let _e=r.a_(L[ie+H],te[ie],N);ee=_e!==null&&_e>=0?Math.max(ee,_e):Math.max(ee,re[ie])}let ae=(function(ie,_e){let Me=r.aU([],ie[_e[0]],ie[_e[1]]),we=r.aU([],ie[_e[2]],ie[_e[1]]),Se=[0,0,0,0];return r.aV(Se,r.aW([],Me,we)),Se[3]=-r.aX(Se,ie[_e[0]]),Se})(L,O),ue=(function(ie,_e){let Me=r.a$(ie),we=r.b0([],ie,1/Me),Se=r.aU([],_e,r.aR([],we,r.aX(_e,we))),Pe=r.a$(Se);if(Pe>0){let Ve=Math.sqrt(1-we[3]*we[3]),We=r.aR([],we,-we[3]),Re=r.aS([],We,r.aR([],Se,Ve/Pe));return r.b1(_e,Re)}return null})(N,ae);if(ue!==null){let ie=ue/r.aX(te[0],ae);ee=Math.min(ee,ie)}for(let ie=0;ie<4;ie++){let _e=Math.min(ee,re[ie]);L[ie+J]=[L[ie+H][0]+te[ie][0]*_e,L[ie+H][1]+te[ie][1]*_e,L[ie+H][2]+te[ie][2]*_e,1]}})(I,v[0],m,g);let P=v.map(L=>{let O=r.aU([],I[L[0]],I[L[1]]),N=r.aU([],I[L[2]],I[L[1]]),X=r.aV([],r.aW([],O,N)),H=-r.aX(X,I[L[1]]);return X.concat(H)}),E=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],D=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let L of I)for(let O=0;O<3;O++)E[O]=Math.min(E[O],L[O]),D[O]=Math.max(D[O],L[O]);return new Zi(I,P,new ln(E,D))}}class hi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,h){return this._helper.interpolatePadding(e,a,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,h=!0){this._helper.resize(e,a,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,a){}constructor(e,a,h,m,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Fn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(v,S)=>this.getConstrained(v,S)},e,a,h,m,g),this._coveringTilesDetailsProvider=new Bn}clone(){let e=new hi;return e.apply(this),e}apply(e,a,h){this._helper.apply(e,a,h)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let a=[new r.b2(0,e)];if(this._helper._renderWorldCopies){let h=this.screenPointToMercatorCoordinate(new r.P(0,0)),m=this.screenPointToMercatorCoordinate(new r.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new r.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new r.P(0,this._helper._height)),S=Math.floor(Math.min(h.x,m.x,g.x,v.x)),I=Math.floor(Math.max(h.x,m.x,g.x,v.x)),P=1;for(let E=S-P;E<=I+P;E++)E!==0&&a.push(new r.b2(E,e))}return a}getCameraFrustum(){return Zi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let a=this.screenPointToLocation(this.centerPoint,e),h=e?e.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(h)}setLocationAtPoint(e,a){let h=r.aj(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(a,h),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,h),v=r.a1.fromLngLat(e),S=new r.a1(v.x-(m.x-g.x),v.y-(m.y-g.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,a){return a?this.coordinatePoint(r.a1.fromLngLat(e),a.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(r.a1.fromLngLat(e))}screenPointToLocation(e,a){var h;return(h=this.screenPointToMercatorCoordinate(e,a))===null||h===void 0?void 0:h.toLngLat()}screenPointToMercatorCoordinate(e,a){if(a){let h=a.pointCoordinate(e);if(h!=null)return h}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,a){let h=a||0,m=[e.x,e.y,0,1],g=[e.x,e.y,1,1];r.aw(m,m,this._pixelMatrixInverse),r.aw(g,g,this._pixelMatrixInverse);let v=m[3],S=g[3],I=m[1]/v,P=g[1]/S,E=m[2]/v,D=g[2]/S,L=E===D?0:(h-E)/(D-E);return new r.a1(r.C.number(m[0]/v,g[0]/S,L)/this.worldSize,r.C.number(I,P,L)/this.worldSize,h)}coordinatePoint(e,a=0,h=this._pixelMatrix){let m=[e.x*this.worldSize,e.y*this.worldSize,a,1];return r.aw(m,m,h),new r.P(m[0]/m[3],m[1]/m[3])}getBounds(){let e=Math.max(0,this._helper._height/2-he(this));return new Di().extend(this.screenPointToLocation(new r.P(0,e))).extend(this.screenPointToLocation(new r.P(this._helper._width,e))).extend(this.screenPointToLocation(new r.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new r.P(0,this._helper._height)))}isPointOnMapSurface(e,a){return a?a.pointCoordinate(e)!=null:e.y>this.height/2-he(this)}calculatePosMatrix(e,a=!1,h){var m;let g=(m=e.key)!==null&&m!==void 0?m:r.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),v=a?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(g)){let P=v.get(g);return h?P.f32:P.f64}let S=ge(e,this.worldSize);r.O(S,a?this._alignedProjMatrix:this._viewProjMatrix,S);let I={f64:S,f32:new Float32Array(S)};return v.set(g,I),h?I.f32:I.f64}calculateFogMatrix(e){let a=e.key,h=this._fogMatrixCacheF32;if(h.has(a))return h.get(a);let m=ge(e,this.worldSize);return r.O(m,this._fogMatrix,m),h.set(a,new Float32Array(m)),h.get(a)}getConstrained(e,a){a=r.ah(+a,this.minZoom,this.maxZoom);let h={center:new r.S(e.lng,e.lat),zoom:a},m=this._helper._lngRange;if(!this._helper._renderWorldCopies&&m===null){let re=179.9999999999;m=[-re,re]}let g=this.tileSize*r.af(h.zoom),v=0,S=g,I=0,P=g,E=0,D=0,{x:L,y:O}=this.size;if(this._helper._latRange){let re=this._helper._latRange;v=r.U(re[1])*g,S=r.U(re[0])*g,S-v<O&&(E=O/(S-v))}m&&(I=r.aO(r.V(m[0])*g,0,g),P=r.aO(r.V(m[1])*g,0,g),P<I&&(P+=g),P-I<L&&(D=L/(P-I)));let{x:N,y:X}=W(g,e),H,J,ee=Math.max(D||0,E||0);if(ee){let re=new r.P(D?(P+I)/2:N,E?(S+v)/2:X);return h.center=ne(g,re).wrap(),h.zoom+=r.ak(ee),h}if(this._helper._latRange){let re=O/2;X-re<v&&(J=v+re),X+re>S&&(J=S-re)}if(m){let re=(I+P)/2,te=N;this._helper._renderWorldCopies&&(te=r.aO(N,re-g/2,re+g/2));let ae=L/2;te-ae<I&&(H=I+ae),te+ae>P&&(H=P-ae)}if(H!==void 0||J!==void 0){let re=new r.P(H??N,J??X);h.center=ne(g,re).wrap()}return h}calculateCenterFromCameraLngLatAlt(e,a,h,m){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,h,m)}_calculateNearFarZIfNeeded(e,a,h){if(!this._helper.autoCalculateNearFarZ)return;let m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-m*this._helper._pixelPerMeter/Math.cos(a),v=m<0?g:e,S=Math.PI/2+this.pitchInRadians,I=r.ae(this.fov)*(Math.abs(Math.cos(r.ae(this.roll)))*this.height+Math.abs(Math.sin(r.ae(this.roll)))*this.width)/this.height*(.5+h.y/this.height),P=Math.sin(I)*v/Math.sin(r.ah(Math.PI-S-I,.01,Math.PI-.01)),E=he(this),D=Math.atan(E/this._helper.cameraToCenterDistance),L=r.ae(.75),O=D>L?2*D*(.5+h.y/(2*E)):L,N=Math.sin(O)*v/Math.sin(r.ah(Math.PI-S-O,.01,Math.PI-.01)),X=Math.min(P,N);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*X+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,a=W(this.worldSize,this.center),h=a.x,m=a.y;this._helper._pixelPerMeter=r.aj(1,this.center.lat)*this.worldSize;let g=r.ae(Math.min(this.pitch,G)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g)),S;this._calculateNearFarZIfNeeded(v,g,e),S=new Float64Array(16),r.b4(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),r.aq(this._invProjMatrix,S),S[8]=2*-e.x/this._helper._width,S[9]=2*e.y/this._helper._height,this._projectionMatrix=r.b5(S),r.N(S,S,[1,-1,1]),r.M(S,S,[0,0,-this._helper.cameraToCenterDistance]),r.b6(S,S,-this.rollInRadians),r.b7(S,S,this.pitchInRadians),r.b6(S,S,-this.bearingInRadians),r.M(S,S,[-h,-m,0]),this._mercatorMatrix=r.N([],S,[this.worldSize,this.worldSize,this.worldSize]),r.N(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=r.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),r.M(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=r.aq([],S);let I=[0,0,-1,1];r.aw(I,I,this._invViewProjMatrix),this._cameraPosition=[I[0]/I[3],I[1]/I[3],I[2]/I[3]],this._fogMatrix=new Float64Array(16),r.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,r.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),r.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),r.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),r.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),r.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),r.M(this._fogMatrix,this._fogMatrix,[-h,-m,0]),r.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),r.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=r.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);let P=this._helper._width%2/2,E=this._helper._height%2/2,D=Math.cos(this.bearingInRadians),L=Math.sin(-this.bearingInRadians),O=h-Math.round(h)+D*P+L*E,N=m-Math.round(m)+D*E+L*P,X=new Float64Array(S);if(r.M(X,X,[O>.5?O-1:O,N>.5?N-1:N,0]),this._alignedProjMatrix=X,S=r.aq(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new r.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return r.aw(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=r.aj(1,this.center.lat)*this.worldSize;return Te(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,a){let h=r.a1.fromLngLat(e),m=[h.x*this.worldSize,h.y*this.worldSize,a,1];return r.aw(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(e){let{overscaledTileID:a,aligned:h,applyTerrainMatrix:m}=e,g=this._helper.getMercatorTileCoordinates(a),v=a?this.calculatePosMatrix(a,h,!0):null,S;return S=a&&a.terrainRttPosMatrix32f&&m?a.terrainRttPosMatrix32f:v||r.b8(),{mainMatrix:S,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,a,h){return 1}transformLightDirection(e){return r.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,a,h,m){let g=this.calculatePosMatrix(h),v;m?(v=[e,a,m(e,a),1],r.aw(v,v,g)):(v=[e,a,0,1],ss(v,v,g));let S=v[3];return{point:new r.P(v[0]/S,v[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(e){for(let a of e)this.calculatePosMatrix(a)}getMatrixForModel(e,a){let h=r.a1.fromLngLat(e,a),m=h.meterInMercatorCoordinateUnits(),g=r.b9();return r.M(g,g,[h.x,h.y,h.z]),r.b6(g,g,Math.PI),r.b7(g,g,Math.PI/2),r.N(g,g,[-m,m,m]),g}getProjectionDataForCustomLayer(e=!0){let a=new r.Z(0,0,0,0,0),h=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:e}),m=ge(a,this.worldSize);r.O(m,this._viewProjMatrix,m),h.tileMercatorCoords=[0,0,1,1];let g=[r.$,r.$,this.worldSize/this._helper.pixelsPerMeter],v=r.ba();return r.N(v,m,g),h.fallbackMatrix=v,h.mainMatrix=v,h}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Bp(){r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function jn(f){if(f.useSlerp)if(f.k<1){let e=r.bb(f.startEulerAngles.roll,f.startEulerAngles.pitch,f.startEulerAngles.bearing),a=r.bb(f.endEulerAngles.roll,f.endEulerAngles.pitch,f.endEulerAngles.bearing),h=new Float64Array(4);r.bc(h,e,a,f.k);let m=r.bd(h);f.tr.setRoll(m.roll),f.tr.setPitch(m.pitch),f.tr.setBearing(m.bearing)}else f.tr.setRoll(f.endEulerAngles.roll),f.tr.setPitch(f.endEulerAngles.pitch),f.tr.setBearing(f.endEulerAngles.bearing);else f.tr.setRoll(r.C.number(f.startEulerAngles.roll,f.endEulerAngles.roll,f.k)),f.tr.setPitch(r.C.number(f.startEulerAngles.pitch,f.endEulerAngles.pitch,f.k)),f.tr.setBearing(r.C.number(f.startEulerAngles.bearing,f.endEulerAngles.bearing,f.k))}function sr(f,e,a,h,m){let g=m.padding,v=W(m.worldSize,a.getNorthWest()),S=W(m.worldSize,a.getNorthEast()),I=W(m.worldSize,a.getSouthEast()),P=W(m.worldSize,a.getSouthWest()),E=r.ae(-h),D=v.rotate(E),L=S.rotate(E),O=I.rotate(E),N=P.rotate(E),X=new r.P(Math.max(D.x,L.x,N.x,O.x),Math.max(D.y,L.y,N.y,O.y)),H=new r.P(Math.min(D.x,L.x,N.x,O.x),Math.min(D.y,L.y,N.y,O.y)),J=X.sub(H),ee=(m.width-(g.left+g.right+e.left+e.right))/J.x,re=(m.height-(g.top+g.bottom+e.top+e.bottom))/J.y;if(re<0||ee<0)return void Bp();let te=Math.min(r.ak(m.scale*Math.min(ee,re)),f.maxZoom),ae=r.P.convert(f.offset),ue=new r.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(r.ae(h)),ie=ae.add(ue).mult(m.scale/r.af(te));return{center:ne(m.worldSize,v.add(I).div(2).sub(ie)),zoom:te,bearing:h}}class Pn{get useGlobeControls(){return!1}handlePanInertia(e,a){return{easingOffset:e,easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(e,a){e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta),e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta)}handleMapControlsPan(e,a,h){e.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(h,e.around)}cameraForBoxAndBearing(e,a,h,m,g){return sr(e,a,h,m,g)}handleJumpToCenterZoom(e,a){e.zoom!==(a.zoom!==void 0?+a.zoom:e.zoom)&&e.setZoom(+a.zoom),a.center!==void 0&&e.setCenter(r.S.convert(a.center))}handleEaseTo(e,a){let h=e.zoom,m=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},v={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},S=a.zoom!==void 0,I=!e.isPaddingEqual(a.padding),P=!1,E=S?+a.zoom:e.zoom,D=e.centerPoint.add(a.offsetAsPoint),L=e.screenPointToLocation(D),{center:O,zoom:N}=e.getConstrained(r.S.convert(a.center||L),E??h);uc(e,O);let X=W(e.worldSize,L),H=W(e.worldSize,O).sub(X),J=r.af(N-h);return P=N!==h,{easeFunc:ee=>{if(P&&e.setZoom(r.C.number(h,N,ee)),r.be(g,v)||jn({startEulerAngles:g,endEulerAngles:v,tr:e,k:ee,useSlerp:g.roll!=v.roll}),I&&(e.interpolatePadding(m,a.padding,ee),D=e.centerPoint.add(a.offsetAsPoint)),a.around)e.setLocationAtPoint(a.around,a.aroundPoint);else{let re=r.af(e.zoom-h),te=N>h?Math.min(2,J):Math.max(.5,J),ae=Math.pow(te,1-ee),ue=ne(e.worldSize,X.add(H.mult(ee*ae)).mult(re));e.setLocationAtPoint(e.renderWorldCopies?ue.wrap():ue,D)}},isZooming:P,elevationCenter:O}}handleFlyTo(e,a){let h=a.zoom!==void 0,m=e.zoom,g=e.getConstrained(r.S.convert(a.center||a.locationAtOffset),h?+a.zoom:m),v=g.center,S=g.zoom;uc(e,v);let I=W(e.worldSize,a.locationAtOffset),P=W(e.worldSize,v).sub(I),E=P.mag(),D=r.af(S-m),L;if(a.minZoom!==void 0){let O=Math.min(+a.minZoom,m,S),N=e.getConstrained(v,O).zoom;L=r.af(N-m)}return{easeFunc:(O,N,X,H)=>{e.setZoom(O===1?S:m+r.ak(N));let J=O===1?v:ne(e.worldSize,I.add(P.mult(X)).mult(N));e.setLocationAtPoint(e.renderWorldCopies?J.wrap():J,H)},scaleOfZoom:D,targetCenter:v,scaleOfMinZoom:L,pixelPathLength:E}}}class _i{constructor(e,a,h){this.blendFunction=e,this.blendColor=a,this.mask=h}}_i.Replace=[1,0],_i.disabled=new _i(_i.Replace,r.bf.transparent,[!1,!1,!1,!1]),_i.unblended=new _i(_i.Replace,r.bf.transparent,[!0,!0,!0,!0]),_i.alphaBlended=new _i([1,771],r.bf.transparent,[!0,!0,!0,!0]);let Pa=2305;class wt{constructor(e,a,h){this.enable=e,this.mode=a,this.frontFace=h}}wt.disabled=new wt(!1,1029,Pa),wt.backCCW=new wt(!0,1029,Pa),wt.frontCCW=new wt(!0,1028,Pa);class At{constructor(e,a,h){this.func=e,this.mask=a,this.range=h}}At.ReadOnly=!1,At.ReadWrite=!0,At.disabled=new At(519,At.ReadOnly,[0,1]);let Mo=7680;class Kt{constructor(e,a,h,m,g,v){this.test=e,this.ref=a,this.mask=h,this.fail=m,this.depthFail=g,this.pass=v}}Kt.disabled=new Kt({func:519,mask:0},0,0,Mo,Mo,Mo);let lr=new WeakMap;function ao(f){var e;if(lr.has(f))return lr.get(f);{let a=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return lr.set(f,a),a}}class so{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let a=e.context,h=a.gl;this._texFormat=h.RGBA,this._texType=h.UNSIGNED_BYTE;let m=new r.aL;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);let g=new r.aN;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Ia(a.createVertexBuffer(m,ta.members),a.createIndexBuffer(g),r.aM.simpleSegment(0,0,m.length,g.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(h.TEXTURE1);let v=h.createTexture();h.bindTexture(h.TEXTURE_2D,v),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texImage2D(h.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),ao(h)&&(this._pbo=h.createBuffer(),h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.bufferData(h.PIXEL_PACK_BUFFER,4,h.STREAM_READ),h.bindBuffer(h.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,a){let h=this._updateCount;return this._readbackQueue?h>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():h>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,a),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,a=e.gl;e.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,a){let h=this._cachedRenderContext.context,m=h.gl;if(this._bindFramebuffer(),h.viewport.set([0,0,this._texWidth,this._texHeight]),h.clear({color:r.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(h,m.TRIANGLES,At.disabled,Kt.disabled,_i.unblended,wt.disabled,((g,v)=>({u_input:g,u_output_expected:v}))(e,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ao(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);let g=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ao(e)){let a=e.clientWaitSync(this._readbackQueue.sync,0,0);if(a===e.WAIT_FAILED)return r.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=so._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let a=0;return a+=e[0]/256,a+=e[1]/65536,a+=e[2]/16777216,e[3]<127&&(a=-a),a/128}}let pc=r.$/128;function Hu(f,e){let a=f.granularity!==void 0?Math.max(f.granularity,1):1,h=a+(f.generateBorders?2:0),m=a+(f.extendToNorthPole||f.generateBorders?1:0)+(f.extendToSouthPole||f.generateBorders?1:0),g=h+1,v=m+1,S=f.generateBorders?-1:0,I=f.generateBorders||f.extendToNorthPole?-1:0,P=a+(f.generateBorders?1:0),E=a+(f.generateBorders||f.extendToSouthPole?1:0),D=g*v,L=h*m*6,O=g*v>65536;if(O&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let N=O||e==="32bit",X=new Int16Array(2*D),H=0;for(let re=I;re<=E;re++)for(let te=S;te<=P;te++){let ae=te/a*r.$;te===-1&&(ae=-pc),te===a+1&&(ae=r.$+pc);let ue=re/a*r.$;re===-1&&(ue=f.extendToNorthPole?r.bh:-pc),re===a+1&&(ue=f.extendToSouthPole?r.bi:r.$+pc),X[H++]=ae,X[H++]=ue}let J=N?new Uint32Array(L):new Uint16Array(L),ee=0;for(let re=0;re<m;re++)for(let te=0;te<h;te++){let ae=te+1+re*g,ue=te+(re+1)*g,ie=te+1+(re+1)*g;J[ee++]=te+re*g,J[ee++]=ue,J[ee++]=ae,J[ee++]=ae,J[ee++]=ue,J[ee++]=ie}return{vertices:X.buffer.slice(0),indices:J.buffer.slice(0),uses32bitIndices:N}}let ps=new r.aK({fill:new r.bj(128,2),line:new r.bj(512,0),tile:new r.bj(128,32),stencil:new r.bj(128,1),circle:3});class nl{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return zr.projectionGlobe}get vertexShaderPreludeCode(){return zr.projectionMercator.vertexSource}get subdivisionGranularity(){return ps}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new so(e));let a=r.U(this._errorQueryLatitudeDegrees),h=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(a,h),g=U.now();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=g);let v=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=r.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,r.bl(v))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,a,h,m,g){let v=(g==="stencil"?ps.stencil:ps.tile).getGranularityForZoomLevel(a.z);return this._getMesh(e,{granularity:v,generateBorders:h,extendToNorthPole:a.y===0&&m,extendToSouthPole:a.y===(1<<a.z)-1&&m})}_getMesh(e,a){let h=this._getMeshKey(a);if(h in this._tileMeshCache)return this._tileMeshCache[h];let m=(function(g,v){let S=Hu(v,"16bit"),I=r.aL.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),P=r.aN.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new Ia(g.createVertexBuffer(I,ta.members),g.createIndexBuffer(P),r.aM.simpleSegment(0,0,I.length,P.length))})(e,a);return this._tileMeshCache[h]=m,m}recalculate(e){}hasTransition(){let e=U.now(),a=!1;return a=a||(e-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let dc=new r.r({type:new r.D(r.v.projection.type)});class mc extends r.E{constructor(e){super(),this._transitionable=new r.t(dc),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new r.F(0)),this._mercatorProjection=new Ut,this._verticalPerspectiveProjection=new nl}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof r.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,a,h,m,g){return this.currentProjection.getMeshFromTileID(e,a,h,m,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function fc(f){let e=ds(f.worldSize,f.center.lat);return 2*Math.PI*e}function Or(f,e,a,h,m){let g=1/(1<<m),v=e/r.$*g+h*g,S=r.bo((f/r.$*g+a*g)*Math.PI*2+Math.PI,2*Math.PI),I=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,P=Math.cos(I),E=new Float64Array(3);return E[0]=Math.sin(S)*P,E[1]=Math.sin(I),E[2]=Math.cos(S)*P,E}function cn(f){return(function(e,a){let h=Math.cos(a),m=new Float64Array(3);return m[0]=Math.sin(e)*h,m[1]=Math.sin(a),m[2]=Math.cos(e)*h,m})(f.lng*Math.PI/180,f.lat*Math.PI/180)}function ds(f,e){return f/(2*Math.PI)/Math.cos(e*Math.PI/180)}function rl(f){let e=Math.asin(f[1])/Math.PI*180,a=Math.sqrt(f[0]*f[0]+f[2]*f[2]);if(a>1e-6){let h=f[0]/a,m=Math.acos(f[2]/a),g=(h>0?m:-m)/Math.PI*180;return new r.S(r.aO(g,-180,180),e)}return new r.S(0,e)}function Ma(f){return Math.cos(f*Math.PI/180)}function zi(f,e){let a=Ma(f),h=Ma(e);return r.ak(h/a)}function jp(f,e){let a=f.rotate(e.bearingInRadians),h=e.zoom+zi(e.center.lat,0),m=r.bk(1/Ma(e.center.lat),1/Ma(Math.min(Math.abs(e.center.lat),60)),r.bn(h,7,3,0,1)),g=360/fc({worldSize:e.worldSize,center:{lat:e.center.lat}});return new r.S(e.center.lng-a.x*g*m,r.ah(e.center.lat+a.y*g,-r.ai,r.ai))}function ol(f){let e=.5*f,a=Math.sin(e),h=Math.cos(e);return Math.log(a+h)-Math.log(h-a)}function Ku(f,e,a,h){let m=f.lat+a*h;if(Math.abs(a)>1){let g=(Math.sign(f.lat+a)!==Math.sign(f.lat)?-Math.abs(f.lat):Math.abs(f.lat))*Math.PI/180,v=Math.abs(f.lat+a)*Math.PI/180,S=ol(g+h*(v-g)),I=ol(g),P=ol(v);return new r.S(f.lng+e*((S-I)/(P-I)),m)}return new r.S(f.lng+e*h,m)}class kf{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,a,h,m){let g=`${e.z}_${e.x}_${e.y}_${m?.terrain?"t":""}`,v=this._cache.get(g);if(v)return v;let S=this._cachePrevious.get(g);if(S)return this._cache.set(g,S),S;let I=this._boundingVolumeFactory(e,a,h,m);return this._cache.set(g,I),this._hadAnyChanges=!0,I}}class ms{constructor(e,a,h,m){this.min=h,this.max=m,this.points=e,this.planes=a}static fromAabb(e,a){let h=[];for(let m=0;m<8;m++)h.push([1&~m?e[0]:a[0],(m>>1&1)==1?a[1]:e[1],(m>>2&1)==1?a[2]:e[2]]);return new ms(h,[[-1,0,0,a[0]],[1,0,0,-e[0]],[0,-1,0,a[1]],[0,1,0,-e[1]],[0,0,-1,a[2]],[0,0,1,-e[2]]],e,a)}static fromCenterSizeAngles(e,a,h){let m=r.br([],h[0],h[1],h[2]),g=r.bs([],[a[0],0,0],m),v=r.bs([],[0,a[1],0],m),S=r.bs([],[0,0,a[2]],m),I=[...e],P=[...e];for(let D=0;D<8;D++)for(let L=0;L<3;L++){let O=e[L]+g[L]*(1&~D?-1:1)+v[L]*((D>>1&1)==1?1:-1)+S[L]*((D>>2&1)==1?1:-1);I[L]=Math.min(I[L],O),P[L]=Math.max(P[L],O)}let E=[];for(let D=0;D<8;D++){let L=[...e];r.aS(L,L,r.aR([],g,1&~D?-1:1)),r.aS(L,L,r.aR([],v,(D>>1&1)==1?1:-1)),r.aS(L,L,r.aR([],S,(D>>2&1)==1?1:-1)),E.push(L)}return new ms(E,[[...g,-r.aX(g,E[0])],[...v,-r.aX(v,E[0])],[...S,-r.aX(S,E[0])],[-g[0],-g[1],-g[2],-r.aX(g,E[7])],[-v[0],-v[1],-v[2],-r.aX(v,E[7])],[-S[0],-S[1],-S[2],-r.aX(S,E[7])]],I,P)}intersectsFrustum(e){let a=!0,h=this.points.length,m=this.planes.length,g=e.planes.length,v=e.points.length;for(let S=0;S<g;S++){let I=e.planes[S],P=0;for(let E=0;E<h;E++){let D=this.points[E];I[0]*D[0]+I[1]*D[1]+I[2]*D[2]+I[3]>=0&&P++}if(P===0)return 0;P<h&&(a=!1)}if(a)return 2;for(let S=0;S<m;S++){let I=this.planes[S],P=0;for(let E=0;E<v;E++){let D=e.points[E];I[0]*D[0]+I[1]*D[1]+I[2]*D[2]+I[3]>=0&&P++}if(P===0)return 0}return 1}intersectsPlane(e){let a=this.points.length,h=0;for(let m=0;m<a;m++){let g=this.points[m];e[0]*g[0]+e[1]*g[1]+e[2]*g[2]+e[3]>=0&&h++}return h===a?2:h===0?0:1}}function vn(f,e,a){let h=f-e;return h<0?-h:Math.max(0,h-a)}function al(f,e,a,h,m){let g=f-a,v;return v=g<0?Math.min(-g,1+g-m):g>1?Math.min(Math.max(g-m,0),1-g):0,Math.max(v,vn(e,h,m))}class lo{constructor(){this._boundingVolumeCache=new kf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,a,h,m){let g=1<<h.z,v=1/g,S=h.x/g,I=h.y/g,P=2;return P=Math.min(P,al(e,a,S,I,v)),P=Math.min(P,al(e,a,S+.5,-I-v,v)),P=Math.min(P,al(e,a,S+.5,2-I-v,v)),P}getWrap(e,a,h){let m=1<<a.z,g=1/m,v=a.x/m,S=vn(e.x,v,g),I=vn(e.x,v-1,g),P=vn(e.x,v+1,g),E=Math.min(S,I,P);return E===P?1:E===I?-1:0}allowVariableZoom(e,a){return ct(e,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,a,h,m){return this._boundingVolumeCache.getTileBoundingVolume(e,a,h,m)}_computeTileBoundingVolume(e,a,h,m){var g,v;let S=0,I=0;if(m?.terrain){let P=new r.Z(e.z,a,e.z,e.x,e.y),E=m.terrain.getMinMaxElevation(P);S=(g=E.minElevation)!==null&&g!==void 0?g:Math.min(0,h),I=(v=E.maxElevation)!==null&&v!==void 0?v:Math.max(0,h)}if(S/=r.bu,I/=r.bu,S+=1,I+=1,e.z<=0)return ms.fromAabb([-I,-I,-I],[I,I,I]);if(e.z===1)return ms.fromAabb([e.x===0?-I:0,e.y===0?0:-I,-I],[e.x===0?0:I,e.y===0?I:0,I]);{let P=[Or(0,0,e.x,e.y,e.z),Or(r.$,0,e.x,e.y,e.z),Or(r.$,r.$,e.x,e.y,e.z),Or(0,r.$,e.x,e.y,e.z)],E=[];for(let Se of P)E.push(r.aR([],Se,I));if(I!==S)for(let Se of P)E.push(r.aR([],Se,S));e.y===0&&E.push([0,1,0]),e.y===(1<<e.z)-1&&E.push([0,-1,0]);let D=[1,1,1],L=[-1,-1,-1];for(let Se of E)for(let Pe=0;Pe<3;Pe++)D[Pe]=Math.min(D[Pe],Se[Pe]),L[Pe]=Math.max(L[Pe],Se[Pe]);let O=Or(r.$/2,r.$/2,e.x,e.y,e.z),N=r.aW([],[0,1,0],O);r.aV(N,N);let X=r.aW([],O,N);r.aV(X,X);let H=r.aW([],P[2],P[1]);r.aV(H,H);let J=r.aW([],P[0],P[3]);r.aV(J,J),E.push(r.aR([],O,I)),e.y>=(1<<e.z)/2&&E.push(r.aR([],Or(r.$/2,0,e.x,e.y,e.z),I)),e.y<(1<<e.z)/2&&E.push(r.aR([],Or(r.$/2,r.$,e.x,e.y,e.z),I));let ee=sl(O,E),re=sl(X,E),te=[-O[0],-O[1],-O[2],ee.max],ae=[O[0],O[1],O[2],-ee.min],ue=[-X[0],-X[1],-X[2],re.max],ie=[X[0],X[1],X[2],-re.min],_e=[...H,0],Me=[...J,0],we=[];return e.y===0?we.push(r.bt(Me,_e,te),r.bt(Me,_e,ae)):we.push(r.bt(ue,_e,te),r.bt(ue,_e,ae),r.bt(ue,Me,te),r.bt(ue,Me,ae)),e.y===(1<<e.z)-1?we.push(r.bt(Me,_e,te),r.bt(Me,_e,ae)):we.push(r.bt(ie,_e,te),r.bt(ie,_e,ae),r.bt(ie,Me,te),r.bt(ie,Me,ae)),new ms(we,[te,ae,ue,ie,_e,Me],D,L)}}}function sl(f,e){let a=1/0,h=-1/0;for(let m of e){let g=r.aX(f,m);a=Math.min(a,g),h=Math.max(h,g)}return{min:a,max:h}}class ll{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,h){return this._helper.interpolatePadding(e,a,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a){this._helper.resize(e,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=r.bv(),this._projectionMatrix=r.b9(),this._globeViewProjMatrix32f=r.b8(),this._globeViewProjMatrixNoCorrection=r.b9(),this._globeViewProjMatrixNoCorrectionInverted=r.b9(),this._globeProjMatrixInverted=r.b9(),this._cameraPosition=r.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Fn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,a)=>this.getConstrained(e,a)}),this._coveringTilesDetailsProvider=new lo}clone(){let e=new ll;return e.apply(this),e}apply(e,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=r.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:a,applyGlobeMatrix:h}=e,m=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:h?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let a=this.pitchInRadians,h=this.cameraToCenterDistance/e,m=Math.sin(a)*h,g=Math.cos(a)*h+1,v=1/Math.sqrt(m*m+g*g)*1,S=-m,I=g,P=Math.sqrt(S*S+I*I);S/=P,I/=P;let E=[0,S,I];r.bw(E,E,[0,0,0],-this.bearingInRadians),r.bx(E,E,[0,0,0],-1*this.center.lat*Math.PI/180),r.by(E,E,[0,0,0],this.center.lng*Math.PI/180);let D=1/r.aZ(E);return r.aR(E,E,D),[...E,-v*D]}isLocationOccluded(e){return!this.isSurfacePointVisible(cn(e))}transformLightDirection(e){let a=this._helper._center.lng*Math.PI/180,h=this._helper._center.lat*Math.PI/180,m=Math.cos(h),g=[Math.sin(a)*m,Math.sin(h),Math.cos(a)*m],v=[g[2],0,-g[0]],S=[0,0,0];r.aW(S,v,g),r.aV(v,v),r.aV(S,S);let I=[0,0,0];return r.aV(I,[v[0]*e[0]+S[0]*e[1]+g[0]*e[2],v[1]*e[0]+S[1]*e[1]+g[1]*e[2],v[2]*e[0]+S[2]*e[1]+g[2]*e[2]]),I}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,a,h){let m=(function(S,I,P){let E=1/(1<<P.z);return new r.a1(S/r.$*E+P.x*E,I/r.$*E+P.y*E)})(e,a,h.canonical),g=(v=m.y,[r.bo(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,a,h,m){let g=h.canonical,v=Or(e,a,g.x,g.y,g.z),S=1+(m?m(e,a):0)/r.bu,I=[v[0]*S,v[1]*S,v[2]*S,1];r.aw(I,I,this._globeViewProjMatrixNoCorrection);let P=this._cachedClippingPlane,E=P[0]*v[0]+P[1]*v[1]+P[2]*v[2]+P[3]<0;return{point:new r.P(I[0]/I[3],I[1]/I[3]),signedDistanceFromCamera:I[3],isOccluded:E}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=ds(this.worldSize,this.center.lat),a=r.ba(),h=r.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),r.b4(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let m=this.centerOffset;a[8]=2*-m.x/this._helper._width,a[9]=2*m.y/this._helper._height,this._projectionMatrix=r.b5(a),this._globeProjMatrixInverted=r.ba(),r.aq(this._globeProjMatrixInverted,a),r.M(a,a,[0,0,-this.cameraToCenterDistance]),r.b6(a,a,this.rollInRadians),r.b7(a,a,-this.pitchInRadians),r.b6(a,a,this.bearingInRadians),r.M(a,a,[0,0,-e]);let g=r.bp();g[0]=e,g[1]=e,g[2]=e,r.b7(h,a,this.center.lat*Math.PI/180),r.bz(h,h,-this.center.lng*Math.PI/180),r.N(h,h,g),this._globeViewProjMatrixNoCorrection=h,r.b7(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),r.bz(a,a,-this.center.lng*Math.PI/180),r.N(a,a,g),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=r.ba(),r.aq(this._globeViewProjMatrixNoCorrectionInverted,h);let v=r.bp();this._cameraPosition=r.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,r.bw(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),r.bx(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),r.bw(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),r.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),r.bx(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),r.by(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let S=r.b5(this._globeViewProjMatrixNoCorrectionInverted);r.N(S,S,[1,1,-1]),this._cachedFrustum=Zi.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){r.w("calculateFogMatrix is not supported on globe projection.");let a=r.ba();return r.ag(a),a}getVisibleUnwrappedCoordinates(e){return[new r.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&r.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){if(!this._globeViewProjMatrixNoCorrection)return 1;let h=cn(e);r.aR(h,h,1+a/r.bu);let m=r.bv();return r.aw(m,[h[0],h[1],h[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(e){}getBounds(){let e=.5*this.width,a=.5*this.height,h=[new r.P(0,0),new r.P(e,0),new r.P(this.width,0),new r.P(this.width,a),new r.P(this.width,this.height),new r.P(e,this.height),new r.P(0,this.height),new r.P(0,a)],m=[];for(let D of h)m.push(this.unprojectScreenPoint(D));let g=0,v=0,S=0,I=0,P=this.center;for(let D of m){let L=r.bA(P.lng,D.lng),O=r.bA(P.lat,D.lat);L<v&&(v=L),L>g&&(g=L),O<I&&(I=O),O>S&&(S=O)}let E=[P.lng+v,P.lat+I,P.lng+g,P.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(E[3]=90,E[0]=-180,E[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(E[1]=-90,E[0]=-180,E[2]=180),new Di(E)}getConstrained(e,a){let h=r.ah(e.lat,-r.ai,r.ai),m=r.ah(+a,this.minZoom+zi(0,h),this.maxZoom);return{center:new r.S(e.lng,h),zoom:m}}calculateCenterFromCameraLngLatAlt(e,a,h,m){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,h,m)}setLocationAtPoint(e,a){let h=cn(this.unprojectScreenPoint(a)),m=cn(e),g=r.bp();r.bB(g);let v=r.bp();r.by(v,h,g,-this.center.lng*Math.PI/180),r.bx(v,v,g,this.center.lat*Math.PI/180);let S=m[0]*m[0]+m[2]*m[2],I=v[0]*v[0];if(S<I)return;let P=Math.sqrt(S-I),E=-P,D=r.bC(m[0],m[2],v[0],P),L=r.bC(m[0],m[2],v[0],E),O=r.bp();r.by(O,m,g,-D);let N=r.bC(O[1],O[2],v[1],v[2]),X=r.bp();r.by(X,m,g,-L);let H=r.bC(X[1],X[2],v[1],v[2]),J=.5*Math.PI,ee=N>=-J&&N<=J,re=H>=-J&&H<=J,te,ae;if(ee&&re){let Me=this.center.lng*Math.PI/180,we=this.center.lat*Math.PI/180;r.bD(D,Me)+r.bD(N,we)<r.bD(L,Me)+r.bD(H,we)?(te=D,ae=N):(te=L,ae=H)}else if(ee)te=D,ae=N;else{if(!re)return;te=L,ae=H}let ue=te/Math.PI*180,ie=ae/Math.PI*180,_e=this.center.lat;this.setCenter(new r.S(ue,r.ah(ie,-90,90))),this.setZoom(this.zoom+zi(_e,this.center.lat))}locationToScreenPoint(e,a){let h=cn(e);if(a){let m=a.getElevationForLngLatZoom(e,this._helper._tileZoom);r.aR(h,h,1+m/r.bu)}return this._projectSurfacePointToScreen(h)}_projectSurfacePointToScreen(e){let a=r.bv();return r.aw(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new r.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,a){if(a){let h=a.pointCoordinate(e);if(h)return h}return r.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,a){var h;return(h=this.screenPointToMercatorCoordinate(e,a))===null||h===void 0?void 0:h.toLngLat()}isPointOnMapSurface(e,a){let h=this._cameraPosition,m=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(h,m)}getRayDirectionFromPixel(e){let a=r.bv();a[0]=e.x/this.width*2-1,a[1]=-1*(e.y/this.height*2-1),a[2]=1,a[3]=1,r.aw(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];let h=r.bp();h[0]=a[0]-this._cameraPosition[0],h[1]=a[1]-this._cameraPosition[1],h[2]=a[2]-this._cameraPosition[2];let m=r.bp();return r.aV(m,h),m}isSurfacePointVisible(e){let a=this._cachedClippingPlane;return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let a=r.bv();return r.aw(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(e,a){let h=r.aX(e,a),m=r.bp(),g=r.bp();r.aR(g,a,h),r.aU(m,e,g);let v=1-r.aX(m,m);if(v<0)return null;let S=r.aX(e,e)-1,I=-h+(h<0?1:-1)*Math.sqrt(v),P=S/I,E=I;return{tMin:Math.min(P,E),tMax:Math.max(P,E)}}unprojectScreenPoint(e){let a=this._cameraPosition,h=this.getRayDirectionFromPixel(e),m=this.rayPlanetIntersection(a,h);if(m){let E=r.bp();r.aS(E,a,[h[0]*m.tMin,h[1]*m.tMin,h[2]*m.tMin]);let D=r.bp();return r.aV(D,E),rl(D)}let g=this._cachedClippingPlane,v=g[0]*h[0]+g[1]*h[1]+g[2]*h[2],S=-r.b1(g,a)/v,I=r.bp();if(S>0)r.aS(I,a,[h[0]*S,h[1]*S,h[2]*S]);else{let E=r.bp();r.aS(E,a,[2*h[0],2*h[1],2*h[2]]);let D=r.b1(this._cachedClippingPlane,E);r.aU(I,E,[this._cachedClippingPlane[0]*D,this._cachedClippingPlane[1]*D,this._cachedClippingPlane[2]*D])}let P=(function(E){let D=r.bp();return D[0]=E[0]*-E[3],D[1]=E[1]*-E[3],D[2]=E[2]*-E[3],{center:D,radius:Math.sqrt(1-E[3]*E[3])}})(g);return rl((function(E,D,L){let O=r.bp();r.aU(O,L,E);let N=r.bp();return r.bq(N,E,O,D/r.a$(O)),N})(P.center,P.radius,I))}getMatrixForModel(e,a){let h=r.S.convert(e),m=1/r.bu,g=r.b9();return r.bz(g,g,h.lng/180*Math.PI),r.b7(g,g,-h.lat/180*Math.PI),r.M(g,g,[0,0,1+a/r.bu]),r.b7(g,g,.5*Math.PI),r.N(g,g,[m,m,m]),g}getProjectionDataForCustomLayer(e=!0){let a=this.getProjectionData({overscaledTileID:new r.Z(0,0,0,0,0),applyGlobeMatrix:e});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(e){}}class cl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,h){return this._helper.interpolatePadding(e,a,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,h=!0){this._helper.resize(e,a,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,a){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Fn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,a)=>this.getConstrained(e,a)}),this._globeness=1,this._mercatorTransform=new hi,this._verticalPerspectiveTransform=new ll}clone(){let e=new cl;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let a=this._mercatorTransform.getProjectionData(e),h=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?h.mainMatrix:a.mainMatrix,clippingPlane:h.clippingPlane,tileMercatorCoords:h.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return r.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return r.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,a,h){let m=this._mercatorTransform.getPitchedTextCorrection(e,a,h),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,a,h);return r.bk(m,g,this._globeness)}projectTileCoordinates(e,a,h,m){return this.currentTransform.projectTileCoordinates(e,a,h,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){return this.currentTransform.lngLatToCameraDepth(e,a)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,a){return this.currentTransform.getConstrained(e,a)}calculateCenterFromCameraLngLatAlt(e,a,h,m){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,h,m)}setLocationAtPoint(e,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,a){return this.currentTransform.locationToScreenPoint(e,a)}screenPointToMercatorCoordinate(e,a){return this.currentTransform.screenPointToMercatorCoordinate(e,a)}screenPointToLocation(e,a){return this.currentTransform.screenPointToLocation(e,a)}isPointOnMapSurface(e,a){return this.currentTransform.isPointOnMapSurface(e,a)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,a){return this.currentTransform.getMatrixForModel(e,a)}getProjectionDataForCustomLayer(e=!0){let a=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return a;let h=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return h.fallbackMatrix=a.mainMatrix,h}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Mn{get useGlobeControls(){return!0}handlePanInertia(e,a){let h=jp(e,a);return Math.abs(h.lng-a.center.lng)>180&&(h.lng=a.center.lng+179.5*Math.sign(h.lng-a.center.lng)),{easingCenter:h,easingOffset:new r.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,a){let h=e.around,m=a.screenPointToLocation(h);e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta);let g=a.zoom;e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta);let v=a.zoom-g;if(v===0)return;let S=r.bA(a.center.lng,m.lng),I=S/(Math.abs(S/180)+1),P=r.bA(a.center.lat,m.lat),E=a.getRayDirectionFromPixel(h),D=a.cameraPosition,L=-1*r.aX(D,E),O=r.bp();r.aS(O,D,[E[0]*L,E[1]*L,E[2]*L]);let N=r.aZ(O)-1,X=Math.exp(.5*-Math.max(N-.3,0)),H=ds(a.worldSize,a.center.lat)/Math.min(a.width,a.height),J=r.bn(H,.9,.5,1,.25),ee=(1-r.af(-v))*Math.min(X,J),re=a.center.lat,te=a.zoom,ae=new r.S(a.center.lng+I*ee,r.ah(a.center.lat+P*ee,-r.ai,r.ai));a.setLocationAtPoint(m,h);let ue=a.center,ie=r.bn(Math.abs(S),45,85,0,1),_e=r.bn(H,.75,.35,0,1),Me=Math.pow(Math.max(ie,_e),.25),we=r.bA(ue.lng,ae.lng),Se=r.bA(ue.lat,ae.lat);a.setCenter(new r.S(ue.lng+we*Me,ue.lat+Se*Me).wrap()),a.setZoom(te+zi(re,a.center.lat))}handleMapControlsPan(e,a,h){if(!e.panDelta)return;let m=a.center.lat,g=a.zoom;a.setCenter(jp(e.panDelta,a).wrap()),a.setZoom(g+zi(m,a.center.lat))}cameraForBoxAndBearing(e,a,h,m,g){let v=sr(e,a,h,m,g),S=a.left/g.width*2-1,I=(g.width-a.right)/g.width*2-1,P=a.top/g.height*-2+1,E=(g.height-a.bottom)/g.height*-2+1,D=r.bA(h.getWest(),h.getEast())<0,L=D?h.getEast():h.getWest(),O=D?h.getWest():h.getEast(),N=Math.max(h.getNorth(),h.getSouth()),X=Math.min(h.getNorth(),h.getSouth()),H=L+.5*r.bA(L,O),J=N+.5*r.bA(N,X),ee=g.clone();ee.setCenter(v.center),ee.setBearing(v.bearing),ee.setPitch(0),ee.setRoll(0),ee.setZoom(v.zoom);let re=ee.modelViewProjectionMatrix,te=[cn(h.getNorthWest()),cn(h.getNorthEast()),cn(h.getSouthWest()),cn(h.getSouthEast()),cn(new r.S(O,J)),cn(new r.S(L,J)),cn(new r.S(H,N)),cn(new r.S(H,X))],ae=cn(v.center),ue=Number.POSITIVE_INFINITY;for(let ie of te)S<0&&(ue=Mn.getLesserNonNegativeNonNull(ue,Mn.solveVectorScale(ie,ae,re,"x",S))),I>0&&(ue=Mn.getLesserNonNegativeNonNull(ue,Mn.solveVectorScale(ie,ae,re,"x",I))),P>0&&(ue=Mn.getLesserNonNegativeNonNull(ue,Mn.solveVectorScale(ie,ae,re,"y",P))),E<0&&(ue=Mn.getLesserNonNegativeNonNull(ue,Mn.solveVectorScale(ie,ae,re,"y",E)));if(Number.isFinite(ue)&&ue!==0)return v.zoom=ee.zoom+r.ak(ue),v;Bp()}handleJumpToCenterZoom(e,a){let h=e.center.lat,m=e.getConstrained(a.center?r.S.convert(a.center):e.center,e.zoom).center;e.setCenter(m.wrap());let g=a.zoom!==void 0?+a.zoom:e.zoom+zi(h,m.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,a){let h=e.zoom,m=e.center,g=e.padding,v={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},I=a.zoom!==void 0,P=!e.isPaddingEqual(a.padding),E=!1,D=a.center?r.S.convert(a.center):m,L=e.getConstrained(D,h).center;uc(e,L);let O=e.clone();O.setCenter(L),O.setZoom(I?+a.zoom:h+zi(m.lat,D.lat)),O.setBearing(a.bearing);let N=new r.P(r.ah(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),r.ah(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));O.setLocationAtPoint(L,N);let X=(a.offset&&a.offsetAsPoint.mag())>0?O.center:L,H=I?+a.zoom:h+zi(m.lat,X.lat),J=h+zi(m.lat,0),ee=H+zi(X.lat,0),re=r.bA(m.lng,X.lng),te=r.bA(m.lat,X.lat),ae=r.af(ee-J);return E=H!==h,{easeFunc:ue=>{if(r.be(v,S)||jn({startEulerAngles:v,endEulerAngles:S,tr:e,k:ue,useSlerp:v.roll!=S.roll}),P&&e.interpolatePadding(g,a.padding,ue),a.around)r.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(a.around,a.aroundPoint);else{let ie=ee>J?Math.min(2,ae):Math.max(.5,ae),_e=Math.pow(ie,1-ue),Me=Ku(m,re,te,ue*_e);e.setCenter(Me.wrap())}if(E){let ie=r.C.number(J,ee,ue)+zi(0,e.center.lat);e.setZoom(ie)}},isZooming:E,elevationCenter:X}}handleFlyTo(e,a){let h=a.zoom!==void 0,m=e.center,g=e.zoom,v=e.padding,S=!e.isPaddingEqual(a.padding),I=e.getConstrained(r.S.convert(a.center||a.locationAtOffset),g).center,P=h?+a.zoom:e.zoom+zi(e.center.lat,I.lat),E=e.clone();E.setCenter(I),E.setZoom(P),E.setBearing(a.bearing);let D=new r.P(r.ah(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),r.ah(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));E.setLocationAtPoint(I,D);let L=E.center;uc(e,L);let O=(function(te,ae,ue){let ie=cn(ae),_e=cn(ue),Me=r.aX(ie,_e),we=Math.acos(Me),Se=fc(te);return we/(2*Math.PI)*Se})(e,m,L),N=g+zi(m.lat,0),X=P+zi(L.lat,0),H=r.af(X-N),J;if(typeof a.minZoom=="number"){let te=+a.minZoom+zi(L.lat,0),ae=Math.min(te,N,X)+zi(0,L.lat),ue=e.getConstrained(L,ae).zoom+zi(L.lat,0);J=r.af(ue-N)}let ee=r.bA(m.lng,L.lng),re=r.bA(m.lat,L.lat);return{easeFunc:(te,ae,ue,ie)=>{let _e=Ku(m,ee,re,ue);S&&e.interpolatePadding(v,a.padding,te);let Me=te===1?L:_e;e.setCenter(Me.wrap());let we=N+r.ak(ae);e.setZoom(te===1?P:we+zi(0,Me.lat))},scaleOfZoom:H,targetCenter:L,scaleOfMinZoom:J,pixelPathLength:O}}static solveVectorScale(e,a,h,m,g){let v=m==="x"?[h[0],h[4],h[8],h[12]]:[h[1],h[5],h[9],h[13]],S=[h[3],h[7],h[11],h[15]],I=e[0]*v[0]+e[1]*v[1]+e[2]*v[2],P=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],E=a[0]*v[0]+a[1]*v[1]+a[2]*v[2],D=a[0]*S[0]+a[1]*S[1]+a[2]*S[2];return E+g*P===I+g*D||S[3]*(I-E)+v[3]*(D-P)+I*D==E*P?null:(E+v[3]-g*D-g*S[3])/(E-I-g*D+g*P)}static getLesserNonNegativeNonNull(e,a){return a!==null&&a>=0&&a<e?a:e}}class Up{constructor(e){this._globe=e,this._mercatorCameraHelper=new Pn,this._verticalPerspectiveCameraHelper=new Mn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,a){return this.currentHelper.handlePanInertia(e,a)}handleMapControlsRollPitchBearingZoom(e,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,a)}handleMapControlsPan(e,a,h){this.currentHelper.handleMapControlsPan(e,a,h)}cameraForBoxAndBearing(e,a,h,m,g){return this.currentHelper.cameraForBoxAndBearing(e,a,h,m,g)}handleJumpToCenterZoom(e,a){this.currentHelper.handleJumpToCenterZoom(e,a)}handleEaseTo(e,a){return this.currentHelper.handleEaseTo(e,a)}handleFlyTo(e,a){return this.currentHelper.handleFlyTo(e,a)}}let gc=(f,e)=>r.y(f,e&&e.filter(a=>a.identifier!=="source.canvas")),Lf=r.bE();class Xu extends r.E{constructor(e,a={}){super(),this._rtlPluginLoaded=()=>{for(let h in this.sourceCaches){let m=this.sourceCaches[h].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[h].reload()}},this.map=e,this.dispatcher=new Kn(xa(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(h,m)=>this.getGlyphs(h,m)),this.dispatcher.registerMessageHandler("GI",(h,m)=>this.getImages(h,m)),this.imageManager=new Ui,this.imageManager.setEventedParent(this),this.glyphManager=new Hn(e._requestManager,a.localIdeographFontFamily),this.lineAtlas=new ri(256,512),this.crossTileSymbolIndex=new hs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new r.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",r.bG()),Ko().on(wa,this._rtlPluginLoaded),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;let m=this.sourceCaches[h.sourceId];if(!m)return;let g=m.getSource();if(g&&g.vectorLayerIds)for(let v in this._layers){let S=this._layers[v];S.source===g.id&&this._validateLayer(S)}})}setGlobalStateProperty(e,a){var h,m,g;this._checkLoaded();let v=a===null?(g=(m=(h=this.stylesheet.state)===null||h===void 0?void 0:h[e])===null||m===void 0?void 0:m.default)!==null&&g!==void 0?g:null:a;if(r.bH(v,this._globalState[e]))return this;this._globalState[e]=v;let S=this._findGlobalStateAffectedSources([e]);for(let I in this.sourceCaches)S.has(I)&&(this._reloadSource(I),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();let a=[];for(let m in e)!r.bH(this._globalState[m],e[m].default)&&(a.push(m),this._globalState[m]=e[m].default);let h=this._findGlobalStateAffectedSources(a);for(let m in this.sourceCaches)h.has(m)&&(this._reloadSource(m),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;let a=new Set;for(let h in this._layers){let m=this._layers[h],g=m.getLayoutAffectingGlobalStateRefs();for(let v of e)g.has(v)&&a.add(m.source)}return a}loadURL(e,a={},h){this.fire(new r.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;let m=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let g=this._loadStyleRequest;r.j(m,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,a,h)}).catch(v=>{this._loadStyleRequest=null,v&&!g.signal.aborted&&this.fire(new r.k(v))})}loadJSON(e,a={},h){this.fire(new r.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,U.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,h)}).catch(()=>{})}loadEmpty(){this.fire(new r.l("dataloading",{dataType:"style"})),this._load(Lf,{validate:!1})}_load(e,a,h){var m,g,v;let S=a.transformStyle?a.transformStyle(h,e):e;if(!a.validate||!gc(this,r.z(S))){this._loaded=!0,this.stylesheet=S;for(let I in S.sources)this.addSource(I,S.sources[I],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new kr(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new es(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.setGlobalState((v=this.stylesheet.state)!==null&&v!==void 0?v:null),this.fire(new r.l("data",{dataType:"style"})),this.fire(new r.l("style.load"))}}_createLayers(){let e=r.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(a=>a.id),this._layers={},this._serializedLayers=null;for(let a of e){let h=r.bJ(a);h.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=h}}_loadSprite(e,a=!1,h=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(g,v,S,I){return r._(this,void 0,void 0,function*(){let P=je(g),E=S>1?"@2x":"",D={},L={};for(let{id:O,url:N}of P){let X=v.transformRequest(ht(N,E,".json"),"SpriteJSON");D[O]=r.j(X,I);let H=v.transformRequest(ht(N,E,".png"),"SpriteImage");L[O]=$e.getImage(H,I)}return yield Promise.all([...Object.values(D),...Object.values(L)]),(function(O,N){return r._(this,void 0,void 0,function*(){let X={};for(let H in O){X[H]={};let J=U.getImageCanvasContext((yield N[H]).data),ee=(yield O[H]).data;for(let re in ee){let{width:te,height:ae,x:ue,y:ie,sdf:_e,pixelRatio:Me,stretchX:we,stretchY:Se,content:Pe,textFitWidth:Ve,textFitHeight:We}=ee[re];X[H][re]={data:null,pixelRatio:Me,sdf:_e,stretchX:we,stretchY:Se,content:Pe,textFitWidth:Ve,textFitHeight:We,spriteData:{width:te,height:ae,x:ue,y:ie,context:J}}}}return X})})(D,L)})})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(g=>{if(this._spriteRequest=null,g)for(let v in g){this._spritesImagesIds[v]=[];let S=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(I=>!(I in g)):[];for(let I of S)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(let I in g[v]){let P=v==="default"?I:`${v}:${I}`;this._spritesImagesIds[v].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,g[v][I],!1):this.imageManager.addImage(P,g[v][I]),a&&(this._changedImages[P]=!0)}}}).catch(g=>{this._spriteRequest=null,m=g,this.fire(new r.k(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new r.l("data",{dataType:"style"})),h&&h(m)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new r.l("data",{dataType:"style"}))}_validateLayer(e){let a=this.sourceCaches[e.source];if(!a)return;let h=e.sourceLayer;if(!h)return;let m=a.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(h)===-1)&&this.fire(new r.k(new Error(`Source layer "${h}" does not exist on source "${m.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){let h=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?r.bK(h):h);let m=[];for(let g of e)if(h[g]){let v=a?r.bK(h[g]):h[g];m.push(v)}return m}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let a=Object.keys(this._layers);for(let h of a){let m=this._layers[h];m.type!=="custom"&&(e[h]=m.serialize())}return e}hasTransitions(){var e,a,h;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((h=this.projection)===null||h===void 0)&&h.hasTransition())return!0;for(let m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(let m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let a=this._changed;if(a){let m=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(m.length||g.length)&&this._updateWorkerLayers(m,g);for(let v in this._updatedSources){let S=this._updatedSources[v];if(S==="reload")this._reloadSource(v);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let h={};for(let m in this.sourceCaches){let g=this.sourceCaches[m];h[m]=g.used,g.used=!1}for(let m of this._order){let g=this._layers[m];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(let m in h){let g=this.sourceCaches[m];!!h[m]!=!!g.used&&g.fire(new r.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,a&&this.fire(new r.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var h;this._checkLoaded();let m=this.serialize();if(e=a.transformStyle?a.transformStyle(m,e):e,((h=a.validate)===null||h===void 0||h)&&gc(this,r.z(e)))return!1;(e=r.bK(e)).layers=r.bI(e.layers);let g=r.bL(m,e),v=this._getOperationsToPerform(g);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(let S of v.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let a=[],h=[];for(let m of e)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":a.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":a.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setSky":a.push(()=>this.setSky.apply(this,m.args));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setGlobalState":a.push(()=>this.setGlobalState.apply(this,m.args));break;case"setTransition":a.push(()=>{});break;default:h.push(m.command)}return{operations:a,unimplemented:h}}addImage(e,a){if(this.getImage(e))return this.fire(new r.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new r.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new r.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,h={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(r.z.source,`sources.${e}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let m=this.sourceCaches[e]=new Ft(e,a,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:e})),m.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let h in this._layers)if(this._layers[h].source===e)return this.fire(new r.k(new Error(`Source "${e}" cannot be removed while layer "${h}" is using it.`)));let a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new r.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let h=this.sourceCaches[e].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,h={}){this._checkLoaded();let m=e.id;if(this.getLayer(m))return void this.fire(new r.k(new Error(`Layer "${m}" already exists on this map.`)));let g;if(e.type==="custom"){if(gc(this,r.bM(e)))return;g=r.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(m,e.source),e=r.bK(e),e=r.e(e,{source:m})),this._validate(r.z.layer,`layers.${m}`,e,{arrayIndex:-1},h))return;g=r.bJ(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}})}let v=a?this._order.indexOf(a):this._order.length;if(a&&v===-1)this.fire(new r.k(new Error(`Cannot add layer "${m}" before non-existing layer "${a}".`)));else{if(this._order.splice(v,0,m),this._layerOrderChanged=!0,this._layers[m]=g,this._removedLayers[m]&&g.source&&g.type!=="custom"){let S=this._removedLayers[m];delete this._removedLayers[m],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new r.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;let h=this._order.indexOf(e);this._order.splice(h,1);let m=a?this._order.indexOf(a):this._order.length;a&&m===-1?this.fire(new r.k(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(m,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let a=this._layers[e];if(!a)return void this.fire(new r.k(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);let h=this._order.indexOf(e);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,h){this._checkLoaded();let m=this.getLayer(e);m?m.minzoom===a&&m.maxzoom===h||(a!=null&&(m.minzoom=a),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new r.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,h={}){this._checkLoaded();let m=this.getLayer(e);if(m){if(!r.bH(m.filter,a))return a==null?(m.setFilter(void 0),void this._updateLayer(m)):void(this._validate(r.z.filter,`layers.${m.id}.filter`,a,null,h)||(m.setFilter(r.bK(a)),this._updateLayer(m)))}else this.fire(new r.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return r.bK(this.getLayer(e).filter)}setLayoutProperty(e,a,h,m={}){this._checkLoaded();let g=this.getLayer(e);g?r.bH(g.getLayoutProperty(a),h)||(g.setLayoutProperty(a,h,m),this._updateLayer(g)):this.fire(new r.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){let h=this.getLayer(e);if(h)return h.getLayoutProperty(a);this.fire(new r.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,h,m={}){this._checkLoaded();let g=this.getLayer(e);g?r.bH(g.getPaintProperty(a),h)||(g.setPaintProperty(a,h,m)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new r.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();let h=e.source,m=e.sourceLayer,g=this.sourceCaches[h];if(g===void 0)return void this.fire(new r.k(new Error(`The source '${h}' does not exist in the map's style.`)));let v=g.getSource().type;v==="geojson"&&m?this.fire(new r.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||m?(e.id===void 0&&this.fire(new r.k(new Error("The feature id parameter must be provided."))),g.setFeatureState(m,e.id,a)):this.fire(new r.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();let h=e.source,m=this.sourceCaches[h];if(m===void 0)return void this.fire(new r.k(new Error(`The source '${h}' does not exist in the map's style.`)));let g=m.getSource().type,v=g==="vector"?e.sourceLayer:void 0;g!=="vector"||v?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new r.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(v,e.id,a):this.fire(new r.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let a=e.source,h=e.sourceLayer,m=this.sourceCaches[a];if(m!==void 0)return m.getSource().type!=="vector"||h?(e.id===void 0&&this.fire(new r.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(h,e.id)):void this.fire(new r.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new r.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return r.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=r.bN(this.sourceCaches,g=>g.serialize()),a=this._serializeByIds(this._order,!0),h=this.map.getTerrain()||void 0,m=this.stylesheet;return r.bO({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:e,layers:a,terrain:h},g=>g!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let a=v=>this._layers[v].type==="fill-extrusion",h={},m=[];for(let v=this._order.length-1;v>=0;v--){let S=this._order[v];if(a(S)){h[S]=v;for(let I of e){let P=I[S];if(P)for(let E of P)m.push(E)}}}m.sort((v,S)=>S.intersectionZ-v.intersectionZ);let g=[];for(let v=this._order.length-1;v>=0;v--){let S=this._order[v];if(a(S))for(let I=m.length-1;I>=0;I--){let P=m[I].feature;if(h[P.layer.id]<v)break;g.push(P),m.pop()}else for(let I of e){let P=I[S];if(P)for(let E of P)g.push(E.feature)}}return g}queryRenderedFeatures(e,a,h){a&&a.filter&&this._validate(r.z.filter,"queryRenderedFeatures.filter",a.filter,null,a);let m={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new r.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let P of a.layers){let E=this._layers[P];if(!E)return this.fire(new r.k(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];m[E.source]=!0}}let g=[];a.availableImages=this._availableImages;let v=this._serializedAllLayers(),S=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,I=Object.assign(Object.assign({},a),{layers:S});for(let P in this.sourceCaches)a.layers&&!m[P]||g.push(Dr(this.sourceCaches[P],this._layers,v,e,I,h,this.map.terrain?(E,D,L)=>this.map.terrain.getElevation(E,D,L):void 0));return this.placement&&g.push((function(P,E,D,L,O,N,X){let H={},J=N.queryRenderedSymbols(L),ee=[];for(let re of Object.keys(J).map(Number))ee.push(X[re]);ee.sort(is);for(let re of ee){let te=re.featureIndex.lookupSymbolFeatures(J[re.bucketInstanceId],E,re.bucketIndex,re.sourceLayerIndex,O.filter,O.layers,O.availableImages,P);for(let ae in te){let ue=H[ae]=H[ae]||[],ie=te[ae];ie.sort((_e,Me)=>{let we=re.featureSortOrder;if(we){let Se=we.indexOf(_e.featureIndex);return we.indexOf(Me.featureIndex)-Se}return Me.featureIndex-_e.featureIndex});for(let _e of ie)ue.push(_e)}}return(function(re,te,ae){for(let ue in re)for(let ie of re[ue])ns(ie,ae[te[ue].source]);return re})(H,P,D)})(this._layers,v,this.sourceCaches,e,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,a){a&&a.filter&&this._validate(r.z.filter,"querySourceFeatures.filter",a.filter,null,a);let h=this.sourceCaches[e];return h?(function(m,g){let v=m.getRenderableIds().map(P=>m.getTileByID(P)),S=[],I={};for(let P=0;P<v.length;P++){let E=v[P],D=E.tileID.canonical.key;I[D]||(I[D]=!0,E.querySourceFeatures(S,g))}return S})(h,a):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();let h=this.light.getLight(),m=!1;for(let v in e)if(!r.bH(e[v],h[v])){m=!0;break}if(!m)return;let g={now:U.now(),transition:r.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){this._checkLoaded();let h=this.getSky(),m=!1;if(!e&&!h)return;if(e&&!h)m=!0;else if(!e&&h)m=!0;else for(let v in e)if(!r.bH(e[v],h[v])){m=!0;break}if(!m)return;let g={now:U.now(),transition:r.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(g)}_setProjectionInternal(e){let a=(function(h){if(Array.isArray(h)){let m=new mc({type:h});return{projection:m,transform:new cl,cameraHelper:new Up(m)}}switch(h){case"mercator":return{projection:new Ut,transform:new hi,cameraHelper:new Pn};case"globe":{let m=new mc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new cl,cameraHelper:new Up(m)}}case"vertical-perspective":return{projection:new nl,transform:new ll,cameraHelper:new Mn};default:return r.w(`Unknown projection name: ${h}. Falling back to mercator projection.`),{projection:new Ut,transform:new hi,cameraHelper:new Pn}}})(e);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(let h in this.sourceCaches)this.sourceCaches[h].reload()}_validate(e,a,h,m,g={}){return(!g||g.validate!==!1)&&gc(this,e.call(r.z,r.e({key:a,style:this.serialize(),value:h,styleSpec:r.v},m)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ko().off(wa,this._rtlPluginLoaded);for(let a in this._layers)this._layers[a].setEventedParent(null);for(let a in this.sourceCaches){let h=this.sourceCaches[a];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,h,m,g=!1){let v=!1,S=!1,I={};for(let P of this._order){let E=this._layers[P];if(E.type!=="symbol")continue;if(!I[E.source]){let L=this.sourceCaches[E.source];I[E.source]=L.getRenderableIds(!0).map(O=>L.getTileByID(O)).sort((O,N)=>N.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan(N.tileID)?-1:1))}let D=this.crossTileSymbolIndex.addLayer(E,I[E.source],e.center.lng);v=v||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(U.now(),e.zoom))&&(this.pauseablePlacement=new qu(e,this.map.terrain,this._order,g,a,h,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(U.now()),S=!0),v&&this.pauseablePlacement.placement.setStale()),S||v)for(let P of this._order){let E=this._layers[P];E.type==="symbol"&&this.placement.updateLayerOpacities(E,I[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(U.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a){return r._(this,void 0,void 0,function*(){let h=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();let m=this.sourceCaches[a.source];return m&&m.setDependencies(a.tileID.key,a.type,a.icons),h})}getGlyphs(e,a){return r._(this,void 0,void 0,function*(){let h=yield this.glyphManager.getGlyphs(a.stacks),m=this.sourceCaches[a.source];return m&&m.setDependencies(a.tileID.key,a.type,[""]),h})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(r.z.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,a,h={},m){this._checkLoaded();let g=[{id:e,url:a}],v=[...je(this.stylesheet.sprite),...g];this._validate(r.z.sprite,"sprite",v,null,h)||(this.stylesheet.sprite=v,this._loadSprite(g,!0,m))}removeSprite(e){this._checkLoaded();let a=je(this.stylesheet.sprite);if(a.find(h=>h.id===e)){if(this._spritesImagesIds[e])for(let h of this._spritesImagesIds[e])this.imageManager.removeImage(h),this._changedImages[h]=!0;a.splice(a.findIndex(h=>h.id===e),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new r.l("data",{dataType:"style"}))}else this.fire(new r.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return je(this.stylesheet.sprite)}setSprite(e,a={},h){this._checkLoaded(),e&&this._validate(r.z.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,h):(this._unloadSprite(),h&&h(null)))}}var Df=r.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Rf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,h,m,g,v,S,I,P){this.context=e;let E=this.boundPaintVertexBuffers.length!==m.length;for(let D=0;!E&&D<m.length;D++)this.boundPaintVertexBuffers[D]!==m[D]&&(E=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||E||this.boundIndexBuffer!==g||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==P?this.freshBind(a,h,m,g,v,S,I,P):(e.bindVertexArray.set(this.vao),S&&S.bind(),g&&g.dynamicDraw&&g.bind(),I&&I.bind(),P&&P.bind())}freshBind(e,a,h,m,g,v,S,I){let P=e.numAttributes,E=this.context,D=E.gl;this.vao&&this.destroy(),this.vao=E.createVertexArray(),E.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=I,a.enableAttributes(D,e);for(let L of h)L.enableAttributes(D,e);v&&v.enableAttributes(D,e),S&&S.enableAttributes(D,e),I&&I.enableAttributes(D,e),a.bind(),a.setVertexAttribPointers(D,e,g);for(let L of h)L.bind(),L.setVertexAttribPointers(D,e,g);v&&(v.bind(),v.setVertexAttribPointers(D,e,g)),m&&m.bind(),S&&(S.bind(),S.setVertexAttribPointers(D,e,g)),I&&(I.bind(),I.setVertexAttribPointers(D,e,g)),E.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let _c=(f,e,a,h,m)=>({u_texture:0,u_ele_delta:f,u_fog_matrix:e,u_fog_color:a?a.properties.get("fog-color"):r.bf.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:a?a.calculateFogBlendOpacity(h):0,u_horizon_color:a?a.properties.get("horizon-color"):r.bf.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),Ju={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ea(f){let e=[];for(let a=0;a<f.length;a++){if(f[a]===null)continue;let h=f[a].split(" ");e.push(h.pop())}return e}class Yu{constructor(e,a,h,m,g,v,S,I,P=[]){let E=e.gl;this.program=E.createProgram();let D=Ea(a.staticAttributes),L=h?h.getBinderAttributes():[],O=D.concat(L),N=zr.prelude.staticUniforms?Ea(zr.prelude.staticUniforms):[],X=S.staticUniforms?Ea(S.staticUniforms):[],H=a.staticUniforms?Ea(a.staticUniforms):[],J=h?h.getBinderUniforms():[],ee=N.concat(X).concat(H).concat(J),re=[];for(let we of ee)re.indexOf(we)<0&&re.push(we);let te=h?h.defines():[];ao(E)&&te.unshift("#version 300 es"),g&&te.push("#define OVERDRAW_INSPECTOR;"),v&&te.push("#define TERRAIN3D;"),I&&te.push(I),P&&te.push(...P);let ae=te.concat(zr.prelude.fragmentSource,S.fragmentSource,a.fragmentSource).join(`
`),ue=te.concat(zr.prelude.vertexSource,S.vertexSource,a.vertexSource).join(`
`);ao(E)||(ae=(function(we){return we.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ae),ue=(function(we){return we.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ue));let ie=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(ie,ae),E.compileShader(ie),!E.getShaderParameter(ie,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(ie)}`);E.attachShader(this.program,ie);let _e=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(_e,ue),E.compileShader(_e),!E.getShaderParameter(_e,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(_e)}`);E.attachShader(this.program,_e),this.attributes={};let Me={};this.numAttributes=O.length;for(let we=0;we<this.numAttributes;we++)O[we]&&(E.bindAttribLocation(this.program,we,O[we]),this.attributes[O[we]]=we);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(_e),E.deleteShader(ie);for(let we=0;we<re.length;we++){let Se=re[we];if(Se&&!Me[Se]){let Pe=E.getUniformLocation(this.program,Se);Pe&&(Me[Se]=Pe)}}this.fixedUniforms=m(e,Me),this.terrainUniforms=((we,Se)=>({u_depth:new r.bP(we,Se.u_depth),u_terrain:new r.bP(we,Se.u_terrain),u_terrain_dim:new r.bg(we,Se.u_terrain_dim),u_terrain_matrix:new r.bR(we,Se.u_terrain_matrix),u_terrain_unpack:new r.bS(we,Se.u_terrain_unpack),u_terrain_exaggeration:new r.bg(we,Se.u_terrain_exaggeration)}))(e,Me),this.projectionUniforms=((we,Se)=>({u_projection_matrix:new r.bR(we,Se.u_projection_matrix),u_projection_tile_mercator_coords:new r.bS(we,Se.u_projection_tile_mercator_coords),u_projection_clipping_plane:new r.bS(we,Se.u_projection_clipping_plane),u_projection_transition:new r.bg(we,Se.u_projection_transition),u_projection_fallback_matrix:new r.bR(we,Se.u_projection_fallback_matrix)}))(e,Me),this.binderUniforms=h?h.getUniforms(e,Me):[]}draw(e,a,h,m,g,v,S,I,P,E,D,L,O,N,X,H,J,ee,re){let te=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(h),e.setStencilMode(m),e.setColorMode(g),e.setCullFace(v),I){e.activeTexture.set(te.TEXTURE2),te.bindTexture(te.TEXTURE_2D,I.depthTexture),e.activeTexture.set(te.TEXTURE3),te.bindTexture(te.TEXTURE_2D,I.texture);for(let ue in this.terrainUniforms)this.terrainUniforms[ue].set(I[ue])}if(P)for(let ue in P)this.projectionUniforms[Ju[ue]].set(P[ue]);if(S)for(let ue in this.fixedUniforms)this.fixedUniforms[ue].set(S[ue]);H&&H.setUniforms(e,this.binderUniforms,N,{zoom:X});let ae=0;switch(a){case te.LINES:ae=2;break;case te.TRIANGLES:ae=3;break;case te.LINE_STRIP:ae=1}for(let ue of O.get()){let ie=ue.vaos||(ue.vaos={});(ie[E]||(ie[E]=new Rf)).bind(e,this,D,H?H.getPaintVertexBuffers():[],L,ue.vertexOffset,J,ee,re),te.drawElements(a,ue.primitiveLength*ae,te.UNSIGNED_SHORT,ue.primitiveOffset*ae*2)}}}function yc(f,e,a){let h=1/r.aC(a,1,e.transform.tileZoom),m=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,e.transform.tileZoom)/m,v=g*(a.tileID.canonical.x+a.tileID.wrap*m),S=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[v>>16,S>>16],u_pixel_coord_lower:[65535&v,65535&S]}}let Fr=(f,e,a,h)=>{let m=f.style.light,g=m.properties.get("position"),v=[g.x,g.y,g.z],S=r.bV();m.properties.get("anchor")==="viewport"&&r.bW(S,f.transform.bearingInRadians),r.bX(v,v,S);let I=f.transform.transformLightDirection(v),P=m.properties.get("color");return{u_lightpos:v,u_lightpos_globe:I,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+e,u_opacity:a,u_fill_translate:h}},zf=(f,e,a,h,m,g,v)=>r.e(Fr(f,e,a,h),yc(g,f,v),{u_height_factor:-Math.pow(2,m.overscaledZ)/v.tileSize/8}),vc=(f,e,a,h)=>r.e(yc(e,f,a),{u_fill_translate:h}),ul=(f,e)=>({u_world:f,u_fill_translate:e}),hl=(f,e,a,h,m)=>r.e(vc(f,e,a,m),{u_world:h}),Of=(f,e,a,h,m)=>{let g=f.transform,v,S,I=0;if(a.paint.get("circle-pitch-alignment")==="map"){let P=r.aC(e,1,g.zoom);v=!0,S=[P,P],I=P/(r.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*m}else v=!1,S=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:I,u_translate:h}},xc=f=>({u_pixel_extrude_scale:[1/f.width,1/f.height]}),Ff=f=>({u_viewport_size:[f.width,f.height]}),Aa=(f,e=1)=>({u_color:f,u_overlay:0,u_overlay_scale:e}),Np=(f,e,a,h)=>{let m=r.aC(f,1,e)/(r.$*Math.pow(2,f.tileID.overscaledZ))*2*Math.PI*h;return{u_extrude_scale:r.aC(f,1,e),u_intensity:a,u_globe_extrude_scale:m}},Qu=(f,e,a,h)=>{let m=r.L();r.bY(m,0,f.width,f.height,0,0,1);let g=f.context.gl;return{u_matrix:m,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:a,u_color_ramp:h,u_opacity:e.paint.get("heatmap-opacity")}},Bf=(f,e,a)=>{let h=a.paint.get("hillshade-accent-color"),m;switch(a.paint.get("hillshade-method")){case"basic":m=4;break;case"combined":m=1;break;case"igor":m=2;break;case"multidirectional":m=3;break;default:m=0}let g=a.getIlluminationProperties();for(let v=0;v<g.directionRadians.length;v++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(g.directionRadians[v]+=f.transform.bearingInRadians);return{u_image:0,u_latrange:eh(0,e.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:g.altitudeRadians,u_azimuths:g.directionRadians,u_accent:h,u_method:m,u_highlights:g.highlightColor,u_shadows:g.shadowColor}},Vp=(f,e)=>{let a=e.stride,h=r.L();return r.bY(h,0,r.$,-r.$,0,0,1),r.M(h,h,[0,-r.$,0]),{u_matrix:h,u_image:1,u_dimension:[a,a],u_zoom:f.overscaledZ,u_unpack:e.getUnpackVector()}};function eh(f,e){let a=Math.pow(2,e.canonical.z),h=e.canonical.y;return[new r.a1(0,h/a).toLngLat().lat,new r.a1(0,(h+1)/a).toLngLat().lat]}let $p=(f,e,a=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:f.paint.get("color-relief-opacity")}),bc=(f,e,a,h)=>{let m=f.transform;return{u_translation:ih(f,e,a),u_ratio:h/r.aC(e,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Gp=(f,e,a,h,m)=>r.e(bc(f,e,a,h),{u_image:0,u_image_height:m}),qp=(f,e,a,h,m)=>{let g=f.transform,v=th(e,g);return{u_translation:ih(f,e,a),u_texsize:e.imageAtlasTexture.size,u_ratio:h/r.aC(e,1,g.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[v,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ka=(f,e,a,h,m,g)=>{let v=f.lineAtlas,S=th(e,f.transform),I=a.layout.get("line-cap")==="round",P=v.getDash(m.from,I),E=v.getDash(m.to,I),D=P.width*g.fromScale,L=E.width*g.toScale;return r.e(bc(f,e,a,h),{u_patternscale_a:[S/D,-P.height/2],u_patternscale_b:[S/L,-E.height/2],u_sdfgamma:v.width/(256*Math.min(D,L)*f.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:E.y,u_mix:g.t})};function th(f,e){return 1/r.aC(f,1,e.tileZoom)}function ih(f,e,a){return r.aD(f.transform,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}let pl=(f,e,a,h,m)=>{return{u_tl_parent:f,u_scale_parent:e,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(v=h.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(g=h.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:jf(h.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var g,v};function jf(f){f*=Math.PI/180;let e=Math.sin(f),a=Math.cos(f);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}let dl=(f,e,a,h,m,g,v,S,I,P,E,D,L)=>{let O=v.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:O.width/O.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+E,u_pitch_with_map:+h,u_is_along_line:m,u_is_variable_anchor:g,u_texsize:D,u_texture:0,u_translation:P,u_pitched_scale:L}},Wp=(f,e,a,h,m,g,v,S,I,P,E,D,L,O)=>{let N=v.transform;return r.e(dl(f,e,a,h,m,g,v,S,I,P,E,D,O),{u_gamma_scale:h?Math.cos(N.pitch*Math.PI/180)*N.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},Uf=(f,e,a,h,m,g,v,S,I,P,E,D,L)=>r.e(Wp(f,e,a,h,m,g,v,S,I,P,!0,E,0,L),{u_texsize_icon:D,u_texture_icon:1}),Zp=(f,e)=>({u_opacity:f,u_color:e}),Hp=(f,e,a,h,m)=>r.e((function(g,v,S,I){let P=S.imageManager.getPattern(g.from.toString()),E=S.imageManager.getPattern(g.to.toString()),{width:D,height:L}=S.imageManager.getPixelSize(),O=Math.pow(2,I.tileID.overscaledZ),N=I.tileSize*Math.pow(2,S.transform.tileZoom)/O,X=N*(I.tileID.canonical.x+I.tileID.wrap*O),H=N*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:E.tl,u_pattern_br_b:E.br,u_texsize:[D,L],u_mix:v.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:E.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/r.aC(I,1,S.transform.tileZoom),u_pixel_coord_upper:[X>>16,H>>16],u_pixel_coord_lower:[65535&X,65535&H]}})(a,m,e,h),{u_opacity:f}),nh=(f,e)=>{},rh={fillExtrusion:(f,e)=>({u_lightpos:new r.bT(f,e.u_lightpos),u_lightpos_globe:new r.bT(f,e.u_lightpos_globe),u_lightintensity:new r.bg(f,e.u_lightintensity),u_lightcolor:new r.bT(f,e.u_lightcolor),u_vertical_gradient:new r.bg(f,e.u_vertical_gradient),u_opacity:new r.bg(f,e.u_opacity),u_fill_translate:new r.bU(f,e.u_fill_translate)}),fillExtrusionPattern:(f,e)=>({u_lightpos:new r.bT(f,e.u_lightpos),u_lightpos_globe:new r.bT(f,e.u_lightpos_globe),u_lightintensity:new r.bg(f,e.u_lightintensity),u_lightcolor:new r.bT(f,e.u_lightcolor),u_vertical_gradient:new r.bg(f,e.u_vertical_gradient),u_height_factor:new r.bg(f,e.u_height_factor),u_opacity:new r.bg(f,e.u_opacity),u_fill_translate:new r.bU(f,e.u_fill_translate),u_image:new r.bP(f,e.u_image),u_texsize:new r.bU(f,e.u_texsize),u_pixel_coord_upper:new r.bU(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new r.bU(f,e.u_pixel_coord_lower),u_scale:new r.bT(f,e.u_scale),u_fade:new r.bg(f,e.u_fade)}),fill:(f,e)=>({u_fill_translate:new r.bU(f,e.u_fill_translate)}),fillPattern:(f,e)=>({u_image:new r.bP(f,e.u_image),u_texsize:new r.bU(f,e.u_texsize),u_pixel_coord_upper:new r.bU(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new r.bU(f,e.u_pixel_coord_lower),u_scale:new r.bT(f,e.u_scale),u_fade:new r.bg(f,e.u_fade),u_fill_translate:new r.bU(f,e.u_fill_translate)}),fillOutline:(f,e)=>({u_world:new r.bU(f,e.u_world),u_fill_translate:new r.bU(f,e.u_fill_translate)}),fillOutlinePattern:(f,e)=>({u_world:new r.bU(f,e.u_world),u_image:new r.bP(f,e.u_image),u_texsize:new r.bU(f,e.u_texsize),u_pixel_coord_upper:new r.bU(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new r.bU(f,e.u_pixel_coord_lower),u_scale:new r.bT(f,e.u_scale),u_fade:new r.bg(f,e.u_fade),u_fill_translate:new r.bU(f,e.u_fill_translate)}),circle:(f,e)=>({u_camera_to_center_distance:new r.bg(f,e.u_camera_to_center_distance),u_scale_with_map:new r.bP(f,e.u_scale_with_map),u_pitch_with_map:new r.bP(f,e.u_pitch_with_map),u_extrude_scale:new r.bU(f,e.u_extrude_scale),u_device_pixel_ratio:new r.bg(f,e.u_device_pixel_ratio),u_globe_extrude_scale:new r.bg(f,e.u_globe_extrude_scale),u_translate:new r.bU(f,e.u_translate)}),collisionBox:(f,e)=>({u_pixel_extrude_scale:new r.bU(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_viewport_size:new r.bU(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new r.bQ(f,e.u_color),u_overlay:new r.bP(f,e.u_overlay),u_overlay_scale:new r.bg(f,e.u_overlay_scale)}),depth:nh,clippingMask:nh,heatmap:(f,e)=>({u_extrude_scale:new r.bg(f,e.u_extrude_scale),u_intensity:new r.bg(f,e.u_intensity),u_globe_extrude_scale:new r.bg(f,e.u_globe_extrude_scale)}),heatmapTexture:(f,e)=>({u_matrix:new r.bR(f,e.u_matrix),u_world:new r.bU(f,e.u_world),u_image:new r.bP(f,e.u_image),u_color_ramp:new r.bP(f,e.u_color_ramp),u_opacity:new r.bg(f,e.u_opacity)}),hillshade:(f,e)=>({u_image:new r.bP(f,e.u_image),u_latrange:new r.bU(f,e.u_latrange),u_exaggeration:new r.bg(f,e.u_exaggeration),u_altitudes:new r.b_(f,e.u_altitudes),u_azimuths:new r.b_(f,e.u_azimuths),u_accent:new r.bQ(f,e.u_accent),u_method:new r.bP(f,e.u_method),u_shadows:new r.bZ(f,e.u_shadows),u_highlights:new r.bZ(f,e.u_highlights)}),hillshadePrepare:(f,e)=>({u_matrix:new r.bR(f,e.u_matrix),u_image:new r.bP(f,e.u_image),u_dimension:new r.bU(f,e.u_dimension),u_zoom:new r.bg(f,e.u_zoom),u_unpack:new r.bS(f,e.u_unpack)}),colorRelief:(f,e)=>({u_image:new r.bP(f,e.u_image),u_unpack:new r.bS(f,e.u_unpack),u_dimension:new r.bU(f,e.u_dimension),u_elevation_stops:new r.bP(f,e.u_elevation_stops),u_color_stops:new r.bP(f,e.u_color_stops),u_color_ramp_size:new r.bP(f,e.u_color_ramp_size),u_opacity:new r.bg(f,e.u_opacity)}),line:(f,e)=>({u_translation:new r.bU(f,e.u_translation),u_ratio:new r.bg(f,e.u_ratio),u_device_pixel_ratio:new r.bg(f,e.u_device_pixel_ratio),u_units_to_pixels:new r.bU(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_translation:new r.bU(f,e.u_translation),u_ratio:new r.bg(f,e.u_ratio),u_device_pixel_ratio:new r.bg(f,e.u_device_pixel_ratio),u_units_to_pixels:new r.bU(f,e.u_units_to_pixels),u_image:new r.bP(f,e.u_image),u_image_height:new r.bg(f,e.u_image_height)}),linePattern:(f,e)=>({u_translation:new r.bU(f,e.u_translation),u_texsize:new r.bU(f,e.u_texsize),u_ratio:new r.bg(f,e.u_ratio),u_device_pixel_ratio:new r.bg(f,e.u_device_pixel_ratio),u_image:new r.bP(f,e.u_image),u_units_to_pixels:new r.bU(f,e.u_units_to_pixels),u_scale:new r.bT(f,e.u_scale),u_fade:new r.bg(f,e.u_fade)}),lineSDF:(f,e)=>({u_translation:new r.bU(f,e.u_translation),u_ratio:new r.bg(f,e.u_ratio),u_device_pixel_ratio:new r.bg(f,e.u_device_pixel_ratio),u_units_to_pixels:new r.bU(f,e.u_units_to_pixels),u_patternscale_a:new r.bU(f,e.u_patternscale_a),u_patternscale_b:new r.bU(f,e.u_patternscale_b),u_sdfgamma:new r.bg(f,e.u_sdfgamma),u_image:new r.bP(f,e.u_image),u_tex_y_a:new r.bg(f,e.u_tex_y_a),u_tex_y_b:new r.bg(f,e.u_tex_y_b),u_mix:new r.bg(f,e.u_mix)}),raster:(f,e)=>({u_tl_parent:new r.bU(f,e.u_tl_parent),u_scale_parent:new r.bg(f,e.u_scale_parent),u_buffer_scale:new r.bg(f,e.u_buffer_scale),u_fade_t:new r.bg(f,e.u_fade_t),u_opacity:new r.bg(f,e.u_opacity),u_image0:new r.bP(f,e.u_image0),u_image1:new r.bP(f,e.u_image1),u_brightness_low:new r.bg(f,e.u_brightness_low),u_brightness_high:new r.bg(f,e.u_brightness_high),u_saturation_factor:new r.bg(f,e.u_saturation_factor),u_contrast_factor:new r.bg(f,e.u_contrast_factor),u_spin_weights:new r.bT(f,e.u_spin_weights),u_coords_top:new r.bS(f,e.u_coords_top),u_coords_bottom:new r.bS(f,e.u_coords_bottom)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new r.bP(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new r.bP(f,e.u_is_size_feature_constant),u_size_t:new r.bg(f,e.u_size_t),u_size:new r.bg(f,e.u_size),u_camera_to_center_distance:new r.bg(f,e.u_camera_to_center_distance),u_pitch:new r.bg(f,e.u_pitch),u_rotate_symbol:new r.bP(f,e.u_rotate_symbol),u_aspect_ratio:new r.bg(f,e.u_aspect_ratio),u_fade_change:new r.bg(f,e.u_fade_change),u_label_plane_matrix:new r.bR(f,e.u_label_plane_matrix),u_coord_matrix:new r.bR(f,e.u_coord_matrix),u_is_text:new r.bP(f,e.u_is_text),u_pitch_with_map:new r.bP(f,e.u_pitch_with_map),u_is_along_line:new r.bP(f,e.u_is_along_line),u_is_variable_anchor:new r.bP(f,e.u_is_variable_anchor),u_texsize:new r.bU(f,e.u_texsize),u_texture:new r.bP(f,e.u_texture),u_translation:new r.bU(f,e.u_translation),u_pitched_scale:new r.bg(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new r.bP(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new r.bP(f,e.u_is_size_feature_constant),u_size_t:new r.bg(f,e.u_size_t),u_size:new r.bg(f,e.u_size),u_camera_to_center_distance:new r.bg(f,e.u_camera_to_center_distance),u_pitch:new r.bg(f,e.u_pitch),u_rotate_symbol:new r.bP(f,e.u_rotate_symbol),u_aspect_ratio:new r.bg(f,e.u_aspect_ratio),u_fade_change:new r.bg(f,e.u_fade_change),u_label_plane_matrix:new r.bR(f,e.u_label_plane_matrix),u_coord_matrix:new r.bR(f,e.u_coord_matrix),u_is_text:new r.bP(f,e.u_is_text),u_pitch_with_map:new r.bP(f,e.u_pitch_with_map),u_is_along_line:new r.bP(f,e.u_is_along_line),u_is_variable_anchor:new r.bP(f,e.u_is_variable_anchor),u_texsize:new r.bU(f,e.u_texsize),u_texture:new r.bP(f,e.u_texture),u_gamma_scale:new r.bg(f,e.u_gamma_scale),u_device_pixel_ratio:new r.bg(f,e.u_device_pixel_ratio),u_is_halo:new r.bP(f,e.u_is_halo),u_translation:new r.bU(f,e.u_translation),u_pitched_scale:new r.bg(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new r.bP(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new r.bP(f,e.u_is_size_feature_constant),u_size_t:new r.bg(f,e.u_size_t),u_size:new r.bg(f,e.u_size),u_camera_to_center_distance:new r.bg(f,e.u_camera_to_center_distance),u_pitch:new r.bg(f,e.u_pitch),u_rotate_symbol:new r.bP(f,e.u_rotate_symbol),u_aspect_ratio:new r.bg(f,e.u_aspect_ratio),u_fade_change:new r.bg(f,e.u_fade_change),u_label_plane_matrix:new r.bR(f,e.u_label_plane_matrix),u_coord_matrix:new r.bR(f,e.u_coord_matrix),u_is_text:new r.bP(f,e.u_is_text),u_pitch_with_map:new r.bP(f,e.u_pitch_with_map),u_is_along_line:new r.bP(f,e.u_is_along_line),u_is_variable_anchor:new r.bP(f,e.u_is_variable_anchor),u_texsize:new r.bU(f,e.u_texsize),u_texsize_icon:new r.bU(f,e.u_texsize_icon),u_texture:new r.bP(f,e.u_texture),u_texture_icon:new r.bP(f,e.u_texture_icon),u_gamma_scale:new r.bg(f,e.u_gamma_scale),u_device_pixel_ratio:new r.bg(f,e.u_device_pixel_ratio),u_is_halo:new r.bP(f,e.u_is_halo),u_translation:new r.bU(f,e.u_translation),u_pitched_scale:new r.bg(f,e.u_pitched_scale)}),background:(f,e)=>({u_opacity:new r.bg(f,e.u_opacity),u_color:new r.bQ(f,e.u_color)}),backgroundPattern:(f,e)=>({u_opacity:new r.bg(f,e.u_opacity),u_image:new r.bP(f,e.u_image),u_pattern_tl_a:new r.bU(f,e.u_pattern_tl_a),u_pattern_br_a:new r.bU(f,e.u_pattern_br_a),u_pattern_tl_b:new r.bU(f,e.u_pattern_tl_b),u_pattern_br_b:new r.bU(f,e.u_pattern_br_b),u_texsize:new r.bU(f,e.u_texsize),u_mix:new r.bg(f,e.u_mix),u_pattern_size_a:new r.bU(f,e.u_pattern_size_a),u_pattern_size_b:new r.bU(f,e.u_pattern_size_b),u_scale_a:new r.bg(f,e.u_scale_a),u_scale_b:new r.bg(f,e.u_scale_b),u_pixel_coord_upper:new r.bU(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new r.bU(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new r.bg(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_texture:new r.bP(f,e.u_texture),u_ele_delta:new r.bg(f,e.u_ele_delta),u_fog_matrix:new r.bR(f,e.u_fog_matrix),u_fog_color:new r.bQ(f,e.u_fog_color),u_fog_ground_blend:new r.bg(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new r.bg(f,e.u_fog_ground_blend_opacity),u_horizon_color:new r.bQ(f,e.u_horizon_color),u_horizon_fog_blend:new r.bg(f,e.u_horizon_fog_blend),u_is_globe_mode:new r.bg(f,e.u_is_globe_mode)}),terrainDepth:(f,e)=>({u_ele_delta:new r.bg(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_texture:new r.bP(f,e.u_texture),u_terrain_coords_id:new r.bg(f,e.u_terrain_coords_id),u_ele_delta:new r.bg(f,e.u_ele_delta)}),projectionErrorMeasurement:(f,e)=>({u_input:new r.bg(f,e.u_input),u_output_expected:new r.bg(f,e.u_output_expected)}),atmosphere:(f,e)=>({u_sun_pos:new r.bT(f,e.u_sun_pos),u_atmosphere_blend:new r.bg(f,e.u_atmosphere_blend),u_globe_position:new r.bT(f,e.u_globe_position),u_globe_radius:new r.bg(f,e.u_globe_radius),u_inv_proj_matrix:new r.bR(f,e.u_inv_proj_matrix)}),sky:(f,e)=>({u_sky_color:new r.bQ(f,e.u_sky_color),u_horizon_color:new r.bQ(f,e.u_horizon_color),u_horizon:new r.bU(f,e.u_horizon),u_horizon_normal:new r.bU(f,e.u_horizon_normal),u_sky_horizon_blend:new r.bg(f,e.u_sky_horizon_blend),u_sky_blend:new r.bg(f,e.u_sky_blend)})};class Kp{constructor(e,a,h){this.context=e;let m=e.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let wc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Eo{constructor(e,a,h,m){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.context=e;let g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let h=0;h<this.attributes.length;h++){let m=a.attributes[this.attributes[h].name];m!==void 0&&e.enableVertexAttribArray(m)}}setVertexAttribPointers(e,a,h){for(let m=0;m<this.attributes.length;m++){let g=this.attributes[m],v=a.attributes[g.name];v!==void 0&&e.vertexAttribPointer(v,g.components,e[wc[g.type]],!1,this.itemSize,g.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Yt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oh extends Yt{getDefault(){return r.bf.transparent}set(e){let a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ah extends Yt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Xp extends Yt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class sh extends Yt{getDefault(){return[!0,!0,!0,!0]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class La extends Yt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class lh extends Yt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Nf extends Yt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Vf extends Yt{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class $f extends Yt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class Gf extends Yt{getDefault(){return[0,1]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Jp extends Yt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class qf extends Yt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Yp extends Yt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class Sc extends Yt{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ic extends Yt{getDefault(){return r.bf.transparent}set(e){let a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Tc extends Yt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ch extends Yt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class Da extends Yt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ml extends Yt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class fs extends Yt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class yr extends Yt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Qp extends Yt{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ed extends Yt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class uh extends Yt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ra extends Yt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Cc extends Yt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Pc extends Yt{getDefault(){return null}set(e){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class fl extends Yt{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;let h=this.gl;ao(h)?h.bindVertexArray(e):(a=h.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Mc extends Yt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class td extends Yt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class gs extends Yt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ia extends Yt{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class id extends ia{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class hh extends ia{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class $t extends ia{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let gl="Framebuffer is not complete";class Wf{constructor(e,a,h,m,g){this.context=e,this.width=a,this.height=h;let v=e.gl,S=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new id(e,S),m)this.depthAttachment=g?new $t(e,S):new hh(e,S);else if(g)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(gl)}destroy(){let e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){let h=this.depthAttachment.get();h&&e.deleteRenderbuffer(h)}e.deleteFramebuffer(this.framebuffer)}}class nd{constructor(e){var a,h;if(this.gl=e,this.clearColor=new oh(this),this.clearDepth=new ah(this),this.clearStencil=new Xp(this),this.colorMask=new sh(this),this.depthMask=new La(this),this.stencilMask=new lh(this),this.stencilFunc=new Nf(this),this.stencilOp=new Vf(this),this.stencilTest=new $f(this),this.depthRange=new Gf(this),this.depthTest=new Jp(this),this.depthFunc=new qf(this),this.blend=new Yp(this),this.blendFunc=new Sc(this),this.blendColor=new Ic(this),this.blendEquation=new Tc(this),this.cullFace=new ch(this),this.cullFaceSide=new Da(this),this.frontFace=new ml(this),this.program=new fs(this),this.activeTexture=new yr(this),this.viewport=new Qp(this),this.bindFramebuffer=new ed(this),this.bindRenderbuffer=new uh(this),this.bindTexture=new Ra(this),this.bindVertexBuffer=new Cc(this),this.bindElementBuffer=new Pc(this),this.bindVertexArray=new fl(this),this.pixelStoreUnpack=new Mc(this),this.pixelStoreUnpackPremultiplyAlpha=new td(this),this.pixelStoreUnpackFlipY=new gs(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ao(e)){this.HALF_FLOAT=e.HALF_FLOAT;let m=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:m?.RGBA16F_EXT,this.RGB16F=(h=e.RGB16F)!==null&&h!==void 0?h:m?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let m=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=m?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new Kp(this,e,a)}createVertexBuffer(e,a,h){return new Eo(this,e,a,h)}createRenderbuffer(e,a,h){let m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,e,a,h),this.bindRenderbuffer.set(null),g}createFramebuffer(e,a,h,m){return new Wf(this,e,a,h,m)}clear({color:e,depth:a,stencil:h}){let m=this.gl,g=0;e&&(g|=m.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(g|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){r.bH(e.blendFunction,_i.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ao(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return ao(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let na;function rd(f,e,a,h,m){let g=f.context,v=f.transform,S=g.gl,I=f.useProgram("collisionBox"),P=[],E=0,D=0;for(let J=0;J<h.length;J++){let ee=h[J],re=e.getTile(ee).getBucket(a);if(!re)continue;let te=m?re.textCollisionBox:re.iconCollisionBox,ae=re.collisionCircleArray;ae.length>0&&(P.push({circleArray:ae,circleOffset:D,coord:ee}),E+=ae.length/4,D=E),te&&I.draw(g,S.LINES,At.disabled,Kt.disabled,f.colorModeForRenderPass(),wt.disabled,xc(f.transform),f.style.map.terrain&&f.style.map.terrain.getTerrainData(ee),v.getProjectionData({overscaledTileID:ee,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,null,f.transform.zoom,null,null,te.collisionVertexBuffer)}if(!m||!P.length)return;let L=f.useProgram("collisionCircle"),O=new r.b$;O.resize(4*E),O._trim();let N=0;for(let J of P)for(let ee=0;ee<J.circleArray.length/4;ee++){let re=4*ee,te=J.circleArray[re+0],ae=J.circleArray[re+1],ue=J.circleArray[re+2],ie=J.circleArray[re+3];O.emplace(N++,te,ae,ue,ie,0),O.emplace(N++,te,ae,ue,ie,1),O.emplace(N++,te,ae,ue,ie,2),O.emplace(N++,te,ae,ue,ie,3)}(!na||na.length<2*E)&&(na=(function(J){let ee=2*J,re=new r.c1;re.resize(ee),re._trim();for(let te=0;te<ee;te++){let ae=6*te;re.uint16[ae+0]=4*te+0,re.uint16[ae+1]=4*te+1,re.uint16[ae+2]=4*te+2,re.uint16[ae+3]=4*te+2,re.uint16[ae+4]=4*te+3,re.uint16[ae+5]=4*te+0}return re})(E));let X=g.createIndexBuffer(na,!0),H=g.createVertexBuffer(O,r.c0.members,!0);for(let J of P){let ee=Ff(f.transform);L.draw(g,S.TRIANGLES,At.disabled,Kt.disabled,f.colorModeForRenderPass(),wt.disabled,ee,f.style.map.terrain&&f.style.map.terrain.getTerrainData(J.coord),null,a.id,H,X,r.aM.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,f.transform.zoom,null,null,null)}H.destroy(),X.destroy()}let Zf=r.ag(new Float32Array(16));function od(f,e,a,h,m,g){let{horizontalAlign:v,verticalAlign:S}=r.aH(f);return new r.P((-(v-.5)*e/m+h[0])*g,(-(S-.5)*a/m+h[1])*g)}function Hf(f,e,a,h,m,g){let v=e.tileAnchorPoint.add(new r.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=h.mult(g);a||(S=S.rotate(-m));let I=v.add(S);return Wi(I.x,I.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(a){let S=yn(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),I=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return f.add(h.rotate(I))}return f.add(h)}function ph(f,e,a,h,m,g,v,S,I,P,E,D){let L=f.text.placedSymbolArray,O=f.text.dynamicLayoutVertexArray,N=f.icon.dynamicLayoutVertexArray,X={};O.clear();for(let H=0;H<L.length;H++){let J=L.get(H),ee=J.hidden||!J.crossTileID||f.allowVerticalPlacement&&!J.placedOrientation?null:h[J.crossTileID];if(ee){let re=new r.P(J.anchorX,J.anchorY),te={getElevation:D,width:m.width,height:m.height,pitchedLabelPlaneMatrix:g,pitchWithMap:a,transform:m,tileAnchorPoint:re,translation:P,unwrappedTileID:E},ae=a?Jo(re.x,re.y,te):yn(re.x,re.y,te),ue=Ge(m.cameraToCenterDistance,ae.signedDistanceFromCamera),ie=r.ap(f.textSizeData,S,J)*ue/r.aB;a&&(ie*=f.tilePixelRatio/v);let{width:_e,height:Me,anchor:we,textOffset:Se,textBoxScale:Pe}=ee,Ve=od(we,_e,Me,Se,Pe,ie),We=m.getPitchedTextCorrection(re.x+P[0],re.y+P[1],E),Re=Hf(ae.point,te,e,Ve,-m.bearingInRadians,We),st=f.allowVerticalPlacement&&J.placedOrientation===r.ao.vertical?Math.PI/2:0;for(let Rt=0;Rt<J.numGlyphs;Rt++)r.av(O,Re,st);I&&J.associatedIconIndex>=0&&(X[J.associatedIconIndex]={shiftedAnchor:Re,angle:st})}else oo(J.numGlyphs,O)}if(I){N.clear();let H=f.icon.placedSymbolArray;for(let J=0;J<H.length;J++){let ee=H.get(J);if(ee.hidden)oo(ee.numGlyphs,N);else{let re=X[J];if(re)for(let te=0;te<ee.numGlyphs;te++)r.av(N,re.shiftedAnchor,re.angle);else oo(ee.numGlyphs,N)}}f.icon.dynamicLayoutVertexBuffer.updateData(N)}f.text.dynamicLayoutVertexBuffer.updateData(O)}function Ec(f,e,a){return a.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function _l(f,e,a,h,m,g,v,S,I,P,E,D,L){let O=f.context,N=O.gl,X=f.transform,H=S==="map",J=I==="map",ee=S!=="viewport"&&a.layout.get("symbol-placement")!=="point",re=H&&!J&&!ee,te=!a.layout.get("symbol-sort-key").isConstant(),ae=!1,ue=f.getDepthModeForSublayer(0,At.ReadOnly),ie=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_e=[],Me=X.getCircleRadiusCorrection();for(let we of h){let Se=e.getTile(we),Pe=Se.getBucket(a);if(!Pe)continue;let Ve=m?Pe.text:Pe.icon;if(!Ve||!Ve.segments.get().length||!Ve.hasVisibleVertices)continue;let We=Ve.programConfigurations.get(a.id),Re=m||Pe.sdfIcons,st=m?Pe.textSizeData:Pe.iconSizeData,Rt=J||X.pitch!==0,Qt=f.useProgram(Ec(Re,m,Pe),We),si=r.an(st,X.zoom),oi=f.style.map.terrain&&f.style.map.terrain.getTerrainData(we),Si,Mi,Lt,li,Hi=[0,0],rn=null;if(m)Mi=Se.glyphAtlasTexture,Lt=N.LINEAR,Si=Se.glyphAtlasTexture.size,Pe.iconsInText&&(Hi=Se.imageAtlasTexture.size,rn=Se.imageAtlasTexture,li=Rt||f.options.rotating||f.options.zooming||st.kind==="composite"||st.kind==="camera"?N.LINEAR:N.NEAREST);else{let Ki=a.layout.get("icon-size").constantOr(0)!==1||Pe.iconsNeedLinear;Mi=Se.imageAtlasTexture,Lt=Re||f.options.rotating||f.options.zooming||Ki||Rt?N.LINEAR:N.NEAREST,Si=Se.imageAtlasTexture.size}let un=r.aC(Se,1,f.transform.zoom),Nn=Vi(H,f.transform,un),$r=r.L();r.aq($r,Nn);let oa=Vt(J,H,f.transform,un),aa=r.aD(X,Se,g,v),Ms=X.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),Es=ie&&Pe.hasTextData(),Na=a.layout.get("icon-text-fit")!=="none"&&Es&&Pe.hasIconData();if(ee){let Ki=f.style.map.terrain?(br,Xi)=>f.style.map.terrain.getElevation(we,br,Xi):null,on=a.layout.get("text-rotation-alignment")==="map";Ci(Pe,f,m,Nn,$r,J,P,on,we.toUnwrapped(),X.width,X.height,aa,Ki)}let Va=m&&ie||Na,Qn=ee||Va?Zf:J?Nn:f.transform.clipSpaceToPixelsMatrix,Gr=Re&&a.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Vn;Vn=Re?Pe.iconsInText?Uf(st.kind,si,re,J,ee,Va,f,Qn,oa,aa,Si,Hi,Me):Wp(st.kind,si,re,J,ee,Va,f,Qn,oa,aa,m,Si,0,Me):dl(st.kind,si,re,J,ee,Va,f,Qn,oa,aa,m,Si,Me);let sa={program:Qt,buffers:Ve,uniformValues:Vn,projectionData:Ms,atlasTexture:Mi,atlasTextureIcon:rn,atlasInterpolation:Lt,atlasInterpolationIcon:li,isSDF:Re,hasHalo:Gr};if(te&&Pe.canOverlap){ae=!0;let Ki=Ve.segments.get();for(let on of Ki)_e.push({segments:new r.aM([on]),sortKey:on.sortKey,state:sa,terrainData:oi})}else _e.push({segments:Ve.segments,sortKey:0,state:sa,terrainData:oi})}ae&&_e.sort((we,Se)=>we.sortKey-Se.sortKey);for(let we of _e){let Se=we.state;if(O.activeTexture.set(N.TEXTURE0),Se.atlasTexture.bind(Se.atlasInterpolation,N.CLAMP_TO_EDGE),Se.atlasTextureIcon&&(O.activeTexture.set(N.TEXTURE1),Se.atlasTextureIcon&&Se.atlasTextureIcon.bind(Se.atlasInterpolationIcon,N.CLAMP_TO_EDGE)),Se.isSDF){let Pe=Se.uniformValues;Se.hasHalo&&(Pe.u_is_halo=1,yl(Se.buffers,we.segments,a,f,Se.program,ue,E,D,Pe,Se.projectionData,we.terrainData)),Pe.u_is_halo=0}yl(Se.buffers,we.segments,a,f,Se.program,ue,E,D,Se.uniformValues,Se.projectionData,we.terrainData)}}function yl(f,e,a,h,m,g,v,S,I,P,E){let D=h.context;m.draw(D,D.gl.TRIANGLES,g,v,S,wt.backCCW,I,E,P,a.id,f.layoutVertexBuffer,f.indexBuffer,e,a.paint,h.transform.zoom,f.programConfigurations.get(a.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function dh(f,e,a,h,m){let g=f.context,v=g.gl,S=Kt.disabled,I=new _i([v.ONE,v.ONE],r.bf.transparent,[!0,!0,!0,!0]),P=e.getBucket(a);if(!P)return;let E=h.key,D=a.heatmapFbos.get(E);D||(D=vl(g,e.tileSize,e.tileSize),a.heatmapFbos.set(E,D)),g.bindFramebuffer.set(D.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:r.bf.transparent});let L=P.programConfigurations.get(a.id),O=f.useProgram("heatmap",L,!m),N=f.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),X=f.style.map.terrain.getTerrainData(h);O.draw(g,v.TRIANGLES,At.disabled,S,I,wt.disabled,Np(e,f.transform.zoom,a.paint.get("heatmap-intensity"),1),X,N,a.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,a.paint,f.transform.zoom,L)}function ad(f,e,a,h,m){let g=f.context,v=g.gl,S=f.transform;g.setColorMode(f.colorModeForRenderPass());let I=xl(g,e),P=a.key,E=e.heatmapFbos.get(P);if(!E)return;g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,E.colorAttachment.get()),g.activeTexture.set(v.TEXTURE1),I.bind(v.LINEAR,v.CLAMP_TO_EDGE);let D=S.getProjectionData({overscaledTileID:a,applyTerrainMatrix:m,applyGlobeMatrix:!h});f.useProgram("heatmapTexture").draw(g,v.TRIANGLES,At.disabled,Kt.disabled,f.colorModeForRenderPass(),wt.disabled,Qu(f,e,0,1),null,D,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,S.zoom),E.destroy(),e.heatmapFbos.delete(P)}function vl(f,e,a){var h,m;let g=f.gl,v=g.createTexture();g.bindTexture(g.TEXTURE_2D,v),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);let S=(h=f.HALF_FLOAT)!==null&&h!==void 0?h:g.UNSIGNED_BYTE,I=(m=f.RGBA16F)!==null&&m!==void 0?m:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,I,e,a,0,g.RGBA,S,null);let P=f.createFramebuffer(e,a,!1,!1);return P.colorAttachment.set(v),P}function xl(f,e){return e.colorRampTexture||(e.colorRampTexture=new r.T(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function bl(f,e,a,h,m){if(!a||!h||!h.imageAtlas)return;let g=h.imageAtlas.patternPositions,v=g[a.to.toString()],S=g[a.from.toString()];if(!v&&S&&(v=S),!S&&v&&(S=v),!v||!S){let I=m.getPaintProperty(e);v=g[I],S=g[I]}v&&S&&f.setConstantPatternPositions(v,S)}function Ac(f,e,a,h,m,g,v,S){let I=f.context.gl,P="fill-pattern",E=a.paint.get(P),D=E&&E.constantOr(1),L=a.getCrossfadeParameters(),O,N,X,H,J,ee=f.transform,re=a.paint.get("fill-translate"),te=a.paint.get("fill-translate-anchor");v?(N=D&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=I.LINES):(N=D?"fillPattern":"fill",O=I.TRIANGLES);let ae=E.constantOr(null);for(let ue of h){let ie=e.getTile(ue);if(D&&!ie.patternsLoaded())continue;let _e=ie.getBucket(a);if(!_e)continue;let Me=_e.programConfigurations.get(a.id),we=f.useProgram(N,Me),Se=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ue);D&&(f.context.activeTexture.set(I.TEXTURE0),ie.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Me.updatePaintBuffers(L)),bl(Me,P,ae,ie,a);let Pe=ee.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),Ve=r.aD(ee,ie,re,te);if(v){H=_e.indexBuffer2,J=_e.segments2;let Re=[I.drawingBufferWidth,I.drawingBufferHeight];X=N==="fillOutlinePattern"&&D?hl(f,L,ie,Re,Ve):ul(Re,Ve)}else H=_e.indexBuffer,J=_e.segments,X=D?vc(f,L,ie,Ve):{u_fill_translate:Ve};let We=f.stencilModeForClipping(ue);we.draw(f.context,O,m,We,g,wt.backCCW,X,Se,Pe,a.id,_e.layoutVertexBuffer,H,J,a.paint,f.transform.zoom,Me)}}function mh(f,e,a,h,m,g,v,S){let I=f.context,P=I.gl,E="fill-extrusion-pattern",D=a.paint.get(E),L=D.constantOr(1),O=a.getCrossfadeParameters(),N=a.paint.get("fill-extrusion-opacity"),X=D.constantOr(null),H=f.transform;for(let J of h){let ee=e.getTile(J),re=ee.getBucket(a);if(!re)continue;let te=f.style.map.terrain&&f.style.map.terrain.getTerrainData(J),ae=re.programConfigurations.get(a.id),ue=f.useProgram(L?"fillExtrusionPattern":"fillExtrusion",ae);L&&(f.context.activeTexture.set(P.TEXTURE0),ee.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ae.updatePaintBuffers(O));let ie=H.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!S,applyTerrainMatrix:!0});bl(ae,E,X,ee,a);let _e=r.aD(H,ee,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Me=a.paint.get("fill-extrusion-vertical-gradient"),we=L?zf(f,Me,N,_e,J,O,ee):Fr(f,Me,N,_e);ue.draw(I,I.gl.TRIANGLES,m,g,v,wt.backCCW,we,te,ie,a.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,a.paint,f.transform.zoom,ae,f.style.map.terrain&&re.centroidVertexBuffer)}}function za(f,e,a,h,m,g,v,S,I){var P;let E=f.style.projection,D=f.context,L=f.transform,O=D.gl,N=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],X=f.useProgram("hillshade",null,!1,N),H=!f.options.moving;for(let J of h){let ee=e.getTile(J),re=ee.fbo;if(!re)continue;let te=E.getMeshFromTileID(D,J.canonical,S,!0,"raster"),ae=(P=f.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(J);D.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,re.colorAttachment.get());let ue=L.getProjectionData({overscaledTileID:J,aligned:H,applyGlobeMatrix:!I,applyTerrainMatrix:!0});X.draw(D,O.TRIANGLES,g,m[J.overscaledZ],v,wt.backCCW,Bf(f,ee,a),ae,ue,a.id,te.vertexBuffer,te.indexBuffer,te.segments)}}function fh(f,e,a,h,m,g,v,S,I){var P;let E=f.style.projection,D=f.context,L=f.transform,O=D.gl,N=f.useProgram("colorRelief"),X=!f.options.moving,H=!0,J=0;for(let ee of h){let re=e.getTile(ee),te=re.dem;if(H){let we=O.getParameter(O.MAX_TEXTURE_SIZE),{elevationTexture:Se,colorTexture:Pe}=a.getColorRampTextures(D,we,te.getUnpackVector());D.activeTexture.set(O.TEXTURE1),Se.bind(O.NEAREST,O.CLAMP_TO_EDGE),D.activeTexture.set(O.TEXTURE4),Pe.bind(O.LINEAR,O.CLAMP_TO_EDGE),H=!1,J=Se.size[0]}if(!te||!te.data)continue;let ae=te.stride,ue=te.getPixels();if(D.activeTexture.set(O.TEXTURE0),D.pixelStoreUnpackPremultiplyAlpha.set(!1),re.demTexture=re.demTexture||f.getTileTexture(ae),re.demTexture){let we=re.demTexture;we.update(ue,{premultiply:!1}),we.bind(O.LINEAR,O.CLAMP_TO_EDGE)}else re.demTexture=new r.T(D,ue,O.RGBA,{premultiply:!1}),re.demTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let ie=E.getMeshFromTileID(D,ee.canonical,S,!0,"raster"),_e=(P=f.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(ee),Me=L.getProjectionData({overscaledTileID:ee,aligned:X,applyGlobeMatrix:!I,applyTerrainMatrix:!0});N.draw(D,O.TRIANGLES,g,m[ee.overscaledZ],v,wt.backCCW,$p(a,re.dem,J),_e,Me,a.id,ie.vertexBuffer,ie.indexBuffer,ie.segments)}}let kc=[new r.P(0,0),new r.P(r.$,0),new r.P(r.$,r.$),new r.P(0,r.$)];function Oa(f,e,a,h,m,g,v,S,I=!1,P=!1){let E=h[h.length-1].overscaledZ,D=f.context,L=D.gl,O=f.useProgram("raster"),N=f.transform,X=f.style.projection,H=f.colorModeForRenderPass(),J=!f.options.moving;for(let ee of h){let re=f.getDepthModeForSublayer(ee.overscaledZ-E,a.paint.get("raster-opacity")===1?At.ReadWrite:At.ReadOnly,L.LESS),te=e.getTile(ee);te.registerFadeDuration(a.paint.get("raster-fade-duration"));let ae=e.findLoadedParent(ee,0),ue=e.findLoadedSibling(ee),ie=gh(te,ae||ue||null,e,a,f.transform,f.style.map.terrain),_e,Me,we=a.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;D.activeTexture.set(L.TEXTURE0),te.texture.bind(we,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(L.TEXTURE1),ae?(ae.texture.bind(we,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,ae.tileID.overscaledZ-te.tileID.overscaledZ),Me=[te.tileID.canonical.x*_e%1,te.tileID.canonical.y*_e%1]):te.texture.bind(we,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),te.texture.useMipmap&&D.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);let Se=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ee),Pe=N.getProjectionData({overscaledTileID:ee,aligned:J,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Ve=pl(Me||[0,0],_e||1,ie,a,S),We=X.getMeshFromTileID(D,ee.canonical,g,v,"raster");O.draw(D,L.TRIANGLES,re,m?m[ee.overscaledZ]:Kt.disabled,H,I?wt.frontCCW:wt.backCCW,Ve,Se,Pe,a.id,We.vertexBuffer,We.indexBuffer,We.segments)}}function gh(f,e,a,h,m,g){let v=h.paint.get("raster-fade-duration");if(!g&&v>0){let S=U.now(),I=(S-f.timeAdded)/v,P=e?(S-e.timeAdded)/v:-1,E=a.getSource(),D=ct(m,{tileSize:E.tileSize,roundZoom:E.roundZoom}),L=!e||Math.abs(e.tileID.overscaledZ-D)>Math.abs(f.tileID.overscaledZ-D),O=L&&f.refreshedUponExpiration?1:r.ah(L?I:1-P,0,1);return f.refreshedUponExpiration&&I>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}let sd=new r.bf(1,0,0,1),ld=new r.bf(0,1,0,1),Lc=new r.bf(0,0,1,1),_h=new r.bf(1,0,1,1),Kf=new r.bf(0,1,1,1);function yh(f,e,a,h){co(f,0,e+a/2,f.transform.width,a,h)}function Pi(f,e,a,h){co(f,e-a/2,0,a,f.transform.height,h)}function co(f,e,a,h,m,g){let v=f.context,S=v.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*f.pixelRatio,a*f.pixelRatio,h*f.pixelRatio,m*f.pixelRatio),v.clear({color:g}),S.disable(S.SCISSOR_TEST)}function vr(f,e,a){let h=f.context,m=h.gl,g=f.useProgram("debug"),v=At.disabled,S=Kt.disabled,I=f.colorModeForRenderPass(),P="$debug",E=f.style.map.terrain&&f.style.map.terrain.getTerrainData(a);h.activeTexture.set(m.TEXTURE0);let D=e.getTileByID(a.key).latestRawTileData,L=Math.floor((D&&D.byteLength||0)/1024),O=e.getTile(a).tileSize,N=512/Math.min(O,512)*(a.overscaledZ/f.transform.zoom)*.5,X=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(X+=` => ${a.overscaledZ}`),(function(J,ee){J.initDebugOverlayCanvas();let re=J.debugOverlayCanvas,te=J.context.gl,ae=J.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,re.width,re.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(ee,5,5),ae.strokeText(ee,5,5),J.debugOverlayTexture.update(re),J.debugOverlayTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE)})(f,`${X} ${L}kB`);let H=f.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(h,m.TRIANGLES,v,S,_i.alphaBlended,wt.disabled,Aa(r.bf.transparent,N),null,H,P,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),g.draw(h,m.LINE_STRIP,v,S,I,wt.disabled,Aa(r.bf.red),E,H,P,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function Dc(f,e,a,h){let{isRenderingGlobe:m}=h,g=f.context,v=g.gl,S=f.transform,I=f.colorModeForRenderPass(),P=f.getDepthModeFor3D(),E=f.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,f.width,f.height]);for(let D of a){let L=e.getTerrainMesh(D.tileID),O=f.renderToTexture.getTexture(D),N=e.getTerrainData(D.tileID);g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,O.texture);let X=e.getMeshFrameDelta(S.zoom),H=S.calculateFogMatrix(D.tileID.toUnwrapped()),J=_c(X,H,f.style.sky,S.pitch,m),ee=S.getProjectionData({overscaledTileID:D.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});E.draw(g,v.TRIANGLES,P,Kt.disabled,I,wt.backCCW,J,N,ee,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}function wl(f,e){if(!e.mesh){let a=new r.aL;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);let h=new r.aN;h.emplaceBack(0,1,2),h.emplaceBack(0,2,3),e.mesh=new Ia(f.createVertexBuffer(a,ta.members),f.createIndexBuffer(h),r.aM.simpleSegment(0,0,a.length,h.length))}return e.mesh}class cd{constructor(e,a){this.context=new nd(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:r.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ft.maxUnderzooming+Ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hs}resize(e,a,h){if(this.width=Math.floor(e*h),this.height=Math.floor(a*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let m of this.style._order)this.style._layers[m].resize()}setup(){let e=this.context,a=new r.aL;a.emplaceBack(0,0),a.emplaceBack(r.$,0),a.emplaceBack(0,r.$),a.emplaceBack(r.$,r.$),this.tileExtentBuffer=e.createVertexBuffer(a,ta.members),this.tileExtentSegments=r.aM.simpleSegment(0,0,4,2);let h=new r.aL;h.emplaceBack(0,0),h.emplaceBack(r.$,0),h.emplaceBack(0,r.$),h.emplaceBack(r.$,r.$),this.debugBuffer=e.createVertexBuffer(h,ta.members),this.debugSegments=r.aM.simpleSegment(0,0,4,5);let m=new r.c6;m.emplaceBack(0,0,0,0),m.emplaceBack(r.$,0,r.$,0),m.emplaceBack(0,r.$,0,r.$),m.emplaceBack(r.$,r.$,r.$,r.$),this.rasterBoundsBuffer=e.createVertexBuffer(m,Df.members),this.rasterBoundsSegments=r.aM.simpleSegment(0,0,4,2);let g=new r.aL;g.emplaceBack(0,0),g.emplaceBack(r.$,0),g.emplaceBack(0,r.$),g.emplaceBack(r.$,r.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,ta.members),this.rasterBoundsSegmentsPosOnly=r.aM.simpleSegment(0,0,4,5);let v=new r.aL;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(v,ta.members),this.viewportSegments=r.aM.simpleSegment(0,0,4,2);let S=new r.c7;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);let I=new r.aN;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(I);let P=this.context.gl;this.stencilClearMode=new Kt({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.tileExtentMesh=new Ia(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let h=r.L();r.bY(h,0,this.width,this.height,0,0,1),r.N(h,h,[a.drawingBufferWidth,a.drawingBufferHeight,0]);let m={mainMatrix:h,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:h};this.useProgram("clippingMask",null,!0).draw(e,a.TRIANGLES,At.disabled,this.stencilClearMode,_i.disabled,wt.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a,h){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source,this.nextStencilID+a.length>256&&this.clearStencil();let m=this.context;m.setColorMode(_i.disabled),m.setDepthMode(At.disabled);let g={};for(let v of a)g[v.key]=this.nextStencilID++;this._renderTileMasks(g,a,h,!0),this._renderTileMasks(g,a,h,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,a,h,m){let g=this.context,v=g.gl,S=this.style.projection,I=this.transform,P=this.useProgram("clippingMask");for(let E of a){let D=e[E.key],L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),O=S.getMeshFromTileID(this.context,E.canonical,m,!0,"stencil"),N=I.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!h,applyTerrainMatrix:!0});P.draw(g,v.TRIANGLES,At.disabled,new Kt({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),_i.disabled,h?wt.disabled:wt.backCCW,null,L,N,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}_renderTilesDepthBuffer(){let e=this.context,a=e.gl,h=this.style.projection,m=this.transform,g=this.useProgram("depth"),v=this.getDepthModeFor3D(),S=ve(m,{tileSize:m.tileSize});for(let I of S){let P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),E=h.getMeshFromTileID(this.context,I.canonical,!0,!0,"raster"),D=m.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,a.TRIANGLES,v,Kt.disabled,_i.disabled,wt.backCCW,null,P,D,"$clipping",E.vertexBuffer,E.indexBuffer,E.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,a=this.context.gl;return new Kt({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){let a=this.context.gl;return new Kt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let a=this.context.gl,h=e.sort((v,S)=>S.overscaledZ-v.overscaledZ),m=h[h.length-1].overscaledZ,g=h[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();let v={};for(let S=0;S<g;S++)v[S+m]=new Kt({func:a.GEQUAL,mask:255},S+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=g,[v,h]}return[{[m]:Kt.disabled},h]}stencilConfigForOverlapTwoPass(e){let a=this.context.gl,h=e.sort((v,S)=>S.overscaledZ-v.overscaledZ),m=h[h.length-1].overscaledZ,g=h[0].overscaledZ-m+1;if(this.clearStencil(),g>1){let v={},S={};for(let I=0;I<g;I++)v[I+m]=new Kt({func:a.GREATER,mask:255},g+1+I,255,a.KEEP,a.KEEP,a.REPLACE),S[I+m]=new Kt({func:a.GREATER,mask:255},1+I,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*g+1,[v,S,h]}return this.nextStencilID=3,[{[m]:new Kt({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[m]:new Kt({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},h]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new _i([e.CONSTANT_COLOR,e.ONE],new r.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_i.unblended:_i.alphaBlended}getDepthModeForSublayer(e,a,h){if(!this.opaquePassEnabledForLayer())return At.disabled;let m=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new At(h||this.context.gl.LEQUAL,a,[m,m])}getDepthModeFor3D(){return new At(this.context.gl.LEQUAL,At.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){var h,m;this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(U.now()),this.imageManager.beginFrame();let g=this.style._order,v=this.style.sourceCaches,S={},I={},P={},E={isRenderingToTexture:!1,isRenderingGlobe:((h=e.projection)===null||h===void 0?void 0:h.transitionState)>0};for(let L in v){let O=v[L];O.used&&O.prepare(this.context),S[L]=O.getVisibleCoordinates(!1),I[L]=S[L].slice().reverse(),P[L]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<g.length;L++)if(this.style._layers[g[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let L of g){let O=this.style._layers[L];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;let N=I[O.source];(O.type==="custom"||N.length)&&this.renderLayer(this,v[O.source],O,N,E)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:L=>this.useProgram(L)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?r.bf.black:r.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(L,O){let N=L.context,X=N.gl,H=((ue,ie,_e)=>{let Me=Math.cos(ie.rollInRadians),we=Math.sin(ie.rollInRadians),Se=he(ie),Pe=ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ue.properties.get("sky-color"),u_horizon_color:ue.properties.get("horizon-color"),u_horizon:[(ie.width/2-Se*we)*_e,(ie.height/2+Se*Me)*_e],u_horizon_normal:[-we,Me],u_sky_horizon_blend:ue.properties.get("sky-horizon-blend")*ie.height/2*_e,u_sky_blend:Pe}})(O,L.style.map.transform,L.pixelRatio),J=new At(X.LEQUAL,At.ReadWrite,[0,1]),ee=Kt.disabled,re=L.colorModeForRenderPass(),te=L.useProgram("sky"),ae=wl(N,O);te.draw(N,X.TRIANGLES,J,ee,re,wt.disabled,H,null,void 0,"sky",ae.vertexBuffer,ae.indexBuffer,ae.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){let L=this.style._layers[g[this.currentLayer]],O=v[L.source],N=S[L.source];this._renderTileClippingMasks(L,N,!1),this.renderLayer(this,O,L,N,E)}this.renderPass="translucent";let D=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){let L=this.style._layers[g[this.currentLayer]],O=v[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L,E))continue;this.opaquePassEnabledForLayer()||D||(D=!0,E.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let N=(L.type==="symbol"?P:I)[L.source];this._renderTileClippingMasks(L,S[L.source],!!this.renderToTexture),this.renderLayer(this,O,L,N,E)}if(E.isRenderingGlobe&&(function(L,O,N){let X=L.context,H=X.gl,J=L.useProgram("atmosphere"),ee=new At(H.LEQUAL,At.ReadOnly,[0,1]),re=L.transform,te=(function(Pe,Ve){let We=Pe.properties.get("position"),Re=[-We.x,-We.y,-We.z],st=r.ag(new Float64Array(16));return Pe.properties.get("anchor")==="map"&&(r.b6(st,st,Ve.rollInRadians),r.b7(st,st,-Ve.pitchInRadians),r.b6(st,st,Ve.bearingInRadians),r.b7(st,st,Ve.center.lat*Math.PI/180),r.bz(st,st,-Ve.center.lng*Math.PI/180)),r.c5(Re,Re,st),Re})(N,L.transform),ae=re.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ue=O.properties.get("atmosphere-blend")*ae.projectionTransition;if(ue===0)return;let ie=ds(re.worldSize,re.center.lat),_e=re.inverseProjectionMatrix,Me=new Float64Array(4);Me[3]=1,r.aw(Me,Me,re.modelViewProjectionMatrix),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1,r.aw(Me,Me,_e),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1;let we=((Pe,Ve,We,Re,st)=>({u_sun_pos:Pe,u_atmosphere_blend:Ve,u_globe_position:We,u_globe_radius:Re,u_inv_proj_matrix:st}))(te,ue,[Me[0],Me[1],Me[2]],ie,_e),Se=wl(X,O);J.draw(X,H.TRIANGLES,ee,Kt.disabled,_i.alphaBlended,wt.disabled,we,null,null,"atmosphere",Se.vertexBuffer,Se.indexBuffer,Se.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let L=(function(O,N){let X=null,H=Object.values(O._layers).flatMap(te=>te.source&&!te.isHidden(N)?[O.sourceCaches[te.source]]:[]),J=H.filter(te=>te.getSource().type==="vector"),ee=H.filter(te=>te.getSource().type!=="vector"),re=te=>{(!X||X.getSource().maxzoom<te.getSource().maxzoom)&&(X=te)};return J.forEach(te=>re(te)),X||ee.forEach(te=>re(te)),X})(this.style,this.transform.zoom);L&&(function(O,N,X){for(let H=0;H<X.length;H++)vr(O,N,X[H])})(this,L,L.getVisibleCoordinates())}this.options.showPadding&&(function(L){let O=L.transform.padding;yh(L,L.transform.height-(O.top||0),3,sd),yh(L,O.bottom||0,3,ld),Pi(L,O.left||0,3,Lc),Pi(L,L.transform.width-(O.right||0),3,_h);let N=L.transform.centerPoint;(function(X,H,J,ee){co(X,H-1,J-10,2,20,ee),co(X,H-10,J-1,20,2,ee)})(L,N.x,L.transform.height-N.y,Kf)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let a=this.terrainFacilitator.matrix,h=this.transform.modelViewProjectionMatrix,m=this.terrainFacilitator.dirty;m||(m=e?!r.c8(a,h):!r.c9(a,h)),m||(m=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(r.ca(a,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(g,v){let S=g.context,I=S.gl,P=g.transform,E=_i.unblended,D=new At(I.LEQUAL,At.ReadWrite,[0,1]),L=v.sourceCache.getRenderableTiles(),O=g.useProgram("terrainDepth");S.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),S.clear({color:r.bf.transparent,depth:1});for(let N of L){let X=v.getTerrainMesh(N.tileID),H=v.getTerrainData(N.tileID),J=P.getProjectionData({overscaledTileID:N.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ee={u_ele_delta:v.getMeshFrameDelta(P.zoom)};O.draw(S,I.TRIANGLES,D,Kt.disabled,E,wt.backCCW,ee,H,J,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain),(function(g,v){let S=g.context,I=S.gl,P=g.transform,E=_i.unblended,D=new At(I.LEQUAL,At.ReadWrite,[0,1]),L=v.getCoordsTexture(),O=v.sourceCache.getRenderableTiles(),N=g.useProgram("terrainCoords");S.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),S.clear({color:r.bf.transparent,depth:1}),v.coordsIndex=[];for(let X of O){let H=v.getTerrainMesh(X.tileID),J=v.getTerrainData(X.tileID);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,L.texture);let ee={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(P.zoom)},re=P.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});N.draw(S,I.TRIANGLES,D,Kt.disabled,E,wt.backCCW,ee,J,re,"terrain",H.vertexBuffer,H.indexBuffer,H.segments),v.coordsIndex.push(X.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,g.width,g.height])})(this,this.style.map.terrain))}renderLayer(e,a,h,m,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(m||[]).length)&&(this.id=h.id,r.cb(h)?(function(v,S,I,P,E,D){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:L}=D,O=Kt.disabled,N=v.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(X,H,J,ee,re,te,ae,ue,ie){let _e=H.transform,Me=H.style.map.terrain,we=re==="map",Se=te==="map";for(let Pe of X){let Ve=ee.getTile(Pe),We=Ve.getBucket(J);if(!We||!We.text||!We.text.segments.get().length)continue;let Re=r.an(We.textSizeData,_e.zoom),st=r.aC(Ve,1,H.transform.zoom),Rt=Vi(we,H.transform,st),Qt=J.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(Re){let si=Math.pow(2,_e.zoom-Ve.tileID.overscaledZ),oi=Me?(Si,Mi)=>Me.getElevation(Pe,Si,Mi):null;ph(We,we,Se,ie,_e,Rt,si,Re,Qt,r.aD(_e,Ve,ae,ue),Pe.toUnwrapped(),oi)}}})(P,v,I,S,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),E),I.paint.get("icon-opacity").constantOr(1)!==0&&_l(v,S,I,P,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),O,N,L),I.paint.get("text-opacity").constantOr(1)!==0&&_l(v,S,I,P,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),O,N,L),S.map.showCollisionBoxes&&(rd(v,S,I,P,!0),rd(v,S,I,P,!1))})(e,a,h,m,this.style.placement.variableOffsets,g):r.cc(h)?(function(v,S,I,P,E){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:D}=E,L=I.paint.get("circle-opacity"),O=I.paint.get("circle-stroke-width"),N=I.paint.get("circle-stroke-opacity"),X=!I.layout.get("circle-sort-key").isConstant();if(L.constantOr(1)===0&&(O.constantOr(1)===0||N.constantOr(1)===0))return;let H=v.context,J=H.gl,ee=v.transform,re=v.getDepthModeForSublayer(0,At.ReadOnly),te=Kt.disabled,ae=v.colorModeForRenderPass(),ue=[],ie=ee.getCircleRadiusCorrection();for(let _e=0;_e<P.length;_e++){let Me=P[_e],we=S.getTile(Me),Se=we.getBucket(I);if(!Se)continue;let Pe=I.paint.get("circle-translate"),Ve=I.paint.get("circle-translate-anchor"),We=r.aD(ee,we,Pe,Ve),Re=Se.programConfigurations.get(I.id),st=v.useProgram("circle",Re),Rt=Se.layoutVertexBuffer,Qt=Se.indexBuffer,si=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Me),oi={programConfiguration:Re,program:st,layoutVertexBuffer:Rt,indexBuffer:Qt,uniformValues:Of(v,we,I,We,ie),terrainData:si,projectionData:ee.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!D,applyTerrainMatrix:!0})};if(X){let Si=Se.segments.get();for(let Mi of Si)ue.push({segments:new r.aM([Mi]),sortKey:Mi.sortKey,state:oi})}else ue.push({segments:Se.segments,sortKey:0,state:oi})}X&&ue.sort((_e,Me)=>_e.sortKey-Me.sortKey);for(let _e of ue){let{programConfiguration:Me,program:we,layoutVertexBuffer:Se,indexBuffer:Pe,uniformValues:Ve,terrainData:We,projectionData:Re}=_e.state;we.draw(H,J.TRIANGLES,re,te,ae,wt.backCCW,Ve,We,Re,I.id,Se,Pe,_e.segments,I.paint,v.transform.zoom,Me)}})(e,a,h,m,g):r.cd(h)?(function(v,S,I,P,E){if(I.paint.get("heatmap-opacity")===0)return;let D=v.context,{isRenderingToTexture:L,isRenderingGlobe:O}=E;if(v.style.map.terrain){for(let N of P){let X=S.getTile(N);S.hasRenderableParent(N)||(v.renderPass==="offscreen"?dh(v,X,I,N,O):v.renderPass==="translucent"&&ad(v,I,N,L,O))}D.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(N,X,H,J){let ee=N.context,re=ee.gl,te=N.transform,ae=Kt.disabled,ue=new _i([re.ONE,re.ONE],r.bf.transparent,[!0,!0,!0,!0]);(function(ie,_e,Me){let we=ie.gl;ie.activeTexture.set(we.TEXTURE1),ie.viewport.set([0,0,_e.width/4,_e.height/4]);let Se=Me.heatmapFbos.get(r.c2);Se?(we.bindTexture(we.TEXTURE_2D,Se.colorAttachment.get()),ie.bindFramebuffer.set(Se.framebuffer)):(Se=vl(ie,_e.width/4,_e.height/4),Me.heatmapFbos.set(r.c2,Se))})(ee,N,H),ee.clear({color:r.bf.transparent});for(let ie=0;ie<J.length;ie++){let _e=J[ie];if(X.hasRenderableParent(_e))continue;let Me=X.getTile(_e),we=Me.getBucket(H);if(!we)continue;let Se=we.programConfigurations.get(H.id),Pe=N.useProgram("heatmap",Se),Ve=te.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),We=te.getCircleRadiusCorrection();Pe.draw(ee,re.TRIANGLES,At.disabled,ae,ue,wt.backCCW,Np(Me,te.zoom,H.paint.get("heatmap-intensity"),We),null,Ve,H.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,H.paint,te.zoom,Se)}ee.viewport.set([0,0,N.width,N.height])})(v,S,I,P):v.renderPass==="translucent"&&(function(N,X){let H=N.context,J=H.gl;H.setColorMode(N.colorModeForRenderPass());let ee=X.heatmapFbos.get(r.c2);ee&&(H.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,ee.colorAttachment.get()),H.activeTexture.set(J.TEXTURE1),xl(H,X).bind(J.LINEAR,J.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw(H,J.TRIANGLES,At.disabled,Kt.disabled,N.colorModeForRenderPass(),wt.disabled,Qu(N,X,0,1),null,null,X.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,X.paint,N.transform.zoom))})(v,I)})(e,a,h,m,g):r.ce(h)?(function(v,S,I,P,E){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:D}=E,L=I.paint.get("line-opacity"),O=I.paint.get("line-width");if(L.constantOr(1)===0||O.constantOr(1)===0)return;let N=v.getDepthModeForSublayer(0,At.ReadOnly),X=v.colorModeForRenderPass(),H=I.paint.get("line-dasharray"),J=I.paint.get("line-pattern"),ee=J.constantOr(1),re=I.paint.get("line-gradient"),te=I.getCrossfadeParameters(),ae=ee?"linePattern":H?"lineSDF":re?"lineGradient":"line",ue=v.context,ie=ue.gl,_e=v.transform,Me=!0;for(let we of P){let Se=S.getTile(we);if(ee&&!Se.patternsLoaded())continue;let Pe=Se.getBucket(I);if(!Pe)continue;let Ve=Pe.programConfigurations.get(I.id),We=v.context.program.get(),Re=v.useProgram(ae,Ve),st=Me||Re.program!==We,Rt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(we),Qt=J.constantOr(null);if(Qt&&Se.imageAtlas){let Lt=Se.imageAtlas,li=Lt.patternPositions[Qt.to.toString()],Hi=Lt.patternPositions[Qt.from.toString()];li&&Hi&&Ve.setConstantPatternPositions(li,Hi)}let si=_e.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),oi=_e.getPixelScale(),Si=ee?qp(v,Se,I,oi,te):H?ka(v,Se,I,oi,H,te):re?Gp(v,Se,I,oi,Pe.lineClipsArray.length):bc(v,Se,I,oi);if(ee)ue.activeTexture.set(ie.TEXTURE0),Se.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Ve.updatePaintBuffers(te);else if(H&&(st||v.lineAtlas.dirty))ue.activeTexture.set(ie.TEXTURE0),v.lineAtlas.bind(ue);else if(re){let Lt=Pe.gradients[I.id],li=Lt.texture;if(I.gradientVersion!==Lt.version){let Hi=256;if(I.stepInterpolant){let rn=S.getSource().maxzoom,un=we.canonical.z===rn?Math.ceil(1<<v.transform.maxZoom-we.canonical.z):1;Hi=r.ah(r.c3(Pe.maxLineLength/r.$*1024*un),256,ue.maxTextureSize)}Lt.gradient=r.c4({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:Hi,image:Lt.gradient||void 0,clips:Pe.lineClipsArray}),Lt.texture?Lt.texture.update(Lt.gradient):Lt.texture=new r.T(ue,Lt.gradient,ie.RGBA),Lt.version=I.gradientVersion,li=Lt.texture}ue.activeTexture.set(ie.TEXTURE0),li.bind(I.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}let Mi=v.stencilModeForClipping(we);Re.draw(ue,ie.TRIANGLES,N,Mi,X,wt.disabled,Si,Rt,si,I.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,I.paint,v.transform.zoom,Ve,Pe.layoutVertexBuffer2),Me=!1}})(e,a,h,m,g):r.cf(h)?(function(v,S,I,P,E){let D=I.paint.get("fill-color"),L=I.paint.get("fill-opacity");if(L.constantOr(1)===0)return;let{isRenderingToTexture:O}=E,N=v.colorModeForRenderPass(),X=I.paint.get("fill-pattern"),H=v.opaquePassEnabledForLayer()&&!X.constantOr(1)&&D.constantOr(r.bf.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===H){let J=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?At.ReadWrite:At.ReadOnly);Ac(v,S,I,P,J,N,!1,O)}if(v.renderPass==="translucent"&&I.paint.get("fill-antialias")){let J=v.getDepthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,At.ReadOnly);Ac(v,S,I,P,J,N,!0,O)}})(e,a,h,m,g):r.cg(h)?(function(v,S,I,P,E){let D=I.paint.get("fill-extrusion-opacity");if(D===0)return;let{isRenderingToTexture:L}=E;if(v.renderPass==="translucent"){let O=new At(v.context.gl.LEQUAL,At.ReadWrite,v.depthRangeFor3D);if(D!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))mh(v,S,I,P,O,Kt.disabled,_i.disabled,L),mh(v,S,I,P,O,v.stencilModeFor3D(),v.colorModeForRenderPass(),L);else{let N=v.colorModeForRenderPass();mh(v,S,I,P,O,Kt.disabled,N,L)}}})(e,a,h,m,g):r.ch(h)?(function(v,S,I,P,E){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;let{isRenderingToTexture:D}=E,L=v.context,O=v.style.projection.useSubdivision,N=v.getDepthModeForSublayer(0,At.ReadOnly),X=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(H,J,ee,re,te,ae,ue){let ie=H.context,_e=ie.gl;for(let Me of ee){let we=J.getTile(Me),Se=we.dem;if(!Se||!Se.data||!we.needsHillshadePrepare)continue;let Pe=Se.dim,Ve=Se.stride,We=Se.getPixels();if(ie.activeTexture.set(_e.TEXTURE1),ie.pixelStoreUnpackPremultiplyAlpha.set(!1),we.demTexture=we.demTexture||H.getTileTexture(Ve),we.demTexture){let st=we.demTexture;st.update(We,{premultiply:!1}),st.bind(_e.NEAREST,_e.CLAMP_TO_EDGE)}else we.demTexture=new r.T(ie,We,_e.RGBA,{premultiply:!1}),we.demTexture.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);ie.activeTexture.set(_e.TEXTURE0);let Re=we.fbo;if(!Re){let st=new r.T(ie,{width:Pe,height:Pe,data:null},_e.RGBA);st.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Re=we.fbo=ie.createFramebuffer(Pe,Pe,!0,!1),Re.colorAttachment.set(st.texture)}ie.bindFramebuffer.set(Re.framebuffer),ie.viewport.set([0,0,Pe,Pe]),H.useProgram("hillshadePrepare").draw(ie,_e.TRIANGLES,te,ae,ue,wt.disabled,Vp(we.tileID,Se),null,null,re.id,H.rasterBoundsBuffer,H.quadTriangleIndexBuffer,H.rasterBoundsSegments),we.needsHillshadePrepare=!1}})(v,S,P,I,N,Kt.disabled,X),L.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(O){let[H,J,ee]=v.stencilConfigForOverlapTwoPass(P);za(v,S,I,ee,H,N,X,!1,D),za(v,S,I,ee,J,N,X,!0,D)}else{let[H,J]=v.getStencilConfigForOverlapAndUpdateStencilID(P);za(v,S,I,J,H,N,X,!1,D)}})(e,a,h,m,g):r.ci(h)?(function(v,S,I,P,E){if(v.renderPass!=="translucent"||!P.length)return;let{isRenderingToTexture:D}=E,L=v.style.projection.useSubdivision,O=v.getDepthModeForSublayer(0,At.ReadOnly),N=v.colorModeForRenderPass();if(L){let[X,H,J]=v.stencilConfigForOverlapTwoPass(P);fh(v,S,I,J,X,O,N,!1,D),fh(v,S,I,J,H,O,N,!0,D)}else{let[X,H]=v.getStencilConfigForOverlapAndUpdateStencilID(P);fh(v,S,I,H,X,O,N,!1,D)}})(e,a,h,m,g):r.cj(h)?(function(v,S,I,P,E){if(v.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!P.length)return;let{isRenderingToTexture:D}=E,L=S.getSource(),O=v.style.projection.useSubdivision;if(L instanceof ro)Oa(v,S,I,P,null,!1,!1,L.tileCoords,L.flippedWindingOrder,D);else if(O){let[N,X,H]=v.stencilConfigForOverlapTwoPass(P);Oa(v,S,I,H,N,!1,!0,kc,!1,D),Oa(v,S,I,H,X,!0,!0,kc,!1,D)}else{let[N,X]=v.getStencilConfigForOverlapAndUpdateStencilID(P);Oa(v,S,I,X,N,!1,!0,kc,!1,D)}})(e,a,h,m,g):r.ck(h)?(function(v,S,I,P,E){let D=I.paint.get("background-color"),L=I.paint.get("background-opacity");if(L===0)return;let{isRenderingToTexture:O}=E,N=v.context,X=N.gl,H=v.style.projection,J=v.transform,ee=J.tileSize,re=I.paint.get("background-pattern");if(v.isPatternMissing(re))return;let te=!re&&D.a===1&&L===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==te)return;let ae=Kt.disabled,ue=v.getDepthModeForSublayer(0,te==="opaque"?At.ReadWrite:At.ReadOnly),ie=v.colorModeForRenderPass(),_e=v.useProgram(re?"backgroundPattern":"background"),Me=P||ve(J,{tileSize:ee,terrain:v.style.map.terrain});re&&(N.activeTexture.set(X.TEXTURE0),v.imageManager.bind(v.context));let we=I.getCrossfadeParameters();for(let Se of Me){let Pe=J.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Ve=re?Hp(L,v,re,{tileID:Se,tileSize:ee},we):Zp(L,D),We=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Se),Re=H.getMeshFromTileID(N,Se.canonical,!1,!0,"raster");_e.draw(N,X.TRIANGLES,ue,ae,ie,wt.backCCW,Ve,We,Pe,I.id,Re.vertexBuffer,Re.indexBuffer,Re.segments)}})(e,0,h,m,g):r.cl(h)&&(function(v,S,I,P){let{isRenderingGlobe:E}=P,D=v.context,L=I.implementation,O=v.style.projection,N=v.transform,X=N.getProjectionDataForCustomLayer(E),H={farZ:N.farZ,nearZ:N.nearZ,fov:N.fov*Math.PI/180,modelViewProjectionMatrix:N.modelViewProjectionMatrix,projectionMatrix:N.projectionMatrix,shaderData:{variantName:O.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${O.shaderPreludeCode.vertexSource}`,define:O.shaderDefine},defaultProjectionData:X},J=L.renderingMode?L.renderingMode:"2d";if(v.renderPass==="offscreen"){let ee=L.prerender;ee&&(v.setCustomLayerDefaults(),D.setColorMode(v.colorModeForRenderPass()),ee.call(L,D.gl,H),D.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),D.setColorMode(v.colorModeForRenderPass()),D.setStencilMode(Kt.disabled);let ee=J==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,At.ReadOnly);D.setDepthMode(ee),L.render(D.gl,H),D.setDirty(),v.setBaseState(),D.bindFramebuffer.set(null)}})(e,0,h,g))}saveTileTexture(e){let a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let a=this.imageManager.getPattern(e.from.toString()),h=this.imageManager.getPattern(e.to.toString());return!a||!h}useProgram(e,a,h=!1,m=[]){this.cache=this.cache||{};let g=!!this.style.map.terrain,v=this.style.projection,S=h?zr.projectionMercator:v.shaderPreludeCode,I=h?Po:v.shaderDefine,P=e+(a?a.cacheKey:"")+`/${h?Ta:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(g?"/terrain":"")+(m?`/${m.join("/")}`:"");return this.cache[P]||(this.cache[P]=new Yu(this.context,zr[e],a,rh[e],this._showOverdrawInspector,g,S,I,m)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}function Fa(f,e){let a,h=!1,m=null,g=null,v=()=>{m=null,h&&(f.apply(g,a),m=setTimeout(v,e),h=!1)};return(...S)=>(h=!0,g=this,a=S,m||v(),m)}class Rc{constructor(e){this._getCurrentHash=()=>{let a=window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(h=m)}),(h&&h[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{let a=this._getCurrentHash();if(!this._isValidHash(a))return!1;let h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{let a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{let a=this._getCurrentHash();if(a.length===0)return;let h=a.join("/"),m=h;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${h}`);let g=window.location.hash.replace(m,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let v=window.location.href.replace(/(#.+)?$/,g);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Fa(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let a=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,m),v=Math.round(a.lng*g)/g,S=Math.round(a.lat*g)/g,I=this._map.getBearing(),P=this._map.getPitch(),E="";if(E+=e?`/${v}/${S}/${h}`:`${h}/${S}/${v}`,(I||P)&&(E+="/"+Math.round(10*I)/10),P&&(E+=`/${Math.round(P)}`),this._hashName){let D=this._hashName,L=!1,O=window.location.hash.slice(1).split("&").map(N=>{let X=N.split("=")[0];return X===D?(L=!0,`${X}=${E}`):N}).filter(N=>N);return L||O.push(`${D}=${E}`),`#${O.join("&")}`}return`#${E}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new r.S(+e[2],+e[1])}catch{return!1}let a=+e[0],h=+(e[3]||0),m=+(e[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&h>=-180&&h<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}let Ao={linearity:.3,easing:r.cm(0,0,.3,1)},vh=r.e({deceleration:2500,maxSpeed:1400},Ao),ud=r.e({deceleration:20,maxSpeed:1400},Ao),hd=r.e({deceleration:1e3,maxSpeed:360},Ao),pd=r.e({deceleration:1e3,maxSpeed:90},Ao),dd=r.e({deceleration:1e3,maxSpeed:360},Ao);class md{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:U.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,a=U.now();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let a={zoom:0,bearing:0,pitch:0,roll:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:g}of this._inertiaBuffer)a.zoom+=g.zoomDelta||0,a.bearing+=g.bearingDelta||0,a.pitch+=g.pitchDelta||0,a.roll+=g.rollDelta||0,g.panDelta&&a.pan._add(g.panDelta),g.around&&(a.around=g.around),g.pinchAround&&(a.pinchAround=g.pinchAround);let h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){let g=_s(a.pan.mag(),h,r.e({},vh,e||{})),v=a.pan.mult(g.amount/a.pan.mag()),S=this._map.cameraHelper.handlePanInertia(v,this._map.transform);m.center=S.easingCenter,m.offset=S.easingOffset,Br(m,g)}if(a.zoom){let g=_s(a.zoom,h,ud);m.zoom=this._map.transform.zoom+g.amount,Br(m,g)}if(a.bearing){let g=_s(a.bearing,h,hd);m.bearing=this._map.transform.bearing+r.ah(g.amount,-179,179),Br(m,g)}if(a.pitch){let g=_s(a.pitch,h,pd);m.pitch=this._map.transform.pitch+g.amount,Br(m,g)}if(a.roll){let g=_s(a.roll,h,dd);m.roll=this._map.transform.roll+r.ah(g.amount,-179,179),Br(m,g)}if(m.zoom||m.bearing){let g=a.pinchAround===void 0?a.around:a.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),r.e(m,{noMoveStart:!0})}}function Br(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function _s(f,e,a){let{maxSpeed:h,linearity:m,deceleration:g}=a,v=r.ah(f*m/(e/1e3),-h,h),S=Math.abs(v)/(g*m);return{easing:a.easing,duration:1e3*S,amount:v*(S/2)}}class Jn extends r.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,h,m={}){h=h instanceof MouseEvent?h:new MouseEvent(e,h);let g=F.mousePos(a.getCanvas(),h),v=a.unproject(g);super(e,r.e({point:g,lngLat:v,originalEvent:h},m)),this._defaultPrevented=!1,this.target=a}}class ys extends r.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,h){let m=e==="touchend"?h.changedTouches:h.touches,g=F.touchPos(a.getCanvasContainer(),m),v=g.map(I=>a.unproject(I)),S=g.reduce((I,P,E,D)=>I.add(P.div(D.length)),new r.P(0,0));super(e,{points:g,point:S,lngLats:v,lngLat:a.unproject(S),originalEvent:h}),this._defaultPrevented=!1}}class xh extends r.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,h){super(e,{originalEvent:h}),this._defaultPrevented=!1}}class fd{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new xh(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new Jn(e.type,this._map,e))}mouseup(e){this._map.fire(new Jn(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Jn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Jn(e.type,this._map,e))}mouseover(e){this._map.fire(new Jn(e.type,this._map,e))}mouseout(e){this._map.fire(new Jn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ys(e.type,this._map,e))}touchmove(e){this._map.fire(new ys(e.type,this._map,e))}touchend(e){this._map.fire(new ys(e.type,this._map,e))}touchcancel(e){this._map.fire(new ys(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gd{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Jn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Jn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Jn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vs{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(r.P.convert(e),this._map.terrain)}}class bh{constructor(e,a){this._map=e,this._tr=new vs(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(F.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;let h=a;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;let m=this._startPos;this._lastPos=h,this._box||(this._box=F.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let g=Math.min(m.x,h.x),v=Math.max(m.x,h.x),S=Math.min(m.y,h.y),I=Math.max(m.y,h.y);F.setTransform(this._box,`translate(${g}px,${S}px)`),this._box.style.width=v-g+"px",this._box.style.height=I-S+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;let h=this._startPos,m=a;if(this.reset(),F.suppressClick(),h.x!==m.x||h.y!==m.y)return this._map.fire(new r.l("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(h,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new r.l(e,{originalEvent:a}))}}function xs(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);let a={};for(let h=0;h<f.length;h++)a[f[h].identifier]=e[h];return a}class _d{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),h.length===this.numTouches&&(this.centroid=(function(m){let g=new r.P(0,0);for(let v of m)g._add(v);return g.div(m.length)})(a),this.touches=xs(h,a)))}touchmove(e,a,h){if(this.aborted||!this.centroid)return;let m=xs(h,a);for(let g in this.touches){let v=m[g];(!v||v.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,a,h){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){let m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Yn{constructor(e){this.singleTap=new _d(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,h){this.singleTap.touchstart(e,a,h)}touchmove(e,a,h){this.singleTap.touchmove(e,a,h)}touchend(e,a,h){let m=this.singleTap.touchend(e,a,h);if(m){let g=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(m)<30;if(g&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class jr{constructor(e){this._tr=new vs(e),this._zoomIn=new Yn({numTouches:1,numTaps:2}),this._zoomOut=new Yn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,h){this._zoomIn.touchstart(e,a,h),this._zoomOut.touchstart(e,a,h)}touchmove(e,a,h){this._zoomIn.touchmove(e,a,h),this._zoomOut.touchmove(e,a,h)}touchend(e,a,h){let m=this._zoomIn.touchend(e,a,h),g=this._zoomOut.touchend(e,a,h),v=this._tr;return m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(m)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bs{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;let h=this._lastPoint;if(!h)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let m=Array.isArray(a)?a[0]:a;return!this._moved&&m.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(h,m))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&F.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Ur=0,ws=2,Xf={[Ur]:1,[ws]:2};class Sl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let a=F.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(a,h){let m=Xf[h];return a.buttons===void 0||(a.buttons&m)!==m})(e,this._eventButton)}isValidEndEvent(e){return F.mouseButton(e)===this._eventButton}}class Jf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Yf{constructor(e=new Sl({checkCorrectEvent:()=>!0}),a=new Jf){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(e,a,h){return e instanceof MouseEvent?a(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?h(e):void 0}startMove(e){this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.startMove(a),a=>this.oneFingerTouchMoveStateManager.startMove(a))}endMove(e){this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.endMove(a),a=>this.oneFingerTouchMoveStateManager.endMove(a))}isValidStartEvent(e){return this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.isValidStartEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a))}isValidMoveEvent(e){return this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.isValidMoveEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a))}isValidEndEvent(e){return this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.isValidEndEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a))}}let Il=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}};class Tl{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,h){return this._calculateTransform(e,a,h)}touchmove(e,a,h){if(this._active){if(!this._shouldBePrevented(h.length))return e.preventDefault(),this._calculateTransform(e,a,h);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,h){this._calculateTransform(e,a,h),this._active&&this._shouldBePrevented(h.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,h){h.length>0&&(this._active=!0);let m=xs(h,a),g=new r.P(0,0),v=new r.P(0,0),S=0;for(let P in m){let E=m[P],D=this._touches[P];D&&(g._add(E),v._add(E.sub(D)),S++,m[P]=E)}if(this._touches=m,this._shouldBePrevented(S)||!v.mag())return;let I=v.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,h){if(!this._firstTwoTouches)return;e.preventDefault();let[m,g]=this._firstTwoTouches,v=tt(h,a,m),S=tt(h,a,g);if(!v||!S)return;let I=this._aroundCenter?null:v.add(S).div(2);return this._move([v,S],I,e)}touchend(e,a,h){if(!this._firstTwoTouches)return;let[m,g]=this._firstTwoTouches,v=tt(h,a,m),S=tt(h,a,g);v&&S||(this._active&&F.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function tt(f,e,a){for(let h=0;h<f.length;h++)if(f[h].identifier===a)return e[h]}function wh(f,e){return Math.log(f/e)/Math.LN2}class zc extends Nr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){let h=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(wh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wh(this._distance,h),pinchAround:a}}}function Sh(f,e){return 180*f.angleWith(e)/Math.PI}class Ss extends Nr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,h){let m=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Sh(this._vector,m),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let a=25/(Math.PI*this._minDiameter)*360,h=Sh(e,this._startVector);return Math.abs(h)<a}}function Ba(f){return Math.abs(f.y)>Math.abs(f.x)}class Oc extends Nr{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,h){super.touchstart(e,a,h),this._currentTouchCount=h.length}_start(e){this._lastPoints=e,Ba(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let m=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,g,h.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(m.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,h){if(this._valid!==void 0)return this._valid;let m=e.mag()>=2,g=a.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;let v=e.y>0==a.y>0;return Ba(e)&&Ba(a)&&v}}let qt={panStep:100,bearingStep:15,pitchStep:10};class Fc{constructor(e){this._tr=new vs(e);let a=qt;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,h=0,m=0,g=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?h=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?h=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?m=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?m=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:S=>{let I=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Qf,zoom:a?Math.round(I.zoom)+a*(e.shiftKey?2:1):I.zoom,bearing:I.bearing+h*this._bearingStep,pitch:I.pitch+m*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:I.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qf(f){return f*(2-f)}let Bc=4.000244140625,eg=1/450;class yd{constructor(e,a){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=e,this._tr=new vs(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=eg}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,h=U.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%Bc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=F.mousePos(this._map.getCanvas(),e),h=this._tr;this._aroundPoint=this._aroundCenter?h.transform.locationToScreenPoint(r.S.convert(h.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let S=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){let S=this._type==="wheel"&&Math.abs(this._delta)>Bc?this._wheelZoomRate:this._defaultZoomRate,I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);let P=typeof this._targetZoom!="number"?e.scale:r.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),r.ak(P*I)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let a=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,h=this._startZoom,m=this._easing,g,v=!1;if(this._type==="wheel"&&h&&m){let S=U.now()-this._lastWheelEventTime,I=Math.min((S+5)/200,1),P=m(I);g=r.C.number(h,a,P),I<1?this._frameId||(this._frameId=!0):v=!0}else g=a,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!v,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=r.co;if(this._prevEase){let h=this._prevEase,m=(U.now()-h.start)/h.duration,g=h.easing(m+.01)-h.easing(m),v=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-v*v);a=r.cm(v,S,.25,1)}return this._prevEase={start:U.now(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ih{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Th{constructor(e){this._tr=new vs(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vd{constructor(){this._tap=new Yn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,h){if(!this._swipePoint)if(this._tapTime){let m=a[0],g=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(m)<30;g&&v?h.length>0&&(this._swipePoint=m,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(e,a,h)}touchmove(e,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;let m=a[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,a,h)}touchend(e,a,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{let m=this._tap.touchend(e,a,h);m&&(this._tapTime=e.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xd{constructor(e,a,h){this._el=e,this._mousePan=a,this._touchPan=h}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ch{constructor(e,a,h,m){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=a,this._mousePitch=h,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class bd{constructor(e,a,h,m){this._el=e,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class wd{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=F.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=a,this._container.appendChild(m);let g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=h,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(F.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new r.l("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let Vr=f=>f.zoom||f.drag||f.roll||f.pitch||f.rotate;class xi extends r.l{}function Is(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta||f.rollDelta}class Ph{constructor(e,a){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,g)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let v=m.type==="renderFrame"?void 0:m,S={needsRenderFrame:!1},I={},P={};for(let{handlerName:L,handler:O,allowed:N}of this._handlers){if(!O.isEnabled())continue;let X;if(this._blockedByActive(P,N,L))O.reset();else if(O[g||m.type]){if(r.cp(m,g||m.type)){let H=F.mousePos(this._map.getCanvas(),m);X=O[g||m.type](m,H)}else if(r.cq(m,g||m.type)){let H=this._getMapTouches(m.touches),J=F.touchPos(this._map.getCanvas(),H);X=O[g||m.type](m,J,H)}else r.cr(g||m.type)||(X=O[g||m.type](m));this.mergeHandlerResult(S,I,X,L,v),X&&X.needsRenderFrame&&this._triggerRenderFrame()}(X||O.isActive())&&(P[L]=O)}let E={};for(let L in this._previousActiveHandlers)P[L]||(E[L]=v);this._previousActiveHandlers=P,(Object.keys(E).length||Is(S))&&(this._changes.push([S,I,E]),this._triggerRenderFrame()),(Object.keys(P).length||Is(S))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:D}=S;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new md(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);let h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(let[m,g,v]of this._listeners)F.addEventListener(m,g,m===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(let[e,a,h]of this._listeners)F.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(e){let a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new fd(a,e));let m=a.boxZoom=new bh(a,e);this._add("boxZoom",m),e.interactive&&e.boxZoom&&m.enable();let g=a.cooperativeGestures=new wd(a,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();let v=new jr(a),S=new Th(a);a.doubleClickZoom=new Ih(S,v),this._add("tapZoom",v),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();let I=new vd;this._add("tapDragZoom",I);let P=a.touchPitch=new Oc(a);this._add("touchPitch",P),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);let E=()=>a.project(a.getCenter()),D=(function({enable:te,clickTolerance:ae,aroundCenter:ue=!0,minPixelCenterThreshold:ie=100,rotateDegreesPerPixelMoved:_e=.8},Me){let we=new Sl({checkCorrectEvent:Se=>F.mouseButton(Se)===0&&Se.ctrlKey||F.mouseButton(Se)===2&&!Se.ctrlKey});return new bs({clickTolerance:ae,move:(Se,Pe)=>{let Ve=Me();if(ue&&Math.abs(Ve.y-Se.y)>ie)return{bearingDelta:r.cn(new r.P(Se.x,Pe.y),Pe,Ve)};let We=(Pe.x-Se.x)*_e;return ue&&Pe.y<Ve.y&&(We=-We),{bearingDelta:We}},moveStateManager:we,enable:te,assignEvents:Il})})(e,E),L=(function({enable:te,clickTolerance:ae,pitchDegreesPerPixelMoved:ue=-.5}){let ie=new Sl({checkCorrectEvent:_e=>F.mouseButton(_e)===0&&_e.ctrlKey||F.mouseButton(_e)===2});return new bs({clickTolerance:ae,move:(_e,Me)=>({pitchDelta:(Me.y-_e.y)*ue}),moveStateManager:ie,enable:te,assignEvents:Il})})(e),O=(function({enable:te,clickTolerance:ae,rollDegreesPerPixelMoved:ue=.3},ie){let _e=new Sl({checkCorrectEvent:Me=>F.mouseButton(Me)===2&&Me.ctrlKey});return new bs({clickTolerance:ae,move:(Me,we)=>{let Se=ie(),Pe=(we.x-Me.x)*ue;return we.y<Se.y&&(Pe=-Pe),{rollDelta:Pe}},moveStateManager:_e,enable:te,assignEvents:Il})})(e,E);a.dragRotate=new Ch(e,D,L,O),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate","mouseRoll"]),this._add("mouseRoll",O,["mousePitch"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();let N=(function({enable:te,clickTolerance:ae}){let ue=new Sl({checkCorrectEvent:ie=>F.mouseButton(ie)===0&&!ie.ctrlKey});return new bs({clickTolerance:ae,move:(ie,_e)=>({around:_e,panDelta:_e.sub(ie)}),activateOnStart:!0,moveStateManager:ue,enable:te,assignEvents:Il})})(e),X=new Tl(e,a);a.dragPan=new xd(h,N,X),this._add("mousePan",N),this._add("touchPan",X,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);let H=new Ss,J=new zc;a.touchZoomRotate=new bd(h,J,H,I),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate);let ee=a.scrollZoom=new yd(a,()=>this._triggerRenderFrame());this._add("scrollZoom",ee,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);let re=a.keyboard=new Fc(a);this._add("keyboard",re),e.interactive&&e.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new gd(a))}_add(e,a,h){this._handlers.push({handlerName:e,handler:a,allowed:h}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,h){for(let m in e)if(m!==h&&(!a||a.indexOf(m)<0))return!0;return!1}_getMapTouches(e){let a=[];for(let h of e)this._el.contains(h.target)&&a.push(h);return a}mergeHandlerResult(e,a,h,m,g){if(!h)return;r.e(e,h);let v={handlerName:m,originalEvent:h.originalEvent||g};h.zoomDelta!==void 0&&(a.zoom=v),h.panDelta!==void 0&&(a.drag=v),h.rollDelta!==void 0&&(a.roll=v),h.pitchDelta!==void 0&&(a.pitch=v),h.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){let e={},a={},h={};for(let[m,g,v]of this._changes)m.panDelta&&(e.panDelta=(e.panDelta||new r.P(0,0))._add(m.panDelta)),m.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(e.rollDelta=(e.rollDelta||0)+m.rollDelta),m.around!==void 0&&(e.around=m.around),m.pinchAround!==void 0&&(e.pinchAround=m.pinchAround),m.noInertia&&(e.noInertia=m.noInertia),r.e(a,g),r.e(h,v);this._updateMapTransform(e,a,h),this._changes=[]}_updateMapTransform(e,a,h){let m=this._map,g=m._getTransformForUpdate(),v=m.terrain;if(!(Is(e)||v&&this._terrainMovement))return this._fireEvents(a,h,!0);m._stop(!0);let{panDelta:S,zoomDelta:I,bearingDelta:P,pitchDelta:E,rollDelta:D,around:L,pinchAround:O}=e;O!==void 0&&(L=O),L=L||m.transform.centerPoint,v&&!g.isPointOnMapSurface(L)&&(L=g.centerPoint);let N={panDelta:S,zoomDelta:I,rollDelta:D,pitchDelta:E,bearingDelta:P,around:L};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(L)&&(L=g.centerPoint);let X=L.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(S?L.sub(S):L);v?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(N,g),this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(N,g,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(N,g,X))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(N,g),this._map.cameraHelper.handleMapControlsPan(N,g,X)),m._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,h,!0)}_fireEvents(e,a,h){let m=Vr(this._eventsInProgress),g=Vr(e),v={};for(let D in e){let{originalEvent:L}=e[D];this._eventsInProgress[D]||(v[`${D}start`]=L),this._eventsInProgress[D]=e[D]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(let D in v)this._fireEvent(D,v[D]);g&&this._fireEvent("move",g.originalEvent);for(let D in e){let{originalEvent:L}=e[D];this._fireEvent(D,L)}let S={},I;for(let D in this._eventsInProgress){let{handlerName:L,originalEvent:O}=this._eventsInProgress[D];this._handlersById[L].isActive()||(delete this._eventsInProgress[D],I=a[L]||O,S[`${D}end`]=I)}for(let D in S)this._fireEvent(D,S[D]);let P=Vr(this._eventsInProgress),E=(m||g)&&!P;if(E&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let D=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&D.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(D)}if(h&&E){this._updatingCamera=!0;let D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!D||!D.essential&&U.prefersReducedMotion?(this._map.fire(new r.l("moveend",{originalEvent:I})),L(this._map.getBearing())&&this._map.resetNorth()):(L(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new r.l(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new xi("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Sd extends r.E{constructor(e,a,h){super(),this._renderFrameCallback=()=>{let m=Math.min((U.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=h.bearingSnap,this.cameraHelper=a,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,a){e.apply(this.transform),this.transform=e,this.cameraHelper=a}getCenter(){return new r.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,a){return this.jumpTo({elevation:e},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,a,h){return e=r.P.convert(e).mult(-1),this.panTo(this.transform.center,r.e({offset:e},a),h)}panTo(e,a,h){return this.easeTo(r.e({center:e},a),h)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,h){return this.easeTo(r.e({zoom:e},a),h)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,a){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new r.l("movestart",a)).fire(new r.l("move",a)).fire(new r.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,h){return this.easeTo(r.e({bearing:e},a),h)}resetNorth(e,a){return this.rotateTo(0,r.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(r.e({bearing:0,pitch:0,roll:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}getRoll(){return this.transform.roll}setRoll(e,a){return this.jumpTo({roll:e},a),this}cameraForBounds(e,a){e=Di.convert(e).adjustAntiMeridian();let h=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),h,a)}_cameraForBoxAndBearing(e,a,h,m){let g={top:0,bottom:0,right:0,left:0};if(typeof(m=r.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){let P=m.padding;m.padding={top:P,bottom:P,right:P,left:P}}let v=r.e(g,m.padding);m.padding=v;let S=this.transform,I=new Di(e,a);return this.cameraHelper.cameraForBoxAndBearing(m,v,I,h,S)}fitBounds(e,a,h){return this._fitInternal(this.cameraForBounds(e,a),a,h)}fitScreenCoordinates(e,a,h,m,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(r.P.convert(e)),this.transform.screenPointToLocation(r.P.convert(a)),h,m),m,g)}_fitInternal(e,a,h){return e?(delete(a=r.e(e,a)).padding,a.linear?this.easeTo(a,h):this.flyTo(a,h)):this}jumpTo(e,a){this.stop();let h=this._getTransformForUpdate(),m=!1,g=!1,v=!1,S=h.zoom;this.cameraHelper.handleJumpToCenterZoom(h,e);let I=h.zoom!==S;return"elevation"in e&&h.elevation!==+e.elevation&&h.setElevation(+e.elevation),"bearing"in e&&h.bearing!==+e.bearing&&(m=!0,h.setBearing(+e.bearing)),"pitch"in e&&h.pitch!==+e.pitch&&(g=!0,h.setPitch(+e.pitch)),"roll"in e&&h.roll!==+e.roll&&(v=!0,h.setRoll(+e.roll)),e.padding==null||h.isPaddingEqual(e.padding)||h.setPadding(e.padding),this._applyUpdatedTransform(h),this.fire(new r.l("movestart",a)).fire(new r.l("move",a)),I&&this.fire(new r.l("zoomstart",a)).fire(new r.l("zoom",a)).fire(new r.l("zoomend",a)),m&&this.fire(new r.l("rotatestart",a)).fire(new r.l("rotate",a)).fire(new r.l("rotateend",a)),g&&this.fire(new r.l("pitchstart",a)).fire(new r.l("pitch",a)).fire(new r.l("pitchend",a)),v&&this.fire(new r.l("rollstart",a)).fire(new r.l("roll",a)).fire(new r.l("rollend",a)),this.fire(new r.l("moveend",a))}calculateCameraOptionsFromTo(e,a,h,m=0){let g=r.a1.fromLngLat(e,a),v=r.a1.fromLngLat(h,m),S=v.x-g.x,I=v.y-g.y,P=v.z-g.z,E=Math.hypot(S,I,P);if(E===0)throw new Error("Can't calculate camera options with same From and To");let D=Math.hypot(S,I),L=r.ak(this.transform.cameraToCenterDistance/E/this.transform.tileSize),O=180*Math.atan2(S,-I)/Math.PI,N=180*Math.acos(D/E)/Math.PI;return N=P<0?90-N:90+N,{center:v.toLngLat(),elevation:m,zoom:L,pitch:N,bearing:O}}calculateCameraOptionsFromCameraLngLatAltRotation(e,a,h,m,g){let v=this.transform.calculateCenterFromCameraLngLatAlt(e,a,h,m);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:h,pitch:m,roll:g}}easeTo(e,a){this._stop(!1,e.easeId),((e=r.e({offset:[0,0],duration:500,easing:r.co},e)).animate===!1||!e.essential&&U.prefersReducedMotion)&&(e.duration=0);let h=this._getTransformForUpdate(),m=this.getBearing(),g=h.pitch,v=h.roll,S="bearing"in e?this._normalizeBearing(e.bearing,m):m,I="pitch"in e?+e.pitch:g,P="roll"in e?this._normalizeBearing(e.roll,v):v,E="padding"in e?e.padding:h.padding,D=r.P.convert(e.offset),L,O;e.around&&(L=r.S.convert(e.around),O=h.locationToScreenPoint(L));let N={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},X=this.cameraHelper.handleEaseTo(h,{bearing:S,pitch:I,roll:P,padding:E,around:L,aroundPoint:O,offsetAsPoint:D,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||m!==S,this._pitching=this._pitching||I!==g,this._rolling=this._rolling||P!==v,this._padding=!h.isPaddingEqual(E),this._zooming=this._zooming||X.isZooming,this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,N),this.terrain&&this._prepareElevation(X.elevationCenter),this._ease(H=>{X.easeFunc(H),this.terrain&&!e.freezeElevation&&this._updateElevation(H),this._applyUpdatedTransform(h),this._fireMoveEvents(a)},H=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,H)},e),this}_prepareEase(e,a,h={}){this._moving=!0,a||h.moving||this.fire(new r.l("movestart",e)),this._zooming&&!h.zooming&&this.fire(new r.l("zoomstart",e)),this._rotating&&!h.rotating&&this.fire(new r.l("rotatestart",e)),this._pitching&&!h.pitching&&this.fire(new r.l("pitchstart",e)),this._rolling&&!h.rolling&&this.fire(new r.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){let h=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(h-(a-(h*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.setElevation(r.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let a=e.getCameraLngLat(),h=e.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(a,e.zoom):0;if(h<m){let g=this.calculateCameraOptionsFromTo(a,m,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){let a=[];if(a.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&a.push(m=>this.transformCameraUpdate(m)),!a.length)return;let h=e.clone();for(let m of a){let g=h.clone(),{center:v,zoom:S,roll:I,pitch:P,bearing:E,elevation:D}=m(g);v&&g.setCenter(v),D!==void 0&&g.setElevation(D),S!==void 0&&g.setZoom(S),I!==void 0&&g.setRoll(I),P!==void 0&&g.setPitch(P),E!==void 0&&g.setBearing(E),h.apply(g)}this.transform.apply(h)}_fireMoveEvents(e){this.fire(new r.l("move",e)),this._zooming&&this.fire(new r.l("zoom",e)),this._rotating&&this.fire(new r.l("rotate",e)),this._pitching&&this.fire(new r.l("pitch",e)),this._rolling&&this.fire(new r.l("roll",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;let h=this._zooming,m=this._rotating,g=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,h&&this.fire(new r.l("zoomend",e)),m&&this.fire(new r.l("rotateend",e)),g&&this.fire(new r.l("pitchend",e)),v&&this.fire(new r.l("rollend",e)),this.fire(new r.l("moveend",e))}flyTo(e,a){if(!e.essential&&U.prefersReducedMotion){let Pe=r.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Pe,a)}this.stop(),e=r.e({offset:[0,0],speed:1.2,curve:1.42,easing:r.co},e);let h=this._getTransformForUpdate(),m=h.bearing,g=h.pitch,v=h.roll,S=h.padding,I="bearing"in e?this._normalizeBearing(e.bearing,m):m,P="pitch"in e?+e.pitch:g,E="roll"in e?this._normalizeBearing(e.roll,v):v,D="padding"in e?e.padding:h.padding,L=r.P.convert(e.offset),O=h.centerPoint.add(L),N=h.screenPointToLocation(O),X=this.cameraHelper.handleFlyTo(h,{bearing:I,pitch:P,roll:E,padding:D,locationAtOffset:N,offsetAsPoint:L,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),H=e.curve,J=Math.max(h.width,h.height),ee=J/X.scaleOfZoom,re=X.pixelPathLength;typeof X.scaleOfMinZoom=="number"&&(H=Math.sqrt(J/X.scaleOfMinZoom/re*2));let te=H*H;function ae(Pe){let Ve=(ee*ee-J*J+(Pe?-1:1)*te*te*re*re)/(2*(Pe?ee:J)*te*re);return Math.log(Math.sqrt(Ve*Ve+1)-Ve)}function ue(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function ie(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}let _e=ae(!1),Me=function(Pe){return ie(_e)/ie(_e+H*Pe)},we=function(Pe){return J*((ie(_e)*(ue(Ve=_e+H*Pe)/ie(Ve))-ue(_e))/te)/re;var Ve},Se=(ae(!0)-_e)/H;if(Math.abs(re)<2e-6||!isFinite(Se)){if(Math.abs(J-ee)<1e-6)return this.easeTo(e,a);let Pe=ee<J?-1:1;Se=Math.abs(Math.log(ee/J))/H,we=()=>0,Me=Ve=>Math.exp(Pe*H*Ve)}return e.duration="duration"in e?+e.duration:1e3*Se/("screenSpeed"in e?+e.screenSpeed/H:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=m!==I,this._pitching=P!==g,this._rolling=E!==v,this._padding=!h.isPaddingEqual(D),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(X.targetCenter),this._ease(Pe=>{let Ve=Pe*Se,We=1/Me(Ve),Re=we(Ve);this._rotating&&h.setBearing(r.C.number(m,I,Pe)),this._pitching&&h.setPitch(r.C.number(g,P,Pe)),this._rolling&&h.setRoll(r.C.number(v,E,Pe)),this._padding&&(h.interpolatePadding(S,D,Pe),O=h.centerPoint.add(L)),X.easeFunc(Pe,We,Re,O),this.terrain&&!e.freezeElevation&&this._updateElevation(Pe),this._applyUpdatedTransform(h),this._fireMoveEvents(a)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var h;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,a)}return e||(h=this.handlers)===null||h===void 0||h.stop(!1),this}_ease(e,a,h){h.animate===!1||h.duration===0?(e(1),a()):(this._easeStart=U.now(),this._easeOptions=h,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=r.aO(e,-180,180);let h=Math.abs(e-a);return Math.abs(e-360-a)<h&&(e-=360),Math.abs(e+360-a)<h&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(r.S.convert(e),this.transform.tileZoom):null}}let Mh={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Eh{constructor(e=Mh){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=F.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=F.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){let h=this._map._getUIString(`AttributionControl.${a}`);e.title=h,e.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}let a=this._map.style.sourceCaches;for(let m in a){let g=a[m];if(g.used||g.usedForTerrain){let v=g.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(m=>String(m).trim()),e.sort((m,g)=>m.length-g.length),e=e.filter((m,g)=>{for(let v=g+1;v<e.length;v++)if(e[v].indexOf(m)>=0)return!1;return!0});let h=e.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,e.length?(this._innerContainer.innerHTML=F.sanitize(h),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Id{constructor(e={}){this._updateCompact=()=>{let a=this._container.children;if(a.length){let h=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=F.create("div","maplibregl-ctrl");let a=F.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){F.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class uo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){let a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(let m of h)if(m.id===e)return void(m.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let a=this._currentlyRunning=this._queue;this._queue=[];for(let h of a)if(!h.cancelled&&(h.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var jc=r.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class ut extends r.E{constructor(e){super(),this._lastTilesetChange=U.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];let h={};for(let m of ve(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))h[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),r.bY(m.terrainRttPosMatrix32f,0,r.$,r.$,0,0,1),this._tiles[m.key]=new os(m,this.tileSize),this._lastTilesetChange=U.now());for(let m in this._tiles)h[m]||delete this._tiles[m]}freeRtt(e){for(let a in this._tiles){let h=this._tiles[a];(!e||h.tileID.equals(e)||h.tileID.isChildOf(e)||e.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,a){return a?this._getTerrainCoordsForTileRanges(e,a):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){let a={};for(let h of this._renderableTilesKeys){let m=this._tiles[h].tileID,g=e.clone(),v=r.ba();if(m.canonical.equals(e.canonical))r.bY(v,0,r.$,r.$,0,0,1);else if(m.canonical.isChildOf(e.canonical)){let S=m.canonical.z-e.canonical.z,I=m.canonical.x-(m.canonical.x>>S<<S),P=m.canonical.y-(m.canonical.y>>S<<S),E=r.$>>S;r.bY(v,0,E,E,0,0,1),r.M(v,v,[-I*E,-P*E,0])}else{if(!e.canonical.isChildOf(m.canonical))continue;{let S=e.canonical.z-m.canonical.z,I=e.canonical.x-(e.canonical.x>>S<<S),P=e.canonical.y-(e.canonical.y>>S<<S),E=r.$>>S;r.bY(v,0,r.$,r.$,0,0,1),r.M(v,v,[I*E,P*E,0]),r.N(v,v,[1/2**S,1/2**S,0])}}g.terrainRttPosMatrix32f=new Float32Array(v),a[h]=g}return a}_getTerrainCoordsForTileRanges(e,a){let h={};for(let m of this._renderableTilesKeys){let g=this._tiles[m].tileID;if(!this._isWithinTileRanges(g,a))continue;let v=e.clone(),S=r.ba();if(g.canonical.z===e.canonical.z){let I=e.canonical.x-g.canonical.x,P=e.canonical.y-g.canonical.y;r.bY(S,0,r.$,r.$,0,0,1),r.M(S,S,[I*r.$,P*r.$,0])}else if(g.canonical.z>e.canonical.z){let I=g.canonical.z-e.canonical.z,P=g.canonical.x-(g.canonical.x>>I<<I),E=g.canonical.y-(g.canonical.y>>I<<I),D=e.canonical.x-(g.canonical.x>>I),L=e.canonical.y-(g.canonical.y>>I),O=r.$>>I;r.bY(S,0,O,O,0,0,1),r.M(S,S,[-P*O+D*r.$,-E*O+L*r.$,0])}else{let I=e.canonical.z-g.canonical.z,P=e.canonical.x-(e.canonical.x>>I<<I),E=e.canonical.y-(e.canonical.y>>I<<I),D=(e.canonical.x>>I)-g.canonical.x,L=(e.canonical.y>>I)-g.canonical.y,O=r.$<<I;r.bY(S,0,O,O,0,0,1),r.M(S,S,[P*r.$+D*O,E*r.$+L*O,0])}v.terrainRttPosMatrix32f=new Float32Array(S),h[m]=v}return h}getSourceTile(e,a){let h=this.sourceCache._source,m=e.overscaledZ-this.deltaZoom;if(m>h.maxzoom&&(m=h.maxzoom),m<h.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(m).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&a)for(;m>=h.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(m--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,a){return a[e.canonical.z]&&e.canonical.x>=a[e.canonical.z].minTileX&&e.canonical.x<=a[e.canonical.z].maxTileX&&e.canonical.y>=a[e.canonical.z].minTileY&&e.canonical.y<=a[e.canonical.z].maxTileY}}class bt{constructor(e,a,h){this._meshCache={},this.painter=e,this.sourceCache=new ut(a),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,h,m=r.$){var g;if(!(a>=0&&a<m&&h>=0&&h<m))return 0;let v=this.getTerrainData(e),S=(g=v.tile)===null||g===void 0?void 0:g.dem;if(!S)return 0;let I=r.cs([],[a/m*r.$,h/m*r.$],v.u_terrain_matrix),P=[I[0]*S.dim,I[1]*S.dim],E=Math.floor(P[0]),D=Math.floor(P[1]),L=P[0]-E,O=P[1]-D;return S.get(E,D)*(1-L)*(1-O)+S.get(E+1,D)*L*(1-O)+S.get(E,D+1)*(1-L)*O+S.get(E+1,D+1)*L*O}getElevationForLngLatZoom(e,a){if(!r.ct(a,e.wrap()))return 0;let{tileID:h,mercatorX:m,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(h,m%r.$,g%r.$,r.$)}getElevation(e,a,h,m=r.$){return this.getDEMElevation(e,a,h,m)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let m=this.painter.context,g=new r.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new r.T(m,g,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new r.T(m,new r.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=r.ag([])}let a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){let m=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new r.T(m,a.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),a.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}let h=a&&a+a.tileID.key+e.key;if(h&&!this._demMatrixCache[h]){let m=this.sourceCache.sourceCache._source.maxzoom,g=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=m?g=e.canonical.z-m:r.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let v=e.canonical.x-(e.canonical.x>>g<<g),S=e.canonical.y-(e.canonical.y>>g<<g),I=r.cu(new Float64Array(16),[1/(r.$<<g),1/(r.$<<g),0]);r.M(I,I,[v*r.$,S*r.$,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){let a=this.painter,h=a.width/devicePixelRatio,m=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new r.T(a.context,{width:h,height:m,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new r.T(a.context,{width:h,height:m,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(h,m,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,h,m))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,v=0;g<this._coordsTextureSize;g++)for(let S=0;S<this._coordsTextureSize;S++,v+=4)a[v+0]=255&S,a[v+1]=255&g,a[v+2]=S>>8<<4|g>>8,a[v+3]=0;let h=new r.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),m=new r.T(e,h,e.gl.RGBA,{premultiply:!1});return m.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let a=new Uint8Array(4),h=this.painter.context,m=h.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(g,S-v-1,1,1,m.RGBA,m.UNSIGNED_BYTE,a),h.bindFramebuffer.set(null);let I=a[0]+(a[2]>>4<<8),P=a[1]+((15&a[2])<<8),E=this.coordsIndex[255-a[3]],D=E&&this.sourceCache.getTileByID(E);if(!D)return null;let L=this._coordsTextureSize,O=(1<<D.tileID.canonical.z)*L;return new r.a1((D.tileID.canonical.x*L+I)/O+D.tileID.wrap,(D.tileID.canonical.y*L+P)/O,this.getElevation(D.tileID,I,P,L))}depthAtPoint(e){let a=new Uint8Array(4),h=this.painter.context,m=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,a),h.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(e){var a;let h=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,m=h&&e.canonical.y===0,g=h&&e.canonical.y===(1<<e.canonical.z)-1,v=`m_${m?"n":""}_${g?"s":""}`;if(this._meshCache[v])return this._meshCache[v];let S=this.painter.context,I=new r.cv,P=new r.aN,E=this.meshSize,D=r.$/E,L=E*E;for(let ie=0;ie<=E;ie++)for(let _e=0;_e<=E;_e++)I.emplaceBack(_e*D,ie*D,0);for(let ie=0;ie<L;ie+=E+1)for(let _e=0;_e<E;_e++)P.emplaceBack(_e+ie,E+_e+ie+1,E+_e+ie+2),P.emplaceBack(_e+ie,E+_e+ie+2,_e+ie+1);let O=I.length,N=O+(E+1),X=(E+1)*E,H=m?r.bh:0,J=m?0:1,ee=g?r.bi:r.$,re=g?0:1;for(let ie=0;ie<=E;ie++)I.emplaceBack(ie*D,H,J);for(let ie=0;ie<=E;ie++)I.emplaceBack(ie*D,ee,re);for(let ie=0;ie<E;ie++)P.emplaceBack(X+ie,N+ie,N+ie+1),P.emplaceBack(X+ie,N+ie+1,X+ie+1),P.emplaceBack(0+ie,O+ie+1,O+ie),P.emplaceBack(0+ie,0+ie+1,O+ie+1);let te=I.length,ae=te+2*(E+1);for(let ie of[0,1])for(let _e=0;_e<=E;_e++)for(let Me of[0,1])I.emplaceBack(ie*r.$,_e*D,Me);for(let ie=0;ie<2*E;ie+=2)P.emplaceBack(te+ie,te+ie+1,te+ie+3),P.emplaceBack(te+ie,te+ie+3,te+ie+2),P.emplaceBack(ae+ie,ae+ie+3,ae+ie+1),P.emplaceBack(ae+ie,ae+ie+2,ae+ie+3);let ue=new Ia(S.createVertexBuffer(I,jc.members),S.createIndexBuffer(P),r.aM.simpleSegment(0,0,I.length,P.length));return this._meshCache[v]=ue,ue}getMeshFrameDelta(e){return 2*Math.PI*r.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,a){var h;let{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(h=this.getMinMaxElevation(m).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(e){let a=this.getTerrainData(e).tile,h={minElevation:null,maxElevation:null};return a&&a.dem&&(h.minElevation=a.dem.min*this.exaggeration,h.maxElevation=a.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(e,a){let h=r.a1.fromLngLat(e.wrap()),m=(1<<a)*r.$,g=h.x*m,v=h.y*m,S=Math.floor(g/r.$),I=Math.floor(v/r.$);return{tileID:new r.Z(a,0,a,S,I),mercatorX:g,mercatorY:v}}}class Uc{constructor(e,a,h){this._context=e,this._size=a,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new r.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(h.texture),{id:e,fbo:a,texture:h,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>e.id!==a),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let ra={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Nc{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new Uc(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(h=>!e._layers[h].isHidden(a)),this._coordsAscending={};for(let h in e.sourceCaches){this._coordsAscending[h]={};let m=e.sourceCaches[h].getVisibleCoordinates(),g=e.sourceCaches[h].getSource(),v=g instanceof ro?g.terrainTileRanges:null;for(let S of m){let I=this.terrain.sourceCache.getTerrainCoords(S,v);for(let P in I)this._coordsAscending[h][P]||(this._coordsAscending[h][P]=[]),this._coordsAscending[h][P].push(I[P])}}this._coordsAscendingStr={};for(let h of e._order){let m=e._layers[h],g=m.source;if(ra[m.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(let v in this._coordsAscending[g])this._coordsAscendingStr[g][v]=this._coordsAscending[g][v].map(S=>S.key).sort().join()}}for(let h of this._renderableTiles)for(let m in this._coordsAscendingStr){let g=this._coordsAscendingStr[m][h.tileID.key];g&&g!==h.rttCoords[m]&&(h.rtt=[])}}renderLayer(e,a){if(e.isHidden(this.painter.transform.zoom))return!1;let h=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),m=e.type,g=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ra[m]&&(this._prevType&&ra[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(e.id),!v))return!0;if(ra[this._prevType]||ra[m]&&v){this._prevType=m;let S=this._stacks.length-1,I=this._stacks[S]||[];for(let P of this._renderableTiles){if(this.pool.isFull()&&(Dc(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[S]){let D=this.pool.getObjectForId(P.rtt[S].id);if(D.stamp===P.rtt[S].stamp){this.pool.useObject(D);continue}}let E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),P.rtt[S]={id:E.id,stamp:E.stamp},g.context.bindFramebuffer.set(E.fbo.framebuffer),g.context.clear({color:r.bf.transparent,stencil:0}),g.currentStencilSource=void 0;for(let D=0;D<I.length;D++){let L=g.style._layers[I[D]],O=L.source?this._coordsAscending[L.source][P.tileID.key]:[P.tileID];g.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),g._renderTileClippingMasks(L,O,!0),g.renderLayer(g,g.style.sourceCaches[L.source],L,O,h),L.source&&(P.rttCoords[L.source]=this._coordsAscendingStr[L.source][P.tileID.key])}}return Dc(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects(),ra[m]}return!1}}let Un={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Td=x,xr={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Mh,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:r.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},tg={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Cl{constructor(e,a,h=!1){this.mousedown=g=>{this.startMove(g,F.mousePos(this.element,g)),F.addEventListener(window,"mousemove",this.mousemove),F.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,F.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHandler.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),F.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;let m=new Yf;this._rotatePitchHandler=new bs({clickTolerance:3,move:(g,v)=>{let S=a.getBoundingClientRect(),I=new r.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:r.cn(new r.P(g.x,v.y),v,I),pitchDelta:h?-.5*(v.y-g.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=e,F.addEventListener(a,"mousedown",this.mousedown),F.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(a,"touchcancel",this.reset)}startMove(e,a){this._rotatePitchHandler.dragStart(e,a),F.disableDrag()}move(e,a){let h=this.map,{bearingDelta:m,pitchDelta:g}=this._rotatePitchHandler.dragMove(e,a)||{};m&&h.setBearing(h.getBearing()+m),g&&h.setPitch(h.getPitch()+g)}off(){let e=this.element;F.removeEventListener(e,"mousedown",this.mousedown),F.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend),F.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){F.enableDrag(),F.removeEventListener(window,"mousemove",this.mousemove),F.removeEventListener(window,"mouseup",this.mouseup),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend)}}let ai;function Oi(f,e,a,h=!1){if(h||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return f?.wrap();let m=new r.S(f.lng,f.lat);if(f=new r.S(f.lng,f.lat),e){let g=new r.S(f.lng-360,f.lat),v=new r.S(f.lng+360,f.lat),S=a.locationToScreenPoint(f).distSqr(e);a.locationToScreenPoint(g).distSqr(e)<S?f=g:a.locationToScreenPoint(v).distSqr(e)<S&&(f=v)}for(;Math.abs(f.lng-a.center.lng)>180;){let g=a.locationToScreenPoint(f);if(g.x>=0&&g.y>=0&&g.x<=a.width&&g.y<=a.height)break;f.lng>a.center.lng?f.lng-=360:f.lng+=360}return f.lng!==m.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(f))?f:m}let Vc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ts(f,e,a){let h=f.classList;for(let m in Vc)h.remove(`maplibregl-${a}-anchor-${m}`);h.add(`maplibregl-${a}-anchor-${e}`)}class Cs extends r.E{constructor(e){if(super(),this._onKeyPress=a=>{let h=a.code,m=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=a=>{let h=a.originalEvent.target,m=this._element;this._popup&&(h===m||m.contains(h))&&this.togglePopup()},this._update=a=>{if(!this._map)return;let h=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=Oi(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,`${Vc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${m}`),U.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){let h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.l("dragstart"))),this.fire(new r.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new r.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=r.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div");let a=F.createNS("http://www.w3.org/2000/svg","svg"),h=41,m=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${h}px`),a.setAttributeNS(null,"width",`${m}px`),a.setAttributeNS(null,"viewBox",`0 0 ${m} ${h}`);let g=F.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");let v=F.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");let S=F.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");let I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let J of I){let ee=F.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",J.rx),ee.setAttributeNS(null,"ry",J.ry),S.appendChild(ee)}let P=F.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);let E=F.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(E);let D=F.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");let L=F.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(L);let O=F.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(6.0, 7.0)"),O.setAttributeNS(null,"fill","#FFFFFF");let N=F.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");let X=F.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");let H=F.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#FFFFFF"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962"),N.appendChild(X),N.appendChild(H),v.appendChild(S),v.appendChild(P),v.appendChild(D),v.appendChild(O),v.appendChild(N),a.appendChild(v),a.setAttributeNS(null,"height",h*this._scale+"px"),a.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(a),this._offset=r.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Ts(this._element,this._anchor,"marker"),e&&e.className)for(let a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=r.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let m=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,h;let m=(a=this._map)===null||a===void 0?void 0:a.terrain,g=this._map.transform.isLocationOccluded(this._lngLat);if(!m||g){let O=g?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==O&&(this._element.style.opacity=O))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let v=this._map,S=v.terrain.depthAtPoint(this._pos),I=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,I)-S<.006)return void(this._element.style.opacity=this._opacity);let P=-this._offset.y/v.transform.pixelsPerMeter,E=Math.sin(v.getPitch()*Math.PI/180)*P,D=v.terrain.depthAtPoint(new r.P(this._pos.x,this._pos.y-this._offset.y)),L=v.transform.lngLatToCameraDepth(this._lngLat,I+E)-D>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=r.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return(this._opacity===void 0||e===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}let Ah={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ps=0,ja=!1,Pl={maxWidth:100,unit:"metric"};function $c(f,e,a){let h=a&&a.maxWidth||100,m=f._container.clientHeight/2,g=f._container.clientWidth/2,v=f.unproject([g-h/2,m]),S=f.unproject([g+h/2,m]),I=Math.round(f.project(S).x-f.project(v).x),P=Math.min(h,I,f._container.clientWidth),E=v.distanceTo(S);if(a&&a.unit==="imperial"){let D=3.2808*E;D>5280?Ua(e,P,D/5280,f._getUIString("ScaleControl.Miles")):Ua(e,P,D,f._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Ua(e,P,E/1852,f._getUIString("ScaleControl.NauticalMiles")):E>=1e3?Ua(e,P,E/1e3,f._getUIString("ScaleControl.Kilometers")):Ua(e,P,E,f._getUIString("ScaleControl.Meters"))}function Ua(f,e,a,h){let m=(function(g){let v=Math.pow(10,`${Math.floor(g)}`.length-1),S=g/v;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(I){let P=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*P)/P})(S),v*S})(a);f.style.width=e*(m/a)+"px",f.innerHTML=`${m}&nbsp;${h}`}let kh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Lh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Gc(f){if(f){if(typeof f=="number"){let e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new r.P(0,0),top:new r.P(0,f),"top-left":new r.P(e,e),"top-right":new r.P(-e,e),bottom:new r.P(0,-f),"bottom-left":new r.P(e,-e),"bottom-right":new r.P(-e,-e),left:new r.P(f,0),right:new r.P(-f,0)}}if(f instanceof r.P||Array.isArray(f)){let e=r.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:r.P.convert(f.center||[0,0]),top:r.P.convert(f.top||[0,0]),"top-left":r.P.convert(f["top-left"]||[0,0]),"top-right":r.P.convert(f["top-right"]||[0,0]),bottom:r.P.convert(f.bottom||[0,0]),"bottom-left":r.P.convert(f["bottom-left"]||[0,0]),"bottom-right":r.P.convert(f["bottom-right"]||[0,0]),left:r.P.convert(f.left||[0,0]),right:r.P.convert(f.right||[0,0])}}return Gc(new r.P(0,0))}let Dh=x;u.AJAXError=r.cz,u.Event=r.l,u.Evented=r.E,u.LngLat=r.S,u.MercatorCoordinate=r.a1,u.Point=r.P,u.addProtocol=r.cA,u.config=r.a,u.removeProtocol=r.cB,u.AttributionControl=Eh,u.BoxZoomHandler=bh,u.CanvasSource=Go,u.CooperativeGesturesHandler=wd,u.DoubleClickZoomHandler=Ih,u.DragPanHandler=xd,u.DragRotateHandler=Ch,u.EdgeInsets=Ca,u.FullscreenControl=class extends r.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:r.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){F.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let f=this._fullscreenButton=F.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);F.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new r.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new r.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=no,u.GeolocateControl=class extends r.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new r.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new r.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{let a=new r.S(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,m=this._map.getBearing(),g=r.e({bearing:m},this.options.fitBoundsOptions),v=Di.fromLngLat(a,h);this._map.fitBounds(v,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let a=new r.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ja)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new r.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=F.create("button","maplibregl-ctrl-geolocate",this._container),F.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{let a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cs({element:this._dotElement}),this._circleElement=F.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{let h=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new r.l("trackuserlocationend")),this.fire(new r.l("userlocationlostfocus")))})}},this.options=r.e({},Ah,f)}onAdd(f){return this._map=f,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return r._(this,arguments,void 0,function*(e=!1){if(ai!==void 0&&!e)return ai;if(window.navigator.permissions===void 0)return ai=!!window.navigator.geolocation,ai;try{ai=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ai=!!window.navigator.geolocation}return ai})})().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ps=0,ja=!1}_isOutOfMapMaxBounds(f){let e=this._map.getMaxBounds(),a=f.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let f=this._map.getBounds(),e=f.getSouthEast(),a=f.getNorthEast(),h=e.distanceTo(a),m=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ps--,ja=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new r.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.l("trackuserlocationstart")),this.fire(new r.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ps++,Ps>1?(f={maximumAge:6e5,timeout:0},ja=!0):(f=this.options.positionOptions,ja=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.GlobeControl=class{constructor(){this._toggleProjection=()=>{var f;let e=(f=this._map.getProjection())===null||f===void 0?void 0:f.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var f;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((f=this._map.getProjection())===null||f===void 0?void 0:f.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(f){return this._map=f,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=F.create("button","maplibregl-ctrl-globe",this._container),F.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){F.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},u.Hash=Rc,u.ImageSource=ro,u.KeyboardHandler=Fc,u.LngLatBounds=Di,u.LogoControl=Id,u.Map=class extends Sd{constructor(f){var e,a;r.cw.mark(r.cx.create);let h=Object.assign(Object.assign(Object.assign({},xr),f),{canvasContextAttributes:Object.assign(Object.assign({},xr.canvasContextAttributes),f.canvasContextAttributes)});if(h.minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let m=new hi,g=new Pn;if(h.minZoom!==void 0&&m.setMinZoom(h.minZoom),h.maxZoom!==void 0&&m.setMaxZoom(h.maxZoom),h.minPitch!==void 0&&m.setMinPitch(h.minPitch),h.maxPitch!==void 0&&m.setMaxPitch(h.maxPitch),h.renderWorldCopies!==void 0&&m.setRenderWorldCopies(h.renderWorldCopies),super(m,g,{bearingSnap:h.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new uo,this._controls=[],this._mapId=r.a7(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new r.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new r.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},h.canvasContextAttributes),this._trackResize=h.trackResize===!0,this._bearingSnap=h.bearingSnap,this._centerClampedToGround=h.centerClampedToGround,this._refreshExpiredTiles=h.refreshExpiredTiles===!0,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions===!0,this._collectResourceTiming=h.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Un),h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this.transformCameraUpdate=h.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=h.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=$e.addThrottleControl(()=>this.isMoving()),this._requestManager=new nt(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1,I=Fa(P=>{this._trackResize&&!this._removed&&(this.resize(P),this.redraw())},50);this._resizeObserver=new ResizeObserver(P=>{S?I(P):S=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ph(this,h),this._hash=h.hash&&new Rc(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,elevation:h.elevation,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,roll:h.roll}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,r.e({},h.fitBoundsOptions,{duration:0}))));let v=typeof h.style=="string"||((a=(e=h.style)===null||e===void 0?void 0:e.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new Eh(typeof h.attributionControl=="boolean"?void 0:h.attributionControl)),h.maplibreLogo&&this.addControl(new Id,h.logoPosition),this.on("style.load",()=>{if(v||this._resizeTransform(),this.transform.unmodified){let S=r.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new r.l(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new r.l(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new r.l("sourcedataabort",S))})}_getMapId(){return this._mapId}setGlobalStateProperty(f,e){return this.style.setGlobalStateProperty(f,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new r.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=f.onAdd(this);this._controls.push(f);let h=this._controlPositions[e];return e.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new r.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,a,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,a,h)}resize(f,e=!0){let[a,h]=this._containerDimensions(),m=this._getClampedPixelRatio(a,h);if(this._resizeCanvas(a,h,m),this.painter.resize(a,h,m),this.painter.overLimit()){let v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];let S=this._getClampedPixelRatio(a,h);this._resizeCanvas(a,h,S),this.painter.resize(a,h,S)}this._resizeTransform(e);let g=!this._moving;return g&&(this.stop(),this.fire(new r.l("movestart",f)).fire(new r.l("move",f))),this.fire(new r.l("resize",f)),g&&this.fire(new r.l("moveend",f)),this}_resizeTransform(f=!0){var e;let[a,h]=this._containerDimensions();this.transform.resize(a,h,f),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,h,f)}_getClampedPixelRatio(f,e){let{0:a,1:h}=this._maxCanvasSize,m=this.getPixelRatio(),g=f*m,v=e*m;return Math.min(g>a?a/g:1,v>h?h/v:1)*m}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Di.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.setMinZoom(f),this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.setMaxZoom(f),this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.setMinPitch(f),this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(f>=this.transform.minPitch)return this.transform.setMaxPitch(f),this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.setRenderWorldCopies(f),this._update()}project(f){return this.transform.locationToScreenPoint(r.S.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.screenPointToLocation(r.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,a){if(f==="mouseenter"||f==="mouseover"){let h=!1;return{layers:e,listener:a,delegates:{mousemove:g=>{let v=e.filter(I=>this.getLayer(I)),S=v.length!==0?this.queryRenderedFeatures(g.point,{layers:v}):[];S.length?h||(h=!0,a.call(this,new Jn(f,this,g.originalEvent,{features:S}))):h=!1},mouseout:()=>{h=!1}}}}if(f==="mouseleave"||f==="mouseout"){let h=!1;return{layers:e,listener:a,delegates:{mousemove:v=>{let S=e.filter(I=>this.getLayer(I));(S.length!==0?this.queryRenderedFeatures(v.point,{layers:S}):[]).length?h=!0:h&&(h=!1,a.call(this,new Jn(f,this,v.originalEvent)))},mouseout:v=>{h&&(h=!1,a.call(this,new Jn(f,this,v.originalEvent)))}}}}{let h=m=>{let g=e.filter(S=>this.getLayer(S)),v=g.length!==0?this.queryRenderedFeatures(m.point,{layers:g}):[];v.length&&(m.features=v,a.call(this,m),delete m.features)};return{layers:e,listener:a,delegates:{[f]:h}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,a){if(!this._delegatedListeners||!this._delegatedListeners[f])return;let h=this._delegatedListeners[f];for(let m=0;m<h.length;m++){let g=h[m];if(g.listener===a&&g.layers.length===e.length&&g.layers.every(v=>e.includes(v))){for(let v in g.delegates)this.off(v,g.delegates[v]);return void h.splice(m,1)}}}on(f,e,a){if(a===void 0)return super.on(f,e);let h=typeof e=="string"?[e]:e,m=this._createDelegatedListener(f,h,a);this._saveDelegatedListener(f,m);for(let g in m.delegates)this.on(g,m.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(f,h,a)}}}once(f,e,a){if(a===void 0)return super.once(f,e);let h=typeof e=="string"?[e]:e,m=this._createDelegatedListener(f,h,a);for(let g in m.delegates){let v=m.delegates[g];m.delegates[g]=(...S)=>{this._removeDelegatedListener(f,h,a),v(...S)}}this._saveDelegatedListener(f,m);for(let g in m.delegates)this.once(g,m.delegates[g]);return this}off(f,e,a){return a===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let a,h=f instanceof r.P||Array.isArray(f),m=h?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(h?{}:f)||{},m instanceof r.P||typeof m[0]=="number")a=[r.P.convert(m)];else{let g=r.P.convert(m[0]),v=r.P.convert(m[1]);a=[g,new r.P(v.x,g.y),v,new r.P(g.x,v.y),g]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=r.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){let e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){var a,h;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));let m=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Xu(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,m):this.style.loadJSON(f,e,m),this):((h=(a=this.style)===null||a===void 0?void 0:a.projection)===null||h===void 0||h.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Xu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){let a=this._requestManager.transformRequest(f,"Style");r.j(a,new AbortController).then(h=>{this._updateDiff(h.data,e)}).catch(h=>{h&&this.fire(new r.k(h))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(a){r.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():r.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){let e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new r.k(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){let e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(let a in this.style._layers){let h=this.style._layers[a];h.type==="hillshade"&&h.source===f.source&&r.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),h.type==="color-relief"&&h.source===f.source&&r.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new bt(this.painter,e,f),this.painter.renderToTexture=new Nc(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var h;a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==f.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((h=a.source)===null||h===void 0?void 0:h.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new r.l("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let f=this.style&&this.style.sourceCaches;for(let e in f){let a=f[e]._tiles;for(let h in a){let m=a[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}setSourceTileLodParams(f,e,a){if(a){let h=this.getSource(a);if(!h)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);h.calculateTileZoom=Oe(Math.max(1,f),Math.max(1,e))}else for(let h in this.style.sourceCaches)this.style.sourceCaches[h].getSource().calculateTileZoom=Oe(Math.max(1,f),Math.max(1,e));return this._update(!0),this}refreshTiles(f,e){let a=this.style.sourceCaches[f];if(!a)throw new Error(`There is no source cache with ID "${f}", cannot refresh tile`);e===void 0?a.reload(!0):a.refreshTiles(e.map(h=>new r.a4(h.z,h.x,h.y)))}addImage(f,e,a={}){let{pixelRatio:h=1,sdf:m=!1,stretchX:g,stretchY:v,content:S,textFitWidth:I,textFitHeight:P}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||r.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new r.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:E,height:D,data:L}=e,O=e;return this.style.addImage(f,{data:new r.R({width:E,height:D},new Uint8Array(L)),pixelRatio:h,stretchX:g,stretchY:v,content:S,textFitWidth:I,textFitHeight:P,sdf:m,version:0,userImage:O}),O.onAdd&&O.onAdd(this,f),this}}{let{width:E,height:D,data:L}=U.getImageData(e);this.style.addImage(f,{data:new r.R({width:E,height:D},L),pixelRatio:h,stretchX:g,stretchY:v,content:S,textFitWidth:I,textFitHeight:P,sdf:m,version:0})}}updateImage(f,e){let a=this.style.getImage(f);if(!a)return this.fire(new r.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let h=e instanceof HTMLImageElement||r.b(e)?U.getImageData(e):e,{width:m,height:g,data:v}=h;if(m===void 0||g===void 0)return this.fire(new r.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==a.data.width||g!==a.data.height)return this.fire(new r.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let S=!(e instanceof HTMLImageElement||r.b(e));return a.data.replace(v,S),this.style.updateImage(f,a),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new r.k(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return $e.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,a){return this.style.setLayerZoomRange(f,e,a),this._update(!0)}setFilter(f,e,a={}){return this.style.setFilter(f,e,a),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,a,h={}){return this.style.setPaintProperty(f,e,a,h),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,a,h={}){return this.style.setLayoutProperty(f,e,a,h),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,a,h=>{h||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,a=>{a||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(f,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){let f=this._container;f.classList.add("maplibregl-map");let e=this._canvasContainer=F.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=F.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let a=this._containerDimensions(),h=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],h);let m=this._controlContainer=F.create("div","maplibregl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=F.create("div",`maplibregl-ctrl-${v} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,a){this._canvas.width=Math.floor(a*f),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let f=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{e={requestedAttributes:f},h&&(e.statusMessage=h.statusMessage,e.type=h.type)},{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,f):this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f),!a){let h="Failed to initialize WebGL";throw e?(e.message=h,new Error(JSON.stringify(e))):new Error(h)}this.painter=new cd(a,this.transform),le.testSupport(a)}migrateProjection(f,e){super.migrateProjection(f,e),this.painter.transform=f,this.fire(new r.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){var e,a,h,m,g;let v=this._idleTriggered?this._fadeDuration:0,S=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let I=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let D=this.transform.zoom,L=U.now();this.style.zoomHistory.update(D,L);let O=new r.F(D,{now:L,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),N=O.crossFadingFactor();N===1&&N===this._crossFadingFactor||(I=!0,this._crossFadingFactor=N),this.style.update(O)}let P=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==S;(h=this.style.projection)===null||h===void 0||h.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||P)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,P),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new r.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,r.cw.mark(r.cx.load),this.fire(new r.l("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let E=this._sourcesDirty||this._styleDirty||this._placementDirty;return E||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new r.l("idle")),!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,r.cw.mark(r.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(let a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$e.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),F.remove(this._canvasContainer),F.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),r.cw.clearMetrics(),this._removed=!0,this.fire(new r.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,U.frame(this._frameRequest,f=>{r.cw.frame(f),this._frameRequest=null;try{this._render(f)}catch(e){if(!r.cy(e)&&!(function(a){return a.message===gl})(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Td}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),this.style.setProjection(f),this._update(!0)}},u.MapMouseEvent=Jn,u.MapTouchEvent=ys,u.MapWheelEvent=xh,u.Marker=Cs,u.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{let e=this._map.getZoom(),a=e===this._map.getMaxZoom(),h=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,a)=>{let h=this._map._getUIString(`NavigationControl.${a}`);e.title=h,e.setAttribute("aria-label",h)},this.options=r.e({},tg,f),this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),F.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),F.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=F.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){let a=F.create("button",f,this._container);return a.type="button",a.addEventListener("click",e),a}},u.Popup=class extends r.E{constructor(f){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new r.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=F.create("div","maplibregl-popup",this._map.getContainer()),this._tip=F.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Oi(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;let a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let h=this.options.anchor,m=Gc(this.options.offset);if(!h){let v=this._container.offsetWidth,S=this._container.offsetHeight,I;I=a.y+m.bottom.y<S?["top"]:a.y>this._map.transform.height-S?["bottom"]:[],a.x<v/2?I.push("left"):a.x>this._map.transform.width-v/2&&I.push("right"),h=I.length===0?"bottom":I.join("-")}let g=a.add(m[h]);this.options.subpixelPositioning||(g=g.round()),F.setTransform(this._container,`${Vc[h]} translate(${g.x}px,${g.y}px)`),Ts(this._container,h,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=r.e(Object.create(kh),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new r.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=r.S.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let e=document.createDocumentFragment(),a=document.createElement("body"),h;for(a.innerHTML=f;h=a.firstChild,h;)e.appendChild(h);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=F.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(Lh);f&&f.focus()}},u.RasterDEMTileSource=ba,u.RasterTileSource=io,u.ScaleControl=class{constructor(f){this._onMove=()=>{$c(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,$c(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Pl),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=yd,u.Style=Xu,u.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=F.create("button","maplibregl-ctrl-terrain",this._container),F.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){F.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=Oc,u.TwoFingersTouchRotateHandler=Ss,u.TwoFingersTouchZoomHandler=zc,u.TwoFingersTouchZoomRotateHandler=bd,u.VectorTileSource=Rr,u.VideoSource=rs,u.addSourceType=(f,e)=>r._(void 0,void 0,void 0,function*(){if(Wo(f))throw new Error(`A source type called "${f}" already exists.`);((a,h)=>{qo[a]=h})(f,e)}),u.clearPrewarmedResources=function(){let f=to;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Co),to=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.createTileMesh=Hu,u.getMaxParallelImageRequests=function(){return r.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return Ko().getRTLTextPluginStatus()},u.getVersion=function(){return Dh},u.getWorkerCount=function(){return Tn.workerCount},u.getWorkerUrl=function(){return r.a.WORKER_URL},u.importScriptInWorkers=function(f){return ts().broadcast("IS",f)},u.prewarm=function(){xa().acquire(Co)},u.setMaxParallelImageRequests=function(f){r.a.MAX_PARALLEL_IMAGE_REQUESTS=f},u.setRTLTextPlugin=function(f,e){return Ko().setRTLTextPlugin(f,e)},u.setWorkerCount=function(f){Tn.workerCount=f},u.setWorkerUrl=function(f){r.a.WORKER_URL=f}});var p=l;return p})});var H1=Ev((YL,c0)=>{"use strict";var Iu=typeof Reflect=="object"?Reflect:null,B1=Iu&&typeof Iu.apply=="function"?Iu.apply:function(s,i,p){return Function.prototype.apply.call(s,i,p)},ym;Iu&&typeof Iu.ownKeys=="function"?ym=Iu.ownKeys:Object.getOwnPropertySymbols?ym=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:ym=function(s){return Object.getOwnPropertyNames(s)};function tI(l){console&&console.warn&&console.warn(l)}var U1=Number.isNaN||function(s){return s!==s};function vi(){vi.init.call(this)}c0.exports=vi;c0.exports.once=oI;vi.EventEmitter=vi;vi.prototype._events=void 0;vi.prototype._eventsCount=0;vi.prototype._maxListeners=void 0;var j1=10;function vm(l){if(typeof l!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof l)}Object.defineProperty(vi,"defaultMaxListeners",{enumerable:!0,get:function(){return j1},set:function(l){if(typeof l!="number"||l<0||U1(l))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+l+".");j1=l}});vi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};vi.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||U1(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function N1(l){return l._maxListeners===void 0?vi.defaultMaxListeners:l._maxListeners}vi.prototype.getMaxListeners=function(){return N1(this)};vi.prototype.emit=function(s){for(var i=[],p=1;p<arguments.length;p++)i.push(arguments[p]);var u=s==="error",r=this._events;if(r!==void 0)u=u&&r.error===void 0;else if(!u)return!1;if(u){var x;if(i.length>0&&(x=i[0]),x instanceof Error)throw x;var C=new Error("Unhandled error."+(x?" ("+x.message+")":""));throw C.context=x,C}var A=r[s];if(A===void 0)return!1;if(typeof A=="function")B1(A,this,i);else for(var R=A.length,U=W1(A,R),p=0;p<R;++p)B1(U[p],this,i);return!0};function V1(l,s,i,p){var u,r,x;if(vm(i),r=l._events,r===void 0?(r=l._events=Object.create(null),l._eventsCount=0):(r.newListener!==void 0&&(l.emit("newListener",s,i.listener?i.listener:i),r=l._events),x=r[s]),x===void 0)x=r[s]=i,++l._eventsCount;else if(typeof x=="function"?x=r[s]=p?[i,x]:[x,i]:p?x.unshift(i):x.push(i),u=N1(l),u>0&&x.length>u&&!x.warned){x.warned=!0;var C=new Error("Possible EventEmitter memory leak detected. "+x.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");C.name="MaxListenersExceededWarning",C.emitter=l,C.type=s,C.count=x.length,tI(C)}return l}vi.prototype.addListener=function(s,i){return V1(this,s,i,!1)};vi.prototype.on=vi.prototype.addListener;vi.prototype.prependListener=function(s,i){return V1(this,s,i,!0)};function iI(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $1(l,s,i){var p={fired:!1,wrapFn:void 0,target:l,type:s,listener:i},u=iI.bind(p);return u.listener=i,p.wrapFn=u,u}vi.prototype.once=function(s,i){return vm(i),this.on(s,$1(this,s,i)),this};vi.prototype.prependOnceListener=function(s,i){return vm(i),this.prependListener(s,$1(this,s,i)),this};vi.prototype.removeListener=function(s,i){var p,u,r,x,C;if(vm(i),u=this._events,u===void 0)return this;if(p=u[s],p===void 0)return this;if(p===i||p.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete u[s],u.removeListener&&this.emit("removeListener",s,p.listener||i));else if(typeof p!="function"){for(r=-1,x=p.length-1;x>=0;x--)if(p[x]===i||p[x].listener===i){C=p[x].listener,r=x;break}if(r<0)return this;r===0?p.shift():nI(p,r),p.length===1&&(u[s]=p[0]),u.removeListener!==void 0&&this.emit("removeListener",s,C||i)}return this};vi.prototype.off=vi.prototype.removeListener;vi.prototype.removeAllListeners=function(s){var i,p,u;if(p=this._events,p===void 0)return this;if(p.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):p[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete p[s]),this;if(arguments.length===0){var r=Object.keys(p),x;for(u=0;u<r.length;++u)x=r[u],x!=="removeListener"&&this.removeAllListeners(x);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=p[s],typeof i=="function")this.removeListener(s,i);else if(i!==void 0)for(u=i.length-1;u>=0;u--)this.removeListener(s,i[u]);return this};function G1(l,s,i){var p=l._events;if(p===void 0)return[];var u=p[s];return u===void 0?[]:typeof u=="function"?i?[u.listener||u]:[u]:i?rI(u):W1(u,u.length)}vi.prototype.listeners=function(s){return G1(this,s,!0)};vi.prototype.rawListeners=function(s){return G1(this,s,!1)};vi.listenerCount=function(l,s){return typeof l.listenerCount=="function"?l.listenerCount(s):q1.call(l,s)};vi.prototype.listenerCount=q1;function q1(l){var s=this._events;if(s!==void 0){var i=s[l];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}vi.prototype.eventNames=function(){return this._eventsCount>0?ym(this._events):[]};function W1(l,s){for(var i=new Array(s),p=0;p<s;++p)i[p]=l[p];return i}function nI(l,s){for(;s+1<l.length;s++)l[s]=l[s+1];l.pop()}function rI(l){for(var s=new Array(l.length),i=0;i<s.length;++i)s[i]=l[i].listener||l[i];return s}function oI(l,s){return new Promise(function(i,p){function u(x){l.removeListener(s,r),p(x)}function r(){typeof l.removeListener=="function"&&l.removeListener("error",u),i([].slice.call(arguments))}Z1(l,s,r,{once:!0}),s!=="error"&&aI(l,u,{once:!0})})}function aI(l,s,i){typeof l.on=="function"&&Z1(l,"error",s,i)}function Z1(l,s,i,p){if(typeof l.on=="function")p.once?l.once(s,i):l.on(s,i);else if(typeof l.addEventListener=="function")l.addEventListener(s,function u(r){p.once&&l.removeEventListener(s,u),i(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof l)}});var Gi=(function(l){return l[l.VERBOSE=0]="VERBOSE",l[l.INFO=1]="INFO",l[l.WARNING=2]="WARNING",l[l.ERROR=3]="ERROR",l})(Gi||{}),pi=(()=>{class l{logLevel;constructor(){this.logLevel=Gi.VERBOSE,dr.production&&(this.logLevel=Gi.INFO)}log(i,p=Gi.VERBOSE){console&&console.log&&p>=this.logLevel&&console.log("["+Gi[p]+"] {"+new Date().toLocaleTimeString()+"} "+i)}static \u0275fac=function(p){return new(p||l)};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Us=(()=>{class l{http;logging;referenceData;filteredReferenceData;constructor(i,p){this.http=i,this.logging=p,this.loadCachedRefData()}refreshReferenceData(i){return Be(this,null,function*(){try{let p=yield i.fetchCoreReferenceData(null).toPromise();return this.setCoreReferenceData(p),this.setFilteredReferenceData(p),this.logging.log("Got refreshed core ref data.",Gi.VERBOSE),this.sortCoreReferenceData(),this.cacheCurrentRefData(),!0}catch(p){return this.logging.log("Error fetching core ref data:"+p),!1}})}refreshFilteredReferenceData(i,p){i.fetchCoreReferenceData(p).subscribe(u=>{this.setFilteredReferenceData(u),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",Gi.VERBOSE)},u=>{this.logging.log("Error fetching filtered reference data:"+u)})}setCoreReferenceData(i){this.referenceData=i}setFilteredReferenceData(i){this.filteredReferenceData=i}referenceDataLoaded(){return this.referenceData!=null}getCountries(i=!1){return i==!0?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID(i){return this.getRefDataByID(this.referenceData.Countries,i)}getConnectionTypes(i=!1){return i==!0?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID(i){return this.getRefDataByID(this.referenceData.ConnectionTypes,i)}getUsageTypes(i=!1){return i==!0?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(p=>p.ID>0)}getUsageTypeByID(i){return this.getRefDataByID(this.referenceData.UsageTypes,i)}getStatusTypes(i=!1){return i==!0?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(p=>p.ID>0)}getStatusTypeByID(i){return this.getRefDataByID(this.referenceData.StatusTypes,i)}getNetworkOperators(i=!1){return i==!0?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID(i){return this.getRefDataByID(this.referenceData.Operators,i)}getDataProviders(i=!1){return i==!0?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID(i){return this.getRefDataByID(this.referenceData.DataProviders,i)}getCheckinStatusTypes(i=!1,p=!0){let u=null;return i==!0?u=this.filteredReferenceData.CheckinStatusTypes:u=this.referenceData.CheckinStatusTypes,p&&(u=u.filter(r=>r.IsAutomatedCheckin===!1)),u}getCheckinStatusTypeByID(i){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,i)}getCommentTypes(i=!1,p=!0){let u;return i==!0?u=this.filteredReferenceData.UserCommentTypes:u=this.referenceData.UserCommentTypes,p&&(u=u.filter(r=>r.ID!==100&&r.ID!==110)),u}getCommentTypeByID(i){return this.getRefDataByID(this.referenceData.UserCommentTypes,i)}getSubmissionStatusTypes(i=!1){return i==!0?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID(i){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,i)}getChargingLevelTypes(i=!1){return i==!0?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID(i){return this.getRefDataByID(this.referenceData.ChargerTypes,i)}getOutputCurrentTypes(i=!1){return i?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID(i){return this.getRefDataByID(this.referenceData.CurrentTypes,i)}loadCachedRefData(){let i=localStorage.getItem("referenceData");if(i==null)this.http.get("./assets/data/CoreReferenceData.json").subscribe(p=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(p),this.setFilteredReferenceData(p)});else{let p=JSON.parse(i);this.setCoreReferenceData(p)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){this.referenceData!=null&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID(i,p){if(p!==""&&(p=parseInt(p,10)),i!=null){for(let u=0;u<i.length;u++)if(i[u].ID===p)return i[u]}return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData(i){i.sort(this.sortListByTitle)}sortListByTitle(i,p){return i.Title<p.Title?-1:i.Title>p.Title?1:0}getMetadataValueByMetadataFieldID(i,p){if(p!==""&&(p=parseInt(p,10)),i!=null){for(let u=0;u<i.length;u++)if(i[u].ID===p)return i[u]}return null}hydrateCompactPOI(i,p=!1){let u=this;if(i.DataProviderID!=null&&(p||i.DataProvider==null)&&(i.DataProvider=u.getDataProviderByID(i.DataProviderID)),i.OperatorID!=null&&(p||i.OperatorInfo==null)&&(i.OperatorInfo=u.getNetworkOperatorByID(i.OperatorID)),i.UsageTypeID!=null&&(p||i.UsageType==null)&&(i.UsageType=u.getUsageTypeByID(i.UsageTypeID)),i.AddressInfo.CountryID!=null&&(p||i.AddressInfo.Country==null)&&(i.AddressInfo.Country=u.getCountryByID(i.AddressInfo.CountryID)),i.StatusTypeID!=null&&(p||i.StatusType==null)&&(i.StatusType=u.getStatusTypeByID(i.StatusTypeID)),i.SubmissionStatusTypeID!=null&&(p||i.SubmissionStatusType==null)&&(i.SubmissionStatusType=u.getSubmissionStatusTypesByID(i.SubmissionStatusTypeID)),i.Connections!=null)for(let r=0;r<i.Connections.length;r++){let x=i.Connections[r];x.ConnectionTypeID!=null&&(p||x.ConnectionType==null)&&(x.ConnectionType=u.getConnectionTypeByID(x.ConnectionTypeID)),x.LevelID!=null&&(p||x.Level==null)&&(x.Level=u.getChargingLevelTypeByID(x.LevelID)),x.CurrentTypeID!=null&&(p||x.CurrentType==null)&&(x.CurrentType=u.getOutputCurrentTypeByID(x.CurrentTypeID)),x.StatusTypeID!=null&&(p||x.StatusType==null)&&(x.StatusType=u.getStatusTypeByID(x.StatusTypeID)),i.Connections[r]=x}if(i.UserComments!=null)for(let r=0;r<i.UserComments.length;r++){let x=i.UserComments[r];x.CommentTypeID!=null&&(p||x.CommentType==null)&&(x.CommentType=u.getCommentTypeByID(x.CommentTypeID)),x.CheckinStatusTypeID!=null&&(p||x.CheckinStatusType==null)&&(x.CheckinStatusType=u.getCheckinStatusTypeByID(x.CheckinStatusTypeID)),i.UserComments[r]=x}return i}hydrateCompactPOIList(i){for(let p=0;p<i.length;p++)i[p]=this.hydrateCompactPOI(i[p]);return i}static \u0275fac=function(p){return new(p||l)(Ct(tr),Ct(pi))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Jh=class{ID;SubmissionType;Data;Attempts;DateQueued;IsSubmitted;IsInProgress;IsCancelled;IsFailure;FailureReason;constructor(s,i){this.SubmissionType=s,this.Data=i,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+Math.random()*100}};var Xr=(function(l){return l[l.POI=0]="POI",l[l.Comment=1]="Comment",l[l.Media=2]="Media",l})(Xr||{});var Yh=class l{itemType;itemId;version;schemaVersion;syncTimeStamp;constructor(s,i){this.itemType=s,this.itemId=l.getNewItemId(),this.version=1,this.schemaVersion=i,this.syncTimeStamp=l.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}};var xu=class{Title;Notes;_sync;constructor(s,i){this._sync=new Yh(s,i)}},Nl=class extends xu{PoiID;Type;Poi;Photos},qa=class extends xu{Stage;Position;PoiIDs;PoiList;constructor(){super("waypoint",1)}},Vl=class extends xu{WayPoints;constructor(){super("journey_stage",1),this.WayPoints=[]}},Ns=class extends xu{ID;Stages;constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}},Qh=class{Title;DistanceKM;DurationMinutes;StartElevation;EndElevation;EnergyConsumptionkWh},ep=class{Title;JourneyRouteLegs;TotalDistanceKM;TotalDurationMinutes;TotalEnergykWh};var Wa=class{Location;Title;Address;Type;ReferenceID;Attribution;AddressInfo};var qi=class{altitudeAccuracy;longitude;latitude;speed;heading;altitude;accuracy;constructor(s=null,i=null){this.latitude=s,this.longitude=i}toJSON(){JSON.stringify({latitude:this.latitude,longitude:this.longitude,altitude:this.altitude,accuracy:this.accuracy,altitudeAccuracy:this.altitudeAccuracy,speed:this.speed,heading:this.heading})}},ma=class l{coords;timestamp;attribution;constructor(s=null,i=null){this.coords=new qi,this.coords.latitude=s,this.coords.longitude=i}static fromPosition(s){return new l(s.coords.latitude,s.coords.longitude)}},tp=class{northEast;southWest;constructor(s,i){this.northEast=s,this.southWest=i}};var bu=class{OperatorList;ConnectionTypeList;CountryList;UsageTypeList;StatusTypeList;MinPowerKW;MaxPowerKW;UseDistanceInKM;HasActiveFilters;LastSearchPosition;StartSearchPosition;StartViewPoiId;Language;FilterOptionsByCountryId;MapType;EnableAdvancedEditorFeatures;EnablePOIPendingApproval;MaxResults;constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1,this.EnablePOIPendingApproval=!1,this.MaxResults=500}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||this.MaxPowerKW!=null&&this.MaxPowerKW<1e3?this.HasActiveFilters=!0:this.HasActiveFilters=!1,this.HasActiveFilters}};var Vs=class{poiIdList=null;countryCode=null;latitude=null;longitude=null;locationTitle=null;distance=null;distanceUnit=null;connectionTypeIdList=null;operatorIdList=null;levelIdList=null;countryIdList=null;usageTypeIdList=null;statusTypeIdList=null;minPowerKW=null;maxPowerKW=null;submissionStatusTypeIdList=null;maxResults=500;additionalParams=null;includeComments=!1;compact=!0;enableCaching=!0;levelOfDetail=1;polyline=null;boundingbox=null};var wu=(()=>{class l{http;refData;logging;serviceBase="https://api.openchargemap.io";serviceBaseURL=this.serviceBase+"/v4";hasAuthorizationError=!1;ATTRIBUTION_METADATAFIELDID=4;authResponse;clientName="ocm.api.default";authorizationErrorCallback;generalErrorCallback;allowMirror=!1;lastPOIApiCallURL="";constructor(i,p,u){this.http=i,this.refData=p,this.logging=u,this.serviceBaseURL=dr.apiBase+"/v3"}getNumberListString(i){let p="";for(let u=0;u<i.length;u++)p+=i[u],u<i.length&&(p+=",");return p}fetchPOIListByParam(i){return Be(this,null,function*(){let p=this.serviceBaseURL+"/poi/?client="+this.clientName+(this.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";i.compact=!0;let u="";i.countryCode!=null&&(u+="&countrycode="+i.countryCode),i.latitude!=null&&(u+="&latitude="+i.latitude),i.longitude!=null&&(u+="&longitude="+i.longitude),i.distance!=null&&(u+="&distance="+i.distance),i.distanceUnit!=null&&(u+="&distanceunit="+i.distanceUnit),i.includeComments!=null&&(u+="&includecomments="+i.includeComments),i.maxResults!=null&&(u+="&maxresults="+i.maxResults),i.countryIdList!=null&&(u+="&countryid="+this.getNumberListString(i.countryIdList)),i.levelIdList!=null&&(u+="&levelid="+this.getNumberListString(i.levelIdList)),i.connectionTypeIdList!=null&&i.connectionTypeIdList.length>0&&(u+="&connectiontypeid="+this.getNumberListString(i.connectionTypeIdList)),i.operatorIdList!=null&&i.operatorIdList.length>0&&(u+="&operatorid="+this.getNumberListString(i.operatorIdList)),i.usageTypeIdList!=null&&i.usageTypeIdList.length>0&&(u+="&usagetypeid="+this.getNumberListString(i.usageTypeIdList)),i.statusTypeIdList!=null&&i.statusTypeIdList.length>0&&(u+="&statustypeid="+this.getNumberListString(i.statusTypeIdList)),i.locationTitle!=null&&(u+="&locationtitle="+i.locationTitle),i.minPowerKW!=null&&i.minPowerKW>0&&(u+="&minpowerkw="+i.minPowerKW),i.maxPowerKW!=null&&i.maxPowerKW>0&&(u+="&maxpowerkw="+i.maxPowerKW),i.submissionStatusTypeIdList!=null&&(u+="&submissionstatustypeid="+this.getNumberListString(i.submissionStatusTypeIdList)),i.poiIdList!=null&&i.poiIdList.length>0&&(u+="&chargepointid="+this.getNumberListString(i.poiIdList)),i.enableCaching==!1&&(u+="&enablecaching=false"),i.compact!=null&&(u+="&compact="+i.compact),i.levelOfDetail>1&&(u+="&levelofdetail="+i.levelOfDetail),i.polyline!=null&&(u+="&polyline="+i.polyline),i.boundingbox!=null&&(u+="&boundingbox="+i.boundingbox),i.additionalParams!=null&&(u+="&"+i.additionalParams);let r=p+u;if(this.lastPOIApiCallURL!==r||i.enableCaching==!1){this.lastPOIApiCallURL=r,this.logging.log("API Call:"+r,Gi.VERBOSE);try{let x=yield this.http.get(r,this.getHttpRequestOptions()).toPromise();return this.refData.hydrateCompactPOIList(x)}catch(x){let C=x.message||"Could not fetch POI list from server.";throw this.logging.log("API Client: "+JSON.stringify(x),Gi.ERROR),C}}else return this.logging.log("Skipped API call due to same query being repeated."),[]})}getHttpRequestOptions(i=!0){let p=new Wv;return i&&(p=p.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(p=p.append("Authorization","Bearer "+this.authResponse.Data.access_token)),p=p.append("X-API-Key",dr.apiKey),{headers:p}}fetchCoreReferenceData(i){let p=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return i!=null&&i.CountryIds!=null&&(p+="&countryid="+this.getNumberListString(i.CountryIds)),this.logging.log("API Call:"+p,Gi.VERBOSE),this.http.get(p,this.getHttpRequestOptions())}performSignIn(i,p){let u=this.serviceBaseURL+"/profile/authenticate/",r={emailaddress:i,password:p};return this.http.post(u,JSON.stringify(r),this.getHttpRequestOptions()).toPromise().then(x=>(this.authResponse=x,this.authResponse))}performRegister(i,p,u){let r=this.serviceBaseURL+"/profile/register/",x={username:i,emailaddress:p,password:u};return this.http.post(r,JSON.stringify(x),this.getHttpRequestOptions()).toPromise().then(C=>(this.authResponse=C,this.authResponse))}performSubmission(i,p){if(i===Xr.POI)return this.submitPOI(p);if(i===Xr.Comment)return this.submitUserComment(p);if(i===Xr.Media)return this.submitMediaItem(p)}submitUserComment(i){let p=JSON.stringify(i);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",p,this.getHttpRequestOptions()).toPromise()}submitMediaItem(i){let p=JSON.stringify(i);return this.http.post(this.serviceBaseURL+"/mediaitem/",p,this.getHttpRequestOptions()).toPromise()}submitPOI(i){let p=JSON.stringify(i);return this.http.post(this.serviceBaseURL+"/poi/",p,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(i){return new Promise(p=>{let r="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(i.longitude-.001)+"&miny="+(i.latitude-.001)+"&maxx="+(i.longitude+.001)+"maxy="+(i.latitude+.001)+"&size=medium&mapfilter=true&callback=?";return console.log(r),this.http.get(r).toPromise()})}fetchReverseGeocodeResult(i,p){let u=this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+i+"&longitude="+p;return this.http.get(u,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return typeof window.localStorage<"u"}setCachedDataObject(i,p){this.isLocalStorageAvailable()&&(typeof p>"u"&&(p=null),p===null?localStorage.removeItem(i):localStorage.setItem(i,JSON.stringify(p)))}getCachedDataObject(i){if(this.isLocalStorageAvailable()){let p=localStorage.getItem(i);if(p!=null&&p.length>0)return JSON.parse(p)}return null}static \u0275fac=function(p){return new(p||l)(Ct(tr),Ct(Us),Ct(pi))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Tr=(()=>{class l{c=new Map;constructor(){}subscribe(i,...p){let u=this.c.get(i);u||this.c.set(i,u=[]),u.push(...p)}unsubscribe(i,p){if(!p)return this.c.delete(i);let u=this.c.get(i);if(!u)return!1;let r=u.indexOf(p);return r<0?!1:(u.splice(r,1),u.length===0&&this.c.delete(i),!0)}publish(i,...p){let u=this.c.get(i);return u?u.map(r=>{try{return r(...p)}catch(x){return console.error(x),null}}):null}static \u0275fac=function(p){return new(p||l)};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var om=(()=>{class l{logger;platform;isCordova=!1;ga=null;constructor(i,p){this.logger=i,this.platform=p,p.is("cordova")||p.is("capacitor")?this.isCordova=!0:this.isCordova=!1}init(i){return Be(this,null,function*(){this.isCordova&&this.ga?yield this.ga.startTrackerWithId(i):this.logger.log("Could not initialise analytics")})}setAppVersion(i){return Be(this,null,function*(){if(this.isCordova&&this.ga)return this.ga.setAppVersion(i);this.logger.log(i)})}appEvent(i,p){return Be(this,null,function*(){if(this.isCordova&&this.ga)return this.ga.trackEvent(i,p);this.logger.log(p)})}viewEvent(i){return Be(this,null,function*(){if(this.isCordova&&this.ga)return this.ga.trackView(i);this.logger.log(i)})}static \u0275fac=function(p){return new(p||l)(Ct(pi),Ct(cu))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Su=(()=>{class l{api;events;logging;analytics;poiList;isRequestInProgress=!1;constructor(i,p,u,r){this.api=i,this.events=p,this.logging=u,this.analytics=r}refreshPOIList(i){return Be(this,null,function*(){try{return this.poiList=yield this.fetchPOIList(i),this.events.publish("ocm:poiList:updated"),this.analytics.appEvent("Search","Fetched Results"),this.poiList.length}catch{return 0}})}fetchPOIList(i){return Be(this,null,function*(){this.isRequestInProgress=!0;try{let p=yield this.api.fetchPOIListByParam(i);return this.isRequestInProgress=!1,p&&p.length&&this.logging.log("fetched POI list ["+p.length+"]"),p}catch{return this.isRequestInProgress=!1,[]}})}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",Gi.VERBOSE)}getPOIById(i,p=!1,u=!1){return Be(this,null,function*(){if(!u&&this.poiList!=null){let C=this.poiList.find(A=>A.ID==i);if(C)return C}let r={poiIdList:[i],enableCaching:!u,includeComments:!0},x=yield this.api.fetchPOIListByParam(r);return x&&x.length>0?(this.poiList&&x[0].ID==i&&(this.poiList=this.poiList.filter(C=>C.ID!=i),this.poiList.push(x[0]),this.logging.log("POI refreshed in cache "+i)),x[0]):null})}static \u0275fac=function(p){return new(p||l)(Ct(wu),Ct(Tr),Ct(pi),Ct(om))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var $s=(()=>{class l{api;poiManager;logging;journeys;favourites;routePolyline;constructor(i,p,u){this.api=i,this.poiManager=p,this.logging=u,this.journeys=[],this.favourites=[]}loadJourneys(){let i=localStorage.getItem("journeys");if(i!=null&&(this.journeys=JSON.parse(i)),this.journeys!=null)for(let p of this.journeys)this.fetchAllJourneyPOIDetails(p)}fetchAllJourneyPOIDetails(i){this.logging.log("Journeys - fetching poi details for Journey "+i.Title);let p=new Vs;p.poiIdList=[];for(let u of i.Stages)for(let r of u.WayPoints)for(let x of r.PoiIDs)p.poiIdList.push(x);this.api.fetchPOIListByParam(p).then(u=>{for(let r of u)this.updateStoredPOI(r)})}updateStoredPOI(i){if(this.journeys.forEach(p=>{p.Stages.forEach(u=>{u.WayPoints.forEach(r=>{r.PoiIDs.forEach(x=>{if(x==i.ID)if(r.PoiList==null){r.PoiList=[];let C=new Nl("charging",1);C.Poi=i,C.PoiID=i.ID,r.PoiList.push(C)}else for(let C of r.PoiList)C.PoiID==i.ID&&(C.Poi=i)})})})}),this.favourites!=null)for(let p of this.favourites)p.Type=="charging"&&p.PoiID==i.ID&&(p.Poi=i)}saveJourneys(){let i=JSON.parse(JSON.stringify(this.journeys));for(let u of i)for(let r of u.Stages)for(let x of r.WayPoints)for(let C of x.PoiList)C.Poi=null,C.Photos=null;let p=JSON.stringify(i);localStorage.setItem("journeys",p)}addJourney(i,p){let u=new Vl;u.Title="Stage 1",p!=null&&u.WayPoints.push(p),i.Stages.push(u),this.journeys.push(i)}deleteJourney(i){this.journeys=this.journeys.filter(p=>p.ID!=i),this.saveJourneys()}getJourney(i){let p=this.journeys.filter(u=>u.ID==i);return p.length>0?p[0]:null}getJourneyStages(i){return this.getJourney(i).Stages}addJourneyWaypoint(i,p,u){let r=this.getJourney(i);if(p==null){let x=new Vl;x.Title="Stage "+(r.Stages.length+1),x.WayPoints.push(u),r.Stages.push(x)}else{let x=r.Stages[p];x.WayPoints==null&&(x.WayPoints=[]),x.WayPoints.push(u)}}addJourneyStage(i,p){return this.getJourney(i).Stages.push(p)-1}setupTestJourneys(){this.journeys=[];let i=new Ns;i.Title="New York to Brooklyn",i.Notes="A little jaunt to Brooklyn",i.Stages=[];let p=new Vl,u=new qa;u.Notes="Starting point",u.Position=new qi(40,1.2),u.Title="Start",p.WayPoints.push(u);let r=new qa;r.Notes="Middle point",r.Position=new qi(40,1.33),r.Title="Middle",p.WayPoints.push(r);let x=new qa;x.Notes="End point",x.Position=new qi(40,1.33),x.Title="End",p.WayPoints.push(x),i.Stages.push(p),this.journeys.push(i);let C=new Ns;C.Title="Aberdeen to London",C.Notes="Roadtrip",C.Stages=[],this.journeys.push(C)}calculateEnergyConsumptionkWh(i,p,u=0,r){return i*r}setRoutePolyline(i){this.routePolyline=i}getRoutePolyline(){return this.routePolyline}static \u0275fac=function(p){return new(p||l)(Ct(wu),Ct(Su),Ct(pi))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var p1=(()=>{class l{events;isQueueProcessing;appManager;constructor(i){this.events=i,this.isQueueProcessing=!1}setAppManager(i){this.appManager=i}add(i,p){let u=this.getQueueItems();u.push(new Jh(i,p)),this.saveQueueItems(u)}update(i){let p=this.getQueueItems(),u=new Array;return p.forEach(r=>{r.ID==i.ID?u.push(i):u.push(r)}),u}processNextQueueItem(){let i=this.getNextQueueItem();i!=null&&this.appManager!=null&&this.appManager.api.performSubmission(i.SubmissionType,i.Data).then(()=>{i.IsSubmitted=!0,i.Attempts++,this.update(i),this.clear()})}getNextQueueItem(){let i=this.getQueueItems(),p=null;return i.forEach(u=>{p==null&&!u.IsCancelled&&!u.IsInProgress&&!u.IsSubmitted&&(p=u)}),p}hasPendingItems(){let i=!1;return this.getQueueItems().forEach(u=>{!u.IsFailure&&!u.IsCancelled&&!u.IsSubmitted&&(i=!0)}),i}isCompleted(){let i=this.getQueueItems(),p=!0;return i.forEach(u=>{(u.IsInProgress||u.IsFailure)&&(p=!1)}),p}clear(i=!1){let p=this.getQueueItems(),u=new Array;i||p.forEach(r=>{(r.IsInProgress||r.IsFailure)&&u.push(r)}),this.saveQueueItems(u)}saveQueueItems(i){localStorage.setItem("submissionQueue",JSON.stringify(i))}getQueueItems(){let i=localStorage.getItem("submissionQueue");return i!=null?JSON.parse(i):new Array}static \u0275fac=function(p){return new(p||l)(Ct(Tr))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var Gg=new Dv("JWT_OPTIONS"),sm=(()=>{class l{constructor(i=null){this.tokenGetter=i&&i.tokenGetter||function(){}}urlBase64Decode(i){let p=i.replace(/-/g,"+").replace(/_/g,"/");switch(p.length%4){case 0:break;case 2:{p+="==";break}case 3:{p+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(p)}b64decode(i){let p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="";if(i=String(i).replace(/=+$/,""),i.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let r=0,x,C,A=0;C=i.charAt(A++);~C&&(x=r%4?x*64+C:C,r++%4)?u+=String.fromCharCode(255&x>>(-2*r&6)):0)C=p.indexOf(C);return u}b64DecodeUnicode(i){return decodeURIComponent(Array.prototype.map.call(this.b64decode(i),p=>"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(i=this.tokenGetter()){return i instanceof Promise?i.then(p=>this._decodeToken(p)):this._decodeToken(i)}_decodeToken(i){if(!i||i==="")return null;let p=i.split(".");if(p.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let u=this.urlBase64Decode(p[1]);if(!u)throw new Error("Cannot decode the token.");return JSON.parse(u)}getTokenExpirationDate(i=this.tokenGetter()){return i instanceof Promise?i.then(p=>this._getTokenExpirationDate(p)):this._getTokenExpirationDate(i)}_getTokenExpirationDate(i){let p;if(p=this.decodeToken(i),!p||!p.hasOwnProperty("exp"))return null;let u=new Date(0);return u.setUTCSeconds(p.exp),u}isTokenExpired(i=this.tokenGetter(),p){return i instanceof Promise?i.then(u=>this._isTokenExpired(u,p)):this._isTokenExpired(i,p)}_isTokenExpired(i,p){if(!i||i==="")return!0;let u=this.getTokenExpirationDate(i);return p=p||0,u===null?!1:!(u.valueOf()>new Date().valueOf()+p*1e3)}getAuthScheme(i,p){return typeof i=="function"?i(p):i}}return l.\u0275fac=function(i){return new(i||l)(Ct(Gg))},l.\u0275prov=gi({token:l,factory:l.\u0275fac}),l})(),d1=l=>l instanceof Promise?Lv(()=>l):qd(l),fS=(()=>{class l{constructor(i,p,u){this.jwtHelper=p,this.document=u,this.standardPorts=["80","443"],this.tokenGetter=i.tokenGetter,this.headerName=i.headerName||"Authorization",this.authScheme=i.authScheme||i.authScheme===""?i.authScheme:"Bearer ",this.allowedDomains=i.allowedDomains||[],this.disallowedRoutes=i.disallowedRoutes||[],this.throwNoTokenError=i.throwNoTokenError||!1,this.skipWhenExpired=i.skipWhenExpired}isAllowedDomain(i){let p=new URL(i.url,this.document.location.origin);if(p.host===this.document.location.host)return!0;let u=`${p.hostname}${p.port&&!this.standardPorts.includes(p.port)?":"+p.port:""}`;return this.allowedDomains.findIndex(r=>typeof r=="string"?r===u:r instanceof RegExp?r.test(u):!1)>-1}isDisallowedRoute(i){let p=new URL(i.url,this.document.location.origin);return this.disallowedRoutes.findIndex(u=>{if(typeof u=="string"){let r=new URL(u,this.document.location.origin);return r.hostname===p.hostname&&r.pathname===p.pathname}return u instanceof RegExp?u.test(i.url):!1})>-1}handleInterception(i,p,u){let r=this.jwtHelper.getAuthScheme(this.authScheme,p);if(!i&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let x=qd(!1);return this.skipWhenExpired&&(x=i?d1(this.jwtHelper.isTokenExpired(i)):qd(!0)),i?x.pipe(kv(C=>C&&this.skipWhenExpired?p.clone():p.clone({setHeaders:{[this.headerName]:`${r}${i}`}})),Ng(C=>u.handle(C))):u.handle(p)}intercept(i,p){if(!this.isAllowedDomain(i)||this.isDisallowedRoute(i))return p.handle(i);let u=this.tokenGetter(i);return d1(u).pipe(Ng(r=>this.handleInterception(r,i,p)))}}return l.\u0275fac=function(i){return new(i||l)(Ct(Gg),Ct(sm),Ct(Rv))},l.\u0275prov=gi({token:l,factory:l.\u0275fac}),l})(),qk=(()=>{class l{constructor(i){if(i)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(i){return{ngModule:l,providers:[{provide:Zv,useClass:fS,multi:!0},i.jwtOptionsProvider||{provide:Gg,useValue:i.config},sm]}}}return l.\u0275fac=function(i){return new(i||l)(Ct(l,12))},l.\u0275mod=Hd({type:l}),l.\u0275inj=Wd({}),l})();var Pr=(()=>{class l{http;events;api;submissionQueue;platform;referenceDataManager;journeyManager;translateService;toastController;loadingController;jwtHelper;logging;analytics;enableSubmissionQueue;searchSettings;platformMode;journeys;isDebugMode;clientWidth;clientHeight;isRequestInProgress=!1;title="Open Charge Map";_isUserAuthenticated=null;isEmbeddedMode=!1;isOffline=!1;constructor(i,p,u,r,x,C,A,R,U,F,le,se,fe){this.http=i,this.events=p,this.api=u,this.submissionQueue=r,this.platform=x,this.referenceDataManager=C,this.journeyManager=A,this.translateService=R,this.toastController=U,this.loadingController=F,this.jwtHelper=le,this.logging=se,this.analytics=fe,this.api.clientName="ocm.app.ionic."+dr.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),x.is("cordova")?this.platformMode="cordova":this.platformMode="web",this.initAppManager(),this.searchSettings=new bu,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(localStorage.getItem("searchSettings")!=null){this.searchSettings=new bu;try{let i=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,i)}catch{}}}savePushRegistration(i){localStorage.setItem("_pushToken",i.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable(i){let u=window.location.search.substring(1).split("&");for(let r=0;r<u.length;r++){let x=u[r].split("=");if(decodeURIComponent(x[0])==i)return x[1].split(",").map(R=>decodeURIComponent(R))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&this.getQueryVariable("mode")[0]=="embedded"&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let i=this.getQueryVariable("operatorid");for(let p of i)this.searchSettings.OperatorList.unshift(parseInt(p,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let i=this.getQueryVariable("latitude")[0],p=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new qi(parseFloat(i),parseFloat(p))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0]),this.getQueryVariable("languagecode")&&this.setLanguage(this.getQueryVariable("languagecode")[0]),this.getQueryVariable("id")&&(this.searchSettings.StartViewPoiId=this.getQueryVariable("id")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438"},{code:"cs",title:"Czech / \u010Ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AE"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xF1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xE7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65E5\u672C\u8A9E"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xEAs"},{code:"ro",title:"Romanian / Rom\xE2n\u0103"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043A\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010Dina"},{code:"tr",title:"Turkish / T\xFCrk\xE7e"},{code:"zh",title:"Chinese / \u4E2D\u56FD\u7684"}]}setLanguage(i){(i==null||i=="")&&(i="en"),this.logging.log("Changing language: "+i),this.translateService.use(i)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&this.submissionQueue!=null&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let i=localStorage.getItem("authResponse");if(i!=null){let p=JSON.parse(i);if(p?.Data!=null&&p?.Data?.access_token!=null){let u=this.jwtHelper.decodeToken(p.Data.access_token);this.jwtHelper.isTokenExpired(p.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=p,this.logging.log("User has valid auth token in local storage",Gi.VERBOSE))}else this.logging.log("User has invalid auth token in local storage",Gi.VERBOSE),localStorage.removeItem("authResponse")}}isUserAuthenticated(i=!1){if(i===!1&&this._isUserAuthenticated!=null)return this._isUserAuthenticated;if(this._isUserAuthenticated=!1,this.api.authResponse!=null){let p=this.api.authResponse;this.jwtHelper.isTokenExpired(p.Data.access_token)||(this._isUserAuthenticated=!0)}return this._isUserAuthenticated}getCurrentAuthToken(){return this.api.authResponse!=null?this.api.authResponse.Data.access_token:null}getUserProfile(){return this.api.authResponse!=null?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment(i){if(this.enableSubmissionQueue)this.submissionQueue.add(Xr.Comment,i),this.submissionQueue.processNextQueueItem();else return this.api.performSubmission(Xr.Comment,i)}submitMediaItem(i){if(this.enableSubmissionQueue)this.submissionQueue.add(Xr.Media,i),this.submissionQueue.processNextQueueItem();else return this.api.performSubmission(Xr.Media,i)}submitPOI(i){if(this.enableSubmissionQueue)this.submissionQueue.add(Xr.POI,i),this.submissionQueue.processNextQueueItem();else return this.api.performSubmission(Xr.POI,i)}showToastNotification(i){return Be(this,null,function*(){yield(yield this.toastController.create({message:i,duration:3e3})).present()})}showLoadingProgress(i){return Be(this,null,function*(){yield(yield this.loadingController.create({message:i})).present()})}dismissLoadingProgress(){return Be(this,null,function*(){return this.loadingController.dismiss()})}launchOCMWebPage(i){this.isUserAuthenticated(!0)&&(i.indexOf("?")===-1&&(i+="?"),i+="&auth="+this.getCurrentAuthToken()),i="https://openchargemap.org/site"+i,window.open(i,"_system")}launchWebPage(i){window.open(i,"_system")}isPlatform(i){return this.platform.is(i)}static \u0275fac=function(p){return new(p||l)(Ct(tr),Ct(Tr),Ct(wu),Ct(p1),Ct(cu),Ct(Us),Ct($s),Ct(js),Ct(l1),Ct(Bs),Ct(sm),Ct(pi),Ct(om))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function _S(l,s){if(l&1&&(q(0,"ion-select-option",13),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}function yS(l,s){if(l&1&&(q(0,"ion-select-option",16),pe(1),K()),l&2){let i=s.$implicit,p=s.index;Ce("value",p),Y(),yt(i.Title)}}function vS(l,s){if(l&1){let i=Pt();q(0,"ion-item")(1,"ion-label",2),pe(2,"Journey Stage"),K(),q(3,"ion-select",3),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.selectedStageIndex,u)||(r.selectedStageIndex=u),Ne(u)}),q(4,"ion-select-option",14),pe(5,"Create a Journey Stage"),K(),it(6,yS,2,2,"ion-select-option",15),K()()}if(l&2){let i=be();Y(3),vt("ngModel",i.selectedStageIndex),Y(3),Ce("ngForOf",i.journeyManager.getJourneyStages(i.selectedJourneyID))}}function xS(l,s){if(l&1){let i=Pt();q(0,"ion-item")(1,"ion-label",2),pe(2,"New Journey Name"),K(),q(3,"ion-input",7),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.newJourneyName,u)||(r.newJourneyName=u),Ne(u)}),K()()}if(l&2){let i=be();Y(3),vt("ngModel",i.newJourneyName)}}var m1=(()=>{class l{appManager;navParams;journeyManager;modalController;selectedJourneyID;selectedStageIndex;newJourneyName;waypoint;poi;constructor(i,p,u,r){this.appManager=i,this.navParams=p,this.journeyManager=u,this.modalController=r,this.poi=this.navParams.get("poi"),this.waypoint=new qa,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];let x=new Nl("charging",1);x.Poi=this.poi,x.PoiID=this.poi.ID,this.waypoint.PoiList.push(x),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(this.selectedJourneyID!=null&&this.selectedJourneyID!=="")this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{let i=new Ns;i.ID=Date.now().toString(),this.newJourneyName===""&&(this.newJourneyName="New Journey"),i.Title=this.newJourneyName,this.journeyManager.addJourney(i,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}static \u0275fac=function(p){return new(p||l)(ot(Pr),ot(hu),ot($s),ot(Ir))};static \u0275cmp=Ti({type:l,selectors:[["ng-component"]],standalone:!1,decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModelChange","ngModel"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModelChange","ngModel"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(p,u){p&1&&(q(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),pe(3," Edit Favourite "),K()()(),q(4,"ion-content",0)(5,"div",1)(6,"h1"),pe(7),K(),q(8,"p"),pe(9),K()(),q(10,"p"),pe(11," Add Charging Location as a Journey Waypoint "),K(),q(12,"ion-item")(13,"ion-label",2),pe(14,"Add to a Journey"),K(),q(15,"ion-select",3),xt("ngModelChange",function(x){return _t(u.selectedJourneyID,x)||(u.selectedJourneyID=x),x}),q(16,"ion-select-option",4),pe(17,"Create a New Journey"),K(),it(18,_S,2,2,"ion-select-option",5),K()(),it(19,vS,7,2,"ion-item",6)(20,xS,4,1,"ion-item",6),q(21,"ion-item")(22,"ion-label",2),pe(23,"Name for this step of your journey"),K(),q(24,"ion-input",7),xt("ngModelChange",function(x){return _t(u.waypoint.Title,x)||(u.waypoint.Title=x),x}),K()(),q(25,"ion-item")(26,"ion-label",2),pe(27,"Other Notes"),K(),q(28,"ion-textarea",3),xt("ngModelChange",function(x){return _t(u.waypoint.Notes,x)||(u.waypoint.Notes=x),x}),K()()(),q(29,"ion-footer")(30,"ion-toolbar")(31,"ion-buttons",8)(32,"ion-button",9),rt("click",function(){return u.cancel()}),Ye(33,"ion-icon",10),pe(34," Cancel "),K()(),q(35,"ion-buttons",11)(36,"ion-button",9),rt("click",function(){return u.add()}),pe(37," Add "),Ye(38,"ion-icon",12),K()()()()),p&2&&(Y(7),yt(u.poi.AddressInfo.Title),Y(2),yt(u.poi.AddressInfo.AddressLine1),Y(6),vt("ngModel",u.selectedJourneyID),Y(3),Ce("ngForOf",u.journeyManager.journeys),Y(),Ce("ngIf",u.selectedJourneyID),Y(),Ce("ngIf",!u.selectedJourneyID),Y(4),vt("ngModel",u.waypoint.Title),Y(4),vt("ngModel",u.waypoint.Notes))},dependencies:[kn,Yi,Ln,Dn,Fi,nr,ho,po,mo,Bi,Sr,Qi,Rn,pa,da,o1,fo,or,wr,ir],encapsulation:2})}return l})();function bS(l,s){if(l&1){let i=Pt();ii(0),q(1,"p",13),pe(2," Sign in using your Open Charge Map account. "),K(),q(3,"ion-list")(4,"ion-item")(5,"ion-input",14),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.email,u)||(r.email=u),Ne(u)}),K()(),q(6,"ion-item")(7,"ion-input",15),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.password,u)||(r.password=u),Ne(u)}),K()()(),q(8,"p")(9,"a",8),rt("click",function(){Ue(i);let u=be();return Ne(u.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset"))}),pe(10,"Reset your password"),K()(),ni()}if(l&2){let i=be();Y(5),vt("ngModel",i.email),Y(2),vt("ngModel",i.password)}}function wS(l,s){if(l&1){let i=Pt();ii(0),q(1,"p",13),pe(2," Create a new Open Charge Map account. "),K(),q(3,"ion-list")(4,"ion-item")(5,"ion-label",16),pe(6,"Email"),K(),q(7,"ion-input",17),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.email,u)||(r.email=u),Ne(u)}),K()(),q(8,"ion-item")(9,"ion-label",16),pe(10,"Display Name or Nickname"),K(),q(11,"ion-input",17),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.username,u)||(r.username=u),Ne(u)}),K()(),q(12,"ion-item")(13,"ion-label",16),pe(14,"Password"),K(),q(15,"ion-input",18),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.password,u)||(r.password=u),Ne(u)}),K()(),q(16,"ion-item")(17,"ion-label",16),pe(18,"Confirm Password"),K(),q(19,"ion-input",18),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.confirmpassword,u)||(r.confirmpassword=u),Ne(u)}),K()()(),ni()}if(l&2){let i=be();Y(7),vt("ngModel",i.email),Y(4),vt("ngModel",i.username),Y(4),vt("ngModel",i.password),Y(4),vt("ngModel",i.confirmpassword)}}var lm=(()=>{class l{appManager;modalController;translate;alertController;loadingController;logging;router;location;email;password;username;confirmpassword;mode="signin";constructor(i,p,u,r,x,C,A,R){this.appManager=i,this.modalController=p,this.translate=u,this.alertController=r,this.loadingController=x,this.logging=C,this.router=A,this.location=R,this.email=""}cancelSignIn(){this.modalController.dismiss()}performRegister(){return Be(this,null,function*(){if(this.password!=this.confirmpassword){alert("Your password and the confirmed password do not match, please try again.");return}if(this.password.length<6){alert("Your password should be at least 6 characters.");return}let i=yield this.loadingController.create({message:"Registering .."});yield i.present();let p=!1;try{let u=yield this.appManager.api.performRegister(this.username,this.email,this.password);i.dismiss(),localStorage.setItem("authResponse",JSON.stringify(this.appManager.api.authResponse)),this.appManager.isUserAuthenticated(!0),this.modalController.dismiss(),this.appManager.analytics.appEvent("Profile","SignedIn")}catch(u){p=!0,i.dismiss(),yield(yield this.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),this.logging.log("Error logging in:"+u)}})}performSignIn(){return Be(this,null,function*(){if(this.mode=="register")return this.performRegister();let i=yield this.loadingController.create({message:"Signing In.."});yield i.present();let p=!1;try{let u=yield this.appManager.api.performSignIn(this.email,this.password);i.dismiss(),localStorage.setItem("authResponse",JSON.stringify(this.appManager.api.authResponse)),this.appManager.isUserAuthenticated(!0),this.modalController.dismiss(),this.appManager.analytics.appEvent("Profile","SignedIn")}catch(u){p=!0,i.dismiss(),yield(yield this.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),this.logging.log("Error logging in:"+u)}})}static \u0275fac=function(p){return new(p||l)(ot(Pr),ot(Ir),ot(js),ot(nm),ot(Bs),ot(pi),ot(lu),ot($v))};static \u0275cmp=Ti({type:l,selectors:[["ng-component"]],standalone:!1,decls:28,vars:9,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[3,"ngModelChange","ngModel"],["value","signin"],["value","register"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"],[1,"ion-padding"],["label","Email","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","Password","label-placement","floating","type","password",3,"ngModelChange","ngModel"],["position","floating"],["type","text",3,"ngModelChange","ngModel"],["type","password",3,"ngModelChange","ngModel"]],template:function(p,u){p&1&&(q(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),pe(3),Ai(4,"translate"),K()()(),q(5,"ion-content",0)(6,"ion-avatar",1),Ye(7,"img",2),K(),q(8,"ion-segment",3),xt("ngModelChange",function(x){return _t(u.mode,x)||(u.mode=x),x}),q(9,"ion-segment-button",4)(10,"ion-label"),pe(11,"Sign In"),K()(),q(12,"ion-segment-button",5)(13,"ion-label"),pe(14,"Create Account"),K()()(),it(15,bS,11,2,"ng-container",6)(16,wS,20,4,"ng-container",6),K(),q(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",7)(20,"ion-button",8),rt("click",function(){return u.cancelSignIn()}),Ye(21,"ion-icon",9),pe(22," Cancel"),K()(),q(23,"ion-buttons",10)(24,"ion-button",11),rt("click",function(){return u.performSignIn()}),Ye(25,"ion-icon",12),pe(26),Ai(27,"translate"),K()()()()),p&2&&(Y(3),mt(" ",Sn(4,5,"ocm.general.signIn")," "),Y(5),vt("ngModel",u.mode),Y(7),Ce("ngIf",u.mode=="signin"),Y(),Ce("ngIf",u.mode=="register"),Y(10),mt(" ",Sn(27,7,"ocm.general.signIn")))},dependencies:[Yi,Ln,Dn,Fs,Fi,nr,ho,po,mo,Bi,Sr,Qi,Rn,rr,_u,yu,fo,or,wr,ir,vu],encapsulation:2})}return l})();var qn=(()=>{class l{static isFeatureEnabled(i){return!!dr.enabledFeatures.find(p=>p===i)}static getClientHeight(){let i=document.body,p=document.documentElement;return Math.max(i.scrollHeight,i.offsetHeight,p.clientHeight,p.scrollHeight,p.offsetHeight)}static getClientWidth(){let i=document.body,p=document.documentElement;return Math.max(i.scrollWidth,i.offsetWidth,p.clientWidth,p.scrollWidth,p.offsetWidth)}static getMaxLevelOfPOI(i){let p=0;if(i.StatusTypeID==150)return 0;if(i.Connections!=null)for(let u=0;u<i.Connections.length;u++)i.Connections[u].Level!=null&&i.Connections[u].Level.ID>p&&(p=i.Connections[u].Level.ID);return p===4&&(p=2),p>4&&(p=3),p}static getIconForPOI(i){let u="assets/images/icons/map/level"+l.getMaxLevelOfPOI(i);return i.UsageType!=null&&i.UsageType.Title.indexOf("Private")>-1?u+="_private":i.StatusType!=null&&i.StatusType.IsOperational!==!0?u+="_nonoperational":u+="_operational",u+="_icon.png",u}static getColorForPOI(i){let p=l.getMaxLevelOfPOI(i),u="#c0c0c0";return i.UsageType!=null&&i.UsageType.Title.indexOf("Private")>-1?u="#FF0000":i.StatusType!=null&&i.StatusType.IsOperational!==!0?u="#a0a0a0":p==2?u="#72EB0D":p==3&&(u="#EB800D"),u}static getIconForConnector(i){let p="assets/images/icons/connectors/";return i===1?p+="Type1_J1772.svg":i===2?p+="Chademo_type4.svg":i===25?p+="Type2_socket.svg":i===32?p+="Type1_CCS.svg":i===33?p+="Type2_CCS.svg":i===1036?p+="Type2_tethered.svg":i===26?p+="Type3c.svg":i===28?p+="schuko.svg":p+="Unknown.svg",p}static getFormattedDistance(i){return i&&i.AddressInfo&&i.AddressInfo.Distance?i.AddressInfo.Distance.toFixed(1)+" "+(i.AddressInfo.DistanceUnit===1?"km":"miles"):""}static fixJSONDate(i){if(i==null)return null;if(i.indexOf("/")==0){let u=/Date\(([^)]+)\)/.exec(i);i=new Date(parseFloat(u[1]))}else i=new Date(i);return i}static formatMapLinkFromPosition(i,p,u,r,x){return'<a href="https://maps.google.com/maps?saddr='+p+","+u+"&daddr="+i.AddressInfo.Latitude+","+i.AddressInfo.Longitude+'">Map ('+Math.ceil(r)+" "+x+")</a>"}static formatSystemWebLink(i,p){return`<a href='#' onclick="window.open('`+i+`', '_system');return false;">`+p+"</a>"}static formatMapLink(i,p,u){return u?device&&device.platform=="WinCE"?this.formatSystemWebLink("maps:"+i.AddressInfo.Latitude+","+i.AddressInfo.Longitude,p):device&&device.platform==="iOS"?this.formatSystemWebLink("https://maps.apple.com/?q="+i.AddressInfo.Latitude+","+i.AddressInfo.Longitude,p):this.formatSystemWebLink("https://maps.google.com/maps?q="+i.AddressInfo.Latitude+","+i.AddressInfo.Longitude,p):'<a target="_blank"  href="https://maps.google.com/maps?q='+i.AddressInfo.Latitude+","+i.AddressInfo.Longitude+'">'+p+"</a>"}static formatURL(i,p=null){return i==null||i==""?"":(i.indexOf("http")==-1&&(i="https://"+i),'<a target="_blank" href="'+i+'">'+(p??i)+"</a>")}static formatPOIAddress=function(i,p=!0){let u="";return p?u=""+this.formatTextField(i.AddressInfo.AddressLine1)+this.formatTextField(i.AddressInfo.AddressLine2)+this.formatTextField(i.AddressInfo.Town)+this.formatTextField(i.AddressInfo.StateOrProvince)+this.formatTextField(i.AddressInfo.Postcode)+(i.AddressInfo.Country!=null?this.formatTextField(i.AddressInfo.Country.Title):""):u=this.formatStringArray([i.AddressInfo.AddressLine1,i.AddressInfo.AddressLine2,i.AddressInfo.Town,i.AddressInfo.StateOrProvince,i.AddressInfo.Postcode,i.AddressInfo.Country!=null?i.AddressInfo.Country.Title:""]),u};static formatStringArray=function(i,p=", "){if(i==null)return"";let u="";for(let r=0;r<i.length;r++)i[r]!=null&&i[r].trim()!=""&&(r==i.length-1?u+=i[r]:u+=i[r]+p);return u};static formatString(i){return i==null?"":i.toString()}static formatTextField(i,p=null,u=!1,r=!1,x=null){if(i==null||i==""||i==null)return"";let C=(p!=null?"<strong class='ocm-label' "+(x!=null?"data-localize='"+x+"' ":"")+">"+p+"</strong>: ":"")+(u?"<br/>":"")+i.toString().replace(`
`,"<br/>")+"<br/>";return r==!0&&(C="<p>"+C+"</p>"),C}static formatEmailAddress(i){return i!=null&&i!=null&&i!=""?`<i class='fa fa-envelope fa-fw'></i> <a href="mailto:`+i+'">'+i+"</a><br/>":""}static formatPhone(i,p=null){return i!=null&&i!=null&&i!=""?(p==null?p="<i class='fa fa-phone fa-fw '></i> ":p+=": ",p+'<a href="tel:'+i+'">'+i+"</a><br/>"):""}static formatPOIDetails(i,p){let u=864e5,r=new Date;p==null&&(p=!1);let x=this.formatPOIAddress(i,!1),C="";C+=this.formatPhone(i.AddressInfo.ContactTelephone1),C+=this.formatPhone(i.AddressInfo.ContactTelephone2),C+=this.formatEmailAddress(i.AddressInfo.ContactEmail);let A="";if(i.AddressInfo.Distance!=null){let fe="https://maps.google.com/maps?saddr=&daddr="+i.AddressInfo.Latitude+","+i.AddressInfo.Longitude;A+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+i.AddressInfo.Distance.toFixed(1)+" "+(i.AddressInfo.DistanceUnit==2?"Miles":"KM")+"</strong>",A+="<p>"+this.formatSystemWebLink(fe,"Get Directions")+"</p>"}if(i.AddressInfo.RelatedURL!=null&&i.AddressInfo.RelatedURL!=""){let fe=i.AddressInfo.RelatedURL;fe=fe.replace(/.*?:\/\//g,""),fe.length>40&&(fe=fe.substr(0,40)+".."),C+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(i.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+fe+"</span>")}C+="</p>";let R=this.formatTextField(i.GeneralComments,null,!1,!0)+this.formatTextField(i.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments"),U="";i.NumberOfPoints!=null&&(U+=this.formatTextField(i.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),i.UsageType!=null&&(U+=this.formatTextField(i.UsageType.Title,"Usage",!1,!0,"details.usageType")),i.UsageCost!=null&&(U+=this.formatTextField(i.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),i.OperatorInfo!=null&&i.OperatorInfo.ID!=1&&(U+=this.formatTextField(i.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),i.OperatorInfo.WebsiteURL!=null&&(U+=this.formatTextField(this.formatURL(i.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let F="";if(i.StatusType!=null&&(F+=this.formatTextField(i.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),i.DateLastStatusUpdate!=null&&(F+=this.formatTextField(Math.round((r-this.fixJSONDate(i.DateLastStatusUpdate))/u)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),i.Connections!=null&&i.Connections.length>0){F+="<table class='table table-striped'>",F+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let fe=0;fe<i.Connections.length;fe++){let xe=i.Connections[fe];xe.Amps==""&&(xe.Amps=null),xe.Voltage==""&&(xe.Voltage=null),xe.Quantity==""&&(xe.Quantity=null),xe.PowerKW==""&&(xe.PowerKW=null),F+="<tr><td>"+(xe.ConnectionType!=null?xe.ConnectionType.Title:"")+"</td><td>"+(xe.Level!=null?"<strong>"+xe.Level.Title+"</strong><br/>":"")+(xe.Amps!=null?this.formatString(xe.Amps)+"A/ ":"")+(xe.Voltage!=null?this.formatString(xe.Voltage)+"V/ ":"")+(xe.PowerKW!=null?this.formatString(xe.PowerKW)+"kW <br/>":"")+(xe.CurrentType!=null?xe.CurrentType.Title:"")+"<br/>"+(xe.Quantity!=null?this.formatString(xe.Quantity):"1")+" Present</td><td>"+(xe.StatusType!=null?xe.StatusType.Title:"-")+"</td></tr>"}F+="</table>"}let le="";return le+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+i.ID+"'>OCM-"+i.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),i.DataProvider!=null&&(le+=this.formatTextField(i.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),i.DataProvider.WebsiteURL!=null&&(le+=this.formatTextField(this.formatURL(i.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),le+=this.formatTextField(i.AddressInfo.Latitude,"Latitude",!1,!0,null),le+=this.formatTextField(i.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:x,drivingInfo:A,contactInfo:C,additionalInfo:R+U+F,advancedInfo:le}}static debounce(i,p,u){let r;return function(){let x=this,C=arguments,A=function(){r=null,u||i.apply(x,C)},R=u&&!r;clearTimeout(r),r=setTimeout(A,p),R&&i.apply(x,C)}}static getRandomInt(i){return Math.floor(Math.random()*Math.floor(i))}}return l})();var Sf={};dS(Sf,{AJAXError:()=>QM,AttributionControl:()=>mp,AttributionControlMLGL:()=>RM,BoxZoomHandler:()=>q0,BoxZoomHandlerMLGL:()=>jM,CanvasSource:()=>F0,CanvasSourceMLGL:()=>TM,ColorRamp:()=>Mt,ColorRampCollection:()=>G_,CooperativeGesturesHandler:()=>Z0,CooperativeGesturesHandlerMLGL:()=>NM,CubemapFaceNames:()=>Hs,CubemapImagesPresets:()=>Jb,CubemapLayer:()=>Lu,DOMcreate:()=>ya,DOMremove:()=>yf,DoubleClickZoomHandler:()=>lE,DragPanHandler:()=>aE,DragRotateHandler:()=>oE,EdgeInsets:()=>rE,Evented:()=>YM,FullscreenControl:()=>Om,FullscreenControlMLGL:()=>FM,GeoJSONSource:()=>B0,GeoJSONSourceMLGL:()=>CM,GeolocateControl:()=>Dm,GeolocateControlMLGL:()=>DM,GeolocationType:()=>Qb,Hash:()=>iE,ImageSource:()=>j0,ImageSourceMLGL:()=>PM,KeyboardHandler:()=>H0,KeyboardHandlerMLGL:()=>VM,Language:()=>ei,LngLat:()=>ac,LngLatBounds:()=>wf,LogoControl:()=>Rm,LogoControlMLGL:()=>zM,Map:()=>vf,MapMLGL:()=>bM,MapMouseEvent:()=>Y0,MapMouseEventMLGL:()=>WM,MapStyle:()=>_o,MapStyleVariant:()=>qs,MapTouchEvent:()=>J0,MapTouchEventMLGL:()=>qM,MapWheelEvent:()=>X0,MapWheelEventMLGL:()=>GM,MaptilerGeolocateControl:()=>nf,MaptilerLogoControl:()=>fp,MaptilerNavigationControl:()=>tf,MaptilerProjectionControl:()=>rf,MaptilerTerrainControl:()=>ef,Marker:()=>af,MarkerMLGL:()=>wM,MercatorCoordinate:()=>JM,NavigationControMLGL:()=>LM,NavigationControl:()=>Ru,Point:()=>nE,Popup:()=>z0,PopupMLGL:()=>SM,RadialGradientLayer:()=>Du,RasterDEMTileSource:()=>N0,RasterDEMTileSourceMLGL:()=>EM,RasterTileSource:()=>U0,RasterTileSourceMLGL:()=>MM,ReferenceMapStyle:()=>Ws,ScaleControl:()=>zm,ScaleControlMLGL:()=>OM,ScrollZoomHandler:()=>W0,ScrollZoomHandlerMLGL:()=>UM,SdkConfig:()=>Lm,ServiceError:()=>Mr,Style:()=>O0,StyleMLGL:()=>IM,TerrainControMLGL:()=>BM,TerrainControl:()=>G0,TwoFingersTouchPitchHandler:()=>K0,TwoFingersTouchPitchHandlerMLGL:()=>$M,TwoFingersTouchRotateHandler:()=>uE,TwoFingersTouchZoomHandler:()=>cE,TwoFingersTouchZoomRotateHandler:()=>sE,VectorTileSource:()=>V0,VectorTileSourceMLGL:()=>AM,VideoSource:()=>$0,VideoSourceMLGL:()=>kM,addProtocol:()=>vE,addSourceType:()=>_E,areSameLanguages:()=>b1,bufferToPixelDataBrowser:()=>s0,canParsePixelData:()=>gm,circumferenceAtLatitude:()=>r0,clearPrewarmedResources:()=>tE,config:()=>ki,configMLGL:()=>ZM,coordinates:()=>C1,cubemapPresets:()=>Js,data:()=>P1,displayWebGLContextLostWarning:()=>LI,elevation:()=>F1,expandMapStyle:()=>rp,geocoding:()=>T1,geolocation:()=>np,getAutoLanguage:()=>hm,getBrowserLanguage:()=>k0,getBufferToPixelDataParser:()=>l0,getLanguageInfoFromCode:()=>Za,getLanguageInfoFromFlag:()=>ql,getLanguageInfoFromKey:()=>Qg,getMapLibreVersion:()=>HM,getMaxParallelImageRequests:()=>dE,getRTLTextPluginStatus:()=>XM,getTileCache:()=>a0,getVersion:()=>xM,getWebGLSupportError:()=>ub,getWorkerCount:()=>hE,getWorkerUrl:()=>fE,gpx:()=>U_,gpxOrKml:()=>aw,hasChildNodeWithName:()=>j_,helpers:()=>vM,importScriptInWorkers:()=>yE,isLanguageInfo:()=>dm,kml:()=>N_,mapStylePresetList:()=>Ha,math:()=>o0,misc:()=>e0,prewarm:()=>eE,removeProtocol:()=>xE,setMaxParallelImageRequests:()=>mE,setRTLTextPlugin:()=>KM,setWorkerCount:()=>pE,setWorkerUrl:()=>gE,staticMaps:()=>M1,str2xml:()=>xf,styleToStyle:()=>op,toLanguageInfo:()=>Wl,xml2str:()=>v_});var gt=Av(_1(),1);var cm=class extends Map{#n=0;#e=new Map;#t=new Map;#r;#a;#o;constructor(s={}){if(super(),!(s.maxSize&&s.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof s.maxAge=="number"&&s.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.#r=s.maxSize,this.#a=s.maxAge||Number.POSITIVE_INFINITY,this.#o=s.onEviction}get __oldCache(){return this.#t}#s(s){if(typeof this.#o=="function")for(let[i,p]of s)this.#o(i,p.value)}#i(s,i){return typeof i.expiry=="number"&&i.expiry<=Date.now()?(typeof this.#o=="function"&&this.#o(s,i.value),this.delete(s)):!1}#p(s,i){if(this.#i(s,i)===!1)return i.value}#l(s,i){return i.expiry?this.#p(s,i):i.value}#c(s,i){let p=i.get(s);return this.#l(s,p)}#u(s,i){this.#e.set(s,i),this.#n++,this.#n>=this.#r&&(this.#n=0,this.#s(this.#t),this.#t=this.#e,this.#e=new Map)}#d(s,i){this.#t.delete(s),this.#u(s,i)}*#h(){for(let s of this.#t){let[i,p]=s;this.#e.has(i)||this.#i(i,p)===!1&&(yield s)}for(let s of this.#e){let[i,p]=s;this.#i(i,p)===!1&&(yield s)}}get(s){if(this.#e.has(s)){let i=this.#e.get(s);return this.#l(s,i)}if(this.#t.has(s)){let i=this.#t.get(s);if(this.#i(s,i)===!1)return this.#d(s,i),i.value}}set(s,i,{maxAge:p=this.#a}={}){let u=typeof p=="number"&&p!==Number.POSITIVE_INFINITY?Date.now()+p:void 0;return this.#e.has(s)?this.#e.set(s,{value:i,expiry:u}):this.#u(s,{value:i,expiry:u}),this}has(s){return this.#e.has(s)?!this.#i(s,this.#e.get(s)):this.#t.has(s)?!this.#i(s,this.#t.get(s)):!1}peek(s){if(this.#e.has(s))return this.#c(s,this.#e);if(this.#t.has(s))return this.#c(s,this.#t)}expiresIn(s){let i=this.#e.get(s)??this.#t.get(s);if(i)return i.expiry?i.expiry-Date.now():Number.POSITIVE_INFINITY}delete(s){let i=this.#e.delete(s);return i&&this.#n--,this.#t.delete(s)||i}clear(){this.#e.clear(),this.#t.clear(),this.#n=0}resize(s){if(!(s&&s>0))throw new TypeError("`maxSize` must be a number greater than 0");let i=[...this.#h()],p=i.length-s;p<0?(this.#e=new Map(i),this.#t=new Map,this.#n=i.length):(p>0&&this.#s(i.slice(0,p)),this.#t=new Map(i.slice(p)),this.#e=new Map,this.#n=0),this.#r=s}*keys(){for(let[s]of this)yield s}*values(){for(let[,s]of this)yield s}*[Symbol.iterator](){for(let s of this.#e){let[i,p]=s;this.#i(i,p)===!1&&(yield[i,p.value])}for(let s of this.#t){let[i,p]=s;this.#e.has(i)||this.#i(i,p)===!1&&(yield[i,p.value])}}*entriesDescending(){let s=[...this.#e];for(let i=s.length-1;i>=0;--i){let p=s[i],[u,r]=p;this.#i(u,r)===!1&&(yield[u,r.value])}s=[...this.#t];for(let i=s.length-1;i>=0;--i){let p=s[i],[u,r]=p;this.#e.has(u)||this.#i(u,r)===!1&&(yield[u,r.value])}}*entriesAscending(){for(let[s,i]of this.#h())yield[s,i.value]}get size(){if(!this.#n)return this.#t.size;let s=0;for(let i of this.#t.keys())this.#e.has(i)||s++;return Math.min(this.#n+s,this.#r)}get maxSize(){return this.#r}entries(){return this.entriesAscending()}forEach(s,i=this){for(let[p,u]of this.entriesAscending())s.call(i,u,p,this)}get[Symbol.toStringTag](){return"QuickLRU"}toString(){return`QuickLRU(${this.size}/${this.maxSize})`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}};function SS(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}var Xg=class{constructor(){this._apiKey="",this._fetch=SS(),this.tileCacheSize=200}set apiKey(s){this._apiKey=s}get apiKey(){return this._apiKey}set fetch(s){this._fetch=s}get fetch(){return this._fetch}},gn=new Xg,IS={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},TS={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},Fo=Xt(Xt({},IS),TS);function Qg(l,s=Fo){return l in s?l[l]:null}function Za(l,s=Fo){for(let i of Object.values(s))if(i.code===l)return i;return null}function ql(l,s=Fo){for(let i of Object.values(s))if(i.flag===l)return i;return null}function hm(){if(typeof navigator>"u"){let s=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return Za(s)??Fo.ENGLISH}return Array.from(new Set(navigator.languages.map(s=>s.split("-")[0]))).map(s=>Za(s)).filter(s=>s)[0]??Fo.ENGLISH}function dm(l){return l!==null&&typeof l=="object"&&"code"in l&&"flag"in l&&"name"in l&&"latin"in l&&"isMode"in l&&"geocoding"in l&&(typeof l.code=="string"||l.code===null)&&typeof l.flag=="string"&&typeof l.name=="string"&&typeof l.latin=="boolean"&&typeof l.isMode=="boolean"&&typeof l.geocoding=="boolean"}function Wl(l,s=Fo){return dm(l)?ql(l.flag,s):typeof l!="string"?null:Qg(l,s)||Za(l,s)||ql(l,s)||null}function b1(l,s,i=Fo){let p=Wl(l,i),u=Wl(s,i);return p&&u&&p.flag===u.flag}function Bo(i){return Be(this,arguments,function*(l,s={}){if(gn.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(l).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return gn.fetch(l,s)})}var Er={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(Er);var Mr=class extends Error{constructor(s,i=""){super(`Call to enpoint ${s.url} failed with the status code ${s.status}. ${i}`),this.res=s}},mm={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function w1(l,s){let{language:i}=s;if(i===void 0)return;let p=(Array.isArray(i)?i:[i]).map(r=>CS(r)).filter(r=>r),u=Array.from(new Set(p)).join(",");l.set("language",u)}function CS(l){let s=l===Fo.AUTO.flag?hm():typeof l=="string"?Za(l):dm(l)?l.flag===Fo.AUTO.flag?hm():ql(l.flag):null;return s?.geocoding?s.code:null}function S1(l,s){let{apiKey:i,limit:p,types:u,excludeTypes:r}=s;l.set("key",i??gn.apiKey),p!==void 0&&l.set("limit",String(p)),u!==void 0&&l.set("types",u.join(",")),r!==void 0&&l.set("excludeTypes",String(r)),w1(l,s)}function I1(l,s){S1(l,s);let{bbox:i,proximity:p,country:u,fuzzyMatch:r,autocomplete:x}=s;i!==void 0&&l.set("bbox",i.join(",")),p!==void 0&&l.set("proximity",p==="ip"?p:p.join(",")),u!==void 0&&l.set("country",u.join(",")),r!==void 0&&l.set("fuzzyMatch",r?"true":"false"),x!==void 0&&l.set("autocomplete",x?"true":"false")}function PS(i){return Be(this,arguments,function*(l,s={}){if(typeof l!="string"||l.trim().length===0)throw new Error("The query must be a non-empty string");let p=new URL(`geocoding/${encodeURIComponent(l)}.json`,Er.maptilerApiURL);I1(p.searchParams,s);let u=yield Bo(p.toString());if(!u.ok)throw new Mr(u,mm[u.status]??"");return yield u.json()})}function MS(i){return Be(this,arguments,function*(l,s={}){if(!Array.isArray(l)||l.length<2)throw new Error("The position must be an array of form [lng, lat].");let p=new URL(`geocoding/${l[0]},${l[1]}.json`,Er.maptilerApiURL);S1(p.searchParams,s);let u=yield Bo(p.toString());if(!u.ok)throw new Mr(u,mm[u.status]??"");return yield u.json()})}function ES(i){return Be(this,arguments,function*(l,s={}){let p=new URL(`geocoding/${l}.json`,Er.maptilerApiURL);p.searchParams.set("key",s.apiKey??gn.apiKey),w1(p.searchParams,s);let u=yield Bo(p.toString());if(!u.ok)throw new Mr(u,mm[u.status]??"");return yield u.json()})}function AS(i){return Be(this,arguments,function*(l,s={}){if(!l.length)return[];let p=l.map(C=>encodeURIComponent(C)).join(";"),u=new URL(`geocoding/${p}.json`,Er.maptilerApiURL);I1(u.searchParams,s);let r=yield Bo(u.toString());if(!r.ok)throw new Mr(r,mm[r.status]??"");let x=yield r.json();return l.length===1?[x]:x})}var T1={forward:PS,reverse:MS,byId:ES,batch:AS},y1={403:"Key is missing, invalid or restricted"};function kS(){return Be(this,arguments,function*(l={}){let s=new URL("geolocation/ip.json",Er.maptilerApiURL);s.searchParams.set("key",l.apiKey??gn.apiKey),"elevation"in l&&s.searchParams.set("elevation",l.elevation?"true":"false");let i=s.toString(),p=yield Bo(i);if(!p.ok)throw new Mr(p,p.status in y1?y1[p.status]:"");return yield p.json()})}var np={info:kS},pm={403:"Key is missing, invalid or restricted"};function LS(i){return Be(this,arguments,function*(l,s={}){if(typeof l!="string"||l.trim().length===0)throw new Error("The query must be a non-empty string");let p=new URL(`coordinates/search/${l}.json`,Er.maptilerApiURL);p.searchParams.set("key",s.apiKey??gn.apiKey),"limit"in s&&p.searchParams.set("limit",s.limit.toString()),"transformations"in s&&p.searchParams.set("transformations",s.transformations.toString()),"exports"in s&&p.searchParams.set("exports",s.exports.toString());let u=p.toString(),r=yield Bo(u);if(!r.ok)throw new Mr(r,r.status in pm?pm[r.status]:"");return yield r.json()})}function DS(i){return Be(this,arguments,function*(l,s={}){let p=(Array.isArray(l[0])?l:[l]).map(A=>`${A[0]},${A[1]}`).join(";"),u=new URL(`coordinates/transform/${p}.json`,Er.maptilerApiURL);u.searchParams.set("key",s.apiKey??gn.apiKey),"sourceCrs"in s&&u.searchParams.set("s_srs",s.sourceCrs.toString()),"targetCrs"in s&&u.searchParams.set("t_srs",s.targetCrs.toString()),"operations"in s&&u.searchParams.set("ops",(Array.isArray(s.operations)?s.operations:[s.operations]).join("|"));let r=u.toString(),x=yield Bo(r);if(!x.ok)throw new Mr(x,x.status in pm?pm[x.status]:"");return yield x.json()})}var C1={search:LS,transform:DS},v1={403:"Key is missing, invalid or restricted"};function RS(i){return Be(this,arguments,function*(l,s={}){if(typeof l!="string"||l.trim().length===0)throw new Error("The data ID must be a non-empty string");let p=new URL(`data/${encodeURIComponent(l)}/features.json`,Er.maptilerApiURL);p.searchParams.set("key",s.apiKey??gn.apiKey);let u=p.toString(),r=yield Bo(u);if(!r.ok)throw new Mr(r,r.status in v1?v1[r.status]:"");return yield r.json()})}var P1={get:RS};function rp(l){let s=/^maptiler:\/\/(.*)/,i,p=l.trim(),u;return p.startsWith("http://")||p.startsWith("https://")?u=p:(i=s.exec(p))!==null?u=`https://api.maptiler.com/maps/${i[1]}/style.json`:u=`https://api.maptiler.com/maps/${p}/style.json`,u}var qs=class{constructor(s,i,p,u,r,x,C=!1){this.name=s,this.variantType=i,this.id=p,this.referenceStyle=u,this.description=r,this.imageURL=x,this.deprecated=C}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(s){return this.referenceStyle.hasVariant(s)}getVariant(s){let i=this.referenceStyle.getVariant(s);return this.warnIfDeprecated(i),i}getVariants(){return this.referenceStyle.getVariants().filter(s=>s!==this).map(s=>(this.warnIfDeprecated(s),s))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return rp(this.getId())}warnIfDeprecated(s=this){if(!s.deprecated)return s;let i=s.getFullName();return console.warn(`Style "${i}" is deprecated and will be removed in a future version.`),s}},Ws=class{constructor(s,i){this.name=s,this.id=i,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(s){this.variants[s.getType()]=s,this.orderedVariants.push(s)}hasVariant(s){return s in this.variants}getVariant(s){return s in this.variants?this.variants[s]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}},Ha=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",deprecated:!0,name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function zS(l){return new Proxy(l,{get(s,i,p){return s.hasVariant(i)?s.getVariant(i):i.toString().toUpperCase()===i?l.getDefaultVariant():Reflect.get(s,i,p)}})}function OS(){let l={};for(let s=0;s<Ha.length;s+=1){let i=Ha[s],p=zS(new Ws(i.name,i.referenceStyleID));for(let u=0;u<i.variants.length;u+=1){let r=i.variants[u],x=new qs(r.name,r.variantType,r.id,p,r.description,r.imageURL,r.deprecated);p.addVariant(x)}l[i.referenceStyleID]=p}return l}function op(l){if(!l)return _o[Ha[0].referenceStyleID].getDefaultVariant().getId();if(typeof l=="string"||l instanceof String)return l.trim().toLowerCase();if(l instanceof qs)return l.getId();if(l instanceof Ws)return l.getDefaultVariant().getId()}var _o=OS();function FS(l){let s=[];function i(r){(r.type==="LineString"||r.type==="MultiLineString")&&s.push(r)}function p(r){r.geometry&&i(r.geometry)}function u(r){for(let x of r.features)x.type==="Feature"?p(x):x.type==="FeatureCollection"&&u(x)}return l.type==="Feature"?p(l):l.type==="FeatureCollection"?u(l):i(l),s}function BS(l,s,i){let p=s[0],u=s[1],r=i[0]-p,x=i[1]-u;if(r!==0||x!==0){let C=((l[0]-p)*r+(l[1]-u)*x)/(r*r+x*x);C>1?(p=i[0],u=i[1]):C>0&&(p+=r*C,u+=x*C)}return r=l[0]-p,x=l[1]-u,r*r+x*x}function Jg(l,s,i,p,u){let r=p,x;for(let C=s+1;C<i;C++){let A=BS(l[C],l[s],l[i]);A>r&&(x=C,r=A)}r>p&&(x-s>1&&Jg(l,s,x,p,u),u.push(l[x]),i-x>1&&Jg(l,x,i,p,u))}function jS(l,s){let i=l.length-1,p=[l[0]];return Jg(l,0,i,s,p),p.push(l[i]),p}function US(l,s){if(l.length<=2)return l;let i=s!==void 0?s*s:1;return jS(l,i)}var e0={extractLineStrings:FS,simplify:US};function t0(l,s=!0){let i=`${l[0]},${l[1]}`;return l.length===3&&s&&(i+=`,${l[2]}`),i}function i0(l,s=3e3){let i=l.map(r=>r.join(",")).join("|"),p=5e-6,u=1e-5;for(;i.length>s;)i=e0.simplify(l,p).map(x=>`${x[0]},${x[1]}`).join("|"),p+=u;return i}function NS(l,s,i={}){let p=op(i.style),u=i.hiDPI?"@2x":"",r=i.format??"png",x=~~(i.width??1024),C=~~(i.height??1024);i.hiDPI&&(x=~~(x/2),C=~~(C/2));let A=new URL(`maps/${encodeURIComponent(p)}/static/${l[0]},${l[1]},${s}/${x}x${C}${u}.${r}`,Er.maptilerApiURL);if("attribution"in i&&A.searchParams.set("attribution",i.attribution.toString()),"markers"in i){let R="",U="markerIcon"in i;U&&(R+=`icon:${i.markerIcon}|`),U&&"markerAnchor"in i&&(R+=`anchor:${i.markerAnchor}|`),U&&i.hiDPI&&(R+="scale:2|");let F=Array.isArray(i.markers[0])?i.markers:[i.markers];R+=F.map(le=>t0(le,!U)).join("|"),A.searchParams.set("markers",R)}if("path"in i){let R="";if(R+=`fill:${i.pathFillColor??"none"}|`,"pathStrokeColor"in i&&(R+=`stroke:${i.pathStrokeColor}|`),"pathWidth"in i){let U=i.pathWidth/(i.hiDPI?2:1);R+=`width:${U.toString()}|`}R+=i0(i.path),A.searchParams.set("path",R)}return A.searchParams.set("key",i.apiKey??gn.apiKey),A.toString()}function VS(l,s={}){let i=op(s.style),p=s.hiDPI?"@2x":"",u=s.format??"png",r=~~(s.width??1024),x=~~(s.height??1024);s.hiDPI&&(r=~~(r/2),x=~~(x/2));let C=new URL(`maps/${encodeURIComponent(i)}/static/${l[0]},${l[1]},${l[2]},${l[3]}/${r}x${x}${p}.${u}`,Er.maptilerApiURL);if("attribution"in s&&C.searchParams.set("attribution",s.attribution.toString()),"padding"in s&&C.searchParams.set("padding",s.padding.toString()),"markers"in s){let A="",R="markerIcon"in s;R&&(A+=`icon:${s.markerIcon}|`),R&&"markerAnchor"in s&&(A+=`anchor:${s.markerAnchor}|`),R&&s.hiDPI&&(A+="scale:2|");let U=Array.isArray(s.markers[0])?s.markers:[s.markers];A+=U.map(F=>t0(F,!R)).join("|"),C.searchParams.set("markers",A)}if("path"in s){let A="";if(A+=`fill:${s.pathFillColor??"none"}|`,"pathStrokeColor"in s&&(A+=`stroke:${s.pathStrokeColor}|`),"pathWidth"in s){let R=s.pathWidth/(s.hiDPI?2:1);A+=`width:${R.toString()}|`}A+=i0(s.path),C.searchParams.set("path",A)}return C.searchParams.set("key",s.apiKey??gn.apiKey),C.toString()}function $S(l={}){if(!("markers"in l)&&!("path"in l))throw new Error("Automatic static maps require markers and/or path to be created.");let s=op(l.style),i=l.hiDPI?"@2x":"",p=l.format??"png",u=~~(l.width??1024),r=~~(l.height??1024);l.hiDPI&&(u=~~(u/2),r=~~(r/2));let x=new URL(`maps/${encodeURIComponent(s)}/static/auto/${u}x${r}${i}.${p}`,Er.maptilerApiURL);if("attribution"in l&&x.searchParams.set("attribution",l.attribution.toString()),"padding"in l&&x.searchParams.set("padding",l.padding.toString()),"markers"in l){let C="",A="markerIcon"in l;A&&(C+=`icon:${l.markerIcon}|`),A&&"markerAnchor"in l&&(C+=`anchor:${l.markerAnchor}|`),A&&l.hiDPI&&(C+="scale:2|");let R=Array.isArray(l.markers[0])?l.markers:[l.markers];C+=R.map(U=>t0(U,!A)).join("|"),x.searchParams.set("markers",C)}if("path"in l){let C="";if(C+=`fill:${l.pathFillColor??"none"}|`,"pathStrokeColor"in l&&(C+=`stroke:${l.pathStrokeColor}|`),"pathWidth"in l){let A=l.pathWidth/(l.hiDPI?2:1);C+=`width:${A.toString()}|`}C+=i0(l.path),x.searchParams.set("path",C)}return x.searchParams.set("key",l.apiKey??gn.apiKey),x.toString()}var M1={centered:NS,bounded:VS,automatic:$S},fm=63710088e-1,E1=2*Math.PI*fm;function A1(l){return(180+l)/360}function k1(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function L1(l){let s=z1(l);return[A1(s[0]),k1(s[1])]}function D1(l){return l*360-180}function R1(l){let s=180-l*360;return 360/Math.PI*Math.atan(Math.exp(s*Math.PI/180))-90}function GS(l){return[D1(l[0]),R1(l[1])]}function n0(l,s){let i=Math.PI/180,p=l[1]*i,u=s[1]*i,r=Math.sin(p)*Math.sin(u)+Math.cos(p)*Math.cos(u)*Math.cos((s[0]-l[0])*i);return fm*Math.acos(Math.min(r,1))}function qS(l){let s=Array(l.length);s[0]=0;let i=s.length;for(let p=1;p<i;p++)s[p]=n0(l[p-1],l[p])+s[p-1];return s}function z1(l){let s=l[0],i=l[1],p=360,u=((s+180)%p+p)%p-180;return[u===-180?180:u,i]}function r0(l){return E1*Math.cos(l*Math.PI/180)}function O1(l,s,i=!0){let p=2**s,u=[l[0]*p,l[1]*p];return i?[~~u[0],~~u[1]]:u}function WS(l,s,i=!0){let p=L1(l);return O1(p,s,i)}function ip(l){return l*Math.PI/180}function Yg(l){return l*180/Math.PI}function ZS(l,s,i){let p=n0(l,s),u=ip(l[0]),r=ip(l[1]),x=ip(s[0]),C=ip(s[1]),A=p/fm,R=Math.sin((1-i)*A)/Math.sin(A),U=Math.sin(i*A)/Math.sin(A),F=R*Math.cos(r)*Math.cos(u)+U*Math.cos(C)*Math.cos(x),le=R*Math.cos(r)*Math.sin(u)+U*Math.cos(C)*Math.sin(x),se=R*Math.sin(r)+U*Math.sin(C),fe=Math.atan2(se,Math.sqrt(F*F+le*le)),xe=Math.atan2(le,F);return[Yg(xe),Yg(fe)]}var o0={EARTH_RADIUS:fm,EARTH_CIRCUMFERENCE:E1,longitudeToMercatorX:A1,latitudeToMercatorY:k1,wgs84ToMercator:L1,mercatorXToLongitude:D1,mercatorYToLatitude:R1,mercatorToWgs84:GS,haversineDistanceWgs84:n0,wrapWgs84:z1,circumferenceAtLatitude:r0,mercatorToTileIndex:O1,wgs84ToTileIndex:WS,toRadians:ip,toDegrees:Yg,haversineIntermediateWgs84:ZS,haversineCumulatedDistanceWgs84:qS},Hg=null;function a0(){return Hg||(Hg=new cm({maxSize:gn.tileCacheSize})),Hg}function s0(l){return Be(this,null,function*(){let s=new Blob([l]),i=yield createImageBitmap(s),p=document.createElement("canvas"),u=p.getContext("2d");p.width=i.width,p.height=i.height,u.drawImage(i,0,0);let r=u.getImageData(0,0,p.width,p.height);return{pixels:r.data,width:p.width,height:p.height,components:r.data.length/(p.width*p.height)}})}function l0(){if(gn.bufferToPixelData)return gn.bufferToPixelData;if(typeof window<"u")return s0;throw new Error("An image file buffer to pixel data parser is necessary. Specify it in `config.bufferToPixelData`")}function gm(){return!!gn.bufferToPixelData||typeof window<"u"}var HS="terrain-rgb-v2",Kg=50,KS=1e3,um=null,x1={403:"Key is missing, invalid or restricted"};function XS(l,s){return Be(this,null,function*(){l.length>KS&&console.warn("Computing elevation for complex geometries is discouraged - simplify the geometry before proceeding");let i=Math.ceil(l.length/Kg),p=Array.from({length:i},()=>null).map((x,C)=>{let A=C*Kg,U=l.slice(A,A+Kg).map(le=>le.join(",")).join(";"),F=new URL(`elevation/${U}.json`,Er.maptilerApiURL);return F.searchParams.set("key",s),Bo(F.toString())}),u=yield Promise.allSettled(p);return(yield Promise.all(u.map(x=>Be(null,null,function*(){if(x.status==="rejected")throw new Error(`Some segments could not be fetched, error: ${x.reason}`);if(!x.value.ok)throw new Error(`Some segments could not be fetched, response: ${x.value.status} ${yield x.value.text()}, url: ${x.value.url}`);return x.value.json()})))).flat()})}function JS(l,s,i){return Be(this,null,function*(){if(!um){let je=new URL(`tiles/${HS}/tiles.json`,Er.maptilerApiURL);je.searchParams.set("key",s);let ht=je.toString(),Et=yield Bo(ht);if(Et.ok)um=yield Et.json();else throw new Mr(Et,x1[Et.status]??"")}let p=l0(),u=um.tiles[0],r=a0(),x=um.maxzoom,C=~~(i??x);(C>x||C<0)&&(C=x);let A=l.map(je=>o0.wgs84ToTileIndex(je,C,!1)),U=A.map(je=>[~~je[0],~~je[1]]).map(je=>`terrain_${C.toString()}_${je[0].toString()}_${je[1].toString()}`),F=Array.from(new Set(U.filter(je=>!r.has(je)))).map(je=>je.split("_").slice(1)),se=F.map(je=>u.replace("{x}",je[1].toString()).replace("{y}",je[2].toString()).replace("{z}",je[0].toString())).map(je=>Bo(je)),xe=(yield Promise.allSettled(se)).map(je=>je.status==="fulfilled"?je.value:null).filter(je=>je),Le=xe.filter(je=>!je.ok);if(xe.length!==se.length)throw new Error("Some tiles could not be fetched.");if(Le.length)throw new Mr(Le[0],x1[Le[0].status]??"");let Fe=yield Promise.all(xe.map(je=>je.arrayBuffer()));if(!Fe.every(je=>je.byteLength>0))throw new Error("Some tiles are not available.");return(yield Promise.all(Fe.map(je=>p(je)))).forEach((je,ht)=>{let Et=F[ht],Ui=`terrain_${Et[0].toString()}_${Et[1].toString()}_${Et[2].toString()}`;r.set(Ui,je)}),l.map((je,ht)=>{let Et=U[ht],Ui=A[ht],mi=r.get(Et),On=Math.min(Math.round(mi.width*(Ui[0]%1)),mi.width-1),Hn=(Math.min(Math.round(mi.height*(Ui[1]%1)),mi.height-1)*mi.width+On)*mi.components,To=mi.pixels[Hn],Ar=mi.pixels[Hn+1],kr=mi.pixels[Hn+2],Lr=-1e4+(To*256*256+Ar*256+kr)*.1;return[je[0],je[1],~~(Lr*1e3)/1e3]})})}function YS(i){return Be(this,arguments,function*(l,s={}){return(yield _m([l],s))[0]})}function _m(i){return Be(this,arguments,function*(l,s={}){if(l.length===0)return[];let p=s.apiKey??gn.apiKey,u=s.computeOn==="client"?yield JS(l,p,s.zoom):yield XS(l,p);if(s.smoothingKernelSize){let r=~~(s.smoothingKernelSize/2)*2+1,x=u.map(A=>A[2]),C=~~(r/2);for(let A=C;A<x.length-C-1;A+=1){let R=0;for(let U=0;U<r;U+=1){let F=x[A-C+U];R+=F}R/=r,u[A][2]=R}}return u})}function QS(i){return Be(this,arguments,function*(l,s={}){if(l.type!=="LineString")throw new Error("The provided object is not a GeoJSON LineString");s.computeOn??(s.computeOn=gm()?"client":"server");let p=structuredClone(l),u=yield _m(p.coordinates,s);return p.coordinates=u,p})}function eI(i){return Be(this,arguments,function*(l,s={}){if(l.type!=="MultiLineString")throw new Error("The provided object is not a GeoJSON MultiLineString");s.computeOn??(s.computeOn=gm()?"client":"server");let p=structuredClone(l),u=p.coordinates.map(R=>R.length),r=p.coordinates.flat(),x=yield _m(r,s),C=[],A=0;for(let R of u)C.push(x.slice(A,A+R)),A+=R;return p.coordinates=C,p})}var F1={at:YS,batch:_m,fromLineString:QS,fromMultiLineString:eI};var sb=Av(H1(),1);var Wn=[];for(let l=0;l<256;++l)Wn.push((l+256).toString(16).slice(1));function K1(l,s=0){return(Wn[l[s+0]]+Wn[l[s+1]]+Wn[l[s+2]]+Wn[l[s+3]]+"-"+Wn[l[s+4]]+Wn[l[s+5]]+"-"+Wn[l[s+6]]+Wn[l[s+7]]+"-"+Wn[l[s+8]]+Wn[l[s+9]]+"-"+Wn[l[s+10]]+Wn[l[s+11]]+Wn[l[s+12]]+Wn[l[s+13]]+Wn[l[s+14]]+Wn[l[s+15]]).toLowerCase()}var u0,sI=new Uint8Array(16);function h0(){if(!u0){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");u0=crypto.getRandomValues.bind(crypto)}return u0(sI)}var lI=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),p0={randomUUID:lI};function cI(l,s,i){if(p0.randomUUID&&!s&&!l)return p0.randomUUID();l=l||{};let p=l.random??l.rng?.()??h0();if(p.length<16)throw new Error("Random bytes length must be >= 16");if(p[6]=p[6]&15|64,p[8]=p[8]&63|128,s){if(i=i||0,i<0||i+16>s.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let u=0;u<16;++u)s[i+u]=p[u];return s}return K1(p)}var d0=cI;var tx="3.7.8",uI=tx,Cu=typeof Buffer=="function",X1=typeof TextDecoder=="function"?new TextDecoder:void 0,J1=typeof TextEncoder=="function"?new TextEncoder:void 0,hI="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ap=Array.prototype.slice.call(hI),xm=(l=>{let s={};return l.forEach((i,p)=>s[i]=p),s})(ap),pI=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Zn=String.fromCharCode.bind(String),Y1=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):l=>new Uint8Array(Array.prototype.slice.call(l,0)),ix=l=>l.replace(/=/g,"").replace(/[+\/]/g,s=>s=="+"?"-":"_"),nx=l=>l.replace(/[^A-Za-z0-9\+\/]/g,""),rx=l=>{let s,i,p,u,r="",x=l.length%3;for(let C=0;C<l.length;){if((i=l.charCodeAt(C++))>255||(p=l.charCodeAt(C++))>255||(u=l.charCodeAt(C++))>255)throw new TypeError("invalid character found");s=i<<16|p<<8|u,r+=ap[s>>18&63]+ap[s>>12&63]+ap[s>>6&63]+ap[s&63]}return x?r.slice(0,x-3)+"===".substring(x):r},g0=typeof btoa=="function"?l=>btoa(l):Cu?l=>Buffer.from(l,"binary").toString("base64"):rx,m0=Cu?l=>Buffer.from(l).toString("base64"):l=>{let i=[];for(let p=0,u=l.length;p<u;p+=4096)i.push(Zn.apply(null,l.subarray(p,p+4096)));return g0(i.join(""))},bm=(l,s=!1)=>s?ix(m0(l)):m0(l),dI=l=>{if(l.length<2){var s=l.charCodeAt(0);return s<128?l:s<2048?Zn(192|s>>>6)+Zn(128|s&63):Zn(224|s>>>12&15)+Zn(128|s>>>6&63)+Zn(128|s&63)}else{var s=65536+(l.charCodeAt(0)-55296)*1024+(l.charCodeAt(1)-56320);return Zn(240|s>>>18&7)+Zn(128|s>>>12&63)+Zn(128|s>>>6&63)+Zn(128|s&63)}},mI=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ox=l=>l.replace(mI,dI),Q1=Cu?l=>Buffer.from(l,"utf8").toString("base64"):J1?l=>m0(J1.encode(l)):l=>g0(ox(l)),Tu=(l,s=!1)=>s?ix(Q1(l)):Q1(l),ex=l=>Tu(l,!0),fI=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,gI=l=>{switch(l.length){case 4:var s=(7&l.charCodeAt(0))<<18|(63&l.charCodeAt(1))<<12|(63&l.charCodeAt(2))<<6|63&l.charCodeAt(3),i=s-65536;return Zn((i>>>10)+55296)+Zn((i&1023)+56320);case 3:return Zn((15&l.charCodeAt(0))<<12|(63&l.charCodeAt(1))<<6|63&l.charCodeAt(2));default:return Zn((31&l.charCodeAt(0))<<6|63&l.charCodeAt(1))}},ax=l=>l.replace(fI,gI),sx=l=>{if(l=l.replace(/\s+/g,""),!pI.test(l))throw new TypeError("malformed base64.");l+="==".slice(2-(l.length&3));let s,i,p,u=[];for(let r=0;r<l.length;)s=xm[l.charAt(r++)]<<18|xm[l.charAt(r++)]<<12|(i=xm[l.charAt(r++)])<<6|(p=xm[l.charAt(r++)]),i===64?u.push(Zn(s>>16&255)):p===64?u.push(Zn(s>>16&255,s>>8&255)):u.push(Zn(s>>16&255,s>>8&255,s&255));return u.join("")},_0=typeof atob=="function"?l=>atob(nx(l)):Cu?l=>Buffer.from(l,"base64").toString("binary"):sx,lx=Cu?l=>Y1(Buffer.from(l,"base64")):l=>Y1(_0(l).split("").map(s=>s.charCodeAt(0))),cx=l=>lx(ux(l)),_I=Cu?l=>Buffer.from(l,"base64").toString("utf8"):X1?l=>X1.decode(lx(l)):l=>ax(_0(l)),ux=l=>nx(l.replace(/[-_]/g,s=>s=="-"?"+":"/")),f0=l=>_I(ux(l)),yI=l=>{if(typeof l!="string")return!1;let s=l.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(s)||!/[^\s0-9a-zA-Z\-_]/.test(s)},hx=l=>({value:l,enumerable:!1,writable:!0,configurable:!0}),px=function(){let l=(s,i)=>Object.defineProperty(String.prototype,s,hx(i));l("fromBase64",function(){return f0(this)}),l("toBase64",function(s){return Tu(this,s)}),l("toBase64URI",function(){return Tu(this,!0)}),l("toBase64URL",function(){return Tu(this,!0)}),l("toUint8Array",function(){return cx(this)})},dx=function(){let l=(s,i)=>Object.defineProperty(Uint8Array.prototype,s,hx(i));l("toBase64",function(s){return bm(this,s)}),l("toBase64URI",function(){return bm(this,!0)}),l("toBase64URL",function(){return bm(this,!0)})},vI=()=>{px(),dx()},mx={version:tx,VERSION:uI,atob:_0,atobPolyfill:sx,btoa:g0,btoaPolyfill:rx,fromBase64:f0,toBase64:Tu,encode:Tu,encodeURI:ex,encodeURL:ex,utob:ox,btou:ax,decode:f0,isValid:yI,fromUint8Array:bm,toUint8Array:cx,extendString:px,extendUint8Array:dx,extendBuiltins:vI};var xI=Object.defineProperty,ab=l=>{throw TypeError(l)},bI=(l,s,i)=>s in l?xI(l,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[s]=i,at=(l,s,i)=>bI(l,typeof s!="symbol"?s+"":s,i),C_=(l,s,i)=>s.has(l)||ab("Cannot "+i),ti=(l,s,i)=>(C_(l,s,"read from private field"),i?i.call(l):s.get(l)),Zl=(l,s,i)=>s.has(l)?ab("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(l):s.set(l,i),Mu=(l,s,i,p)=>(C_(l,s,"write to private field"),p?p.call(l,i):s.set(l,i),i),Jr=(l,s,i)=>(C_(l,s,"access private method"),i),ei=Xt({VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1}},Fo);function k0(){if(typeof navigator>"u"){let l=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return Za(l)||ei.ENGLISH}return Array.from(new Set(navigator.languages.map(l=>l.split("-")[0]))).map(l=>Za(l)).filter(l=>l)[0]??ei.LOCAL}var gr={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:ei.STYLE,secondaryLanguage:ei.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(gr);var P_=d0(),Lm=class extends sb.default{constructor(){super(...arguments),at(this,"primaryLanguage",gr.primaryLanguage),at(this,"secondaryLanguage"),at(this,"session",!0),at(this,"caching",!0),at(this,"telemetry",!0),at(this,"_unit","metric"),at(this,"_apiKey","")}set unit(s){this._unit=s,this.emit("unit",s)}get unit(){return this._unit}set apiKey(s){this._apiKey=s,gn.apiKey=s,this.emit("apiKey",s)}get apiKey(){return this._apiKey}set fetch(s){gn.fetch=s}get fetch(){return gn.fetch}},ki=new Lm,L0="localcache_source",D0="localcache",wI="maptiler_sdk",SI=1e3,II=100,R0=typeof caches<"u",{addProtocol:fx}=gt.default;function TI(l,s){if(R0&&ki.caching&&ki.session&&l.host===gr.maptilerApiHost){if(s==="Source"&&l.href.includes("tiles.json"))return l.href.replace("https://",`${L0}://`);if(s==="Tile"||s==="Glyphs")return l.href.replace("https://",`${D0}://`)}return l.href}var y0;function lb(){return Be(this,null,function*(){return y0||(y0=yield caches.open(wI)),y0})}var gx=0;function CI(){return Be(this,null,function*(){let l=yield lb(),s=yield l.keys(),i=s.slice(0,Math.max(s.length-SI,0));for(let p of i)l.delete(p)})}function PI(){fx(L0,(l,s)=>Be(null,null,function*(){if(!l.url)throw new Error("");l.url=l.url.replace(`${L0}://`,"https://");let i=l;i.signal=s.signal;let p=yield fetch(l.url,i),u=yield p.json();return u.tiles&&u.tiles.length>0&&(u.tiles[0]+=`&last-modified=${p.headers.get("Last-Modified")}`),{data:u,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}})),fx(D0,(l,s)=>Be(null,null,function*(){if(!l.url)throw new Error("");l.url=l.url.replace(`${D0}://`,"https://");let i=new URL(l.url),p=new URL(i);p.searchParams.delete("mtsid"),p.searchParams.delete("key");let u=p.toString(),r=new URL(i);r.searchParams.delete("last-modified");let x=r.toString(),C=le=>Be(null,null,function*(){return{data:yield le.arrayBuffer(),cacheControl:le.headers.get("Cache-Control"),expires:le.headers.get("Expires")}}),A=yield lb(),R=yield A.match(u);if(R)return C(R);let U=l;U.signal=s.signal;let F=yield fetch(x,U);return F.status>=200&&F.status<300&&(A.put(u,F.clone()).catch(()=>{}),++gx>II&&(CI(),gx=0)),C(F)}))}function MI(){if(typeof window>"u")return;let l=gt.default.getRTLTextPluginStatus();if(l==="unavailable"||l==="requested")try{gt.default.setRTLTextPlugin(gr.rtlPluginURL,!0)}catch{}}function EI(l,s){for(let i of l)typeof s[i]=="function"&&(s[i]=s[i].bind(s))}function _x(l,s){let i=null;try{i=new URL(l)}catch{return{url:l}}return i.host===gr.maptilerApiHost&&(i.searchParams.has("key")||i.searchParams.append("key",ki.apiKey),ki.session&&i.searchParams.append("mtsid",P_)),{url:TI(i,s)}}function yx(l){return(s,i)=>{if(l!=null){let p=l(s,i),u=_x(p?.url??"",i);return Xt(Xt({},p),u)}return _x(s,i)}}function cb(){return Math.random().toString(36).substring(2)}function of(l){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(l)}function AI(l){try{return JSON.parse(l)}catch{}return null}function ub(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function kI(l){let s=ub();if(!s)return;let i=null;if(typeof l=="string"?i=document.getElementById(l):l instanceof HTMLElement&&(i=l),!i)throw new Error("The Map container must be provided.");let p=document.createElement("div");throw p.innerHTML=s,p.classList.add("webgl-warning-div"),i.appendChild(p),new Error(s)}function LI(l){let s="The WebGL context was lost.",i=l.getContainer(),p=document.createElement("div");p.innerHTML=s,p.classList.add("webgl-warning-div"),i.appendChild(p)}function vx(l,s){return!(!Array.isArray(l)||l.length!==2||l[0]!=="get"||typeof l[1]!="string"||s&&!l[1].startsWith("name:")||!s&&l[1]!=="name")}function DI(l,s,i){let p=structuredClone(l),u=r=>{if(typeof r!="string")for(let x=0;x<r.length;x+=1)vx(r[x],i)?r[x]=structuredClone(s):u(r[x])};return vx(p,i)?s:(u(p),p)}function RI(l,s){let i=s?/\{name:\S+\}/:/\{name\}/;return{contains:i.test(l),exactMatch:new RegExp(`^${i.source}$`).test(l)}}function zI(l,s,i){let p=i?/\{name:\S+\}/:/\{name\}/,u=l.split(p);return["concat",...u.flatMap((r,x)=>x===u.length-1?[r]:[r,s])]}function OI(l){var s;let i=/\{name(?::(?<language>\S+))?\}/g,p=[];for(;;){let u=i.exec(l);if(!u)break;let r=((s=u.groups)==null?void 0:s.language)??null;p.push(r)}return p}function FI(l){return!Array.isArray(l)||l.length!==2||l[0]!=="get"||typeof l[1]!="string"?null:l[1].trim()==="name"?{isLanguage:!0,localization:null}:l[1].trim().startsWith("name:")?{isLanguage:!0,localization:l[1].trim().split(":").pop()}:null}function BI(l){let s=[],i=structuredClone(l),p=u=>{if(typeof u!="string")for(let r=0;r<u.length;r+=1){let x=FI(u[r]);x?s.push(x.localization):p(u[r])}};return p([i]),s}function jI(l,s){let i=[];for(let r of l){if(r.type!=="symbol")continue;let x=r,{id:C,layout:A}=x;if(!A||!("text-field"in A))continue;let R=s.getLayoutProperty(C,"text-field");if(R)if(typeof R=="string"){let U=OI(R);i.push(U)}else{let U=BI(R);i.push(U)}}let p=i.flat(),u={unlocalized:0,localized:{}};for(let r of p)r===null?u.unlocalized+=1:(r in u.localized||(u.localized[r]=0),u.localized[r]+=1);return u}var af=class extends gt.default.Marker{addTo(l){return super.addTo(l)}},z0=class extends gt.default.Popup{addTo(s){return super.addTo(s)}},O0=class extends gt.default.Style{constructor(s,i={}){super(s,i)}},F0=class extends gt.default.CanvasSource{onAdd(s){super.onAdd(s)}},B0=class extends gt.default.GeoJSONSource{onAdd(s){super.onAdd(s)}},j0=class extends gt.default.ImageSource{onAdd(s){super.onAdd(s)}},U0=class extends gt.default.RasterTileSource{onAdd(s){super.onAdd(s)}},N0=class extends gt.default.RasterDEMTileSource{onAdd(s){super.onAdd(s)}},V0=class extends gt.default.VectorTileSource{onAdd(s){super.onAdd(s)}},$0=class extends gt.default.VideoSource{onAdd(s){super.onAdd(s)}},Ru=class extends gt.default.NavigationControl{onAdd(s){return super.onAdd(s)}},Dm=class extends gt.default.GeolocateControl{onAdd(s){return super.onAdd(s)}},mp=class extends gt.default.AttributionControl{onAdd(s){return super.onAdd(s)}},Rm=class extends gt.default.LogoControl{onAdd(s){return super.onAdd(s)}},zm=class extends gt.default.ScaleControl{onAdd(s){return super.onAdd(s)}},Om=class extends gt.default.FullscreenControl{onAdd(s){return super.onAdd(s)}},G0=class extends gt.default.TerrainControl{onAdd(s){return super.onAdd(s)}},q0=class extends gt.default.BoxZoomHandler{constructor(s,i){super(s,i)}},W0=class extends gt.default.ScrollZoomHandler{constructor(s,i){super(s,i)}},Z0=class extends gt.default.CooperativeGesturesHandler{constructor(s,i){super(s,i)}},H0=class extends gt.default.KeyboardHandler{constructor(s){super(s)}},K0=class extends gt.default.TwoFingersTouchPitchHandler{constructor(s){super(s)}},X0=class extends gt.default.MapWheelEvent{constructor(s,i,p){super(s,i,p)}},J0=class extends gt.default.MapTouchEvent{constructor(s,i,p){super(s,i,p)}},Y0=class extends gt.default.MapMouseEvent{constructor(s,i,p,u={}){super(s,i,p,u)}},fp=class extends Rm{constructor(s={}){super(s),at(this,"logoURL",""),at(this,"linkURL",""),this.logoURL=s.logoURL??gr.maptilerLogoURL,this.linkURL=s.linkURL??gr.maptilerURL}onAdd(s){this._map=s,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";let i=window.document.createElement("a");return i.style.backgroundRepeat="no-repeat",i.style.cursor="pointer",i.style.display="block",i.style.height="23px",i.style.margin="0 0 -4px -4px",i.style.overflow="hidden",i.style.width="88px",i.style.backgroundImage=`url(${this.logoURL})`,i.style.backgroundSize="100px 30px",i.style.width="100px",i.style.height="30px",i.target="_blank",i.rel="noopener",i.href=this.linkURL,i.setAttribute("aria-label","MapTiler logo"),i.setAttribute("rel","noopener"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}},UI=8,NI={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},VI={"*":{type:"source"}},$I=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],GI={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},qI={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},WI={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},ZI={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},HI={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},KI={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},XI={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},JI=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],YI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},QI={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},eT={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},tT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},iT={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},nT={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},rT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},oT={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},aT={type:"array",value:"*"},sT={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},lT={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},cT={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},uT={type:"array",value:"*",minimum:1},hT={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},pT={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},dT={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},mT={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},fT=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],gT={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},_T={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},yT={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},vT={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},xT={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},bT={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},wT={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},ST={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},IT={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},TT={"*":{type:"string"}},CT={$version:UI,$root:NI,sources:VI,source:$I,source_vector:GI,source_raster:qI,source_raster_dem:WI,source_geojson:ZI,source_video:HI,source_image:KI,layer:XI,layout:JI,layout_background:YI,layout_fill:QI,layout_circle:eT,layout_heatmap:tT,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:iT,layout_symbol:nT,layout_raster:rT,layout_hillshade:oT,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:aT,filter_operator:sT,geometry_type:lT,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:cT,expression:uT,light:hT,sky:pT,terrain:dT,projection:mT,paint:fT,paint_fill:gT,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:_T,paint_circle:yT,paint_heatmap:vT,paint_symbol:xT,paint_raster:bT,paint_hillshade:wT,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:ST,transition:IT,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:TT},Ze=class{constructor(s,i,p,u){this.message=(s?`${s}: `:"")+p,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}};function Fm(l,...s){for(let i of s)for(let p in i)l[p]=i[p];return l}var xo=class extends Error{constructor(s,i){super(i),this.message=i,this.key=s}},Q0=class l{constructor(s,i=[]){this.parent=s,this.bindings={};for(let[p,u]of i)this.bindings[p]=u}concat(s){return new l(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return this.bindings[s]?!0:this.parent?this.parent.has(s):!1}},sf={kind:"null"},et={kind:"number"},Zt={kind:"string"},Gt={kind:"boolean"},ga={kind:"color"},lf={kind:"projectionDefinition"},Yl={kind:"object"},Nt={kind:"value"},PT={kind:"error"},cf={kind:"collator"},uf={kind:"formatted"},hf={kind:"padding"},gp={kind:"colorArray"},pf={kind:"numberArray"},Ap={kind:"resolvedImage"},df={kind:"variableAnchorOffsetCollection"};function Qr(l,s){return{kind:"array",itemType:l,N:s}}function ji(l){if(l.kind==="array"){let s=ji(l.itemType);return typeof l.N=="number"?`array<${s}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${s}>`}else return l.kind}var MT=[sf,et,Zt,Gt,ga,lf,uf,Yl,Qr(Nt),hf,pf,gp,Ap,df];function _p(l,s){if(s.kind==="error")return null;if(l.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!_p(l.itemType,s.itemType))&&(typeof l.N!="number"||l.N===s.N))return null}else{if(l.kind===s.kind)return null;if(l.kind==="value"){for(let i of MT)if(!_p(i,s))return null}}return`Expected ${ji(l)} but found ${ji(s)} instead.`}function M_(l,s){return s.some(i=>i.kind===l.kind)}function Ql(l,s){return s.some(i=>i==="null"?l===null:i==="array"?Array.isArray(l):i==="object"?l&&!Array.isArray(l)&&typeof l=="object":i===typeof l)}function Zs(l,s){return l.kind==="array"&&s.kind==="array"?l.itemType.kind===s.itemType.kind&&typeof l.N=="number":l.kind===s.kind}var hb=.96422,pb=1,db=.82521,mb=4/29,ku=6/29,fb=3*ku*ku,ET=ku*ku*ku,AT=Math.PI/180,kT=180/Math.PI;function gb(l){return l=l%360,l<0&&(l+=360),l}function _b([l,s,i,p]){l=v0(l),s=v0(s),i=v0(i);let u,r,x=x0((.2225045*l+.7168786*s+.0606169*i)/pb);l===s&&s===i?u=r=x:(u=x0((.4360747*l+.3850649*s+.1430804*i)/hb),r=x0((.0139322*l+.0971045*s+.7141733*i)/db));let C=116*x-16;return[C<0?0:C,500*(u-x),200*(x-r),p]}function v0(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function x0(l){return l>ET?Math.pow(l,1/3):l/fb+mb}function yb([l,s,i,p]){let u=(l+16)/116,r=isNaN(s)?u:u+s/500,x=isNaN(i)?u:u-i/200;return u=pb*w0(u),r=hb*w0(r),x=db*w0(x),[b0(3.1338561*r-1.6168667*u-.4906146*x),b0(-.9787684*r+1.9161415*u+.033454*x),b0(.0719453*r-.2289914*u+1.4052427*x),p]}function b0(l){return l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055,l<0?0:l>1?1:l}function w0(l){return l>ku?l*l*l:fb*(l-mb)}function LT(l){let[s,i,p,u]=_b(l),r=Math.sqrt(i*i+p*p);return[Math.round(r*1e4)?gb(Math.atan2(p,i)*kT):NaN,r,s,u]}function DT([l,s,i,p]){return l=isNaN(l)?0:l*AT,yb([i,Math.cos(l)*s,Math.sin(l)*s,p])}function RT([l,s,i,p]){l=gb(l),s/=100,i/=100;function u(r){let x=(r+l/30)%12,C=s*Math.min(i,1-i);return i-C*Math.max(-1,Math.min(x-3,9-x,1))}return[u(0),u(8),u(4),p]}var zT=Object.hasOwn||function(l,s){return Object.prototype.hasOwnProperty.call(l,s)};function up(l,s){return zT(l,s)?l[s]:void 0}function OT(l){if(l=l.toLowerCase().trim(),l==="transparent")return[0,0,0,0];let s=up(FT,l);if(s){let[u,r,x]=s;return[u/255,r/255,x/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){let u=l.length<6?1:2,r=1;return[wm(l.slice(r,r+=u)),wm(l.slice(r,r+=u)),wm(l.slice(r,r+=u)),wm(l.slice(r,r+u)||"ff")]}if(l.startsWith("rgb")){let u=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=l.match(u);if(r){let[x,C,A,R,U,F,le,se,fe,xe,Le,Fe]=r,$e=[R||" ",le||" ",xe].join("");if($e==="  "||$e==="  /"||$e===",,"||$e===",,,"){let nt=[A,F,fe].join(""),je=nt==="%%%"?100:nt===""?255:0;if(je){let ht=[Eu(+C/je,0,1),Eu(+U/je,0,1),Eu(+se/je,0,1),Le?xx(+Le,Fe):1];if(bx(ht))return ht}}return}}let i=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,p=l.match(i);if(p){let[u,r,x,C,A,R,U,F,le]=p,se=[x||" ",A||" ",U].join("");if(se==="  "||se==="  /"||se===",,"||se===",,,"){let fe=[+r,Eu(+C,0,100),Eu(+R,0,100),F?xx(+F,le):1];if(bx(fe))return RT(fe)}}}function wm(l){return parseInt(l.padEnd(2,l),16)/255}function xx(l,s){return Eu(s?l/100:l,0,1)}function Eu(l,s,i){return Math.min(Math.max(s,l),i)}function bx(l){return!l.some(Number.isNaN)}var FT={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ec(l,s,i){return l+i*(s-l)}function yp(l,s,i){return l.map((p,u)=>ec(p,s[u],i))}var wi=class l{constructor(s,i,p,u=1,r=!0){this.r=s,this.g=i,this.b=p,this.a=u,r||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[s,i,p,u]))}static parse(s){if(s instanceof l)return s;if(typeof s!="string")return;let i=OT(s);if(i)return new l(...i,!1)}get rgb(){let{r:s,g:i,b:p,a:u}=this,r=u||1/0;return this.overwriteGetter("rgb",[s/r,i/r,p/r,u])}get hcl(){return this.overwriteGetter("hcl",LT(this.rgb))}get lab(){return this.overwriteGetter("lab",_b(this.rgb))}overwriteGetter(s,i){return Object.defineProperty(this,s,{value:i}),i}toString(){let[s,i,p,u]=this.rgb;return`rgba(${[s,i,p].map(r=>Math.round(r*255)).join(",")},${u})`}static interpolate(s,i,p,u="rgb"){switch(u){case"rgb":{let[r,x,C,A]=yp(s.rgb,i.rgb,p);return new l(r,x,C,A,!1)}case"hcl":{let[r,x,C,A]=s.hcl,[R,U,F,le]=i.hcl,se,fe;if(!isNaN(r)&&!isNaN(R)){let nt=R-r;R>r&&nt>180?nt-=360:R<r&&r-R>180&&(nt+=360),se=r+p*nt}else isNaN(r)?isNaN(R)?se=NaN:(se=R,(C===1||C===0)&&(fe=U)):(se=r,(F===1||F===0)&&(fe=x));let[xe,Le,Fe,$e]=DT([se,fe??ec(x,U,p),ec(C,F,p),ec(A,le,p)]);return new l(xe,Le,Fe,$e,!1)}case"lab":{let[r,x,C,A]=yb(yp(s.lab,i.lab,p));return new l(r,x,C,A,!1)}}}};wi.black=new wi(0,0,0,1);wi.white=new wi(1,1,1,1);wi.transparent=new wi(0,0,0,0);wi.red=new wi(1,0,0,1);var vp=class{constructor(s,i,p){s?this.sensitivity=i?"variant":"case":this.sensitivity=i?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,i){return this.collator.compare(s,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}},BT=["bottom","center","top"],xp=class{constructor(s,i,p,u,r,x){this.text=s,this.image=i,this.scale=p,this.fontStack=u,this.textColor=r,this.verticalAlign=x}},ic=class l{constructor(s){this.sections=s}static fromString(s){return new l([new xp(s,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof l?s:l.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}},Xa=class l{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof l)return s;if(typeof s=="number")return new l([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(let i of s)if(typeof i!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]];break}return new l(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,i,p){return new l(yp(s.values,i.values,p))}},Ja=class l{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof l)return s;if(typeof s=="number")return new l([s]);if(Array.isArray(s)){for(let i of s)if(typeof i!="number")return;return new l(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,i,p){return new l(yp(s.values,i.values,p))}},Uo=class l{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof l)return s;if(typeof s=="string"){let p=wi.parse(s);return p?new l([p]):void 0}if(!Array.isArray(s))return;let i=[];for(let p of s){if(typeof p!="string")return;let u=wi.parse(p);if(!u)return;i.push(u)}return new l(i)}toString(){return JSON.stringify(this.values)}static interpolate(s,i,p,u="rgb"){let r=[];if(s.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${s.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let x=0;x<s.values.length;x++)r.push(wi.interpolate(s.values[x],i.values[x],p,u));return new l(r)}},Li=class extends Error{constructor(s){super(s),this.name="RuntimeError"}toJSON(){return this.message}},jT=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]),Ya=class l{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof l)return s;if(!(!Array.isArray(s)||s.length<1||s.length%2!==0)){for(let i=0;i<s.length;i+=2){let p=s[i],u=s[i+1];if(typeof p!="string"||!jT.has(p)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new l(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,i,p){let u=s.values,r=i.values;if(u.length!==r.length)throw new Li(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);let x=[];for(let C=0;C<u.length;C+=2){if(u[C]!==r[C])throw new Li(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${u[C]}, to[${C}]: ${r[C]}`);x.push(u[C]);let[A,R]=u[C+1],[U,F]=r[C+1];x.push([ec(A,U,p),ec(R,F,p)])}return new l(x)}},Qs=class l{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new l({name:s,available:!1}):null}},nc=class l{constructor(s,i,p){this.from=s,this.to=i,this.transition=p}static interpolate(s,i,p){return new l(s,i,p)}static parse(s){if(s instanceof l)return s;if(Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number")return new l(s[0],s[1],s[2]);if(typeof s=="object"&&typeof s.from=="string"&&typeof s.to=="string"&&typeof s.transition=="number")return new l(s.from,s.to,s.transition);if(typeof s=="string")return new l(s,s,1)}};function vb(l,s,i,p){return typeof l=="number"&&l>=0&&l<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255?typeof p>"u"||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[l,s,i,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[l,s,i,p]:[l,s,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bp(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof nc||l instanceof wi||l instanceof vp||l instanceof ic||l instanceof Xa||l instanceof Ja||l instanceof Uo||l instanceof Ya||l instanceof Qs)return!0;if(Array.isArray(l)){for(let s of l)if(!bp(s))return!1;return!0}else if(typeof l=="object"){for(let s in l)if(!bp(l[s]))return!1;return!0}else return!1}function _n(l){if(l===null)return sf;if(typeof l=="string")return Zt;if(typeof l=="boolean")return Gt;if(typeof l=="number")return et;if(l instanceof wi)return ga;if(l instanceof nc)return lf;if(l instanceof vp)return cf;if(l instanceof ic)return uf;if(l instanceof Xa)return hf;if(l instanceof Ja)return pf;if(l instanceof Uo)return gp;if(l instanceof Ya)return df;if(l instanceof Qs)return Ap;if(Array.isArray(l)){let s=l.length,i;for(let p of l){let u=_n(p);if(!i)i=u;else{if(i===u)continue;i=Nt;break}}return Qr(i||Nt,s)}else return Yl}function hp(l){let s=typeof l;return l===null?"":s==="string"||s==="number"||s==="boolean"?String(l):l instanceof wi||l instanceof nc||l instanceof ic||l instanceof Xa||l instanceof Ja||l instanceof Uo||l instanceof Ya||l instanceof Qs?l.toString():JSON.stringify(l)}var zu=class l{constructor(s,i){this.type=s,this.value=i}static parse(s,i){if(s.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!bp(s[1]))return i.error("invalid value");let p=s[1],u=_n(p),r=i.expectedType;return u.kind==="array"&&u.N===0&&r&&r.kind==="array"&&(typeof r.N!="number"||r.N===0)&&(u=r),new l(u,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}},Sm={string:Zt,number:et,boolean:Gt,object:Yl},jo=class l{constructor(s,i){this.type=s,this.args=i}static parse(s,i){if(s.length<2)return i.error("Expected at least one argument.");let p=1,u,r=s[0];if(r==="array"){let C;if(s.length>2){let R=s[1];if(typeof R!="string"||!(R in Sm)||R==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);C=Sm[R],p++}else C=Nt;let A;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return i.error('The length argument to "array" must be a positive integer literal',2);A=s[2],p++}u=Qr(C,A)}else{if(!Sm[r])throw new Error(`Types doesn't contain name = ${r}`);u=Sm[r]}let x=[];for(;p<s.length;p++){let C=i.parse(s[p],p,Nt);if(!C)return null;x.push(C)}return new l(u,x)}evaluate(s){for(let i=0;i<this.args.length;i++){let p=this.args[i].evaluate(s);if(_p(this.type,_n(p))){if(i===this.args.length-1)throw new Li(`Expected value to be of type ${ji(this.type)}, but found ${ji(_n(p))} instead.`)}else return p}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}},wx={"to-boolean":Gt,"to-color":ga,"to-number":et,"to-string":Zt},Ks=class l{constructor(s,i){this.type=s,this.args=i}static parse(s,i){if(s.length<2)return i.error("Expected at least one argument.");let p=s[0];if(!wx[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&s.length!==2)return i.error("Expected one argument.");let u=wx[p],r=[];for(let x=1;x<s.length;x++){let C=i.parse(s[x],x,Nt);if(!C)return null;r.push(C)}return new l(u,r)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let i,p;for(let u of this.args){if(i=u.evaluate(s),p=null,i instanceof wi)return i;if(typeof i=="string"){let r=s.parseColor(i);if(r)return r}else if(Array.isArray(i)&&(i.length<3||i.length>4?p=`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:p=vb(i[0],i[1],i[2],i[3]),!p))return new wi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Li(p||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(let p of this.args){i=p.evaluate(s);let u=Xa.parse(i);if(u)return u}throw new Li(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(let p of this.args){i=p.evaluate(s);let u=Ja.parse(i);if(u)return u}throw new Li(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(let p of this.args){i=p.evaluate(s);let u=Uo.parse(i);if(u)return u}throw new Li(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(let p of this.args){i=p.evaluate(s);let u=Ya.parse(i);if(u)return u}throw new Li(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(let p of this.args){if(i=p.evaluate(s),i===null)return 0;let u=Number(i);if(!isNaN(u))return u}throw new Li(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return ic.fromString(hp(this.args[0].evaluate(s)));case"resolvedImage":return Qs.fromString(hp(this.args[0].evaluate(s)));case"projectionDefinition":return this.args[0].evaluate(s);default:return hp(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}},UT=["Unknown","Point","LineString","Polygon"],Bm=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?UT[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let i=this._parseColorCache.get(s);return i||(i=wi.parse(s),this._parseColorCache.set(s,i)),i}},jm=class l{constructor(s,i,p=[],u,r=new Q0,x=[]){this.registry=s,this.path=p,this.key=p.map(C=>`[${C}]`).join(""),this.scope=r,this.errors=x,this.expectedType=u,this._isConstant=i}parse(s,i,p,u,r={}){return i?this.concat(i,p,u)._parse(s,r):this._parse(s,r)}_parse(s,i){(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number")&&(s=["literal",s]);function p(u,r,x){return x==="assert"?new jo(r,[u]):x==="coerce"?new Ks(r,[u]):u}if(Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let u=s[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let r=this.registry[u];if(r){let x=r.parse(s,this);if(!x)return null;if(this.expectedType){let C=this.expectedType,A=x.type;if((C.kind==="string"||C.kind==="number"||C.kind==="boolean"||C.kind==="object"||C.kind==="array")&&A.kind==="value")x=p(x,C,i.typeAnnotation||"assert");else if(C.kind==="projectionDefinition"&&["string","array"].includes(A.kind)||["color","formatted","resolvedImage"].includes(C.kind)&&["value","string"].includes(A.kind)||["padding","numberArray"].includes(C.kind)&&["value","number","array"].includes(A.kind)||C.kind==="colorArray"&&["value","string","array"].includes(A.kind)||C.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(A.kind))x=p(x,C,i.typeAnnotation||"coerce");else if(this.checkSubtype(C,A))return null}if(!(x instanceof zu)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){let C=new Bm;try{x=new zu(x.type,x.evaluate(C))}catch(A){return this.error(A.message),null}}return x}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof s>"u"?this.error("'undefined' value invalid. Use null instead."):typeof s=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof s} instead.`)}concat(s,i,p){let u=typeof s=="number"?this.path.concat(s):this.path,r=p?this.scope.concat(p):this.scope;return new l(this.registry,this._isConstant,u,i||null,r,this.errors)}error(s,...i){let p=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new xo(p,s))}checkSubtype(s,i){let p=_p(s,i);return p&&this.error(p),p}},Um=class l{constructor(s,i){this.type=i.type,this.bindings=[].concat(s),this.result=i}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(let i of this.bindings)s(i[1]);s(this.result)}static parse(s,i){if(s.length<4)return i.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);let p=[];for(let r=1;r<s.length-1;r+=2){let x=s[r];if(typeof x!="string")return i.error(`Expected string, but found ${typeof x} instead.`,r);if(/[^a-zA-Z0-9_]/.test(x))return i.error("Variable names must contain only alphanumeric characters or '_'.",r);let C=i.parse(s[r+1],r+1);if(!C)return null;p.push([x,C])}let u=i.parse(s[s.length-1],s.length-1,i.expectedType,p);return u?new l(p,u):null}outputDefined(){return this.result.outputDefined()}},Nm=class l{constructor(s,i){this.type=i.type,this.name=s,this.boundExpression=i}static parse(s,i){if(s.length!==2||typeof s[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let p=s[1];return i.scope.has(p)?new l(p,i.scope.get(p)):i.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}},e_=class l{constructor(s,i,p){this.type=s,this.index=i,this.input=p}static parse(s,i){if(s.length!==3)return i.error(`Expected 2 arguments, but found ${s.length-1} instead.`);let p=i.parse(s[1],1,et),u=i.parse(s[2],2,Qr(i.expectedType||Nt));if(!p||!u)return null;let r=u.type;return new l(r.itemType,p,u)}evaluate(s){let i=this.index.evaluate(s),p=this.input.evaluate(s);if(i<0)throw new Li(`Array index out of bounds: ${i} < 0.`);if(i>=p.length)throw new Li(`Array index out of bounds: ${i} > ${p.length-1}.`);if(i!==Math.floor(i))throw new Li(`Array index must be an integer, but found ${i} instead.`);return p[i]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}},t_=class l{constructor(s,i){this.type=Gt,this.needle=s,this.haystack=i}static parse(s,i){if(s.length!==3)return i.error(`Expected 2 arguments, but found ${s.length-1} instead.`);let p=i.parse(s[1],1,Nt),u=i.parse(s[2],2,Nt);return!p||!u?null:M_(p.type,[Gt,Zt,et,sf,Nt])?new l(p,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ji(p.type)} instead`)}evaluate(s){let i=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!p)return!1;if(!Ql(i,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${ji(_n(i))} instead.`);if(!Ql(p,["string","array"]))throw new Li(`Expected second argument to be of type array or string, but found ${ji(_n(p))} instead.`);return p.indexOf(i)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}},i_=class l{constructor(s,i,p){this.type=et,this.needle=s,this.haystack=i,this.fromIndex=p}static parse(s,i){if(s.length<=2||s.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);let p=i.parse(s[1],1,Nt),u=i.parse(s[2],2,Nt);if(!p||!u)return null;if(!M_(p.type,[Gt,Zt,et,sf,Nt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ji(p.type)} instead`);if(s.length===4){let r=i.parse(s[3],3,et);return r?new l(p,u,r):null}else return new l(p,u)}evaluate(s){let i=this.needle.evaluate(s),p=this.haystack.evaluate(s);if(!Ql(i,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${ji(_n(i))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(s)),Ql(p,["string"])){let r=p.indexOf(i,u);return r===-1?-1:[...p.slice(0,r)].length}else{if(Ql(p,["array"]))return p.indexOf(i,u);throw new Li(`Expected second argument to be of type array or string, but found ${ji(_n(p))} instead.`)}}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}},n_=class l{constructor(s,i,p,u,r,x){this.inputType=s,this.type=i,this.input=p,this.cases=u,this.outputs=r,this.otherwise=x}static parse(s,i){if(s.length<5)return i.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!==1)return i.error("Expected an even number of arguments.");let p,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);let r={},x=[];for(let R=2;R<s.length-1;R+=2){let U=s[R],F=s[R+1];Array.isArray(U)||(U=[U]);let le=i.concat(R);if(U.length===0)return le.error("Expected at least one branch label.");for(let fe of U){if(typeof fe!="number"&&typeof fe!="string")return le.error("Branch labels must be numbers or strings.");if(typeof fe=="number"&&Math.abs(fe)>Number.MAX_SAFE_INTEGER)return le.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof fe=="number"&&Math.floor(fe)!==fe)return le.error("Numeric branch labels must be integer values.");if(!p)p=_n(fe);else if(le.checkSubtype(p,_n(fe)))return null;if(typeof r[String(fe)]<"u")return le.error("Branch labels must be unique.");r[String(fe)]=x.length}let se=i.parse(F,R,u);if(!se)return null;u=u||se.type,x.push(se)}let C=i.parse(s[1],1,Nt);if(!C)return null;let A=i.parse(s[s.length-1],s.length-1,u);return!A||C.type.kind!=="value"&&i.concat(1).checkSubtype(p,C.type)?null:new l(p,u,C,r,x,A)}evaluate(s){let i=this.input.evaluate(s);return(_n(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}},r_=class l{constructor(s,i,p){this.type=s,this.branches=i,this.otherwise=p}static parse(s,i){if(s.length<4)return i.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!==0)return i.error("Expected an odd number of arguments.");let p;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);let u=[];for(let x=1;x<s.length-1;x+=2){let C=i.parse(s[x],x,Gt);if(!C)return null;let A=i.parse(s[x+1],x+1,p);if(!A)return null;u.push([C,A]),p=p||A.type}let r=i.parse(s[s.length-1],s.length-1,p);if(!r)return null;if(!p)throw new Error("Can't infer output type");return new l(p,u,r)}evaluate(s){for(let[i,p]of this.branches)if(i.evaluate(s))return p.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(let[i,p]of this.branches)s(i),s(p);s(this.otherwise)}outputDefined(){return this.branches.every(([s,i])=>i.outputDefined())&&this.otherwise.outputDefined()}},o_=class l{constructor(s,i,p,u){this.type=s,this.input=i,this.beginIndex=p,this.endIndex=u}static parse(s,i){if(s.length<=2||s.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);let p=i.parse(s[1],1,Nt),u=i.parse(s[2],2,et);if(!p||!u)return null;if(!M_(p.type,[Qr(Nt),Zt,Nt]))return i.error(`Expected first argument to be of type array or string, but found ${ji(p.type)} instead`);if(s.length===4){let r=i.parse(s[3],3,et);return r?new l(p.type,p,u,r):null}else return new l(p.type,p,u)}evaluate(s){let i=this.input.evaluate(s),p=this.beginIndex.evaluate(s),u;if(this.endIndex&&(u=this.endIndex.evaluate(s)),Ql(i,["string"]))return[...i].slice(p,u).join("");if(Ql(i,["array"]))return i.slice(p,u);throw new Li(`Expected first argument to be of type array or string, but found ${ji(_n(i))} instead.`)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}};function xb(l,s){let i=l.length-1,p=0,u=i,r=0,x,C;for(;p<=u;)if(r=Math.floor((p+u)/2),x=l[r],C=l[r+1],x<=s){if(r===i||s<C)return r;p=r+1}else if(x>s)u=r-1;else throw new Li("Input is not a number.");return 0}var Vm=class l{constructor(s,i,p){this.type=s,this.input=i,this.labels=[],this.outputs=[];for(let[u,r]of p)this.labels.push(u),this.outputs.push(r)}static parse(s,i){if(s.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!==0)return i.error("Expected an even number of arguments.");let p=i.parse(s[1],1,et);if(!p)return null;let u=[],r=null;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);for(let x=1;x<s.length;x+=2){let C=x===1?-1/0:s[x],A=s[x+1],R=x,U=x+1;if(typeof C!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(u.length&&u[u.length-1][0]>=C)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);let F=i.parse(A,U,r);if(!F)return null;r=r||F.type,u.push([C,F])}return new l(r,p,u)}evaluate(s){let i=this.labels,p=this.outputs;if(i.length===1)return p[0].evaluate(s);let u=this.input.evaluate(s);if(u<=i[0])return p[0].evaluate(s);let r=i.length;if(u>=i[r-1])return p[r-1].evaluate(s);let x=xb(i,u);return p[x].evaluate(s)}eachChild(s){s(this.input);for(let i of this.outputs)s(i)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}};function NT(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var S0,Sx;function VT(){if(Sx)return S0;Sx=1,S0=l;function l(s,i,p,u){this.cx=3*s,this.bx=3*(p-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=p,this.p2y=u}return l.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var p=s,u=0;u<8;u++){var r=this.sampleCurveX(p)-s;if(Math.abs(r)<i)return p;var x=this.sampleCurveDerivativeX(p);if(Math.abs(x)<1e-6)break;p=p-r/x}var C=0,A=1;for(p=s,u=0;u<20&&(r=this.sampleCurveX(p),!(Math.abs(r-s)<i));u++)s>r?C=p:A=p,p=(A-C)*.5+C;return p},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}},S0}var $T=VT(),GT=NT($T),Ka=class l{constructor(s,i,p,u,r){this.type=s,this.operator=i,this.interpolation=p,this.input=u,this.labels=[],this.outputs=[];for(let[x,C]of r)this.labels.push(x),this.outputs.push(C)}static interpolationFactor(s,i,p,u){let r=0;if(s.name==="exponential")r=I0(i,s.base,p,u);else if(s.name==="linear")r=I0(i,1,p,u);else if(s.name==="cubic-bezier"){let x=s.controlPoints;r=new GT(x[0],x[1],x[2],x[3]).solve(I0(i,1,p,u))}return r}static parse(s,i){let[p,u,r,...x]=s;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){let R=u[1];if(typeof R!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:R}}else if(u[0]==="cubic-bezier"){let R=u.slice(1);if(R.length!==4||R.some(U=>typeof U!="number"||U<0||U>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:R}}else return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);if(s.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!==0)return i.error("Expected an even number of arguments.");if(r=i.parse(r,2,et),!r)return null;let C=[],A=null;(p==="interpolate-hcl"||p==="interpolate-lab")&&i.expectedType!=gp?A=ga:i.expectedType&&i.expectedType.kind!=="value"&&(A=i.expectedType);for(let R=0;R<x.length;R+=2){let U=x[R],F=x[R+1],le=R+3,se=R+4;if(typeof U!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',le);if(C.length&&C[C.length-1][0]>=U)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',le);let fe=i.parse(F,se,A);if(!fe)return null;A=A||fe.type,C.push([U,fe])}return!Zs(A,et)&&!Zs(A,lf)&&!Zs(A,ga)&&!Zs(A,hf)&&!Zs(A,pf)&&!Zs(A,gp)&&!Zs(A,df)&&!Zs(A,Qr(et))?i.error(`Type ${ji(A)} is not interpolatable.`):new l(A,p,u,r,C)}evaluate(s){let i=this.labels,p=this.outputs;if(i.length===1)return p[0].evaluate(s);let u=this.input.evaluate(s);if(u<=i[0])return p[0].evaluate(s);let r=i.length;if(u>=i[r-1])return p[r-1].evaluate(s);let x=xb(i,u),C=i[x],A=i[x+1],R=l.interpolationFactor(this.interpolation,u,C,A),U=p[x].evaluate(s),F=p[x+1].evaluate(s);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ec(U,F,R);case"color":return wi.interpolate(U,F,R);case"padding":return Xa.interpolate(U,F,R);case"colorArray":return Uo.interpolate(U,F,R);case"numberArray":return Ja.interpolate(U,F,R);case"variableAnchorOffsetCollection":return Ya.interpolate(U,F,R);case"array":return yp(U,F,R);case"projectionDefinition":return nc.interpolate(U,F,R)}case"interpolate-hcl":switch(this.type.kind){case"color":return wi.interpolate(U,F,R,"hcl");case"colorArray":return Uo.interpolate(U,F,R,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return wi.interpolate(U,F,R,"lab");case"colorArray":return Uo.interpolate(U,F,R,"lab")}}}eachChild(s){s(this.input);for(let i of this.outputs)s(i)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}};function I0(l,s,i,p){let u=p-i,r=l-i;return u===0?0:s===1?r/u:(Math.pow(s,r)-1)/(Math.pow(s,u)-1)}wi.interpolate,Xa.interpolate,Ja.interpolate,Uo.interpolate,Ya.interpolate;var $m=class l{constructor(s,i){this.type=s,this.args=i}static parse(s,i){if(s.length<2)return i.error("Expected at least one argument.");let p=null,u=i.expectedType;u&&u.kind!=="value"&&(p=u);let r=[];for(let x of s.slice(1)){let C=i.parse(x,1+r.length,p,void 0,{typeAnnotation:"omit"});if(!C)return null;p=p||C.type,r.push(C)}if(!p)throw new Error("No output type");return u&&r.some(x=>_p(u,x.type))?new l(Nt,r):new l(p,r)}evaluate(s){let i=null,p=0,u;for(let r of this.args)if(p++,i=r.evaluate(s),i&&i instanceof Qs&&!i.available&&(u||(u=i.name),i=null,p===this.args.length&&(i=u)),i!==null)break;return i}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}};function Ix(l,s){return l==="=="||l==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function qT(l,s,i){return s===i}function WT(l,s,i){return s!==i}function ZT(l,s,i){return s<i}function HT(l,s,i){return s>i}function KT(l,s,i){return s<=i}function XT(l,s,i){return s>=i}function bb(l,s,i,p){return p.compare(s,i)===0}function JT(l,s,i,p){return!bb(l,s,i,p)}function YT(l,s,i,p){return p.compare(s,i)<0}function QT(l,s,i,p){return p.compare(s,i)>0}function eC(l,s,i,p){return p.compare(s,i)<=0}function tC(l,s,i,p){return p.compare(s,i)>=0}function Fu(l,s,i){let p=l!=="=="&&l!=="!=";return class wb{constructor(r,x,C){this.type=Gt,this.lhs=r,this.rhs=x,this.collator=C,this.hasUntypedArgument=r.type.kind==="value"||x.type.kind==="value"}static parse(r,x){if(r.length!==3&&r.length!==4)return x.error("Expected two or three arguments.");let C=r[0],A=x.parse(r[1],1,Nt);if(!A)return null;if(!Ix(C,A.type))return x.concat(1).error(`"${C}" comparisons are not supported for type '${ji(A.type)}'.`);let R=x.parse(r[2],2,Nt);if(!R)return null;if(!Ix(C,R.type))return x.concat(2).error(`"${C}" comparisons are not supported for type '${ji(R.type)}'.`);if(A.type.kind!==R.type.kind&&A.type.kind!=="value"&&R.type.kind!=="value")return x.error(`Cannot compare types '${ji(A.type)}' and '${ji(R.type)}'.`);p&&(A.type.kind==="value"&&R.type.kind!=="value"?A=new jo(R.type,[A]):A.type.kind!=="value"&&R.type.kind==="value"&&(R=new jo(A.type,[R])));let U=null;if(r.length===4){if(A.type.kind!=="string"&&R.type.kind!=="string"&&A.type.kind!=="value"&&R.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(U=x.parse(r[3],3,cf),!U)return null}return new wb(A,R,U)}evaluate(r){let x=this.lhs.evaluate(r),C=this.rhs.evaluate(r);if(p&&this.hasUntypedArgument){let A=_n(x),R=_n(C);if(A.kind!==R.kind||!(A.kind==="string"||A.kind==="number"))throw new Li(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${A.kind}, ${R.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){let A=_n(x),R=_n(C);if(A.kind!=="string"||R.kind!=="string")return s(r,x,C)}return this.collator?i(r,x,C,this.collator.evaluate(r)):s(r,x,C)}eachChild(r){r(this.lhs),r(this.rhs),this.collator&&r(this.collator)}outputDefined(){return!0}}}var iC=Fu("==",qT,bb),nC=Fu("!=",WT,JT),rC=Fu("<",ZT,YT),oC=Fu(">",HT,QT),aC=Fu("<=",KT,eC),sC=Fu(">=",XT,tC),Gm=class l{constructor(s,i,p){this.type=cf,this.locale=p,this.caseSensitive=s,this.diacriticSensitive=i}static parse(s,i){if(s.length!==2)return i.error("Expected one argument.");let p=s[1];if(typeof p!="object"||Array.isArray(p))return i.error("Collator options argument must be an object.");let u=i.parse(p["case-sensitive"]===void 0?!1:p["case-sensitive"],1,Gt);if(!u)return null;let r=i.parse(p["diacritic-sensitive"]===void 0?!1:p["diacritic-sensitive"],1,Gt);if(!r)return null;let x=null;return p.locale&&(x=i.parse(p.locale,1,Zt),!x)?null:new l(u,r,x)}evaluate(s){return new vp(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}},a_=class l{constructor(s,i,p,u,r){this.type=Zt,this.number=s,this.locale=i,this.currency=p,this.minFractionDigits=u,this.maxFractionDigits=r}static parse(s,i){if(s.length!==3)return i.error("Expected two arguments.");let p=i.parse(s[1],1,et);if(!p)return null;let u=s[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let r=null;if(u.locale&&(r=i.parse(u.locale,1,Zt),!r))return null;let x=null;if(u.currency&&(x=i.parse(u.currency,1,Zt),!x))return null;let C=null;if(u["min-fraction-digits"]&&(C=i.parse(u["min-fraction-digits"],1,et),!C))return null;let A=null;return u["max-fraction-digits"]&&(A=i.parse(u["max-fraction-digits"],1,et),!A)?null:new l(p,r,x,C,A)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}},s_=class l{constructor(s){this.type=uf,this.sections=s}static parse(s,i){if(s.length<2)return i.error("Expected at least one argument.");let p=s[1];if(!Array.isArray(p)&&typeof p=="object")return i.error("First argument must be an image or text section.");let u=[],r=!1;for(let x=1;x<=s.length-1;++x){let C=s[x];if(r&&typeof C=="object"&&!Array.isArray(C)){r=!1;let A=null;if(C["font-scale"]&&(A=i.parse(C["font-scale"],1,et),!A))return null;let R=null;if(C["text-font"]&&(R=i.parse(C["text-font"],1,Qr(Zt)),!R))return null;let U=null;if(C["text-color"]&&(U=i.parse(C["text-color"],1,ga),!U))return null;let F=null;if(C["vertical-align"]){if(typeof C["vertical-align"]=="string"&&!BT.includes(C["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${C["vertical-align"]}' instead.`);if(F=i.parse(C["vertical-align"],1,Zt),!F)return null}let le=u[u.length-1];le.scale=A,le.font=R,le.textColor=U,le.verticalAlign=F}else{let A=i.parse(s[x],1,Nt);if(!A)return null;let R=A.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,u.push({content:A,scale:null,font:null,textColor:null,verticalAlign:null})}}return new l(u)}evaluate(s){let i=p=>{let u=p.content.evaluate(s);return _n(u)===Ap?new xp("",u,null,null,null,p.verticalAlign?p.verticalAlign.evaluate(s):null):new xp(hp(u),null,p.scale?p.scale.evaluate(s):null,p.font?p.font.evaluate(s).join(","):null,p.textColor?p.textColor.evaluate(s):null,p.verticalAlign?p.verticalAlign.evaluate(s):null)};return new ic(this.sections.map(i))}eachChild(s){for(let i of this.sections)s(i.content),i.scale&&s(i.scale),i.font&&s(i.font),i.textColor&&s(i.textColor),i.verticalAlign&&s(i.verticalAlign)}outputDefined(){return!1}},l_=class l{constructor(s){this.type=Ap,this.input=s}static parse(s,i){if(s.length!==2)return i.error("Expected two arguments.");let p=i.parse(s[1],1,Zt);return p?new l(p):i.error("No image name provided.")}evaluate(s){let i=this.input.evaluate(s),p=Qs.fromString(i);return p&&s.availableImages&&(p.available=s.availableImages.indexOf(i)>-1),p}eachChild(s){s(this.input)}outputDefined(){return!1}},c_=class l{constructor(s){this.type=et,this.input=s}static parse(s,i){if(s.length!==2)return i.error(`Expected 1 argument, but found ${s.length-1} instead.`);let p=i.parse(s[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ji(p.type)} instead.`):new l(p):null}evaluate(s){let i=this.input.evaluate(s);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Li(`Expected value to be of type string or array, but found ${ji(_n(i))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}},_a=8192;function lC(l,s){let i=cC(l[0]),p=hC(l[1]),u=Math.pow(2,s.z);return[Math.round(i*u*_a),Math.round(p*u*_a)]}function E_(l,s){let i=Math.pow(2,s.z),p=(l[0]/_a+s.x)/i,u=(l[1]/_a+s.y)/i;return[uC(p),pC(u)]}function cC(l){return(180+l)/360}function uC(l){return l*360-180}function hC(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function pC(l){return 360/Math.PI*Math.atan(Math.exp((180-l*360)*Math.PI/180))-90}function kp(l,s){l[0]=Math.min(l[0],s[0]),l[1]=Math.min(l[1],s[1]),l[2]=Math.max(l[2],s[0]),l[3]=Math.max(l[3],s[1])}function wp(l,s){return!(l[0]<=s[0]||l[2]>=s[2]||l[1]<=s[1]||l[3]>=s[3])}function dC(l,s,i){return s[1]>l[1]!=i[1]>l[1]&&l[0]<(i[0]-s[0])*(l[1]-s[1])/(i[1]-s[1])+s[0]}function mC(l,s,i){let p=l[0]-s[0],u=l[1]-s[1],r=l[0]-i[0],x=l[1]-i[1];return p*x-r*u===0&&p*r<=0&&u*x<=0}function mf(l,s,i,p){let u=[s[0]-l[0],s[1]-l[1]],r=[p[0]-i[0],p[1]-i[1]];return yC(r,u)===0?!1:!!(Tx(l,s,i,p)&&Tx(i,p,l,s))}function fC(l,s,i){for(let p of i)for(let u=0;u<p.length-1;++u)if(mf(l,s,p[u],p[u+1]))return!0;return!1}function Bu(l,s,i=!1){let p=!1;for(let u of s)for(let r=0;r<u.length-1;r++){if(mC(l,u[r],u[r+1]))return i;dC(l,u[r],u[r+1])&&(p=!p)}return p}function gC(l,s){for(let i of s)if(Bu(l,i))return!0;return!1}function Sb(l,s){for(let i of l)if(!Bu(i,s))return!1;for(let i=0;i<l.length-1;++i)if(fC(l[i],l[i+1],s))return!1;return!0}function _C(l,s){for(let i of s)if(Sb(l,i))return!0;return!1}function yC(l,s){return l[0]*s[1]-l[1]*s[0]}function Tx(l,s,i,p){let u=l[0]-i[0],r=l[1]-i[1],x=s[0]-i[0],C=s[1]-i[1],A=p[0]-i[0],R=p[1]-i[1],U=u*R-A*r,F=x*R-A*C;return U>0&&F<0||U<0&&F>0}function A_(l,s,i){let p=[];for(let u=0;u<l.length;u++){let r=[];for(let x=0;x<l[u].length;x++){let C=lC(l[u][x],i);kp(s,C),r.push(C)}p.push(r)}return p}function Ib(l,s,i){let p=[];for(let u=0;u<l.length;u++){let r=A_(l[u],s,i);p.push(r)}return p}function Tb(l,s,i,p){if(l[0]<i[0]||l[0]>i[2]){let u=p*.5,r=l[0]-i[0]>u?-p:i[0]-l[0]>u?p:0;r===0&&(r=l[0]-i[2]>u?-p:i[2]-l[0]>u?p:0),l[0]+=r}kp(s,l)}function vC(l){l[0]=l[1]=1/0,l[2]=l[3]=-1/0}function Cx(l,s,i,p){let u=Math.pow(2,p.z)*_a,r=[p.x*_a,p.y*_a],x=[];for(let C of l)for(let A of C){let R=[A.x+r[0],A.y+r[1]];Tb(R,s,i,u),x.push(R)}return x}function Px(l,s,i,p){let u=Math.pow(2,p.z)*_a,r=[p.x*_a,p.y*_a],x=[];for(let C of l){let A=[];for(let R of C){let U=[R.x+r[0],R.y+r[1]];kp(s,U),A.push(U)}x.push(A)}if(s[2]-s[0]<=u/2){vC(s);for(let C of x)for(let A of C)Tb(A,s,i,u)}return x}function xC(l,s){let i=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],u=l.canonicalID();if(s.type==="Polygon"){let r=A_(s.coordinates,p,u),x=Cx(l.geometry(),i,p,u);if(!wp(i,p))return!1;for(let C of x)if(!Bu(C,r))return!1}if(s.type==="MultiPolygon"){let r=Ib(s.coordinates,p,u),x=Cx(l.geometry(),i,p,u);if(!wp(i,p))return!1;for(let C of x)if(!gC(C,r))return!1}return!0}function bC(l,s){let i=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],u=l.canonicalID();if(s.type==="Polygon"){let r=A_(s.coordinates,p,u),x=Px(l.geometry(),i,p,u);if(!wp(i,p))return!1;for(let C of x)if(!Sb(C,r))return!1}if(s.type==="MultiPolygon"){let r=Ib(s.coordinates,p,u),x=Px(l.geometry(),i,p,u);if(!wp(i,p))return!1;for(let C of x)if(!_C(C,r))return!1}return!0}var Sp=class l{constructor(s,i){this.type=Gt,this.geojson=s,this.geometries=i}static parse(s,i){if(s.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(bp(s[1])){let p=s[1];if(p.type==="FeatureCollection"){let u=[];for(let r of p.features){let{type:x,coordinates:C}=r.geometry;x==="Polygon"&&u.push(C),x==="MultiPolygon"&&u.push(...C)}if(u.length){let r={type:"MultiPolygon",coordinates:u};return new l(p,r)}}else if(p.type==="Feature"){let u=p.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new l(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new l(p,p)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return xC(s,this.geometries);if(s.geometryType()==="LineString")return bC(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}},qm=class{constructor(s=[],i=(p,u)=>p<u?-1:p>u?1:0){if(this.data=s,this.length=this.data.length,this.compare=i,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;let s=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),s}peek(){return this.data[0]}_up(s){let{data:i,compare:p}=this,u=i[s];for(;s>0;){let r=s-1>>1,x=i[r];if(p(u,x)>=0)break;i[s]=x,s=r}i[s]=u}_down(s){let{data:i,compare:p}=this,u=this.length>>1,r=i[s];for(;s<u;){let x=(s<<1)+1,C=x+1;if(C<this.length&&p(i[C],i[x])<0&&(x=C),p(i[x],r)>=0)break;i[s]=i[x],s=x}i[s]=r}};function wC(l,s){if(l.length<=1)return[l];let i=[],p,u;for(let r of l){let x=SC(r);x!==0&&(r.area=Math.abs(x),u===void 0&&(u=x<0),u===x<0?(p&&i.push(p),p=[r]):p.push(r))}return p&&i.push(p),i}function SC(l){let s=0;for(let i=0,p=l.length,u=p-1,r,x;i<p;u=i++)r=l[i],x=l[u],s+=(x.x-r.x)*(r.y+x.y);return s}var IC=6378.137,Mx=1/298.257223563,Ex=Mx*(2-Mx),Ax=Math.PI/180,Ip=class{constructor(s){let i=Ax*IC*1e3,p=Math.cos(s*Ax),u=1/(1-Ex*(1-p*p)),r=Math.sqrt(u);this.kx=i*r*p,this.ky=i*r*u*(1-Ex)}distance(s,i){let p=this.wrap(s[0]-i[0])*this.kx,u=(s[1]-i[1])*this.ky;return Math.sqrt(p*p+u*u)}pointOnLine(s,i){let p=1/0,u,r,x,C;for(let A=0;A<s.length-1;A++){let R=s[A][0],U=s[A][1],F=this.wrap(s[A+1][0]-R)*this.kx,le=(s[A+1][1]-U)*this.ky,se=0;(F!==0||le!==0)&&(se=(this.wrap(i[0]-R)*this.kx*F+(i[1]-U)*this.ky*le)/(F*F+le*le),se>1?(R=s[A+1][0],U=s[A+1][1]):se>0&&(R+=F/this.kx*se,U+=le/this.ky*se)),F=this.wrap(i[0]-R)*this.kx,le=(i[1]-U)*this.ky;let fe=F*F+le*le;fe<p&&(p=fe,u=R,r=U,x=A,C=se)}return{point:[u,r],index:x,t:Math.max(0,Math.min(1,C))}}wrap(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}},u_=100,h_=50;function Cb(l,s){return s[0]-l[0]}function Wm(l){return l[1]-l[0]+1}function Qa(l,s){return l[1]>=l[0]&&l[1]<s}function p_(l,s){if(l[0]>l[1])return[null,null];let i=Wm(l);if(s){if(i===2)return[l,null];let u=Math.floor(i/2);return[[l[0],l[0]+u],[l[0]+u,l[1]]]}if(i===1)return[l,null];let p=Math.floor(i/2)-1;return[[l[0],l[0]+p],[l[0]+p+1,l[1]]]}function d_(l,s){if(!Qa(s,l.length))return[1/0,1/0,-1/0,-1/0];let i=[1/0,1/0,-1/0,-1/0];for(let p=s[0];p<=s[1];++p)kp(i,l[p]);return i}function m_(l){let s=[1/0,1/0,-1/0,-1/0];for(let i of l)for(let p of i)kp(s,p);return s}function kx(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function k_(l,s,i){if(!kx(l)||!kx(s))return NaN;let p=0,u=0;return l[2]<s[0]&&(p=s[0]-l[2]),l[0]>s[2]&&(p=l[0]-s[2]),l[1]>s[3]&&(u=l[1]-s[3]),l[3]<s[1]&&(u=s[1]-l[3]),i.distance([0,0],[p,u])}function Jl(l,s,i){let p=i.pointOnLine(s,l);return i.distance(l,p.point)}function L_(l,s,i,p,u){let r=Math.min(Jl(l,[i,p],u),Jl(s,[i,p],u)),x=Math.min(Jl(i,[l,s],u),Jl(p,[l,s],u));return Math.min(r,x)}function TC(l,s,i,p,u){if(!(Qa(s,l.length)&&Qa(p,i.length)))return 1/0;let r=1/0;for(let x=s[0];x<s[1];++x){let C=l[x],A=l[x+1];for(let R=p[0];R<p[1];++R){let U=i[R],F=i[R+1];if(mf(C,A,U,F))return 0;r=Math.min(r,L_(C,A,U,F,u))}}return r}function CC(l,s,i,p,u){if(!(Qa(s,l.length)&&Qa(p,i.length)))return NaN;let r=1/0;for(let x=s[0];x<=s[1];++x)for(let C=p[0];C<=p[1];++C)if(r=Math.min(r,u.distance(l[x],i[C])),r===0)return r;return r}function PC(l,s,i){if(Bu(l,s,!0))return 0;let p=1/0;for(let u of s){let r=u[0],x=u[u.length-1];if(r!==x&&(p=Math.min(p,Jl(l,[x,r],i)),p===0))return p;let C=i.pointOnLine(u,l);if(p=Math.min(p,i.distance(l,C.point)),p===0)return p}return p}function MC(l,s,i,p){if(!Qa(s,l.length))return NaN;for(let r=s[0];r<=s[1];++r)if(Bu(l[r],i,!0))return 0;let u=1/0;for(let r=s[0];r<s[1];++r){let x=l[r],C=l[r+1];for(let A of i)for(let R=0,U=A.length,F=U-1;R<U;F=R++){let le=A[F],se=A[R];if(mf(x,C,le,se))return 0;u=Math.min(u,L_(x,C,le,se,p))}}return u}function Lx(l,s){for(let i of l)for(let p of i)if(Bu(p,s,!0))return!0;return!1}function EC(l,s,i,p=1/0){let u=m_(l),r=m_(s);if(p!==1/0&&k_(u,r,i)>=p)return p;if(wp(u,r)){if(Lx(l,s))return 0}else if(Lx(s,l))return 0;let x=1/0;for(let C of l)for(let A=0,R=C.length,U=R-1;A<R;U=A++){let F=C[U],le=C[A];for(let se of s)for(let fe=0,xe=se.length,Le=xe-1;fe<xe;Le=fe++){let Fe=se[Le],$e=se[fe];if(mf(F,le,Fe,$e))return 0;x=Math.min(x,L_(F,le,Fe,$e,i))}}return x}function Dx(l,s,i,p,u,r){if(!r)return;let x=k_(d_(p,r),u,i);x<s&&l.push([x,r,[0,0]])}function Im(l,s,i,p,u,r,x){if(!r||!x)return;let C=k_(d_(p,r),d_(u,x),i);C<s&&l.push([C,r,x])}function Zm(l,s,i,p,u=1/0){let r=Math.min(p.distance(l[0],i[0][0]),u);if(r===0)return r;let x=new qm([[0,[0,l.length-1],[0,0]]],Cb),C=m_(i);for(;x.length>0;){let A=x.pop();if(A[0]>=r)continue;let R=A[1],U=s?h_:u_;if(Wm(R)<=U){if(!Qa(R,l.length))return NaN;if(s){let F=MC(l,R,i,p);if(isNaN(F)||F===0)return F;r=Math.min(r,F)}else for(let F=R[0];F<=R[1];++F){let le=PC(l[F],i,p);if(r=Math.min(r,le),r===0)return 0}}else{let F=p_(R,s);Dx(x,r,p,l,C,F[0]),Dx(x,r,p,l,C,F[1])}}return r}function Hm(l,s,i,p,u,r=1/0){let x=Math.min(r,u.distance(l[0],i[0]));if(x===0)return x;let C=new qm([[0,[0,l.length-1],[0,i.length-1]]],Cb);for(;C.length>0;){let A=C.pop();if(A[0]>=x)continue;let R=A[1],U=A[2],F=s?h_:u_,le=p?h_:u_;if(Wm(R)<=F&&Wm(U)<=le){if(!Qa(R,l.length)&&Qa(U,i.length))return NaN;let se;if(s&&p)se=TC(l,R,i,U,u),x=Math.min(x,se);else if(s&&!p){let fe=l.slice(R[0],R[1]+1);for(let xe=U[0];xe<=U[1];++xe)if(se=Jl(i[xe],fe,u),x=Math.min(x,se),x===0)return x}else if(!s&&p){let fe=i.slice(U[0],U[1]+1);for(let xe=R[0];xe<=R[1];++xe)if(se=Jl(l[xe],fe,u),x=Math.min(x,se),x===0)return x}else se=CC(l,R,i,U,u),x=Math.min(x,se)}else{let se=p_(R,s),fe=p_(U,p);Im(C,x,u,l,i,se[0],fe[0]),Im(C,x,u,l,i,se[0],fe[1]),Im(C,x,u,l,i,se[1],fe[0]),Im(C,x,u,l,i,se[1],fe[1])}}return x}function AC(l,s){let i=l.geometry(),p=i.flat().map(x=>E_([x.x,x.y],l.canonical));if(i.length===0)return NaN;let u=new Ip(p[0][1]),r=1/0;for(let x of s){switch(x.type){case"Point":r=Math.min(r,Hm(p,!1,[x.coordinates],!1,u,r));break;case"LineString":r=Math.min(r,Hm(p,!1,x.coordinates,!0,u,r));break;case"Polygon":r=Math.min(r,Zm(p,!1,x.coordinates,u,r));break}if(r===0)return r}return r}function kC(l,s){let i=l.geometry(),p=i.flat().map(x=>E_([x.x,x.y],l.canonical));if(i.length===0)return NaN;let u=new Ip(p[0][1]),r=1/0;for(let x of s){switch(x.type){case"Point":r=Math.min(r,Hm(p,!0,[x.coordinates],!1,u,r));break;case"LineString":r=Math.min(r,Hm(p,!0,x.coordinates,!0,u,r));break;case"Polygon":r=Math.min(r,Zm(p,!0,x.coordinates,u,r));break}if(r===0)return r}return r}function LC(l,s){let i=l.geometry();if(i.length===0||i[0].length===0)return NaN;let p=wC(i).map(x=>x.map(C=>C.map(A=>E_([A.x,A.y],l.canonical)))),u=new Ip(p[0][0][0][1]),r=1/0;for(let x of s)for(let C of p){switch(x.type){case"Point":r=Math.min(r,Zm([x.coordinates],!1,C,u,r));break;case"LineString":r=Math.min(r,Zm(x.coordinates,!0,C,u,r));break;case"Polygon":r=Math.min(r,EC(C,x.coordinates,u,r));break}if(r===0)return r}return r}function T0(l){return l.type==="MultiPolygon"?l.coordinates.map(s=>({type:"Polygon",coordinates:s})):l.type==="MultiLineString"?l.coordinates.map(s=>({type:"LineString",coordinates:s})):l.type==="MultiPoint"?l.coordinates.map(s=>({type:"Point",coordinates:s})):[l]}var Tp=class l{constructor(s,i){this.type=et,this.geojson=s,this.geometries=i}static parse(s,i){if(s.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${s.length-1} instead.`);if(bp(s[1])){let p=s[1];if(p.type==="FeatureCollection")return new l(p,p.features.map(u=>T0(u.geometry)).flat());if(p.type==="Feature")return new l(p,T0(p.geometry));if("type"in p&&"coordinates"in p)return new l(p,T0(p))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return AC(s,this.geometries);if(s.geometryType()==="LineString")return kC(s,this.geometries);if(s.geometryType()==="Polygon")return LC(s,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}},Cp=class l{constructor(s){this.type=Nt,this.key=s}static parse(s,i){if(s.length!==2)return i.error(`Expected 1 argument, but found ${s.length-1} instead.`);let p=s[1];return p==null?i.error("Global state property must be defined."):typeof p!="string"?i.error(`Global state property must be string, but found ${typeof s[1]} instead.`):new l(p)}evaluate(s){var i;let p=(i=s.globals)===null||i===void 0?void 0:i.globalState;return!p||Object.keys(p).length===0?null:up(p,this.key)}eachChild(){}outputDefined(){return!1}},D_={"==":iC,"!=":nC,">":oC,"<":rC,">=":sC,"<=":aC,array:jo,at:e_,boolean:jo,case:r_,coalesce:$m,collator:Gm,format:s_,image:l_,in:t_,"index-of":i_,interpolate:Ka,"interpolate-hcl":Ka,"interpolate-lab":Ka,length:c_,let:Um,literal:zu,match:n_,number:jo,"number-format":a_,object:jo,slice:o_,step:Vm,string:jo,"to-boolean":Ks,"to-color":Ks,"to-number":Ks,"to-string":Ks,var:Nm,within:Sp,distance:Tp,"global-state":Cp},el=class l{constructor(s,i,p,u){this.name=s,this.type=i,this._evaluate=p,this.args=u}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,i){let p=s[0],u=l.definitions[p];if(!u)return i.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);let r=Array.isArray(u)?u[0]:u.type,x=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,C=x.filter(([R])=>!Array.isArray(R)||R.length===s.length-1),A=null;for(let[R,U]of C){A=new jm(i.registry,Km,i.path,null,i.scope);let F=[],le=!1;for(let se=1;se<s.length;se++){let fe=s[se],xe=Array.isArray(R)?R[se-1]:R.type,Le=A.parse(fe,1+F.length,xe);if(!Le){le=!0;break}F.push(Le)}if(!le){if(Array.isArray(R)&&R.length!==F.length){A.error(`Expected ${R.length} arguments, but found ${F.length} instead.`);continue}for(let se=0;se<F.length;se++){let fe=Array.isArray(R)?R[se]:R.type,xe=F[se];A.concat(se+1).checkSubtype(fe,xe.type)}if(A.errors.length===0)return new l(p,r,U,F)}}if(C.length===1)i.errors.push(...A.errors);else{let R=(C.length?C:x).map(([F])=>RC(F)).join(" | "),U=[];for(let F=1;F<s.length;F++){let le=i.parse(s[F],1+U.length);if(!le)return null;U.push(ji(le.type))}i.error(`Expected arguments of type ${R}, but found (${U.join(", ")}) instead.`)}return null}static register(s,i){l.definitions=i;for(let p in i)s[p]=l}};function Rx(l,[s,i,p,u]){s=s.evaluate(l),i=i.evaluate(l),p=p.evaluate(l);let r=u?u.evaluate(l):1,x=vb(s,i,p,r);if(x)throw new Li(x);return new wi(s/255,i/255,p/255,r,!1)}function zx(l,s){return l in s}function C0(l,s){let i=s[l];return typeof i>"u"?null:i}function DC(l,s,i,p){for(;i<=p;){let u=i+p>>1;if(s[u]===l)return!0;s[u]>l?p=u-1:i=u+1}return!1}function Hl(l){return{type:l}}el.register(D_,{error:[PT,[Zt],(l,[s])=>{throw new Li(s.evaluate(l))}],typeof:[Zt,[Nt],(l,[s])=>ji(_n(s.evaluate(l)))],"to-rgba":[Qr(et,4),[ga],(l,[s])=>{let[i,p,u,r]=s.evaluate(l).rgb;return[i*255,p*255,u*255,r]}],rgb:[ga,[et,et,et],Rx],rgba:[ga,[et,et,et,et],Rx],has:{type:Gt,overloads:[[[Zt],(l,[s])=>zx(s.evaluate(l),l.properties())],[[Zt,Yl],(l,[s,i])=>zx(s.evaluate(l),i.evaluate(l))]]},get:{type:Nt,overloads:[[[Zt],(l,[s])=>C0(s.evaluate(l),l.properties())],[[Zt,Yl],(l,[s,i])=>C0(s.evaluate(l),i.evaluate(l))]]},"feature-state":[Nt,[Zt],(l,[s])=>C0(s.evaluate(l),l.featureState||{})],properties:[Yl,[],l=>l.properties()],"geometry-type":[Zt,[],l=>l.geometryType()],id:[Nt,[],l=>l.id()],zoom:[et,[],l=>l.globals.zoom],"heatmap-density":[et,[],l=>l.globals.heatmapDensity||0],elevation:[et,[],l=>l.globals.elevation||0],"line-progress":[et,[],l=>l.globals.lineProgress||0],accumulated:[Nt,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[et,Hl(et),(l,s)=>{let i=0;for(let p of s)i+=p.evaluate(l);return i}],"*":[et,Hl(et),(l,s)=>{let i=1;for(let p of s)i*=p.evaluate(l);return i}],"-":{type:et,overloads:[[[et,et],(l,[s,i])=>s.evaluate(l)-i.evaluate(l)],[[et],(l,[s])=>-s.evaluate(l)]]},"/":[et,[et,et],(l,[s,i])=>s.evaluate(l)/i.evaluate(l)],"%":[et,[et,et],(l,[s,i])=>s.evaluate(l)%i.evaluate(l)],ln2:[et,[],()=>Math.LN2],pi:[et,[],()=>Math.PI],e:[et,[],()=>Math.E],"^":[et,[et,et],(l,[s,i])=>Math.pow(s.evaluate(l),i.evaluate(l))],sqrt:[et,[et],(l,[s])=>Math.sqrt(s.evaluate(l))],log10:[et,[et],(l,[s])=>Math.log(s.evaluate(l))/Math.LN10],ln:[et,[et],(l,[s])=>Math.log(s.evaluate(l))],log2:[et,[et],(l,[s])=>Math.log(s.evaluate(l))/Math.LN2],sin:[et,[et],(l,[s])=>Math.sin(s.evaluate(l))],cos:[et,[et],(l,[s])=>Math.cos(s.evaluate(l))],tan:[et,[et],(l,[s])=>Math.tan(s.evaluate(l))],asin:[et,[et],(l,[s])=>Math.asin(s.evaluate(l))],acos:[et,[et],(l,[s])=>Math.acos(s.evaluate(l))],atan:[et,[et],(l,[s])=>Math.atan(s.evaluate(l))],min:[et,Hl(et),(l,s)=>Math.min(...s.map(i=>i.evaluate(l)))],max:[et,Hl(et),(l,s)=>Math.max(...s.map(i=>i.evaluate(l)))],abs:[et,[et],(l,[s])=>Math.abs(s.evaluate(l))],round:[et,[et],(l,[s])=>{let i=s.evaluate(l);return i<0?-Math.round(-i):Math.round(i)}],floor:[et,[et],(l,[s])=>Math.floor(s.evaluate(l))],ceil:[et,[et],(l,[s])=>Math.ceil(s.evaluate(l))],"filter-==":[Gt,[Zt,Nt],(l,[s,i])=>l.properties()[s.value]===i.value],"filter-id-==":[Gt,[Nt],(l,[s])=>l.id()===s.value],"filter-type-==":[Gt,[Zt],(l,[s])=>l.geometryType()===s.value],"filter-<":[Gt,[Zt,Nt],(l,[s,i])=>{let p=l.properties()[s.value],u=i.value;return typeof p==typeof u&&p<u}],"filter-id-<":[Gt,[Nt],(l,[s])=>{let i=l.id(),p=s.value;return typeof i==typeof p&&i<p}],"filter->":[Gt,[Zt,Nt],(l,[s,i])=>{let p=l.properties()[s.value],u=i.value;return typeof p==typeof u&&p>u}],"filter-id->":[Gt,[Nt],(l,[s])=>{let i=l.id(),p=s.value;return typeof i==typeof p&&i>p}],"filter-<=":[Gt,[Zt,Nt],(l,[s,i])=>{let p=l.properties()[s.value],u=i.value;return typeof p==typeof u&&p<=u}],"filter-id-<=":[Gt,[Nt],(l,[s])=>{let i=l.id(),p=s.value;return typeof i==typeof p&&i<=p}],"filter->=":[Gt,[Zt,Nt],(l,[s,i])=>{let p=l.properties()[s.value],u=i.value;return typeof p==typeof u&&p>=u}],"filter-id->=":[Gt,[Nt],(l,[s])=>{let i=l.id(),p=s.value;return typeof i==typeof p&&i>=p}],"filter-has":[Gt,[Nt],(l,[s])=>s.value in l.properties()],"filter-has-id":[Gt,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Gt,[Qr(Zt)],(l,[s])=>s.value.indexOf(l.geometryType())>=0],"filter-id-in":[Gt,[Qr(Nt)],(l,[s])=>s.value.indexOf(l.id())>=0],"filter-in-small":[Gt,[Zt,Qr(Nt)],(l,[s,i])=>i.value.indexOf(l.properties()[s.value])>=0],"filter-in-large":[Gt,[Zt,Qr(Nt)],(l,[s,i])=>DC(l.properties()[s.value],i.value,0,i.value.length-1)],all:{type:Gt,overloads:[[[Gt,Gt],(l,[s,i])=>s.evaluate(l)&&i.evaluate(l)],[Hl(Gt),(l,s)=>{for(let i of s)if(!i.evaluate(l))return!1;return!0}]]},any:{type:Gt,overloads:[[[Gt,Gt],(l,[s,i])=>s.evaluate(l)||i.evaluate(l)],[Hl(Gt),(l,s)=>{for(let i of s)if(i.evaluate(l))return!0;return!1}]]},"!":[Gt,[Gt],(l,[s])=>!s.evaluate(l)],"is-supported-script":[Gt,[Zt],(l,[s])=>{let i=l.globals&&l.globals.isSupportedScript;return i?i(s.evaluate(l)):!0}],upcase:[Zt,[Zt],(l,[s])=>s.evaluate(l).toUpperCase()],downcase:[Zt,[Zt],(l,[s])=>s.evaluate(l).toLowerCase()],concat:[Zt,Hl(Nt),(l,s)=>s.map(i=>hp(i.evaluate(l))).join("")],"resolved-locale":[Zt,[cf],(l,[s])=>s.evaluate(l).resolvedLocale()]});function RC(l){return Array.isArray(l)?`(${l.map(ji).join(", ")})`:`(${ji(l.type)}...)`}function Km(l){if(l instanceof Nm)return Km(l.boundExpression);if(l instanceof el&&l.name==="error"||l instanceof Gm||l instanceof Sp||l instanceof Tp||l instanceof Cp)return!1;let s=l instanceof Ks||l instanceof jo,i=!0;return l.eachChild(p=>{s?i=i&&Km(p):i=i&&p instanceof zu}),i?ff(l)&&gf(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function ff(l){if(l instanceof el&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Sp||l instanceof Tp)return!1;let s=!0;return l.eachChild(i=>{s&&!ff(i)&&(s=!1)}),s}function Pp(l){if(l instanceof el&&l.name==="feature-state")return!1;let s=!0;return l.eachChild(i=>{s&&!Pp(i)&&(s=!1)}),s}function gf(l,s){if(l instanceof el&&s.indexOf(l.name)>=0)return!1;let i=!0;return l.eachChild(p=>{i&&!gf(p,s)&&(i=!1)}),i}function f_(l){return{result:"success",value:l}}function Au(l){return{result:"error",value:l}}function Xm(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function Pb(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Mb(l){return!!l.expression&&l.expression.interpolated}function Jt(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function R_(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)&&_n(l)===Yl}var g_=class{constructor(s,i){this.expression=s,this._warningHistory={},this._evaluator=new Bm,this._defaultValue=i?FC(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(s,i,p,u,r,x){return this._evaluator.globals=s,this._evaluator.feature=i,this._evaluator.featureState=p,this._evaluator.canonical=u,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(s,i,p,u,r,x){this._evaluator.globals=s,this._evaluator.feature=i||null,this._evaluator.featureState=p||null,this._evaluator.canonical=u,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=x||null;try{let C=this.expression.evaluate(this._evaluator);if(C==null||typeof C=="number"&&C!==C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new Li(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}};function Eb(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in D_}function Ab(l,s){let i=new jm(D_,Km,[],s?OC(s):void 0),p=i.parse(l,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?f_(new g_(p,s)):Au(i.errors)}var Jm=class{constructor(s,i){this.kind=s,this._styleExpression=i,this.isStateDependent=s!=="constant"&&!Pp(i.expression),this.globalStateRefs=z_(i.expression)}evaluateWithoutErrorHandling(s,i,p,u,r,x){return this._styleExpression.evaluateWithoutErrorHandling(s,i,p,u,r,x)}evaluate(s,i,p,u,r,x){return this._styleExpression.evaluate(s,i,p,u,r,x)}},Ym=class{constructor(s,i,p,u){this.kind=s,this.zoomStops=p,this._styleExpression=i,this.isStateDependent=s!=="camera"&&!Pp(i.expression),this.globalStateRefs=z_(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(s,i,p,u,r,x){return this._styleExpression.evaluateWithoutErrorHandling(s,i,p,u,r,x)}evaluate(s,i,p,u,r,x){return this._styleExpression.evaluate(s,i,p,u,r,x)}interpolationFactor(s,i,p){return this.interpolationType?Ka.interpolationFactor(this.interpolationType,s,i,p):0}};function zC(l,s){let i=Ab(l,s);if(i.result==="error")return i;let p=i.value.expression,u=ff(p);if(!u&&!Xm(s))return Au([new xo("","data expressions not supported")]);let r=gf(p,["zoom"]);if(!r&&!Pb(s))return Au([new xo("","zoom expressions not supported")]);let x=Pm(p);if(!x&&!r)return Au([new xo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(x instanceof xo)return Au([x]);if(x instanceof Ka&&!Mb(s))return Au([new xo("",'"interpolate" expressions cannot be used with this property')]);if(!x)return f_(u?new Jm("constant",i.value):new Jm("source",i.value));let C=x instanceof Ka?x.interpolation:void 0;return f_(u?new Ym("camera",i.value,x.labels,C):new Ym("composite",i.value,x.labels,C))}function Pm(l){let s=null;if(l instanceof Um)s=Pm(l.result);else if(l instanceof $m){for(let i of l.args)if(s=Pm(i),s)break}else(l instanceof Vm||l instanceof Ka)&&l.input instanceof el&&l.input.name==="zoom"&&(s=l);return s instanceof xo||l.eachChild(i=>{let p=Pm(i);p instanceof xo?s=p:!s&&p?s=new xo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&p&&s!==p&&(s=new xo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function z_(l,s=new Set){return l instanceof Cp&&s.add(l.key),l.eachChild(i=>{z_(i,s)}),s}function OC(l){let s={color:ga,string:Zt,number:et,enum:Zt,boolean:Gt,formatted:uf,padding:hf,numberArray:pf,colorArray:gp,projectionDefinition:lf,resolvedImage:Ap,variableAnchorOffsetCollection:df};return l.type==="array"?Qr(s[l.value]||Nt,l.length):s[l.type]}function FC(l){if(l.type==="color"&&R_(l.default))return new wi(0,0,0,0);switch(l.type){case"color":return wi.parse(l.default)||null;case"padding":return Xa.parse(l.default)||null;case"numberArray":return Ja.parse(l.default)||null;case"colorArray":return Uo.parse(l.default)||null;case"variableAnchorOffsetCollection":return Ya.parse(l.default)||null;case"projectionDefinition":return nc.parse(l.default)||null;default:return l.default===void 0?null:l.default}}function kb(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(let s of l.slice(1))if(!kb(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}function Lb(l){let s=l.key,i=l.value;return i?[new Ze(s,i,"constants have been deprecated as of v8")]:[]}function en(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function rc(l){if(Array.isArray(l))return l.map(rc);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){let s={};for(let i in l)s[i]=rc(l[i]);return s}return en(l)}function bo(l){let s=l.key,i=l.value,p=l.valueSpec||{},u=l.objectElementValidators||{},r=l.style,x=l.styleSpec,C=l.validateSpec,A=[],R=Jt(i);if(R!=="object")return[new Ze(s,i,`object expected, ${R} found`)];for(let U in i){let F=U.split(".")[0],le=up(p,F)||p["*"],se;if(up(u,F))se=u[F];else if(up(p,F))se=C;else if(u["*"])se=u["*"];else if(p["*"])se=C;else{A.push(new Ze(s,i[U],`unknown property "${U}"`));continue}A=A.concat(se({key:(s&&`${s}.`)+U,value:i[U],valueSpec:le,style:r,styleSpec:x,object:i,objectKey:U,validateSpec:C},i))}for(let U in p)u[U]||p[U].required&&p[U].default===void 0&&i[U]===void 0&&A.push(new Ze(s,i,`missing required property "${U}"`));return A}function O_(l){let s=l.value,i=l.valueSpec,p=l.validateSpec,u=l.style,r=l.styleSpec,x=l.key,C=l.arrayElementValidator||p;if(Jt(s)!=="array")return[new Ze(x,s,`array expected, ${Jt(s)} found`)];if(i.length&&s.length!==i.length)return[new Ze(x,s,`array length ${i.length} expected, length ${s.length} found`)];if(i["min-length"]&&s.length<i["min-length"])return[new Ze(x,s,`array length at least ${i["min-length"]} expected, length ${s.length} found`)];let A={type:i.value,values:i.values};r.$version<7&&(A.function=i.function),Jt(i.value)==="object"&&(A=i.value);let R=[];for(let U=0;U<s.length;U++)R=R.concat(C({array:s,arrayIndex:U,value:s[U],valueSpec:A,validateSpec:l.validateSpec,style:u,styleSpec:r,key:`${x}[${U}]`}));return R}function _f(l){let s=l.key,i=l.value,p=l.valueSpec,u=Jt(i);return u==="number"&&i!==i&&(u="NaN"),u!=="number"?[new Ze(s,i,`number expected, ${u} found`)]:"minimum"in p&&i<p.minimum?[new Ze(s,i,`${i} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&i>p.maximum?[new Ze(s,i,`${i} is greater than the maximum value ${p.maximum}`)]:[]}function Db(l){let s=l.valueSpec,i=en(l.value.type),p,u={},r,x,C=i!=="categorical"&&l.value.property===void 0,A=!C,R=Jt(l.value.stops)==="array"&&Jt(l.value.stops[0])==="array"&&Jt(l.value.stops[0][0])==="object",U=bo({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:F,default:fe}});return i==="identity"&&C&&U.push(new Ze(l.key,l.value,'missing required property "property"')),i!=="identity"&&!l.value.stops&&U.push(new Ze(l.key,l.value,'missing required property "stops"')),i==="exponential"&&l.valueSpec.expression&&!Mb(l.valueSpec)&&U.push(new Ze(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(A&&!Xm(l.valueSpec)?U.push(new Ze(l.key,l.value,"property functions not supported")):C&&!Pb(l.valueSpec)&&U.push(new Ze(l.key,l.value,"zoom functions not supported"))),(i==="categorical"||R)&&l.value.property===void 0&&U.push(new Ze(l.key,l.value,'"property" property is required')),U;function F(xe){if(i==="identity")return[new Ze(xe.key,xe.value,'identity function may not have a "stops" property')];let Le=[],Fe=xe.value;return Le=Le.concat(O_({key:xe.key,value:Fe,valueSpec:xe.valueSpec,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec,arrayElementValidator:le})),Jt(Fe)==="array"&&Fe.length===0&&Le.push(new Ze(xe.key,Fe,"array must have at least one stop")),Le}function le(xe){let Le=[],Fe=xe.value,$e=xe.key;if(Jt(Fe)!=="array")return[new Ze($e,Fe,`array expected, ${Jt(Fe)} found`)];if(Fe.length!==2)return[new Ze($e,Fe,`array length 2 expected, length ${Fe.length} found`)];if(R){if(Jt(Fe[0])!=="object")return[new Ze($e,Fe,`object expected, ${Jt(Fe[0])} found`)];if(Fe[0].zoom===void 0)return[new Ze($e,Fe,"object stop key must have zoom")];if(Fe[0].value===void 0)return[new Ze($e,Fe,"object stop key must have value")];if(x&&x>en(Fe[0].zoom))return[new Ze($e,Fe[0].zoom,"stop zoom values must appear in ascending order")];en(Fe[0].zoom)!==x&&(x=en(Fe[0].zoom),r=void 0,u={}),Le=Le.concat(bo({key:`${$e}[0]`,value:Fe[0],valueSpec:{zoom:{}},validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:_f,value:se}}))}else Le=Le.concat(se({key:`${$e}[0]`,value:Fe[0],validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec},Fe));return Eb(rc(Fe[1]))?Le.concat([new Ze(`${$e}[1]`,Fe[1],"expressions are not allowed in function stops.")]):Le.concat(xe.validateSpec({key:`${$e}[1]`,value:Fe[1],valueSpec:s,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec}))}function se(xe,Le){let Fe=Jt(xe.value),$e=en(xe.value),nt=xe.value!==null?xe.value:Le;if(!p)p=Fe;else if(Fe!==p)return[new Ze(xe.key,nt,`${Fe} stop domain type must match previous stop domain type ${p}`)];if(Fe!=="number"&&Fe!=="string"&&Fe!=="boolean")return[new Ze(xe.key,nt,"stop domain value must be a number, string, or boolean")];if(Fe!=="number"&&i!=="categorical"){let je=`number expected, ${Fe} found`;return Xm(s)&&i===void 0&&(je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ze(xe.key,nt,je)]}return i==="categorical"&&Fe==="number"&&(!isFinite($e)||Math.floor($e)!==$e)?[new Ze(xe.key,nt,`integer expected, found ${$e}`)]:i!=="categorical"&&Fe==="number"&&r!==void 0&&$e<r?[new Ze(xe.key,nt,"stop domain values must appear in ascending order")]:(r=$e,i==="categorical"&&$e in u?[new Ze(xe.key,nt,"stop domain values must be unique")]:(u[$e]=!0,[]))}function fe(xe){return xe.validateSpec({key:xe.key,value:xe.value,valueSpec:s,validateSpec:xe.validateSpec,style:xe.style,styleSpec:xe.styleSpec})}}function Ou(l){let s=(l.expressionContext==="property"?zC:Ab)(rc(l.value),l.valueSpec);if(s.result==="error")return s.value.map(p=>new Ze(`${l.key}${p.key}`,l.value,p.message));let i=s.value.expression||s.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!i.outputDefined())return[new Ze(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!Pp(i))return[new Ze(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!Pp(i))return[new Ze(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!gf(i,["zoom","feature-state"]))return[new Ze(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!ff(i))return[new Ze(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function BC(l){let s=l.value,i=l.key,p=Jt(s);return p!=="boolean"?[new Ze(i,s,`boolean expected, ${p} found`)]:[]}function __(l){let s=l.key,i=l.value,p=Jt(i);return p!=="string"?[new Ze(s,i,`color expected, ${p} found`)]:wi.parse(String(i))?[]:[new Ze(s,i,`color expected, "${i}" found`)]}function Mp(l){let s=l.key,i=l.value,p=l.valueSpec,u=[];return Array.isArray(p.values)?p.values.indexOf(en(i))===-1&&u.push(new Ze(s,i,`expected one of [${p.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(p.values).indexOf(en(i))===-1&&u.push(new Ze(s,i,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function F_(l){return kb(rc(l.value))?Ou(Fm({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Rb(l)}function Rb(l){let s=l.value,i=l.key;if(Jt(s)!=="array")return[new Ze(i,s,`array expected, ${Jt(s)} found`)];let p=l.styleSpec,u,r=[];if(s.length<1)return[new Ze(i,s,"filter array must have at least 1 element")];switch(r=r.concat(Mp({key:`${i}[0]`,value:s[0],valueSpec:p.filter_operator,style:l.style,styleSpec:l.styleSpec})),en(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&en(s[1])==="$type"&&r.push(new Ze(i,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&r.push(new Ze(i,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(u=Jt(s[1]),u!=="string"&&r.push(new Ze(`${i}[1]`,s[1],`string expected, ${u} found`)));for(let x=2;x<s.length;x++)u=Jt(s[x]),en(s[1])==="$type"?r=r.concat(Mp({key:`${i}[${x}]`,value:s[x],valueSpec:p.geometry_type,style:l.style,styleSpec:l.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&r.push(new Ze(`${i}[${x}]`,s[x],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let x=1;x<s.length;x++)r=r.concat(Rb({key:`${i}[${x}]`,value:s[x],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":u=Jt(s[1]),s.length!==2?r.push(new Ze(i,s,`filter array for "${s[0]}" operator must have 2 elements`)):u!=="string"&&r.push(new Ze(`${i}[1]`,s[1],`string expected, ${u} found`));break}return r}function zb(l,s){let i=l.key,p=l.validateSpec,u=l.style,r=l.styleSpec,x=l.value,C=l.objectKey,A=r[`${s}_${l.layerType}`];if(!A)return[];let R=C.match(/^(.*)-transition$/);if(s==="paint"&&R&&A[R[1]]&&A[R[1]].transition)return p({key:i,value:x,valueSpec:r.transition,style:u,styleSpec:r});let U=l.valueSpec||A[C];if(!U)return[new Ze(i,x,`unknown property "${C}"`)];let F;if(Jt(x)==="string"&&Xm(U)&&!U.tokens&&(F=/^{([^}]+)}$/.exec(x)))return[new Ze(i,x,`"${C}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];let le=[];return l.layerType==="symbol"&&(C==="text-field"&&u&&!u.glyphs&&le.push(new Ze(i,x,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&R_(rc(x))&&en(x.type)==="identity"&&le.push(new Ze(i,x,'"text-font" does not support identity functions'))),le.concat(p({key:l.key,value:x,valueSpec:U,style:u,styleSpec:r,expressionContext:"property",propertyType:s,propertyKey:C}))}function Ob(l){return zb(l,"paint")}function Fb(l){return zb(l,"layout")}function Bb(l){let s=[],i=l.value,p=l.key,u=l.style,r=l.styleSpec;if(Jt(i)!=="object")return[new Ze(p,i,`object expected, ${Jt(i)} found`)];!i.type&&!i.ref&&s.push(new Ze(p,i,'either "type" or "ref" is required'));let x=en(i.type),C=en(i.ref);if(i.id){let A=en(i.id);for(let R=0;R<l.arrayIndex;R++){let U=u.layers[R];en(U.id)===A&&s.push(new Ze(p,i.id,`duplicate layer id "${i.id}", previously used at line ${U.id.__line__}`))}}if("ref"in i){["type","source","source-layer","filter","layout"].forEach(R=>{R in i&&s.push(new Ze(p,i[R],`"${R}" is prohibited for ref layers`))});let A;u.layers.forEach(R=>{en(R.id)===C&&(A=R)}),A?A.ref?s.push(new Ze(p,i.ref,"ref cannot reference another ref layer")):x=en(A.type):s.push(new Ze(p,i.ref,`ref layer "${C}" not found`))}else if(x!=="background")if(!i.source)s.push(new Ze(p,i,'missing required property "source"'));else{let A=u.sources&&u.sources[i.source],R=A&&en(A.type);A?R==="vector"&&x==="raster"?s.push(new Ze(p,i.source,`layer "${i.id}" requires a raster source`)):R!=="raster-dem"&&x==="hillshade"?s.push(new Ze(p,i.source,`layer "${i.id}" requires a raster-dem source`)):R!=="raster-dem"&&x==="color-relief"?s.push(new Ze(p,i.source,`layer "${i.id}" requires a raster-dem source`)):R==="raster"&&x!=="raster"?s.push(new Ze(p,i.source,`layer "${i.id}" requires a vector source`)):R==="vector"&&!i["source-layer"]?s.push(new Ze(p,i,`layer "${i.id}" must specify a "source-layer"`)):R==="raster-dem"&&x!=="hillshade"&&x!=="color-relief"?s.push(new Ze(p,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):x==="line"&&i.paint&&i.paint["line-gradient"]&&(R!=="geojson"||!A.lineMetrics)&&s.push(new Ze(p,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new Ze(p,i.source,`source "${i.source}" not found`))}return s=s.concat(bo({key:p,value:i,valueSpec:r.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*"(){return[]},type(){return l.validateSpec({key:`${p}.type`,value:i.type,valueSpec:r.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:i,objectKey:"type"})},filter:F_,layout(A){return bo({layer:i,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*"(R){return Fb(Fm({layerType:x},R))}}})},paint(A){return bo({layer:i,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*"(R){return Ob(Fm({layerType:x},R))}}})}}})),s}function oc(l){let s=l.value,i=l.key,p=Jt(s);return p!=="string"?[new Ze(i,s,`string expected, ${p} found`)]:[]}function jC(l){var s;let i=(s=l.sourceName)!==null&&s!==void 0?s:"",p=l.value,u=l.styleSpec,r=u.source_raster_dem,x=l.style,C=[],A=Jt(p);if(p===void 0)return C;if(A!=="object")return C.push(new Ze("source_raster_dem",p,`object expected, ${A} found`)),C;let R=en(p.encoding)==="custom",U=["redFactor","greenFactor","blueFactor","baseShift"],F=l.value.encoding?`"${l.value.encoding}"`:"Default";for(let le in p)!R&&U.includes(le)?C.push(new Ze(le,p[le],`In "${i}": "${le}" is only valid when "encoding" is set to "custom". ${F} encoding found`)):r[le]?C=C.concat(l.validateSpec({key:le,value:p[le],valueSpec:r[le],validateSpec:l.validateSpec,style:x,styleSpec:u})):C.push(new Ze(le,p[le],`unknown property "${le}"`));return C}var Ox={promoteId:UC};function jb(l){let s=l.value,i=l.key,p=l.styleSpec,u=l.style,r=l.validateSpec;if(!s.type)return[new Ze(i,s,'"type" is required')];let x=en(s.type),C;switch(x){case"vector":case"raster":return C=bo({key:i,value:s,valueSpec:p[`source_${x.replace("-","_")}`],style:l.style,styleSpec:p,objectElementValidators:Ox,validateSpec:r}),C;case"raster-dem":return C=jC({sourceName:i,value:s,style:l.style,styleSpec:p,validateSpec:r}),C;case"geojson":if(C=bo({key:i,value:s,valueSpec:p.source_geojson,style:u,styleSpec:p,validateSpec:r,objectElementValidators:Ox}),s.cluster)for(let A in s.clusterProperties){let[R,U]=s.clusterProperties[A],F=typeof R=="string"?[R,["accumulated"],["get",A]]:R;C.push(...Ou({key:`${i}.${A}.map`,value:U,expressionContext:"cluster-map"})),C.push(...Ou({key:`${i}.${A}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return C;case"video":return bo({key:i,value:s,valueSpec:p.source_video,style:u,validateSpec:r,styleSpec:p});case"image":return bo({key:i,value:s,valueSpec:p.source_image,style:u,validateSpec:r,styleSpec:p});case"canvas":return[new Ze(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mp({key:`${i}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function UC({key:l,value:s}){if(Jt(s)==="string")return oc({key:l,value:s});{let i=[];for(let p in s)i.push(...oc({key:`${l}.${p}`,value:s[p]}));return i}}function Ub(l){let s=l.value,i=l.styleSpec,p=i.light,u=l.style,r=[],x=Jt(s);if(s===void 0)return r;if(x!=="object")return r=r.concat([new Ze("light",s,`object expected, ${x} found`)]),r;for(let C in s){let A=C.match(/^(.*)-transition$/);A&&p[A[1]]&&p[A[1]].transition?r=r.concat(l.validateSpec({key:C,value:s[C],valueSpec:i.transition,validateSpec:l.validateSpec,style:u,styleSpec:i})):p[C]?r=r.concat(l.validateSpec({key:C,value:s[C],valueSpec:p[C],validateSpec:l.validateSpec,style:u,styleSpec:i})):r=r.concat([new Ze(C,s[C],`unknown property "${C}"`)])}return r}function Nb(l){let s=l.value,i=l.styleSpec,p=i.sky,u=l.style,r=Jt(s);if(s===void 0)return[];if(r!=="object")return[new Ze("sky",s,`object expected, ${r} found`)];let x=[];for(let C in s)p[C]?x=x.concat(l.validateSpec({key:C,value:s[C],valueSpec:p[C],style:u,styleSpec:i})):x=x.concat([new Ze(C,s[C],`unknown property "${C}"`)]);return x}function Vb(l){let s=l.value,i=l.styleSpec,p=i.terrain,u=l.style,r=[],x=Jt(s);if(s===void 0)return r;if(x!=="object")return r=r.concat([new Ze("terrain",s,`object expected, ${x} found`)]),r;for(let C in s)p[C]?r=r.concat(l.validateSpec({key:C,value:s[C],valueSpec:p[C],validateSpec:l.validateSpec,style:u,styleSpec:i})):r=r.concat([new Ze(C,s[C],`unknown property "${C}"`)]);return r}function NC(l){return oc(l).length===0?[]:Ou(l)}function VC(l){return oc(l).length===0?[]:Ou(l)}function $C(l){let s=l.key,i=l.value;if(Jt(i)==="array"){if(i.length<1||i.length>4)return[new Ze(s,i,`padding requires 1 to 4 values; ${i.length} values found`)];let p={type:"number"},u=[];for(let r=0;r<i.length;r++)u=u.concat(l.validateSpec({key:`${s}[${r}]`,value:i[r],validateSpec:l.validateSpec,valueSpec:p}));return u}else return _f({key:s,value:i,valueSpec:{}})}function GC(l){let s=l.key,i=l.value;if(Jt(i)==="array"){let p={type:"number"};if(i.length<1)return[new Ze(s,i,"array length at least 1 expected, length 0 found")];let u=[];for(let r=0;r<i.length;r++)u=u.concat(l.validateSpec({key:`${s}[${r}]`,value:i[r],validateSpec:l.validateSpec,valueSpec:p}));return u}else return _f({key:s,value:i,valueSpec:{}})}function qC(l){let s=l.key,i=l.value;if(Jt(i)==="array"){if(i.length<1)return[new Ze(s,i,"array length at least 1 expected, length 0 found")];let p=[];for(let u=0;u<i.length;u++)p=p.concat(__({key:`${s}[${u}]`,value:i[u]}));return p}else return __({key:s,value:i})}function WC(l){let s=l.key,i=l.value,p=Jt(i),u=l.styleSpec;if(p!=="array"||i.length<1||i.length%2!==0)return[new Ze(s,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let r=[];for(let x=0;x<i.length;x+=2)r=r.concat(Mp({key:`${s}[${x}]`,value:i[x],valueSpec:u.layout_symbol["text-anchor"]})),r=r.concat(O_({key:`${s}[${x+1}]`,value:i[x+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:u}));return r}function $b(l){let s=[],i=l.value,p=l.key;if(Array.isArray(i)){let u=[],r=[];for(let x in i){i[x].id&&u.includes(i[x].id)&&s.push(new Ze(p,i,`all the sprites' ids must be unique, but ${i[x].id} is duplicated`)),u.push(i[x].id),i[x].url&&r.includes(i[x].url)&&s.push(new Ze(p,i,`all the sprites' URLs must be unique, but ${i[x].url} is duplicated`)),r.push(i[x].url);let C={id:{type:"string",required:!0},url:{type:"string",required:!0}};s=s.concat(bo({key:`${p}[${x}]`,value:i[x],valueSpec:C,validateSpec:l.validateSpec}))}return s}else return oc({key:p,value:i})}function ZC(l){let s=l.value,i=l.styleSpec,p=i.projection,u=l.style,r=Jt(s);if(s===void 0)return[];if(r!=="object")return[new Ze("projection",s,`object expected, ${r} found`)];let x=[];for(let C in s)p[C]?x=x.concat(l.validateSpec({key:C,value:s[C],valueSpec:p[C],style:u,styleSpec:i})):x=x.concat([new Ze(C,s[C],`unknown property "${C}"`)]);return x}function HC(l){let s=l.key,i=l.value;i=i instanceof String?i.valueOf():i;let p=Jt(i);return p==="array"&&!XC(i)&&!KC(i)?[new Ze(s,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]:["array","string"].includes(p)?[]:[new Ze(s,i,`projection expected, invalid type "${p}" found`)]}function KC(l){return!!["interpolate","step","literal"].includes(l[0])}function XC(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"}function JC(l){return!!l&&l.constructor===Object}function Gb(l){return JC(l.value)?[]:[new Ze(l.key,l.value,`object expected, ${Jt(l.value)} found`)]}var Fx={"*"(){return[]},array:O_,boolean:BC,number:_f,color:__,constants:Lb,enum:Mp,filter:F_,function:Db,layer:Bb,object:bo,source:jb,light:Ub,sky:Nb,terrain:Vb,projection:ZC,projectionDefinition:HC,string:oc,formatted:NC,resolvedImage:VC,padding:$C,numberArray:GC,colorArray:qC,variableAnchorOffsetCollection:WC,sprite:$b,state:Gb};function Qm(l){let s=l.value,i=l.valueSpec,p=l.styleSpec;return l.validateSpec=Qm,i.expression&&R_(en(s))?Db(l):i.expression&&Eb(rc(s))?Ou(l):i.type&&Fx[i.type]?Fx[i.type](l):bo(Fm({},l,{valueSpec:i.type?p[i.type]:i}))}function qb(l){let s=l.value,i=l.key,p=oc(l);return p.length||(s.indexOf("{fontstack}")===-1&&p.push(new Ze(i,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&p.push(new Ze(i,s,'"glyphs" url must include a "{range}" token'))),p}function eo(l,s=CT){let i=[];return i=i.concat(Qm({key:"",value:l,valueSpec:s.$root,styleSpec:s,style:l,validateSpec:Qm,objectElementValidators:{glyphs:qb,"*"(){return[]}}})),l.constants&&(i=i.concat(Lb({key:"constants",value:l.constants}))),Wb(i)}eo.source=Vo(No(jb));eo.sprite=Vo(No($b));eo.glyphs=Vo(No(qb));eo.light=Vo(No(Ub));eo.sky=Vo(No(Nb));eo.terrain=Vo(No(Vb));eo.state=Vo(No(Gb));eo.layer=Vo(No(Bb));eo.filter=Vo(No(F_));eo.paintProperty=Vo(No(Ob));eo.layoutProperty=Vo(No(Fb));function No(l){return function(s){return l(ha(Xt({},s),{validateSpec:Qm}))}}function Wb(l){return[].concat(l).sort((s,i)=>s.line-i.line)}function Vo(l){return function(...s){return Wb(l.apply(this,s))}}function Bx(l){if(!l)return{style:_o[Ha[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof l=="string"){let s=QC(l);return s.isValidStyle?{style:s.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:s.isValidJSON?{style:_o[Ha[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:l.startsWith("http")?{style:l,requiresUrlMonitoring:!0,isFallback:!1}:l.toLowerCase().includes(".json")?{style:YC(l),requiresUrlMonitoring:!0,isFallback:!1}:{style:rp(l),requiresUrlMonitoring:!0,isFallback:!1}}return l instanceof qs?{style:l.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:l instanceof Ws?{style:l.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:eo(l).length===0?{style:l,requiresUrlMonitoring:!1,isFallback:!1}:{style:_o[Ha[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function YC(l){try{return new URL(l).href}catch{}return new URL(l,location.origin).href}function QC(l){try{let s=JSON.parse(l),i=eo(s);return{isValidJSON:!0,isValidStyle:i.length===0,styleObject:i.length===0?s:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function ya(l,s,i){let p=window.document.createElement(l);return s!==void 0&&(p.className=s),i&&i.appendChild(p),p}function yf(l){l.parentNode&&l.parentNode.removeChild(l)}var ef=class{constructor(){at(this,"_map"),at(this,"_container"),at(this,"_terrainButton"),EI(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(s){return this._map=s,this._container=ya("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ya("button","maplibregl-ctrl-terrain",this._container),ya("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){yf(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}},tf=class extends Ru{constructor(s={}){super({showCompass:s.showCompass??!0,showZoom:s.showZoom??!0,visualizePitch:s.visualizePitch??!0}),at(this,"_rotateCompassArrow",()=>{let i=this._map.getBearing(),p=this._map.getPitch(),u=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(p*(Math.PI/180))**.5)}) rotateX(${Math.min(70,p)}deg) rotateZ(${-i}deg)`:`rotate(${-i}deg)`;this._compassIcon.style.transform=u}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",i=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}))}_createButton(s,i){let p=super._createButton(s,i);return p.clickFunction=i,p}},jx=gt.default.Marker,Ux=gt.default.LngLat,eP=gt.default.LngLatBounds,nf=class extends Dm{constructor(){super(...arguments),at(this,"lastUpdatedCenter",new Ux(0,0)),at(this,"_updateCamera",s=>{var i;let p=new Ux(s.coords.longitude,s.coords.latitude),u=s.coords.accuracy,r=ha(Xt({bearing:this._map.getBearing()},this.options.fitBoundsOptions),{linear:!0}),x=this._map.getZoom();x>(((i=this.options.fitBoundsOptions)==null?void 0:i.maxZoom)??30)&&(r.zoom=x),this._map.fitBounds(eP.fromLngLat(p,u),r,{geolocateSource:!0});let C=!1,A=()=>{C=!0};this._map.once("click",A),this._map.once("dblclick",A),this._map.once("dragstart",A),this._map.once("mousedown",A),this._map.once("touchstart",A),this._map.once("wheel",A),this._map.once("moveend",()=>{this._map.off("click",A),this._map.off("dblclick",A),this._map.off("dragstart",A),this._map.off("mousedown",A),this._map.off("touchstart",A),this._map.off("wheel",A),!C&&(this.lastUpdatedCenter=this._map.getCenter())})}),at(this,"_finishSetupUI",s=>{if(this._map){if(s===!1){let i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{let i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ya("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jx({element:this._dotElement}),this._circleElement=ya("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jx({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",i=>{let p=i.originalEvent&&i.originalEvent.type==="resize",u=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!i.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!p&&u>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),at(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;let s=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],i=this._map.project(s),p=this._map.unproject([i.x,i.y]),u=this._map.unproject([i.x+20,i.y]),r=p.distanceTo(u)/20,x=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}},Yr,fa,Kl,Xl,yo,Mm,fr,Zb,vo,Hb,pp=class{constructor(s,i){Zl(this,fr),Zl(this,Yr),at(this,"map"),Zl(this,fa),Zl(this,Kl),Zl(this,Xl),Zl(this,yo,!1),Zl(this,Mm),s.style!==void 0&&Mu(this,yo,!0),Mu(this,Yr,ha(Xt(ha(Xt({zoomAdjust:-4,position:"top-right"},i),{forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1}),s),{containerStyle:Xt({border:"1px solid #000",width:"400px",height:"300px"},s.containerStyle??{})})),s.lockZoom!==void 0&&(ti(this,Yr).minZoom=s.lockZoom,ti(this,Yr).maxZoom=s.lockZoom)}setStyle(s,i){ti(this,yo)||this.map.setStyle(s,i),Jr(this,fr,vo).call(this)}addLayer(s,i){return ti(this,yo)||this.map.addLayer(s,i),Jr(this,fr,vo).call(this),this.map}moveLayer(s,i){return ti(this,yo)||this.map.moveLayer(s,i),Jr(this,fr,vo).call(this),this.map}removeLayer(s){return ti(this,yo)||this.map.removeLayer(s),Jr(this,fr,vo).call(this),this}setLayerZoomRange(s,i,p){return ti(this,yo)||this.map.setLayerZoomRange(s,i,p),Jr(this,fr,vo).call(this),this}setFilter(s,i,p){return ti(this,yo)||this.map.setFilter(s,i,p),Jr(this,fr,vo).call(this),this}setPaintProperty(s,i,p,u){return ti(this,yo)||this.map.setPaintProperty(s,i,p,u),Jr(this,fr,vo).call(this),this}setLayoutProperty(s,i,p,u){return ti(this,yo)||this.map.setLayoutProperty(s,i,p,u),Jr(this,fr,vo).call(this),this}setGlyphs(s,i){return ti(this,yo)||this.map.setGlyphs(s,i),Jr(this,fr,vo).call(this),this}onAdd(s){Mu(this,fa,s),Mu(this,Kl,ya("div","maplibregl-ctrl maplibregl-ctrl-group"));for(let[i,p]of Object.entries(ti(this,Yr).containerStyle))ti(this,Kl).style.setProperty(i,p);return ti(this,Yr).container=ti(this,Kl),ti(this,Yr).zoom=s.getZoom()+ti(this,Yr).zoomAdjust,this.map=new vf(ti(this,Yr)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{Jr(this,fr,Zb).call(this,ti(this,Yr).parentRect),Mu(this,Mm,Jr(this,fr,Hb).call(this))}),ti(this,Kl)}onRemove(){var s;(s=ti(this,Mm))==null||s.call(this),yf(ti(this,Kl))}};Yr=new WeakMap,fa=new WeakMap,Kl=new WeakMap,Xl=new WeakMap,yo=new WeakMap,Mm=new WeakMap,fr=new WeakSet,Zb=function(l){l===void 0||l.linePaint===void 0&&l.fillPaint===void 0||(Mu(this,Xl,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:ti(this,Xl)}),(l.lineLayout!==void 0||l.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:Xt({},l.lineLayout),paint:Xt({"line-color":"#FFF","line-width":1,"line-opacity":.85},l.linePaint)}),l.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:Xt({"fill-color":"#08F","fill-opacity":.135},l.fillPaint)}),Jr(this,fr,vo).call(this))},vo=function(){if(ti(this,Xl)===void 0)return;let{devicePixelRatio:l}=window,s=ti(this,fa).getCanvas(),i=s.width/l,p=s.height/l,u=ti(this,fa).unproject.bind(ti(this,fa)),r=u([0,0]),x=u([i,0]),C=u([0,p]),A=u([i,p]);ti(this,Xl).geometry.coordinates=[[C.toArray(),A.toArray(),x.toArray(),r.toArray(),C.toArray()]];let R=this.map.getSource("parentRect");R!==void 0&&R.setData(ti(this,Xl))},Hb=function(){let{pitchAdjust:l}=ti(this,Yr),s=()=>{r("parent")},i=()=>{r("minimap")},p=()=>{ti(this,fa).on("move",s),this.map.on("move",i)},u=()=>{ti(this,fa).off("move",s),this.map.off("move",i)},r=x=>{u();let C=x==="parent"?ti(this,fa):this.map,A=x==="parent"?this.map:ti(this,fa),R=C.getCenter(),U=C.getZoom()+ti(this,Yr).zoomAdjust*(x==="parent"?1:-1),F=C.getBearing(),le=C.getPitch();A.jumpTo({center:R,zoom:U,bearing:F,pitch:l?le:0}),Jr(this,fr,vo).call(this),p()};return p(),()=>{u()}};var rf=class{constructor(){at(this,"map"),at(this,"container"),at(this,"projectionButton")}onAdd(s){return this.map=s,this.container=ya("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=ya("button","maplibregl-ctrl-projection",this.container),ya("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),s.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){yf(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){this.map.getProjection()===void 0&&this.map.setProjection({type:"mercator"}),this.map.isGlobeProjection()?this.map.enableMercatorProjection():this.map.enableGlobeProjection(),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}},tP="@maptiler/sdk",iP="3.7.0",nP="The Javascript & TypeScript map SDK tailored for MapTiler Cloud",rP="MapTiler",oP="dist/maptiler-sdk.mjs",aP="dist/maptiler-sdk.d.ts",sP="dist/maptiler-sdk.css",lP="module",cP="dist/maptiler-sdk.mjs",uP={".":{import:"./dist/maptiler-sdk.mjs",types:"./dist/maptiler-sdk.d.ts"},"./dist/maptiler-sdk.css":{import:"./dist/maptiler-sdk.css"},"./style.css":{import:"./dist/maptiler-sdk.css"}},hP=["maptiler","map","sdk","webmap","cloud","webGL","maplibre"],pP="https://docs.maptiler.com/sdk-js/",dP="BSD-3-Clause",mP={type:"git",url:"https://github.com/maptiler/maptiler-sdk-js.git"},fP={prepare:"husky",doc:"rm -rf docs/* && typedoc --out docs && cp -r images docs/",ncu:"npx npm-check-updates",lint:"tsc --noEmit && eslint src","lint:fix":"tsc --noEmit && eslint src --fix","test:watch":"vitest watch -c vite.config-test.ts --dom",test:"vitest run -c vite.config-test.ts --dom","install:clean":"rm -rf build/ dist/ node_modules/ && npm ci",dev:"npm run build-css && vite -c vite.config-dev.ts","dev-umd":"npm run build-css && tsc && NODE_ENV=development vite build -w -c vite.config-umd.ts","build-css":"mkdir -p dist build && node scripts/replace-path-with-content.js src/style/style_template.css dist/tmp_maptiler-sdk.css && cat node_modules/maplibre-gl/dist/maplibre-gl.css dist/tmp_maptiler-sdk.css > dist/maptiler-sdk.css && rm dist/tmp_maptiler-sdk.css && cp dist/maptiler-sdk.css build/maptiler-sdk.css","build-umd":"tsc && NODE_ENV=production vite build -c vite.config-umd.ts","build-es":"tsc && NODE_ENV=production vite build -c vite.config-es.ts",build:"npm run build-es; npm run build-umd; npm run build-css",make:"npm run install:clean && npm run build"},gP={"@canvas/image-data":"^1.0.0","@eslint/js":"^9.21.0","@types/color-convert":"^2.0.4","@types/color-name":"^2.0.0","@types/stats.js":"^0.17.4","@types/uuid":"^10.0.0","@types/xmldom":"^0.1.31","@vitest/web-worker":"^3.0.9","@xmldom/xmldom":"^0.8.10",concurrently:"^9.1.2",eslint:"^9.21.0","eslint-config-prettier":"^10.0.2","eslint-plugin-prettier":"^5.2.3","happy-dom":"^17.4.4",husky:"^8.0.0",jiti:"^2.4.2","lint-staged":"^15.4.3",prettier:"3.5.2","stats.js":"^0.17.0",typedoc:"^0.27.6",typescript:"^5.7.3","typescript-eslint":"^8.25.0",vite:"^6.0.7","vite-plugin-dts":"^4.5.0",vitest:"^3.0.9"},_P={"@maplibre/maplibre-gl-style-spec":"~23.3.0","@maptiler/client":"~2.5.0",events:"^3.3.0","gl-matrix":"^3.4.3","js-base64":"^3.7.7","maplibre-gl":"~5.6.0",uuid:"^11.0.5"},yP={name:tP,version:iP,description:nP,author:rP,module:oP,types:aP,style:sP,type:lP,main:cP,exports:uP,keywords:hP,homepage:pP,license:dP,repository:mP,scripts:fP,"lint-staged":{"*.ts":"npm run lint:fix"},"ts-typecheck":{"*.ts":"npm tsc --noEmit"},devDependencies:gP,dependencies:_P},y_=class{constructor(s,i=2e3){at(this,"map"),at(this,"registeredModules",new Set),this.map=s,setTimeout(()=>Be(this,null,function*(){if(!ki.telemetry)return;let p=this.preparePayload();try{(yield fetch(p,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(u){console.warn("The metrics could not be sent to MapTiler Cloud",u)}}),Math.max(1e3,i))}registerModule(s,i){this.registeredModules.add(`${s}:${i}`)}preparePayload(){let s=new URL(gr.telemetryURL);return s.searchParams.append("sdk",yP.version),s.searchParams.append("key",ki.apiKey),s.searchParams.append("mtsid",P_),s.searchParams.append("session",ki.session?"1":"0"),s.searchParams.append("caching",ki.caching?"1":"0"),s.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),s.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),s.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),this.registeredModules.size>0&&s.searchParams.append("modules",Array.from(this.registeredModules).join("|")),s.href}},Ep=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var l=0,s=arguments.length;s--;)l+=arguments[s]*arguments[s];return Math.sqrt(l)});function dp(){var l=new Ep(16);return Ep!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function vP(l,s,i,p,u,r,x,C,A,R,U,F,le,se,fe,xe,Le){return l[0]=s,l[1]=i,l[2]=p,l[3]=u,l[4]=r,l[5]=x,l[6]=C,l[7]=A,l[8]=R,l[9]=U,l[10]=F,l[11]=le,l[12]=se,l[13]=fe,l[14]=xe,l[15]=Le,l}function xP(l,s,i){var p=s[0],u=s[1],r=s[2],x=s[3],C=s[4],A=s[5],R=s[6],U=s[7],F=s[8],le=s[9],se=s[10],fe=s[11],xe=s[12],Le=s[13],Fe=s[14],$e=s[15],nt=i[0],je=i[1],ht=i[2],Et=i[3];return l[0]=nt*p+je*C+ht*F+Et*xe,l[1]=nt*u+je*A+ht*le+Et*Le,l[2]=nt*r+je*R+ht*se+Et*Fe,l[3]=nt*x+je*U+ht*fe+Et*$e,nt=i[4],je=i[5],ht=i[6],Et=i[7],l[4]=nt*p+je*C+ht*F+Et*xe,l[5]=nt*u+je*A+ht*le+Et*Le,l[6]=nt*r+je*R+ht*se+Et*Fe,l[7]=nt*x+je*U+ht*fe+Et*$e,nt=i[8],je=i[9],ht=i[10],Et=i[11],l[8]=nt*p+je*C+ht*F+Et*xe,l[9]=nt*u+je*A+ht*le+Et*Le,l[10]=nt*r+je*R+ht*se+Et*Fe,l[11]=nt*x+je*U+ht*fe+Et*$e,nt=i[12],je=i[13],ht=i[14],Et=i[15],l[12]=nt*p+je*C+ht*F+Et*xe,l[13]=nt*u+je*A+ht*le+Et*Le,l[14]=nt*r+je*R+ht*se+Et*Fe,l[15]=nt*x+je*U+ht*fe+Et*$e,l}function bP(l,s,i){var p=i[0],u=i[1],r=i[2];return l[0]=s[0]*p,l[1]=s[1]*p,l[2]=s[2]*p,l[3]=s[3]*p,l[4]=s[4]*u,l[5]=s[5]*u,l[6]=s[6]*u,l[7]=s[7]*u,l[8]=s[8]*r,l[9]=s[9]*r,l[10]=s[10]*r,l[11]=s[11]*r,l[12]=s[12],l[13]=s[13],l[14]=s[14],l[15]=s[15],l}function Nx(l,s,i){var p=Math.sin(i),u=Math.cos(i),r=s[4],x=s[5],C=s[6],A=s[7],R=s[8],U=s[9],F=s[10],le=s[11];return s!==l&&(l[0]=s[0],l[1]=s[1],l[2]=s[2],l[3]=s[3],l[12]=s[12],l[13]=s[13],l[14]=s[14],l[15]=s[15]),l[4]=r*u+R*p,l[5]=x*u+U*p,l[6]=C*u+F*p,l[7]=A*u+le*p,l[8]=R*u-r*p,l[9]=U*u-x*p,l[10]=F*u-C*p,l[11]=le*u-A*p,l}function wP(l,s,i){var p=Math.sin(i),u=Math.cos(i),r=s[0],x=s[1],C=s[2],A=s[3],R=s[8],U=s[9],F=s[10],le=s[11];return s!==l&&(l[4]=s[4],l[5]=s[5],l[6]=s[6],l[7]=s[7],l[12]=s[12],l[13]=s[13],l[14]=s[14],l[15]=s[15]),l[0]=r*u-R*p,l[1]=x*u-U*p,l[2]=C*u-F*p,l[3]=A*u-le*p,l[8]=r*p+R*u,l[9]=x*p+U*u,l[10]=C*p+F*u,l[11]=A*p+le*u,l}function Vx(l,s,i){var p=Math.sin(i),u=Math.cos(i),r=s[0],x=s[1],C=s[2],A=s[3],R=s[4],U=s[5],F=s[6],le=s[7];return s!==l&&(l[8]=s[8],l[9]=s[9],l[10]=s[10],l[11]=s[11],l[12]=s[12],l[13]=s[13],l[14]=s[14],l[15]=s[15]),l[0]=r*u+R*p,l[1]=x*u+U*p,l[2]=C*u+F*p,l[3]=A*u+le*p,l[4]=R*u-r*p,l[5]=U*u-x*p,l[6]=F*u-C*p,l[7]=le*u-A*p,l}function SP(l,s,i,p,u){var r=1/Math.tan(s/2),x;return l[0]=r/i,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,u!=null&&u!==1/0?(x=1/(p-u),l[10]=(u+p)*x,l[14]=2*u*p*x):(l[10]=-1,l[14]=-2*p),l}var IP=SP;function Em(){var l=new Ep(3);return Ep!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function TP(l,s,i){var p=new Ep(3);return p[0]=l,p[1]=s,p[2]=i,p}function P0(l,s){var i=s[0],p=s[1],u=s[2],r=i*i+p*p+u*u;return r>0&&(r=1/Math.sqrt(r)),l[0]=s[0]*r,l[1]=s[1]*r,l[2]=s[2]*r,l}function $x(l,s,i){var p=s[0],u=s[1],r=s[2],x=i[0],C=i[1],A=i[2];return l[0]=u*A-r*C,l[1]=r*x-p*A,l[2]=p*C-u*x,l}(function(){var l=Em();return function(s,i,p,u,r,x){var C,A;for(i||(i=3),p||(p=0),u?A=Math.min(u*i+p,s.length):A=s.length,C=p;C<A;C+=i)l[0]=s[C],l[1]=s[C+1],l[2]=s[C+2],r(l,l,x),s[C]=l[0],s[C+1]=l[1],s[C+2]=l[2];return s}})();function CP(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Gx,qx;function PP(){return qx||(qx=1,Gx={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),Gx}var M0,Wx;function Kb(){if(Wx)return M0;Wx=1;let l=PP(),s={};for(let u of Object.keys(l))s[l[u]]=u;let i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};M0=i;for(let u of Object.keys(i)){if(!("channels"in i[u]))throw new Error("missing channels property: "+u);if(!("labels"in i[u]))throw new Error("missing channel labels property: "+u);if(i[u].labels.length!==i[u].channels)throw new Error("channel and label counts mismatch: "+u);let{channels:r,labels:x}=i[u];delete i[u].channels,delete i[u].labels,Object.defineProperty(i[u],"channels",{value:r}),Object.defineProperty(i[u],"labels",{value:x})}i.rgb.hsl=function(u){let r=u[0]/255,x=u[1]/255,C=u[2]/255,A=Math.min(r,x,C),R=Math.max(r,x,C),U=R-A,F,le;R===A?F=0:r===R?F=(x-C)/U:x===R?F=2+(C-r)/U:C===R&&(F=4+(r-x)/U),F=Math.min(F*60,360),F<0&&(F+=360);let se=(A+R)/2;return R===A?le=0:se<=.5?le=U/(R+A):le=U/(2-R-A),[F,le*100,se*100]},i.rgb.hsv=function(u){let r,x,C,A,R,U=u[0]/255,F=u[1]/255,le=u[2]/255,se=Math.max(U,F,le),fe=se-Math.min(U,F,le),xe=function(Le){return(se-Le)/6/fe+1/2};return fe===0?(A=0,R=0):(R=fe/se,r=xe(U),x=xe(F),C=xe(le),U===se?A=C-x:F===se?A=1/3+r-C:le===se&&(A=2/3+x-r),A<0?A+=1:A>1&&(A-=1)),[A*360,R*100,se*100]},i.rgb.hwb=function(u){let r=u[0],x=u[1],C=u[2],A=i.rgb.hsl(u)[0],R=1/255*Math.min(r,Math.min(x,C));return C=1-1/255*Math.max(r,Math.max(x,C)),[A,R*100,C*100]},i.rgb.cmyk=function(u){let r=u[0]/255,x=u[1]/255,C=u[2]/255,A=Math.min(1-r,1-x,1-C),R=(1-r-A)/(1-A)||0,U=(1-x-A)/(1-A)||0,F=(1-C-A)/(1-A)||0;return[R*100,U*100,F*100,A*100]};function p(u,r){return(u[0]-r[0])**2+(u[1]-r[1])**2+(u[2]-r[2])**2}return i.rgb.keyword=function(u){let r=s[u];if(r)return r;let x=1/0,C;for(let A of Object.keys(l)){let R=l[A],U=p(u,R);U<x&&(x=U,C=A)}return C},i.keyword.rgb=function(u){return l[u]},i.rgb.xyz=function(u){let r=u[0]/255,x=u[1]/255,C=u[2]/255;r=r>.04045?((r+.055)/1.055)**2.4:r/12.92,x=x>.04045?((x+.055)/1.055)**2.4:x/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92;let A=r*.4124+x*.3576+C*.1805,R=r*.2126+x*.7152+C*.0722,U=r*.0193+x*.1192+C*.9505;return[A*100,R*100,U*100]},i.rgb.lab=function(u){let r=i.rgb.xyz(u),x=r[0],C=r[1],A=r[2];x/=95.047,C/=100,A/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,A=A>.008856?A**(1/3):7.787*A+16/116;let R=116*C-16,U=500*(x-C),F=200*(C-A);return[R,U,F]},i.hsl.rgb=function(u){let r=u[0]/360,x=u[1]/100,C=u[2]/100,A,R,U;if(x===0)return U=C*255,[U,U,U];C<.5?A=C*(1+x):A=C+x-C*x;let F=2*C-A,le=[0,0,0];for(let se=0;se<3;se++)R=r+1/3*-(se-1),R<0&&R++,R>1&&R--,6*R<1?U=F+(A-F)*6*R:2*R<1?U=A:3*R<2?U=F+(A-F)*(2/3-R)*6:U=F,le[se]=U*255;return le},i.hsl.hsv=function(u){let r=u[0],x=u[1]/100,C=u[2]/100,A=x,R=Math.max(C,.01);C*=2,x*=C<=1?C:2-C,A*=R<=1?R:2-R;let U=(C+x)/2,F=C===0?2*A/(R+A):2*x/(C+x);return[r,F*100,U*100]},i.hsv.rgb=function(u){let r=u[0]/60,x=u[1]/100,C=u[2]/100,A=Math.floor(r)%6,R=r-Math.floor(r),U=255*C*(1-x),F=255*C*(1-x*R),le=255*C*(1-x*(1-R));switch(C*=255,A){case 0:return[C,le,U];case 1:return[F,C,U];case 2:return[U,C,le];case 3:return[U,F,C];case 4:return[le,U,C];case 5:return[C,U,F]}},i.hsv.hsl=function(u){let r=u[0],x=u[1]/100,C=u[2]/100,A=Math.max(C,.01),R,U;U=(2-x)*C;let F=(2-x)*A;return R=x*A,R/=F<=1?F:2-F,R=R||0,U/=2,[r,R*100,U*100]},i.hwb.rgb=function(u){let r=u[0]/360,x=u[1]/100,C=u[2]/100,A=x+C,R;A>1&&(x/=A,C/=A);let U=Math.floor(6*r),F=1-C;R=6*r-U,U&1&&(R=1-R);let le=x+R*(F-x),se,fe,xe;switch(U){default:case 6:case 0:se=F,fe=le,xe=x;break;case 1:se=le,fe=F,xe=x;break;case 2:se=x,fe=F,xe=le;break;case 3:se=x,fe=le,xe=F;break;case 4:se=le,fe=x,xe=F;break;case 5:se=F,fe=x,xe=le;break}return[se*255,fe*255,xe*255]},i.cmyk.rgb=function(u){let r=u[0]/100,x=u[1]/100,C=u[2]/100,A=u[3]/100,R=1-Math.min(1,r*(1-A)+A),U=1-Math.min(1,x*(1-A)+A),F=1-Math.min(1,C*(1-A)+A);return[R*255,U*255,F*255]},i.xyz.rgb=function(u){let r=u[0]/100,x=u[1]/100,C=u[2]/100,A,R,U;return A=r*3.2406+x*-1.5372+C*-.4986,R=r*-.9689+x*1.8758+C*.0415,U=r*.0557+x*-.204+C*1.057,A=A>.0031308?1.055*A**(1/2.4)-.055:A*12.92,R=R>.0031308?1.055*R**(1/2.4)-.055:R*12.92,U=U>.0031308?1.055*U**(1/2.4)-.055:U*12.92,A=Math.min(Math.max(0,A),1),R=Math.min(Math.max(0,R),1),U=Math.min(Math.max(0,U),1),[A*255,R*255,U*255]},i.xyz.lab=function(u){let r=u[0],x=u[1],C=u[2];r/=95.047,x/=100,C/=108.883,r=r>.008856?r**(1/3):7.787*r+16/116,x=x>.008856?x**(1/3):7.787*x+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;let A=116*x-16,R=500*(r-x),U=200*(x-C);return[A,R,U]},i.lab.xyz=function(u){let r=u[0],x=u[1],C=u[2],A,R,U;R=(r+16)/116,A=x/500+R,U=R-C/200;let F=R**3,le=A**3,se=U**3;return R=F>.008856?F:(R-16/116)/7.787,A=le>.008856?le:(A-16/116)/7.787,U=se>.008856?se:(U-16/116)/7.787,A*=95.047,R*=100,U*=108.883,[A,R,U]},i.lab.lch=function(u){let r=u[0],x=u[1],C=u[2],A;A=Math.atan2(C,x)*360/2/Math.PI,A<0&&(A+=360);let R=Math.sqrt(x*x+C*C);return[r,R,A]},i.lch.lab=function(u){let r=u[0],x=u[1],C=u[2]/360*2*Math.PI,A=x*Math.cos(C),R=x*Math.sin(C);return[r,A,R]},i.rgb.ansi16=function(u,r=null){let[x,C,A]=u,R=r===null?i.rgb.hsv(u)[2]:r;if(R=Math.round(R/50),R===0)return 30;let U=30+(Math.round(A/255)<<2|Math.round(C/255)<<1|Math.round(x/255));return R===2&&(U+=60),U},i.hsv.ansi16=function(u){return i.rgb.ansi16(i.hsv.rgb(u),u[2])},i.rgb.ansi256=function(u){let r=u[0],x=u[1],C=u[2];return r===x&&x===C?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(x/255*5)+Math.round(C/255*5)},i.ansi16.rgb=function(u){let r=u%10;if(r===0||r===7)return u>50&&(r+=3.5),r=r/10.5*255,[r,r,r];let x=(~~(u>50)+1)*.5,C=(r&1)*x*255,A=(r>>1&1)*x*255,R=(r>>2&1)*x*255;return[C,A,R]},i.ansi256.rgb=function(u){if(u>=232){let R=(u-232)*10+8;return[R,R,R]}u-=16;let r,x=Math.floor(u/36)/5*255,C=Math.floor((r=u%36)/6)/5*255,A=r%6/5*255;return[x,C,A]},i.rgb.hex=function(u){let r=(((Math.round(u[0])&255)<<16)+((Math.round(u[1])&255)<<8)+(Math.round(u[2])&255)).toString(16).toUpperCase();return"000000".substring(r.length)+r},i.hex.rgb=function(u){let r=u.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!r)return[0,0,0];let x=r[0];r[0].length===3&&(x=x.split("").map(F=>F+F).join(""));let C=parseInt(x,16),A=C>>16&255,R=C>>8&255,U=C&255;return[A,R,U]},i.rgb.hcg=function(u){let r=u[0]/255,x=u[1]/255,C=u[2]/255,A=Math.max(Math.max(r,x),C),R=Math.min(Math.min(r,x),C),U=A-R,F,le;return U<1?F=R/(1-U):F=0,U<=0?le=0:A===r?le=(x-C)/U%6:A===x?le=2+(C-r)/U:le=4+(r-x)/U,le/=6,le%=1,[le*360,U*100,F*100]},i.hsl.hcg=function(u){let r=u[1]/100,x=u[2]/100,C=x<.5?2*r*x:2*r*(1-x),A=0;return C<1&&(A=(x-.5*C)/(1-C)),[u[0],C*100,A*100]},i.hsv.hcg=function(u){let r=u[1]/100,x=u[2]/100,C=r*x,A=0;return C<1&&(A=(x-C)/(1-C)),[u[0],C*100,A*100]},i.hcg.rgb=function(u){let r=u[0]/360,x=u[1]/100,C=u[2]/100;if(x===0)return[C*255,C*255,C*255];let A=[0,0,0],R=r%1*6,U=R%1,F=1-U,le=0;switch(Math.floor(R)){case 0:A[0]=1,A[1]=U,A[2]=0;break;case 1:A[0]=F,A[1]=1,A[2]=0;break;case 2:A[0]=0,A[1]=1,A[2]=U;break;case 3:A[0]=0,A[1]=F,A[2]=1;break;case 4:A[0]=U,A[1]=0,A[2]=1;break;default:A[0]=1,A[1]=0,A[2]=F}return le=(1-x)*C,[(x*A[0]+le)*255,(x*A[1]+le)*255,(x*A[2]+le)*255]},i.hcg.hsv=function(u){let r=u[1]/100,x=u[2]/100,C=r+x*(1-r),A=0;return C>0&&(A=r/C),[u[0],A*100,C*100]},i.hcg.hsl=function(u){let r=u[1]/100,x=u[2]/100*(1-r)+.5*r,C=0;return x>0&&x<.5?C=r/(2*x):x>=.5&&x<1&&(C=r/(2*(1-x))),[u[0],C*100,x*100]},i.hcg.hwb=function(u){let r=u[1]/100,x=u[2]/100,C=r+x*(1-r);return[u[0],(C-r)*100,(1-C)*100]},i.hwb.hcg=function(u){let r=u[1]/100,x=1-u[2]/100,C=x-r,A=0;return C<1&&(A=(x-C)/(1-C)),[u[0],C*100,A*100]},i.apple.rgb=function(u){return[u[0]/65535*255,u[1]/65535*255,u[2]/65535*255]},i.rgb.apple=function(u){return[u[0]/255*65535,u[1]/255*65535,u[2]/255*65535]},i.gray.rgb=function(u){return[u[0]/100*255,u[0]/100*255,u[0]/100*255]},i.gray.hsl=function(u){return[0,0,u[0]]},i.gray.hsv=i.gray.hsl,i.gray.hwb=function(u){return[0,100,u[0]]},i.gray.cmyk=function(u){return[0,0,0,u[0]]},i.gray.lab=function(u){return[u[0],0,0]},i.gray.hex=function(u){let r=Math.round(u[0]/100*255)&255,x=((r<<16)+(r<<8)+r).toString(16).toUpperCase();return"000000".substring(x.length)+x},i.rgb.gray=function(u){return[(u[0]+u[1]+u[2])/3/255*100]},M0}var E0,Zx;function MP(){if(Zx)return E0;Zx=1;let l=Kb();function s(){let r={},x=Object.keys(l);for(let C=x.length,A=0;A<C;A++)r[x[A]]={distance:-1,parent:null};return r}function i(r){let x=s(),C=[r];for(x[r].distance=0;C.length;){let A=C.pop(),R=Object.keys(l[A]);for(let U=R.length,F=0;F<U;F++){let le=R[F],se=x[le];se.distance===-1&&(se.distance=x[A].distance+1,se.parent=A,C.unshift(le))}}return x}function p(r,x){return function(C){return x(r(C))}}function u(r,x){let C=[x[r].parent,r],A=l[x[r].parent][r],R=x[r].parent;for(;x[R].parent;)C.unshift(x[R].parent),A=p(l[x[R].parent][R],A),R=x[R].parent;return A.conversion=C,A}return E0=function(r){let x=i(r),C={},A=Object.keys(x);for(let R=A.length,U=0;U<R;U++){let F=A[U];x[F].parent!==null&&(C[F]=u(F,x))}return C},E0}var A0,Hx;function EP(){if(Hx)return A0;Hx=1;let l=Kb(),s=MP(),i={},p=Object.keys(l);function u(x){let C=function(...A){let R=A[0];return R==null?R:(R.length>1&&(A=R),x(A))};return"conversion"in x&&(C.conversion=x.conversion),C}function r(x){let C=function(...A){let R=A[0];if(R==null)return R;R.length>1&&(A=R);let U=x(A);if(typeof U=="object")for(let F=U.length,le=0;le<F;le++)U[le]=Math.round(U[le]);return U};return"conversion"in x&&(C.conversion=x.conversion),C}return p.forEach(x=>{i[x]={},Object.defineProperty(i[x],"channels",{value:l[x].channels}),Object.defineProperty(i[x],"labels",{value:l[x].labels});let C=s(x);Object.keys(C).forEach(A=>{let R=C[A];i[x][A]=r(R),i[x][A].raw=u(R)})}),A0=i,A0}var AP=EP(),kP=CP(AP);function Kx({gl:l,type:s,source:i}){let p=l.createShader(s);if(p===null)throw new Error("Cannot create shader");if(l.shaderSource(p,i),l.compileShader(p),!l.getShaderParameter(p,l.COMPILE_STATUS))throw console.error("Shader compilation error:",l.getShaderInfoLog(p)),l.deleteShader(p),new Error("Cannot compile shader");return p}function LP({gl:l,vertexShaderSource:s,fragmentShaderSource:i}){let p=Kx({gl:l,type:l.VERTEX_SHADER,source:s}),u=Kx({gl:l,type:l.FRAGMENT_SHADER,source:i}),r=l.createProgram();if(l.attachShader(r,p),l.attachShader(r,u),l.linkProgram(r),!l.getProgramParameter(r,l.LINK_STATUS))throw console.error("Error: ",l.getProgramInfoLog(r)),new Error("Cannot link shader program");return r}function DP(l,s,i){let p=l.getUniformLocation(s,i);if(p===null)throw new Error(`Cannot get uniform location for ${i}`);return p}function Xb({gl:l,vertexShaderSource:s,fragmentShaderSource:i,attributesKeys:p,uniformsKeys:u,vertices:r,indices:x}){let C=LP({gl:l,vertexShaderSource:s,fragmentShaderSource:i}),A=p.reduce((se,fe)=>(se[fe]=l.getAttribLocation(C,`a_${fe}`),se),{}),R=u.reduce((se,fe)=>(se[fe]=DP(l,C,`u_${fe}`),se),{}),U=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,U),l.bufferData(l.ARRAY_BUFFER,new Float32Array(r),l.STATIC_DRAW);let F,le;return x!==void 0&&(F=l.createBuffer(),le=x.length,l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,F),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(x),l.STATIC_DRAW)),{shaderProgram:C,programInfo:{attributesLocations:A,uniformsLocations:R},positionBuffer:U,indexBuffer:F,indexBufferLength:le}}function Am(l){if(!l)return[1,1,1,0];if(l==="transparent")return[1,1,1,0];try{let s=RP(l),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(s);if(i!=null&&i.length){let u=!!i[4];return[...kP.hex.rgb(s).map(r=>r/255),u?parseInt(i[4],16)/255:1]}let p=s.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(s.includes("rgb")){let u=s.includes("rgba"),r=[...p.map(x=>parseFloat(x)).map((x,C)=>C<3?x/255:x)];return u||r.push(1),r}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${l} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}var sp;function RP(l){return sp=sp??document.createElement("canvas").getContext("2d"),sp?(sp.fillStyle=l,sp.fillStyle):"#000000"}var B_=1,wo=B_/2,So=B_/2,Io=B_/2,zP=[-.5,-.5,Io,wo,-.5,Io,wo,So,Io,-.5,So,Io],OP=[-.5,-.5,-.5,-.5,So,-.5,wo,So,-.5,wo,-.5,-.5],FP=[-.5,So,-.5,-.5,So,Io,wo,So,Io,wo,So,-.5],BP=[-.5,-.5,-.5,wo,-.5,-.5,wo,-.5,Io,-.5,-.5,Io],jP=[wo,-.5,-.5,wo,So,-.5,wo,So,Io,wo,-.5,Io],UP=[-.5,-.5,-.5,-.5,-.5,Io,-.5,So,Io,-.5,So,-.5],NP=[...zP,...OP,...FP,...BP,...jP,...UP],VP=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],$P=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,Xx=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,Jb=(l=>(l.UNIVERSE_DARK="universe-dark",l))(Jb||{}),Js={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}},Hs=(l=>(l.POSITIVE_X="pX",l.NEGATIVE_X="nX",l.POSITIVE_Y="pY",l.NEGATIVE_Y="nY",l.POSITIVE_Z="pZ",l.NEGATIVE_Z="nZ",l))(Hs||{}),Tm,Jx,Yx;function GP({gl:l,faces:s,onReady:i,forceRefresh:p}){Tm&&!p&&Yx===JSON.stringify(s)&&i(Tm,Jx),Yx=JSON.stringify(s);let u=Tm??l.createTexture();if(l.bindTexture(l.TEXTURE_CUBE_MAP,u),!s){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}let r=Object.keys(s).length;if(r!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${r}`);return}let x=Object.entries(s).map(([C,A])=>new Promise((R,U)=>{let F=C;if(A===void 0){U(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${C} is undefined`));return}let le=new Image;le.crossOrigin="anonymous";let se=()=>{R({image:le,key:F})};le.src=A,le.complete&&le.naturalWidth>0?se():le.onload=se,le.onerror=()=>{U(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${A}`))}}));Promise.all(x).then(C=>{for(let R=0;R<C.length;R++){let U=l.RGBA,F=l.RGBA,le=l.UNSIGNED_BYTE,{image:se,key:fe}=C[R]??{};if(!se||!fe){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}let xe=qP(l,fe);l.bindTexture(l.TEXTURE_CUBE_MAP,u),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(xe,0,U,F,le,se)}l.bindTexture(l.TEXTURE_CUBE_MAP,u),l.generateMipmap(l.TEXTURE_CUBE_MAP),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.LINEAR_MIPMAP_LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR);let A=C.map(R=>R.image);i(u,A),Jx=A,Tm=u}).catch(C=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",C)})}function qP(l,s){if(s===Hs.POSITIVE_X)return l.TEXTURE_CUBE_MAP_POSITIVE_X;if(s===Hs.NEGATIVE_X)return l.TEXTURE_CUBE_MAP_NEGATIVE_X;if(s===Hs.POSITIVE_Y)return l.TEXTURE_CUBE_MAP_POSITIVE_Y;if(s===Hs.NEGATIVE_Y)return l.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(s===Hs.POSITIVE_Z)return l.TEXTURE_CUBE_MAP_POSITIVE_Z;if(s===Hs.NEGATIVE_Z)return l.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${s}`)}function WP(l,s,i){return[Xs(l[0],s[0],i),Xs(l[1],s[1],i),Xs(l[2],s[2],i),Xs(l[3],s[3],i)]}function Xs(l,s,i){return l+(s-l)*i}var Pu="https://api.maptiler.com/resources/space",ZP=["vertexPosition"],HP=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],Qx="%USE_TEXTURE_MACRO_MARKER%",KP="#define USE_TEXTURE",XP=Js.stars;function JP(l,s){if(!Yb(l))return{color:"transparent"};if(l===!0)return s;let i=Xt({},l);if(l.faces||l.path)return delete i.preset,i;let p=l.preset;if(p!==void 0&&!(p in Js))throw new Error(`[CubemapLayer]: Invalid preset "${p}". Available presets: ${Object.keys(Js).join(", ")}`);return ha(Xt({},i),{color:i.color??Js[p].color??"hsl(233,100%,92%)"})}var Lu=class{constructor(s){at(this,"id","Cubemap Layer"),at(this,"type","custom"),at(this,"renderingMode","3d"),at(this,"map"),at(this,"faces"),at(this,"useCubemapTexture",!0),at(this,"currentFadeOpacity",0),at(this,"cubeMapNeedsUpdate",!1),at(this,"bgColor"),at(this,"previousBgColor",[0,0,0,0]),at(this,"targetBgColor",[0,0,0,0]),at(this,"transitionDelta",0),at(this,"gl"),at(this,"cubemap"),at(this,"texture"),at(this,"currentFacesDefinitionKey",""),at(this,"options"),at(this,"imageIsAnimating",!1),at(this,"imageFadeInDelta",0);let i=JP(s,XP);this.options=i,this.currentFacesDefinitionKey=JSON.stringify(i.faces??i.preset??i.path),this.bgColor=[0,0,0,0],this.targetBgColor=Am(i.color),this.faces=eb(i),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:s}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;let i=HP.filter(p=>p==="cubeSampler"||p==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=Xb({gl:this.gl,vertexShaderSource:$P,fragmentShaderSource:this.useCubemapTexture?Xx.replace(Qx,KP):Xx.replace(Qx,""),attributesKeys:ZP,uniformsKeys:i,vertices:NP,indices:VP}),this.cubeMapNeedsUpdate=s,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(s,i){this.map=s,this.gl=i,this.updateCubemap()}onRemove(s,i){this.cubemap&&(i.deleteProgram(this.cubemap.shaderProgram),i.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(s,i){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;GP({gl:s,faces:i,onReady:p=>{this.texture=p,this.animateIn()}})}}prerender(s,i){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){let s=()=>{this.transitionDelta<1&&(requestAnimationFrame(s),this.bgColor=WP(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(s)}animateIn(){if(this.imageIsAnimating)return;this.imageIsAnimating=!0;let s=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Xs(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(s);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0};requestAnimationFrame(s)}animateOut(){return this.imageIsAnimating?Promise.resolve():new Promise(s=>{let i=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Xs(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,s();return}requestAnimationFrame(i)};requestAnimationFrame(i)})}render(s,i){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.DST_ALPHA),s.useProgram(this.cubemap.shaderProgram),s.bindBuffer(s.ARRAY_BUFFER,this.cubemap.positionBuffer),s.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,s.FLOAT,!1,0,0),s.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);let p=.1,u=1e4,r=s.canvas,x=r.clientWidth/r.clientHeight,C=this.map.transform,A=C.fov*(Math.PI/180),R=dp();IP(R,A,x,p,u),Vx(R,R,C.rollInRadians),Nx(R,R,-C.pitchInRadians),Vx(R,R,C.bearingInRadians);let U=C.center.lat*Math.PI/180,F=C.center.lng*Math.PI/180;Nx(R,R,U),wP(R,R,-F),s.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,R);let le=dp();if(s.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,le),s.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),s.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,this.texture),s.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),s.drawElements(s.TRIANGLES,this.cubemap.indexBufferLength,s.UNSIGNED_SHORT,0)}setBgColor(s){this.targetBgColor=s,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}setCubemapFaces(s){return Be(this,null,function*(){if(yield this.animateOut(),!s.faces&&!s.preset&&!s.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",this.animateIn();return}this.faces=eb(s),this.currentFacesDefinitionKey=JSON.stringify(s.faces??s.preset??s.path)})}setCubemap(s){return Be(this,null,function*(){this.options=s;let i=JSON.stringify(s.faces??s.preset??s.path),p=this.currentFacesDefinitionKey!==i;p&&(yield this.setCubemapFaces(s),this.cubeMapNeedsUpdate=!0);let u=Am(s.color);if(s.color&&this.targetBgColor.toString()!==u.toString())this.setBgColor(u);else if(!s.color&&s.preset&&s.preset in Js){let r=Js[s.preset];this.setBgColor(Am(r.color))}this.updateCubemap({facesNeedUpdate:p})})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function Yb(l){return typeof l=="boolean"?!0:!(!l.path&&!l.preset&&!l.faces&&!l.color||l.preset&&!(l.preset in Js)||l.faces&&(!l.faces.pX||!l.faces.nX||!l.faces.pY||!l.faces.nY||!l.faces.pZ||!l.faces.nZ))}function eb(l){if(l.faces)return l.faces;if(l.preset)return{pX:`${Pu}/${l.preset}/px.webp`,nX:`${Pu}/${l.preset}/nx.webp`,pY:`${Pu}/${l.preset}/py.webp`,nY:`${Pu}/${l.preset}/ny.webp`,pZ:`${Pu}/${l.preset}/pz.webp`,nZ:`${Pu}/${l.preset}/nz.webp`};if(l.path){let s=l.path.baseUrl,i=l.path.format??"png";return{pX:`${s}/px.${i}`,nX:`${s}/nx.${i}`,pY:`${s}/py.${i}`,nY:`${s}/ny.${i}`,pZ:`${s}/pz.${i}`,nZ:`${s}/nz.${i}`}}return null}var YP=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,QP=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

vec2 center = vec2(0.0, 0.0);
// TODO: We could look at implementing a color ramp instead.
// Render the color ramp to a canvas and then to a texture
// then select the color based on the distance from the center.
void main() {

  // QUASI SUCCESS
  // float distanceFromGlobeEdge = (distance(center, v_pos) - 2.0) / (sqrt(v_scale) * 1.05) + 1.0;
  // ORIGINAL
  // float distanceFromGlobeEdge = distance(center, v_pos) - 1.0; 
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastScaledStopPosition = u_stops[i - 1] * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,cp=2,eM=["position"],tM=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],iM=[-2,-2,0,cp,-2,0,-2,cp,0,cp,cp,0],lp={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},tb=.06,Du=class{constructor(s){if(at(this,"id","Halo Layer"),at(this,"type","custom"),at(this,"renderingMode","3d"),at(this,"gradient"),at(this,"scale",0),at(this,"animationDelta",0),at(this,"map"),at(this,"plane"),typeof s=="boolean"){this.gradient=lp;return}this.gradient=Xt(Xt({},lp),s)}onAdd(s,i){this.map=s,this.plane=Xb({gl:i,vertexShaderSource:YP,fragmentShaderSource:QP,attributesKeys:eM,uniformsKeys:tM,vertices:iM}),this.animateIn()}getConfig(){return this.gradient}animateIn(){return Be(this,null,function*(){return new Promise(s=>{this.animationDelta=0;let i=()=>{if(this.animationDelta<1){this.scale=Xs(0,this.gradient.scale,this.animationDelta),this.animationDelta+=tb,this.map.triggerRepaint(),requestAnimationFrame(i);return}s()};i()})})}animateOut(){return Be(this,null,function*(){return this.animationDelta=0,new Promise(s=>{let i=()=>{if(this.animationDelta<1){this.scale=Xs(this.gradient.scale,0,this.animationDelta),this.animationDelta+=tb,this.map.triggerRepaint(),requestAnimationFrame(i);return}s()};i()})})}onRemove(s,i){this.plane!==void 0&&(i.deleteProgram(this.plane.shaderProgram),i.deleteBuffer(this.plane.positionBuffer))}prerender(s,i){}render(s,i){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.useProgram(this.plane.shaderProgram),s.bindBuffer(s.ARRAY_BUFFER,this.plane.positionBuffer);let p=this.plane.programInfo.attributesLocations.position;s.enableVertexAttribArray(p),s.vertexAttribPointer(p,3,s.FLOAT,!1,0,0);let u=dp(),r=this.scale;bP(u,u,[r,r,r]);let x=dp();xP(x,i.defaultProjectionData.mainMatrix,u);let C=this.plane.programInfo.uniformsLocations.matrix;s.uniformMatrix4fv(C,!1,x);let A=dp(),R=this.map.transform.cameraPosition,U=P0(Em(),R),F=TP(0,1,0),le=Em();$x(le,F,U),P0(le,le);let se=Em();$x(se,U,le),P0(se,se),vP(A,le[0],le[1],le[2],0,se[0],se[1],se[2],0,U[0],U[1],U[2],0,0,0,0,1);let fe=this.plane.programInfo.uniformsLocations.rotationMatrix;s.uniformMatrix4fv(fe,!1,A);let xe=this.gradient.stops.length,Le=[],Fe=[];for(let $e=0;$e<=xe;$e++)if($e<xe){Le[$e]=this.gradient.stops[$e][0];let nt=Am(this.gradient.stops[$e][1]);Fe.push(...nt)}s.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,xe),s.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(Le)),s.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(Fe)),s.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,cp),s.uniform1f(this.plane.programInfo.uniformsLocations.scale,r),s.drawArrays(s.TRIANGLE_STRIP,0,4)}setGradient(s){return Be(this,null,function*(){if(yield this.animateOut(),!nM(s)){this.gradient.scale=lp.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}this.gradient.scale=s.scale??lp.scale,this.gradient.stops=s.stops??lp.stops,yield this.animateIn()})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function nM(l){return typeof l=="boolean"?!0:!(typeof l.scale!="number"||!l.stops||l.stops.length===0||l.stops.some(s=>typeof s[0]!="number"||typeof s[1]!="string"))}var Qb={POINT:"POINT",COUNTRY:"COUNTRY"},vf=class ew extends gt.default.Map{constructor(s){kI(s.container),s.apiKey&&(ki.apiKey=s.apiKey);let{style:i,requiresUrlMonitoring:p,isFallback:u}=Bx(s.style);u&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),ki.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");let r=location.hash,x={compact:!1};s.customAttribution?x.customAttribution=s.customAttribution:s.attributionControl&&typeof s.attributionControl=="object"&&(x=Xt(Xt({},x),s.attributionControl));let C=ha(Xt({},s),{style:i,maplibreLogo:!1,transformRequest:yx(s.transformRequest),attributionControl:s.forceNoAttributionControl===!0?!1:x});delete C.style,super(C),at(this,"telemetry"),at(this,"space"),at(this,"halo"),at(this,"options"),at(this,"isTerrainEnabled",!1),at(this,"terrainExaggeration",1),at(this,"primaryLanguage"),at(this,"terrainGrowing",!1),at(this,"terrainFlattening",!1),at(this,"minimap"),at(this,"forceLanguageUpdate"),at(this,"languageAlwaysBeenStyle"),at(this,"isReady",!1),at(this,"terrainAnimationDuration",1e3),at(this,"monitoredStyleUrls"),at(this,"styleInProcess",!1),at(this,"curentProjection"),at(this,"originalLabelStyle",new window.Map),at(this,"isStyleLocalized",!1),at(this,"languageIsUpdated",!1),at(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=s,this.setStyle(i),p&&this.monitorStyleUrl(i);let A=()=>{let se="The distant style could not be loaded.";this.getStyle()?se+="Leaving the style as is.":(this.setStyle(_o.STREETS),se+=`Loading default MapTiler Cloud style "${_o.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(se)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",se=>{if(se.error instanceof gt.default.AJAXError){let fe=se.error.url,xe=new URL(fe);xe.search="";let Le=xe.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Le)&&(this.monitoredStyleUrls.delete(Le),A());return}if(this.styleInProcess){A();return}}),ki.caching&&!R0&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),ki.caching&&R0&&PI(),typeof s.language>"u")this.primaryLanguage=ki.primaryLanguage;else{let se=Wl(s.language,ei);this.primaryLanguage=se??ki.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===ei.STYLE||this.primaryLanguage===ei.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===ei.STYLE,this.terrainExaggeration=s.terrainExaggeration??this.terrainExaggeration,this.curentProjection=s.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",()=>Be(this,null,function*(){if(!s.geolocate||s.center||s.hash&&r)return;try{if(s.geolocate===Qb.COUNTRY){yield this.fitToIpBounds();return}}catch(fe){console.warn(fe.message)}let se;try{yield this.centerOnIpPoint(s.zoom),se=this.getCameraHash()}catch(fe){console.warn(fe.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(fe=>{se===this.getCameraHash()&&(this.terrain?this.easeTo({center:[fe.coords.longitude,fe.coords.latitude],zoom:s.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[fe.coords.longitude,fe.coords.latitude],zoom:s.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>Be(this,null,function*(){let se={logo:null};try{let fe=Object.keys(this.style.sourceCaches).map(Le=>this.getSource(Le)).filter(Le=>Le&&"url"in Le&&typeof Le.url=="string"&&Le.url.includes("tiles.json")),xe=new URL(fe[0].url);xe.searchParams.has("key")||xe.searchParams.append("key",ki.apiKey),se=yield(yield fetch(xe.href)).json()}catch{}if(s.forceNoAttributionControl!==!0)if("logo"in se&&se.logo){let fe=se.logo;this.addControl(new fp({logoURL:fe}),s.logoPosition)}else s.maptilerLogo&&this.addControl(new fp,s.logoPosition);if(s.scaleControl){let fe=s.scaleControl===!0||s.scaleControl===void 0?"bottom-right":s.scaleControl,xe=new zm({unit:ki.unit});this.addControl(xe,fe),ki.on("unit",Le=>{xe.setUnit(Le)})}if(s.navigationControl!==!1){let fe=s.navigationControl===!0||s.navigationControl===void 0?"top-right":s.navigationControl;this.addControl(new tf,fe)}if(s.geolocateControl!==!1){let fe=s.geolocateControl===!0||s.geolocateControl===void 0?"top-right":s.geolocateControl;this.addControl(new nf({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),fe)}if(s.terrainControl){let fe=s.terrainControl===!0||s.terrainControl===void 0?"top-right":s.terrainControl;this.addControl(new ef,fe)}if(s.projectionControl){let fe=s.projectionControl===!0||s.projectionControl===void 0?"top-right":s.projectionControl;this.addControl(new rf,fe)}if(s.fullscreenControl){let fe=s.fullscreenControl===!0||s.fullscreenControl===void 0?"top-right":s.fullscreenControl;this.addControl(new Om({}),fe)}this.isReady=!0,this.fire("ready",{target:this})}));let R=!1,U=!1,F;this.once("ready",()=>{R=!0,U&&this.fire("loadWithTerrain",F)}),this.once("style.load",()=>{let{minimap:se}=s;if(typeof se=="object"){let{zoom:fe,center:xe,style:Le,language:Fe,apiKey:$e,maptilerLogo:nt,canvasContextAttributes:je,refreshExpiredTiles:ht,maxBounds:Et,scrollZoom:Ui,minZoom:mi,maxZoom:On,boxZoom:In,locale:Hn,fadeDuration:To,crossSourceCollisions:Ar,clickTolerance:kr,bounds:Lr,fitBoundsOptions:es,pixelRatio:ri,validateStyle:Co}=s;this.minimap=new pp(se,{zoom:fe,center:xe,style:Le,language:Fe,apiKey:$e,container:"null",maptilerLogo:nt,canvasContextAttributes:je,refreshExpiredTiles:ht,maxBounds:Et,scrollZoom:Ui,minZoom:mi,maxZoom:On,boxZoom:In,locale:Hn,fadeDuration:To,crossSourceCollisions:Ar,clickTolerance:kr,bounds:Lr,fitBoundsOptions:es,pixelRatio:ri,validateStyle:Co}),this.addControl(this.minimap,se.position??"bottom-left")}else se===!0?(this.minimap=new pp({},s),this.addControl(this.minimap,"bottom-left")):se!==void 0&&se!==!1&&(this.minimap=new pp({},s),this.addControl(this.minimap,se))});let le=se=>{se.terrain&&(U=!0,F={type:"loadWithTerrain",target:this,terrain:se.terrain},this.off("terrain",le),R&&this.fire("loadWithTerrain",F))};this.on("terrain",le),s.terrain&&this.enableTerrain(s.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",fe=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",fe)});let se=this.getLayersOrder()[0];s.space&&this.initSpace({options:s,before:se}),s.halo&&this.initHalo({options:s,before:se})}),this.telemetry=new y_(this)}getSpace(){return this.space}setSpace(s){if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(s);return}this.space=new Lu(s),this.once("load",()=>{let i=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,i)})}}setSpaceFromStyle({style:s}){var i,p,u;let r=(p=(i=s.metadata)==null?void 0:i.maptiler)==null?void 0:p.space;if(!r){this.setSpace({color:"transparent"});return}if(!Yb(r)){this.setSpace({color:"transparent"});return}if(JSON.stringify((u=this.space)==null?void 0:u.getConfig())===JSON.stringify(r)){if(this.space&&!this.getLayer(this.space.id)){let x=this.getLayersOrder()[0];this.addLayer(this.space,x)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){let x=this.getLayersOrder()[0];this.addLayer(this.space,x)}this.space.setCubemap(r)}})()}setHaloFromStyle({style:s}){var i,p,u;let r=(i=s.metadata)==null?void 0:i.maptiler;if(JSON.stringify((p=this.halo)==null?void 0:p.getConfig())===JSON.stringify(r?.halo)){if(this.halo&&!this.getLayer(this.halo.id)){let x=this.getLayersOrder().indexOf(((u=this.space)==null?void 0:u.id)??"")+1,C=this.getLayersOrder()[x];this.addLayer(this.halo,C)}return}if(!(r!=null&&r.halo)){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var x;if(this.halo){if(!this.getLayer(this.halo.id)){let C=this.getLayersOrder().indexOf(((x=this.space)==null?void 0:x.id)??"")+1,A=this.getLayersOrder()[C];this.addLayer(this.halo,A)}this.halo.setGradient(r.halo)}})()}initSpace({options:s=this.options,before:i,spec:p}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,i);return}if(s.space===!1)return;let u=p;if(s.space){this.space=new Lu(s.space),this.addLayer(this.space,i);return}u&&(this.space=new Lu(u),this.addLayer(this.space,i))}initHalo({options:s=this.options,before:i,spec:p}){if(this.halo&&this.getLayer(this.halo.id)||s.halo===!1)return;let u=p;if(s.halo){this.halo=new Du(s.halo),this.addLayer(this.halo,i);return}u&&(this.halo=new Du(u),this.addLayer(this.halo,i))}getHalo(){return this.halo}setHalo(s){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(s);return}this.halo=new Du(s),this.once("load",()=>{var i;let p=this.getLayersOrder(),u=p[0],r=p.indexOf(((i=this.space)==null?void 0:i.id)??"")+2,x=p[r];this.halo&&this.addLayer(this.halo,this.space?x:u)})}}recreate(){let s={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new ew(Xt({},this.options))),this.once("load",()=>{this.jumpTo(s)})}setTerrainAnimationDuration(s){this.terrainAnimationDuration=Math.max(s,0)}onLoadAsync(){return Be(this,null,function*(){return new Promise(s=>{if(this.loaded()){s(this);return}this.once("load",()=>{s(this)})})})}onReadyAsync(){return Be(this,null,function*(){return new Promise(s=>{if(this.isReady){s(this);return}this.once("ready",()=>{s(this)})})})}onLoadWithTerrainAsync(){return Be(this,null,function*(){return new Promise(s=>{if(this.isReady&&this.terrain){s(this);return}this.once("loadWithTerrain",()=>{s(this)})})})}monitorStyleUrl(s){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);let i=new URL(s);i.search="",this.monitoredStyleUrls.add(i.href)}setStyle(s,i){var p,u,r,x,C;this.originalLabelStyle.clear(),(p=this.minimap)==null||p.setStyle(s),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});let A=Bx(s);if(A.requiresUrlMonitoring&&this.monitorStyleUrl(A.style),A.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}let R=this.getStyle(),U=A.style;try{super.setStyle(A.style,i),this.styleInProcess=!0}catch(se){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",se)}if(typeof A.style=="string"||A.requiresUrlMonitoring)return this;let F=()=>{let se=A.style;if(!se.projection||se.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:A.style}),this.setHaloFromStyle({style:A.style})},le=se=>{var fe,xe,Le,Fe;let $e=se?.target.getStyle()??A.style,nt=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:$e}):this.initSpace({before:nt,spec:(xe=(fe=$e.metadata)==null?void 0:fe.maptiler)==null?void 0:xe.space}),this.halo?this.setHaloFromStyle({style:$e}):this.initHalo({before:nt,spec:(Fe=(Le=$e.metadata)==null?void 0:Le.maptiler)==null?void 0:Fe.halo})};if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",le),this.once("styledata",le),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((u=R?.terrain)==null?void 0:u.source)!==((r=U?.terrain)==null?void 0:r.source)||((x=R?.terrain)==null?void 0:x.exaggeration)!==((C=U?.terrain)==null?void 0:C.exaggeration))return this.once("terrain",F),this;try{le()}catch{}return this}addLayer(s,i){var p;return(p=this.minimap)==null||p.addLayer(s,i),super.addLayer(s,i)}moveLayer(s,i){var p;return(p=this.minimap)==null||p.moveLayer(s,i),super.moveLayer(s,i)}removeLayer(s){var i;return(i=this.minimap)==null||i.removeLayer(s),super.removeLayer(s)}setLayerZoomRange(s,i,p){var u;return(u=this.minimap)==null||u.setLayerZoomRange(s,i,p),super.setLayerZoomRange(s,i,p)}setFilter(s,i,p){var u;return(u=this.minimap)==null||u.setFilter(s,i,p),super.setFilter(s,i,p)}setPaintProperty(s,i,p,u){var r;return(r=this.minimap)==null||r.setPaintProperty(s,i,p,u),super.setPaintProperty(s,i,p,u)}setLayoutProperty(s,i,p,u){var r;return(r=this.minimap)==null||r.setLayoutProperty(s,i,p,u),super.setLayoutProperty(s,i,p,u)}setGlyphs(s,i){var p;return(p=this.minimap)==null||p.setGlyphs(s,i),super.setGlyphs(s,i)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?ql(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(s){var i;(i=this.minimap)==null||i.map.setLanguage(s),this.onStyleReady(()=>{this.setPrimaryLanguage(s)})}setPrimaryLanguage(s){let i=this.getStyleLanguage(),p=Wl(s,ei);if(!p){console.warn(`The language "${p}" is not supported.`);return}if(!(p.flag===ei.STYLE.flag&&i&&(i.flag===ei.AUTO.flag||i.flag===ei.VISITOR.flag))&&(p.flag!==ei.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===p&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===ei.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=p;let u=p;if(p.flag===ei.STYLE.flag){if(!i){console.warn("The style has no default languages or has an invalid one.");return}u=i}let r=ei.LOCAL.flag,x=["get",r];u.flag===ei.VISITOR.flag?(r=k0().flag,x=["case",["all",["has",r],["has",ei.LOCAL.flag]],["case",["==",["get",r],["get",ei.LOCAL.flag]],["get",ei.LOCAL.flag],["format",["get",r],{"font-scale":.8},`
`,["get",ei.LOCAL.flag],{"font-scale":1.1}]],["get",ei.LOCAL.flag]]):u.flag===ei.VISITOR_ENGLISH.flag?(r=ei.ENGLISH.flag,x=["case",["all",["has",r],["has",ei.LOCAL.flag]],["case",["==",["get",r],["get",ei.LOCAL.flag]],["get",ei.LOCAL.flag],["format",["get",r],{"font-scale":.8},`
`,["get",ei.LOCAL.flag],{"font-scale":1.1}]],["get",ei.LOCAL.flag]]):u.flag===ei.AUTO.flag?(r=k0().flag,x=["coalesce",["get",r],["get",ei.LOCAL.flag]]):u===ei.LOCAL?(r=ei.LOCAL.flag,x=["get",r]):(r=u.flag,x=["coalesce",["get",r],["get",ei.LOCAL.flag]]);let{layers:C}=this.getStyle(),A=this.originalLabelStyle.size===0;if(A){let R=jI(C,this);this.isStyleLocalized=Object.keys(R.localized).length>0}for(let R of C){if(R.type!=="symbol")continue;let U=R,F=this.getSource(U.source);if(!F||!("url"in F&&typeof F.url=="string")||new URL(F.url).host!==gr.maptilerApiHost)continue;let{id:le,layout:se}=U;if(!se||!("text-field"in se))continue;let fe;if(A?(fe=this.getLayoutProperty(le,"text-field"),this.originalLabelStyle.set(le,fe)):fe=this.originalLabelStyle.get(le),typeof fe=="string"){let{contains:xe,exactMatch:Le}=RI(fe,this.isStyleLocalized);if(!xe)continue;if(Le)this.setLayoutProperty(le,"text-field",x);else{let Fe=zI(fe,x,this.isStyleLocalized);this.setLayoutProperty(le,"text-field",Fe)}}else{let xe=DI(fe,x,this.isStyleLocalized);this.setLayoutProperty(le,"text-field",xe)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(s){if(!this.terrain)return;let i=performance.now(),p=this.terrain.exaggeration,u=s-p,r=()=>{if(!this.terrain||this.terrainFlattening)return;let x=(performance.now()-i)/this.terrainAnimationDuration;if(x<.99){let C=1-(1-x)**4,A=p+C*u;this.terrain.exaggeration=A,requestAnimationFrame(r)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=s,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(r)}enableTerrain(s=this.terrainExaggeration){if(s<0){console.warn("Terrain exaggeration cannot be negative.");return}let i=u=>{!this.terrain||u.type!=="data"||u.dataType!=="source"||!("source"in u)||u.sourceId!=="maptiler-terrain"||u.source.type!=="raster-dem"||u.isSourceLoaded&&(this.off("data",i),this.growTerrain(s))},p=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=s,this.on("data",i),this.addSource(gr.terrainSourceId,{type:"raster-dem",url:gr.terrainSourceURL}),this.setTerrain({source:gr.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(s);return}if(this.loaded()||this.isTerrainEnabled)p();else{let u=()=>{this.getTerrain()&&this.getSource(gr.terrainSourceId)||p()};this.once("load",()=>{u()}),this.once("moveend",()=>{u()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;let s=performance.now(),i=this.terrain.exaggeration,p=()=>{if(!this.terrain||this.terrainGrowing)return;let u=(performance.now()-s)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,u<.99){let r=(1-u)**4,x=i*r;this.terrain.exaggeration=x,requestAnimationFrame(p)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(gr.terrainSourceId)&&this.removeSource(gr.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(p)}setTerrainExaggeration(s,i=!0){!i&&this.terrain?(this.terrainExaggeration=s,this.terrain.exaggeration=s,this.triggerRepaint()):this.enableTerrain(s)}onStyleReady(s){this.isStyleLoaded()?s():this.once("styledata",()=>{s()})}fitToIpBounds(){return Be(this,null,function*(){let s=yield np.info();this.fitBounds(s.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(s){return Be(this,null,function*(){let i=yield np.info();this.jumpTo({center:[i.longitude??0,i.latitude??0],zoom:s||11})})}getCameraHash(){let s=new Float32Array(5),i=this.getCenter();return s[0]=i.lng,s[1]=i.lat,s[2]=this.getZoom(),s[3]=this.getPitch(),s[4]=this.getBearing(),mx.fromUint8Array(new Uint8Array(s.buffer))}getSdkConfig(){return ki}getMaptilerSessionId(){return P_}setTransformRequest(s){return super.setTransformRequest(yx(s)),this}isGlobeProjection(){let s=this.getProjection();return s?s.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};function xf(l){if(typeof DOMParser<"u"){let s=new DOMParser().parseFromString(l,"application/xml");if(s.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return s}throw new Error("No XML parser found")}function j_(l,s){if(!l.hasChildNodes())return!1;for(let i of Array.from(l.childNodes)){let p=i.nodeName;if(typeof p=="string"&&p.trim().toLowerCase()===s.toLowerCase())return!0}return!1}function v_(l){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(l);throw new Error("No XML serializer found")}function U_(l){let s=typeof l=="string"?xf(l):l;if(!j_(s,"gpx"))throw new Error("The XML document is not valid GPX");let i=zn(s,"trk"),p=zn(s,"rte"),u=zn(s,"wpt"),r={type:"FeatureCollection",features:[]};for(let x of Array.from(i)){let C=sM(x);C&&r.features.push(C)}for(let x of Array.from(p)){let C=lM(x);C&&r.features.push(C)}for(let x of Array.from(u))r.features.push(cM(x));return r}function N_(l,s){let i=l;if(typeof i=="string"&&(i=xf(i)),!j_(i,"kml"))throw new Error("The XML document is not valid KML");let p={type:"FeatureCollection",features:[]},u={},r={},x={},C=zn(i,"Placemark"),A=zn(i,"Style"),R=zn(i,"StyleMap");for(let U of Array.from(A)){let F=nb(s!==void 0?s(U):v_(U)).toString(16);u[`#${tc(U,"id")}`]=F,r[F]=U}for(let U of Array.from(R)){u[`#${tc(U,"id")}`]=nb(s!==void 0?s(U):v_(U)).toString(16);let F=zn(U,"Pair"),le={};for(let se of Array.from(F))le[di(Ot(se,"key"))??""]=di(Ot(se,"styleUrl"));x[`#${tc(U,"id")}`]=le}for(let U of Array.from(C))p.features=p.features.concat(aM(U,u,r,x));return p}function ib(l){if(l===null)return["#000000",1];let s="",i=1,p=l;return p.startsWith("#")&&(p=p.substring(1)),(p.length===6||p.length===3)&&(s=p),p.length===8&&(i=Number.parseInt(p.substring(0,2),16)/255,s=`#${p.substring(6,8)}${p.substring(4,6)}${p.substring(2,4)}`),[s??"#000000",i??1]}function rM(l){return nw(l.split(" "))}function oM(l){let s=zn(l,"coord"),i=[],p=[];s.length===0&&(s=zn(l,"gx:coord"));for(let r of Array.from(s))i.push(rM(di(r)??""));let u=zn(l,"when");for(let r of Array.from(u))p.push(di(r));return{coords:i,times:p}}function km(l){let s=["Polygon","LineString","Point","Track","gx:Track"],i,p,u,r,x,C=[],A=[];if(Ot(l,"MultiGeometry")!==null)return km(Ot(l,"MultiGeometry"));if(Ot(l,"MultiTrack")!==null)return km(Ot(l,"MultiTrack"));if(Ot(l,"gx:MultiTrack")!==null)return km(Ot(l,"gx:MultiTrack"));for(u=0;u<s.length;u++)if(p=zn(l,s[u]),p){for(r=0;r<p.length;r++)if(i=p[r],s[u]==="Point")C.push({type:"Point",coordinates:rw(di(Ot(i,"coordinates"))??"")});else if(s[u]==="LineString")C.push({type:"LineString",coordinates:ob(di(Ot(i,"coordinates"))??"")});else if(s[u]==="Polygon"){let R=zn(i,"LinearRing"),U=[];for(x=0;x<R.length;x++)U.push(ob(di(Ot(R[x],"coordinates"))??""));C.push({type:"Polygon",coordinates:U})}else if(s[u]==="Track"||s[u]==="gx:Track"){let R=oM(i);C.push({type:"LineString",coordinates:R.coords}),R.times.length&&A.push(R.times)}}return{geoms:C,coordTimes:A}}function aM(l,s,i,p){let u=km(l),r={},x=di(Ot(l,"name")),C=di(Ot(l,"address")),A=di(Ot(l,"description")),R=Ot(l,"TimeSpan"),U=Ot(l,"TimeStamp"),F=Ot(l,"ExtendedData"),le=Ot(l,"visibility"),se,fe=di(Ot(l,"styleUrl")),xe=Ot(l,"LineStyle"),Le=Ot(l,"PolyStyle");if(!u.geoms.length)return[];if(x&&(r.name=x),C&&(r.address=C),fe){fe.startsWith("#")||(fe=`#${fe}`),r.styleUrl=fe,s[fe]&&(r.styleHash=s[fe]),p[fe]&&(r.styleMapHash=p[fe],r.styleHash=s[p[fe].normal??""]);let $e=i[r.styleHash??""];if($e){xe||(xe=Ot($e,"LineStyle")),Le||(Le=Ot($e,"PolyStyle"));let nt=Ot($e,"IconStyle");if(nt){let je=Ot(nt,"Icon");if(je){let ht=di(Ot(je,"href"));ht&&(r.icon=ht)}}}}if(A&&(r.description=A),R){let $e=di(Ot(R,"begin")),nt=di(Ot(R,"end"));$e&&nt&&(r.timespan={begin:$e,end:nt})}if(U!==null&&(r.timestamp=di(Ot(U,"when"))??new Date().toISOString()),xe!==null){let $e=ib(di(Ot(xe,"color"))),nt=$e[0],je=$e[1],ht=Number.parseFloat(di(Ot(xe,"width"))??"");nt&&(r.stroke=nt),Number.isNaN(je)||(r["stroke-opacity"]=je),Number.isNaN(ht)||(r["stroke-width"]=ht)}if(Le){let $e=ib(di(Ot(Le,"color"))),nt=$e[0],je=$e[1],ht=di(Ot(Le,"fill")),Et=di(Ot(Le,"outline"));nt&&(r.fill=nt),Number.isNaN(je)||(r["fill-opacity"]=je),ht&&(r["fill-opacity"]=ht==="1"?r["fill-opacity"]||1:0),Et&&(r["stroke-opacity"]=Et==="1"?r["stroke-opacity"]||1:0)}if(F){let $e=zn(F,"Data"),nt=zn(F,"SimpleData");for(se=0;se<$e.length;se++)r[$e[se].getAttribute("name")??""]=di(Ot($e[se],"value"))??"";for(se=0;se<nt.length;se++)r[nt[se].getAttribute("name")??""]=di(nt[se])??""}le!==null&&(r.visibility=di(le)??""),u.coordTimes.length!==0&&(r.coordTimes=u.coordTimes.length===1?u.coordTimes[0]:u.coordTimes);let Fe={type:"Feature",geometry:u.geoms.length===1?u.geoms[0]:{type:"GeometryCollection",geometries:u.geoms},properties:r};return tc(l,"id")&&(Fe.id=tc(l,"id")??void 0),[Fe]}function tw(l,s){let i=zn(l,s),p=[],u=[],r=[],x=i.length;if(!(x<2)){for(let C=0;C<x;C++){let A=ow(i[C]);p.push(A.coordinates),A.time&&u.push(A.time),(A.heartRate||r.length)&&(r.length===0&&(r=new Array(C).fill(null)),r.push(A.heartRate))}return{line:p,times:u,heartRates:r}}}function sM(l){let s=zn(l,"trkseg"),i=[],p=[],u=[],r;for(let C=0;C<s.length;C++)if(r=tw(s[C],"trkpt"),r!==void 0&&(r.line&&i.push(r.line),r.times&&r.times.length&&p.push(r.times),u.length||r.heartRates&&r.heartRates.length)){if(!u.length)for(let A=0;A<C;A++)u.push(new Array(i[A].length).fill(null));r.heartRates&&r.heartRates.length?u.push(r.heartRates):u.push(new Array(r.line.length).fill(null))}if(i.length===0)return;let x=Xt(Xt({},V_(l)),iw(Ot(l,"extensions")));return p.length!==0&&(x.coordTimes=i.length===1?p[0]:p),u.length!==0&&(x.heartRates=i.length===1?u[0]:u),i.length===1?{type:"Feature",properties:x,geometry:{type:"LineString",coordinates:i[0]}}:{type:"Feature",properties:x,geometry:{type:"MultiLineString",coordinates:i}}}function lM(l){let s=tw(l,"rtept");return s===void 0?void 0:{type:"Feature",properties:Xt(Xt({},V_(l)),iw(Ot(l,"extensions"))),geometry:{type:"LineString",coordinates:s.line}}}function cM(l){return{type:"Feature",properties:Xt(Xt({},V_(l)),x_(l,["sym"])),geometry:{type:"Point",coordinates:ow(l).coordinates}}}function iw(l){let s={};if(l){let i=Ot(l,"line");if(i){let p=di(Ot(i,"color")),u=Number.parseFloat(di(Ot(i,"opacity"))??"0"),r=Number.parseFloat(di(Ot(i,"width"))??"0");p&&(s.stroke=p),Number.isNaN(u)||(s["stroke-opacity"]=u),Number.isNaN(r)||(s["stroke-width"]=r*96/25.4)}}return s}function V_(l){let s=x_(l,["name","cmt","desc","type","time","keywords"]),i=zn(l,"link");if(i.length!==0){s.links=[];for(let p of Array.from(i)){let u=Xt({href:tc(p,"href")},x_(p,["text","type"]));s.links.push(u)}}return s}function nb(l){let s=0;if(!l||!l.length)return s;for(let i=0;i<l.length;i++)s=(s<<5)-s+l.charCodeAt(i)|0;return s}function zn(l,s){return l.getElementsByTagName(s)}function tc(l,s){return l.getAttribute(s)}function rb(l,s){return Number.parseFloat(tc(l,s)??"0")}function Ot(l,s){let i=zn(l,s);return i.length?i[0]:null}function uM(l){return l.normalize&&l.normalize(),l}function nw(l){return l.map(Number.parseFloat).map(s=>Number.isNaN(s)?null:s)}function di(l){return l&&uM(l),l&&l.textContent}function x_(l,s){let i={},p,u;for(u=0;u<s.length;u++)p=Ot(l,s[u]),p&&(i[s[u]]=di(p)??"");return i}function rw(l){return nw(l.replace(/\s*/g,"").split(","))}function ob(l){let s=l.replace(/^\s*|\s*$/g,"").split(/\s+/),i=[];for(let p of s)i.push(rw(p));return i}function ow(l){let s=[rb(l,"lon"),rb(l,"lat")],i=Ot(l,"ele"),p=Ot(l,"gpxtpx:hr")||Ot(l,"hr"),u=Ot(l,"time"),r;return i&&(r=Number.parseFloat(di(i)??"0"),Number.isNaN(r)||s.push(r)),{coordinates:s,time:u?di(u):null,heartRate:p!==null?Number.parseFloat(di(p)??"0"):null}}function aw(l){let s=l;try{typeof s=="string"&&(s=xf(s))}catch{return null}try{return U_(s)}catch{}try{return N_(s)}catch{}return null}function hM(i){return Be(this,arguments,function*(l,s={}){let p=s.download??!1,u=yield pM(l);if(p){let r=s.filename??"maptiler_screenshot.png",x=document.createElement("a");x.style.display="none",document.body.appendChild(x),x.href=URL.createObjectURL(u),x.download=r,x.click(),setTimeout(()=>{document.body.removeChild(x),URL.revokeObjectURL(x.href)},0)}return u})}function pM(l){return new Promise((s,i)=>{l.redraw(),l.once("idle",()=>{l.getCanvas().toBlob(p=>{if(!p){i(Error("Screenshot could not be created."));return}s(p)},"image/png")})})}var b_=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function bf(){return b_[~~(Math.random()*b_.length)][~~(Math.random()*4)]}function Lp(){return`maptiler_source_${cb()}`}function Dp(){return`maptiler_layer_${cb()}`}function w_(l,s){if(s<=l[0].zoom)return l[0].value;if(s>=l[l.length-1].zoom)return l[l.length-1].value;for(let i=0;i<l.length-1;i+=1)if(s>=l[i].zoom&&s<l[i+1].zoom){let p=l[i+1].zoom-l[i].zoom,u=(s-l[i].zoom)/p;return u*l[i+1].value+(1-u)*l[i].value}return 0}function Ys(l){return["interpolate",["linear"],["zoom"],...l.flatMap(s=>[s.zoom,s.value])]}function ci(l){return["interpolate",["linear"],["zoom"],...l.flatMap(s=>[s.zoom,s.value])]}function sw(l,s){if(typeof s=="number"&&typeof l=="number")return 2*s+l;if(typeof s=="number"&&Array.isArray(l))return["interpolate",["linear"],["zoom"],...l.flatMap(i=>[i.zoom,2*s+i.value])];if(typeof l=="number"&&Array.isArray(s))return["interpolate",["linear"],["zoom"],...s.flatMap(i=>[i.zoom,2*i.value+l])];if(Array.isArray(l)&&Array.isArray(s)){let i=Array.from(new Set([...l.map(p=>p.zoom),...s.map(p=>p.zoom)])).sort((p,u)=>p<u?-1:1);return["interpolate",["linear"],["zoom"],...i.flatMap(p=>[p,2*w_(s,p)+w_(l,p)])]}return 0}function lw(l,s){return["interpolate",["linear"],["get",s],...l.flatMap(i=>[i.propertyValue,i.value])]}function $_(l){let s=l.trimStart(),i=`${s}${" ".repeat(l.length-s.length)}`,p=Array.from(i);if(!p.every(r=>r===" "||r==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(p.some(r=>r==="_")&&p.some(r=>r===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");let u=[1];for(let r=1;r<p.length;r+=1){let x=p[r-1],C=p[r];x===C?u[u.length-1]+=1:u.push(1)}return u}function S_(l,s){return["interpolate",["linear"],["get",s],...l.flatMap(i=>[i.value,i.color])]}function I_(l,s,i=!0){return i?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.value,p.pointRadius*.025])],2,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.value,p.pointRadius*.05])],4,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.value,p.pointRadius*.1])],8,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.value,p.pointRadius*.25])],16,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.value,p.pointRadius])]]:["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.value,p.pointRadius])]}function cw(l,s,i=!0){return i?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.propertyValue,p.value*.025])],2,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.propertyValue,p.value*.05])],4,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.propertyValue,p.value*.1])],8,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.propertyValue,p.value*.25])],16,["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.propertyValue,p.value])]]:["interpolate",["linear"],["get",s],...l.flatMap(p=>[p.propertyValue,p.value])]}function T_(l,s){return l.every(i=>i.color[3]===l[0].color[3])?l[0].color[3]?l[0].color[3]/255:1:["interpolate",["linear"],["get",s],...l.getRawColorStops().flatMap(i=>{let p=i.value,u=i.color;return[p,u.length===4?u[3]/255:1]})]}function uw(l,s=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:s+1},(i,p)=>{let u=p/s;return[u,l.getColorHex(u)]}).flat()]}function Cm(l){let s=l.toString(16);return s.length===1?`0${s}`:s}function dM(l){return`#${Cm(l[0])}${Cm(l[1])}${Cm(l[2])}${l.length===4?Cm(l[3]):""}`}var Mt=class l extends Array{constructor(s={}){super(),at(this,"min",0),at(this,"max",1),"min"in s&&(this.min=s.min),"max"in s&&(this.max=s.max),"stops"in s&&this.setStops(s.stops,{clone:!1})}static fromArrayDefinition(s){return new l({stops:s.map(i=>({value:i[0],color:i[1]}))})}setStops(s,i={clone:!0}){let p=i.clone?this.clone():this;p.length=0;let u=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let x=0;x<s.length;x+=1)u=Math.min(u,s[x].value),r=Math.max(r,s[x].value),p.push({value:s[x].value,color:s[x].color.slice()});return p.sort((x,C)=>x.value<C.value?-1:1),this.min=u,this.max=r,p}scale(s,i,p={clone:!0}){let u=p.clone,r=this[0].value,x=this.at(-1).value-r,C=i-s,A=[];for(let R=0;R<this.length;R+=1){let U=(this[R].value-r)/x*C+s;u?A.push({value:U,color:this[R].color.slice()}):this[R].value=U}return u?new l({stops:A}):this}at(s){return s<0?this[this.length+s]:this[s]}clone(){return new l({stops:this.getRawColorStops()})}getRawColorStops(){let s=[];for(let i=0;i<this.length;i+=1)s.push({value:this[i].value,color:this[i].color});return s}reverse(s={clone:!0}){let i=s.clone?this.clone():this;for(let p=0;p<~~(i.length/2);p+=1){let u=i[p].color;i[p].color=i.at(-(p+1)).color,i.at(-(p+1)).color=u}return i}getBounds(){return{min:this.min,max:this.max}}getColor(s,i={smooth:!0}){if(s<=this[0].value)return this[0].color;if(s>=this.at(-1).value)return this.at(-1).color;for(let p=0;p<this.length-1;p+=1){if(s>this[p+1].value)continue;let u=this[p].color;if(!i.smooth)return u.slice();let r=this[p].value,x=this[p+1].value,C=this[p+1].color,A=(x-s)/(x-r);return u.map((R,U)=>Math.round(R*A+C[U]*(1-A)))}return[0,0,0]}getColorHex(s,i={smooth:!0,withAlpha:!1}){return dM(this.getColor(s,i))}getColorRelative(s,i={smooth:!0}){let p=this.getBounds();return this.getColor(p.min+s*(p.max-p.min),i)}getCanvasStrip(s={horizontal:!0,size:512,smooth:!0}){let i=document.createElement("canvas");i.width=s.horizontal?s.size:1,i.height=s.horizontal?1:s.size;let p=i.getContext("2d");if(!p)throw new Error("Canvs context is missing");let u=p.getImageData(0,0,i.width,i.height),r=u.data,x=s.size,C=this[0].value,A=(this.at(-1).value-C)/x;for(let R=0;R<x;R+=1){let U=this.getColor(C+R*A,{smooth:s.smooth});r[R*4]=U[0],r[R*4+1]=U[1],r[R*4+2]=U[2],r[R*4+3]=U.length>3?U[3]:255}return p.putImageData(u,0,0),i}resample(s,i=15){let p=this.getBounds(),u=this.scale(0,1),r=1/(i-1),x;if(s==="ease-in-square")x=Array.from({length:i},(C,A)=>{let R=A*r,U=R**2,F=u.getColor(U);return{value:R,color:F}});else if(s==="ease-out-square")x=Array.from({length:i},(C,A)=>{let R=A*r,U=1-(1-R)**2,F=u.getColor(U);return{value:R,color:F}});else if(s==="ease-out-sqrt")x=Array.from({length:i},(C,A)=>{let R=A*r,U=R**.5,F=u.getColor(U);return{value:R,color:F}});else if(s==="ease-in-sqrt")x=Array.from({length:i},(C,A)=>{let R=A*r,U=1-(1-R)**.5,F=u.getColor(U);return{value:R,color:F}});else if(s==="ease-out-exp")x=Array.from({length:i},(C,A)=>{let R=A*r,U=1-2**(-10*R),F=u.getColor(U);return{value:R,color:F}});else if(s==="ease-in-exp")x=Array.from({length:i},(C,A)=>{let R=A*r,U=2**(10*R-10),F=u.getColor(U);return{value:R,color:F}});else throw new Error("Invalid ressampling method.");return new l({stops:x}).scale(p.min,p.max)}transparentStart(){let s=this.getRawColorStops();s.unshift({value:s[0].value,color:s[0].color.slice()}),s[1].value+=.001;for(let i of s)i.color.length===3&&i.color.push(255);return s[0].color[3]=0,new l({stops:s})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}},G_={NULL:new Mt({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new Mt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new Mt({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new Mt({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new Mt({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new Mt({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new Mt({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new Mt({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new Mt({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new Mt({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new Mt({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new Mt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new Mt({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new Mt({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new Mt({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new Mt({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new Mt({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new Mt({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new Mt({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new Mt({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new Mt({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new Mt({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new Mt({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new Mt({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new Mt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new Mt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new Mt({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new Mt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new Mt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new Mt({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new Mt({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new Mt({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new Mt({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new Mt({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new Mt({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new Mt({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new Mt({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new Mt({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new Mt({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new Mt({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new Mt({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new Mt({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new Mt({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new Mt({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new Mt({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new Mt({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new Mt({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new Mt({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new Mt({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};function mM(p,u){return Be(this,arguments,function*(l,s,i={}){var r,x;if(!s.sourceId&&!s.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let C=s.data;if(typeof C=="string"){if(of(C))C=`https://api.maptiler.com/data/${s.data}/features.json?key=${ki.apiKey}`;else if(((r=C.split(".").pop())==null?void 0:r.toLowerCase().trim())==="gpx"){let A=yield(yield fetch(C,i)).text();C=U_(A)}else if(((x=C.split(".").pop())==null?void 0:x.toLowerCase().trim())==="kml"){let A=yield(yield fetch(C,i)).text();C=N_(A)}else{let A=AI(C)??aw(C);A&&(C=A)}if(!C)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return fM(l,ha(Xt({},s),{data:C}))})}function fM(l,s){if(s.layerId&&l.getLayer(s.layerId))throw new Error(`A layer already exists with the layer id: ${s.layerId}`);let i=s.sourceId??Lp(),p=s.layerId??Dp(),u={polylineLayerId:p,polylineOutlineLayerId:"",polylineSourceId:i};s.data&&!l.getSource(i)&&l.addSource(i,{type:"geojson",data:s.data});let r=s.lineWidth??3,x=s.lineColor??bf(),C=s.lineOpacity??1,A=s.lineBlur??0,R=s.lineGapWidth??0,U=s.lineDashArray??null,F=s.outlineWidth??1,le=s.outlineColor??"#FFFFFF",se=s.outlineOpacity??1,fe=s.outlineBlur??0;if(typeof U=="string"&&(U=$_(U)),s.outline===!0){let xe=`${p}_outline`;u.polylineOutlineLayerId=xe,l.addLayer({id:xe,type:"line",source:i,layout:{"line-join":s.lineJoin??"round","line-cap":s.lineCap??"round"},minzoom:s.minzoom??0,maxzoom:s.maxzoom??23,paint:{"line-opacity":typeof se=="number"?se:ci(se),"line-color":typeof le=="string"?le:Ys(le),"line-width":sw(r,F),"line-blur":typeof fe=="number"?fe:ci(fe)}},s.beforeId)}return l.addLayer({id:p,type:"line",source:i,layout:{"line-join":s.lineJoin??"round","line-cap":s.lineCap??"round"},minzoom:s.minzoom??0,maxzoom:s.maxzoom??23,paint:Xt({"line-opacity":typeof C=="number"?C:ci(C),"line-color":typeof x=="string"?x:Ys(x),"line-width":typeof r=="number"?r:ci(r),"line-blur":typeof A=="number"?A:ci(A),"line-gap-width":typeof R=="number"?R:ci(R)},U&&{"line-dasharray":U})},s.beforeId),u}function gM(l,s){if(s.layerId&&l.getLayer(s.layerId))throw new Error(`A layer already exists with the layer id: ${s.layerId}`);let i=s.sourceId??Lp(),p=s.layerId??Dp(),u={polygonLayerId:p,polygonOutlineLayerId:s.outline?`${p}_outline`:"",polygonSourceId:i};if(s.data&&!l.getSource(i)){let xe=s.data;typeof xe=="string"&&of(xe)&&(xe=`https://api.maptiler.com/data/${xe}/features.json?key=${ki.apiKey}`),l.addSource(i,{type:"geojson",data:xe})}let r=s.outlineDashArray??null,x=s.outlineWidth??1,C=s.outlineColor??"#FFFFFF",A=s.outlineOpacity??1,R=s.outlineBlur??0,U=s.fillColor??bf(),F=s.fillOpacity??1,le=s.outlinePosition??"center",se=s.pattern??null;typeof r=="string"&&(r=$_(r));let fe=(xe=null)=>{if(l.addLayer({id:p,type:"fill",source:i,minzoom:s.minzoom??0,maxzoom:s.maxzoom??23,paint:Xt({"fill-color":typeof U=="string"?U:Ys(U),"fill-opacity":typeof F=="number"?F:ci(F)},xe&&{"fill-pattern":xe})},s.beforeId),s.outline===!0){let Le;le==="inside"?typeof x=="number"?Le=.5*x:Le=ci(x.map(({zoom:Fe,value:$e})=>({zoom:Fe,value:.5*$e}))):le==="outside"?typeof x=="number"?Le=-.5*x:Le=ci(x.map(Fe=>({zoom:Fe.zoom,value:-.5*Fe.value}))):Le=0,l.addLayer({id:u.polygonOutlineLayerId,type:"line",source:i,layout:{"line-join":s.outlineJoin??"round","line-cap":s.outlineCap??"butt"},minzoom:s.minzoom??0,maxzoom:s.maxzoom??23,paint:Xt({"line-opacity":typeof A=="number"?A:ci(A),"line-color":typeof C=="string"?C:Ys(C),"line-width":typeof x=="number"?x:ci(x),"line-blur":typeof R=="number"?R:ci(R),"line-offset":Le},r&&{"line-dasharray":r})},s.beforeId)}};return se?l.hasImage(se)?fe(se):l.loadImage(se).then(xe=>{l.addImage(se,xe.data),fe(se)}).catch(xe=>{console.error("Could not load the pattern image.",xe.message),fe()}):fe(),u}function _M(l,s){if(s.layerId&&l.getLayer(s.layerId))throw new Error(`A layer already exists with the layer id: ${s.layerId}`);let i=s.minPointRadius??10,p=s.maxPointRadius??50,u=s.cluster??!1,r=20,x=Array.isArray(s.pointColor)?s.pointColor:G_.TURBO.scale(10,s.cluster?1e4:1e3).resample("ease-out-square"),C=x.getBounds(),A=s.sourceId??Lp(),R=s.layerId??Dp(),U=s.showLabel??u,F=s.alignOnViewport??!0,le=s.outline??!1,se=s.outlineOpacity??1,fe=s.outlineWidth??1,xe=s.outlineColor??"#FFFFFF",Le,Fe=s.zoomCompensation??!0,$e=s.minzoom??0,nt=s.maxzoom??23;typeof s.pointOpacity=="number"?Le=s.pointOpacity:Array.isArray(s.pointOpacity)?Le=ci(s.pointOpacity):s.cluster?Le=T_(x,"point_count"):s.property?Le=T_(x,s.property):Le=ci([{zoom:$e,value:0},{zoom:$e+.25,value:1},{zoom:nt-.25,value:1},{zoom:nt,value:0}]);let je={pointLayerId:R,clusterLayerId:"",labelLayerId:"",pointSourceId:A};if(s.data&&!l.getSource(A)){let ht=s.data;typeof ht=="string"&&of(ht)&&(ht=`https://api.maptiler.com/data/${ht}/features.json?key=${ki.apiKey}`),l.addSource(A,{type:"geojson",data:ht,cluster:u})}if(u){je.clusterLayerId=`${R}_cluster`;let ht=Array.from({length:r},(Et,Ui)=>{let mi=C.min+Ui*(C.max-C.min)/(r-1);return{value:mi,pointRadius:i+(p-i)*(Ui/(r-1))**.5,color:x.getColorHex(mi)}});l.addLayer({id:je.clusterLayerId,type:"circle",source:A,filter:["has","point_count"],paint:Xt({"circle-color":typeof s.pointColor=="string"?s.pointColor:S_(ht,"point_count"),"circle-radius":typeof s.pointRadius=="number"?s.pointRadius:Array.isArray(s.pointRadius)?ci(s.pointRadius):I_(ht,"point_count",!1),"circle-pitch-alignment":F?"viewport":"map","circle-pitch-scale":"map","circle-opacity":Le},le&&{"circle-stroke-opacity":typeof se=="number"?se:ci(se),"circle-stroke-width":typeof fe=="number"?fe:ci(fe),"circle-stroke-color":typeof xe=="string"?xe:Ys(xe)}),minzoom:$e,maxzoom:nt},s.beforeId),l.addLayer({id:je.pointLayerId,type:"circle",source:A,filter:["!",["has","point_count"]],paint:Xt({"circle-pitch-alignment":F?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof s.pointColor=="string"?s.pointColor:x.getColorHex(x.getBounds().min),"circle-radius":typeof s.pointRadius=="number"?s.pointRadius:Array.isArray(s.pointRadius)?ci(s.pointRadius):ht[0].pointRadius*.75,"circle-opacity":Le},le&&{"circle-stroke-opacity":typeof se=="number"?se:ci(se),"circle-stroke-width":typeof fe=="number"?fe:ci(fe),"circle-stroke-color":typeof xe=="string"?xe:Ys(xe)}),minzoom:$e,maxzoom:nt},s.beforeId)}else{let ht=typeof s.pointColor=="string"?s.pointColor:Array.isArray(s.pointColor)?s.pointColor.getColorHex(s.pointColor.getBounds().min):bf(),Et=typeof s.pointRadius=="number"?Fe?ci([{zoom:0,value:s.pointRadius*.025},{zoom:2,value:s.pointRadius*.05},{zoom:4,value:s.pointRadius*.1},{zoom:8,value:s.pointRadius*.25},{zoom:16,value:s.pointRadius*1}]):s.pointRadius:Array.isArray(s.pointRadius)?ci(s.pointRadius):Fe?ci([{zoom:0,value:i*.05},{zoom:2,value:i*.1},{zoom:4,value:i*.2},{zoom:8,value:i*.5},{zoom:16,value:i*1}]):i;if(s.property&&Array.isArray(s.pointColor)){let Ui=Array.from({length:r},(mi,On)=>{let In=C.min+On*(C.max-C.min)/(r-1);return{value:In,pointRadius:typeof s.pointRadius=="number"?s.pointRadius:i+(p-i)*(On/(r-1))**.5,color:typeof s.pointColor=="string"?s.pointColor:x.getColorHex(In)}});ht=S_(Ui,s.property),Et=I_(Ui,s.property,Fe)}l.addLayer({id:je.pointLayerId,type:"circle",source:A,layout:{"circle-sort-key":s.property?["/",1,["get",s.property]]:0},paint:Xt({"circle-pitch-alignment":F?"viewport":"map","circle-pitch-scale":"map","circle-color":ht,"circle-opacity":Le,"circle-radius":Et},le&&{"circle-stroke-opacity":typeof se=="number"?se:ci(se),"circle-stroke-width":typeof fe=="number"?fe:ci(fe),"circle-stroke-color":typeof xe=="string"?xe:Ys(xe)}),minzoom:$e,maxzoom:nt},s.beforeId)}if(U!==!1&&(s.cluster||s.property)){je.labelLayerId=`${R}_label`;let ht=s.labelColor??"#fff",Et=s.labelSize??12;l.addLayer({id:je.labelLayerId,type:"symbol",source:A,filter:["has",s.cluster?"point_count":s.property],layout:{"text-field":s.cluster?"{point_count_abbreviated}":`{${s.property}}`,"text-font":["Noto Sans Regular"],"text-size":Et,"text-pitch-alignment":F?"viewport":"map","symbol-sort-key":["/",1,["get",s.cluster?"point_count":s.property]]},paint:{"text-color":ht,"text-opacity":Le},minzoom:$e,maxzoom:nt},s.beforeId)}return je}function yM(l,s){if(s.layerId&&l.getLayer(s.layerId))throw new Error(`A layer already exists with the layer id: ${s.layerId}`);let i=s.sourceId??Lp(),p=s.layerId??Dp(),u=s.minzoom??0,r=s.maxzoom??23,x=s.zoomCompensation??!0,C=s.opacity??[{zoom:u,value:0},{zoom:u+.25,value:1},{zoom:r-.25,value:1},{zoom:r,value:0}],A=Array.isArray(s.colorRamp)?s.colorRamp:G_.TURBO.transparentStart(),R=A.getBounds();(R.min!==0||R.max!==1)&&(A=A.scale(0,1)),A.hasTransparentStart()||(A=A.transparentStart());let U=s.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],F=s.property??null,le=s.weight??1,se=1;F?typeof le=="number"?(se=le,typeof s.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(le)?se=lw(le,F):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof le=="number"?se=le:Array.isArray(le)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");let fe=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],xe=s.radius??(x?fe:10),Le=1;typeof xe=="number"?Le=xe:Array.isArray(xe)&&"zoom"in xe[0]?Le=ci(xe):F&&Array.isArray(xe)&&"propertyValue"in xe[0]?Le=cw(xe,F,x):!F&&Array.isArray(xe)&&"propertyValue"in xe[0]?(Le=ci(fe),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):Le=ci(fe);let Fe={heatmapLayerId:p,heatmapSourceId:i};if(s.data&&!l.getSource(i)){let $e=s.data;typeof $e=="string"&&of($e)&&($e=`https://api.maptiler.com/data/${$e}/features.json?key=${ki.apiKey}`),l.addSource(i,{type:"geojson",data:$e})}return l.addLayer({id:p,type:"heatmap",source:i,minzoom:u,maxzoom:r,paint:{"heatmap-weight":se,"heatmap-intensity":typeof U=="number"?U:ci(U),"heatmap-color":uw(A),"heatmap-radius":Le,"heatmap-opacity":typeof C=="number"?C:ci(C)}},s.beforeId),Fe}var vM=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:yM,addPoint:_M,addPolygon:gM,addPolyline:mM,colorDrivenByProperty:S_,colorPalettes:b_,computeRampedOutlineWidth:sw,dashArrayMaker:$_,generateRandomLayerName:Dp,generateRandomSourceName:Lp,getRandomColor:bf,heatmapIntensityFromColorRamp:uw,lerpZoomNumberValues:w_,opacityDrivenByProperty:T_,paintColorOptionsToPaintSpec:Ys,radiusDrivenByProperty:I_,radiusDrivenByPropertyHeatmap:cw,rampedOptionsToLayerPaintSpec:ci,rampedPropertyValueWeight:lw,takeScreenshot:hM},Symbol.toStringTag,{value:"Module"}));MI();function xM(){return"3.7.0"}var bM=gt.default.Map,wM=gt.default.Marker,SM=gt.default.Popup,IM=gt.default.Style,TM=gt.default.CanvasSource,CM=gt.default.GeoJSONSource,PM=gt.default.ImageSource,MM=gt.default.RasterTileSource,EM=gt.default.RasterDEMTileSource,AM=gt.default.VectorTileSource,kM=gt.default.VideoSource,LM=gt.default.NavigationControl,DM=gt.default.GeolocateControl,RM=gt.default.AttributionControl,zM=gt.default.LogoControl,OM=gt.default.ScaleControl,FM=gt.default.FullscreenControl,BM=gt.default.TerrainControl,jM=gt.default.BoxZoomHandler,UM=gt.default.ScrollZoomHandler,NM=gt.default.CooperativeGesturesHandler,VM=gt.default.KeyboardHandler,$M=gt.default.TwoFingersTouchPitchHandler,GM=gt.default.MapWheelEvent,qM=gt.default.MapTouchEvent,WM=gt.default.MapMouseEvent,ZM=gt.default.config,HM=gt.default.getVersion,{setRTLTextPlugin:KM,getRTLTextPluginStatus:XM,LngLat:ac,LngLatBounds:wf,MercatorCoordinate:JM,Evented:YM,AJAXError:QM,prewarm:eE,clearPrewarmedResources:tE,Hash:iE,Point:nE,EdgeInsets:rE,DragRotateHandler:oE,DragPanHandler:aE,TwoFingersTouchZoomRotateHandler:sE,DoubleClickZoomHandler:lE,TwoFingersTouchZoomHandler:cE,TwoFingersTouchRotateHandler:uE,getWorkerCount:hE,setWorkerCount:pE,getMaxParallelImageRequests:dE,setMaxParallelImageRequests:mE,getWorkerUrl:fE,setWorkerUrl:gE,addSourceType:_E,importScriptInWorkers:yE,addProtocol:vE,removeProtocol:xE}=gt.default;var ju=(()=>{class l{events;logging;http;mapAPIType;mapReady;providerError;mapCanvasID;map;markerList;polylinePath;_isMapAnimating=!1;searchMarker;mapTileSet;constructor(i,p,u){this.events=i,this.logging=p,this.http=u,this.events=i,this.mapAPIType=Os.MAPBOX,this.mapReady=!1,this.markerList=new Map}initAPI(){Sf&&(ki.apiKey=dr.mapTilerToken)}disposeMap(){this.map&&(this.logging.log("Disposing map",Gi.INFO),this.map.remove())}getCurrentMapTileSet(i){return i=="SATELLITE"?_o.SATELLITE:_o.STREETS}flyAroundPoint(i){if(this._isMapAnimating){this.map.rotateTo(i/100%360,{duration:0});let p=this;requestAnimationFrame(function(u){p.flyAroundPoint(u)})}}initMap(i,p,u){this.mapCanvasID=i;let r=!0;if(typeof Sf>"u"?r=!1:r=!0,r){if(this.map==null){let R=function(F){return F*(2-F)},x=document.getElementById(i);this.initAPI(),this.map=new vf({container:i,zoom:15,attributionControl:!1}),this.map.addControl(new mp({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new Ru),this.mapReady=!0,this.map.getCanvas().focus();let C=100,A=25;this.map.getCanvas().addEventListener("keydown",F=>{F.preventDefault(),F.which===38?this.map.panBy([0,-C],{easing:R}):F.which===40?this.map.panBy([0,C],{easing:R}):F.which===37?this.map.easeTo({bearing:this.map.getBearing()-A,easing:R}):F.which===39?this.map.easeTo({bearing:this.map.getBearing()+A,easing:R}):F.which===32&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let U=qn.debounce(()=>{this.getMapCenter().subscribe(F=>{this.searchMarker.setLngLat(new ac(F.coords.longitude,F.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&U()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),p.onMapMoveCompleted&&p.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}else return this.logging.log("Call to initMap before API is ready:"+Os[this.mapAPIType],Gi.ERROR),this.mapReady=!1,!1}clearMarkers(){this.markerList!=null&&this.markerList.forEach((i,p)=>{i.remove()}),this.markerList=new Map}showPOIListOnMap(i,p,u=!0){let r=!1,x=this.map,C=new wf,A=0,R=this;r&&this.clearMarkers();let U=x.getZoom();if(i!=null){let le=i.length;for(let se=0;se<i.length;se++)if(i[se].AddressInfo!=null&&i[se].AddressInfo.Latitude!=null&&i[se].AddressInfo.Longitude!=null){let fe=i[se],xe=!0;if(!r&&this.markerList!=null&&this.markerList.has(fe.ID)){xe=!1;let Le=this.markerList.get(fe.ID);Le&&Le.poi&&Le.poi.DateLastStatusUpdate!=fe.DateLastStatusUpdate&&(Le.remove(),xe=!0)}if(xe){let Le=null,Fe=null;u?(Le=document.createElement("img"),Le.src=qn.getIconForPOI(fe),Le.width=34,Le.height=50):(Le=null,Fe=qn.getColorForPOI(fe));let $e={element:Le,color:Fe,anchor:"bottom"},nt=(u?"OCM-":"EXT-")+fe.ID+": "+fe.AddressInfo.Title+":";fe.UsageType!=null&&(nt+=" "+fe.UsageType.Title),fe.StatusType!=null&&(nt+=" "+fe.StatusType.Title);let je=new af($e).setLngLat([fe.AddressInfo.Longitude,fe.AddressInfo.Latitude]).addTo(x);je.poi=fe;let ht=je.getElement();ht.poi=fe,ht.addEventListener("click",Et=>{let Ui=Et.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:Ui.ID,poi:Ui})}),C.extend(je.getLngLat()),this.markerList.set(fe.ID,je),A++}}this.logging.log(A+" new map markers added out of a total "+this.markerList.size)}let F=this;if(i!=null&&i.length>0)if(p!=null&&!p.appConfig.enableLiveMapQuerying){this.logging.log("Fitting to marker bounds:"+C),x.setCenter(C.getCenter()),this.logging.log("zoom before fit bounds:"+x.getZoom()),x.fitBounds(C);let le=x.getZoom();x.setZoom(le<6?6:le)}else x.getCenter()==null&&x.setCenter(C.getCenter())}refreshMapLayout(){this.map!=null&&setTimeout(()=>{this.logging.log("maptilersdk: refreshMapLayout",Gi.VERBOSE),this.map.resize()},200)}setMapCenter(i){this.mapReady&&(this.map.setCenter(new ac(i.coords.longitude,i.coords.latitude)),this.searchMarker||(this.searchMarker=new af({color:"#99ccff",anchor:"bottom"}).setLngLat(new ac(i.coords.longitude,i.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let p=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new qi(p.lat,p.lng))})))}getMapCenter(){return new Gd(p=>{if(this.map!=null){let u=this.map.getCenter();u!=null&&(p.next(new ma(u.lat,u.lng)),p.complete())}})}setMapZoom(i){this.map.setZoom(i)}getMapZoom(){return new Gd(p=>{let u=this.map.getZoom();p.next(u),p.complete()})}setMapType(i){this.map.setStyle(this.getCurrentMapTileSet(i))}getMapBounds(){return new Gd(p=>{let u=new Array,r=this.map.getBounds();u.push(new qi(r.getSouthWest().lat,r.getSouthWest().lng)),u.push(new qi(r.getNorthEast().lat,r.getNorthEast().lng)),p.next(u),p.complete()})}moveToMapBounds(i){this.map.fitBounds(new wf(new ac(i.southWest.longitude,i.southWest.latitude),new ac(i.northEast.longitude,i.northEast.latitude)))}renderMap(i,p,u){return document.getElementById(this.mapCanvasID).style.height=p+"px",this.mapReady&&this.showPOIListOnMap(i,u),!0}renderPolyline(i){this.clearPolyline()}clearPolyline(){this.polylinePath!=null&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(i,p,u){return Be(this,null,function*(){let r=`https://api.maptiler.com/geocoding/${i||u+","+p}.json?key=${dr.mapTilerToken}`;return new Promise((x,C)=>Be(this,null,function*(){this.http.get(r).toPromise().then(A=>{let R=[];R=[],A.features&&A.features.map(U=>{let F=new Wa;F.Title=U.place_name,F.Address=U.place_name,F.Type="place",F.Location=new qi(U.center[1],U.center[0]),F.Attribution=A.attribution,R.push(F)}),x(R)})}))})}addPOILayer(i){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(i,null,!1)}static \u0275fac=function(p){return new(p||l)(Ct(Tr),Ct(pi),Ct(tr))};static \u0275prov=gi({token:l,factory:l.\u0275fac})}return l})();var Uu=(()=>{class l{logging;http;map;mapCentreMarker;mapsInitialised;mapAPIReady;mapOptions;searchMarker;errorMessage;parentAppContext;mapProvider;debouncedMapPositionUpdate;events;isFocused=!1;constructor(i,p,u){this.logging=p,this.http=u,this.events=i,this.mapOptions=new Xd,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let r=this;this.debouncedMapPositionUpdate=qn.debounce(()=>{this.logging.log("signaling map position change:"),r.mapProvider.mapReady&&r.getMapCenter().subscribe(x=>{x!=null?(this.logging.log("Map centre/zoom changed, updating search position:"+x),this.updateMapCentrePos(x.coords.latitude,x.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(i){this.parentAppContext=i}setMapAPI(i){this.mapOptions.mapAPI=i,this.mapOptions.mapAPI==Os.MAPTILER&&(this.mapProvider=new ju(this.events,this.logging,this.http))}isMapReady(){return this.mapProvider!=null?this.mapProvider.mapReady:!1}externalAPILoaded(i){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+Os[i])}initMap(i){if(!this.isMapReady())if(this.mapProvider!=null)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+Os[this.mapProvider.mapAPIType]),this.mapProvider.initMap(i,this.mapOptions,this);else if(this.mapsInitialised){this.logging.log("initMap: map already initialised");return}else this.logging.log("initMap: "+this.mapOptions.mapAPI)}mapManipulationPerformed(i){this.logging.log("map manipulated:"+i);let p=this;(i=="drag"||i=="zoom")&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(i,p,u,r){u&&this.mapProvider!=null&&this.mapProvider.setMapCenter(new ma(i,p),r),this.mapOptions.mapCentre=new ma(i,p)}moveToMapBounds(i){this.mapProvider.moveToMapBounds(i)}refreshMapView(i,p,u){return this.mapProvider!=null?(this.logging.log("Mapping Manager: renderMap "+Os[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(p,i,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",Gi.ERROR),!0}setMapType(i){this.mapOptions.mapType!=i&&(this.mapOptions.mapType=i,this.isMapReady()&&this.mapProvider!=null?(this.logging.log("Changing map type:"+i),this.mapProvider.setMapType(i)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(i){this.mapProvider.setMapZoom(i)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(i,p,u=!1,r=!1,x=200,C=200){let A=document.getElementById(i);if(A!=null){let R=p.AddressInfo.Title,U=p.AddressInfo.Latitude,F=p.AddressInfo.Longitude;x>640&&(x=640),C>640&&(C=640);let le=x,se=C,fe="https://maps.googleapis.com/maps/api/staticmap?center="+U+","+F+"&zoom=14&size="+le+"x"+se+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+U+","+F+"&sensor=false",xe="";u==!0?xe+="<div>"+qn.formatMapLink(p,'<div><img width="'+le+'" height="'+se+'" src="'+fe+'" /></div>',r)+"</div>":xe+='<div><img width="'+le+'" height="'+se+'" src="'+fe+'" /></div>',A.innerHTML=xe}}renderPolyline(i){this.mapProvider.renderPolyline(i)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(i){this.mapProvider.addPOILayer(i)}static \u0275fac=function(p){return new(p||l)(Ct(Tr),Ct(pi),Ct(tr))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function bE(l,s){if(l&1){let i=Pt();ii(0),q(1,"ion-note")(2,"p"),pe(3," The closest address to this position is: "),K(),q(4,"p")(5,"strong"),pe(6),K(),Ye(7,"br"),pe(8),Ye(9,"br"),q(10,"ion-button",3),rt("click",function(){Ue(i);let u=be();return Ne(u.useAddressSelection())}),pe(11,"Use this address below "),Ye(12,"ion-icon",4),K()()(),ni()}if(l&2){let i=be();Y(6),yt(i.suggestedAddress.AddressLine1),Y(2),Vv(" ",i.suggestedAddress.AddressLine2," ",i.suggestedAddress.Town," ",i.suggestedAddress.StateOrProvince," ",i.suggestedAddress.Postcode," ")}}var If=(()=>{class l{mapping;events;logging;http;appManager;latitude;latitudeChange=new Gn;longitude;longitudeChange=new Gn;suggestedAddress=null;suggestedAddressChange=new Gn;onUseSuggestedAddress=new Gn;suggestedAddressAttribution=null;suggestedAddressAttributionChange=new Gn;originalMarkerPos;mapService;mapOptions;debouncedGecode;isMapInitialised=!1;constructor(i,p,u,r,x){this.mapping=i,this.events=p,this.logging=u,this.http=r,this.appManager=x}ngOnInit(){this.mapService=new ju(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new Xd,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let i;i=this.mapService.getMapCenter(),i.subscribe(p=>{p&&(this.latitude=p.coords.latitude,this.longitude=p.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}ngOnDestroy(){this.mapService.disposeMap()}focusMap(){this.isMapInitialised==!1&&this.mapService&&this.latitude!=0&&this.longitude!=0&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new ma(this.latitude,this.longitude)),this.originalMarkerPos=new qi(this.latitude,this.longitude))}ngOnChanges(i){this.focusMap()}getAddressForCurrentLatLng(){return Be(this,null,function*(){this.latitude&&this.longitude&&this.appManager.api.fetchReverseGeocodeResult(this.latitude,this.longitude).then(i=>{i.AddressInfo&&(this.suggestedAddress=i.AddressInfo)})})}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}static \u0275fac=function(p){return new(p||l)(ot(Uu),ot(Tr),ot(pi),ot(tr),ot(Pr))};static \u0275cmp=Ti({type:l,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},standalone:!1,features:[Zd],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(p,u){p&1&&(q(0,"p",0),pe(1,"Drag the map to center the marker on the charging location:"),K(),Ye(2,"div",1),it(3,bE,13,5,"ng-container",2)),p&2&&(Y(3),Ce("ngIf",u.suggestedAddress))},dependencies:[Yi,Fi,Bi,fu],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]})}return l})();function SE(l,s){if(l&1&&(q(0,"ion-select-option",18),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}function IE(l,s){if(l&1&&(q(0,"ion-select-option",18),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}function TE(l,s){if(l&1&&(q(0,"ion-select-option",18),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}var W_=(()=>{class l{modalController;referenceDataManager;conn;useFilteredConnectionTypes=!0;useFilteredOperators=!0;constructor(i,p){this.modalController=i,this.referenceDataManager=p}get isAddMode(){return!(this.conn!=null&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(i=>i.IsUserSelectable==!0)}ngOnInit(){}save(){var i=!0;this.conn.Quantity!=null&&(this.conn.Quantity<0||this.conn.Quantity>100||!Number.isInteger(this.conn.Quantity))&&(alert("Quantity must be a whole number, or leave it blank."),i=!1),i&&this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}static \u0275fac=function(p){return new(p||l)(ot(Ir),ot(Us))};static \u0275cmp=Ti({type:l,selectors:[["app-poi-equipment-editor"]],standalone:!1,decls:42,vars:13,consts:[[1,"ion-padding"],["label","Connection Type","label-placement","floating",3,"ngModelChange","ngModel"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["label","Supply Type","label-placement","floating",3,"ngModelChange","ngModel"],["label","Power (kW)","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Amps","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Voltage","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Status","label-placement","floating",3,"ngModelChange","ngModel"],["label","Quantity Available","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Comment","label-placement","floating","type","text","placeholder","(optional) other comments",3,"ngModelChange","ngModel"],["label","Operators Reference","label-placement","floating","type","text","placeholder","(optional)",3,"ngModelChange","ngModel"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(p,u){p&1&&(q(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),pe(3),K()()(),q(4,"ion-content",0)(5,"p"),pe(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),K(),q(7,"ion-item")(8,"ion-select",1),xt("ngModelChange",function(x){return _t(u.conn.ConnectionTypeID,x)||(u.conn.ConnectionTypeID=x),x}),q(9,"ion-select-option",2),pe(10,"Unknown"),K(),it(11,SE,2,2,"ion-select-option",3),K()(),q(12,"ion-item")(13,"ion-select",4),xt("ngModelChange",function(x){return _t(u.conn.CurrentTypeID,x)||(u.conn.CurrentTypeID=x),x}),q(14,"ion-select-option",2),pe(15,"Unknown"),K(),it(16,IE,2,2,"ion-select-option",3),K()(),q(17,"ion-item")(18,"ion-input",5),xt("ngModelChange",function(x){return _t(u.conn.PowerKW,x)||(u.conn.PowerKW=x),x}),K()(),q(19,"ion-item")(20,"ion-input",6),xt("ngModelChange",function(x){return _t(u.conn.Amps,x)||(u.conn.Amps=x),x}),K()(),q(21,"ion-item")(22,"ion-input",7),xt("ngModelChange",function(x){return _t(u.conn.Voltage,x)||(u.conn.Voltage=x),x}),K()(),q(23,"ion-item")(24,"ion-select",8),xt("ngModelChange",function(x){return _t(u.conn.StatusTypeID,x)||(u.conn.StatusTypeID=x),x}),it(25,TE,2,2,"ion-select-option",3),K()(),q(26,"ion-item")(27,"ion-input",9),xt("ngModelChange",function(x){return _t(u.conn.Quantity,x)||(u.conn.Quantity=x),x}),K()(),q(28,"ion-item")(29,"ion-input",10),xt("ngModelChange",function(x){return _t(u.conn.Comments,x)||(u.conn.Comments=x),x}),K()(),q(30,"ion-item")(31,"ion-input",11),xt("ngModelChange",function(x){return _t(u.conn.Reference,x)||(u.conn.Reference=x),x}),K()()(),q(32,"ion-footer")(33,"ion-toolbar")(34,"ion-buttons",12)(35,"ion-button",13),rt("click",function(){return u.cancel()}),Ye(36,"ion-icon",14),pe(37," Cancel "),K()(),q(38,"ion-buttons",15)(39,"ion-button",16),rt("click",function(){return u.save()}),pe(40," OK "),Ye(41,"ion-icon",17),K()()()()),p&2&&(Y(3),yt(u.isAddMode?"Add Equipment":"Edit Equipment"),Y(5),vt("ngModel",u.conn.ConnectionTypeID),Y(3),Ce("ngForOf",u.connectionTypes),Y(2),vt("ngModel",u.conn.CurrentTypeID),Y(3),Ce("ngForOf",u.currentTypes),Y(2),vt("ngModel",u.conn.PowerKW),Y(2),vt("ngModel",u.conn.Amps),Y(2),vt("ngModel",u.conn.Voltage),Y(2),vt("ngModel",u.conn.StatusTypeID),Y(),Ce("ngForOf",u.statusTypes),Y(2),vt("ngModel",u.conn.Quantity),Y(2),vt("ngModel",u.conn.Comments),Y(2),vt("ngModel",u.conn.Reference))},dependencies:[kn,Fi,nr,ho,po,mo,Bi,Sr,Qi,pa,da,fo,or,pu,wr,ir,Ln,Dn],encapsulation:2})}return l})();var Z_=(function(l){return l[l.Unknown=0]="Unknown",l[l.CurrentlyAvailable=10]="CurrentlyAvailable",l[l.CurrentlyInUse=20]="CurrentlyInUse",l[l.TemporarilyUnavailable=30]="TemporarilyUnavailable",l[l.Operational=50]="Operational",l[l.PartlyOperational=75]="PartlyOperational",l[l.NotOperational=100]="NotOperational",l[l.PlannedForFutureDate=150]="PlannedForFutureDate",l[l.RemovedDecomissioned=200]="RemovedDecomissioned",l})(Z_||{}),H_=(function(l){return l[l.UnknownOperator=1]="UnknownOperator",l[l.SiteOwner=45]="SiteOwner",l})(H_||{});function CE(l,s){if(l&1){let i=Pt();q(0,"ion-button",5),rt("click",function(){Ue(i);let u=be().$implicit,r=be();return Ne(r.onCopyCommand(u))}),pe(1,"Copy"),K()}}function PE(l,s){if(l&1){let i=Pt();q(0,"ion-button",5),rt("click",function(){Ue(i);let u=be().$implicit,r=be();return Ne(r.onEditCommand(u))}),pe(1,"Edit"),K()}}function ME(l,s){if(l&1&&(q(0,"ion-item",1)(1,"ion-grid")(2,"ion-row")(3,"ion-col"),pe(4),K()(),q(5,"ion-row")(6,"ion-col",2)(7,"p"),Ye(8,"img",3),K(),q(9,"ion-note"),pe(10),K(),it(11,CE,2,0,"ion-button",4)(12,PE,2,0,"ion-button",4),K(),q(13,"ion-col")(14,"ion-row")(15,"ion-col")(16,"p"),pe(17),K(),q(18,"ion-note"),pe(19),K()()(),q(20,"ion-row")(21,"ion-col"),pe(22),K(),q(23,"ion-col"),pe(24),K()()()()()()),l&2){let i=s.$implicit,p=be();Y(4),mt(" ",i.AddressInfo.Title," "),Y(4),Ce("src",p.getIconForPOI(i),zl),Y(2),mt(" ",p.getFormattedDistance(i)," "),Y(),Ce("ngIf",p.enableCopyOption),Y(),Ce("ngIf",p.enableEditOption),Y(5),mt(" ",p.getFormattedAddress(i)," "),Y(2),mt(" ",p.getFormattedConnectorList(i)," "),Y(3),mt(" ",i.UsageType==null?null:i.UsageType.Title," "),Y(2),mt(" ",i.OperatorInfo==null?null:i.OperatorInfo.Title," ")}}var hw=(()=>{class l{enableCopyOption=!1;enableEditOption=!1;poiList=[];onCopy=new Gn;onEdit=new Gn;constructor(){}ngOnInit(){}onCopyCommand(i){this.onCopy.emit(i)}onEditCommand(i){this.onEdit.emit(i)}getFormattedAddress(i){let p="";return i.AddressInfo.Title!=i.AddressInfo.AddressLine1?p+=i.AddressInfo.Title:p+=i.AddressInfo.Town,p}getFormattedConnectorList(i){if(!i.Connections)return;let p=[];for(let u of i.Connections)u.ConnectionType!=null&&(p.find(r=>r==u.ConnectionType.Title)||p.push(u.ConnectionType.Title));return p.join(", ")}getIconForPOI(i){return qn.getIconForPOI(i)}getFormattedDistance(i){return qn.getFormattedDistance(i)}static \u0275fac=function(p){return new(p||l)};static \u0275cmp=Ti({type:l,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},standalone:!1,decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(p,u){p&1&&(q(0,"ion-list"),it(1,ME,25,9,"ion-item",0),K()),p&2&&(Y(),Ce("ngForOf",u.poiList))},dependencies:[kn,Yi,Fi,du,mu,Qi,rr,fu,gu],encapsulation:2})}return l})();function AE(l,s){if(l&1&&(q(0,"ion-badge",7),pe(1),K()),l&2){let i=be().$implicit;Y(),mt("",i.Quantity," x")}}function kE(l,s){if(l&1&&(q(0,"strong"),pe(1),K()),l&2){let i=be().$implicit;Y(),mt("",i.PowerKW," kW ")}}function LE(l,s){if(l&1&&(q(0,"div"),pe(1),K()),l&2){let i=be().$implicit;Y(),mt("",i.CurrentType==null?null:i.CurrentType.Title," ")}}function DE(l,s){if(l&1&&(q(0,"span"),pe(1),K()),l&2){let i=be().$implicit;Y(),mt("",i.Amps,"A ")}}function RE(l,s){if(l&1&&(q(0,"span"),pe(1),K()),l&2){let i=be().$implicit;Y(),mt("",i.Voltage,"V ")}}function zE(l,s){if(l&1){let i=Pt();q(0,"ion-col")(1,"ion-button",8),rt("click",function(){Ue(i);let u=be().$implicit,r=be();return Ne(r.editConnection(u))}),Ye(2,"ion-icon",9),K(),Ye(3,"br"),q(4,"ion-button",10),rt("click",function(){Ue(i);let u=be().$implicit,r=be();return Ne(r.deleteConnection(u))}),Ye(5,"ion-icon",11),K()()}}function OE(l,s){if(l&1&&(q(0,"ion-row")(1,"ion-col")(2,"ion-row")(3,"ion-col",1),Ye(4,"div",2),it(5,AE,2,1,"ion-badge",3),q(6,"div",4),pe(7),K()(),q(8,"ion-col")(9,"ion-row")(10,"ion-col")(11,"ion-note")(12,"div")(13,"strong",5),pe(14),K()(),it(15,kE,2,1,"strong",6)(16,LE,2,1,"div",6),K(),q(17,"ion-note"),it(18,DE,2,1,"span",6)(19,RE,2,1,"span",6),K()()(),q(20,"ion-row")(21,"ion-col",4),pe(22),K(),q(23,"ion-col",4),pe(24),K()()(),it(25,zE,6,0,"ion-col",6),K()()()),l&2){let i=s.$implicit,p=be();Y(4),Kd("mask-image","url("+p.getConnectorTypeIcon(i.ConnectionTypeID)+")"),Y(),Ce("ngIf",i.Quantity),Y(2),yt(i.StatusType==null?null:i.StatusType.Title),Y(6),Ce("title",Fl(i.ConnectionType==null?null:i.ConnectionType.FormalName)),Y(),mt("",i.ConnectionType==null?null:i.ConnectionType.Title," "),Y(),Ce("ngIf",i.PowerKW),Y(),Ce("ngIf",i.CurrentTypeID),Y(2),Ce("ngIf",i.Amps),Y(),Ce("ngIf",i.Voltage),Y(3),yt(i.Reference),Y(2),yt(i.Comments),Y(),Ce("ngIf",p.enableEdit)}}var Tf=(()=>{class l{item;enableEdit=!1;onEdit=new Gn;onDelete=new Gn;constructor(){}ngOnInit(){}editConnection(i){this.onEdit.emit(i)}deleteConnection(i){this.onDelete.emit(i)}getConnectorTypeIcon(i){return qn.getIconForConnector(i)}static \u0275fac=function(p){return new(p||l)};static \u0275cmp=Ti({type:l,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},standalone:!1,decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[1,"connector-icon"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(p,u){p&1&&(q(0,"ion-grid"),it(1,OE,26,14,"ion-row",0),K()),p&2&&(Y(),Ce("ngForOf",u.item.Connections))},dependencies:[kn,Yi,Jd,Fi,du,mu,Bi,fu,gu],styles:[".connector-icon[_ngcontent-%COMP%]{-webkit-mask-size:100%;mask-size:100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-position:center;mask-position:center;width:64px;height:64px;background-color:currentColor;-webkit-mask-image:none;mask-image:none}"]})}return l})();function FE(l,s){if(l&1&&(q(0,"ion-select-option",5),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}function BE(l,s){l&1&&(q(0,"ion-select-option",6),pe(1,"Other..."),K())}function jE(l,s){if(l&1){let i=Pt();q(0,"ion-item")(1,"ion-label",1),pe(2,"Network Operator"),K(),q(3,"ion-select",2),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.operatorId,u)||(r.operatorId=u),Ne(u)}),rt("ionChange",function(){Ue(i);let u=be();return Ne(u.onOperatorChange())}),it(4,FE,2,2,"ion-select-option",3)(5,BE,2,0,"ion-select-option",4),K()()}if(l&2){let i=be();Y(3),vt("ngModel",i.operatorId),Y(),Ce("ngForOf",i.operators),Y(),Ce("ngIf",i.useFilteredOperators)}}function UE(l,s){if(l&1){let i=Pt();q(0,"ion-item")(1,"ion-searchbar",7),rt("ionCancel",function(){Ue(i);let u=be();return Ne(u.cancelOperatorLookup())}),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.operatorSearchKeyword,u)||(r.operatorSearchKeyword=u),Ne(u)}),rt("ionInput",function(u){Ue(i);let r=be();return Ne(r.searchOperators(u))}),K()()}if(l&2){let i=be();Y(),vt("ngModel",i.operatorSearchKeyword)}}function NE(l,s){if(l&1){let i=Pt();q(0,"ion-item",9),rt("click",function(){let u=Ue(i).$implicit,r=be(2);return Ne(r.onOperatorChange(u))}),q(1,"ion-avatar",10),Ye(2,"ion-icon",11),K(),q(3,"ion-label")(4,"p"),pe(5),K(),q(6,"p"),pe(7),K()()()}if(l&2){let i=s.$implicit;Y(5),yt(i.Title),Y(2),yt(i.WebsiteURL)}}function VE(l,s){if(l&1&&(ii(0),q(1,"ion-list"),it(2,NE,8,2,"ion-item",8),K(),ni()),l&2){let i=be();Y(2),Ce("ngForOf",i.operatorSearchResults)}}function $E(l,s){if(l&1){let i=Pt();ii(0),q(1,"ion-item")(2,"ion-avatar",10),Ye(3,"ion-icon",12),K(),q(4,"ion-label")(5,"p"),pe(6),K(),q(7,"p"),pe(8),K(),q(9,"ion-button",9),rt("click",function(){Ue(i);let u=be();return Ne(u.selectedOperator=null)}),pe(10,"Change"),K()()(),ni()}if(l&2){let i=be();Y(6),yt(i.selectedOperator.Title),Y(2),yt(i.selectedOperator.WebsiteURL)}}function GE(l,s){if(l&1){let i=Pt();q(0,"ion-chip")(1,"ion-label"),pe(2),K(),q(3,"ion-icon",14),rt("click",function(){let u=Ue(i).$implicit,r=be(2);return Ne(r.removeOperator(u))}),K()()}if(l&2){let i=s.$implicit,p=be(2);Y(2),yt(p.getOperatorInfo(i).Title)}}function qE(l,s){if(l&1&&(ii(0),it(1,GE,4,1,"ion-chip",13),ni()),l&2){let i=be();Y(),Ce("ngForOf",i.operatorList)}}var dw=(()=>{class l{referenceDataManager;changeDetector;operatorId=null;operatorList=null;mode="single";useFilteredOperators=null;operatorChanged=new Gn;operatorRemoved=new Gn;operatorCache=[];operatorSearchResults=[];operatorSearchKeyword="";selectedOperator=null;get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}constructor(i,p){this.referenceDataManager=i,this.changeDetector=p}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),this.operatorId!=null&&(this.selectedOperator=this.operatorCache.find(i=>i.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],this.operatorSearchKeyword.length!=0&&(this.operatorCache?this.operatorSearchResults=this.operatorCache.filter(i=>i.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||i.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):this.operatorSearchResults=[])}getOperatorInfo(i){if(this.operatorCache)return this.operatorCache.find(p=>p.ID==i)}onOperatorChange(i=null){return Be(this,null,function*(){i==null&&this.operatorId&&(i=this.operatorCache.find(p=>p.ID==this.operatorId)),i!=null&&(this.operatorSearchResults=[],this.selectedOperator=i,this.operatorId=i.ID),this.operatorId?(this.operatorChanged.emit(this.selectedOperator),this.mode!="single"&&(this.selectedOperator=null,this.operatorSearchKeyword="")):this.useFilteredOperators=!1})}removeOperator(i){return Be(this,null,function*(){this.operatorId=null,this.operatorRemoved.emit(i)})}cancelOperatorLookup(){this.selectedOperator=null}static \u0275fac=function(p){return new(p||l)(ot(Us),ot(zs))};static \u0275cmp=Ti({type:l,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",operatorList:"operatorList",mode:"mode",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged",operatorRemoved:"operatorRemoved"},standalone:!1,decls:5,vars:5,consts:[[4,"ngIf"],["position","floating"],[3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search network operators","showCancelButton","focus","autocomplete","on",3,"ionCancel","ngModelChange","ionInput","ngModel"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"],[4,"ngFor","ngForOf"],["name","close-circle",3,"click"]],template:function(p,u){p&1&&it(0,jE,6,3,"ion-item",0)(1,UE,2,1,"ion-item",0)(2,VE,3,1,"ng-container",0)(3,$E,11,2,"ng-container",0)(4,qE,2,1,"ng-container",0),p&2&&(Ce("ngIf",u.useFilteredOperators&&!u.selectedOperator),Y(),Ce("ngIf",!u.useFilteredOperators&&!u.selectedOperator),Y(),Ce("ngIf",u.operatorSearchResults.length>0),Y(),Ce("ngIf",u.selectedOperator!=null),Y(),Ce("ngIf",(u.operatorList==null?null:u.operatorList.length)>0))},dependencies:[kn,Yi,Fs,Fi,Jv,Bi,Qi,Rn,rr,em,pa,da,wr,ir,Ln,Dn],encapsulation:2})}return l})();function ZE(l,s){l&1&&Ye(0,"ion-icon",14)}function HE(l,s){l&1&&Ye(0,"ion-icon",14)}function KE(l,s){l&1&&Ye(0,"ion-icon",14)}function XE(l,s){if(l&1&&(q(0,"ion-select-option",26),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}function JE(l,s){if(l&1){let i=Pt();ii(0),q(1,"app-poi-location-editor",15,0),xt("latitudeChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.Latitude,u)||(r.item.AddressInfo.Latitude=u),Ne(u)})("longitudeChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.Longitude,u)||(r.item.AddressInfo.Longitude=u),Ne(u)}),rt("onUseSuggestedAddress",function(u){Ue(i);let r=be(2);return Ne(r.useSuggestedAddress(u))}),K(),q(3,"ion-list")(4,"ion-item")(5,"ion-input",16),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.Title,u)||(r.item.AddressInfo.Title=u),Ne(u)}),K()(),q(6,"ion-item")(7,"ion-input",17),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.AddressLine1,u)||(r.item.AddressInfo.AddressLine1=u),Ne(u)}),K()(),q(8,"ion-item")(9,"ion-input",18),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.AddressLine2,u)||(r.item.AddressInfo.AddressLine2=u),Ne(u)}),K()(),q(10,"ion-item")(11,"ion-input",19),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.Town,u)||(r.item.AddressInfo.Town=u),Ne(u)}),K()(),q(12,"ion-item")(13,"ion-input",20),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.StateOrProvince,u)||(r.item.AddressInfo.StateOrProvince=u),Ne(u)}),K()(),q(14,"ion-item")(15,"ion-input",21),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.Postcode,u)||(r.item.AddressInfo.Postcode=u),Ne(u)}),K()(),q(16,"ion-item")(17,"ion-select",22),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.CountryID,u)||(r.item.AddressInfo.CountryID=u),Ne(u)}),rt("ionChange",function(){Ue(i);let u=be(2);return Ne(u.onCountryChange())}),it(18,XE,2,2,"ion-select-option",23),K()(),q(19,"ion-item")(20,"ion-input",24),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.Latitude,u)||(r.item.AddressInfo.Latitude=u),Ne(u)}),K()(),q(21,"ion-item")(22,"ion-input",25),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.AddressInfo.Longitude,u)||(r.item.AddressInfo.Longitude=u),Ne(u)}),K()()(),ni()}if(l&2){let i=be(2);Y(),vt("latitude",i.item.AddressInfo.Latitude)("longitude",i.item.AddressInfo.Longitude),Y(4),vt("ngModel",i.item.AddressInfo.Title),Y(2),vt("ngModel",i.item.AddressInfo.AddressLine1),Y(2),vt("ngModel",i.item.AddressInfo.AddressLine2),Y(2),vt("ngModel",i.item.AddressInfo.Town),Y(2),vt("ngModel",i.item.AddressInfo.StateOrProvince),Y(2),vt("ngModel",i.item.AddressInfo.Postcode),Y(2),vt("ngModel",i.item.AddressInfo.CountryID),Y(),Ce("ngForOf",i.countries),Y(2),vt("ngModel",i.item.AddressInfo.Latitude),Y(2),vt("ngModel",i.item.AddressInfo.Longitude)}}function YE(l,s){if(l&1){let i=Pt();ii(0),q(1,"h3"),pe(2,"Locations Nearby"),K(),q(3,"p")(4,"strong"),pe(5,"The following locations already exist nearby."),K()(),q(6,"div",27)(7,"p"),pe(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),K(),q(9,"p"),pe(10,"You can edit any of these listings if required instead:"),K()(),q(11,"app-poi-list",28),rt("onEdit",function(u){Ue(i);let r=be(2);return Ne(r.editPOI(u))}),K(),ni()}if(l&2){let i=be(2);Y(11),Ce("poiList",i.nearbySites)("enableEditOption",!0)}}function QE(l,s){if(l&1&&(ii(0),it(1,JE,23,12,"ng-container",10)(2,YE,12,2,"ng-container",10),ni()),l&2){let i=be();Y(),Ce("ngIf",i.step=="location"),Y(),Ce("ngIf",i.step=="poi-nearby")}}function eA(l,s){if(l&1){let i=Pt();ii(0),q(1,"p"),pe(2,"Copied the equipment configuration from:"),K(),q(3,"ion-item")(4,"ion-label"),pe(5),Ye(6,"br"),pe(7),Ye(8,"br"),pe(9),Ye(10,"br"),pe(11),Ye(12,"br"),pe(13),K(),q(14,"ion-button",30),rt("click",function(){Ue(i);let u=be(5);return Ne(u.changeTemplatePOI())}),pe(15,"Change.."),K()(),ni()}if(l&2){let i=be(5);Y(5),mt(" ",i.selectedTemplatePOI.AddressInfo.Title," "),Y(2),mt(" ",i.selectedTemplatePOI.AddressInfo.AddressLine1," "),Y(2),mt(" ",i.selectedTemplatePOI.Connections[0].ConnectionType==null?null:i.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),Y(2),mt(" ",i.selectedTemplatePOI.Connections[0].PowerKW," "),Y(2),mt(" ",i.selectedTemplatePOI.DateCreated," ")}}function tA(l,s){if(l&1){let i=Pt();ii(0),q(1,"h4"),pe(2,"Similar Sites"),K(),q(3,"app-poi-list",31),rt("onCopy",function(u){Ue(i);let r=be(6);return Ne(r.useTemplatePOI(u))}),K(),ni()}if(l&2){let i=be(6);Y(3),Ce("enableCopyOption",!0)("poiList",i.templateSites)}}function iA(l,s){l&1&&(ii(0),q(1,"p"),pe(2," There are no suggested sites to copy for this network operator. "),K(),ni())}function nA(l,s){if(l&1&&(ii(0),it(1,tA,4,2,"ng-container",10)(2,iA,3,0,"ng-container",10),ni()),l&2){let i=be(5);Y(),Ce("ngIf",i.templateSites.length>0),Y(),Ce("ngIf",i.templateSites.length==0)}}function rA(l,s){if(l&1&&(ii(0),it(1,eA,16,5,"ng-container",10)(2,nA,3,2,"ng-container",10),ni()),l&2){let i=be(4);Y(),Ce("ngIf",i.selectedTemplatePOI),Y(),Ce("ngIf",!i.selectedTemplatePOI)}}function oA(l,s){if(l&1){let i=Pt();ii(0),q(1,"p",27),pe(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),K(),q(3,"app-operator-lookup",29),rt("operatorChanged",function(u){Ue(i);let r=be(3);return Ne(r.onOperatorChange(u))}),K(),it(4,rA,3,2,"ng-container",10),ni()}if(l&2){let i=be(3);Y(3),Ce("operatorId",i.item.OperatorID),Y(),Ce("ngIf",i.item.AddressInfo.CountryID&&i.item.OperatorID)}}function aA(l,s){if(l&1&&(ii(0),it(1,oA,5,2,"ng-container",10),ni()),l&2){let i=be(2);Y(),Ce("ngIf",!i.skipPOICopy)}}function sA(l,s){if(l&1){let i=Pt();ii(0),q(1,"app-operator-lookup",32),rt("operatorChanged",function(u){Ue(i);let r=be(2);return Ne(r.onOperatorChange(u))}),K(),q(2,"ion-item")(3,"ion-input",33),xt("ngModelChange",function(u){Ue(i);let r=be(2);return _t(r.item.NumberOfPoints,u)||(r.item.NumberOfPoints=u),Ne(u)}),K()(),q(4,"h4"),pe(5,"Equipment"),K(),q(6,"ion-button",34),rt("click",function(){Ue(i);let u=be(2);return Ne(u.addConnection())}),Ye(7,"ion-icon",35),K(),q(8,"app-equipment-details",36),rt("onEdit",function(u){Ue(i);let r=be(2);return Ne(r.editConnection(u))})("onDelete",function(u){Ue(i);let r=be(2);return Ne(r.deleteConnection(u))}),K(),ni()}if(l&2){let i=be(2);Y(),Ce("operatorId",i.item.OperatorID)("useFilteredOperators",!1),Y(2),vt("ngModel",i.item.NumberOfPoints),Y(5),Ce("item",i.item)("enableEdit",!0)}}function lA(l,s){if(l&1&&(ii(0),it(1,aA,2,1,"ng-container",10)(2,sA,9,5,"ng-container",10),ni()),l&2){let i=be();Y(),Ce("ngIf",i.step=="copy-equipment"),Y(),Ce("ngIf",i.step=="edit-equipment")}}function cA(l,s){if(l&1&&(q(0,"p",46)(1,"strong"),pe(2,"Your changes cannot be saved until the following issues are resolved:"),K(),q(3,"ion-label",47),pe(4),K()()),l&2){let i=be(2);Y(4),mt(" ",i.validationMsg)}}function uA(l,s){if(l&1&&(q(0,"ion-select-option",26),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}function hA(l,s){if(l&1&&(q(0,"ion-select-option",26),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}function pA(l,s){if(l&1){let i=Pt();ii(0),it(1,cA,5,1,"p",37),q(2,"p"),pe(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),K(),q(4,"ion-item")(5,"ion-select",38),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.item.StatusTypeID,u)||(r.item.StatusTypeID=u),Ne(u)}),it(6,uA,2,2,"ion-select-option",23),K()(),q(7,"ion-item")(8,"ion-select",39),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.item.UsageTypeID,u)||(r.item.UsageTypeID=u),Ne(u)}),it(9,hA,2,2,"ion-select-option",23),K()(),q(10,"ion-item")(11,"ion-input",40),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.item.UsageCost,u)||(r.item.UsageCost=u),Ne(u)}),K()(),q(12,"ion-item")(13,"ion-input",41),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.item.GeneralComments,u)||(r.item.GeneralComments=u),Ne(u)}),K()(),q(14,"ion-item")(15,"ion-input",42),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.item.AddressInfo.ContactTelephone1,u)||(r.item.AddressInfo.ContactTelephone1=u),Ne(u)}),K()(),q(16,"ion-item")(17,"ion-input",43),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.item.AddressInfo.ContactTelephone2,u)||(r.item.AddressInfo.ContactTelephone2=u),Ne(u)}),K()(),q(18,"ion-item")(19,"ion-input",44),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.item.AddressInfo.AccessComments,u)||(r.item.AddressInfo.AccessComments=u),Ne(u)}),K()(),q(20,"ion-item")(21,"ion-input",45),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.item.AddressInfo.RelatedURL,u)||(r.item.AddressInfo.RelatedURL=u),Ne(u)}),K()(),ni()}if(l&2){let i=be();Y(),Ce("ngIf",i.validationMsg),Y(4),vt("ngModel",i.item.StatusTypeID),Y(),Ce("ngForOf",i.statusTypes),Y(2),vt("ngModel",i.item.UsageTypeID),Y(),Ce("ngForOf",i.usageTypes),Y(2),vt("ngModel",i.item.UsageCost),Y(2),vt("ngModel",i.item.GeneralComments),Y(2),vt("ngModel",i.item.AddressInfo.ContactTelephone1),Y(2),vt("ngModel",i.item.AddressInfo.ContactTelephone2),Y(2),vt("ngModel",i.item.AddressInfo.AccessComments),Y(2),vt("ngModel",i.item.AddressInfo.RelatedURL)}}function dA(l,s){if(l&1){let i=Pt();q(0,"ion-button",2),rt("click",function(){Ue(i);let u=be();return Ne(u.previous())}),pe(1," Previous "),Ye(2,"ion-icon",48),K()}}function mA(l,s){if(l&1){let i=Pt();q(0,"ion-button",2),rt("click",function(){Ue(i);let u=be();return Ne(u.next())}),pe(1," Next "),Ye(2,"ion-icon",49),K()}}function fA(l,s){if(l&1){let i=Pt();q(0,"ion-button",50),rt("click",function(){Ue(i);let u=be();return Ne(u.save())}),pe(1," Submit "),Ye(2,"ion-icon",51),K()}}var mw=(()=>{class l{appManager;modalController;poiManager;mapping;loadingController;alertController;id;item;step;selectedTab;startPos;useFilteredConnectionTypes=!0;templateSites=[];nearbySites=[];selectedTemplatePOI=null;suggestedAddress=null;suggestedAddressAttribution=null;isNonDuplicateConfirmed=!1;skipPOICopy=!1;validationMsg=null;loading;editorMap;get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(i=>i.IsUserSelectable==!0)}get isAddMode(){return this.item.ID<=0}constructor(i,p,u,r,x,C){this.appManager=i,this.modalController=p,this.poiManager=u,this.mapping=r,this.loadingController=x,this.alertController=C,this.initNewItem()}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&this.step=="info"}ngOnInit(){}presentLoadingUI(){return Be(this,null,function*(){this.loading=yield this.loadingController.create({message:"Please Wait.."}),yield this.loading.present()})}dismissLoadingUI(){return Be(this,null,function*(){this.loading&&(yield this.loading.dismiss())})}ionViewDidEnter(){if(this.id!=null)this.editExistingPOI(this.id);else{let i=localStorage.getItem("_editor-operatorid");i&&(this.item.OperatorID=parseInt(i,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(p=>{p&&(this.item.AddressInfo.Latitude=p.coords.latitude,this.item.AddressInfo.Longitude=p.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){return Be(this,null,function*(){switch(this.step){case"info":this.step="edit-equipment";break;case"edit-equipment":this.step=this.isAddMode?"copy-equipment":"location";break;case"copy-equipment":this.step="location";break;case"poi-nearby":this.step="location";break}yield this.initCurrentStep(!1)})}next(){return Be(this,null,function*(){if(this.step=="poi-nearby"&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed){(yield this.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:u=>{}},{text:"Confirm",handler:()=>{this.isNonDuplicateConfirmed=!0,this.next()}}]})).present();return}let i=this.validate(this.step);if(i.isValid){switch(this.step){case"location":this.step=this.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":this.step=this.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":this.step="edit-equipment";break;case"edit-equipment":this.step="info";break}yield this.initCurrentStep(!0)}else(yield this.alertController.create({message:i.msg})).present()})}initCurrentStep(i){return Be(this,null,function*(){this.step=="poi-nearby"?(this.selectedTab="location",(yield this.refreshNearbySites())==0&&(i?yield this.next():yield this.previous())):this.step=="location"?this.selectedTab="location":this.step=="copy-equipment"?(this.selectedTab="equipment",yield this.refreshTemplateSites()):this.step=="edit-equipment"?this.selectedTab="equipment":this.step=="info"&&(this.selectedTab="info")})}onCountryChange(){return Be(this,null,function*(){this.refreshFilteredReferenceData()})}onOperatorChange(i=null){return Be(this,null,function*(){i!=null&&this.item.OperatorID!=i.ID&&(this.item.OperatorID=i.ID,localStorage.setItem("_editor-operatorid",this.item.OperatorID.toString()),yield this.refreshTemplateSites())})}useSuggestedAddress(i=null){i&&(this.suggestedAddress=i.suggestedAddress,this.suggestedAddressAttribution=i.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(p=>p.MetadataFieldID==4)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(i){return Be(this,null,function*(){let p=this.item.Connections.find(x=>x.ID==i.ID),u=Object.assign({},p),r=yield this.modalController.create({component:W_,componentProps:{conn:u}});return r.onWillDismiss().then(x=>{x&&x.data&&x.data.item&&this.updateConnection(x.data.item)}),yield r.present()})}deleteConnection(i){return Be(this,null,function*(){let p=this.item.Connections.find(r=>r.ID==i.ID);(yield this.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{this.item.Connections=this.item.Connections.filter(r=>r.ID!=p.ID),this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}}]})).present()})}addConnection(){return Be(this,null,function*(){let i={ID:-qn.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},p=yield this.modalController.create({component:W_,componentProps:{conn:i}});return p.onWillDismiss().then(u=>{u&&u.data&&u.data.item&&this.updateConnection(u.data.item)}),yield p.present()})}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(i){if(i){let p=this.item.Connections.find(u=>u.ID==i.ID);p?Object.assign(p,i):this.item.Connections.push(i)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(i="all"){let p=null;return this.item==null?{isValid:!1,msg:"POI item is not defined"}:((i=="all"||i=="location")&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(p="Location is required"),this.item.AddressInfo.Title==""&&(p="A location title is required"),!this.item.AddressInfo.AddressLine1&&!this.item.AddressInfo.AddressLine2&&(p="An approximate address is required."),this.item.AddressInfo.CountryID||(p="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(p="A location latitude and longitude is required")),(i=="all"||i=="poi-nearby")&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(p="Please confirm that the site is not a duplicate"),(i=="all"||i=="equipment")&&(this.item.OperatorID||(p="Please confirm the charging network or equipment operator."),this.item.Connections.length==0&&(p="Equipment information is required")),p?(this.validationMsg=p,{isValid:!1,msg:p}):(this.validationMsg=null,{isValid:!0,msg:null}))}save(){return Be(this,null,function*(){let i=this.validate();if(!i.isValid){alert(i.msg);return}yield this.presentLoadingUI();try{yield this.appManager.submitPOI(this.item),yield this.dismissLoadingUI(),this.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),this.modalController.dismiss()}catch(p){yield this.dismissLoadingUI(),p.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}})}cancel(){return Be(this,null,function*(){this.modalController.dismiss()})}refreshTemplateSites(){return Be(this,null,function*(){if(this.item.AddressInfo.CountryID&&this.item.OperatorID){yield this.presentLoadingUI(),this.templateSites=[];let i=new Vs;i.countryIdList=[this.item.AddressInfo.CountryID],i.minPowerKW=1,i.operatorIdList=[this.item.OperatorID],i.maxResults=10;let p=yield this.poiManager.fetchPOIList(i);p.sort((u,r)=>new Date(u.DateCreated).getTime()-new Date(r.DateCreated).getTime()),this.templateSites=p,this.dismissLoadingUI()}})}refreshNearbySites(){return Be(this,null,function*(){if(this.item.AddressInfo.Latitude&&this.item.AddressInfo.Longitude){yield this.presentLoadingUI(),this.nearbySites=[];let i=new Vs;i.latitude=this.item.AddressInfo.Latitude,i.longitude=this.item.AddressInfo.Longitude,i.distance=5,i.distanceUnit="km",i.maxResults=10;let p=yield this.poiManager.fetchPOIList(i);return p.sort((u,r)=>u.Distance-r.Distance),this.nearbySites=p,this.dismissLoadingUI(),p.length}else return 0})}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(i){this.editExistingPOI(i.ID)}editExistingPOI(i){return Be(this,null,function*(){this.skipPOICopy=!0,this.isNonDuplicateConfirmed=!0,yield this.presentLoadingUI(),this.poiManager.getPOIById(i,!0,!0).then(p=>{this.item=Object.assign({},p),this.item.OperatorID==null&&(this.item.OperatorID=H_.UnknownOperator),this.refreshFilteredReferenceData(),this.dismissLoadingUI()})})}useTemplatePOI(i){this.selectedTemplatePOI=i,Object.assign(this.item.Connections,i.Connections);for(let p of this.item.Connections)p.ID=-qn.getRandomInt(1e4),p.Reference=null,p.Comments=null,p.StatusTypeID=Z_.Operational;this.item.UsageCost=i.UsageCost,this.item.UsageTypeID=i.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}static \u0275fac=function(p){return new(p||l)(ot(Pr),ot(Ir),ot(Su),ot(Uu),ot(Bs),ot(nm))};static \u0275cmp=Ti({type:l,selectors:[["app-poi-editor"]],viewQuery:function(p,u){if(p&1&&Fv(If,5),p&2){let r;Bv(r=jv())&&(u.editorMap=r.first)}},standalone:!1,decls:33,vars:14,consts:[["editorMap",""],["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitudeChange","longitudeChange","onUseSuggestedAddress","latitude","longitude"],["label","Location Name","label-placement","floating","type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModelChange","ngModel"],["label","Address Line 1","label-placement","floating","type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModelChange","ngModel"],["label","Address Line 2","label-placement","floating","type","text","autocapitalize","words","placeholder","Optional",3,"ngModelChange","ngModel"],["label","Town","label-placement","floating","type","text","autocapitalize","words","placeholder","Town or City",3,"ngModelChange","ngModel"],["label","State or Province","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","Postal Code","label-placement","floating","type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModelChange","ngModel"],["label","Country","label-placement","floating",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["label","Latitude","labelPlacement","floating","type","number","placeholder","Latitude (if entering manually)",3,"ngModelChange","ngModel"],["label","Longitude","labelPlacement","floating","type","number","placeholder","Longitude (if entering manually)",3,"ngModelChange","ngModel"],[3,"value"],[1,"instruction"],[3,"onEdit","poiList","enableEditOption"],[3,"operatorChanged","operatorId"],["slot","start","size","small",3,"click"],[3,"onCopy","enableCopyOption","poiList"],[3,"operatorChanged","operatorId","useFilteredOperators"],["label","Number of Stations or Parking Bays","labelPlacement","floating","min","1","type","number",3,"ngModelChange","ngModel"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"onEdit","onDelete","item","enableEdit"],["color","warning",4,"ngIf"],["label","Operational Status (All Equipment)","label-placement","floating",3,"ngModelChange","ngModel"],["label","Usage Type","label-placement","floating",3,"ngModelChange","ngModel"],["label","Usage Cost","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","General Comments","label-placement","floating","type","text","autocapitalize","sentences",3,"ngModelChange","ngModel"],["label","Main Telephone Number","label-placement","floating","type","tel","placeholder","",3,"ngModelChange","ngModel"],["label","Other Telephone Number","label-placement","floating","type","tel","placeholder","",3,"ngModelChange","ngModel"],["label","Access Comments","label-placement","floating","type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModelChange","ngModel"],["label","Related Website","label-placement","floating","type","url","placeholder","Website related to this site",3,"ngModelChange","ngModel"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(p,u){p&1&&(q(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),pe(3),K(),q(4,"ion-buttons",1)(5,"ion-button",2),rt("click",function(){return u.cancel()}),Ye(6,"ion-icon",3),pe(7," Cancel "),K()()()(),q(8,"ion-content",4),ii(9),q(10,"ion-segment",5)(11,"ion-segment-button",6),it(12,ZE,1,0,"ion-icon",7),q(13,"ion-label"),pe(14,"Location"),K()(),q(15,"ion-segment-button",8),it(16,HE,1,0,"ion-icon",7),q(17,"ion-label"),pe(18,"Equipment"),K()(),q(19,"ion-segment-button",9),it(20,KE,1,0,"ion-icon",7),q(21,"ion-label"),pe(22,"Info"),K()()(),it(23,QE,3,2,"ng-container",10)(24,lA,3,2,"ng-container",10)(25,pA,22,11,"ng-container",10),ni(),K(),q(26,"ion-footer")(27,"ion-toolbar")(28,"ion-buttons",11),it(29,dA,3,0,"ion-button",12),K(),q(30,"ion-buttons",1),it(31,mA,3,0,"ion-button",12)(32,fA,3,0,"ion-button",13),K()()()),p&2&&(Y(3),yt(u.isAddMode?"Add Location":"Edit Location"),Y(7),Ce("ngModel",u.selectedTab),Y(),Ce("disabled",!0),Y(),Ce("ngIf",u.selectedTab=="location"),Y(3),Ce("disabled",!0),Y(),Ce("ngIf",u.selectedTab=="equipment"),Y(3),Ce("disabled",!0),Y(),Ce("ngIf",u.selectedTab=="info"),Y(3),Ce("ngIf",u.selectedTab=="location"),Y(),Ce("ngIf",u.selectedTab=="equipment"),Y(),Ce("ngIf",u.selectedTab=="info"),Y(4),Ce("ngIf",u.step!="location"),Y(2),Ce("ngIf",!u.isReadyToSubmit&&u.step!="info"),Y(),Ce("ngIf",u.isReadyToSubmit))},dependencies:[kn,Yi,Ln,Dn,Fi,nr,ho,po,mo,Bi,Sr,Qi,Rn,rr,_u,yu,pa,da,fo,or,pu,wr,ir,im,hw,Tf,If,dw],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']})}return l})();function gA(l,s){l&1&&(q(0,"div"),Ye(1,"ion-spinner"),K())}function _A(l,s){if(l&1){let i=Pt();q(0,"ion-item",5),rt("click",function(){let u=Ue(i).$implicit,r=be(2);return Ne(r.placeSelected(u))}),q(1,"ion-avatar",6),Ye(2,"ion-icon",7),K(),q(3,"ion-label")(4,"p"),pe(5),K()()()}if(l&2){let i=s.$implicit;Y(5),yt(i.Address)}}function yA(l,s){if(l&1&&(q(0,"div",1),it(1,gA,2,0,"div",2),q(2,"ion-list"),it(3,_A,6,1,"ion-item",3),q(4,"ion-item")(5,"p",4),pe(6),K()()()()),l&2){let i=be();Y(),Ce("ngIf",i.searchInProgress),Y(2),Ce("ngForOf",i.placeList),Y(3),mt(" ",i.placeAttribution," ")}}var fw=(()=>{class l{logging;changeDetector;platform;http;events;placeSearchType;placeList;searchInProgress=!1;searchKeyword;placeSearchFocused;placeSearchActive=!1;placeAttribution="";selectedPlace;placeChanged=new Gn;mapService;constructor(i,p,u,r,x){this.logging=i,this.changeDetector=p,this.platform=u,this.http=r,this.events=x,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new ju(x,i,r)}ngOnInit(){return Be(this,null,function*(){yield this.platform.ready(),this.mapService.initAPI()})}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(i,p){return Be(this,null,function*(){this.placeSearchType=p;let u=i.target.value;if(u&&u.length>3){this.logging.log("Starting place lookup for:"+u),this.placeSearchActive=!0,this.searchInProgress=!0,this.searchInProgress=!1,this.placeSearchActive=!0;try{this.placeList=yield this.mapService.placeSearch(u),this.placeList&&this.placeList.length>0&&(this.placeAttribution=this.placeList[0].Attribution);let r=yield this.detectAlternativeSearchResultType(u);r&&this.placeList.unshift(r)}catch{}this.searchInProgress=!1,this.placeSearchActive=!0}else this.searchInProgress=!1,this.placeSearchActive=!1})}ConvertDMSToDD(i,p,u,r){var x=Number(i)+Number(p)/60+Number(u)/3600;return(r=="S"||r=="W")&&(x=x*-1),x}ParseDMS(i){try{var p=i.split(/[^\d\w\.]+/),u=this.ConvertDMSToDD(p[0],p[1],p[2],p[3]),r=this.ConvertDMSToDD(p[4],p[5],p[6],p[7]);return new qi(u,r)}catch{return null}}detectAlternativeSearchResultType(i){return Be(this,null,function*(){if(i=i.trim(),i.startsWith("OCM-")&&(i=i.replace("OCM-","")),Number.isInteger(Number(i))){let r=new Wa;return r.Title="Go to OCM ID",r.Address="OCM-"+i,r.ReferenceID="OCM-"+i,r}let p=i.match(/^\s*((lat|latitude)(:)?)?\s*((\-)?[0-9]+\.[0-9]+)\s*(,?)\s*((lng|lon|longitude)(:)?)?\s*((\-)?[0-9]+\.[0-9]+)\s*$/gi);if(p&&p.length>0){let x=(""+i.match(/((\-)?[0-9]+\.[0-9]+)+/g)).split(","),C=new Wa;return C.Title="Go to Lat/Lng",C.Address="Lat:"+x[0]+", Lng:"+x[1],C.Location=new qi(parseFloat(x[0]),parseFloat(x[1])),C}else{var u=this.ParseDMS(i);if(u&&!isNaN(u.latitude)&&!isNaN(u.longitude)){let r=new Wa;return r.Title="Go to Lat/Lng",r.Address="Lat:"+u.latitude+", Lng:"+u.longitude,r.Location=u,r}else return null}})}placeSelected(i){let p=i.Title;this.logging.log("Looking up place details:"+p+"::"+i.ReferenceID),this.selectedPlace=i,this.placeChanged.emit(i),this.placeSearchActive=!1}static \u0275fac=function(p){return new(p||l)(ot(pi),ot(zs),ot(cu),ot(tr),ot(Tr))};static \u0275cmp=Ti({type:l,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},standalone:!1,decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(p,u){p&1&&it(0,yA,7,3,"div",0),p&2&&Ce("ngIf",u.placeSearchActive)},dependencies:[kn,Yi,Fs,Bi,Qi,Rn,rr,tm],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]})}return l})();function xA(l,s){if(l&1){let i=Pt();q(0,"ion-card")(1,"ion-toolbar")(2,"ion-title",14),pe(3,"Preview"),K(),q(4,"ion-buttons",15)(5,"ion-button",5),rt("click",function(){Ue(i);let u=be();return Ne(u.rotateImage())}),Ye(6,"ion-icon",16),q(7,"ion-label"),pe(8,"Rotate"),K()()()(),q(9,"ion-card-content")(10,"ion-list")(11,"ion-item")(12,"ion-label",17),pe(13,"Comment"),K(),q(14,"ion-input",18),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.comment,u)||(r.comment=u),Ne(u)}),K()()(),Ye(15,"img",19),K()()}if(l&2){let i=be();Y(14),vt("ngModel",i.comment)}}var gw=(()=>{class l{navParams;appManager;nav;modalController;logging;mode;processingQuality;imgData;targetWidth;targetHeight;comment;chargePointId;poi;constructor(i,p,u,r,x){this.navParams=i,this.appManager=p,this.nav=u,this.modalController=r,this.logging=x,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=p.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(i){let p=i,u=document.getElementById("img-upload-canvas"),r=u.getContext("2d"),x=new Image;x.onload=()=>{this.logging.log("img load:"+x.width),u.width=x.width,u.height=x.height,r.fillStyle="rgb(0,0,0)",r.fillRect(0,0,u.width,u.height),r.drawImage(x,0,0,u.width,u.height),this.imgData=u.toDataURL("image/png"),this.processImage()},x.src=p}loadCameraOrLibraryImage(i=!1){this.logging.log("PWA mode: fetching image");let p=new FileReader;p.onload=()=>{this.imgData=p.result,this.processImage()},p.onerror=()=>{},p.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){let i=this;if(this.imgData!=null){let p=document.getElementById("img-upload-canvas"),u=p.getContext("2d"),r=new Image;r.onload=()=>{p.width=r.width,p.height=r.height,u.fillStyle="rgb(0,0,0)",u.fillRect(0,0,p.width,p.height),u.drawImage(r,0,0,p.width,p.height),this.refreshImageFromCanvas()},r.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){let i=document.getElementById("img-upload-canvas");this.imgData=i.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){let i=document.getElementById("img-upload-canvas"),p=new Image;p.src=i.toDataURL(),p.onload=()=>{let u=i.height,r=i.width;i.width=u,i.height=r,u=i.height,r=i.width;let x=i.getContext("2d");x.save(),x.translate(r,u/r),x.rotate(Math.PI/2),x.drawImage(p,0,0),x.restore(),p=null,this.refreshImageFromCanvas()}}performUpload(){return Be(this,null,function*(){if(!this.imgData){yield this.appManager.showToastNotification("Select an image to upload.");return}let i={chargePointID:this.chargePointId,comment:this.comment,imageDataBase64:this.imgData};yield this.appManager.showLoadingProgress("Uploading photo..");try{let p=yield this.appManager.submitMediaItem(i);this.appManager.dismissLoadingProgress().then(()=>{this.appManager.showToastNotification("Upload completed"),this.modalController.dismiss()}),this.appManager.analytics.appEvent("MediaUpload","Completed")}catch{yield this.appManager.dismissLoadingProgress(),yield this.appManager.showToastNotification("Upload failed, please try again."),this.appManager.analytics.appEvent("MediaUpload","Failed")}})}cancel(){return Be(this,null,function*(){yield this.modalController.dismiss()})}static \u0275fac=function(p){return new(p||l)(ot(hu),ot(Pr),ot(uu),ot(Ir),ot(pi))};static \u0275cmp=Ti({type:l,selectors:[["ng-component"]],standalone:!1,decls:32,vars:3,consts:[["inputFile",""],[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModelChange","ngModel"],["id","preview",2,"max-width","500px"]],template:function(p,u){if(p&1){let r=Pt();q(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),pe(3," Share Photo "),K()()(),q(4,"ion-content",1)(5,"div",2)(6,"div",3)(7,"h1"),pe(8),K(),q(9,"p"),pe(10),K()(),q(11,"p"),pe(12,"You can upload a photo from your device or take a new photo: "),K(),q(13,"div",4)(14,"ion-button",5),rt("click",function(){Ue(r);let C=Ol(19);return Ne(C.click())}),Ye(15,"ion-icon",6),q(16,"ion-label"),pe(17,"Choose Photo.."),K()(),q(18,"input",7,0),rt("change",function(){return Ue(r),Ne(u.loadCameraOrLibraryImage())}),K()(),Ye(20,"canvas",8),it(21,xA,16,1,"ion-card",9),K()(),q(22,"ion-footer")(23,"ion-toolbar")(24,"ion-buttons",10)(25,"ion-button",5),rt("click",function(){return Ue(r),Ne(u.cancel())}),Ye(26,"ion-icon",11),pe(27," Cancel "),K()(),q(28,"ion-buttons",12)(29,"ion-button",5),rt("click",function(){return Ue(r),Ne(u.performUpload())}),pe(30," Upload "),Ye(31,"ion-icon",13),K()()()()}p&2&&(Y(8),yt(u.poi.AddressInfo.Title),Y(2),yt(u.poi.AddressInfo.AddressLine1),Y(11),Ce("ngIf",u.imgData!=null))},dependencies:[Yi,Ln,Dn,Fi,nr,Yd,Qd,ho,po,mo,Bi,Sr,Qi,Rn,rr,fo,or,ir],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]})}return l})();function bA(l,s){if(l&1&&(q(0,"ion-select-option",19),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}function wA(l,s){if(l&1&&(q(0,"ion-select-option",19),pe(1),K()),l&2){let i=s.$implicit;Ce("value",i.ID),Y(),yt(i.Title)}}var _w=(()=>{class l{navParams;appManager;nav;zone;loadingController;modalController;logging;router;commentModel;poi;commentTypes;checkinTypes;constructor(i,p,u,r,x,C,A,R){this.navParams=i,this.appManager=p,this.nav=u,this.zone=r,this.loadingController=x,this.modalController=C,this.logging=A,this.router=R,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=p.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=p.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){return Be(this,null,function*(){let i=yield this.loadingController.create({message:"Sending .."});yield i.present(),(yield this.appManager.submitComment(this.commentModel).catch(u=>{this.appManager.showToastNotification("There was a problem submitting your comment."),this.loadingController.dismiss(),this.appManager.analytics.appEvent("Comment","Failed")}))&&(this.logging.log("Comment submitted"),yield i.dismiss(),yield this.modalController.dismiss(),this.appManager.analytics.appEvent("Comment","Submitted"))})}static \u0275fac=function(p){return new(p||l)(ot(hu),ot(Pr),ot(uu),ot(Ov),ot(Bs),ot(Ir),ot(pi),ot(lu))};static \u0275cmp=Ti({type:l,selectors:[["ng-component"]],standalone:!1,decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModelChange","ngModel"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(p,u){p&1&&(q(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),pe(3," Add Comment "),K()()(),q(4,"ion-content",1)(5,"div",2)(6,"h1"),pe(7),K(),q(8,"p"),pe(9),K()(),q(10,"p",3),pe(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),K(),q(12,"ion-list")(13,"ion-item")(14,"ion-label",4),pe(15,"Comment Type"),K(),q(16,"ion-select",5),xt("ngModelChange",function(x){return _t(u.commentModel.CommentTypeID,x)||(u.commentModel.CommentTypeID=x),x}),it(17,bA,2,2,"ion-select-option",6),K()(),q(18,"ion-item")(19,"ion-label",4),pe(20,"What Did You Think?"),K(),q(21,"ion-input",7),xt("ngModelChange",function(x){return _t(u.commentModel.Comment,x)||(u.commentModel.Comment=x),x}),K()(),q(22,"ion-item")(23,"ion-label",4),pe(24,"Did You Successfully Charge?"),K(),q(25,"ion-select",5),xt("ngModelChange",function(x){return _t(u.commentModel.CheckinStatusTypeID,x)||(u.commentModel.CheckinStatusTypeID=x),x}),it(26,wA,2,2,"ion-select-option",6),K()(),q(27,"ion-item")(28,"ion-label",4),pe(29,"Your Rating"),K(),q(30,"ion-select",5),xt("ngModelChange",function(x){return _t(u.commentModel.Rating,x)||(u.commentModel.Rating=x),x}),q(31,"ion-select-option",8),pe(32,"5 - Excellent"),K(),q(33,"ion-select-option",9),pe(34,"4 - Good"),K(),q(35,"ion-select-option",10),pe(36,"3 - Average"),K(),q(37,"ion-select-option",11),pe(38,"2 - Not Good"),K(),q(39,"ion-select-option",12),pe(40,"1 - Bad"),K(),q(41,"ion-select-option",13),pe(42,"Not Rated"),K()()()()(),q(43,"ion-footer")(44,"ion-toolbar")(45,"ion-buttons",14)(46,"ion-button",15),rt("click",function(){return u.cancel()}),Ye(47,"ion-icon",16),pe(48," Cancel "),K()(),q(49,"ion-buttons",17)(50,"ion-button",15),rt("click",function(){return u.add()}),pe(51," Submit "),Ye(52,"ion-icon",18),K()()()()),p&2&&(Y(7),yt(u.poi.AddressInfo.Title),Y(2),yt(u.poi.AddressInfo.AddressLine1),Y(7),vt("ngModel",u.commentModel.CommentTypeID),Y(),Ce("ngForOf",u.commentTypes),Y(4),vt("ngModel",u.commentModel.Comment),Y(4),vt("ngModel",u.commentModel.CheckinStatusTypeID),Y(),Ce("ngForOf",u.checkinTypes),Y(4),vt("ngModel",u.commentModel.Rating))},dependencies:[kn,Ln,Dn,Fi,nr,ho,po,mo,Bi,Sr,Qi,Rn,rr,pa,da,fo,or,wr,ir],encapsulation:2})}return l})();var Cf=class{baseURL;loginProviderRedirectBaseURL;loginProviderRedirectURL;enableLiveMapQuerying;googleMapsAPIKey;enableStaticMaps;constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=dr.googleMapsKey,this.enableStaticMaps=dr.enableStaticMaps}};function SA(l,s){if(l&1&&(q(0,"div")(1,"small"),pe(2),K()()),l&2){let i=be(2);Y(2),yt(i.connectionSummary)}}function IA(l,s){if(l&1&&(q(0,"div")(1,"small"),pe(2),K()()),l&2){let i=be(2);Y(2),yt(i.poi.OperatorInfo.Title)}}function TA(l,s){l&1&&(q(0,"div")(1,"small"),pe(2,"[Submission Awaiting Review]"),K()())}function CA(l,s){if(l&1){let i=Pt();ii(0),q(1,"ion-button",30),rt("click",function(){Ue(i);let u=be(2);return Ne(u.addFavourite())}),Ye(2,"ion-icon",31),q(3,"ion-label"),pe(4,"Favourite"),K()(),q(5,"ion-button",32),rt("click",function(){Ue(i);let u=be(2);return Ne(u.edit())}),Ye(6,"ion-icon",33),q(7,"ion-label"),pe(8,"Edit"),K()(),ni()}}function PA(l,s){if(l&1){let i=Pt();ii(0),q(1,"ion-button",34),rt("click",function(){Ue(i);let u=be(2);return Ne(u.launchNavigation())}),Ye(2,"ion-icon",35),q(3,"ion-label"),pe(4,"Navigate"),K()(),ni()}}function MA(l,s){if(l&1){let i=Pt();ii(0),q(1,"ion-button",36),rt("click",function(){Ue(i);let u=be(2);return Ne(u.addComment())}),Ye(2,"ion-icon",37),q(3,"ion-label"),pe(4,"Add Comment"),K()(),ni()}}function EA(l,s){if(l&1){let i=Pt();ii(0),q(1,"ion-button",38),rt("click",function(){Ue(i);let u=be(2);return Ne(u.addMedia())}),Ye(2,"ion-icon",39),q(3,"ion-label"),pe(4," Add Photo"),K()(),ni()}}function AA(l,s){if(l&1&&(q(0,"div"),pe(1),K()),l&2){let i=be(4);Y(),mt(" ",i.poi.AddressInfo.AddressLine1)}}function kA(l,s){if(l&1&&(q(0,"div"),pe(1),K()),l&2){let i=be(4);Y(),mt(" ",i.poi.AddressInfo.AddressLine2)}}function LA(l,s){if(l&1&&(q(0,"div"),pe(1),K()),l&2){let i=be(4);Y(),mt(" ",i.poi.AddressInfo.Town)}}function DA(l,s){if(l&1&&(q(0,"div"),pe(1),K()),l&2){let i=be(4);Y(),mt(" ",i.poi.AddressInfo.StateOrProvince)}}function RA(l,s){if(l&1&&(q(0,"div"),pe(1),K()),l&2){let i=be(4);Y(),mt(" ",i.poi.AddressInfo.Postcode)}}function zA(l,s){if(l&1&&(q(0,"div"),pe(1),K()),l&2){let i=be(4);Y(),mt(" ",i.poi.AddressInfo.Country.Title)}}function OA(l,s){if(l&1&&(q(0,"p"),pe(1),K()),l&2){let i=be(4);Y(),mt(" ",i.poi.AddressInfo.AccessComments," ")}}function FA(l,s){if(l&1&&(q(0,"p"),Ye(1,"ion-icon",44),q(2,"span",42),pe(3),K()()),l&2){let i=be(4);Y(3),yt(i.poi.AddressInfo.ContactTelephone1)}}function BA(l,s){if(l&1&&(q(0,"p"),Ye(1,"ion-icon",44),q(2,"span",42),pe(3),K()()),l&2){let i=be(4);Y(3),yt(i.poi.AddressInfo.ContactTelephone2)}}function jA(l,s){if(l&1&&(q(0,"p"),Ye(1,"ion-icon",45),q(2,"span",42),pe(3),K()()),l&2){let i=be(4);Y(3),yt(i.poi.AddressInfo.ContactEmail)}}function UA(l,s){if(l&1&&(q(0,"p"),Ye(1,"ion-icon",46),q(2,"span",42)(3,"a",47),pe(4),K()()()),l&2){let i=be(4);Y(3),Ce("href",Fl(i.poi.AddressInfo.RelatedURL),zl),Y(),yt(i.poi.AddressInfo.RelatedURL)}}function NA(l,s){if(l&1&&(q(0,"ion-card")(1,"ion-card-header")(2,"ion-card-subtitle"),pe(3),Ai(4,"translate"),K()(),q(5,"ion-card-content")(6,"ion-grid")(7,"ion-row")(8,"ion-col")(9,"ion-label"),pe(10),Ai(11,"translate"),K(),q(12,"div",42),it(13,AA,2,1,"div",0)(14,kA,2,1,"div",0)(15,LA,2,1,"div",0)(16,DA,2,1,"div",0)(17,RA,2,1,"div",0)(18,zA,2,1,"div",0),K()(),q(19,"ion-col"),it(20,OA,2,1,"p",0)(21,FA,4,1,"p",0)(22,BA,4,1,"p",0)(23,jA,4,1,"p",0)(24,UA,5,3,"p",0),K()(),q(25,"ion-row")(26,"ion-col")(27,"ion-label",43),pe(28),Ai(29,"number"),Ai(30,"number"),K()()()()()()),l&2){let i=be(3);Y(3),mt(" ",Sn(4,15,"ocm.details.location.sectionTitle")," "),Y(7),mt(" ",Sn(11,17,"ocm.details.location.address")),Y(3),Ce("ngIf",i.poi.AddressInfo.AddressLine1),Y(),Ce("ngIf",i.poi.AddressInfo.AddressLine2),Y(),Ce("ngIf",i.poi.AddressInfo.Town),Y(),Ce("ngIf",i.poi.AddressInfo.StateOrProvince),Y(),Ce("ngIf",i.poi.AddressInfo.Postcode),Y(),Ce("ngIf",i.poi.AddressInfo.Country),Y(2),Ce("ngIf",i.poi.AddressInfo.AccessComments),Y(),Ce("ngIf",i.poi.AddressInfo.ContactTelephone1),Y(),Ce("ngIf",i.poi.AddressInfo.ContactTelephone2),Y(),Ce("ngIf",i.poi.AddressInfo.ContactEmail),Y(),Ce("ngIf",i.poi.AddressInfo.RelatedURL),Y(4),Uv(" Lat/Long: ",Bl(29,19,i.poi.AddressInfo.Latitude,"1.1-6")," , ",Bl(30,22,i.poi.AddressInfo.Longitude,"1.1-6")," ")}}function VA(l,s){if(l&1&&(q(0,"p")(1,"span",48),pe(2),Ai(3,"translate"),K(),q(4,"span",42),pe(5),K()()),l&2){let i=be(3);Y(2),mt("",Sn(3,2,"ocm.details.numberOfPoints"),":"),Y(3),yt(i.poi.NumberOfPoints)}}function $A(l,s){if(l&1&&(q(0,"p")(1,"span",48),pe(2),Ai(3,"translate"),K(),q(4,"span",42),pe(5),K()()),l&2){let i=be(3);Y(2),mt("",Sn(3,2,"ocm.details.operationalStatus"),":"),Y(3),mt(" ",i.poi.StatusType.Title," ")}}function GA(l,s){if(l&1&&(q(0,"p")(1,"span",48),pe(2),Ai(3,"translate"),K(),q(4,"span",42),pe(5),K()()),l&2){let i=be(3);Y(2),mt("",Sn(3,2,"ocm.details.usageType"),":"),Y(3),yt(i.poi.UsageType.Title)}}function qA(l,s){if(l&1&&(q(0,"p")(1,"span",48),pe(2),Ai(3,"translate"),K(),q(4,"span",42),pe(5),K()()),l&2){let i=be(3);Y(2),mt("",Sn(3,2,"ocm.details.usageCost"),":"),Y(3),mt(" ",i.poi.UsageCost)}}function WA(l,s){if(l&1&&(q(0,"p"),Ye(1,"br"),pe(2),Ai(3,"translate"),Ye(4,"br"),q(5,"span",42),pe(6),K()()),l&2){let i=be(3);Y(2),mt("",Sn(3,2,"ocm.details.generalComments"),": "),Y(4),yt(i.poi.GeneralComments)}}function ZA(l,s){if(l&1&&(q(0,"p"),Ye(1,"ion-icon",50),pe(2),K()),l&2){let i=be(4);Y(2),mt(" ",i.poi.OperatorInfo.WebsiteURL," ")}}function HA(l,s){if(l&1&&(q(0,"p"),Ye(1,"ion-icon",45),pe(2),K()),l&2){let i=be(4);Y(2),mt(" ",i.poi.OperatorInfo.ContactEmail," ")}}function KA(l,s){if(l&1&&(q(0,"p"),Ye(1,"ion-icon",45),pe(2),K()),l&2){let i=be(4);Y(2),mt(" ",i.poi.OperatorInfo.FaultReportEmail," ")}}function XA(l,s){if(l&1&&(q(0,"ion-card")(1,"ion-card-header")(2,"ion-card-subtitle"),pe(3),Ai(4,"translate"),K()(),q(5,"ion-card-content")(6,"div",42)(7,"p",49),pe(8),K(),it(9,ZA,3,1,"p",0)(10,HA,3,1,"p",0)(11,KA,3,1,"p",0),K()()()),l&2){let i=be(3);Y(3),mt(" ",Sn(4,5,"ocm.details.operator.sectionTitle")," "),Y(5),mt(" ",i.poi.OperatorInfo.Title," "),Y(),Ce("ngIf",i.poi.OperatorInfo.WebsiteURL),Y(),Ce("ngIf",i.poi.OperatorInfo.ContactEmail!=null),Y(),Ce("ngIf",i.poi.OperatorInfo.FaultReportEmail!=null&&i.poi.OperatorInfo.FaultReportEmail!=i.poi.OperatorInfo.ContactEmail)}}function JA(l,s){if(l&1){let i=Pt();q(0,"a",52),rt("click",function(){Ue(i);let u=be(4);return Ne(u.launchURL(u.poi.DataProvider.WebsiteURL))}),pe(1),K()}if(l&2){let i=be(4);Y(),yt(i.poi.DataProvider.WebsiteURL)}}function YA(l,s){if(l&1&&(q(0,"div",42)(1,"h3"),pe(2),Ai(3,"translate"),K(),q(4,"p"),pe(5),K(),it(6,JA,2,1,"a",51),q(7,"p"),pe(8),K()()),l&2){let i=be(3);Y(2),mt(" ",Sn(3,4,"ocm.details.dataProvider.sectionTitle")," "),Y(3),yt(i.poi.DataProvider==null?null:i.poi.DataProvider.Title),Y(),Ce("ngIf",i.poi.DataProvider.WebsiteURL),Y(2),yt(i.poi.DataProvider==null?null:i.poi.DataProvider.License)}}function QA(l,s){if(l&1&&(q(0,"div"),it(1,NA,31,25,"ion-card",0),q(2,"ion-card")(3,"ion-card-header")(4,"ion-card-subtitle"),pe(5),Ai(6,"translate"),K()(),q(7,"ion-card-content"),it(8,VA,6,4,"p",0),Ye(9,"app-equipment-details",40),K()(),q(10,"ion-card")(11,"ion-card-header")(12,"ion-card-subtitle"),pe(13,"Usage Restrictions"),K()(),q(14,"ion-card-content"),it(15,$A,6,4,"p",0)(16,GA,6,4,"p",0)(17,qA,6,4,"p",0)(18,WA,7,4,"p",0),K()(),it(19,XA,12,7,"ion-card",0),q(20,"ion-card")(21,"ion-card-header"),pe(22),Ai(23,"translate"),K(),q(24,"ion-card-content"),it(25,YA,9,6,"div",41),K()()()),l&2){let i=be(2);Y(),Ce("ngIf",i.poi.AddressInfo),Y(4),mt(" ",Sn(6,11,"ocm.details.equipment.sectionTitle")," "),Y(3),Ce("ngIf",i.poi.NumberOfPoints!=null),Y(),Ce("item",i.poi),Y(6),Ce("ngIf",i.poi.StatusType!=null),Y(),Ce("ngIf",i.poi.UsageType!=null),Y(),Ce("ngIf",i.poi.UsageCost!=null),Y(),Ce("ngIf",i.poi.GeneralComments!=null),Y(),Ce("ngIf",i.poi.OperatorInfo),Y(3),mt(" ",Sn(23,13,"ocm.details.advancedDetails")," "),Y(3),Ce("ngIf",i.poi.DataProvider)}}function e5(l,s){if(l&1&&Ye(0,"img",55),l&2){let i=be().$implicit;Ce("src",Fl(i.User==null?null:i.User.ProfileImageURL),zl)}}function t5(l,s){if(l&1&&(q(0,"span"),pe(1),K()),l&2){let i=be().$implicit;Y(),yt(i.User.Username)}}function i5(l,s){if(l&1&&(q(0,"span"),pe(1),K()),l&2){let i=be().$implicit;Y(),yt(i.Username)}}function n5(l,s){if(l&1&&(q(0,"p",42),pe(1),K()),l&2){let i=be().$implicit;Y(),mt(" ",i.CommentType==null?null:i.CommentType.Title," ")}}function r5(l,s){if(l&1&&(q(0,"p")(1,"span",48),pe(2,"Rating:"),K(),q(3,"span",42),pe(4),K()()),l&2){let i=be().$implicit;Y(4),mt("",i.Rating," out of 5")}}function o5(l,s){l&1&&(ii(0),Ye(1,"ion-icon",56),ni())}function a5(l,s){l&1&&(ii(0),Ye(1,"ion-icon",57),ni())}function s5(l,s){if(l&1&&(q(0,"p"),it(1,o5,2,0,"ng-container",0)(2,a5,2,0,"ng-container",0),pe(3),K()),l&2){let i=be().$implicit;Y(),Ce("ngIf",i.CheckinStatusType.IsPositive===!0),Y(),Ce("ngIf",i.CheckinStatusType.IsPositive===!1),Y(),mt(" ",i.CheckinStatusType.Title," ")}}function l5(l,s){if(l&1&&(q(0,"ion-card")(1,"ion-item")(2,"ion-avatar",23),it(3,e5,1,2,"img",54),K(),q(4,"ion-label"),it(5,t5,2,1,"span",0)(6,i5,2,1,"span",0),K(),q(7,"ion-label",24),pe(8),Ai(9,"date"),K()(),q(10,"ion-card-content")(11,"p"),pe(12),K(),it(13,n5,2,1,"p",41)(14,r5,5,1,"p",0)(15,s5,4,3,"p",0),K()()),l&2){let i=s.$implicit;Y(3),Ce("ngIf",i.User&&i.User.ProfileImageURL),Y(2),Ce("ngIf",i.User),Y(),Ce("ngIf",!i.User),Y(2),mt(" ",Sn(9,8,i.DateCreated)," "),Y(4),yt(i.Comment),Y(),Ce("ngIf",i.CommentTypeID!=10),Y(),Ce("ngIf",i.Rating),Y(),Ce("ngIf",i.CheckinStatusType)}}function c5(l,s){if(l&1&&(ii(0),it(1,l5,16,10,"ion-card",53),ni()),l&2){let i=be(3);Y(),Ce("ngForOf",i.poi.UserComments)}}function u5(l,s){l&1&&(ii(0),q(1,"ion-card")(2,"ion-card-content")(3,"p"),pe(4),Ai(5,"translate"),K()()(),ni()),l&2&&(Y(4),mt(" ",Sn(5,1,"ocm.details.commentsAndRatings.addPrompt")," "))}function h5(l,s){if(l&1&&(q(0,"div"),it(1,c5,2,1,"ng-container",0)(2,u5,6,3,"ng-container",0),K()),l&2){let i=be(2);Y(),Ce("ngIf",i.poi._hasComments==!0),Y(),Ce("ngIf",i.poi._hasComments==!1)}}function p5(l,s){if(l&1&&Ye(0,"img",55),l&2){let i=be().$implicit;Ce("src",Fl(i.User==null?null:i.User.ProfileImageURL),zl)}}function d5(l,s){if(l&1&&(q(0,"span"),pe(1),K()),l&2){let i=be().$implicit;Y(),yt(i.User.Username)}}function m5(l,s){if(l&1&&(q(0,"span"),pe(1),K()),l&2){let i=be().$implicit;Y(),yt(i.Username)}}function f5(l,s){if(l&1&&(q(0,"ion-card"),Ye(1,"img",55),q(2,"ion-item")(3,"ion-avatar",23),it(4,p5,1,2,"img",54),K(),q(5,"ion-label"),it(6,d5,2,1,"span",0)(7,m5,2,1,"span",0),K(),q(8,"ion-label",24),pe(9),Ai(10,"date"),K()(),q(11,"ion-card-content")(12,"p"),pe(13),K()()()),l&2){let i=s.$implicit;Y(),Ce("src",Fl(i.ItemMediumURL),zl),Y(3),Ce("ngIf",i.User&&i.User.ProfileImageURL),Y(2),Ce("ngIf",i.User),Y(),Ce("ngIf",!i.User),Y(2),mt(" ",Sn(10,7,i.DateCreated)," "),Y(4),yt(i.Comment)}}function g5(l,s){if(l&1&&(q(0,"div"),it(1,f5,14,9,"ion-card",53),K()),l&2){let i=be(3);Y(),Ce("ngForOf",i.poi.MediaItems)}}function _5(l,s){l&1&&(ii(0),q(1,"ion-card")(2,"ion-card-content")(3,"p"),pe(4),Ai(5,"translate"),K()()(),ni()),l&2&&(Y(4),mt(" ",Sn(5,1,"ocm.details.mediaItems.addPrompt")," "))}function y5(l,s){if(l&1&&(q(0,"div"),it(1,g5,2,1,"div",0)(2,_5,6,3,"ng-container",0),K()),l&2){let i=be(2);Y(),Ce("ngIf",i.poi._hasPhotos),Y(),Ce("ngIf",i.poi._hasPhotos==!1)}}function v5(l,s){if(l&1&&(q(0,"p",58),pe(1),K()),l&2){let i=be(2);Y(),mt(" ",i.json)}}function x5(l,s){if(l&1){let i=Pt();q(0,"div")(1,"div",1)(2,"div",2)(3,"h2"),pe(4),K(),q(5,"div")(6,"small"),pe(7),K()(),it(8,SA,3,1,"div",0)(9,IA,3,1,"div",0)(10,TA,3,0,"div",0),q(11,"ion-badge",3),pe(12),Ai(13,"number"),K()(),q(14,"ion-fab",4)(15,"ion-fab-button",5),rt("click",function(){Ue(i);let u=be();return Ne(u.close())}),Ye(16,"ion-icon",6),K()(),q(17,"ion-fab",7)(18,"ion-fab-button",8),Ye(19,"ion-icon",9),K(),q(20,"ion-fab-list",10)(21,"ion-fab-button",11),rt("click",function(){Ue(i);let u=be();return Ne(u.addComment())}),Ye(22,"ion-icon",12),K(),q(23,"ion-fab-button",13),rt("click",function(){Ue(i);let u=be();return Ne(u.addMedia())}),Ye(24,"ion-icon",14),K(),q(25,"ion-fab-button",15),rt("click",function(){Ue(i);let u=be();return Ne(u.addFavourite())}),Ye(26,"ion-icon",16),K(),q(27,"ion-fab-button",17),rt("click",function(){Ue(i);let u=be();return Ne(u.edit())}),Ye(28,"ion-icon",18),K(),q(29,"ion-fab-button",19),rt("click",function(){Ue(i);let u=be();return Ne(u.refresh())}),Ye(30,"ion-icon",20),K()()()(),q(31,"ion-refresher",21),rt("ionRefresh",function(u){Ue(i);let r=be();return Ne(r.refresh(u))}),Ye(32,"ion-refresher-content",22),K(),q(33,"ion-toolbar")(34,"ion-buttons",23),it(35,CA,9,0,"ng-container",0),K(),q(36,"ion-buttons",24),it(37,PA,5,0,"ng-container",0)(38,MA,5,0,"ng-container",0)(39,EA,5,0,"ng-container",0),K()(),q(40,"ion-segment",25),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.selectedTab,u)||(r.selectedTab=u),Ne(u)}),q(41,"ion-segment-button",26)(42,"ion-label"),pe(43," Details "),K()(),q(44,"ion-segment-button",27)(45,"ion-label"),pe(46),K()(),q(47,"ion-segment-button",28)(48,"ion-label"),pe(49),K()()(),it(50,QA,26,15,"div",0)(51,h5,3,2,"div",0)(52,y5,3,2,"div",0)(53,v5,2,1,"p",29),K()}if(l&2){let i=be();Y(),Kd("background-image",i.backdropImage?"url("+i.backdropImage+")":""),Y(3),mt(" ",i.poi.AddressInfo.Title," "),Y(3),mt("OCM-",i.poi.ID),Y(),Ce("ngIf",i.connectionSummary),Y(),Ce("ngIf",i.poi.OperatorInfo),Y(),Ce("ngIf",i.poi.SubmissionStatusTypeID==1),Y(2),yt(Bl(13,19,i.avgRating,"1.1-1")),Y(23),Ce("ngIf",i.selectedTab=="location"),Y(2),Ce("ngIf",i.selectedTab=="location"),Y(),Ce("ngIf",i.selectedTab=="comments"),Y(),Ce("ngIf",i.selectedTab=="media"),Y(),vt("ngModel",i.selectedTab),Y(6),mt("Comments (",i.poi.UserComments?i.poi.UserComments.length:0,")"),Y(3),mt(" Photos (",i.poi.MediaItems?i.poi.MediaItems.length:0,")"),Y(),Ce("ngIf",i.selectedTab=="location"),Y(),Ce("ngIf",i.selectedTab=="comments"),Y(),Ce("ngIf",i.selectedTab=="media"),Y(),Ce("ngIf",i.appManager.isDebugMode==!0)}}function b5(l,s){l&1&&(q(0,"div")(1,"h2"),pe(2,"POI Not Found"),K(),q(3,"p"),pe(4,"The POI details could not be loaded."),K()())}var yR=(()=>{class l{appManager;nav;translate;logging;modalController;actionSheetController;poiManager;router;poi;selectedTab;json;hasNavBar=!1;backdropImage;avgRating;connectionSummary;constructor(i,p,u,r,x,C,A,R){this.appManager=i,this.nav=p,this.translate=u,this.logging=r,this.modalController=x,this.actionSheetController=C,this.poiManager=A,this.router=R}ngOnChanges(i){if(this.logging.log("In ngOnChanges of POI Details"),!(this.poi==null||this.poi.AddressInfo==null)){if(this.selectedTab="location",this.poi.MediaItems!=null&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let p of this.poi.MediaItems)p.ItemMediumURL=p.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(this.poi.UserComments!=null&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let p=this.poi.UserComments.filter(u=>u.Rating>0);if(p.length>0){let u=0;for(let r of p)u+=r.Rating;this.avgRating=u/p.length}else this.avgRating=null}catch{}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let p="";for(let u of this.poi.Connections)p.indexOf(u.ConnectionType.Title)==-1&&(p+=(p!=""?", ":"")+u.ConnectionType.Title);this.connectionSummary=p}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+new Cf().googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return this.appManager.clientWidth===0?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){return Be(this,null,function*(){let i=yield this.modalController.create({component:_w,componentProps:{id:this.poi.ID,poi:this.poi}});setTimeout(()=>{this.refresh()},1e3),yield i.present()})}addComment(){return Be(this,null,function*(){if(this.appManager.isUserAuthenticated(!0))yield this.continueAddComment();else{let i=yield this.modalController.create({component:lm});i.onDidDismiss().then(()=>Be(this,null,function*(){this.appManager.isUserAuthenticated(!0)&&(yield this.continueAddComment())})),yield i.present()}})}continueAddMedia(){return Be(this,null,function*(){let i=yield this.modalController.create({component:gw,componentProps:{id:this.poi.ID,poi:this.poi}});i.onDidDismiss().then(()=>{setTimeout(()=>{this.refresh()},1e3)}),yield i.present()})}addMedia(){return Be(this,null,function*(){if(this.appManager.isUserAuthenticated(!0))yield this.continueAddMedia();else{let i=yield this.modalController.create({component:lm});i.onDidDismiss().then(()=>Be(this,null,function*(){this.appManager.isUserAuthenticated(!0)&&(yield this.continueAddMedia())})),yield i.present()}})}addFavourite(){return Be(this,null,function*(){yield(yield this.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{this.modalController.create({component:m1,componentProps:{poi:this.poi}}).then(p=>p.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})}launchNavigation(){if(this.appManager.isPlatform("ios")){let i="https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude;this.appManager.launchWebPage(i)}else{let i="https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude;this.appManager.launchWebPage(i)}}launchURL(i){this.appManager.launchWebPage(i)}continueEdit(){return Be(this,null,function*(){let i=yield this.modalController.create({component:mw,componentProps:{id:this.poi.ID}});return i.onDidDismiss().then(p=>{this.refresh()}),yield i.present()})}edit(){return Be(this,null,function*(){if(qn.isFeatureEnabled("EDIT_POI"))if(this.appManager.isUserAuthenticated(!0))yield this.continueEdit();else{let i=yield this.modalController.create({component:lm});i.onDidDismiss().then(()=>Be(this,null,function*(){this.appManager.isUserAuthenticated(!0)&&(yield this.continueEdit())})),yield i.present()}else this.appManager.launchOCMWebPage("/poi/edit/"+this.poi.ID)})}refresh(i=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(p=>{p&&(this.poi=p,this.ngOnChanges(null)),i&&i.target.complete()})}close(){this.modalController.dismiss()}static \u0275fac=function(p){return new(p||l)(ot(Pr),ot(uu),ot(js),ot(pi),ot(Ir),ot(s1),ot(Su),ot(lu))};static \u0275cmp=Ti({type:l,selectors:[["poi-details"]],inputs:{poi:"poi"},standalone:!1,features:[Zd],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","start","slot","fixed"],["size","small","color","medium",3,"click"],["name","close"],["vertical","top","horizontal","end","slot","fixed"],["size","small","color","success"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[3,"ngModelChange","ngModel"],["value","location","selected",""],["value","comments"],["value","media"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["size","small","title","Submit an Edit",3,"click"],["name","create","slot","start"],["size","small","title","Navigate to this location",3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[3,"item"],["class","details",4,"ngIf"],[1,"details"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],[1,"label"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[2,"white-space","pre-wrap"]],template:function(p,u){p&1&&it(0,x5,54,22,"div",0)(1,b5,5,0,"div",0),p&2&&(Ce("ngIf",u.poi!=null&&u.poi.AddressInfo!=null),Y(),Ce("ngIf",u.poi==null||u.poi.AddressInfo==null))},dependencies:[kn,Yi,Fs,Jd,Fi,nr,Yd,Qd,Kv,Xv,du,Yv,Qv,e1,mu,Bi,Qi,Rn,n1,r1,gu,_u,yu,or,wr,Ln,Dn,Tf,jl,Gv,vu],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em 3em 1em 6em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{color:unset}.banner-content[_ngcontent-%COMP%]{padding-right:48px}p[_ngcontent-%COMP%]{display:block;padding:4px}"]})}return l})();var yw=(()=>{class l{http;journeyManager;constructor(i,p){this.http=i,this.journeyManager=p}getDirections(i,p){return new Promise((u,r)=>{new google.maps.DirectionsService().route({origin:i,destination:p,travelMode:google.maps.TravelMode.DRIVING},(C,A)=>{A===google.maps.DirectionsStatus.OK?u(C):r(A)})})}analyseRoutes(i,p){let u=new Array;return i.routes.forEach(r=>{let x=new ep;x.Title=""+u.length+1,x.JourneyRouteLegs=new Array,x.TotalDistanceKM=0,x.TotalDurationMinutes=0,x.TotalEnergykWh=0,r.legs.forEach(C=>{let A=C.duration.value,R=C.distance.value/1e3,U=this.journeyManager.calculateEnergyConsumptionkWh(R,0,null,p),F=new Qh;F.DistanceKM=R,F.DurationMinutes=A/60,F.EnergyConsumptionkWh=U,x.JourneyRouteLegs.push(F),x.TotalDistanceKM+=F.DistanceKM,x.TotalDurationMinutes+=F.DurationMinutes,x.TotalEnergykWh=F.EnergyConsumptionkWh}),u.push(x)}),u}static \u0275fac=function(p){return new(p||l)(Ct(tr),Ct($s))};static \u0275prov=gi({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();function S5(l,s){if(l&1){let i=Pt();q(0,"ion-item"),Ye(1,"ion-icon",12),q(2,"ion-searchbar",13),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.routeStart,u)||(r.routeStart=u),Ne(u)}),rt("ionInput",function(u){Ue(i),be();let r=Ol(18);return Ne(r.getPlacesAutoComplete(u,"routeStart"))})("ionCancel",function(u){Ue(i);let r=be();return Ne(r.onPlaceSearchCancel(u))}),K()()}if(l&2){let i=be();Y(2),vt("ngModel",i.routeStart),Ce("debounce",500)}}function I5(l,s){if(l&1){let i=Pt();q(0,"ion-item",14),rt("click",function(){Ue(i);let u=be();return Ne(u.clearRouteStart())}),Ye(1,"ion-icon",12),q(2,"h2"),pe(3),K()()}if(l&2){be();let i=Ol(18);Y(3),yt(i.selectedPlace==null?null:i.selectedPlace.name)}}function T5(l,s){if(l&1){let i=Pt();q(0,"ion-item"),Ye(1,"ion-icon",15),q(2,"ion-searchbar",16),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.routeDestination,u)||(r.routeDestination=u),Ne(u)}),rt("ionInput",function(u){Ue(i),be();let r=Ol(20);return Ne(r.getPlacesAutoComplete(u,"routeDestination"))})("ionCancel",function(u){Ue(i);let r=be();return Ne(r.onPlaceSearchCancel(u))}),K()()}if(l&2){let i=be();Y(2),vt("ngModel",i.routeDestination),Ce("debounce",500)}}function C5(l,s){if(l&1){let i=Pt();q(0,"ion-item",14),rt("click",function(){Ue(i);let u=be();return Ne(u.clearRouteDestination())}),Ye(1,"ion-icon",15),q(2,"h2"),pe(3),K()()}if(l&2){be();let i=Ol(20);Y(3),yt(i.selectedPlace==null?null:i.selectedPlace.name)}}function P5(l,s){if(l&1){let i=Pt();q(0,"ion-button",14),rt("click",function(){Ue(i);let u=be();return Ne(u.clearRoute())}),Ye(1,"ion-icon",17),pe(2," Clear Route "),K()}}function M5(l,s){if(l&1){let i=Pt();q(0,"ion-button",14),rt("click",function(){Ue(i);let u=be();return Ne(u.showSettings())}),pe(1," Show Settings "),Ye(2,"ion-icon",18),K()}}function E5(l,s){if(l&1){let i=Pt();q(0,"ion-button",14),rt("click",function(){Ue(i);let u=be();return Ne(u.hideSettings())}),pe(1," Hide Settings "),Ye(2,"ion-icon",18),K()}}function A5(l,s){l&1&&(q(0,"p",19),Ye(1,"ion-spinner",19),pe(2," Calculating Route.. "),K())}function k5(l,s){if(l&1&&(q(0,"ion-list")(1,"ion-list-header"),pe(2),Ai(3,"number"),Ai(4,"number"),K()()),l&2){let i=be();Y(2),Nv(" Total Distance ",Bl(3,3,i.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",i.formatDuration(i.selectedJourneyRoute.TotalDurationMinutes),", ",Bl(4,6,i.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function L5(l,s){if(l&1){let i=Pt();q(0,"div")(1,"ion-list")(2,"ion-list-header"),Ye(3,"ion-icon",20),pe(4," Route Settings "),K(),q(5,"ion-item")(6,"ion-label",21),pe(7),K(),q(8,"ion-range",22),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.routeSearchDistance,u)||(r.routeSearchDistance=u),Ne(u)}),Ye(9,"ion-icon",23)(10,"ion-icon",24),K()(),q(11,"ion-item")(12,"ion-label",21),pe(13,"Energy Efficiency (kWh Per km)"),K(),q(14,"ion-input",25),xt("ngModelChange",function(u){Ue(i);let r=be();return _t(r.kWhPerKM,u)||(r.kWhPerKM=u),Ne(u)}),K()()()()}if(l&2){let i=be();Y(7),mt("Search Distance (",i.routeSearchDistance,")"),Y(),vt("ngModel",i.routeSearchDistance),Y(6),vt("ngModel",i.kWhPerKM)}}var DR=(()=>{class l{mapping;logging;directions;journeyManager;changeDetector;numberPipe;routeSearchDistance=5;journeyRoutes;selectedJourneyRoute;routePolyline;kWhPerKM;routeStartPlace;routeDestinationPlace;routeCalcInProgress=!1;advancedSettingsMode=!1;routeStart="";routeDestination="";constructor(i,p,u,r,x,C){this.mapping=i,this.logging=p,this.directions=u,this.journeyManager=r,this.changeDetector=x,this.numberPipe=C,this.kWhPerKM=.212}get isRouteSet(){return this.routeStartPlace!=null&&this.routeDestinationPlace!=null}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(i){this.routeStartPlace=i,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(i){this.routeDestinationPlace=i,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(i){if(i<=60)return this.numberPipe.transform(i,"1.0-2")+" mins";{let p=Math.round(i/60),u=Math.floor(i-p*60);return p+" hours "+(u>0?u+" mins":"")}}calculateRoute(){this.routeStartPlace!=null&&this.routeDestinationPlace!=null&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(i=>{if(i.routes!=null&&i.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=i.routes[0].overview_polyline;let p=i.routes[0].bounds.getSouthWest(),u=i.routes[0].bounds.getNorthEast(),r=new qi(u.lat(),u.lng()),x=new qi(p.lat(),p.lng()),C=new tp(r,x);this.journeyRoutes=this.directions.analyseRoutes(i,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(C)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}static \u0275fac=function(p){return new(p||l)(ot(Uu),ot(pi),ot(yw),ot($s),ot(zs),ot(jl))};static \u0275cmp=Ti({type:l,selectors:[["route-planner"]],standalone:!1,decls:24,vars:10,consts:[["placeSearchRouteStart",""],["placeSearchRouteDestination",""],[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModelChange","ionInput","ionCancel","ngModel","debounce"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModelChange","ionInput","ionCancel","ngModel","debounce"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModelChange","ngModel"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModelChange","ngModel"]],template:function(p,u){if(p&1){let r=Pt();q(0,"div",2)(1,"div",3)(2,"ion-list")(3,"ion-list-header"),Ye(4,"ion-icon",4),q(5,"ion-label"),pe(6,"Plan Your Journey"),K()(),it(7,S5,3,2,"ion-item",5)(8,I5,4,1,"ion-item",6)(9,T5,3,2,"ion-item",5)(10,C5,4,1,"ion-item",6),K(),q(11,"ion-toolbar",7)(12,"ion-buttons",8),it(13,P5,3,0,"ion-button",6),K(),q(14,"ion-buttons",9),it(15,M5,3,0,"ion-button",6)(16,E5,3,0,"ion-button",6),K()()(),q(17,"place-search",10,0),rt("placeChanged",function(C){return Ue(r),Ne(u.routeStartSelected(C))}),K(),q(19,"place-search",10,1),rt("placeChanged",function(C){return Ue(r),Ne(u.routeDestinationSelected(C))}),K(),it(21,A5,3,0,"p",11)(22,k5,5,9,"ion-list",5)(23,L5,15,3,"div",5),K()}p&2&&(Y(7),Ce("ngIf",u.routeStartPlace==null),Y(),Ce("ngIf",u.routeStartPlace!=null),Y(),Ce("ngIf",u.routeDestinationPlace==null),Y(),Ce("ngIf",u.routeDestinationPlace!=null),Y(3),Ce("ngIf",u.isRouteSet),Y(2),Ce("ngIf",!u.advancedSettingsMode),Y(),Ce("ngIf",u.advancedSettingsMode),Y(5),Ce("ngIf",u.routeCalcInProgress),Y(),Ce("ngIf",u.selectedJourneyRoute!=null),Y(),Ce("ngIf",u.advancedSettingsMode))},dependencies:[Yi,Fi,nr,Bi,Sr,Qi,Rn,rr,t1,i1,em,tm,or,pu,ir,im,a1,Ln,Dn,fw,jl],encapsulation:2})}return l})();var FR=(()=>{class l extends vu{constructor(i,p){super(i,p)}transform(i,...p){let u=super.transform(i,...p);return u==i?p!=null&&p[0].default?p[0].default:p[0].Title?p[0].Title:u:u}static \u0275fac=function(p){return new(p||l)(ot(js,16),ot(zs,16))};static \u0275pipe=zv({name:"nullableTranslate",type:l,pure:!0,standalone:!1});static \u0275prov=gi({token:l,factory:l.\u0275fac})}return l})();var sz=(()=>{class l{static \u0275fac=function(p){return new(p||l)};static \u0275mod=Hd({type:l});static \u0275inj=Wd({providers:[jl],imports:[qv,c1,Hv,u1]})}return l})();export{Gi as a,pi as b,Us as c,qi as d,ma as e,Vs as f,wu as g,Tr as h,om as i,Su as j,$s as k,qk as l,Pr as m,qn as n,fw as o,Cf as p,lm as q,Uu as r,hw as s,dw as t,mw as u,yR as v,DR as w,FR as x,sz as y};
