import{$ as U1,A as ve,Aa as Hd,Ab as Nh,B as yt,Ba as ws,Bb as Ss,C as dn,Ca as La,Cb as ob,D as mn,Db as ab,E as oi,Ea as Uh,F as Dt,Fa as Wg,Fb as Vh,G as Ve,Ga as wr,Gb as tm,H as z1,Ha as Da,Hb as sb,I as R1,Ia as Hg,J as F1,Ja as Xg,K as bd,Ka as q1,L as Zg,La as W1,M as Le,Ma as H1,N as Ht,Na as Xd,O as Ut,Oa as Bl,P as B1,Pa as X1,Q as O1,Qa as K1,R as j1,Ra as Y1,S as Xt,Sa as Ol,T as Zt,Ta as Kd,U as Kt,Ua as jl,V as wd,Va as Tr,Wa as Ts,X as vr,Xa as jr,Y as No,Ya as qo,Z as Td,Za as za,_ as jh,_a as J1,a as Oh,aa as Vo,b as Ng,ba as Or,c as M1,ca as N1,cb as Yd,d as yv,da as Sd,db as Q1,e as E1,ea as V1,eb,fb as tb,gb as Jd,h as An,ha as $1,hb as Kg,i as Vg,ia as $o,ib as Qd,j as A1,ja as G1,jb as em,k as ii,kb as mu,l as ct,la as Fl,lb as fu,m as ut,ma as qg,mb as Yg,n as k1,na as Ea,o as $g,oa as Go,ob as ib,p as xd,pa as Zo,q as be,qa as Z1,qb as Ul,r as Rt,s as lr,sa as Gd,sb as Ra,t as Gg,u as L1,v as Et,va as Zd,w as Ma,wa as qd,wb as nb,x as D1,xa as Wd,xb as Jg,y as Ze,yb as Qg,z as ge,zb as rb}from"./chunk-5C4GNZJ6.js";import{a as Vi,b as Rl,e as gv,f as vT,g as _v,h as st}from"./chunk-B4AJQJMI.js";var mb=gv((Tv,Sv)=>{(function(g,m){typeof Tv=="object"&&typeof Sv<"u"?Sv.exports=m():typeof define=="function"&&define.amd?define(m):(g=typeof globalThis<"u"?globalThis:g||self,g.maplibregl=m())})(Tv,function(){"use strict";var g={},m={};function u(_,o,C){if(m[_]=C,_==="index"){var B="var sharedModule = {}; ("+m.shared+")(sharedModule); ("+m.worker+")(sharedModule);",$={};return m.shared($),m.index(g,$),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([B],{type:"text/javascript"}))),g}}u("shared",["exports"],function(_){"use strict";function o(n,t,i,a){return new(i||(i=Promise))(function(l,d){function f(S){try{b(a.next(S))}catch(I){d(I)}}function v(S){try{b(a.throw(S))}catch(I){d(I)}}function b(S){var I;S.done?l(S.value):(I=S.value,I instanceof i?I:new i(function(E){E(I)})).then(f,v)}b((a=a.apply(n,t||[])).next())})}function C(n,t){this.x=n,this.y=t}function B(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $,Y;typeof SuppressedError=="function"&&SuppressedError,C.prototype={clone(){return new C(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,t){return this.clone()._rotateAround(n,t)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){let t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult(n){let t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){let n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){let t=Math.cos(n),i=Math.sin(n),a=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=a,this},_rotateAround(n,t){let i=Math.cos(n),a=Math.sin(n),l=t.y+a*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-a*(this.y-t.y),this.y=l,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(n){if(n instanceof C)return n;if(Array.isArray(n))return new C(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new C(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var ne=(function(){if(Y)return $;function n(t,i,a,l){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=a,this.p2y=l}return Y=1,$=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,l=0;l<8;l++){var d=this.sampleCurveX(a)-t;if(Math.abs(d)<i)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=d/f}var v=0,b=1;for(a=t,l=0;l<20&&(d=this.sampleCurveX(a),!(Math.abs(d-t)<i));l++)t>d?v=a:b=a,a=.5*(b-v)+v;return a},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},$})(),q=B(ne);let Ce,Ie;function Ae(){return Ce==null&&(Ce=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ce}function De(){if(Ie==null&&(Ie=!1,Ae())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<25;a++){let l=4*a;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}let i=t.getImageData(0,0,5,5).data;for(let a=0;a<100;a++)if(a%4!=3&&i[a]!==a){Ie=!0;break}}}return Ie||!1}var qe=1e-6,Qe=typeof Float32Array<"u"?Float32Array:Array;function nt(){var n=new Qe(9);return Qe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function vt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function tt(){var n=new Qe(3);return Qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function At(n){return Math.hypot(n[0],n[1],n[2])}function Yt(n,t,i){var a=new Qe(3);return a[0]=n,a[1]=t,a[2]=i,a}function pn(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n[2]=t[2]+i[2],n}function Ii(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function On(n,t,i){var a=t[0],l=t[1],d=t[2],f=i[0],v=i[1],b=i[2];return n[0]=l*b-d*v,n[1]=d*f-a*b,n[2]=a*v-l*f,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var wn,Vn=At;function mo(n,t,i){var a=t[0],l=t[1],d=t[2],f=t[3];return n[0]=i[0]*a+i[4]*l+i[8]*d+i[12]*f,n[1]=i[1]*a+i[5]*l+i[9]*d+i[13]*f,n[2]=i[2]*a+i[6]*l+i[10]*d+i[14]*f,n[3]=i[3]*a+i[7]*l+i[11]*d+i[15]*f,n}function Ir(){var n=new Qe(4);return Qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Pr(n,t,i,a){var l=.5*Math.PI/180;t*=l,i*=l,a*=l;var d=Math.sin(t),f=Math.cos(t),v=Math.sin(i),b=Math.cos(i),S=Math.sin(a),I=Math.cos(a);return n[0]=d*b*I-f*v*S,n[1]=f*v*I+d*b*S,n[2]=f*b*S-d*v*I,n[3]=f*b*I+d*v*S,n}function Cr(){var n=new Qe(2);return Qe!=Float32Array&&(n[0]=0,n[1]=0),n}function Oa(n,t){var i=new Qe(2);return i[0]=n,i[1]=t,i}tt(),wn=new Qe(4),Qe!=Float32Array&&(wn[0]=0,wn[1]=0,wn[2]=0,wn[3]=0),tt(),Yt(1,0,0),Yt(0,1,0),Ir(),Ir(),nt(),Cr();let Ot=8192;function Nr(n,t,i){return t*(Ot/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function Xi(n,t){return(n%t+t)%t}function fo(n,t,i){return n*(1-i)+t*i}function cr(n){if(n<=0)return 0;if(n>=1)return 1;let t=n*n,i=t*n;return 4*(n<.5?i:3*(n-t)+i-.75)}function Vr(n,t,i,a){let l=new q(n,t,i,a);return d=>l.solve(d)}let go=Vr(.25,.1,.25,1);function fn(n,t,i){return Math.min(i,Math.max(t,n))}function Ho(n,t,i){let a=i-t,l=((n-t)%a+a)%a+t;return l===t?i:l}function Dn(n,...t){for(let i of t)for(let a in i)n[a]=i[a];return n}let $n=1;function Xo(n,t,i){let a={};for(let l in n)a[l]=t.call(this,n[l],l,n);return a}function Ko(n,t,i){let a={};for(let l in n)t.call(this,n[l],l,n)&&(a[l]=n[l]);return a}function Tn(n){return Array.isArray(n)?n.map(Tn):typeof n=="object"&&n?Xo(n,Tn):n}let hi={};function fi(n){hi[n]||(typeof console<"u"&&console.warn(n),hi[n]=!0)}function Gn(n,t,i){return(i.y-n.y)*(t.x-n.x)>(t.y-n.y)*(i.x-n.x)}function ur(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let _o=null;function hr(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}let pr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Yo(n,t,i,a,l){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let d=new VideoFrame(n,{timestamp:0});try{let f=d?.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);let v=f.startsWith("BGR"),b=new Uint8ClampedArray(a*l*4);if(yield d.copyTo(b,(function(S,I,E,L,z){let R=4*Math.max(-I,0),j=(Math.max(0,E)-E)*L*4+R,V=4*L,H=Math.max(0,I),se=Math.max(0,E);return{rect:{x:H,y:se,width:Math.min(S.width,I+L)-H,height:Math.min(S.height,E+z)-se},layout:[{offset:j,stride:V}]}})(n,t,i,a,l)),v)for(let S=0;S<b.length;S+=4){let I=b[S];b[S]=b[S+2],b[S+2]=I}return b}finally{d.close()}})}let $r,Gr;function Zr(n,t,i,a){return n.addEventListener(t,i,a),{unsubscribe:()=>{n.removeEventListener(t,i,a)}}}function yo(n){return n*Math.PI/180}function qr(n){return n/Math.PI*180}let Wr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Hr={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Jo="AbortError";function le(){return new Error(Jo)}let O={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function U(n){return O.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}let N="global-dispatcher";class Q extends Error{constructor(t,i,a,l){super(`AJAXError: ${i} (${t}): ${a}`),this.status=t,this.statusText=i,this.url=a,this.body=l}}let ae=()=>ur(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ce=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){let a=U(n.url);if(a)return a(n,t);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:N},t)}if(!(/^file:/.test(i=n.url)||/^file:/.test(ae())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(a,l){return o(this,void 0,void 0,function*(){let d=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:ae(),signal:l.signal}),f,v;a.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{f=yield fetch(d)}catch(S){throw new Q(0,S.message,a.url,new Blob)}if(!f.ok){let S=yield f.blob();throw new Q(f.status,f.statusText,a.url,S)}v=a.type==="arrayBuffer"||a.type==="image"?f.arrayBuffer():a.type==="json"?f.json():f.text();let b=yield v;if(l.signal.aborted)throw le();return{data:b,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}})})(n,t);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:N},t)}var i;return(function(a,l){return new Promise((d,f)=>{var v;let b=new XMLHttpRequest;b.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(b.responseType="arraybuffer");for(let S in a.headers)b.setRequestHeader(S,a.headers[S]);a.type==="json"&&(b.responseType="text",!((v=a.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=a.credentials==="include",b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if(!l.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let S=b.response;if(a.type==="json")try{S=JSON.parse(b.response)}catch(I){return void f(I)}d({data:S,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{let S=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});f(new Q(b.status,b.statusText,a.url,S))}},l.signal.addEventListener("abort",()=>{b.abort(),f(le())}),b.send(a.body)})})(n,t)};function _e(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;let t=new URL(n),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function he(n,t,i){i[n]&&i[n].indexOf(t)!==-1||(i[n]=i[n]||[],i[n].push(t))}function Te(n,t,i){if(i&&i[n]){let a=i[n].indexOf(t);a!==-1&&i[n].splice(a,1)}}class ke{constructor(t,i={}){Dn(this,i),this.type=t}}class Pe extends ke{constructor(t,i={}){super("error",Dn({error:t},i))}}class Xe{on(t,i){return this._listeners=this._listeners||{},he(t,i,this._listeners),{unsubscribe:()=>{this.off(t,i)}}}off(t,i){return Te(t,i,this._listeners),Te(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},he(t,i,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,i){typeof t=="string"&&(t=new ke(t,i||{}));let a=t.type;if(this.listens(a)){t.target=this;let l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let v of l)v.call(this,t);let d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let v of d)Te(a,v,this._oneTimeListeners),v.call(this,t);let f=this._eventedParent;f&&(Dn(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof Pe&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let lt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xt(n,t){let i={};for(let a in n)a!=="ref"&&(i[a]=n[a]);return lt.forEach(a=>{a in t&&(i[a]=t[a])}),i}function Je(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!Je(n[i],t[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(let i in n)if(!Je(n[i],t[i]))return!1;return!0}return n===t}function pt(n,t){n.push(t)}function Jt(n,t,i){pt(i,{command:"addSource",args:[n,t[n]]})}function Pi(n,t,i){pt(t,{command:"removeSource",args:[n]}),i[n]=!0}function Ci(n,t,i,a){Pi(n,i,a),Jt(n,t,i)}function gi(n,t,i){let a;for(a in n[i])if(Object.prototype.hasOwnProperty.call(n[i],a)&&a!=="data"&&!Je(n[i][a],t[i][a]))return!1;for(a in t[i])if(Object.prototype.hasOwnProperty.call(t[i],a)&&a!=="data"&&!Je(n[i][a],t[i][a]))return!1;return!0}function It(n,t,i,a,l,d){n=n||{},t=t||{};for(let f in n)Object.prototype.hasOwnProperty.call(n,f)&&(Je(n[f],t[f])||i.push({command:d,args:[a,f,t[f],l]}));for(let f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(n,f)&&(Je(n[f],t[f])||i.push({command:d,args:[a,f,t[f],l]}))}function kt(n){return n.id}function vi(n,t){return n[t.id]=t,n}class Re{constructor(t,i,a,l){this.message=(t?`${t}: `:"")+a,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function Ki(n,...t){for(let i of t)for(let a in i)n[a]=i[a];return n}class si extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class Xr{constructor(t,i=[]){this.parent=t,this.bindings={};for(let[a,l]of i)this.bindings[a]=l}concat(t){return new Xr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Qo={kind:"null"},$e={kind:"number"},bt={kind:"string"},_t={kind:"boolean"},Gi={kind:"color"},vo={kind:"projectionDefinition"},Kr={kind:"object"},ft={kind:"value"},Es={kind:"collator"},Yr={kind:"formatted"},As={kind:"padding"},dr={kind:"colorArray"},ea={kind:"numberArray"},pi={kind:"resolvedImage"},ks={kind:"variableAnchorOffsetCollection"};function gn(n,t){return{kind:"array",itemType:n,N:t}}function qt(n){if(n.kind==="array"){let t=qt(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}let xu=[Qo,$e,bt,_t,Gi,vo,Yr,Kr,gn(ft),As,ea,dr,pi,ks];function ja(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ja(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(let i of xu)if(!ja(i,t))return null}}return`Expected ${qt(n)} but found ${qt(t)} instead.`}function Yl(n,t){return t.some(i=>i.kind===n.kind)}function Jr(n,t){return t.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function Qr(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}let Jl=.96422,bu=.82521,wu=4/29,ta=6/29,Tu=3*ta*ta,ap=ta*ta*ta,sp=Math.PI/180,lp=180/Math.PI;function Ql(n){return(n%=360)<0&&(n+=360),n}function ia([n,t,i,a]){let l,d,f=tc((.2225045*(n=ec(n))+.7168786*(t=ec(t))+.0606169*(i=ec(i)))/1);n===t&&t===i?l=d=f:(l=tc((.4360747*n+.3850649*t+.1430804*i)/Jl),d=tc((.0139322*n+.0971045*t+.7141733*i)/bu));let v=116*f-16;return[v<0?0:v,500*(l-f),200*(f-d),a]}function ec(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function tc(n){return n>ap?Math.pow(n,1/3):n/Tu+wu}function na([n,t,i,a]){let l=(n+16)/116,d=isNaN(t)?l:l+t/500,f=isNaN(i)?l:l-i/200;return l=1*nc(l),d=Jl*nc(d),f=bu*nc(f),[ic(3.1338561*d-1.6168667*l-.4906146*f),ic(-.9787684*d+1.9161415*l+.033454*f),ic(.0719453*d-.2289914*l+1.4052427*f),a]}function ic(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function nc(n){return n>ta?n*n*n:Tu*(n-wu)}let cp=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function ra(n,t){return cp(n,t)?n[t]:void 0}function Ua(n){return parseInt(n.padEnd(2,n),16)/255}function Zn(n,t){return wt(t?n/100:n,0,1)}function wt(n,t,i){return Math.min(Math.max(t,n),i)}function xo(n){return!n.some(Number.isNaN)}let eo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Mr(n,t,i){return n+i*(t-n)}function bo(n,t,i){return n.map((a,l)=>Mr(a,t[l],i))}class Tt{constructor(t,i,a,l=1,d=!0){this.r=t,this.g=i,this.b=a,this.a=l,d||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,i,a,l]))}static parse(t){if(t instanceof Tt)return t;if(typeof t!="string")return;let i=(function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];let l=ra(eo,a);if(l){let[f,v,b]=l;return[f/255,v/255,b/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){let f=a.length<6?1:2,v=1;return[Ua(a.slice(v,v+=f)),Ua(a.slice(v,v+=f)),Ua(a.slice(v,v+=f)),Ua(a.slice(v,v+f)||"ff")]}if(a.startsWith("rgb")){let f=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){let[v,b,S,I,E,L,z,R,j,V,H,se]=f,te=[I||" ",z||" ",V].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){let re=[S,L,j].join(""),fe=re==="%%%"?100:re===""?255:0;if(fe){let we=[wt(+b/fe,0,1),wt(+E/fe,0,1),wt(+R/fe,0,1),H?Zn(+H,se):1];if(xo(we))return we}}return}}let d=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){let[f,v,b,S,I,E,L,z,R]=d,j=[b||" ",I||" ",L].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){let V=[+v,wt(+S,0,100),wt(+E,0,100),z?Zn(+z,R):1];if(xo(V))return(function([H,se,te,re]){function fe(we){let Ee=(we+H/30)%12,Ne=se*Math.min(te,1-te);return te-Ne*Math.max(-1,Math.min(Ee-3,9-Ee,1))}return H=Ql(H),se/=100,te/=100,[fe(0),fe(8),fe(4),re]})(V)}}})(t);return i?new Tt(...i,!1):void 0}get rgb(){let{r:t,g:i,b:a,a:l}=this,d=l||1/0;return this.overwriteGetter("rgb",[t/d,i/d,a/d,l])}get hcl(){return this.overwriteGetter("hcl",(function(t){let[i,a,l,d]=ia(t),f=Math.sqrt(a*a+l*l);return[Math.round(1e4*f)?Ql(Math.atan2(l,a)*lp):NaN,f,i,d]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ia(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){let[t,i,a,l]=this.rgb;return`rgba(${[t,i,a].map(d=>Math.round(255*d)).join(",")},${l})`}static interpolate(t,i,a,l="rgb"){switch(l){case"rgb":{let[d,f,v,b]=bo(t.rgb,i.rgb,a);return new Tt(d,f,v,b,!1)}case"hcl":{let[d,f,v,b]=t.hcl,[S,I,E,L]=i.hcl,z,R;if(isNaN(d)||isNaN(S))isNaN(d)?isNaN(S)?z=NaN:(z=S,v!==1&&v!==0||(R=I)):(z=d,E!==1&&E!==0||(R=f));else{let te=S-d;S>d&&te>180?te-=360:S<d&&d-S>180&&(te+=360),z=d+a*te}let[j,V,H,se]=(function([te,re,fe,we]){return te=isNaN(te)?0:te*sp,na([fe,Math.cos(te)*re,Math.sin(te)*re,we])})([z,R??Mr(f,I,a),Mr(v,E,a),Mr(b,L,a)]);return new Tt(j,V,H,se,!1)}case"lab":{let[d,f,v,b]=na(bo(t.lab,i.lab,a));return new Tt(d,f,v,b,!1)}}}}Tt.black=new Tt(0,0,0,1),Tt.white=new Tt(1,1,1,1),Tt.transparent=new Tt(0,0,0,0),Tt.red=new Tt(1,0,0,1);class wo{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let Ls=["bottom","center","top"];class Ds{constructor(t,i,a,l,d,f){this.text=t,this.image=i,this.scale=a,this.fontStack=l,this.textColor=d,this.verticalAlign=f}}class nn{constructor(t){this.sections=t}static fromString(t){return new nn([new Ds(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof nn?t:nn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class zi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof zi)return t;if(typeof t=="number")return new zi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new zi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){return new zi(bo(t.values,i.values,a))}}class rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof rn)return t;if(typeof t=="number")return new rn([t]);if(Array.isArray(t)){for(let i of t)if(typeof i!="number")return;return new rn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){return new rn(bo(t.values,i.values,a))}}class xi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof xi)return t;if(typeof t=="string"){let a=Tt.parse(t);return a?new xi([a]):void 0}if(!Array.isArray(t))return;let i=[];for(let a of t){if(typeof a!="string")return;let l=Tt.parse(a);if(!l)return;i.push(l)}return new xi(i)}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a,l="rgb"){let d=[];if(t.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let f=0;f<t.values.length;f++)d.push(Tt.interpolate(t.values[f],i.values[f],a,l));return new xi(d)}}class Wt extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}let Su=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class on{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof on)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){let a=t[i],l=t[i+1];if(typeof a!="string"||!Su.has(a)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new on(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){let l=t.values,d=i.values;if(l.length!==d.length)throw new Wt(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${i.toString()}`);let f=[];for(let v=0;v<l.length;v+=2){if(l[v]!==d[v])throw new Wt(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${l[v]}, to[${v}]: ${d[v]}`);f.push(l[v]);let[b,S]=l[v+1],[I,E]=d[v+1];f.push([Mr(b,I,a),Mr(S,E,a)])}return new on(f)}}class Sn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Sn({name:t,available:!1}):null}}class Yi{constructor(t,i,a){this.from=t,this.to=i,this.transition=a}static interpolate(t,i,a){return new Yi(t,i,a)}static parse(t){return t instanceof Yi?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Yi(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Yi(t.from,t.to,t.transition):typeof t=="string"?new Yi(t,t,1):void 0}}function ei(n,t,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,i,a]:[n,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function To(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Yi||n instanceof Tt||n instanceof wo||n instanceof nn||n instanceof zi||n instanceof rn||n instanceof xi||n instanceof on||n instanceof Sn)return!0;if(Array.isArray(n)){for(let t of n)if(!To(t))return!1;return!0}if(typeof n=="object"){for(let t in n)if(!To(n[t]))return!1;return!0}return!1}function rt(n){if(n===null)return Qo;if(typeof n=="string")return bt;if(typeof n=="boolean")return _t;if(typeof n=="number")return $e;if(n instanceof Tt)return Gi;if(n instanceof Yi)return vo;if(n instanceof wo)return Es;if(n instanceof nn)return Yr;if(n instanceof zi)return As;if(n instanceof rn)return ea;if(n instanceof xi)return dr;if(n instanceof on)return ks;if(n instanceof Sn)return pi;if(Array.isArray(n)){let t=n.length,i;for(let a of n){let l=rt(a);if(i){if(i===l)continue;i=ft;break}i=l}return gn(i||ft,t)}return Kr}function ht(n){let t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Tt||n instanceof Yi||n instanceof nn||n instanceof zi||n instanceof rn||n instanceof xi||n instanceof on||n instanceof Sn?n.toString():JSON.stringify(n)}class Er{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!To(t[1]))return i.error("invalid value");let a=t[1],l=rt(a),d=i.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new Er(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let Lt={string:bt,number:$e,boolean:_t,object:Kr};class In{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,l=1,d=t[0];if(d==="array"){let v,b;if(t.length>2){let S=t[1];if(typeof S!="string"||!(S in Lt)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=Lt[S],l++}else v=ft;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=t[2],l++}a=gn(v,b)}else{if(!Lt[d])throw new Error(`Types doesn't contain name = ${d}`);a=Lt[d]}let f=[];for(;l<t.length;l++){let v=i.parse(t[l],l,ft);if(!v)return null;f.push(v)}return new In(a,f)}evaluate(t){for(let i=0;i<this.args.length;i++){let a=this.args[i].evaluate(t);if(!ja(this.type,rt(a)))return a;if(i===this.args.length-1)throw new Wt(`Expected value to be of type ${qt(this.type)}, but found ${qt(rt(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let mr={"to-boolean":_t,"to-color":Gi,"to-number":$e,"to-string":bt};class fr{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a=t[0];if(!mr[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");let l=mr[a],d=[];for(let f=1;f<t.length;f++){let v=i.parse(t[f],f,ft);if(!v)return null;d.push(v)}return new fr(l,d)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,a;for(let l of this.args){if(i=l.evaluate(t),a=null,i instanceof Tt)return i;if(typeof i=="string"){let d=t.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ei(i[0],i[1],i[2],i[3]),!a))return new Tt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Wt(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(let a of this.args){i=a.evaluate(t);let l=zi.parse(i);if(l)return l}throw new Wt(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(let a of this.args){i=a.evaluate(t);let l=rn.parse(i);if(l)return l}throw new Wt(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(let a of this.args){i=a.evaluate(t);let l=xi.parse(i);if(l)return l}throw new Wt(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(let a of this.args){i=a.evaluate(t);let l=on.parse(i);if(l)return l}throw new Wt(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(let a of this.args){if(i=a.evaluate(t),i===null)return 0;let l=Number(i);if(!isNaN(l))return l}throw new Wt(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return nn.fromString(ht(this.args[0].evaluate(t)));case"resolvedImage":return Sn.fromString(ht(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ht(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let zs=["Unknown","Point","LineString","Polygon"];class rc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache.get(t);return i||(i=Tt.parse(t),this._parseColorCache.set(t,i)),i}}class oa{constructor(t,i,a=[],l,d=new Xr,f=[]){this.registry=t,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=d,this.errors=f,this.expectedType=l,this._isConstant=i}parse(t,i,a,l,d={}){return i?this.concat(i,a,l)._parse(t,d):this._parse(t,d)}_parse(t,i){function a(l,d,f){return f==="assert"?new In(d,[l]):f==="coerce"?new fr(d,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let d=this.registry[l];if(d){let f=d.parse(t,this);if(!f)return null;if(this.expectedType){let v=this.expectedType,b=f.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(b.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(b.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(b.kind)||v.kind==="colorArray"&&["value","string","array"].includes(b.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(b.kind))f=a(f,v,i.typeAnnotation||"coerce");else if(this.checkSubtype(v,b))return null}else f=a(f,v,i.typeAnnotation||"assert")}if(!(f instanceof Er)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){let v=new rc;try{f=new Er(f.type,f.evaluate(v))}catch(b){return this.error(b.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){let l=typeof t=="number"?this.path.concat(t):this.path,d=a?this.scope.concat(a):this.scope;return new oa(this.registry,this._isConstant,l,i||null,d,this.errors)}error(t,...i){let a=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new si(a,t))}checkSubtype(t,i){let a=ja(t,i);return a&&this.error(a),a}}class Na{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let a=[];for(let d=1;d<t.length-1;d+=2){let f=t[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);let v=i.parse(t[d+1],d+1);if(!v)return null;a.push([f,v])}let l=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return l?new Na(a,l):null}outputDefined(){return this.result.outputDefined()}}class Rs{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let a=t[1];return i.scope.has(a)?new Rs(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Fs{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=i.parse(t[1],1,$e),l=i.parse(t[2],2,gn(i.expectedType||ft));return a&&l?new Fs(l.type.itemType,a,l):null}evaluate(t){let i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new Wt(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Wt(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Wt(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Bs{constructor(t,i){this.type=_t,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=i.parse(t[1],1,ft),l=i.parse(t[2],2,ft);return a&&l?Yl(a.type,[_t,bt,$e,Qo,ft])?new Bs(a,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${qt(a.type)} instead`):null}evaluate(t){let i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!Jr(i,["boolean","string","number","null"]))throw new Wt(`Expected first argument to be of type boolean, string, number or null, but found ${qt(rt(i))} instead.`);if(!Jr(a,["string","array"]))throw new Wt(`Expected second argument to be of type array or string, but found ${qt(rt(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class qn{constructor(t,i,a){this.type=$e,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=i.parse(t[1],1,ft),l=i.parse(t[2],2,ft);if(!a||!l)return null;if(!Yl(a.type,[_t,bt,$e,Qo,ft]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${qt(a.type)} instead`);if(t.length===4){let d=i.parse(t[3],3,$e);return d?new qn(a,l,d):null}return new qn(a,l)}evaluate(t){let i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Jr(i,["boolean","string","number","null"]))throw new Wt(`Expected first argument to be of type boolean, string, number or null, but found ${qt(rt(i))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Jr(a,["string"])){let d=a.indexOf(i,l);return d===-1?-1:[...a.slice(0,d)].length}if(Jr(a,["array"]))return a.indexOf(i,l);throw new Wt(`Expected second argument to be of type array or string, but found ${qt(rt(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Ri{constructor(t,i,a,l,d,f){this.inputType=t,this.type=i,this.input=a,this.cases=l,this.outputs=d,this.otherwise=f}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);let d={},f=[];for(let S=2;S<t.length-1;S+=2){let I=t[S],E=t[S+1];Array.isArray(I)||(I=[I]);let L=i.concat(S);if(I.length===0)return L.error("Expected at least one branch label.");for(let R of I){if(typeof R!="number"&&typeof R!="string")return L.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return L.error("Numeric branch labels must be integer values.");if(a){if(L.checkSubtype(a,rt(R)))return null}else a=rt(R);if(d[String(R)]!==void 0)return L.error("Branch labels must be unique.");d[String(R)]=f.length}let z=i.parse(E,S,l);if(!z)return null;l=l||z.type,f.push(z)}let v=i.parse(t[1],1,ft);if(!v)return null;let b=i.parse(t[t.length-1],t.length-1,l);return b?v.type.kind!=="value"&&i.concat(1).checkSubtype(a,v.type)?null:new Ri(a,l,v,d,f,b):null}evaluate(t){let i=this.input.evaluate(t);return(rt(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class aa{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);let l=[];for(let f=1;f<t.length-1;f+=2){let v=i.parse(t[f],f,_t);if(!v)return null;let b=i.parse(t[f+1],f+1,a);if(!b)return null;l.push([v,b]),a=a||b.type}let d=i.parse(t[t.length-1],t.length-1,a);if(!d)return null;if(!a)throw new Error("Can't infer output type");return new aa(a,l,d)}evaluate(t){for(let[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class Va{constructor(t,i,a,l){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=l}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=i.parse(t[1],1,ft),l=i.parse(t[2],2,$e);if(!a||!l)return null;if(!Yl(a.type,[gn(ft),bt,ft]))return i.error(`Expected first argument to be of type array or string, but found ${qt(a.type)} instead`);if(t.length===4){let d=i.parse(t[3],3,$e);return d?new Va(a.type,a,l,d):null}return new Va(a.type,a,l)}evaluate(t){let i=this.input.evaluate(t),a=this.beginIndex.evaluate(t),l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Jr(i,["string"]))return[...i].slice(a,l).join("");if(Jr(i,["array"]))return i.slice(a,l);throw new Wt(`Expected first argument to be of type array or string, but found ${qt(rt(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function So(n,t){let i=n.length-1,a,l,d=0,f=i,v=0;for(;d<=f;)if(v=Math.floor((d+f)/2),a=n[v],l=n[v+1],a<=t){if(v===i||t<l)return v;d=v+1}else{if(!(a>t))throw new Wt("Input is not a number.");f=v-1}return 0}class di{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(let[l,d]of a)this.labels.push(l),this.outputs.push(d)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");let a=i.parse(t[1],1,$e);if(!a)return null;let l=[],d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<t.length;f+=2){let v=f===1?-1/0:t[f],b=t[f+1],S=f,I=f+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(l.length&&l[l.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);let E=i.parse(b,I,d);if(!E)return null;d=d||E.type,l.push([v,E])}return new di(d,a,l)}evaluate(t){let i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=i[0])return a[0].evaluate(t);let d=i.length;return l>=i[d-1]?a[d-1].evaluate(t):a[So(i,l)].evaluate(t)}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Iu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $a,oc,up=(function(){if(oc)return $a;function n(t,i,a,l){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=a,this.p2y=l}return oc=1,$a=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,l=0;l<8;l++){var d=this.sampleCurveX(a)-t;if(Math.abs(d)<i)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=d/f}var v=0,b=1;for(a=t,l=0;l<20&&(d=this.sampleCurveX(a),!(Math.abs(d-t)<i));l++)t>d?v=a:b=a,a=.5*(b-v)+v;return a},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},$a})(),sa=Iu(up);class Zi{constructor(t,i,a,l,d){this.type=t,this.operator=i,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(let[f,v]of d)this.labels.push(f),this.outputs.push(v)}static interpolationFactor(t,i,a,l){let d=0;if(t.name==="exponential")d=Ga(i,t.base,a,l);else if(t.name==="linear")d=Ga(i,1,a,l);else if(t.name==="cubic-bezier"){let f=t.controlPoints;d=new sa(f[0],f[1],f[2],f[3]).solve(Ga(i,1,a,l))}return d}static parse(t,i){let[a,l,d,...f]=t;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let S=l[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:S}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let S=l.slice(1);if(S.length!==4||S.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,$e),!d)return null;let v=[],b=null;a!=="interpolate-hcl"&&a!=="interpolate-lab"||i.expectedType==dr?i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType):b=Gi;for(let S=0;S<f.length;S+=2){let I=f[S],E=f[S+1],L=S+3,z=S+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);let R=i.parse(E,z,b);if(!R)return null;b=b||R.type,v.push([I,R])}return Qr(b,$e)||Qr(b,vo)||Qr(b,Gi)||Qr(b,As)||Qr(b,ea)||Qr(b,dr)||Qr(b,ks)||Qr(b,gn($e))?new Zi(b,a,l,d,v):i.error(`Type ${qt(b)} is not interpolatable.`)}evaluate(t){let i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=i[0])return a[0].evaluate(t);let d=i.length;if(l>=i[d-1])return a[d-1].evaluate(t);let f=So(i,l),v=Zi.interpolationFactor(this.interpolation,l,i[f],i[f+1]),b=a[f].evaluate(t),S=a[f+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Mr(b,S,v);case"color":return Tt.interpolate(b,S,v);case"padding":return zi.interpolate(b,S,v);case"colorArray":return xi.interpolate(b,S,v);case"numberArray":return rn.interpolate(b,S,v);case"variableAnchorOffsetCollection":return on.interpolate(b,S,v);case"array":return bo(b,S,v);case"projectionDefinition":return Yi.interpolate(b,S,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Tt.interpolate(b,S,v,"hcl");case"colorArray":return xi.interpolate(b,S,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Tt.interpolate(b,S,v,"lab");case"colorArray":return xi.interpolate(b,S,v,"lab")}}}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ga(n,t,i,a){let l=a-i,d=n-i;return l===0?0:t===1?d/l:(Math.pow(t,d)-1)/(Math.pow(t,l)-1)}let gr={color:Tt.interpolate,number:Mr,padding:zi.interpolate,numberArray:rn.interpolate,colorArray:xi.interpolate,variableAnchorOffsetCollection:on.interpolate,array:bo};class Za{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a=null,l=i.expectedType;l&&l.kind!=="value"&&(a=l);let d=[];for(let v of t.slice(1)){let b=i.parse(v,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,d.push(b)}if(!a)throw new Error("No output type");let f=l&&d.some(v=>ja(l,v.type));return new Za(f?ft:a,d)}evaluate(t){let i,a=null,l=0;for(let d of this.args)if(l++,a=d.evaluate(t),a&&a instanceof Sn&&!a.available&&(i||(i=a.name),a=null,l===this.args.length&&(a=i)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function qa(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Wa(n,t,i,a){return a.compare(t,i)===0}function Ji(n,t,i){let a=n!=="=="&&n!=="!=";return class db{constructor(d,f,v){this.type=_t,this.lhs=d,this.rhs=f,this.collator=v,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");let v=d[0],b=f.parse(d[1],1,ft);if(!b)return null;if(!qa(v,b.type))return f.concat(1).error(`"${v}" comparisons are not supported for type '${qt(b.type)}'.`);let S=f.parse(d[2],2,ft);if(!S)return null;if(!qa(v,S.type))return f.concat(2).error(`"${v}" comparisons are not supported for type '${qt(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error(`Cannot compare types '${qt(b.type)}' and '${qt(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new In(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new In(b.type,[S])));let I=null;if(d.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(I=f.parse(d[3],3,Es),!I)return null}return new db(b,S,I)}evaluate(d){let f=this.lhs.evaluate(d),v=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){let b=rt(f),S=rt(v);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new Wt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let b=rt(f),S=rt(v);if(b.kind!=="string"||S.kind!=="string")return t(d,f,v)}return this.collator?i(d,f,v,this.collator.evaluate(d)):t(d,f,v)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}let Pu=Ji("==",function(n,t,i){return t===i},Wa),Os=Ji("!=",function(n,t,i){return t!==i},function(n,t,i,a){return!Wa(0,t,i,a)}),hp=Ji("<",function(n,t,i){return t<i},function(n,t,i,a){return a.compare(t,i)<0}),ac=Ji(">",function(n,t,i){return t>i},function(n,t,i,a){return a.compare(t,i)>0}),pp=Ji("<=",function(n,t,i){return t<=i},function(n,t,i,a){return a.compare(t,i)<=0}),dp=Ji(">=",function(n,t,i){return t>=i},function(n,t,i,a){return a.compare(t,i)>=0});class js{constructor(t,i,a){this.type=Es,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");let a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");let l=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,_t);if(!l)return null;let d=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,_t);if(!d)return null;let f=null;return a.locale&&(f=i.parse(a.locale,1,bt),!f)?null:new js(l,d,f)}evaluate(t){return new wo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class sc{constructor(t,i,a,l,d){this.type=bt,this.number=t,this.locale=i,this.currency=a,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");let a=i.parse(t[1],1,$e);if(!a)return null;let l=t[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=i.parse(l.locale,1,bt),!d))return null;let f=null;if(l.currency&&(f=i.parse(l.currency,1,bt),!f))return null;let v=null;if(l["min-fraction-digits"]&&(v=i.parse(l["min-fraction-digits"],1,$e),!v))return null;let b=null;return l["max-fraction-digits"]&&(b=i.parse(l["max-fraction-digits"],1,$e),!b)?null:new sc(a,d,f,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Io{constructor(t){this.type=Yr,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");let l=[],d=!1;for(let f=1;f<=t.length-1;++f){let v=t[f];if(d&&typeof v=="object"&&!Array.isArray(v)){d=!1;let b=null;if(v["font-scale"]&&(b=i.parse(v["font-scale"],1,$e),!b))return null;let S=null;if(v["text-font"]&&(S=i.parse(v["text-font"],1,gn(bt)),!S))return null;let I=null;if(v["text-color"]&&(I=i.parse(v["text-color"],1,Gi),!I))return null;let E=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!Ls.includes(v["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(E=i.parse(v["vertical-align"],1,bt),!E)return null}let L=l[l.length-1];L.scale=b,L.font=S,L.textColor=I,L.verticalAlign=E}else{let b=i.parse(t[f],1,ft);if(!b)return null;let S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:b,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Io(l)}evaluate(t){return new nn(this.sections.map(i=>{let a=i.content.evaluate(t);return rt(a)===pi?new Ds("",a,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(t):null):new Ds(ht(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null,i.verticalAlign?i.verticalAlign.evaluate(t):null)}))}eachChild(t){for(let i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor),i.verticalAlign&&t(i.verticalAlign)}outputDefined(){return!1}}class lc{constructor(t){this.type=pi,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");let a=i.parse(t[1],1,bt);return a?new lc(a):i.error("No image name provided.")}evaluate(t){let i=this.input.evaluate(t),a=Sn.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class Us{constructor(t){this.type=$e,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${qt(a.type)} instead.`):new Us(a):null}evaluate(t){let i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Wt(`Expected value to be of type string or array, but found ${qt(rt(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Wn=8192;function mp(n,t){let i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(i*l*Wn),Math.round(a*l*Wn)]}function Ns(n,t){let i=Math.pow(2,t.z);return[(l=(n[0]/Wn+t.x)/i,360*l-180),(a=(n[1]/Wn+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,l}function Ha(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Xa(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function fp(n,t,i){let a=n[0]-t[0],l=n[1]-t[1],d=n[0]-i[0],f=n[1]-i[1];return a*f-d*l==0&&a*d<=0&&l*f<=0}function Vs(n,t,i,a){return(l=[a[0]-i[0],a[1]-i[1]])[0]*(d=[t[0]-n[0],t[1]-n[1]])[1]-l[1]*d[0]!=0&&!(!Mu(n,t,i,a)||!Mu(i,a,n,t));var l,d}function gp(n,t,i){for(let a of i)for(let l=0;l<a.length-1;++l)if(Vs(n,t,a[l],a[l+1]))return!0;return!1}function Po(n,t,i=!1){let a=!1;for(let v of t)for(let b=0;b<v.length-1;b++){if(fp(n,v[b],v[b+1]))return i;(d=v[b])[1]>(l=n)[1]!=(f=v[b+1])[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(a=!a)}var l,d,f;return a}function Cu(n,t){for(let i of t)if(Po(n,i))return!0;return!1}function cc(n,t){for(let i of n)if(!Po(i,t))return!1;for(let i=0;i<n.length-1;++i)if(gp(n[i],n[i+1],t))return!1;return!0}function _p(n,t){for(let i of t)if(cc(n,i))return!0;return!1}function Mu(n,t,i,a){let l=a[0]-i[0],d=a[1]-i[1],f=(n[0]-i[0])*d-l*(n[1]-i[1]),v=(t[0]-i[0])*d-l*(t[1]-i[1]);return f>0&&v<0||f<0&&v>0}function uc(n,t,i){let a=[];for(let l=0;l<n.length;l++){let d=[];for(let f=0;f<n[l].length;f++){let v=mp(n[l][f],i);Ha(t,v),d.push(v)}a.push(d)}return a}function Eu(n,t,i){let a=[];for(let l=0;l<n.length;l++){let d=uc(n[l],t,i);a.push(d)}return a}function $s(n,t,i,a){if(n[0]<i[0]||n[0]>i[2]){let l=.5*a,d=n[0]-i[0]>l?-a:i[0]-n[0]>l?a:0;d===0&&(d=n[0]-i[2]>l?-a:i[2]-n[0]>l?a:0),n[0]+=d}Ha(t,n)}function Au(n,t,i,a){let l=Math.pow(2,a.z)*Wn,d=[a.x*Wn,a.y*Wn],f=[];for(let v of n)for(let b of v){let S=[b.x+d[0],b.y+d[1]];$s(S,t,i,l),f.push(S)}return f}function ku(n,t,i,a){let l=Math.pow(2,a.z)*Wn,d=[a.x*Wn,a.y*Wn],f=[];for(let b of n){let S=[];for(let I of b){let E=[I.x+d[0],I.y+d[1]];Ha(t,E),S.push(E)}f.push(S)}if(t[2]-t[0]<=l/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let b of f)for(let S of b)$s(S,t,i,l)}var v;return f}class Co{constructor(t,i){this.type=_t,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(To(t[1])){let a=t[1];if(a.type==="FeatureCollection"){let l=[];for(let d of a.features){let{type:f,coordinates:v}=d.geometry;f==="Polygon"&&l.push(v),f==="MultiPolygon"&&l.push(...v)}if(l.length)return new Co(a,{type:"MultiPolygon",coordinates:l})}else if(a.type==="Feature"){let l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Co(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Co(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,a){let l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(a.type==="Polygon"){let v=uc(a.coordinates,d,f),b=Au(i.geometry(),l,d,f);if(!Xa(l,d))return!1;for(let S of b)if(!Po(S,v))return!1}if(a.type==="MultiPolygon"){let v=Eu(a.coordinates,d,f),b=Au(i.geometry(),l,d,f);if(!Xa(l,d))return!1;for(let S of b)if(!Cu(S,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,a){let l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(a.type==="Polygon"){let v=uc(a.coordinates,d,f),b=ku(i.geometry(),l,d,f);if(!Xa(l,d))return!1;for(let S of b)if(!cc(S,v))return!1}if(a.type==="MultiPolygon"){let v=Eu(a.coordinates,d,f),b=ku(i.geometry(),l,d,f);if(!Xa(l,d))return!1;for(let S of b)if(!_p(S,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let hc=class{constructor(n=[],t=(i,a)=>i<a?-1:i>a?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;let n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){let{data:t,compare:i}=this,a=t[n];for(;n>0;){let l=n-1>>1,d=t[l];if(i(a,d)>=0)break;t[n]=d,n=l}t[n]=a}_down(n){let{data:t,compare:i}=this,a=this.length>>1,l=t[n];for(;n<a;){let d=1+(n<<1),f=d+1;if(f<this.length&&i(t[f],t[d])<0&&(d=f),i(t[d],l)>=0)break;t[n]=t[d],n=d}t[n]=l}};function pc(n,t,i=0,a=n.length-1,l=yp){for(;a>i;){if(a-i>600){let b=a-i+1,S=t-i+1,I=Math.log(b),E=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*E*(b-E)/b)*(S-b/2<0?-1:1);pc(n,t,Math.max(i,Math.floor(t-S*E/b+L)),Math.min(a,Math.floor(t+(b-S)*E/b+L)),l)}let d=n[t],f=i,v=a;for(Ka(n,i,t),l(n[a],d)>0&&Ka(n,i,a);f<v;){for(Ka(n,f,v),f++,v--;l(n[f],d)<0;)f++;for(;l(n[v],d)>0;)v--}l(n[i],d)===0?Ka(n,i,v):(v++,Ka(n,v,a)),v<=t&&(i=v+1),t<=v&&(a=v-1)}}function Ka(n,t,i){let a=n[t];n[t]=n[i],n[i]=a}function yp(n,t){return n<t?-1:n>t?1:0}function Ya(n,t){if(n.length<=1)return[n];let i=[],a,l;for(let d of n){let f=vp(d);f!==0&&(d.area=Math.abs(f),l===void 0&&(l=f<0),l===f<0?(a&&i.push(a),a=[d]):a.push(d))}if(a&&i.push(a),t>1)for(let d=0;d<i.length;d++)i[d].length<=t||(pc(i[d],t,1,i[d].length-1,Lu),i[d]=i[d].slice(0,t));return i}function Lu(n,t){return t.area-n.area}function vp(n){let t=0;for(let i,a,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],a=n[f],t+=(a.x-i.x)*(i.y+a.y);return t}let Du=1/298.257223563,zu=Du*(2-Du),dc=Math.PI/180;class mc{constructor(t){let i=6378.137*dc*1e3,a=Math.cos(t*dc),l=1/(1-zu*(1-a*a)),d=Math.sqrt(l);this.kx=i*d*a,this.ky=i*d*l*(1-zu)}distance(t,i){let a=this.wrap(t[0]-i[0])*this.kx,l=(t[1]-i[1])*this.ky;return Math.sqrt(a*a+l*l)}pointOnLine(t,i){let a,l,d,f,v=1/0;for(let b=0;b<t.length-1;b++){let S=t[b][0],I=t[b][1],E=this.wrap(t[b+1][0]-S)*this.kx,L=(t[b+1][1]-I)*this.ky,z=0;E===0&&L===0||(z=(this.wrap(i[0]-S)*this.kx*E+(i[1]-I)*this.ky*L)/(E*E+L*L),z>1?(S=t[b+1][0],I=t[b+1][1]):z>0&&(S+=E/this.kx*z,I+=L/this.ky*z)),E=this.wrap(i[0]-S)*this.kx,L=(i[1]-I)*this.ky;let R=E*E+L*L;R<v&&(v=R,a=S,l=I,d=b,f=z)}return{point:[a,l],index:d,t:Math.max(0,Math.min(1,f))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ru(n,t){return t[0]-n[0]}function Gs(n){return n[1]-n[0]+1}function Ar(n,t){return n[1]>=n[0]&&n[1]<t}function zt(n,t){if(n[0]>n[1])return[null,null];let i=Gs(n);if(t){if(i===2)return[n,null];let l=Math.floor(i/2);return[[n[0],n[0]+l],[n[0]+l,n[1]]]}if(i===1)return[n,null];let a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function fc(n,t){if(!Ar(t,n.length))return[1/0,1/0,-1/0,-1/0];let i=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)Ha(i,n[a]);return i}function gc(n){let t=[1/0,1/0,-1/0,-1/0];for(let i of n)for(let a of i)Ha(t,a);return t}function Fu(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function _c(n,t,i){if(!Fu(n)||!Fu(t))return NaN;let a=0,l=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(l=n[1]-t[3]),n[3]<t[1]&&(l=t[1]-n[3]),i.distance([0,0],[a,l])}function Mo(n,t,i){let a=i.pointOnLine(t,n);return i.distance(n,a.point)}function yc(n,t,i,a,l){let d=Math.min(Mo(n,[i,a],l),Mo(t,[i,a],l)),f=Math.min(Mo(i,[n,t],l),Mo(a,[n,t],l));return Math.min(d,f)}function xp(n,t,i,a,l){if(!Ar(t,n.length)||!Ar(a,i.length))return 1/0;let d=1/0;for(let f=t[0];f<t[1];++f){let v=n[f],b=n[f+1];for(let S=a[0];S<a[1];++S){let I=i[S],E=i[S+1];if(Vs(v,b,I,E))return 0;d=Math.min(d,yc(v,b,I,E,l))}}return d}function bp(n,t,i,a,l){if(!Ar(t,n.length)||!Ar(a,i.length))return NaN;let d=1/0;for(let f=t[0];f<=t[1];++f)for(let v=a[0];v<=a[1];++v)if(d=Math.min(d,l.distance(n[f],i[v])),d===0)return d;return d}function wp(n,t,i){if(Po(n,t,!0))return 0;let a=1/0;for(let l of t){let d=l[0],f=l[l.length-1];if(d!==f&&(a=Math.min(a,Mo(n,[f,d],i)),a===0))return a;let v=i.pointOnLine(l,n);if(a=Math.min(a,i.distance(n,v.point)),a===0)return a}return a}function Tp(n,t,i,a){if(!Ar(t,n.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Po(n[d],i,!0))return 0;let l=1/0;for(let d=t[0];d<t[1];++d){let f=n[d],v=n[d+1];for(let b of i)for(let S=0,I=b.length,E=I-1;S<I;E=S++){let L=b[E],z=b[S];if(Vs(f,v,L,z))return 0;l=Math.min(l,yc(f,v,L,z,a))}}return l}function Bu(n,t){for(let i of n)for(let a of i)if(Po(a,t,!0))return!0;return!1}function Sp(n,t,i,a=1/0){let l=gc(n),d=gc(t);if(a!==1/0&&_c(l,d,i)>=a)return a;if(Xa(l,d)){if(Bu(n,t))return 0}else if(Bu(t,n))return 0;let f=1/0;for(let v of n)for(let b=0,S=v.length,I=S-1;b<S;I=b++){let E=v[I],L=v[b];for(let z of t)for(let R=0,j=z.length,V=j-1;R<j;V=R++){let H=z[V],se=z[R];if(Vs(E,L,H,se))return 0;f=Math.min(f,yc(E,L,H,se,i))}}return f}function Ou(n,t,i,a,l,d){if(!d)return;let f=_c(fc(a,d),l,i);f<t&&n.push([f,d,[0,0]])}function Zs(n,t,i,a,l,d,f){if(!d||!f)return;let v=_c(fc(a,d),fc(l,f),i);v<t&&n.push([v,d,f])}function qs(n,t,i,a,l=1/0){let d=Math.min(a.distance(n[0],i[0][0]),l);if(d===0)return d;let f=new hc([[0,[0,n.length-1],[0,0]]],Ru),v=gc(i);for(;f.length>0;){let b=f.pop();if(b[0]>=d)continue;let S=b[1],I=t?50:100;if(Gs(S)<=I){if(!Ar(S,n.length))return NaN;if(t){let E=Tp(n,S,i,a);if(isNaN(E)||E===0)return E;d=Math.min(d,E)}else for(let E=S[0];E<=S[1];++E){let L=wp(n[E],i,a);if(d=Math.min(d,L),d===0)return 0}}else{let E=zt(S,t);Ou(f,d,a,n,v,E[0]),Ou(f,d,a,n,v,E[1])}}return d}function Ws(n,t,i,a,l,d=1/0){let f=Math.min(d,l.distance(n[0],i[0]));if(f===0)return f;let v=new hc([[0,[0,n.length-1],[0,i.length-1]]],Ru);for(;v.length>0;){let b=v.pop();if(b[0]>=f)continue;let S=b[1],I=b[2],E=t?50:100,L=a?50:100;if(Gs(S)<=E&&Gs(I)<=L){if(!Ar(S,n.length)&&Ar(I,i.length))return NaN;let z;if(t&&a)z=xp(n,S,i,I,l),f=Math.min(f,z);else if(t&&!a){let R=n.slice(S[0],S[1]+1);for(let j=I[0];j<=I[1];++j)if(z=Mo(i[j],R,l),f=Math.min(f,z),f===0)return f}else if(!t&&a){let R=i.slice(I[0],I[1]+1);for(let j=S[0];j<=S[1];++j)if(z=Mo(n[j],R,l),f=Math.min(f,z),f===0)return f}else z=bp(n,S,i,I,l),f=Math.min(f,z)}else{let z=zt(S,t),R=zt(I,a);Zs(v,f,l,n,i,z[0],R[0]),Zs(v,f,l,n,i,z[0],R[1]),Zs(v,f,l,n,i,z[1],R[0]),Zs(v,f,l,n,i,z[1],R[1])}}return f}function vc(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class Eo{constructor(t,i){this.type=$e,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(To(t[1])){let a=t[1];if(a.type==="FeatureCollection")return new Eo(a,a.features.map(l=>vc(l.geometry)).flat());if(a.type==="Feature")return new Eo(a,vc(a.geometry));if("type"in a&&"coordinates"in a)return new Eo(a,vc(a))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,a){let l=i.geometry(),d=l.flat().map(b=>Ns([b.x,b.y],i.canonical));if(l.length===0)return NaN;let f=new mc(d[0][1]),v=1/0;for(let b of a){switch(b.type){case"Point":v=Math.min(v,Ws(d,!1,[b.coordinates],!1,f,v));break;case"LineString":v=Math.min(v,Ws(d,!1,b.coordinates,!0,f,v));break;case"Polygon":v=Math.min(v,qs(d,!1,b.coordinates,f,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,a){let l=i.geometry(),d=l.flat().map(b=>Ns([b.x,b.y],i.canonical));if(l.length===0)return NaN;let f=new mc(d[0][1]),v=1/0;for(let b of a){switch(b.type){case"Point":v=Math.min(v,Ws(d,!0,[b.coordinates],!1,f,v));break;case"LineString":v=Math.min(v,Ws(d,!0,b.coordinates,!0,f,v));break;case"Polygon":v=Math.min(v,qs(d,!0,b.coordinates,f,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(i,a){let l=i.geometry();if(l.length===0||l[0].length===0)return NaN;let d=Ya(l,0).map(b=>b.map(S=>S.map(I=>Ns([I.x,I.y],i.canonical)))),f=new mc(d[0][0][0][1]),v=1/0;for(let b of a)for(let S of d){switch(b.type){case"Point":v=Math.min(v,qs([b.coordinates],!1,S,f,v));break;case"LineString":v=Math.min(v,qs(b.coordinates,!0,S,f,v));break;case"Polygon":v=Math.min(v,Sp(S,b.coordinates,f,v))}if(v===0)return v}return v})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ja{constructor(t){this.type=ft,this.key=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=t[1];return a==null?i.error("Global state property must be defined."):typeof a!="string"?i.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Ja(a)}evaluate(t){var i;let a=(i=t.globals)===null||i===void 0?void 0:i.globalState;return a&&Object.keys(a).length!==0?ra(a,this.key):null}eachChild(){}outputDefined(){return!1}}let la={"==":Pu,"!=":Os,">":ac,"<":hp,">=":dp,"<=":pp,array:In,at:Fs,boolean:In,case:aa,coalesce:Za,collator:js,format:Io,image:lc,in:Bs,"index-of":qn,interpolate:Zi,"interpolate-hcl":Zi,"interpolate-lab":Zi,length:Us,let:Na,literal:Er,match:Ri,number:In,"number-format":sc,object:In,slice:Va,step:di,string:In,"to-boolean":fr,"to-color":fr,"to-number":fr,"to-string":fr,var:Rs,within:Co,distance:Eo,"global-state":Ja};class zn{constructor(t,i,a,l){this.name=t,this.type=i,this._evaluate=a,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){let a=t[0],l=zn.definitions[a];if(!l)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,v=f.filter(([S])=>!Array.isArray(S)||S.length===t.length-1),b=null;for(let[S,I]of v){b=new oa(i.registry,Hs,i.path,null,i.scope);let E=[],L=!1;for(let z=1;z<t.length;z++){let R=t[z],j=Array.isArray(S)?S[z-1]:S.type,V=b.parse(R,1+E.length,j);if(!V){L=!0;break}E.push(V)}if(!L)if(Array.isArray(S)&&S.length!==E.length)b.error(`Expected ${S.length} arguments, but found ${E.length} instead.`);else{for(let z=0;z<E.length;z++){let R=Array.isArray(S)?S[z]:S.type,j=E[z];b.concat(z+1).checkSubtype(R,j.type)}if(b.errors.length===0)return new zn(a,d,I,E)}}if(v.length===1)i.errors.push(...b.errors);else{let S=(v.length?v:f).map(([E])=>{return L=E,Array.isArray(L)?`(${L.map(qt).join(", ")})`:`(${qt(L.type)}...)`;var L}).join(" | "),I=[];for(let E=1;E<t.length;E++){let L=i.parse(t[E],1+I.length);if(!L)return null;I.push(qt(L.type))}i.error(`Expected arguments of type ${S}, but found (${I.join(", ")}) instead.`)}return null}static register(t,i){zn.definitions=i;for(let a in i)t[a]=zn}}function ju(n,[t,i,a,l]){t=t.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);let d=l?l.evaluate(n):1,f=ei(t,i,a,d);if(f)throw new Wt(f);return new Tt(t/255,i/255,a/255,d,!1)}function Uu(n,t){return n in t}function xc(n,t){let i=t[n];return i===void 0?null:i}function Ao(n){return{type:n}}function Hs(n){if(n instanceof Rs)return Hs(n.boundExpression);if(n instanceof zn&&n.name==="error"||n instanceof js||n instanceof Co||n instanceof Eo||n instanceof Ja)return!1;let t=n instanceof fr||n instanceof In,i=!0;return n.eachChild(a=>{i=t?i&&Hs(a):i&&a instanceof Er}),!!i&&Xs(n)&&Ks(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Xs(n){if(n instanceof zn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Co||n instanceof Eo)return!1;let t=!0;return n.eachChild(i=>{t&&!Xs(i)&&(t=!1)}),t}function Qa(n){if(n instanceof zn&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(i=>{t&&!Qa(i)&&(t=!1)}),t}function Ks(n,t){if(n instanceof zn&&t.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!Ks(a,t)&&(i=!1)}),i}function Nu(n){return{result:"success",value:n}}function ca(n){return{result:"error",value:n}}function to(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Vu(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function bc(n){return!!n.expression&&n.expression.interpolated}function Pt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function es(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&rt(n)===Kr}function Ip(n){return n}function $u(n,t){let i=n.stops&&typeof n.stops[0][0]=="object",a=i||!(i||n.property!==void 0),l=n.type||(bc(t)?"exponential":"interval"),d=(function(I){switch(I.type){case"color":return Tt.parse;case"padding":return zi.parse;case"numberArray":return rn.parse;case"colorArray":return xi.parse;default:return null}})(t);if(d&&((n=Ki({},n)).stops&&(n.stops=n.stops.map(I=>[I[0],d(I[1])])),n.default=d(n.default?n.default:t.default)),n.colorSpace&&(f=n.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var f;let v=(function(I){switch(I){case"exponential":return Zu;case"interval":return Pp;case"categorical":return Gu;case"identity":return Cp;default:throw new Error(`Unknown function type "${I}"`)}})(l),b,S;if(l==="categorical"){b=Object.create(null);for(let I of n.stops)b[I[0]]=I[1];S=typeof n.stops[0][0]}if(i){let I={},E=[];for(let R=0;R<n.stops.length;R++){let j=n.stops[R],V=j[0].zoom;I[V]===void 0&&(I[V]={zoom:V,type:n.type,property:n.property,default:n.default,stops:[]},E.push(V)),I[V].stops.push([j[0].value,j[1]])}let L=[];for(let R of E)L.push([I[R].zoom,$u(I[R],t)]);let z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Zi.interpolationFactor.bind(void 0,z),zoomStops:L.map(R=>R[0]),evaluate:({zoom:R},j)=>Zu({stops:L,base:n.base},t,R).evaluate(R,j)}}if(a){let I=l==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Zi.interpolationFactor.bind(void 0,I),zoomStops:n.stops.map(E=>E[0]),evaluate:({zoom:E})=>v(n,t,E,b,S)}}return{kind:"source",evaluate(I,E){let L=E&&E.properties?E.properties[n.property]:void 0;return L===void 0?io(n.default,t.default):v(n,t,L,b,S)}}}function io(n,t,i){return n!==void 0?n:t!==void 0?t:i!==void 0?i:void 0}function Gu(n,t,i,a,l){return io(typeof i===l?a[i]:void 0,n.default,t.default)}function Pp(n,t,i){if(Pt(i)!=="number")return io(n.default,t.default);let a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];let l=So(n.stops.map(d=>d[0]),i);return n.stops[l][1]}function Zu(n,t,i){let a=n.base!==void 0?n.base:1;if(Pt(i)!=="number")return io(n.default,t.default);let l=n.stops.length;if(l===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[l-1][0])return n.stops[l-1][1];let d=So(n.stops.map(I=>I[0]),i),f=(function(I,E,L,z){let R=z-L,j=I-L;return R===0?0:E===1?j/R:(Math.pow(E,j)-1)/(Math.pow(E,R)-1)})(i,a,n.stops[d][0],n.stops[d+1][0]),v=n.stops[d][1],b=n.stops[d+1][1],S=gr[t.type]||Ip;return typeof v.evaluate=="function"?{evaluate(...I){let E=v.evaluate.apply(void 0,I),L=b.evaluate.apply(void 0,I);if(E!==void 0&&L!==void 0)return S(E,L,f,n.colorSpace)}}:S(v,b,f,n.colorSpace)}function Cp(n,t,i){switch(t.type){case"color":i=Tt.parse(i);break;case"formatted":i=nn.fromString(i.toString());break;case"resolvedImage":i=Sn.fromString(i.toString());break;case"padding":i=zi.parse(i);break;case"colorArray":i=xi.parse(i);break;case"numberArray":i=rn.parse(i);break;default:Pt(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return io(i,n.default,t.default)}zn.register(la,{error:[{kind:"error"},[bt],(n,[t])=>{throw new Wt(t.evaluate(n))}],typeof:[bt,[ft],(n,[t])=>qt(rt(t.evaluate(n)))],"to-rgba":[gn($e,4),[Gi],(n,[t])=>{let[i,a,l,d]=t.evaluate(n).rgb;return[255*i,255*a,255*l,d]}],rgb:[Gi,[$e,$e,$e],ju],rgba:[Gi,[$e,$e,$e,$e],ju],has:{type:_t,overloads:[[[bt],(n,[t])=>Uu(t.evaluate(n),n.properties())],[[bt,Kr],(n,[t,i])=>Uu(t.evaluate(n),i.evaluate(n))]]},get:{type:ft,overloads:[[[bt],(n,[t])=>xc(t.evaluate(n),n.properties())],[[bt,Kr],(n,[t,i])=>xc(t.evaluate(n),i.evaluate(n))]]},"feature-state":[ft,[bt],(n,[t])=>xc(t.evaluate(n),n.featureState||{})],properties:[Kr,[],n=>n.properties()],"geometry-type":[bt,[],n=>n.geometryType()],id:[ft,[],n=>n.id()],zoom:[$e,[],n=>n.globals.zoom],"heatmap-density":[$e,[],n=>n.globals.heatmapDensity||0],elevation:[$e,[],n=>n.globals.elevation||0],"line-progress":[$e,[],n=>n.globals.lineProgress||0],accumulated:[ft,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[$e,Ao($e),(n,t)=>{let i=0;for(let a of t)i+=a.evaluate(n);return i}],"*":[$e,Ao($e),(n,t)=>{let i=1;for(let a of t)i*=a.evaluate(n);return i}],"-":{type:$e,overloads:[[[$e,$e],(n,[t,i])=>t.evaluate(n)-i.evaluate(n)],[[$e],(n,[t])=>-t.evaluate(n)]]},"/":[$e,[$e,$e],(n,[t,i])=>t.evaluate(n)/i.evaluate(n)],"%":[$e,[$e,$e],(n,[t,i])=>t.evaluate(n)%i.evaluate(n)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(n,[t,i])=>Math.pow(t.evaluate(n),i.evaluate(n))],sqrt:[$e,[$e],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[$e,[$e],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[$e,[$e],(n,[t])=>Math.log(t.evaluate(n))],log2:[$e,[$e],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[$e,[$e],(n,[t])=>Math.sin(t.evaluate(n))],cos:[$e,[$e],(n,[t])=>Math.cos(t.evaluate(n))],tan:[$e,[$e],(n,[t])=>Math.tan(t.evaluate(n))],asin:[$e,[$e],(n,[t])=>Math.asin(t.evaluate(n))],acos:[$e,[$e],(n,[t])=>Math.acos(t.evaluate(n))],atan:[$e,[$e],(n,[t])=>Math.atan(t.evaluate(n))],min:[$e,Ao($e),(n,t)=>Math.min(...t.map(i=>i.evaluate(n)))],max:[$e,Ao($e),(n,t)=>Math.max(...t.map(i=>i.evaluate(n)))],abs:[$e,[$e],(n,[t])=>Math.abs(t.evaluate(n))],round:[$e,[$e],(n,[t])=>{let i=t.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[$e,[$e],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[$e,[$e],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[_t,[bt,ft],(n,[t,i])=>n.properties()[t.value]===i.value],"filter-id-==":[_t,[ft],(n,[t])=>n.id()===t.value],"filter-type-==":[_t,[bt],(n,[t])=>n.geometryType()===t.value],"filter-<":[_t,[bt,ft],(n,[t,i])=>{let a=n.properties()[t.value],l=i.value;return typeof a==typeof l&&a<l}],"filter-id-<":[_t,[ft],(n,[t])=>{let i=n.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[_t,[bt,ft],(n,[t,i])=>{let a=n.properties()[t.value],l=i.value;return typeof a==typeof l&&a>l}],"filter-id->":[_t,[ft],(n,[t])=>{let i=n.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[_t,[bt,ft],(n,[t,i])=>{let a=n.properties()[t.value],l=i.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[_t,[ft],(n,[t])=>{let i=n.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[_t,[bt,ft],(n,[t,i])=>{let a=n.properties()[t.value],l=i.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[_t,[ft],(n,[t])=>{let i=n.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[_t,[ft],(n,[t])=>t.value in n.properties()],"filter-has-id":[_t,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[_t,[gn(bt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[_t,[gn(ft)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[_t,[bt,gn(ft)],(n,[t,i])=>i.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[_t,[bt,gn(ft)],(n,[t,i])=>(function(a,l,d,f){for(;d<=f;){let v=d+f>>1;if(l[v]===a)return!0;l[v]>a?f=v-1:d=v+1}return!1})(n.properties()[t.value],i.value,0,i.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(n,[t,i])=>t.evaluate(n)&&i.evaluate(n)],[Ao(_t),(n,t)=>{for(let i of t)if(!i.evaluate(n))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(n,[t,i])=>t.evaluate(n)||i.evaluate(n)],[Ao(_t),(n,t)=>{for(let i of t)if(i.evaluate(n))return!0;return!1}]]},"!":[_t,[_t],(n,[t])=>!t.evaluate(n)],"is-supported-script":[_t,[bt],(n,[t])=>{let i=n.globals&&n.globals.isSupportedScript;return!i||i(t.evaluate(n))}],upcase:[bt,[bt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[bt,[bt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[bt,Ao(ft),(n,t)=>t.map(i=>ht(i.evaluate(n))).join("")],"resolved-locale":[bt,[Es],(n,[t])=>t.evaluate(n).resolvedLocale()]});class wc{constructor(t,i){this.expression=t,this._warningHistory={},this._evaluator=new rc,this._defaultValue=i?(function(a){if(a.type==="color"&&es(a.default))return new Tt(0,0,0,0);switch(a.type){case"color":return Tt.parse(a.default)||null;case"padding":return zi.parse(a.default)||null;case"numberArray":return rn.parse(a.default)||null;case"colorArray":return xi.parse(a.default)||null;case"variableAnchorOffsetCollection":return on.parse(a.default)||null;case"projectionDefinition":return Yi.parse(a.default)||null;default:return a.default===void 0?null:a.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,l,d,f){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,l,d,f){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{let v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Wt(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Ys(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in la}function ts(n,t){let i=new oa(la,Hs,[],t?(function(l){let d={color:Gi,string:bt,number:$e,enum:bt,boolean:_t,formatted:Yr,padding:As,numberArray:ea,colorArray:dr,projectionDefinition:vo,resolvedImage:pi,variableAnchorOffsetCollection:ks};return l.type==="array"?gn(d[l.value]||ft,l.length):d[l.type]})(t):void 0),a=i.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Nu(new wc(a,t)):ca(i.errors)}class is{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!Qa(i.expression),this.globalStateRefs=os(i.expression)}evaluateWithoutErrorHandling(t,i,a,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,l,d,f)}evaluate(t,i,a,l,d,f){return this._styleExpression.evaluate(t,i,a,l,d,f)}}class Tc{constructor(t,i,a,l){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!Qa(i.expression),this.globalStateRefs=os(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,i,a,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,l,d,f)}evaluate(t,i,a,l,d,f){return this._styleExpression.evaluate(t,i,a,l,d,f)}interpolationFactor(t,i,a){return this.interpolationType?Zi.interpolationFactor(this.interpolationType,t,i,a):0}}function qu(n,t){let i=ts(n,t);if(i.result==="error")return i;let a=i.value.expression,l=Xs(a);if(!l&&!to(t))return ca([new si("","data expressions not supported")]);let d=Ks(a,["zoom"]);if(!d&&!Vu(t))return ca([new si("","zoom expressions not supported")]);let f=rs(a);return f||d?f instanceof si?ca([f]):f instanceof Zi&&!bc(t)?ca([new si("",'"interpolate" expressions cannot be used with this property')]):Nu(f?new Tc(l?"camera":"composite",i.value,f.labels,f instanceof Zi?f.interpolation:void 0):new is(l?"constant":"source",i.value)):ca([new si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ns{constructor(t,i){this._parameters=t,this._specification=i,Ki(this,$u(this._parameters,this._specification))}static deserialize(t){return new ns(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function rs(n){let t=null;if(n instanceof Na)t=rs(n.result);else if(n instanceof Za){for(let i of n.args)if(t=rs(i),t)break}else(n instanceof di||n instanceof Zi)&&n.input instanceof zn&&n.input.name==="zoom"&&(t=n);return t instanceof si||n.eachChild(i=>{let a=rs(i);a instanceof si?t=a:!t&&a?t=new si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new si("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function os(n,t=new Set){return n instanceof Ja&&t.add(n.key),n.eachChild(i=>{os(i,t)}),t}function Js(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(let t of n.slice(1))if(!Js(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let Sc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ko(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Js(n)||(n=Lo(n));let t=ts(n,Sc);if(t.result==="error")throw new Error(t.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,a,l)=>t.value.evaluate(i,a,{},l),needGeometry:Qs(n),getGlobalStateRefs:()=>os(t.value.expression)}}function Ic(n,t){return n<t?-1:n>t?1:0}function Qs(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Qs(n[t]))return!0;return!1}function Lo(n){if(!n)return!0;let t=n[0];return n.length<=1?t!=="any":t==="=="?Pc(n[1],n[2],"=="):t==="!="?el(Pc(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Pc(n[1],n[2],t):t==="any"?(i=n.slice(1),["any"].concat(i.map(Lo))):t==="all"?["all"].concat(n.slice(1).map(Lo)):t==="none"?["all"].concat(n.slice(1).map(Lo).map(el)):t==="in"?Wu(n[1],n.slice(2)):t==="!in"?el(Wu(n[1],n.slice(2))):t==="has"?Hu(n[1]):t!=="!has"||el(Hu(n[1]));var i}function Pc(n,t,i){switch(n){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,n,t]}}function Wu(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Ic)]]:["filter-in-small",n,["literal",t]]}}function Hu(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function el(n){return["!",n]}function Cc(n){let t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let l="[";for(let d of n)l+=`${Cc(d)},`;return`${l}]`}let i=Object.keys(n).sort(),a="{";for(let l=0;l<i.length;l++)a+=`${JSON.stringify(i[l])}:${Cc(n[i[l]])},`;return`${a}}`}function Mp(n){let t="";for(let i of lt)t+=`/${Cc(n[i])}`;return t}function Mc(n){let t=n.value;return t?[new Re(n.key,t,"constants have been deprecated as of v8")]:[]}function li(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function _r(n){if(Array.isArray(n))return n.map(_r);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){let t={};for(let i in n)t[i]=_r(n[i]);return t}return li(n)}function Rn(n){let t=n.key,i=n.value,a=n.valueSpec||{},l=n.objectElementValidators||{},d=n.style,f=n.styleSpec,v=n.validateSpec,b=[],S=Pt(i);if(S!=="object")return[new Re(t,i,`object expected, ${S} found`)];for(let I in i){let E=I.split(".")[0],L=ra(a,E)||a["*"],z;if(ra(l,E))z=l[E];else if(ra(a,E))z=v;else if(l["*"])z=l["*"];else{if(!a["*"]){b.push(new Re(t,i[I],`unknown property "${I}"`));continue}z=v}b=b.concat(z({key:(t&&`${t}.`)+I,value:i[I],valueSpec:L,style:d,styleSpec:f,object:i,objectKey:I,validateSpec:v},i))}for(let I in a)l[I]||a[I].required&&a[I].default===void 0&&i[I]===void 0&&b.push(new Re(t,i,`missing required property "${I}"`));return b}function tl(n){let t=n.value,i=n.valueSpec,a=n.style,l=n.styleSpec,d=n.key,f=n.arrayElementValidator||n.validateSpec;if(Pt(t)!=="array")return[new Re(d,t,`array expected, ${Pt(t)} found`)];if(i.length&&t.length!==i.length)return[new Re(d,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Re(d,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let v={type:i.value,values:i.values};l.$version<7&&(v.function=i.function),Pt(i.value)==="object"&&(v=i.value);let b=[];for(let S=0;S<t.length;S++)b=b.concat(f({array:t,arrayIndex:S,value:t[S],valueSpec:v,validateSpec:n.validateSpec,style:a,styleSpec:l,key:`${d}[${S}]`}));return b}function as(n){let t=n.key,i=n.value,a=n.valueSpec,l=Pt(i);return l==="number"&&i!=i&&(l="NaN"),l!=="number"?[new Re(t,i,`number expected, ${l} found`)]:"minimum"in a&&i<a.minimum?[new Re(t,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new Re(t,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function Xu(n){let t=n.valueSpec,i=li(n.value.type),a,l,d,f={},v=i!=="categorical"&&n.value.property===void 0,b=!v,S=Pt(n.value.stops)==="array"&&Pt(n.value.stops[0])==="array"&&Pt(n.value.stops[0][0])==="object",I=Rn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(z){if(i==="identity")return[new Re(z.key,z.value,'identity function may not have a "stops" property')];let R=[],j=z.value;return R=R.concat(tl({key:z.key,value:j,valueSpec:z.valueSpec,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:E})),Pt(j)==="array"&&j.length===0&&R.push(new Re(z.key,j,"array must have at least one stop")),R},default:function(z){return z.validateSpec({key:z.key,value:z.value,valueSpec:t,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec})}}});return i==="identity"&&v&&I.push(new Re(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||I.push(new Re(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!bc(n.valueSpec)&&I.push(new Re(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!to(n.valueSpec)?I.push(new Re(n.key,n.value,"property functions not supported")):v&&!Vu(n.valueSpec)&&I.push(new Re(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!S||n.value.property!==void 0||I.push(new Re(n.key,n.value,'"property" property is required')),I;function E(z){let R=[],j=z.value,V=z.key;if(Pt(j)!=="array")return[new Re(V,j,`array expected, ${Pt(j)} found`)];if(j.length!==2)return[new Re(V,j,`array length 2 expected, length ${j.length} found`)];if(S){if(Pt(j[0])!=="object")return[new Re(V,j,`object expected, ${Pt(j[0])} found`)];if(j[0].zoom===void 0)return[new Re(V,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new Re(V,j,"object stop key must have value")];if(d&&d>li(j[0].zoom))return[new Re(V,j[0].zoom,"stop zoom values must appear in ascending order")];li(j[0].zoom)!==d&&(d=li(j[0].zoom),l=void 0,f={}),R=R.concat(Rn({key:`${V}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:as,value:L}}))}else R=R.concat(L({key:`${V}[0]`,value:j[0],validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec},j));return Ys(_r(j[1]))?R.concat([new Re(`${V}[1]`,j[1],"expressions are not allowed in function stops.")]):R.concat(z.validateSpec({key:`${V}[1]`,value:j[1],valueSpec:t,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec}))}function L(z,R){let j=Pt(z.value),V=li(z.value),H=z.value!==null?z.value:R;if(a){if(j!==a)return[new Re(z.key,H,`${j} stop domain type must match previous stop domain type ${a}`)]}else a=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new Re(z.key,H,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&i!=="categorical"){let se=`number expected, ${j} found`;return to(t)&&i===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(z.key,H,se)]}return i!=="categorical"||j!=="number"||isFinite(V)&&Math.floor(V)===V?i!=="categorical"&&j==="number"&&l!==void 0&&V<l?[new Re(z.key,H,"stop domain values must appear in ascending order")]:(l=V,i==="categorical"&&V in f?[new Re(z.key,H,"stop domain values must be unique")]:(f[V]=!0,[])):[new Re(z.key,H,`integer expected, found ${V}`)]}}function Do(n){let t=(n.expressionContext==="property"?qu:ts)(_r(n.value),n.valueSpec);if(t.result==="error")return t.value.map(a=>new Re(`${n.key}${a.key}`,n.value,a.message));let i=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new Re(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Qa(i))return[new Re(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Qa(i))return[new Re(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Ks(i,["zoom","feature-state"]))return[new Re(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Xs(i))return[new Re(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function il(n){let t=n.key,i=n.value,a=Pt(i);return a!=="string"?[new Re(t,i,`color expected, ${a} found`)]:Tt.parse(String(i))?[]:[new Re(t,i,`color expected, "${i}" found`)]}function kr(n){let t=n.key,i=n.value,a=n.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(li(i))===-1&&l.push(new Re(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(li(i))===-1&&l.push(new Re(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),l}function Ec(n){return Js(_r(n.value))?Do(Ki({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ku(n)}function Ku(n){let t=n.value,i=n.key;if(Pt(t)!=="array")return[new Re(i,t,`array expected, ${Pt(t)} found`)];let a=n.styleSpec,l,d=[];if(t.length<1)return[new Re(i,t,"filter array must have at least 1 element")];switch(d=d.concat(kr({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),li(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&li(t[1])==="$type"&&d.push(new Re(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new Re(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Pt(t[1]),l!=="string"&&d.push(new Re(`${i}[1]`,t[1],`string expected, ${l} found`)));for(let f=2;f<t.length;f++)l=Pt(t[f]),li(t[1])==="$type"?d=d.concat(kr({key:`${i}[${f}]`,value:t[f],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new Re(`${i}[${f}]`,t[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)d=d.concat(Ku({key:`${i}[${f}]`,value:t[f],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":l=Pt(t[1]),t.length!==2?d.push(new Re(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new Re(`${i}[1]`,t[1],`string expected, ${l} found`))}return d}function Yu(n,t){let i=n.key,a=n.validateSpec,l=n.style,d=n.styleSpec,f=n.value,v=n.objectKey,b=d[`${t}_${n.layerType}`];if(!b)return[];let S=v.match(/^(.*)-transition$/);if(t==="paint"&&S&&b[S[1]]&&b[S[1]].transition)return a({key:i,value:f,valueSpec:d.transition,style:l,styleSpec:d});let I=n.valueSpec||b[v];if(!I)return[new Re(i,f,`unknown property "${v}"`)];let E;if(Pt(f)==="string"&&to(I)&&!I.tokens&&(E=/^{([^}]+)}$/.exec(f)))return[new Re(i,f,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];let L=[];return n.layerType==="symbol"&&(v==="text-field"&&l&&!l.glyphs&&L.push(new Re(i,f,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&es(_r(f))&&li(f.type)==="identity"&&L.push(new Re(i,f,'"text-font" does not support identity functions'))),L.concat(a({key:n.key,value:f,valueSpec:I,style:l,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:v}))}function Ju(n){return Yu(n,"paint")}function Qu(n){return Yu(n,"layout")}function eh(n){let t=[],i=n.value,a=n.key,l=n.style,d=n.styleSpec;if(Pt(i)!=="object")return[new Re(a,i,`object expected, ${Pt(i)} found`)];i.type||i.ref||t.push(new Re(a,i,'either "type" or "ref" is required'));let f=li(i.type),v=li(i.ref);if(i.id){let b=li(i.id);for(let S=0;S<n.arrayIndex;S++){let I=l.layers[S];li(I.id)===b&&t.push(new Re(a,i.id,`duplicate layer id "${i.id}", previously used at line ${I.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(S=>{S in i&&t.push(new Re(a,i[S],`"${S}" is prohibited for ref layers`))}),l.layers.forEach(S=>{li(S.id)===v&&(b=S)}),b?b.ref?t.push(new Re(a,i.ref,"ref cannot reference another ref layer")):f=li(b.type):t.push(new Re(a,i.ref,`ref layer "${v}" not found`))}else if(f!=="background")if(i.source){let b=l.sources&&l.sources[i.source],S=b&&li(b.type);b?S==="vector"&&f==="raster"?t.push(new Re(a,i.source,`layer "${i.id}" requires a raster source`)):S!=="raster-dem"&&f==="hillshade"||S!=="raster-dem"&&f==="color-relief"?t.push(new Re(a,i.source,`layer "${i.id}" requires a raster-dem source`)):S==="raster"&&f!=="raster"?t.push(new Re(a,i.source,`layer "${i.id}" requires a vector source`)):S!=="vector"||i["source-layer"]?S==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?t.push(new Re(a,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f!=="line"||!i.paint||!i.paint["line-gradient"]||S==="geojson"&&b.lineMetrics||t.push(new Re(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Re(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Re(a,i.source,`source "${i.source}" not found`))}else t.push(new Re(a,i,'missing required property "source"'));return t=t.concat(Rn({key:a,value:i,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:i.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:Ec,layout:b=>Rn({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>Qu(Ki({layerType:f},S))}}),paint:b=>Rn({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>Ju(Ki({layerType:f},S))}})}})),t}function Hn(n){let t=n.value,i=n.key,a=Pt(t);return a!=="string"?[new Re(i,t,`string expected, ${a} found`)]:[]}let ua={promoteId:function({key:n,value:t}){if(Pt(t)==="string")return Hn({key:n,value:t});{let i=[];for(let a in t)i.push(...Hn({key:`${n}.${a}`,value:t[a]}));return i}}};function _n(n){let t=n.value,i=n.key,a=n.styleSpec,l=n.style,d=n.validateSpec;if(!t.type)return[new Re(i,t,'"type" is required')];let f=li(t.type),v;switch(f){case"vector":case"raster":return v=Rn({key:i,value:t,valueSpec:a[`source_${f.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:ua,validateSpec:d}),v;case"raster-dem":return v=(function(b){var S;let I=(S=b.sourceName)!==null&&S!==void 0?S:"",E=b.value,L=b.styleSpec,z=L.source_raster_dem,R=b.style,j=[],V=Pt(E);if(E===void 0)return j;if(V!=="object")return j.push(new Re("source_raster_dem",E,`object expected, ${V} found`)),j;let H=li(E.encoding)==="custom",se=["redFactor","greenFactor","blueFactor","baseShift"],te=b.value.encoding?`"${b.value.encoding}"`:"Default";for(let re in E)!H&&se.includes(re)?j.push(new Re(re,E[re],`In "${I}": "${re}" is only valid when "encoding" is set to "custom". ${te} encoding found`)):z[re]?j=j.concat(b.validateSpec({key:re,value:E[re],valueSpec:z[re],validateSpec:b.validateSpec,style:R,styleSpec:L})):j.push(new Re(re,E[re],`unknown property "${re}"`));return j})({sourceName:i,value:t,style:n.style,styleSpec:a,validateSpec:d}),v;case"geojson":if(v=Rn({key:i,value:t,valueSpec:a.source_geojson,style:l,styleSpec:a,validateSpec:d,objectElementValidators:ua}),t.cluster)for(let b in t.clusterProperties){let[S,I]=t.clusterProperties[b],E=typeof S=="string"?[S,["accumulated"],["get",b]]:S;v.push(...Do({key:`${i}.${b}.map`,value:I,expressionContext:"cluster-map"})),v.push(...Do({key:`${i}.${b}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return v;case"video":return Rn({key:i,value:t,valueSpec:a.source_video,style:l,validateSpec:d,styleSpec:a});case"image":return Rn({key:i,value:t,valueSpec:a.source_image,style:l,validateSpec:d,styleSpec:a});case"canvas":return[new Re(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kr({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ha(n){let t=n.value,i=n.styleSpec,a=i.light,l=n.style,d=[],f=Pt(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new Re("light",t,`object expected, ${f} found`)]),d;for(let v in t){let b=v.match(/^(.*)-transition$/);d=d.concat(b&&a[b[1]]&&a[b[1]].transition?n.validateSpec({key:v,value:t[v],valueSpec:i.transition,validateSpec:n.validateSpec,style:l,styleSpec:i}):a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:l,styleSpec:i}):[new Re(v,t[v],`unknown property "${v}"`)])}return d}function Ac(n){let t=n.value,i=n.styleSpec,a=i.sky,l=n.style,d=Pt(t);if(t===void 0)return[];if(d!=="object")return[new Re("sky",t,`object expected, ${d} found`)];let f=[];for(let v in t)f=f.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:l,styleSpec:i}):[new Re(v,t[v],`unknown property "${v}"`)]);return f}function th(n){let t=n.value,i=n.styleSpec,a=i.terrain,l=n.style,d=[],f=Pt(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new Re("terrain",t,`object expected, ${f} found`)]),d;for(let v in t)d=d.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:l,styleSpec:i}):[new Re(v,t[v],`unknown property "${v}"`)]);return d}function ih(n){let t=[],i=n.value,a=n.key;if(Array.isArray(i)){let l=[],d=[];for(let f in i)i[f].id&&l.includes(i[f].id)&&t.push(new Re(a,i,`all the sprites' ids must be unique, but ${i[f].id} is duplicated`)),l.push(i[f].id),i[f].url&&d.includes(i[f].url)&&t.push(new Re(a,i,`all the sprites' URLs must be unique, but ${i[f].url} is duplicated`)),d.push(i[f].url),t=t.concat(Rn({key:`${a}[${f}]`,value:i[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Hn({key:a,value:i})}function pa(n){return t=n.value,t&&t.constructor===Object?[]:[new Re(n.key,n.value,`object expected, ${Pt(n.value)} found`)];var t}let kc={"*":()=>[],array:tl,boolean:function(n){let t=n.value,i=n.key,a=Pt(t);return a!=="boolean"?[new Re(i,t,`boolean expected, ${a} found`)]:[]},number:as,color:il,constants:Mc,enum:kr,filter:Ec,function:Xu,layer:eh,object:Rn,source:_n,light:ha,sky:Ac,terrain:th,projection:function(n){let t=n.value,i=n.styleSpec,a=i.projection,l=n.style,d=Pt(t);if(t===void 0)return[];if(d!=="object")return[new Re("projection",t,`object expected, ${d} found`)];let f=[];for(let v in t)f=f.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:l,styleSpec:i}):[new Re(v,t[v],`unknown property "${v}"`)]);return f},projectionDefinition:function(n){let t=n.key,i=n.value;i=i instanceof String?i.valueOf():i;let a=Pt(i);return a!=="array"||(function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"})(i)||(function(l){return!!["interpolate","step","literal"].includes(l[0])})(i)?["array","string"].includes(a)?[]:[new Re(t,i,`projection expected, invalid type "${a}" found`)]:[new Re(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Hn,formatted:function(n){return Hn(n).length===0?[]:Do(n)},resolvedImage:function(n){return Hn(n).length===0?[]:Do(n)},padding:function(n){let t=n.key,i=n.value;if(Pt(i)==="array"){if(i.length<1||i.length>4)return[new Re(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];let a={type:"number"},l=[];for(let d=0;d<i.length;d++)l=l.concat(n.validateSpec({key:`${t}[${d}]`,value:i[d],validateSpec:n.validateSpec,valueSpec:a}));return l}return as({key:t,value:i,valueSpec:{}})},numberArray:function(n){let t=n.key,i=n.value;if(Pt(i)==="array"){let a={type:"number"};if(i.length<1)return[new Re(t,i,"array length at least 1 expected, length 0 found")];let l=[];for(let d=0;d<i.length;d++)l=l.concat(n.validateSpec({key:`${t}[${d}]`,value:i[d],validateSpec:n.validateSpec,valueSpec:a}));return l}return as({key:t,value:i,valueSpec:{}})},colorArray:function(n){let t=n.key,i=n.value;if(Pt(i)==="array"){if(i.length<1)return[new Re(t,i,"array length at least 1 expected, length 0 found")];let a=[];for(let l=0;l<i.length;l++)a=a.concat(il({key:`${t}[${l}]`,value:i[l]}));return a}return il({key:t,value:i})},variableAnchorOffsetCollection:function(n){let t=n.key,i=n.value,a=Pt(i),l=n.styleSpec;if(a!=="array"||i.length<1||i.length%2!=0)return[new Re(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<i.length;f+=2)d=d.concat(kr({key:`${t}[${f}]`,value:i[f],valueSpec:l.layout_symbol["text-anchor"]})),d=d.concat(tl({key:`${t}[${f+1}]`,value:i[f+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:l}));return d},sprite:ih,state:pa};function da(n){let t=n.value,i=n.valueSpec,a=n.styleSpec;return n.validateSpec=da,i.expression&&es(li(t))?Xu(n):i.expression&&Ys(_r(t))?Do(n):i.type&&kc[i.type]?kc[i.type](n):Rn(Ki({},n,{valueSpec:i.type?a[i.type]:i}))}function nh(n){let t=n.value,i=n.key,a=Hn(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Re(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Re(i,t,'"glyphs" url must include a "{range}" token'))),a}function yn(n,t=pe){let i=[];return i=i.concat(da({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:da,objectElementValidators:{glyphs:nh,"*":()=>[]}})),n.constants&&(i=i.concat(Mc({key:"constants",value:n.constants}))),ma(i)}function Xn(n){return function(t){return n(Rl(Vi({},t),{validateSpec:da}))}}function ma(n){return[].concat(n).sort((t,i)=>t.line-i.line)}function Kn(n){return function(...t){return ma(n.apply(this,t))}}yn.source=Kn(Xn(_n)),yn.sprite=Kn(Xn(ih)),yn.glyphs=Kn(Xn(nh)),yn.light=Kn(Xn(ha)),yn.sky=Kn(Xn(Ac)),yn.terrain=Kn(Xn(th)),yn.state=Kn(Xn(pa)),yn.layer=Kn(Xn(eh)),yn.filter=Kn(Xn(Ec)),yn.paintProperty=Kn(Xn(Ju)),yn.layoutProperty=Kn(Xn(Qu));let fa=yn,Ep=fa.light,ss=fa.sky,Ap=fa.paintProperty,kp=fa.layoutProperty;function ls(n,t){let i=!1;if(t&&t.length)for(let a of t)n.fire(new Pe(new Error(a.message))),i=!0;return i}class cs{constructor(t,i,a){let l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(i=f[1])+2*(a=f[2]);for(let b=0;b<this.d*this.d;b++){let S=f[3+b],I=f[3+b+1];l.push(S===I?null:f.subarray(S,I))}let v=f[3+l.length+1];this.keys=f.subarray(f[3+l.length],v),this.bboxes=f.subarray(v),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let f=0;f<this.d*this.d;f++)l.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=a,this.scale=i/t,this.uid=0;let d=a/i*t;this.min=-d,this.max=t+d}insert(t,i,a,l,d){this._forEachCell(i,a,l,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,a,l,d,f){this.cells[d].push(f)}query(t,i,a,l,d){let f=this.min,v=this.max;if(t<=f&&i<=f&&v<=a&&v<=l&&!d)return Array.prototype.slice.call(this.keys);{let b=[];return this._forEachCell(t,i,a,l,this._queryCell,b,{},d),b}}_queryCell(t,i,a,l,d,f,v,b){let S=this.cells[d];if(S!==null){let I=this.keys,E=this.bboxes;for(let L=0;L<S.length;L++){let z=S[L];if(v[z]===void 0){let R=4*z;(b?b(E[R+0],E[R+1],E[R+2],E[R+3]):t<=E[R+2]&&i<=E[R+3]&&a>=E[R+0]&&l>=E[R+1])?(v[z]=!0,f.push(I[z])):v[z]=!1}}}}_forEachCell(t,i,a,l,d,f,v,b){let S=this._convertToCellCoord(t),I=this._convertToCellCoord(i),E=this._convertToCellCoord(a),L=this._convertToCellCoord(l);for(let z=S;z<=E;z++)for(let R=I;R<=L;R++){let j=this.d*R+z;if((!b||b(this._convertFromCellCoord(z),this._convertFromCellCoord(R),this._convertFromCellCoord(z+1),this._convertFromCellCoord(R+1)))&&d.call(this,t,i,a,l,j,f,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,i=3+this.cells.length+1+1,a=0;for(let f=0;f<this.cells.length;f++)a+=this.cells[f].length;let l=new Int32Array(i+a+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let d=i;for(let f=0;f<t.length;f++){let v=t[f];l[3+f]=d,l.set(v,d),d+=v.length}return l[3+t.length]=d,l.set(this.keys,d),d+=this.keys.length,l[3+t.length+1]=d,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer}static serialize(t,i){let a=t.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(t){return new cs(t.buffer)}}let Yn={};function Ge(n,t,i={}){if(Yn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),Yn[n]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}Ge("Object",Object),Ge("Set",Set),Ge("TransferableGridIndex",cs),Ge("Color",Tt),Ge("Error",Error),Ge("AJAXError",Q),Ge("ResolvedImage",Sn),Ge("StylePropertyFunction",ns),Ge("StyleExpression",wc,{omit:["_evaluator"]}),Ge("ZoomDependentExpression",Tc),Ge("ZoomConstantExpression",is),Ge("CompoundExpression",zn,{omit:["_evaluate"]});for(let n in la)la[n]._classRegistryKey||Ge(`Expression_${n}`,la[n]);function Lc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function nl(n){return n.$name||n.constructor._classRegistryKey}function Dc(n){return!(function(t){if(t===null||typeof t!="object")return!1;let i=nl(t);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Lc(n)||hr(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function ga(n,t){if(Dc(n))return(Lc(n)||hr(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){let d=[];for(let f of n)d.push(ga(f,t));return d}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);let i=nl(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Yn[i])throw new Error(`${i} is not registered.`);let{klass:a}=Yn[i],l=a.serialize?a.serialize(n,t):{};if(a.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let d in n){if(!n.hasOwnProperty(d)||Yn[i].omit.indexOf(d)>=0)continue;let f=n[d];l[d]=Yn[i].shallow.indexOf(d)>=0?f:ga(f,t)}n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(l.$name=i),l}function zo(n){if(Dc(n))return n;if(Array.isArray(n))return n.map(zo);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);let t=nl(n)||"Object";if(!Yn[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:i}=Yn[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(n);let a=Object.create(i.prototype);for(let l of Object.keys(n)){if(l==="$name")continue;let d=n[l];a[l]=Yn[t].shallow.indexOf(l)>=0?d:zo(d)}return a}class rl{constructor(){this.first=!0}update(t,i){let a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}let Ct={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function ol(n){for(let t of n)if(Rc(t.charCodeAt(0)))return!0;return!1}function Lp(n){for(let t of n)if(!rh(t.charCodeAt(0)))return!1;return!0}function al(n){let t=n.map(i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}}).filter(i=>i);return new RegExp(t.join("|"),"u")}let Dp=al(["Arab","Dupl","Mong","Ougr","Syrc"]);function rh(n){return!Dp.test(String.fromCodePoint(n))}let zc=al(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Rc(n){return!(n!==746&&n!==747&&(n<4352||!(Ct["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Ct["CJK Compatibility"](n)||Ct["CJK Strokes"](n)||!(!Ct["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Ct["Enclosed CJK Letters and Months"](n)||Ct["Ideographic Description Characters"](n)||Ct.Kanbun(n)||Ct.Katakana(n)&&n!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ct["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ct["Vertical Forms"](n)||Ct["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||zc.test(String.fromCodePoint(n)))))}function oh(n){return!(Rc(n)||(function(t){return!!(Ct["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ct["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ct["Letterlike Symbols"](t)||Ct["Number Forms"](t)||Ct["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ct["Control Pictures"](t)&&t!==9251||Ct["Optical Character Recognition"](t)||Ct["Enclosed Alphanumerics"](t)||Ct["Geometric Shapes"](t)||Ct["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ct["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ct["CJK Symbols and Punctuation"](t)||Ct.Katakana(t)||Ct["Private Use Area"](t)||Ct["CJK Compatibility Forms"](t)||Ct["Small Form Variants"](t)||Ct["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}let ah=al(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Fc(n){return ah.test(String.fromCodePoint(n))}function sh(n,t){return!(!t&&Fc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Ct.Khmer(n))}function lh(n){for(let t of n)if(Fc(t.charCodeAt(0)))return!0;return!1}let Jn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Jn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;let i=n.pluginURL,a=new Promise(d=>{this.loadScriptResolve=d});t(i);let l=new Promise(d=>setTimeout(()=>d(),this.TIMEOUT));if(yield Promise.race([a,l]),this.isParsed()){let d={pluginStatus:"loaded",pluginURL:i};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)})}};class Qt{constructor(t,i){this.zoom=t,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new rl,this.transition=i.transition||{},this.globalState=i.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new rl,this.transition={},this.globalState={})}isSupportedScript(t){return(function(i,a){for(let l of i)if(!sh(l.charCodeAt(0),a))return!1;return!0})(t,Jn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,i=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class _a{constructor(t,i){this.property=t,this.value=i,this.expression=(function(a,l){if(es(a))return new ns(a,l);if(Ys(a)){let d=qu(a,l);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=a;return l.type==="color"&&typeof a=="string"?d=Tt.parse(a):l.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?l.type!=="numberArray"||typeof a!="number"&&!Array.isArray(a)?l.type!=="colorArray"||typeof a!="string"&&!Array.isArray(a)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(a)?d=on.parse(a):l.type==="projectionDefinition"&&typeof a=="string"&&(d=Yi.parse(a)):d=xi.parse(a):d=rn.parse(a):d=zi.parse(a),{globalStateRefs:new Set,kind:"constant",evaluate:()=>d}}})(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class Bc{constructor(t){this.property=t,this.value=new _a(t,void 0)}transitioned(t,i){return new Oc(this.property,this.value,i,Dn({},t.transition,this.transition),t.now)}untransitioned(){return new Oc(this.property,this.value,null,{},0)}}class ch{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Tn(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bc(this._values[t].property)),this._values[t].value=new _a(this._values[t].property,i===null?void 0:Tn(i))}getTransition(t){return Tn(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bc(this._values[t].property)),this._values[t].transition=Tn(i)||void 0}serialize(){let t={};for(let i of Object.keys(this._values)){let a=this.getValue(i);a!==void 0&&(t[i]=a);let l=this.getTransition(i);l!==void 0&&(t[`${i}-transition`]=l)}return t}transitioned(t,i){let a=new jc(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(t,i._values[l]);return a}untransitioned(){let t=new jc(this._properties);for(let i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Oc{constructor(t,i,a,l,d){this.property=t,this.value=i,this.begin=d+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){let l=t.now||0,d=this.value.possiblyEvaluate(t,i,a),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(t,i,a);{let v=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,i,a),d,cr(v))}}return d}}class jc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){let l=new sl(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,i,a);return l}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class uh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Tn(this._values[t].value)}setValue(t,i){this._values[t]=new _a(this._values[t].property,i===null?void 0:Tn(i))}serialize(){let t={};for(let i of Object.keys(this._values)){let a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){let l=new sl(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,i,a);return l}}class yr{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,l){return this.property.evaluate(this.value,this.parameters,t,i,a,l)}}class sl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ke{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,a){let l=gr[this.specification.type];return l?l(t,i,a):t}}class it{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,l){return new yr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,l)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},t.parameters);let l=gr[this.specification.type];if(l){let d=l(t.value.value,i.value.value,a);return new yr(this,{kind:"constant",value:d},t.parameters)}return t}evaluate(t,i,a,l,d,f){return t.kind==="constant"?t.value:t.evaluate(i,a,l,d,f)}}class ll extends it{possiblyEvaluate(t,i,a,l){if(t.value===void 0)return new yr(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){let d=t.expression.evaluate(i,null,{},a,l),f=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,v=this._calculate(f,f,f,i);return new yr(this,{kind:"constant",value:v},i)}if(t.expression.kind==="camera"){let d=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new yr(this,{kind:"constant",value:d},i)}return new yr(this,t.expression,i)}evaluate(t,i,a,l,d,f){if(t.kind==="source"){let v=t.evaluate(i,a,l,d,f);return this._calculate(v,v,v,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},a,l),t.evaluate({zoom:Math.floor(i.zoom)},a,l),t.evaluate({zoom:Math.floor(i.zoom)+1},a,l),i):t.value}_calculate(t,i,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class no{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,l){if(t.value!==void 0){if(t.expression.kind==="constant"){let d=t.expression.evaluate(i,null,{},a,l);return this._calculate(d,d,d,i)}return this._calculate(t.expression.evaluate(new Qt(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Qt(Math.floor(i.zoom),i)),t.expression.evaluate(new Qt(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class cl{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,l){return!!t.expression.evaluate(i,null,{},a,l)}interpolate(){return!1}}class an{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let i in t){let a=t[i];a.specification.overridable&&this.overridableProperties.push(i);let l=this.defaultPropertyValues[i]=new _a(a,void 0),d=this.defaultTransitionablePropertyValues[i]=new Bc(a);this.defaultTransitioningPropertyValues[i]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate({})}}}Ge("DataDrivenProperty",it),Ge("DataConstantProperty",Ke),Ge("CrossFadedDataDrivenProperty",ll),Ge("CrossFadedProperty",no),Ge("ColorRampProperty",cl);let hh="-transition";class Fn extends Xe{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=ko(t.filter)),i.layout&&(this._unevaluatedLayout=new uh(i.layout)),i.paint)){this._transitionablePaint=new ch(i.paint);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new sl(i.paint)}}setFilter(t){this.filter=t,this._featureFilter=ko(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){let t=new Set;if(this._unevaluatedLayout)for(let i in this._unevaluatedLayout._values){let a=this._unevaluatedLayout._values[i];for(let l of a.getGlobalStateRefs())t.add(l)}for(let i of this._featureFilter.getGlobalStateRefs())t.add(i);return t}setLayoutProperty(t,i,a={}){i!=null&&this._validate(kp,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(hh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(Ap,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(t.endsWith(hh))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{let l=this._transitionablePaint._values[t],d=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),v=l.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);let b=this._transitionablePaint._values[t].value;return b.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ko(t,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(t,i,a,l,d={}){return(!d||d.validate!==!1)&&ls(this,t.call(fa,{key:i,layerType:this.type,objectKey:a,value:l,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let i=this.paint.get(t);if(i instanceof yr&&to(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let zp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class us{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mi(n,t=1){let i=0,a=0;return{members:n.map(l=>{let d=zp[l.type].BYTES_PER_ELEMENT,f=i=ul(i,Math.max(t,d)),v=l.components||1;return a=Math.max(a,d),i+=d*v,{name:l.name,type:l.type,components:v,offset:f}}),size:ul(i,Math.max(a,t)),alignment:t}}function ul(n,t){return Math.ceil(n/t)*t}class ya extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){let a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){let l=2*t;return this.int16[l+0]=i,this.int16[l+1]=a,t}}ya.prototype.bytesPerElement=4,Ge("StructArrayLayout2i4",ya);class va extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=3*t;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=l,t}}va.prototype.bytesPerElement=6,Ge("StructArrayLayout3i6",va);class Uc extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,l)}emplace(t,i,a,l,d){let f=4*t;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=l,this.int16[f+3]=d,t}}Uc.prototype.bytesPerElement=8,Ge("StructArrayLayout4i8",Uc);class xa extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f){let v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,l,d,f)}emplace(t,i,a,l,d,f,v){let b=6*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=v,t}}xa.prototype.bytesPerElement=12,Ge("StructArrayLayout2i4i12",xa);class Ro extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f){let v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,l,d,f)}emplace(t,i,a,l,d,f,v){let b=4*t,S=8*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.uint8[S+4]=l,this.uint8[S+5]=d,this.uint8[S+6]=f,this.uint8[S+7]=v,t}}Ro.prototype.bytesPerElement=8,Ge("StructArrayLayout2i4ub8",Ro);class hs extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){let a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){let l=2*t;return this.float32[l+0]=i,this.float32[l+1]=a,t}}hs.prototype.bytesPerElement=8,Ge("StructArrayLayout2f8",hs);class hl extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S,I){let E=this.length;return this.resize(E+1),this.emplace(E,t,i,a,l,d,f,v,b,S,I)}emplace(t,i,a,l,d,f,v,b,S,I,E){let L=10*t;return this.uint16[L+0]=i,this.uint16[L+1]=a,this.uint16[L+2]=l,this.uint16[L+3]=d,this.uint16[L+4]=f,this.uint16[L+5]=v,this.uint16[L+6]=b,this.uint16[L+7]=S,this.uint16[L+8]=I,this.uint16[L+9]=E,t}}hl.prototype.bytesPerElement=20,Ge("StructArrayLayout10ui20",hl);class Fo extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S,I,E,L){let z=this.length;return this.resize(z+1),this.emplace(z,t,i,a,l,d,f,v,b,S,I,E,L)}emplace(t,i,a,l,d,f,v,b,S,I,E,L,z){let R=12*t;return this.int16[R+0]=i,this.int16[R+1]=a,this.int16[R+2]=l,this.int16[R+3]=d,this.uint16[R+4]=f,this.uint16[R+5]=v,this.uint16[R+6]=b,this.uint16[R+7]=S,this.int16[R+8]=I,this.int16[R+9]=E,this.int16[R+10]=L,this.int16[R+11]=z,t}}Fo.prototype.bytesPerElement=24,Ge("StructArrayLayout4i4ui4i24",Fo);class Nc extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=3*t;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=l,t}}Nc.prototype.bytesPerElement=12,Ge("StructArrayLayout3f12",Nc);class Vc extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Vc.prototype.bytesPerElement=4,Ge("StructArrayLayout1ul4",Vc);class pl extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S){let I=this.length;return this.resize(I+1),this.emplace(I,t,i,a,l,d,f,v,b,S)}emplace(t,i,a,l,d,f,v,b,S,I){let E=10*t,L=5*t;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=l,this.int16[E+3]=d,this.int16[E+4]=f,this.int16[E+5]=v,this.uint32[L+3]=b,this.uint16[E+8]=S,this.uint16[E+9]=I,t}}pl.prototype.bytesPerElement=20,Ge("StructArrayLayout6i1ul2ui20",pl);class $c extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f){let v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,l,d,f)}emplace(t,i,a,l,d,f,v){let b=6*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=v,t}}$c.prototype.bytesPerElement=12,Ge("StructArrayLayout2i2i2i12",$c);class h extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,a,l,d)}emplace(t,i,a,l,d,f){let v=4*t,b=8*t;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=l,this.int16[b+6]=d,this.int16[b+7]=f,t}}h.prototype.bytesPerElement=16,Ge("StructArrayLayout2f1f2i16",h);class e extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f){let v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,l,d,f)}emplace(t,i,a,l,d,f,v){let b=16*t,S=4*t,I=8*t;return this.uint8[b+0]=i,this.uint8[b+1]=a,this.float32[S+1]=l,this.float32[S+2]=d,this.int16[I+6]=f,this.int16[I+7]=v,t}}e.prototype.bytesPerElement=16,Ge("StructArrayLayout2ub2f2i16",e);class r extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=3*t;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=l,t}}r.prototype.bytesPerElement=6,Ge("StructArrayLayout3ui6",r);class s extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H){let se=this.length;return this.resize(se+1),this.emplace(se,t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H)}emplace(t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se){let te=24*t,re=12*t,fe=48*t;return this.int16[te+0]=i,this.int16[te+1]=a,this.uint16[te+2]=l,this.uint16[te+3]=d,this.uint32[re+2]=f,this.uint32[re+3]=v,this.uint32[re+4]=b,this.uint16[te+10]=S,this.uint16[te+11]=I,this.uint16[te+12]=E,this.float32[re+7]=L,this.float32[re+8]=z,this.uint8[fe+36]=R,this.uint8[fe+37]=j,this.uint8[fe+38]=V,this.uint32[re+10]=H,this.int16[te+22]=se,t}}s.prototype.bytesPerElement=48,Ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",s);class c extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se,te,re,fe,we,Ee,Ne,Fe,je,Ye,Oe){let Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se,te,re,fe,we,Ee,Ne,Fe,je,Ye,Oe)}emplace(t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se,te,re,fe,we,Ee,Ne,Fe,je,Ye,Oe,Ue){let Se=32*t,ot=16*t;return this.int16[Se+0]=i,this.int16[Se+1]=a,this.int16[Se+2]=l,this.int16[Se+3]=d,this.int16[Se+4]=f,this.int16[Se+5]=v,this.int16[Se+6]=b,this.int16[Se+7]=S,this.uint16[Se+8]=I,this.uint16[Se+9]=E,this.uint16[Se+10]=L,this.uint16[Se+11]=z,this.uint16[Se+12]=R,this.uint16[Se+13]=j,this.uint16[Se+14]=V,this.uint16[Se+15]=H,this.uint16[Se+16]=se,this.uint16[Se+17]=te,this.uint16[Se+18]=re,this.uint16[Se+19]=fe,this.uint16[Se+20]=we,this.uint16[Se+21]=Ee,this.uint16[Se+22]=Ne,this.uint32[ot+12]=Fe,this.float32[ot+13]=je,this.float32[ot+14]=Ye,this.uint16[Se+30]=Oe,this.uint16[Se+31]=Ue,t}}c.prototype.bytesPerElement=64,Ge("StructArrayLayout8i15ui1ul2f2ui64",c);class p extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}p.prototype.bytesPerElement=4,Ge("StructArrayLayout1f4",p);class y extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=3*t;return this.uint16[6*t+0]=i,this.float32[d+1]=a,this.float32[d+2]=l,t}}y.prototype.bytesPerElement=12,Ge("StructArrayLayout1ui2f12",y);class w extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=4*t;return this.uint32[2*t+0]=i,this.uint16[d+2]=a,this.uint16[d+3]=l,t}}w.prototype.bytesPerElement=8,Ge("StructArrayLayout1ul2ui8",w);class T extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){let a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){let l=2*t;return this.uint16[l+0]=i,this.uint16[l+1]=a,t}}T.prototype.bytesPerElement=4,Ge("StructArrayLayout2ui4",T);class P extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}P.prototype.bytesPerElement=2,Ge("StructArrayLayout1ui2",P);class M extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,l)}emplace(t,i,a,l,d){let f=4*t;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=l,this.float32[f+3]=d,t}}M.prototype.bytesPerElement=16,Ge("StructArrayLayout4f16",M);class k extends us{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}k.prototype.size=20;class A extends pl{get(t){return new k(this,t)}}Ge("CollisionBoxArray",A);class D extends us{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}D.prototype.size=48;class F extends s{get(t){return new D(this,t)}}Ge("PlacedSymbolArray",F);class Z extends us{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Z.prototype.size=64;class G extends c{get(t){return new Z(this,t)}}Ge("SymbolInstanceArray",G);class W extends p{getoffsetX(t){return this.float32[1*t+0]}}Ge("GlyphOffsetArray",W);class X extends va{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ge("SymbolLineVertexArray",X);class ee extends us{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ee.prototype.size=12;class K extends y{get(t){return new ee(this,t)}}Ge("TextAnchorOffsetArray",K);class ie extends us{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ie.prototype.size=8;class oe extends w{get(t){return new ie(this,t)}}Ge("FeatureIndexArray",oe);class J extends ya{}class ue extends ya{}class xe extends ya{}class de extends xa{}class me extends Ro{}class ye extends hs{}class ze extends hl{}class Be extends Fo{}class Me extends Nc{}class We extends Vc{}class gt extends $c{}class Bt extends e{}class Vt extends r{}class jt extends T{}let ni=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ci}=ni;class dt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,i,a,l){let d=this.segments[this.segments.length-1];return t>dt.MAX_VERTEX_ARRAY_LENGTH&&fi(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${dt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+t>dt.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l?this.createNewSegment(i,a,l):d}createNewSegment(t,i,a){let l={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return a!==void 0&&(l.sortKey=a),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(t,i,a){return this.prepareSegment(0,t,i,a)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let t of this.segments)for(let i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,l){return new dt([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function $t(n,t){return 256*(n=fn(Math.floor(n),0,255))+fn(Math.floor(t),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge("SegmentVector",dt);let bi=mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Mi,Fi,sn,Qn={exports:{}},ro={exports:{}},oo={exports:{}},ba=(function(){if(sn)return Qn.exports;sn=1;var n=(Mi||(Mi=1,ro.exports=function(i,a){var l,d,f,v,b,S,I,E;for(d=i.length-(l=3&i.length),f=a,b=3432918353,S=461845907,E=0;E<d;)I=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,f=27492+(65535&(v=5*(65535&(f=(f^=I=(65535&(I=(I=(65535&I)*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,l){case 3:I^=(255&i.charCodeAt(E+2))<<16;case 2:I^=(255&i.charCodeAt(E+1))<<8;case 1:f^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(E)))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),ro.exports),t=(Fi||(Fi=1,oo.exports=function(i,a){for(var l,d=i.length,f=a^d,v=0;d>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++v;switch(d){case 3:f^=(255&i.charCodeAt(v+2))<<16;case 2:f^=(255&i.charCodeAt(v+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(v)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),oo.exports);return Qn.exports=n,Qn.exports.murmur3=n,Qn.exports.murmur2=t,Qn.exports})(),wa=B(ba);class Bo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,l){this.ids.push(Oo(t)),this.positions.push(i,a,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let i=Oo(t),a=0,l=this.ids.length-1;for(;a<l;){let f=a+l>>1;this.ids[f]>=i?l=f:a=f+1}let d=[];for(;this.ids[a]===i;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(t,i){let a=new Float64Array(t.ids),l=new Uint32Array(t.positions);return vn(a,l,0,a.length-1),i&&i.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(t){let i=new Bo;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Oo(n){let t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:wa(String(n))}function vn(n,t,i,a){for(;i<a;){let l=n[i+a>>1],d=i-1,f=a+1;for(;;){do d++;while(n[d]<l);do f--;while(n[f]>l);if(d>=f)break;er(n,d,f),er(t,3*d,3*f),er(t,3*d+1,3*f+1),er(t,3*d+2,3*f+2)}f-i<a-f?(vn(n,t,i,f),i=f+1):(vn(n,t,f+1,a),a=f)}}function er(n,t,i){let a=n[t];n[t]=n[i],n[i]=a}Ge("FeaturePositionMap",Bo);class ln{constructor(t,i){this.gl=t.gl,this.location=i}}class ao extends ln{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class wi extends ln{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ei extends ln{constructor(t,i){super(t,i),this.current=Tt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let Bn=new Float32Array(16);function Ti(n){return[$t(255*n.r,255*n.g),$t(255*n.b,255*n.a)]}class ps{constructor(t,i,a){this.value=t,this.uniformNames=i.map(l=>`u_${l}`),this.type=a}setUniform(t,i,a){t.set(a.constantOr(this.value))}getBinding(t,i,a){return this.type==="color"?new Ei(t,i):new ao(t,i)}}class Ta{constructor(t,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setUniform(t,i,a,l){let d=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,i,a){return a.substr(0,9)==="u_pattern"?new wi(t,i):new ao(t,i)}}class Lr{constructor(t,i,a,l){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,i,a,l,d){let f=this.paintVertexArray.length,v=this.expression.evaluate(new Qt(0),i,{},l,[],d);this.paintVertexArray.resize(t),this._setPaintValue(f,t,v)}updatePaintArray(t,i,a,l){let d=this.expression.evaluate({zoom:0},a,l);this._setPaintValue(t,i,d)}_setPaintValue(t,i,a){if(this.type==="color"){let l=Ti(a);for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=t;l<i;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tr{constructor(t,i,a,l,d,f){this.expression=t,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,i,a,l,d){let f=this.expression.evaluate(new Qt(this.zoom),i,{},l,[],d),v=this.expression.evaluate(new Qt(this.zoom+1),i,{},l,[],d),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,f,v)}updatePaintArray(t,i,a,l){let d=this.expression.evaluate({zoom:this.zoom},a,l),f=this.expression.evaluate({zoom:this.zoom+1},a,l);this._setPaintValue(t,i,d,f)}_setPaintValue(t,i,a,l){if(this.type==="color"){let d=Ti(a),f=Ti(l);for(let v=t;v<i;v++)this.paintVertexArray.emplace(v,d[0],d[1],f[0],f[1])}else{for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){let a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,l=fn(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,i,a){return new ao(t,i)}}class so{constructor(t,i,a,l,d,f){this.expression=t,this.type=i,this.useIntegerZoom=a,this.zoom=l,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,i,a){let l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(t,i,a,l,d){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],d)}_setPaintValues(t,i,a,l){if(!l||!a)return;let{min:d,mid:f,max:v}=a,b=l[d],S=l[f],I=l[v];if(b&&S&&I)for(let E=t;E<i;E++)this.zoomInPaintVertexArray.emplace(E,S.tl[0],S.tl[1],S.br[0],S.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],S.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,S.tl[0],S.tl[1],S.br[0],S.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],S.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,bi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,bi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ph{constructor(t,i,a){this.binders={},this._buffers=[];let l=[];for(let d in t.paint._values){if(!a(d))continue;let f=t.paint.get(d);if(!(f instanceof yr&&to(f.property.specification)))continue;let v=dh(d,t.type),b=f.value,S=f.property.specification.type,I=f.property.useIntegerZoom,E=f.property.specification["property-type"],L=E==="cross-faded"||E==="cross-faded-data-driven";if(b.kind==="constant")this.binders[d]=L?new Ta(b.value,v):new ps(b.value,v,S),l.push(`/u_${d}`);else if(b.kind==="source"||L){let z=Gc(d,S,"source");this.binders[d]=L?new so(b,S,I,i,z,t.id):new Lr(b,v,S,z),l.push(`/a_${d}`)}else{let z=Gc(d,S,"composite");this.binders[d]=new tr(b,v,S,I,i,z),l.push(`/z_${d}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){let i=this.binders[t];return i instanceof Lr||i instanceof tr?i.maxValue:0}populatePaintArrays(t,i,a,l,d){for(let f in this.binders){let v=this.binders[f];(v instanceof Lr||v instanceof tr||v instanceof so)&&v.populatePaintArray(t,i,a,l,d)}}setConstantPatternPositions(t,i){for(let a in this.binders){let l=this.binders[a];l instanceof Ta&&l.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,a,l,d){let f=!1;for(let v in t){let b=i.getPositions(v);for(let S of b){let I=a.feature(S.index);for(let E in this.binders){let L=this.binders[E];if((L instanceof Lr||L instanceof tr||L instanceof so)&&L.expression.isStateDependent===!0){let z=l.paint.get(E);L.expression=z.value,L.updatePaintArray(S.start,S.end,I,t[v],d),f=!0}}}}return f}defines(){let t=[];for(let i in this.binders){let a=this.binders[i];(a instanceof ps||a instanceof Ta)&&t.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){let t=[];for(let i in this.binders){let a=this.binders[i];if(a instanceof Lr||a instanceof tr)for(let l=0;l<a.paintVertexAttributes.length;l++)t.push(a.paintVertexAttributes[l].name);else if(a instanceof so)for(let l=0;l<bi.members.length;l++)t.push(bi.members[l].name)}return t}getBinderUniforms(){let t=[];for(let i in this.binders){let a=this.binders[i];if(a instanceof ps||a instanceof Ta||a instanceof tr)for(let l of a.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){let a=[];for(let l in this.binders){let d=this.binders[l];if(d instanceof ps||d instanceof Ta||d instanceof tr){for(let f of d.uniformNames)if(i[f]){let v=d.getBinding(t,i[f],f);a.push({name:f,property:l,binding:v})}}}return a}setUniforms(t,i,a,l){for(let{name:d,property:f,binding:v}of i)this.binders[f].setUniform(v,l,a.get(f),d)}updatePaintBuffers(t){this._buffers=[];for(let i in this.binders){let a=this.binders[i];if(t&&a instanceof so){let l=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(a instanceof Lr||a instanceof tr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(let i in this.binders){let a=this.binders[i];(a instanceof Lr||a instanceof tr||a instanceof so)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let i=this.binders[t];(i instanceof Lr||i instanceof tr||i instanceof so)&&i.destroy()}}}class Pn{constructor(t,i,a=()=>!0){this.programConfigurations={};for(let l of t)this.programConfigurations[l.id]=new ph(l,i,a);this.needsUpload=!1,this._featureMap=new Bo,this._bufferOffset=0}populatePaintArrays(t,i,a,l,d,f){for(let v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,i,l,d,f);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,l){for(let d of a)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,i,d,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function dh(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Gc(n,t,i){let a={color:{source:hs,composite:M},number:{source:p,composite:hs}},l=(function(d){return{"line-pattern":{source:ze,composite:ze},"fill-pattern":{source:ze,composite:ze},"fill-extrusion-pattern":{source:ze,composite:ze}}[d]})(n);return l&&l[i]||a[t][i]}Ge("ConstantBinder",ps),Ge("CrossFadedConstantBinder",Ta),Ge("SourceExpressionBinder",Lr),Ge("CrossFadedCompositeBinder",so),Ge("CompositeExpressionBinder",tr),Ge("ProgramConfiguration",ph,{omit:["_buffers"]}),Ge("ProgramConfigurationSet",Pn);let dl=Math.pow(2,14)-1,ml=-dl-1;function lo(n){let t=Ot/n.extent,i=n.loadGeometry();for(let a=0;a<i.length;a++){let l=i[a];for(let d=0;d<l.length;d++){let f=l[d],v=Math.round(f.x*t),b=Math.round(f.y*t);f.x=fn(v,ml,dl),f.y=fn(b,ml,dl),(v<f.x||v>f.x+1||b<f.y||b>f.y+1)&&fi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Dr(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?lo(n):[]}}let Tm=-32768;function wy(n,t,i,a,l){n.emplaceBack(Tm+8*t+a,Tm+8*i+l)}class Rp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ue,this.indexArray=new Vt,this.segments=new dt,this.programConfigurations=new Pn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){let l=this.layers[0],d=[],f=null,v=!1,b=l.type==="heatmap";if(l.type==="circle"){let I=l;f=I.layout.get("circle-sort-key"),v=!f.isConstant(),b=b||I.paint.get("circle-pitch-alignment")==="map"}let S=b?i.subdivisionGranularity.circle:1;for(let{feature:I,id:E,index:L,sourceLayerIndex:z}of t){let R=this.layers[0]._featureFilter.needGeometry,j=Dr(I,R);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom,{globalState:this.globalState}),j,a))continue;let V=v?f.evaluate(j,{},a):void 0,H={id:E,properties:I.properties,type:I.type,sourceLayerIndex:z,index:L,geometry:R?j.geometry:lo(I),patterns:{},sortKey:V};d.push(H)}v&&d.sort((I,E)=>I.sortKey-E.sortKey);for(let I of d){let{geometry:E,index:L,sourceLayerIndex:z}=I,R=t[L].feature;this.addFeature(I,E,L,a,S),i.featureIndex.insert(R,E,L,z,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ci),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,l,d=1){let f;switch(d){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}let v=f.length;for(let b of i)for(let S of b){let I=S.x,E=S.y;if(I<0||I>=Ot||E<0||E>=Ot)continue;let L=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),z=L.vertexLength;for(let R=0;R<v;R++)for(let j=0;j<v;j++)wy(this.layoutVertexArray,I,E,f[j],f[R]);for(let R=0;R<v-1;R++)for(let j=0;j<v-1;j++){let V=z+R*v+j,H=z+(R+1)*v+j;this.indexArray.emplaceBack(V,H+1,V+1),this.indexArray.emplaceBack(V,H,H+1)}L.vertexLength+=v*v,L.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},l)}}function Sm(n,t){for(let i=0;i<n.length;i++)if(fl(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(fl(n,t[i]))return!0;return!!Fp(n,t)}function Ty(n,t,i){return!!fl(n,t)||!!Bp(t,n,i)}function Im(n,t){if(n.length===1)return Cm(t,n[0]);for(let i=0;i<t.length;i++){let a=t[i];for(let l=0;l<a.length;l++)if(fl(n,a[l]))return!0}for(let i=0;i<n.length;i++)if(Cm(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(Fp(n,t[i]))return!0;return!1}function Sy(n,t,i){if(n.length>1){if(Fp(n,t))return!0;for(let a=0;a<t.length;a++)if(Bp(t[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Bp(n[a],t,i))return!0;return!1}function Fp(n,t){if(n.length===0||t.length===0)return!1;for(let i=0;i<n.length-1;i++){let a=n[i],l=n[i+1];for(let d=0;d<t.length-1;d++)if(Iy(a,l,t[d],t[d+1]))return!0}return!1}function Iy(n,t,i,a){return Gn(n,i,a)!==Gn(t,i,a)&&Gn(n,t,i)!==Gn(n,t,a)}function Bp(n,t,i){let a=i*i;if(t.length===1)return n.distSqr(t[0])<a;for(let l=1;l<t.length;l++)if(Pm(n,t[l-1],t[l])<a)return!0;return!1}function Pm(n,t,i){let a=t.distSqr(i);if(a===0)return n.distSqr(t);let l=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/a;return n.distSqr(l<0?t:l>1?i:i.sub(t)._mult(l)._add(t))}function Cm(n,t){let i,a,l,d=!1;for(let f=0;f<n.length;f++){i=n[f];for(let v=0,b=i.length-1;v<i.length;b=v++)a=i[v],l=i[b],a.y>t.y!=l.y>t.y&&t.x<(l.x-a.x)*(t.y-a.y)/(l.y-a.y)+a.x&&(d=!d)}return d}function fl(n,t){let i=!1;for(let a=0,l=n.length-1;a<n.length;l=a++){let d=n[a],f=n[l];d.y>t.y!=f.y>t.y&&t.x<(f.x-d.x)*(t.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function Py(n,t,i){let a=i[0],l=i[2];if(n.x<a.x&&t.x<a.x||n.x>l.x&&t.x>l.x||n.y<a.y&&t.y<a.y||n.y>l.y&&t.y>l.y)return!1;let d=Gn(n,t,i[0]);return d!==Gn(n,t,i[1])||d!==Gn(n,t,i[2])||d!==Gn(n,t,i[3])}function Zc(n,t,i){let a=t.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(n)}function mh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function fh(n,t,i,a,l){if(!t[0]&&!t[1])return n;let d=C.convert(t)._mult(l);i==="viewport"&&d._rotate(-a);let f=[];for(let v=0;v<n.length;v++)f.push(n[v].sub(d));return f}let Mm,Em;Ge("CircleBucket",Rp,{omit:["layers"]});var Cy={get paint(){return Em=Em||new an({"circle-radius":new it(pe.paint_circle["circle-radius"]),"circle-color":new it(pe.paint_circle["circle-color"]),"circle-blur":new it(pe.paint_circle["circle-blur"]),"circle-opacity":new it(pe.paint_circle["circle-opacity"]),"circle-translate":new Ke(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new it(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new it(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new it(pe.paint_circle["circle-stroke-opacity"])})},get layout(){return Mm=Mm||new an({"circle-sort-key":new it(pe.layout_circle["circle-sort-key"])})}};class My extends Fn{constructor(t){super(t,Cy)}createBucket(t){return new Rp(t)}queryRadius(t){let i=t;return Zc("circle-radius",this,i)+Zc("circle-stroke-width",this,i)+mh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:l,transform:d,pixelsToTileUnits:f,unwrappedTileID:v,getElevation:b}){let S=fh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,f),I=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a),E=this.paint.get("circle-pitch-alignment")==="map",L=E?S:(function(R,j,V,H){return R.map(se=>Am(se,j,V,H))})(S,d,v,b),z=E?I*f:I;for(let R of l)for(let j of R){let V=E?j:Am(j,d,v,b),H=z,se=d.projectTileCoordinates(j.x,j.y,v,b).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?H*=se/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(H*=d.cameraToCenterDistance/se),Ty(L,V,H))return!0}return!1}}function Am(n,t,i,a){let l=t.projectTileCoordinates(n.x,n.y,i,a).point;return new C((.5*l.x+.5)*t.width,(.5*-l.y+.5)*t.height)}class km extends Rp{}let Lm;Ge("HeatmapBucket",km,{omit:["layers"]});var Ey={get paint(){return Lm=Lm||new an({"heatmap-radius":new it(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new it(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new cl(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(pe.paint_heatmap["heatmap-opacity"])})}};function Op(n,{width:t,height:i},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*i*a)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*i*a}`)}else l=new Uint8Array(t*i*a);return n.width=t,n.height=i,n.data=l,n}function Dm(n,{width:t,height:i},a){if(t===n.width&&i===n.height)return;let l=Op({},{width:t,height:i},a);jp(n,l,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,i)},a),n.width=t,n.height=i,n.data=l.data}function jp(n,t,i,a,l,d){if(l.width===0||l.height===0)return t;if(l.width>n.width||l.height>n.height||i.x>n.width-l.width||i.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||a.x>t.width-l.width||a.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let f=n.data,v=t.data;if(f===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<l.height;b++){let S=((i.y+b)*n.width+i.x)*d,I=((a.y+b)*t.width+a.x)*d;for(let E=0;E<l.width*d;E++)v[I+E]=f[S+E]}return t}class qc{constructor(t,i){Op(this,t,1,i)}resize(t){Dm(this,t,1)}clone(){return new qc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,l,d){jp(t,i,a,l,d,1)}}class Cn{constructor(t,i){Op(this,t,4,i)}resize(t){Dm(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Cn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,l,d){jp(t,i,a,l,d,4)}setPixel(t,i,a){let l=4*(t*this.width+i);this.data[l+0]=Math.round(255*a.r/a.a),this.data[l+1]=Math.round(255*a.g/a.a),this.data[l+2]=Math.round(255*a.b/a.a),this.data[l+3]=Math.round(255*a.a)}}function zm(n){let t={},i=n.resolution||256,a=n.clips?n.clips.length:1,l=n.image||new Cn({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);let d=(f,v,b)=>{t[n.evaluationKey]=b;let S=n.expression.evaluate(t);l.setPixel(f/4/i,v/4,S)};if(n.clips)for(let f=0,v=0;f<a;++f,v+=4*i)for(let b=0,S=0;b<i;b++,S+=4){let I=b/(i-1),{start:E,end:L}=n.clips[f];d(v,S,E*(1-I)+L*I)}else for(let f=0,v=0;f<i;f++,v+=4)d(0,v,f/(i-1));return l}Ge("AlphaImage",qc),Ge("RGBAImage",Cn);let Up="big-fb";class Ay extends Fn{createBucket(t){return new km(t)}constructor(t){super(t,Ey),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=zm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Up)&&this.heatmapFbos.delete(Up)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Rm;var ky={get paint(){return Rm=Rm||new an({"hillshade-illumination-direction":new Ke(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ke(pe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ke(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(pe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ke(pe.paint_hillshade["hillshade-method"])})}};class Ly extends Fn{constructor(t){super(t,ky),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,a=this.paint.get("hillshade-highlight-color").values,l=this.paint.get("hillshade-shadow-color").values,d=Math.max(t.length,i.length,a.length,l.length);t=t.concat(Array(d-t.length).fill(t.at(-1))),i=i.concat(Array(d-i.length).fill(i.at(-1))),a=a.concat(Array(d-a.length).fill(a.at(-1))),l=l.concat(Array(d-l.length).fill(l.at(-1)));let f=i.map(yo);return{directionRadians:t.map(yo),altitudeRadians:f,shadowColor:l,highlightColor:a}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Fm;var Dy={get paint(){return Fm=Fm||new an({"color-relief-opacity":new Ke(pe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new cl(pe["paint_color-relief"]["color-relief-color"])})}};class Np{constructor(t,i,a,l){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(i,l)}update(t,i,a){let{width:l,height:d}=t,f=!(this.size&&this.size[0]===l&&this.size[1]===d||a),{context:v}=this,{gl:b}=v;if(this.useMipmap=!!(i&&i.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!i||i.premultiply!==!1)),f)this.size=[l,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||hr(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,l,d,0,this.format,b.UNSIGNED_BYTE,t.data);else{let{x:S,y:I}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||hr(t)?b.texSubImage2D(b.TEXTURE_2D,0,S,I,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,S,I,l,d,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,i,a){let{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||t),this.filter=t),i!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Bm{constructor(t,i,a,l=1,d=1,f=1,v=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void fi(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;let b=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=d,this.blueFactor=f,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<b;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(b,S)]=this.data[this._idx(b-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,b)]=this.data[this._idx(S,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<b;S++)for(let I=0;I<b;I++){let E=this.get(S,I);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,i){let a=new Uint8Array(this.data.buffer),l=4*this._idx(t,i);return this.unpack(a[l],a[l+1],a[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,a){return t*this.redFactor+i*this.greenFactor+a*this.blueFactor-this.baseShift}pack(t){return Om(t,this.getUnpackVector())}getPixels(){return new Cn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,d=i*this.dim+this.dim,f=a*this.dim,v=a*this.dim+this.dim;switch(i){case-1:l=d-1;break;case 1:d=l+1}switch(a){case-1:f=v-1;break;case 1:v=f+1}let b=-i*this.dim,S=-a*this.dim;for(let I=f;I<v;I++)for(let E=l;E<d;E++)this.data[this._idx(E,I)]=t.data[this._idx(E+b,I+S)]}}function Om(n,t){let i=t[0],a=t[1],l=t[2],d=t[3],f=Math.min(i,a,l),v=Math.round((n+d)/f);return{r:Math.floor(v*f/i)%256,g:Math.floor(v*f/a)%256,b:Math.floor(v*f/l)%256}}Ge("DEMData",Bm);class zy extends Fn{constructor(t){super(t,Dy)}_createColorRamp(t){let i={elevationStops:[],colorStops:[]},a=this._transitionablePaint._values["color-relief-color"].value.expression;if(a instanceof is&&a._styleExpression.expression instanceof Zi){this.colorRampExpression=a;let f=a._styleExpression.expression;i.elevationStops=f.labels,i.colorStops=[];for(let v of i.elevationStops)i.colorStops.push(f.evaluate({globals:{elevation:v}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Tt.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=t)return i;let l={elevationStops:[],colorStops:[]},d=(i.elevationStops.length-1)/(t-1);for(let f=0;f<i.elevationStops.length-.5;f+=d)l.elevationStops.push(i.elevationStops[Math.round(f)]),l.colorStops.push(i.colorStops[Math.round(f)]);return fi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),l}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,i,a){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let l=this._createColorRamp(i),d=new Cn({width:l.colorStops.length,height:1}),f=new Cn({width:l.colorStops.length,height:1});for(let v=0;v<l.elevationStops.length;v++){let b=Om(l.elevationStops[v],a);f.setPixel(0,v,new Tt(b.r/255,b.g/255,b.b/255,1)),d.setPixel(0,v,l.colorStops[v])}return this.colorRampTextures={elevationTexture:new Np(t,f,t.gl.RGBA),colorTexture:new Np(t,d,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}let Ry=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fy}=Ry;function Vp(n,t,i){let a=i.patternDependencies,l=!1;for(let d of t){let f=d.paint.get(`${n}-pattern`);f.isConstant()||(l=!0);let v=f.constantOr(null);v&&(l=!0,a[v.to]=!0,a[v.from]=!0)}return l}function $p(n,t,i,a,l){let d=l.patternDependencies;for(let f of t){let v=f.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:a-1},i,{},l.availableImages),S=v.evaluate({zoom:a},i,{},l.availableImages),I=v.evaluate({zoom:a+1},i,{},l.availableImages);b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,d[b]=!0,d[S]=!0,d[I]=!0,i.patterns[f.id]={min:b,mid:S,max:I}}}return i}function jm(n,t,i,a,l){let d;if(l===(function(f,v,b,S){let I=0;for(let E=v,L=b-S;E<b;E+=S)I+=(f[L]-f[E])*(f[E+1]+f[L+1]),L=E;return I})(n,t,i,a)>0)for(let f=t;f<i;f+=a)d=$m(f/a|0,n[f],n[f+1],d);else for(let f=i-a;f>=t;f-=a)d=$m(f/a|0,n[f],n[f+1],d);return d&&gl(d,d.next)&&(Kc(d),d=d.next),d}function ds(n,t){if(!n)return n;t||(t=n);let i,a=n;do if(i=!1,a.steiner||!gl(a,a.next)&&_i(a.prev,a,a.next)!==0)a=a.next;else{if(Kc(a),a=t=a.prev,a===a.next)break;i=!0}while(i||a!==t);return t}function Wc(n,t,i,a,l,d,f){if(!n)return;!f&&d&&(function(b,S,I,E){let L=b;do L.z===0&&(L.z=Gp(L.x,L.y,S,I,E)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==b);L.prevZ.nextZ=null,L.prevZ=null,(function(z){let R,j=1;do{let V,H=z;z=null;let se=null;for(R=0;H;){R++;let te=H,re=0;for(let we=0;we<j&&(re++,te=te.nextZ,te);we++);let fe=j;for(;re>0||fe>0&&te;)re!==0&&(fe===0||!te||H.z<=te.z)?(V=H,H=H.nextZ,re--):(V=te,te=te.nextZ,fe--),se?se.nextZ=V:z=V,V.prevZ=se,se=V;H=te}se.nextZ=null,j*=2}while(R>1)})(L)})(n,a,l,d);let v=n;for(;n.prev!==n.next;){let b=n.prev,S=n.next;if(d?Oy(n,a,l,d):By(n))t.push(b.i,n.i,S.i),Kc(n),n=S.next,v=S.next;else if((n=S)===v){f?f===1?Wc(n=jy(ds(n),t),t,i,a,l,d,2):f===2&&Uy(n,t,i,a,l,d):Wc(ds(n),t,i,a,l,d,1);break}}}function By(n){let t=n.prev,i=n,a=n.next;if(_i(t,i,a)>=0)return!1;let l=t.x,d=i.x,f=a.x,v=t.y,b=i.y,S=a.y,I=Math.min(l,d,f),E=Math.min(v,b,S),L=Math.max(l,d,f),z=Math.max(v,b,S),R=a.next;for(;R!==t;){if(R.x>=I&&R.x<=L&&R.y>=E&&R.y<=z&&Hc(l,v,d,b,f,S,R.x,R.y)&&_i(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function Oy(n,t,i,a){let l=n.prev,d=n,f=n.next;if(_i(l,d,f)>=0)return!1;let v=l.x,b=d.x,S=f.x,I=l.y,E=d.y,L=f.y,z=Math.min(v,b,S),R=Math.min(I,E,L),j=Math.max(v,b,S),V=Math.max(I,E,L),H=Gp(z,R,t,i,a),se=Gp(j,V,t,i,a),te=n.prevZ,re=n.nextZ;for(;te&&te.z>=H&&re&&re.z<=se;){if(te.x>=z&&te.x<=j&&te.y>=R&&te.y<=V&&te!==l&&te!==f&&Hc(v,I,b,E,S,L,te.x,te.y)&&_i(te.prev,te,te.next)>=0||(te=te.prevZ,re.x>=z&&re.x<=j&&re.y>=R&&re.y<=V&&re!==l&&re!==f&&Hc(v,I,b,E,S,L,re.x,re.y)&&_i(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;te&&te.z>=H;){if(te.x>=z&&te.x<=j&&te.y>=R&&te.y<=V&&te!==l&&te!==f&&Hc(v,I,b,E,S,L,te.x,te.y)&&_i(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;re&&re.z<=se;){if(re.x>=z&&re.x<=j&&re.y>=R&&re.y<=V&&re!==l&&re!==f&&Hc(v,I,b,E,S,L,re.x,re.y)&&_i(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function jy(n,t){let i=n;do{let a=i.prev,l=i.next.next;!gl(a,l)&&Nm(a,i,i.next,l)&&Xc(a,l)&&Xc(l,a)&&(t.push(a.i,i.i,l.i),Kc(i),Kc(i.next),i=n=l),i=i.next}while(i!==n);return ds(i)}function Uy(n,t,i,a,l,d){let f=n;do{let v=f.next.next;for(;v!==f.prev;){if(f.i!==v.i&&Zy(f,v)){let b=Vm(f,v);return f=ds(f,f.next),b=ds(b,b.next),Wc(f,t,i,a,l,d,0),void Wc(b,t,i,a,l,d,0)}v=v.next}f=f.next}while(f!==n)}function Ny(n,t){let i=n.x-t.x;return i===0&&(i=n.y-t.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function Vy(n,t){let i=(function(l,d){let f=d,v=l.x,b=l.y,S,I=-1/0;if(gl(l,f))return f;do{if(gl(l,f.next))return f.next;if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){let j=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(j<=v&&j>I&&(I=j,S=f.x<f.next.x?f:f.next,j===v))return S}f=f.next}while(f!==d);if(!S)return null;let E=S,L=S.x,z=S.y,R=1/0;f=S;do{if(v>=f.x&&f.x>=L&&v!==f.x&&Um(b<z?v:I,b,L,z,b<z?I:v,b,f.x,f.y)){let j=Math.abs(b-f.y)/(v-f.x);Xc(f,l)&&(j<R||j===R&&(f.x>S.x||f.x===S.x&&$y(S,f)))&&(S=f,R=j)}f=f.next}while(f!==E);return S})(n,t);if(!i)return t;let a=Vm(i,n);return ds(a,a.next),ds(i,i.next)}function $y(n,t){return _i(n.prev,n,t.prev)<0&&_i(t.next,n,n.next)<0}function Gp(n,t,i,a,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Gy(n){let t=n,i=n;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==n);return i}function Um(n,t,i,a,l,d,f,v){return(l-f)*(t-v)>=(n-f)*(d-v)&&(n-f)*(a-v)>=(i-f)*(t-v)&&(i-f)*(d-v)>=(l-f)*(a-v)}function Hc(n,t,i,a,l,d,f,v){return!(n===f&&t===v)&&Um(n,t,i,a,l,d,f,v)}function Zy(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(i,a){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==a.i&&l.next.i!==a.i&&Nm(l,l.next,i,a))return!0;l=l.next}while(l!==i);return!1})(n,t)&&(Xc(n,t)&&Xc(t,n)&&(function(i,a){let l=i,d=!1,f=(i.x+a.x)/2,v=(i.y+a.y)/2;do l.y>v!=l.next.y>v&&l.next.y!==l.y&&f<(l.next.x-l.x)*(v-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==i);return d})(n,t)&&(_i(n.prev,n,t.prev)||_i(n,t.prev,t))||gl(n,t)&&_i(n.prev,n,n.next)>0&&_i(t.prev,t,t.next)>0)}function _i(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function gl(n,t){return n.x===t.x&&n.y===t.y}function Nm(n,t,i,a){let l=_h(_i(n,t,i)),d=_h(_i(n,t,a)),f=_h(_i(i,a,n)),v=_h(_i(i,a,t));return l!==d&&f!==v||!(l!==0||!gh(n,i,t))||!(d!==0||!gh(n,a,t))||!(f!==0||!gh(i,n,a))||!(v!==0||!gh(i,t,a))}function gh(n,t,i){return t.x<=Math.max(n.x,i.x)&&t.x>=Math.min(n.x,i.x)&&t.y<=Math.max(n.y,i.y)&&t.y>=Math.min(n.y,i.y)}function _h(n){return n>0?1:n<0?-1:0}function Xc(n,t){return _i(n.prev,n,n.next)<0?_i(n,t,n.next)>=0&&_i(n,n.prev,t)>=0:_i(n,t,n.prev)<0||_i(n,n.next,t)<0}function Vm(n,t){let i=Zp(n.i,n.x,n.y),a=Zp(t.i,t.x,t.y),l=n.next,d=t.prev;return n.next=t,t.prev=n,i.next=l,l.prev=i,a.next=i,i.prev=a,d.next=a,a.prev=d,a}function $m(n,t,i,a){let l=Zp(n,t,i);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function Kc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Zp(n,t,i){return{i:n,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class _l{constructor(t,i){if(i>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=i}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class yh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}yh.noSubdivision=new yh({fill:new _l(0,0),line:new _l(0,0),tile:new _l(0,0),stencil:new _l(0,0),circle:1}),Ge("SubdivisionGranularityExpression",_l),Ge("SubdivisionGranularitySetting",yh);let yl=-32768,Yc=32767;class qy{constructor(t,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Ot/t,this._canonical=i}_getKey(t,i){return(t+=32768)<<16|i+32768}_vertexToIndex(t,i){if(t<-32768||i<-32768||t>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let a=0|Math.round(t),l=0|Math.round(i),d=this._getKey(a,l);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);let f=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,f),this._vertexBuffer.push(a,l),f}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(l,d){let f=[];for(let v=0;v<d.length;v+=3){let b=d[v],S=d[v+1],I=d[v+2],E=l[2*b],L=l[2*b+1];(l[2*S]-E)*(l[2*I+1]-L)-(l[2*S+1]-L)*(l[2*I]-E)>0?(f.push(b),f.push(I),f.push(S)):(f.push(b),f.push(S),f.push(I))}return f})(this._vertexBuffer,t);let i=[],a=t.length;for(let l=0;l<a;l+=3){let d=[t[l+0],t[l+1],t[l+2]],f=[this._vertexBuffer[2*t[l+0]+0],this._vertexBuffer[2*t[l+0]+1],this._vertexBuffer[2*t[l+1]+0],this._vertexBuffer[2*t[l+1]+1],this._vertexBuffer[2*t[l+2]+0],this._vertexBuffer[2*t[l+2]+1]],v=1/0,b=1/0,S=-1/0,I=-1/0;for(let j=0;j<3;j++){let V=f[2*j],H=f[2*j+1];v=Math.min(v,V),S=Math.max(S,V),b=Math.min(b,H),I=Math.max(I,H)}if(v===S||b===I)continue;let E=Math.floor(v/this._granularityCellSize),L=Math.ceil(S/this._granularityCellSize),z=Math.floor(b/this._granularityCellSize),R=Math.ceil(I/this._granularityCellSize);if(E!==L||z!==R)for(let j=z;j<R;j++){let V=this._scanlineGenerateVertexRingForCellRow(j,f,d);Wy(this._vertexBuffer,V,i)}else i.push(...d)}return i}_scanlineGenerateVertexRingForCellRow(t,i,a){let l=t*this._granularityCellSize,d=l+this._granularityCellSize,f=[];for(let v=0;v<3;v++){let b=i[2*v],S=i[2*v+1],I=i[2*(v+1)%6],E=i[(2*(v+1)+1)%6],L=i[2*(v+2)%6],z=i[(2*(v+2)+1)%6],R=I-b,j=E-S,V=R===0,H=j===0,se=(l-S)/j,te=(d-S)/j,re=Math.min(se,te),fe=Math.max(se,te);if(!H&&(re>=1||fe<=0)||H&&(S<l||S>d)){E>=l&&E<=d&&f.push(a[(v+1)%3]);continue}!H&&re>0&&f.push(this._vertexToIndex(b+R*re,S+j*re));let we=b+R*Math.max(re,0),Ee=b+R*Math.min(fe,1);V||this._generateIntraEdgeVertices(f,b,S,I,E,we,Ee),!H&&fe<1&&f.push(this._vertexToIndex(b+R*fe,S+j*fe)),(H||E>=l&&E<=d)&&f.push(a[(v+1)%3]),!H&&(E<=l||E>=d)&&this._generateInterEdgeVertices(f,b,S,I,E,L,z,Ee,l,d)}return f}_generateIntraEdgeVertices(t,i,a,l,d,f,v){let b=l-i,S=d-a,I=S===0,E=I?Math.min(i,l):Math.min(f,v),L=I?Math.max(i,l):Math.max(f,v),z=Math.floor(E/this._granularityCellSize)+1,R=Math.ceil(L/this._granularityCellSize)-1;if(I?i<l:f<v)for(let j=z;j<=R;j++){let V=j*this._granularityCellSize;t.push(this._vertexToIndex(V,a+S*(V-i)/b))}else for(let j=R;j>=z;j--){let V=j*this._granularityCellSize;t.push(this._vertexToIndex(V,a+S*(V-i)/b))}}_generateInterEdgeVertices(t,i,a,l,d,f,v,b,S,I){let E=d-a,L=f-l,z=v-d,R=(S-d)/z,j=(I-d)/z,V=Math.min(R,j),H=Math.max(R,j),se=l+L*V,te=Math.floor(Math.min(se,b)/this._granularityCellSize)+1,re=Math.ceil(Math.max(se,b)/this._granularityCellSize)-1,fe=b<se,we=z===0;if(we&&(v===S||v===I))return;if(we||V>=1||H<=0){let Ne=a-v,Fe=f+(i-f)*Math.min((S-v)/Ne,(I-v)/Ne);te=Math.floor(Math.min(Fe,b)/this._granularityCellSize)+1,re=Math.ceil(Math.max(Fe,b)/this._granularityCellSize)-1,fe=b<Fe}let Ee=E>0?I:S;if(fe)for(let Ne=te;Ne<=re;Ne++)t.push(this._vertexToIndex(Ne*this._granularityCellSize,Ee));else for(let Ne=re;Ne>=te;Ne--)t.push(this._vertexToIndex(Ne*this._granularityCellSize,Ee))}_generateOutline(t){let i=[];for(let a of t){let l=ms(a,this._granularity,!0),d=this._pointArrayToIndices(l),f=[];for(let v=1;v<d.length;v++)f.push(d[v-1]),f.push(d[v]);i.push(f)}return i}_handlePoles(t){let i=!1,a=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(a=!0)),(i||a)&&this._fillPoles(t,i,a)}_ensureNoPoleVertices(){let t=this._vertexBuffer;for(let i=0;i<t.length;i+=2){let a=t[i+1];a===yl&&(t[i+1]=-32767),a===Yc&&(t[i+1]=32766)}}_generatePoleQuad(t,i,a,l,d,f){l>d!=(f===yl)?(t.push(i),t.push(a),t.push(this._vertexToIndex(l,f)),t.push(a),t.push(this._vertexToIndex(d,f)),t.push(this._vertexToIndex(l,f))):(t.push(a),t.push(i),t.push(this._vertexToIndex(l,f)),t.push(this._vertexToIndex(d,f)),t.push(a),t.push(this._vertexToIndex(l,f)))}_fillPoles(t,i,a){let l=this._vertexBuffer,d=Ot,f=t.length;for(let v=2;v<f;v+=3){let b=t[v-2],S=t[v-1],I=t[v],E=l[2*b],L=l[2*b+1],z=l[2*S],R=l[2*S+1],j=l[2*I],V=l[2*I+1];i&&(L===0&&R===0&&this._generatePoleQuad(t,b,S,E,z,yl),R===0&&V===0&&this._generatePoleQuad(t,S,I,z,j,yl),V===0&&L===0&&this._generatePoleQuad(t,I,b,j,E,yl)),a&&(L===d&&R===d&&this._generatePoleQuad(t,b,S,E,z,Yc),R===d&&V===d&&this._generatePoleQuad(t,S,I,z,j,Yc),V===d&&L===d&&this._generatePoleQuad(t,I,b,j,E,Yc))}}_initializeVertices(t){for(let i=0;i<t.length;i+=2)this._vertexToIndex(t[i],t[i+1])}subdividePolygonInternal(t,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:a,holeIndices:l}=(function(v){let b=[],S=[];for(let I of v)if(I.length!==0){I!==v[0]&&b.push(S.length/2);for(let E=0;E<I.length;E++)S.push(I[E].x),S.push(I[E].y)}return{flattened:S,holeIndices:b}})(t),d;this._initializeVertices(a);try{let v=(function(S,I,E=2){let L=I&&I.length,z=L?I[0]*E:S.length,R=jm(S,0,z,E,!0),j=[];if(!R||R.next===R.prev)return j;let V,H,se;if(L&&(R=(function(te,re,fe,we){let Ee=[];for(let Ne=0,Fe=re.length;Ne<Fe;Ne++){let je=jm(te,re[Ne]*we,Ne<Fe-1?re[Ne+1]*we:te.length,we,!1);je===je.next&&(je.steiner=!0),Ee.push(Gy(je))}Ee.sort(Ny);for(let Ne=0;Ne<Ee.length;Ne++)fe=Vy(Ee[Ne],fe);return fe})(S,I,R,E)),S.length>80*E){V=S[0],H=S[1];let te=V,re=H;for(let fe=E;fe<z;fe+=E){let we=S[fe],Ee=S[fe+1];we<V&&(V=we),Ee<H&&(H=Ee),we>te&&(te=we),Ee>re&&(re=Ee)}se=Math.max(te-V,re-H),se=se!==0?32767/se:0}return Wc(R,j,E,V,H,se,0),j})(a,l),b=this._convertIndices(a,v);d=this._subdivideTrianglesScanline(b)}catch(v){console.error(v)}let f=[];return i&&(f=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:f}}_convertIndices(t,i){let a=[];for(let l=0;l<i.length;l++)a.push(this._vertexToIndex(t[2*i[l]],t[2*i[l]+1]));return a}_pointArrayToIndices(t){let i=[];for(let a=0;a<t.length;a++){let l=t[a];i.push(this._vertexToIndex(l.x,l.y))}return i}}function Gm(n,t,i,a=!0){return new qy(i,t).subdividePolygonInternal(n,a)}function ms(n,t,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];let a=n[0],l=n[n.length-1],d=i&&(a.x!==l.x||a.y!==l.y);if(t<2)return d?[...n,n[0]]:[...n];let f=Math.floor(Ot/t),v=[];v.push(new C(n[0].x,n[0].y));let b=n.length,S=d?b:b-1;for(let I=0;I<S;I++){let E=n[I],L=I<b-1?n[I+1]:n[0],z=E.x,R=E.y,j=L.x,V=L.y,H=z!==j,se=R!==V;if(!H&&!se)continue;let te=j-z,re=V-R,fe=Math.abs(te),we=Math.abs(re),Ee=z,Ne=R;for(;;){let je=te>0?(Math.floor(Ee/f)+1)*f:(Math.ceil(Ee/f)-1)*f,Ye=re>0?(Math.floor(Ne/f)+1)*f:(Math.ceil(Ne/f)-1)*f,Oe=Math.abs(Ee-je),Ue=Math.abs(Ne-Ye),Se=Math.abs(Ee-j),ot=Math.abs(Ne-V),at=H?Oe/fe:Number.POSITIVE_INFINITY,et=se?Ue/we:Number.POSITIVE_INFINITY;if((Se<=Oe||!H)&&(ot<=Ue||!se))break;if(at<et&&H||!se){Ee=je,Ne+=re*at;let He=new C(Ee,Math.round(Ne));v[v.length-1].x===He.x&&v[v.length-1].y===He.y||v.push(He)}else{Ee+=te*et,Ne=Ye;let He=new C(Math.round(Ee),Ne);v[v.length-1].x===He.x&&v[v.length-1].y===He.y||v.push(He)}}let Fe=new C(j,V);v[v.length-1].x===Fe.x&&v[v.length-1].y===Fe.y||v.push(Fe)}return v}function Wy(n,t,i){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let a=0,l=n[2*t[0]];for(let b=1;b<t.length;b++){let S=n[2*t[b]];S<l&&(l=S,a=b)}let d=t.length,f=a,v=(f+1)%d;for(;;){let b=f-1>=0?f-1:d-1,S=(v+1)%d,I=n[2*t[b]],E=n[2*t[S]],L=n[2*t[f]],z=n[2*t[f]+1],R=n[2*t[v]+1],j=!1;if(I<E)j=!0;else if(I>E)j=!1;else{let V=R-z,H=-(n[2*t[v]]-L),se=z<R?1:-1;((I-L)*V+(n[2*t[b]+1]-z)*H)*se>((E-L)*V+(n[2*t[S]+1]-z)*H)*se&&(j=!0)}if(j){let V=t[b],H=t[f],se=t[v];V!==H&&V!==se&&H!==se&&i.push(se,H,V),f--,f<0&&(f=d-1)}else{let V=t[S],H=t[f],se=t[v];V!==H&&V!==se&&H!==se&&i.push(se,H,V),v++,v>=d&&(v=0)}if(b===S)break}}function Zm(n,t,i,a,l,d,f,v,b){let S=l.length/2,I=f&&v&&b;if(S<dt.MAX_VERTEX_ARRAY_LENGTH){let E=t.prepareSegment(S,i,a),L=E.vertexLength;for(let j=0;j<d.length;j+=3)a.emplaceBack(L+d[j],L+d[j+1],L+d[j+2]);let z,R;E.vertexLength+=S,E.primitiveLength+=d.length/3,I&&(R=f.prepareSegment(S,i,v),z=R.vertexLength,R.vertexLength+=S);for(let j=0;j<l.length;j+=2)n(l[j],l[j+1]);if(I)for(let j=0;j<b.length;j++){let V=b[j];for(let H=1;H<V.length;H+=2)v.emplaceBack(z+V[H-1],z+V[H]);R.primitiveLength+=V.length/2}}else(function(E,L,z,R,j,V){let H=[];for(let we=0;we<R.length/2;we++)H.push(-1);let se={count:0},te=0,re=E.getOrCreateLatestSegment(L,z),fe=re.vertexLength;for(let we=2;we<j.length;we+=3){let Ee=j[we-2],Ne=j[we-1],Fe=j[we],je=H[Ee]<te,Ye=H[Ne]<te,Oe=H[Fe]<te;re.vertexLength+((je?1:0)+(Ye?1:0)+(Oe?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(re=E.createNewSegment(L,z),te=se.count,je=!0,Ye=!0,Oe=!0,fe=0);let Ue=Jc(H,R,V,se,Ee,je,re),Se=Jc(H,R,V,se,Ne,Ye,re),ot=Jc(H,R,V,se,Fe,Oe,re);z.emplaceBack(fe+Ue-te,fe+Se-te,fe+ot-te),re.primitiveLength++}})(t,i,a,l,d,n),I&&(function(E,L,z,R,j,V){let H=[];for(let we=0;we<R.length/2;we++)H.push(-1);let se={count:0},te=0,re=E.getOrCreateLatestSegment(L,z),fe=re.vertexLength;for(let we=0;we<j.length;we++){let Ee=j[we];for(let Ne=1;Ne<j[we].length;Ne+=2){let Fe=Ee[Ne-1],je=Ee[Ne],Ye=H[Fe]<te,Oe=H[je]<te;re.vertexLength+((Ye?1:0)+(Oe?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(re=E.createNewSegment(L,z),te=se.count,Ye=!0,Oe=!0,fe=0);let Ue=Jc(H,R,V,se,Fe,Ye,re),Se=Jc(H,R,V,se,je,Oe,re);z.emplaceBack(fe+Ue-te,fe+Se-te),re.primitiveLength++}}})(f,i,v,l,b,n),t.forceNewSegmentOnNextPrepare(),f?.forceNewSegmentOnNextPrepare()}function Jc(n,t,i,a,l,d,f){if(d){let v=a.count;return i(t[2*l],t[2*l+1]),n[l]=a.count,a.count++,f.vertexLength++,v}return n[l]}class qp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xe,this.indexArray=new Vt,this.indexArray2=new jt,this.programConfigurations=new Pn(t.layers,t.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=Vp("fill",this.layers,i);let l=this.layers[0].layout.get("fill-sort-key"),d=!l.isConstant(),f=[];for(let{feature:v,id:b,index:S,sourceLayerIndex:I}of t){let E=this.layers[0]._featureFilter.needGeometry,L=Dr(v,E);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom,{globalState:this.globalState}),L,a))continue;let z=d?l.evaluate(L,{},a,i.availableImages):void 0,R={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:S,geometry:E?L.geometry:lo(v),patterns:{},sortKey:z};f.push(R)}d&&f.sort((v,b)=>v.sortKey-b.sortKey);for(let v of f){let{geometry:b,index:S,sourceLayerIndex:I}=v;if(this.hasPattern){let E=$p("fill",this.layers,v,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(v,b,S,a,{},i.subdivisionGranularity);i.featureIndex.insert(t[S].feature,b,S,I,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,i,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fy),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,l,d,f){for(let v of Ya(i,500)){let b=Gm(v,l,f.fill.getGranularityForZoomLevel(l.z)),S=this.layoutVertexArray;Zm((I,E)=>{S.emplaceBack(I,E)},this.segments,this.layoutVertexArray,this.indexArray,b.verticesFlattened,b.indicesTriangles,this.segments2,this.indexArray2,b.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,l)}}let qm,Wm;Ge("FillBucket",qp,{omit:["layers","patternFeatures"]});var Hy={get paint(){return Wm=Wm||new an({"fill-antialias":new Ke(pe.paint_fill["fill-antialias"]),"fill-opacity":new it(pe.paint_fill["fill-opacity"]),"fill-color":new it(pe.paint_fill["fill-color"]),"fill-outline-color":new it(pe.paint_fill["fill-outline-color"]),"fill-translate":new Ke(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ll(pe.paint_fill["fill-pattern"])})},get layout(){return qm=qm||new an({"fill-sort-key":new it(pe.layout_fill["fill-sort-key"])})}};class Xy extends Fn{constructor(t){super(t,Hy)}recalculate(t,i){super.recalculate(t,i);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new qp(t)}queryRadius(){return mh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:i,transform:a,pixelsToTileUnits:l}){return Im(fh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-a.bearingInRadians,l),i)}isTileClipped(){return!0}}let Ky=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Yy=mi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Jy}=Ky;class vl{constructor(t,i,a,l,d){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=d,t.readFields(Qy,this,i)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let i=t.readVarint()+t.pos,a=[],l,d=1,f=0,v=0,b=0;for(;t.pos<i;){if(f<=0){let S=t.readVarint();d=7&S,f=S>>3}if(f--,d===1||d===2)v+=t.readSVarint(),b+=t.readSVarint(),d===1&&(l&&a.push(l),l=[]),l&&l.push(new C(v,b));else{if(d!==7)throw new Error(`unknown command ${d}`);l&&l.push(l[0].clone())}}return l&&a.push(l),a}bbox(){let t=this._pbf;t.pos=this._geometry;let i=t.readVarint()+t.pos,a=1,l=0,d=0,f=0,v=1/0,b=-1/0,S=1/0,I=-1/0;for(;t.pos<i;){if(l<=0){let E=t.readVarint();a=7&E,l=E>>3}if(l--,a===1||a===2)d+=t.readSVarint(),f+=t.readSVarint(),d<v&&(v=d),d>b&&(b=d),f<S&&(S=f),f>I&&(I=f);else if(a!==7)throw new Error(`unknown command ${a}`)}return[v,S,b,I]}toGeoJSON(t,i,a){let l=this.extent*Math.pow(2,a),d=this.extent*t,f=this.extent*i,v=this.loadGeometry();function b(L){return[360*(L.x+d)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+f)/l)*Math.PI))-90]}function S(L){return L.map(b)}let I;if(this.type===1){let L=[];for(let R of v)L.push(R[0]);let z=S(L);I=L.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){let L=v.map(S);I=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{let L=(function(R){let j=R.length;if(j<=1)return[R];let V=[],H,se;for(let te=0;te<j;te++){let re=e0(R[te]);re!==0&&(se===void 0&&(se=re<0),se===re<0?(H&&V.push(H),H=[R[te]]):H&&H.push(R[te]))}return H&&V.push(H),V})(v),z=[];for(let R of L)z.push(R.map(S));I=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}let E={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(E.id=this.id),E}}function Qy(n,t,i){n===1?t.id=i.readVarint():n===2?(function(a,l){let d=a.readVarint()+a.pos;for(;a.pos<d;){let f=l._keys[a.readVarint()],v=l._values[a.readVarint()];l.properties[f]=v}})(i,t):n===3?t.type=i.readVarint():n===4&&(t._geometry=i.pos)}function e0(n){let t=0;for(let i,a,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],a=n[f],t+=(a.x-i.x)*(i.y+a.y);return t}vl.types=["Unknown","Point","LineString","Polygon"];class Hm{constructor(t,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(t0,this,i),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let i=this._pbf.readVarint()+this._pbf.pos;return new vl(this._pbf,i,this.extent,this._keys,this._values)}}function t0(n,t,i){n===15?t.version=i.readVarint():n===1?t.name=i.readString():n===5?t.extent=i.readVarint():n===2?t._features.push(i.pos):n===3?t._keys.push(i.readString()):n===4&&t._values.push((function(a){let l=null,d=a.readVarint()+a.pos;for(;a.pos<d;){let f=a.readVarint()>>3;l=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}if(l==null)throw new Error("unknown feature value");return l})(i))}class Xm{constructor(t,i){this.layers=t.readFields(i0,{},i)}}function i0(n,t,i){if(n===3){let a=new Hm(i,i.readVarint()+i.pos);a.length&&(t[a.name]=a)}}let Wp=Math.pow(2,13);function Qc(n,t,i,a,l,d,f,v){n.emplaceBack(t,i,2*Math.floor(a*Wp)+f,l*Wp*2,d*Wp*2,Math.round(v))}class Hp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new de,this.centroidVertexArray=new J,this.indexArray=new Vt,this.programConfigurations=new Pn(t.layers,t.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.features=[],this.hasPattern=Vp("fill-extrusion",this.layers,i);for(let{feature:l,id:d,index:f,sourceLayerIndex:v}of t){let b=this.layers[0]._featureFilter.needGeometry,S=Dr(l,b);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom,{globalState:this.globalState}),S,a))continue;let I={id:d,sourceLayerIndex:v,index:f,geometry:b?S.geometry:lo(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push($p("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,f,a,{},i.subdivisionGranularity),i.featureIndex.insert(l,I.geometry,f,v,this.index,!0)}}addFeatures(t,i,a){for(let l of this.features){let{geometry:d}=l;this.addFeature(l,d,l.index,i,a,t.subdivisionGranularity)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jy),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Yy.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,a,l,d,f){for(let v of Ya(i,500)){let b={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(b,l,t,v,f);let I=this.layoutVertexArray.length-S,E=Math.floor(b.x/b.sampleCount),L=Math.floor(b.y/b.sampleCount);for(let z=0;z<I;z++)this.centroidVertexArray.emplaceBack(E,L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,l)}processPolygon(t,i,a,l,d){if(l.length<1||Km(l[0]))return;for(let E of l)E.length!==0&&n0(t,E);let f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=d.fill.getGranularityForZoomLevel(i.z),b=vl.types[a.type]==="Polygon";for(let E of l){if(E.length===0||Km(E))continue;let L=ms(E,v,b);this._generateSideFaces(L,f)}if(!b)return;let S=Gm(l,i,v,!1),I=this.layoutVertexArray;Zm((E,L)=>{Qc(I,E,L,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(t,i){let a=0;for(let l=1;l<t.length;l++){let d=t[l],f=t[l-1];if(r0(d,f))continue;i.segment.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let v=d.sub(f)._perp()._unit(),b=f.dist(d);a+b>32768&&(a=0),Qc(this.layoutVertexArray,d.x,d.y,v.x,v.y,0,0,a),Qc(this.layoutVertexArray,d.x,d.y,v.x,v.y,0,1,a),a+=b,Qc(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,0,a),Qc(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,1,a);let S=i.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function n0(n,t){for(let i=0;i<t.length;i++){let a=t[i];i===t.length-1&&t[0].x===a.x&&t[0].y===a.y||(n.x+=a.x,n.y+=a.y,n.sampleCount++)}}function r0(n,t){return n.x===t.x&&(n.x<0||n.x>Ot)||n.y===t.y&&(n.y<0||n.y>Ot)}function Km(n){return n.every(t=>t.x<0)||n.every(t=>t.x>Ot)||n.every(t=>t.y<0)||n.every(t=>t.y>Ot)}let Ym;Ge("FillExtrusionBucket",Hp,{omit:["layers","features"]});var o0={get paint(){return Ym=Ym||new an({"fill-extrusion-opacity":new Ke(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new it(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ll(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new it(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new it(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class a0 extends Fn{constructor(t){super(t,o0)}createBucket(t){return new Hp(t)}queryRadius(){return mh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:l,transform:d,pixelsToTileUnits:f,pixelPosMatrix:v}){let b=fh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,f),S=this.paint.get("fill-extrusion-height").evaluate(i,a),I=this.paint.get("fill-extrusion-base").evaluate(i,a),E=(function(z,R){let j=[];for(let V of z){let H=[V.x,V.y,0,1];mo(H,H,R),j.push(new C(H[0]/H[3],H[1]/H[3]))}return j})(b,v),L=(function(z,R,j,V){let H=[],se=[],te=V[8]*R,re=V[9]*R,fe=V[10]*R,we=V[11]*R,Ee=V[8]*j,Ne=V[9]*j,Fe=V[10]*j,je=V[11]*j;for(let Ye of z){let Oe=[],Ue=[];for(let Se of Ye){let ot=Se.x,at=Se.y,et=V[0]*ot+V[4]*at+V[12],He=V[1]*ot+V[5]*at+V[13],Mt=V[2]*ot+V[6]*at+V[14],ui=V[3]*ot+V[7]*at+V[15],Ai=Mt+fe,en=ui+we,nr=et+Ee,Mn=He+Ne,qi=Mt+Fe,ri=ui+je,Oi=new C((et+te)/en,(He+re)/en);Oi.z=Ai/en,Oe.push(Oi);let Wi=new C(nr/ri,Mn/ri);Wi.z=qi/ri,Ue.push(Wi)}H.push(Oe),se.push(Ue)}return[H,se]})(l,I,S,v);return(function(z,R,j){let V=1/0;Im(j,R)&&(V=Jm(j,R[0]));for(let H=0;H<R.length;H++){let se=R[H],te=z[H];for(let re=0;re<se.length-1;re++){let fe=se[re],we=[fe,se[re+1],te[re+1],te[re],fe];Sm(j,we)&&(V=Math.min(V,Jm(j,we)))}}return V!==1/0&&V})(L[0],L[1],E)}}function eu(n,t){return n.x*t.x+n.y*t.y}function Jm(n,t){if(n.length===1){let i=0,a=t[i++],l;for(;!l||a.equals(l);)if(l=t[i++],!l)return 1/0;for(;i<t.length;i++){let d=t[i],f=n[0],v=l.sub(a),b=d.sub(a),S=f.sub(a),I=eu(v,v),E=eu(v,b),L=eu(b,b),z=eu(S,v),R=eu(S,b),j=I*L-E*E,V=(L*z-E*R)/j,H=(I*R-E*z)/j,se=a.z*(1-V-H)+l.z*V+d.z*H;if(isFinite(se))return se}return 1/0}{let i=1/0;for(let a of t)i=Math.min(i,a.z);return i}}let s0=mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:l0}=s0,c0=mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:u0}=c0,h0=Math.cos(Math.PI/180*37.5),Qm=Math.pow(2,14)/.5;class Xp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new me,this.layoutVertexArray2=new ye,this.indexArray=new Vt,this.programConfigurations=new Pn(t.layers,t.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=Vp("line",this.layers,i);let l=this.layers[0].layout.get("line-sort-key"),d=!l.isConstant(),f=[];for(let{feature:v,id:b,index:S,sourceLayerIndex:I}of t){let E=this.layers[0]._featureFilter.needGeometry,L=Dr(v,E);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom,{globalState:this.globalState}),L,a))continue;let z=d?l.evaluate(L,{},a):void 0,R={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:S,geometry:E?L.geometry:lo(v),patterns:{},sortKey:z};f.push(R)}d&&f.sort((v,b)=>v.sortKey-b.sortKey);for(let v of f){let{geometry:b,index:S,sourceLayerIndex:I}=v;if(this.hasPattern){let E=$p("line",this.layers,v,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(v,b,S,a,{},i.subdivisionGranularity);i.featureIndex.insert(t[S].feature,b,S,I,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,a)}addFeatures(t,i,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,i,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,u0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,l0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,l,d,f){let v=this.layers[0].layout,b=v.get("line-join").evaluate(t,{}),S=v.get("line-cap"),I=v.get("line-miter-limit"),E=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let L of i)this.addLine(L,t,b,S,I,E,l,f);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,d,l)}addLine(t,i,a,l,d,f,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=ms(t,v?b.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<t.length-1;te++)this.totalDistance+=t[te].dist(t[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let S=vl.types[i.type]==="Polygon",I=t.length;for(;I>=2&&t[I-1].equals(t[I-2]);)I--;let E=0;for(;E<I-1&&t[E].equals(t[E+1]);)E++;if(I<(S?3:2))return;a==="bevel"&&(d=1.05);let L=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray),R,j,V,H,se;this.e1=this.e2=-1,S&&(R=t[I-2],se=t[E].sub(R)._unit()._perp());for(let te=E;te<I;te++){if(V=te===I-1?S?t[E+1]:void 0:t[te+1],V&&t[te].equals(V))continue;se&&(H=se),R&&(j=R),R=t[te],se=V?V.sub(R)._unit()._perp():H,H=H||se;let re=H.add(se);re.x===0&&re.y===0||re._unit();let fe=H.x*se.x+H.y*se.y,we=re.x*se.x+re.y*se.y,Ee=we!==0?1/we:1/0,Ne=2*Math.sqrt(2-2*we),Fe=we<h0&&j&&V,je=H.x*se.y-H.y*se.x>0;if(Fe&&te>E){let Ue=R.dist(j);if(Ue>2*L){let Se=R.sub(R.sub(j)._mult(L/Ue)._round());this.updateDistance(j,Se),this.addCurrentVertex(Se,H,0,0,z),j=Se}}let Ye=j&&V,Oe=Ye?a:S?"butt":l;if(Ye&&Oe==="round"&&(Ee<f?Oe="miter":Ee<=2&&(Oe="fakeround")),Oe==="miter"&&Ee>d&&(Oe="bevel"),Oe==="bevel"&&(Ee>2&&(Oe="flipbevel"),Ee<d&&(Oe="miter")),j&&this.updateDistance(j,R),Oe==="miter")re._mult(Ee),this.addCurrentVertex(R,re,0,0,z);else if(Oe==="flipbevel"){if(Ee>100)re=se.mult(-1);else{let Ue=Ee*H.add(se).mag()/H.sub(se).mag();re._perp()._mult(Ue*(je?-1:1))}this.addCurrentVertex(R,re,0,0,z),this.addCurrentVertex(R,re.mult(-1),0,0,z)}else if(Oe==="bevel"||Oe==="fakeround"){let Ue=-Math.sqrt(Ee*Ee-1),Se=je?Ue:0,ot=je?0:Ue;if(j&&this.addCurrentVertex(R,H,Se,ot,z),Oe==="fakeround"){let at=Math.round(180*Ne/Math.PI/20);for(let et=1;et<at;et++){let He=et/at;if(He!==.5){let ui=He-.5;He+=He*ui*(He-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*ui*ui+(.848013+fe*(.215638*fe-1.06021)))}let Mt=se.sub(H)._mult(He)._add(H)._unit()._mult(je?-1:1);this.addHalfVertex(R,Mt.x,Mt.y,!1,je,0,z)}}V&&this.addCurrentVertex(R,se,-Se,-ot,z)}else if(Oe==="butt")this.addCurrentVertex(R,re,0,0,z);else if(Oe==="square"){let Ue=j?1:-1;this.addCurrentVertex(R,re,Ue,Ue,z)}else Oe==="round"&&(j&&(this.addCurrentVertex(R,H,0,0,z),this.addCurrentVertex(R,H,1,1,z,!0)),V&&(this.addCurrentVertex(R,se,-1,-1,z,!0),this.addCurrentVertex(R,se,0,0,z)));if(Fe&&te<I-1){let Ue=R.dist(V);if(Ue>2*L){let Se=R.add(V.sub(R)._mult(L/Ue)._round());this.updateDistance(R,Se),this.addCurrentVertex(Se,se,0,0,z),R=Se}}}}addCurrentVertex(t,i,a,l,d,f=!1){let v=i.y*l-i.x,b=-i.y-i.x*l;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,f,!1,a,d),this.addHalfVertex(t,v,b,f,!0,-l,d),this.distance>Qm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,a,l,d,f))}addHalfVertex({x:t,y:i},a,l,d,f,v,b){let S=.5*(this.lineClips?this.scaledDistance*(Qm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(v===0?0:v<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),b.primitiveLength++),f?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}let ef,tf;Ge("LineBucket",Xp,{omit:["layers","patternFeatures"]});var nf={get paint(){return tf=tf||new an({"line-opacity":new it(pe.paint_line["line-opacity"]),"line-color":new it(pe.paint_line["line-color"]),"line-translate":new Ke(pe.paint_line["line-translate"]),"line-translate-anchor":new Ke(pe.paint_line["line-translate-anchor"]),"line-width":new it(pe.paint_line["line-width"]),"line-gap-width":new it(pe.paint_line["line-gap-width"]),"line-offset":new it(pe.paint_line["line-offset"]),"line-blur":new it(pe.paint_line["line-blur"]),"line-dasharray":new no(pe.paint_line["line-dasharray"]),"line-pattern":new ll(pe.paint_line["line-pattern"]),"line-gradient":new cl(pe.paint_line["line-gradient"])})},get layout(){return ef=ef||new an({"line-cap":new Ke(pe.layout_line["line-cap"]),"line-join":new it(pe.layout_line["line-join"]),"line-miter-limit":new Ke(pe.layout_line["line-miter-limit"]),"line-round-limit":new Ke(pe.layout_line["line-round-limit"]),"line-sort-key":new it(pe.layout_line["line-sort-key"])})}};class p0 extends it{possiblyEvaluate(t,i){return i=new Qt(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,a,l){return i=Dn({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,a,l)}}let vh;class d0 extends Fn{constructor(t){super(t,nf),this.gradientVersion=0,vh||(vh=new p0(nf.paint.properties["line-width"].specification),vh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let i=this.gradientExpression();this.stepInterpolant=!!(function(a){return a._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof di,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=vh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Xp(t)}queryRadius(t){let i=t,a=rf(Zc("line-width",this,i),Zc("line-gap-width",this,i)),l=Zc("line-offset",this,i);return a/2+Math.abs(l)+mh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:l,transform:d,pixelsToTileUnits:f}){let v=fh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,f),b=f/2*rf(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),S=this.paint.get("line-offset").evaluate(i,a);return S&&(l=(function(I,E){let L=[];for(let z=0;z<I.length;z++){let R=I[z],j=[];for(let V=0;V<R.length;V++){let H=R[V-1],se=R[V],te=R[V+1],re=V===0?new C(0,0):se.sub(H)._unit()._perp(),fe=V===R.length-1?new C(0,0):te.sub(se)._unit()._perp(),we=re._add(fe)._unit(),Ee=we.x*fe.x+we.y*fe.y;Ee!==0&&we._mult(1/Ee),j.push(we._mult(E)._add(se))}L.push(j)}return L})(l,S*f)),(function(I,E,L){for(let z=0;z<E.length;z++){let R=E[z];if(I.length>=3){for(let j=0;j<R.length;j++)if(fl(I,R[j]))return!0}if(Sy(I,R,L))return!0}return!1})(v,l,b)}isTileClipped(){return!0}}function rf(n,t){return t>0?t+2*n:n}let m0=mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),f0=mi([{name:"a_projected_pos",components:3,type:"Float32"}],4);mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let g0=mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let of=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_0=mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function y0(n,t,i){return n.sections.forEach(a=>{a.text=(function(l,d,f){let v=d.layout.get("text-transform").evaluate(f,{});return v==="uppercase"?l=l.toLocaleUpperCase():v==="lowercase"&&(l=l.toLocaleLowerCase()),Jn.applyArabicShaping&&(l=Jn.applyArabicShaping(l)),l})(a.text,t,i)}),n}mi([{name:"triangle",components:3,type:"Uint16"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),mi([{type:"Float32",name:"offsetX"}]),mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),mi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let tu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Bi=24;let Kp=4294967296,af=1/Kp,sf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Yp{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,i,a=this.length){for(;this.pos<a;){let l=this.readVarint(),d=l>>3,f=this.pos;this.type=7&l,t(d,i,this),this.pos===f&&this.skip(l)}return i}readMessage(t,i){return this.readFields(t,i,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Kp;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Kp;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let i=this.buf,a,l;return l=i[this.pos++],a=127&l,l<128?a:(l=i[this.pos++],a|=(127&l)<<7,l<128?a:(l=i[this.pos++],a|=(127&l)<<14,l<128?a:(l=i[this.pos++],a|=(127&l)<<21,l<128?a:(l=i[this.pos],a|=(15&l)<<28,(function(d,f,v){let b=v.buf,S,I;if(I=b[v.pos++],S=(112&I)>>4,I<128||(I=b[v.pos++],S|=(127&I)<<3,I<128)||(I=b[v.pos++],S|=(127&I)<<10,I<128)||(I=b[v.pos++],S|=(127&I)<<17,I<128)||(I=b[v.pos++],S|=(127&I)<<24,I<128)||(I=b[v.pos++],S|=(1&I)<<31,I<128))return xl(d,S,f);throw new Error("Expected varint not more than 10 bytes")})(a,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,i=this.pos;return this.pos=t,t-i>=12&&sf?sf.decode(this.buf.subarray(i,t)):(function(a,l,d){let f="",v=l;for(;v<d;){let b=a[v],S,I,E,L=null,z=b>239?4:b>223?3:b>191?2:1;if(v+z>d)break;z===1?b<128&&(L=b):z===2?(S=a[v+1],(192&S)==128&&(L=(31&b)<<6|63&S,L<=127&&(L=null))):z===3?(S=a[v+1],I=a[v+2],(192&S)==128&&(192&I)==128&&(L=(15&b)<<12|(63&S)<<6|63&I,(L<=2047||L>=55296&&L<=57343)&&(L=null))):z===4&&(S=a[v+1],I=a[v+2],E=a[v+3],(192&S)==128&&(192&I)==128&&(192&E)==128&&(L=(15&b)<<18|(63&S)<<12|(63&I)<<6|63&E,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,z=1):L>65535&&(L-=65536,f+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),f+=String.fromCharCode(L),v+=z}return f})(this.buf,i,t)}readBytes(){let t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i}readPackedVarint(t=[],i){let a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readVarint(i));return t}readPackedSVarint(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){let i=7&t;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(t,i){this.writeVarint(t<<3|i)}realloc(t){let i=this.length||16;for(;i<this.pos+t;)i*=2;if(i!==this.length){let a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*af),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*af),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(i,a){let l,d;if(i>=0?(l=i%4294967296|0,d=i/4294967296|0):(l=~(-i%4294967296),d=~(-i/4294967296),4294967295^l?l=l+1|0:(l=0,d=d+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(f,v,b){b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,b.buf[b.pos]=127&(f>>>=7)})(l,0,a),(function(f,v){let b=(7&f)<<4;v.buf[v.pos++]|=b|((f>>>=3)?128:0),f&&(v.buf[v.pos++]=127&f|((f>>>=7)?128:0),f&&(v.buf[v.pos++]=127&f|((f>>>=7)?128:0),f&&(v.buf[v.pos++]=127&f|((f>>>=7)?128:0),f&&(v.buf[v.pos++]=127&f|((f>>>=7)?128:0),f&&(v.buf[v.pos++]=127&f)))))})(d,a)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;let i=this.pos;this.pos=(function(l,d,f){for(let v,b,S=0;S<d.length;S++){if(v=d.charCodeAt(S),v>55295&&v<57344){if(!b){v>56319||S+1===d.length?(l[f++]=239,l[f++]=191,l[f++]=189):b=v;continue}if(v<56320){l[f++]=239,l[f++]=191,l[f++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(l[f++]=239,l[f++]=191,l[f++]=189,b=null);v<128?l[f++]=v:(v<2048?l[f++]=v>>6|192:(v<65536?l[f++]=v>>12|224:(l[f++]=v>>18|240,l[f++]=v>>12&63|128),l[f++]=v>>6&63|128),l[f++]=63&v|128)}return f})(this.buf,t,this.pos);let a=this.pos-i;a>=128&&lf(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let i=t.length;this.writeVarint(i),this.realloc(i);for(let a=0;a<i;a++)this.buf[this.pos++]=t[a]}writeRawMessage(t,i){this.pos++;let a=this.pos;t(i,this);let l=this.pos-a;l>=128&&lf(a,l,this),this.pos=a-1,this.writeVarint(l),this.pos+=l}writeMessage(t,i,a){this.writeTag(t,2),this.writeRawMessage(i,a)}writePackedVarint(t,i){i.length&&this.writeMessage(t,v0,i)}writePackedSVarint(t,i){i.length&&this.writeMessage(t,x0,i)}writePackedBoolean(t,i){i.length&&this.writeMessage(t,T0,i)}writePackedFloat(t,i){i.length&&this.writeMessage(t,b0,i)}writePackedDouble(t,i){i.length&&this.writeMessage(t,w0,i)}writePackedFixed32(t,i){i.length&&this.writeMessage(t,S0,i)}writePackedSFixed32(t,i){i.length&&this.writeMessage(t,I0,i)}writePackedFixed64(t,i){i.length&&this.writeMessage(t,P0,i)}writePackedSFixed64(t,i){i.length&&this.writeMessage(t,C0,i)}writeBytesField(t,i){this.writeTag(t,2),this.writeBytes(i)}writeFixed32Field(t,i){this.writeTag(t,5),this.writeFixed32(i)}writeSFixed32Field(t,i){this.writeTag(t,5),this.writeSFixed32(i)}writeFixed64Field(t,i){this.writeTag(t,1),this.writeFixed64(i)}writeSFixed64Field(t,i){this.writeTag(t,1),this.writeSFixed64(i)}writeVarintField(t,i){this.writeTag(t,0),this.writeVarint(i)}writeSVarintField(t,i){this.writeTag(t,0),this.writeSVarint(i)}writeStringField(t,i){this.writeTag(t,2),this.writeString(i)}writeFloatField(t,i){this.writeTag(t,5),this.writeFloat(i)}writeDoubleField(t,i){this.writeTag(t,1),this.writeDouble(i)}writeBooleanField(t,i){this.writeVarintField(t,+i)}}function xl(n,t,i){return i?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function lf(n,t,i){let a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(a);for(let l=i.pos-1;l>=n;l--)i.buf[l+a]=i.buf[l]}function v0(n,t){for(let i=0;i<n.length;i++)t.writeVarint(n[i])}function x0(n,t){for(let i=0;i<n.length;i++)t.writeSVarint(n[i])}function b0(n,t){for(let i=0;i<n.length;i++)t.writeFloat(n[i])}function w0(n,t){for(let i=0;i<n.length;i++)t.writeDouble(n[i])}function T0(n,t){for(let i=0;i<n.length;i++)t.writeBoolean(n[i])}function S0(n,t){for(let i=0;i<n.length;i++)t.writeFixed32(n[i])}function I0(n,t){for(let i=0;i<n.length;i++)t.writeSFixed32(n[i])}function P0(n,t){for(let i=0;i<n.length;i++)t.writeFixed64(n[i])}function C0(n,t){for(let i=0;i<n.length;i++)t.writeSFixed64(n[i])}function M0(n,t,i){n===1&&i.readMessage(E0,t)}function E0(n,t,i){if(n===3){let{id:a,bitmap:l,width:d,height:f,left:v,top:b,advance:S}=i.readMessage(A0,{});t.push({id:a,bitmap:new qc({width:d+6,height:f+6},l),metrics:{width:d,height:f,left:v,top:b,advance:S}})}}function A0(n,t,i){n===1?t.id=i.readVarint():n===2?t.bitmap=i.readBytes():n===3?t.width=i.readVarint():n===4?t.height=i.readVarint():n===5?t.left=i.readSVarint():n===6?t.top=i.readSVarint():n===7&&(t.advance=i.readVarint())}function cf(n){let t=0,i=0;for(let f of n)t+=f.w*f.h,i=Math.max(i,f.w);n.sort((f,v)=>v.h-f.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}],l=0,d=0;for(let f of n)for(let v=a.length-1;v>=0;v--){let b=a[v];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===b.w&&f.h===b.h){let S=a.pop();S&&v<a.length&&(a[v]=S)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(a.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:l,h:d,fill:t/(l*d)||0}}class Jp{constructor(t,{pixelRatio:i,version:a,stretchX:l,stretchY:d,content:f,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=l,this.stretchY=d,this.content=f,this.version=a,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class uf{constructor(t,i){let a={},l={};this.haveRenderCallbacks=[];let d=[];this.addImages(t,a,d),this.addImages(i,l,d);let{w:f,h:v}=cf(d),b=new Cn({width:f||1,height:v||1});for(let S in t){let I=t[S],E=a[S].paddedRect;Cn.copy(I.data,b,{x:0,y:0},{x:E.x+1,y:E.y+1},I.data)}for(let S in i){let I=i[S],E=l[S].paddedRect,L=E.x+1,z=E.y+1,R=I.data.width,j=I.data.height;Cn.copy(I.data,b,{x:0,y:0},{x:L,y:z},I.data),Cn.copy(I.data,b,{x:0,y:j-1},{x:L,y:z-1},{width:R,height:1}),Cn.copy(I.data,b,{x:0,y:0},{x:L,y:z+j},{width:R,height:1}),Cn.copy(I.data,b,{x:R-1,y:0},{x:L-1,y:z},{width:1,height:j}),Cn.copy(I.data,b,{x:0,y:0},{x:L+R,y:z},{width:1,height:j})}this.image=b,this.iconPositions=a,this.patternPositions=l}addImages(t,i,a){for(let l in t){let d=t[l],f={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(f),i[l]=new Jp(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;let[l,d]=t.tl;a.update(i.data,void 0,{x:l,y:d})}}var Sa;Ge("ImagePosition",Jp),Ge("ImageAtlas",uf),_.ao=void 0,(Sa=_.ao||(_.ao={}))[Sa.none=0]="none",Sa[Sa.horizontal=1]="horizontal",Sa[Sa.vertical=2]="vertical",Sa[Sa.horizontalOnly=3]="horizontalOnly";class iu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,i,a){let l=new iu;return l.scale=t||1,l.fontStack=i,l.verticalAlign=a||"bottom",l}static forImage(t,i){let a=new iu;return a.imageName=t,a.verticalAlign=i||"bottom",a}}class bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){let a=new bl;for(let l=0;l<t.sections.length;l++){let d=t.sections[l];d.image?a.addImageSection(d):a.addTextSection(d,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let i="";for(let a=0;a<t.length;a++){let l=t.charCodeAt(a+1)||null,d=t.charCodeAt(a-1)||null;i+=l&&oh(l)&&!tu[t[a+1]]||d&&oh(d)&&!tu[t[a-1]]||!tu[t[a]]?t[a]:tu[t[a]]}return i})(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&bh[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&bh[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){let a=new bl;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}getMaxImageSize(t){let i=0,a=0;for(let l=0;l<this.length();l++){let d=this.getSection(l);if(d.imageName){let f=t[d.imageName];if(!f)continue;let v=f.displaySize;i=Math.max(i,v[0]),a=Math.max(a,v[1])}}return{maxImageWidth:i,maxImageHeight:a}}addTextSection(t,i){this.text+=t.text,this.sections.push(iu.forText(t.scale,t.fontStack||i,t.verticalAlign));let a=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(a)}addImageSection(t){let i=t.image?t.image.name:"";if(i.length===0)return void fi("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(iu.forImage(i,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):fi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xh(n,t,i,a,l,d,f,v,b,S,I,E,L,z,R){let j=bl.fromFeature(n,l),V;E===_.ao.vertical&&j.verticalizePunctuation();let{processBidirectionalText:H,processStyledBidirectionalText:se}=Jn;if(H&&j.sections.length===1){V=[];let fe=H(j.toString(),Qp(j,S,d,t,a,z));for(let we of fe){let Ee=new bl;Ee.text=we,Ee.sections=j.sections;for(let Ne=0;Ne<we.length;Ne++)Ee.sectionIndex.push(0);V.push(Ee)}}else if(se){V=[];let fe=se(j.text,j.sectionIndex,Qp(j,S,d,t,a,z));for(let we of fe){let Ee=new bl;Ee.text=we[0],Ee.sectionIndex=we[1],Ee.sections=j.sections,V.push(Ee)}}else V=(function(fe,we){let Ee=[],Ne=fe.text,Fe=0;for(let je of we)Ee.push(fe.substring(Fe,je)),Fe=je;return Fe<Ne.length&&Ee.push(fe.substring(Fe,Ne.length)),Ee})(j,Qp(j,S,d,t,a,z));let te=[],re={positionedLines:te,text:j.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:E,iconsInText:!1,verticalizable:!1};return(function(fe,we,Ee,Ne,Fe,je,Ye,Oe,Ue,Se,ot,at){let et=0,He=0,Mt=0,ui=0,Ai=Oe==="right"?1:Oe==="left"?0:.5,en=Bi/at,nr=0;for(let ri of Fe){ri.trim();let Oi=ri.getMaxScale(),Wi={positionedGlyphs:[],lineOffset:0};fe.positionedLines[nr]=Wi;let Hi=Wi.positionedGlyphs,xn=0;if(!ri.length()){He+=je,++nr;continue}let rr=z0(Ne,ri,en);for(let En=0;En<ri.length();En++){let ki=ri.getSection(En),Ui=ri.getSectionIndex(En),Ni=ri.getCharCode(En),Si=R0(Ue,ot,Ni),ti;if(ki.imageName){if(fe.iconsInText=!0,ki.scale=ki.scale*en,ti=B0(ki,Si,Oi,rr,Ne),!ti)continue;xn=Math.max(xn,ti.imageOffset)}else if(ti=F0(ki,Ni,Si,rr,we,Ee),!ti)continue;let{rect:zr,metrics:Il,baselineOffset:Rr}=ti;Hi.push({glyph:Ni,imageName:ki.imageName,x:et,y:He+Rr+-17,vertical:Si,scale:ki.scale,fontStack:ki.fontStack,sectionIndex:Ui,metrics:Il,rect:zr}),Si?(fe.verticalizable=!0,et+=(ki.imageName?Il.advance:Bi)*ki.scale+Se):et+=Il.advance*ki.scale+Se}Hi.length!==0&&(Mt=Math.max(et-Se,Mt),O0(Hi,0,Hi.length-1,Ai)),et=0,Wi.lineOffset=Math.max(xn,(Oi-1)*Bi);let ji=je*Oi+xn;He+=ji,ui=Math.max(ji,ui),++nr}let{horizontalAlign:Mn,verticalAlign:qi}=ed(Ye);(function(ri,Oi,Wi,Hi,xn,rr,ji,En,ki){let Ui=(Oi-Wi)*xn,Ni=0;Ni=rr!==ji?-En*Hi- -17:-Hi*ki*ji+.5*ji;for(let Si of ri)for(let ti of Si.positionedGlyphs)ti.x+=Ui,ti.y+=Ni})(fe.positionedLines,Ai,Mn,qi,Mt,ui,je,He,Fe.length),fe.top+=-qi*He,fe.bottom=fe.top+He,fe.left+=-Mn*Mt,fe.right=fe.left+Mt})(re,t,i,a,V,f,v,b,E,S,L,R),!(function(fe){for(let we of fe)if(we.positionedGlyphs.length!==0)return!1;return!0})(te)&&re}let bh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},k0={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},L0={40:!0};function hf(n,t,i,a,l,d){if(t.imageName){let f=a[t.imageName];return f?f.displaySize[0]*t.scale*Bi/d+l:0}{let f=i[t.fontStack],v=f&&f[n];return v?v.metrics.advance*t.scale+l:0}}function pf(n,t,i,a){let l=Math.pow(n-t,2);return a?n<t?l/2:2*l:l+Math.abs(i)*i}function D0(n,t,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function df(n,t,i,a,l,d){let f=null,v=pf(t,i,l,d);for(let b of a){let S=pf(t-b.x,i,l,d)+b.badness;S<=v&&(f=b,v=S)}return{index:n,x:t,priorBreak:f,badness:v}}function mf(n){return n?mf(n.priorBreak).concat(n.index):[]}function Qp(n,t,i,a,l,d){if(!n)return[];let f=[],v=(function(E,L,z,R,j,V){let H=0;for(let se=0;se<E.length();se++){let te=E.getSection(se);H+=hf(E.getCharCode(se),te,R,j,L,V)}return H/Math.max(1,Math.ceil(H/z))})(n,t,i,a,l,d),b=n.text.indexOf("\u200B")>=0,S=0;for(let E=0;E<n.length();E++){let L=n.getSection(E),z=n.getCharCode(E);if(bh[z]||(S+=hf(z,L,a,l,t,d)),E<n.length()-1){let R=!((I=z)<11904)&&(!!Ct["CJK Compatibility Forms"](I)||!!Ct["CJK Compatibility"](I)||!!Ct["CJK Strokes"](I)||!!Ct["CJK Symbols and Punctuation"](I)||!!Ct["Enclosed CJK Letters and Months"](I)||!!Ct["Halfwidth and Fullwidth Forms"](I)||!!Ct["Ideographic Description Characters"](I)||!!Ct["Vertical Forms"](I)||zc.test(String.fromCodePoint(I)));(k0[z]||R||L.imageName||E!==n.length()-2&&L0[n.getCharCode(E+1)])&&f.push(df(E+1,S,v,f,D0(z,n.getCharCode(E+1),R&&b),!1))}}var I;return mf(df(n.length(),S,v,f,0,!0))}function ed(n){let t=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function z0(n,t,i){let a=t.getMaxScale()*Bi,{maxImageWidth:l,maxImageHeight:d}=t.getMaxImageSize(n),f=Math.max(a,d*i);return{verticalLineContentWidth:Math.max(a,l*i),horizontalLineContentHeight:f}}function ff(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function R0(n,t,i){return!(n===_.ao.horizontal||!t&&!Rc(i)||t&&(bh[i]||(a=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(a)))));var a}function F0(n,t,i,a,l,d){let f=d[n.fontStack],v=(function(S,I,E,L){if(S&&S.rect)return S;let z=I[E.fontStack],R=z&&z[L];return R?{rect:null,metrics:R.metrics}:null})(f&&f[t],l,n,t);if(v===null)return null;let b;if(i)b=a.verticalLineContentWidth-n.scale*Bi;else{let S=ff(n.verticalAlign);b=(a.horizontalLineContentHeight-n.scale*Bi)*S}return{rect:v.rect,metrics:v.metrics,baselineOffset:b}}function B0(n,t,i,a,l){let d=l[n.imageName];if(!d)return null;let f=d.paddedRect,v=d.displaySize,b={width:v[0],height:v[1],left:1,top:-3,advance:t?v[1]:v[0]},S;if(t)S=a.verticalLineContentWidth-v[1]*n.scale;else{let I=ff(n.verticalAlign);S=(a.horizontalLineContentHeight-v[1]*n.scale)*I}return{rect:f,metrics:b,baselineOffset:S,imageOffset:(t?v[0]:v[1])*n.scale-Bi*i}}function O0(n,t,i,a){if(a===0)return;let l=n[i],d=(n[i].x+l.metrics.advance*l.scale)*a;for(let f=t;f<=i;f++)n[f].x-=d}function j0(n,t,i){let{horizontalAlign:a,verticalAlign:l}=ed(i),d=t[0]-n.displaySize[0]*a,f=t[1]-n.displaySize[1]*l;return{image:n,top:f,bottom:f+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function gf(n){var t,i;let a=n.left,l=n.top,d=n.right-a,f=n.bottom-l,v=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",S=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&d/f<S||v==="proportional"){let I=Math.ceil(f*S);a*=I/d,d=I}}else if(v==="proportional"&&b==="stretchOnly"&&S!==0&&d/f>S){let I=Math.ceil(d/S);l*=I/f,f=I}return{x1:a,y1:l,x2:a+d,y2:l+f}}function _f(n,t,i,a,l,d){let f=n.image,v;if(f.content){let V=f.content,H=f.pixelRatio||1;v=[V[0]/H,V[1]/H,f.displaySize[0]-V[2]/H,f.displaySize[1]-V[3]/H]}let b=t.left*d,S=t.right*d,I,E,L,z;i==="width"||i==="both"?(z=l[0]+b-a[3],E=l[0]+S+a[1]):(z=l[0]+(b+S-f.displaySize[0])/2,E=z+f.displaySize[0]);let R=t.top*d,j=t.bottom*d;return i==="height"||i==="both"?(I=l[1]+R-a[0],L=l[1]+j+a[2]):(I=l[1]+(R+j-f.displaySize[1])/2,L=I+f.displaySize[1]),{image:f,top:I,right:E,bottom:L,left:z,collisionPadding:v}}let jo=128,Ia=32640;function yf(n,t){let{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Qt(n+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:l}=i,d=0;for(;d<a.length&&a[d]<=n;)d++;d=Math.max(0,d-1);let f=d;for(;f<a.length&&a[f]<n+1;)f++;f=Math.min(a.length-1,f);let v=a[d],b=a[f];return i.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:l}:{kind:"camera",minZoom:v,maxZoom:b,minSize:i.evaluate(new Qt(v)),maxSize:i.evaluate(new Qt(b)),interpolationType:l}}}function td(n,t,i){let a="never",l=n.get(t);return l?a=l:n.get(i)&&(a="always"),a}let U0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wh(n,t,i,a,l,d,f,v,b,S,I,E,L){let z=v?Math.min(Ia,Math.round(v[0])):0,R=v?Math.min(Ia,Math.round(v[1])):0;n.emplaceBack(t,i,Math.round(32*a),Math.round(32*l),d,f,(z<<1)+(b?1:0),R,16*S,16*I,256*E,256*L)}function id(n,t,i){n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i)}function N0(n){for(let t of n.sections)if(lh(t.text))return!0;return!1}class nd{constructor(t){this.layoutVertexArray=new Be,this.indexArray=new Vt,this.programConfigurations=t,this.segments=new dt,this.dynamicLayoutVertexArray=new Me,this.opacityVertexArray=new We,this.hasVisibleVertices=!1,this.placedSymbolArray=new F}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,m0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,f0.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,U0,!0),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ge("SymbolBuffers",nd);class rd{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new dt,this.collisionVertexArray=new Bt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,g0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ge("CollisionBuffers",rd);class wl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yf(this.zoom,i["text-size"]),this.iconSizeData=yf(this.zoom,i["icon-size"]);let a=this.layers[0].layout,l=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=td(a,"text-overlap","text-allow-overlap")!=="never"||td(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(f=>_.ao[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID}createArrays(){this.text=new nd(new Pn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new nd(new Pn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new W,this.lineVertexArray=new X,this.symbolInstances=new G,this.textAnchorOffsets=new K}calculateGlyphDependencies(t,i,a,l,d){for(let f=0;f<t.length;f++)if(i[t.charCodeAt(f)]=!0,(a||l)&&d){let v=tu[t.charAt(f)];v&&(i[v.charCodeAt(0)]=!0)}}populate(t,i,a){let l=this.layers[0],d=l.layout,f=d.get("text-font"),v=d.get("text-field"),b=d.get("icon-image"),S=(v.value.kind!=="constant"||v.value.value instanceof nn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,E=d.get("symbol-sort-key");if(this.features=[],!S&&!I)return;let L=i.iconDependencies,z=i.glyphDependencies,R=i.availableImages,j=new Qt(this.zoom,{globalState:this.globalState});for(let{feature:V,id:H,index:se,sourceLayerIndex:te}of t){let re=l._featureFilter.needGeometry,fe=Dr(V,re);if(!l._featureFilter.filter(j,fe,a))continue;let we,Ee;if(re||(fe.geometry=lo(V)),S){let Fe=l.getValueAndResolveTokens("text-field",fe,a,R),je=nn.factory(Fe),Ye=this.hasRTLText=this.hasRTLText||N0(je);(!Ye||Jn.getRTLTextPluginStatus()==="unavailable"||Ye&&Jn.isParsed())&&(we=y0(je,l,fe))}if(I){let Fe=l.getValueAndResolveTokens("icon-image",fe,a,R);Ee=Fe instanceof Sn?Fe:Sn.fromString(Fe)}if(!we&&!Ee)continue;let Ne=this.sortFeaturesByKey?E.evaluate(fe,{},a):void 0;if(this.features.push({id:H,text:we,icon:Ee,index:se,sourceLayerIndex:te,geometry:fe.geometry,properties:V.properties,type:vl.types[V.type],sortKey:Ne}),Ee&&(L[Ee.name]=!0),we){let Fe=f.evaluate(fe,{},a).join(","),je=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.ao.vertical)>=0;for(let Ye of we.sections)if(Ye.image)L[Ye.image.name]=!0;else{let Oe=ol(we.toString()),Ue=Ye.fontStack||Fe,Se=z[Ue]=z[Ue]||{};this.calculateGlyphDependencies(Ye.text,Se,je,this.allowVerticalPlacement,Oe)}}}d.get("symbol-placement")==="line"&&(this.features=(function(V){let H={},se={},te=[],re=0;function fe(Fe){te.push(V[Fe]),re++}function we(Fe,je,Ye){let Oe=se[Fe];return delete se[Fe],se[je]=Oe,te[Oe].geometry[0].pop(),te[Oe].geometry[0]=te[Oe].geometry[0].concat(Ye[0]),Oe}function Ee(Fe,je,Ye){let Oe=H[je];return delete H[je],H[Fe]=Oe,te[Oe].geometry[0].shift(),te[Oe].geometry[0]=Ye[0].concat(te[Oe].geometry[0]),Oe}function Ne(Fe,je,Ye){let Oe=Ye?je[0][je[0].length-1]:je[0][0];return`${Fe}:${Oe.x}:${Oe.y}`}for(let Fe=0;Fe<V.length;Fe++){let je=V[Fe],Ye=je.geometry,Oe=je.text?je.text.toString():null;if(!Oe){fe(Fe);continue}let Ue=Ne(Oe,Ye),Se=Ne(Oe,Ye,!0);if(Ue in se&&Se in H&&se[Ue]!==H[Se]){let ot=Ee(Ue,Se,Ye),at=we(Ue,Se,te[ot].geometry);delete H[Ue],delete se[Se],se[Ne(Oe,te[at].geometry,!0)]=at,te[ot].geometry=null}else Ue in se?we(Ue,Se,Ye):Se in H?Ee(Ue,Se,Ye):(fe(Fe),H[Ue]=re-1,se[Se]=re-1)}return te.filter(Fe=>Fe.geometry)})(this.features)),this.sortFeaturesByKey&&this.features.sort((V,H)=>V.sortKey-H.sortKey)}update(t,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){let a=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(i[t.segment+1]),d=t.dist(i[t.segment]),f={};for(let v=t.segment+1;v<i.length;v++)f[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:l},v<i.length-1&&(l+=i[v+1].dist(i[v]));for(let v=t.segment||0;v>=0;v--)f[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:d},v>0&&(d+=i[v-1].dist(i[v]));for(let v=0;v<i.length;v++){let b=f[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,l,d,f,v,b,S,I,E,L){let z=t.indexArray,R=t.layoutVertexArray,j=t.segments.prepareSegment(4*i.length,R,z,this.canOverlap?f.sortKey:void 0),V=this.glyphOffsetArray.length,H=j.vertexLength,se=this.allowVerticalPlacement&&v===_.ao.vertical?Math.PI/2:0,te=f.text&&f.text.sections;for(let re=0;re<i.length;re++){let{tl:fe,tr:we,bl:Ee,br:Ne,tex:Fe,pixelOffsetTL:je,pixelOffsetBR:Ye,minFontScaleX:Oe,minFontScaleY:Ue,glyphOffset:Se,isSDF:ot,sectionIndex:at}=i[re],et=j.vertexLength,He=Se[1];wh(R,b.x,b.y,fe.x,He+fe.y,Fe.x,Fe.y,a,ot,je.x,je.y,Oe,Ue),wh(R,b.x,b.y,we.x,He+we.y,Fe.x+Fe.w,Fe.y,a,ot,Ye.x,je.y,Oe,Ue),wh(R,b.x,b.y,Ee.x,He+Ee.y,Fe.x,Fe.y+Fe.h,a,ot,je.x,Ye.y,Oe,Ue),wh(R,b.x,b.y,Ne.x,He+Ne.y,Fe.x+Fe.w,Fe.y+Fe.h,a,ot,Ye.x,Ye.y,Oe,Ue),id(t.dynamicLayoutVertexArray,b,se),z.emplaceBack(et,et+2,et+1),z.emplaceBack(et+1,et+2,et+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Se[0]),re!==i.length-1&&at===i[re+1].sectionIndex||t.programConfigurations.populatePaintArrays(R.length,f,f.index,{},L,te&&te[at])}t.placedSymbolArray.emplaceBack(b.x,b.y,V,this.glyphOffsetArray.length-V,H,S,I,b.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],v,0,!1,0,E)}_addCollisionDebugVertex(t,i,a,l,d,f){return i.emplaceBack(0,0),t.emplaceBack(a.x,a.y,l,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,i,a,l,d,f,v){let b=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),S=b.vertexLength,I=d.layoutVertexArray,E=d.collisionVertexArray,L=v.anchorX,z=v.anchorY;this._addCollisionDebugVertex(I,E,f,L,z,new C(t,i)),this._addCollisionDebugVertex(I,E,f,L,z,new C(a,i)),this._addCollisionDebugVertex(I,E,f,L,z,new C(a,l)),this._addCollisionDebugVertex(I,E,f,L,z,new C(t,l)),b.vertexLength+=4;let R=d.indexArray;R.emplaceBack(S,S+1),R.emplaceBack(S+1,S+2),R.emplaceBack(S+2,S+3),R.emplaceBack(S+3,S),b.primitiveLength+=4}addDebugCollisionBoxes(t,i,a,l){for(let d=t;d<i;d++){let f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,l?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rd(gt,of.members,jt),this.iconCollisionBox=new rd(gt,of.members,jt);for(let t=0;t<this.symbolInstances.length;t++){let i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,a,l,d,f,v,b,S){let I={};for(let E=i;E<a;E++){let L=t.get(E);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let E=l;E<d;E++){let L=t.get(E);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let E=f;E<v;E++){let L=t.get(E);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let E=b;E<S;E++){let L=t.get(E);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){let a=t.placedSymbolArray.get(i),l=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<l;d+=4)t.indexArray.emplaceBack(d,d+2,d+1),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(t),a=Math.cos(t),l=[],d=[],f=[];for(let v=0;v<this.symbolInstances.length;++v){f.push(v);let b=this.symbolInstances.get(v);l.push(0|Math.round(i*b.anchorX+a*b.anchorY)),d.push(b.featureIndex)}return f.sort((v,b)=>l[v]-l[b]||d[b]-d[v]),f}addToSortKeyRanges(t,i){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((l,d,f)=>{l>=0&&f.indexOf(l)===d&&this.addIndicesForPlacedSymbol(this.text,l)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vf,xf;Ge("SymbolBucket",wl,{omit:["layers","collisionBoxArray","features","compareText"]}),wl.MAX_GLYPHS=65535,wl.addDynamicAttributes=id;var od={get paint(){return xf=xf||new an({"icon-opacity":new it(pe.paint_symbol["icon-opacity"]),"icon-color":new it(pe.paint_symbol["icon-color"]),"icon-halo-color":new it(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new it(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new it(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new it(pe.paint_symbol["text-opacity"]),"text-color":new it(pe.paint_symbol["text-color"],{runtimeType:Gi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new it(pe.paint_symbol["text-halo-color"]),"text-halo-width":new it(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new it(pe.paint_symbol["text-halo-blur"]),"text-translate":new Ke(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(pe.paint_symbol["text-translate-anchor"])})},get layout(){return vf=vf||new an({"symbol-placement":new Ke(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new it(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ke(pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ke(pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ke(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new it(pe.layout_symbol["icon-size"]),"icon-text-fit":new Ke(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ke(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new it(pe.layout_symbol["icon-image"]),"icon-rotate":new it(pe.layout_symbol["icon-rotate"]),"icon-padding":new it(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new it(pe.layout_symbol["icon-offset"]),"icon-anchor":new it(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(pe.layout_symbol["text-rotation-alignment"]),"text-field":new it(pe.layout_symbol["text-field"]),"text-font":new it(pe.layout_symbol["text-font"]),"text-size":new it(pe.layout_symbol["text-size"]),"text-max-width":new it(pe.layout_symbol["text-max-width"]),"text-line-height":new Ke(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new it(pe.layout_symbol["text-letter-spacing"]),"text-justify":new it(pe.layout_symbol["text-justify"]),"text-radial-offset":new it(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new it(pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new it(pe.layout_symbol["text-anchor"]),"text-max-angle":new Ke(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(pe.layout_symbol["text-writing-mode"]),"text-rotate":new it(pe.layout_symbol["text-rotate"]),"text-padding":new Ke(pe.layout_symbol["text-padding"]),"text-keep-upright":new Ke(pe.layout_symbol["text-keep-upright"]),"text-transform":new it(pe.layout_symbol["text-transform"]),"text-offset":new it(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(pe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ke(pe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ke(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(pe.layout_symbol["text-optional"])})}};class bf{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Qo,this.defaultValue=t}evaluate(t){if(t.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge("FormatSectionOverride",bf,{omit:["defaultValue"]});class Th extends Fn{constructor(t){super(t,od)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let a=this.layout.get("text-writing-mode");if(a){let l=[];for(let d of a)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,l){let d=this.layout.get(t).evaluate(i,{},a,l),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||Ys(f.value)||!d?d:(function(v,b){return b.replace(/{([^{}]+)}/g,(S,I)=>v&&I in v?String(v[I]):"")})(i.properties,d)}createBucket(t){return new wl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of od.paint.overridableProperties){if(!Th.hasPaintOverride(this.layout,t))continue;let i=this.paint.get(t),a=new bf(i),l=new wc(a,i.property.specification),d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new is("source",l):new Tc("composite",l,i.value.zoomStops),this.paint._values[t]=new yr(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Th.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){let a=t.get("text-field"),l=od.paint.properties[i],d=!1,f=v=>{for(let b of v)if(l.overrides&&l.overrides.hasOverride(b))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof nn)f(a.value.value.sections);else if(a.value.kind==="source"){let v=S=>{d||(S instanceof Er&&rt(S.value)===Yr?f(S.value.sections):S instanceof Io?f(S.sections):S.eachChild(v))},b=a.value;b._styleExpression&&v(b._styleExpression.expression)}return d}}let wf;var V0={get paint(){return wf=wf||new an({"background-color":new Ke(pe.paint_background["background-color"]),"background-pattern":new no(pe.paint_background["background-pattern"]),"background-opacity":new Ke(pe.paint_background["background-opacity"])})}};class $0 extends Fn{constructor(t){super(t,V0)}}let Tf;var G0={get paint(){return Tf=Tf||new an({"raster-opacity":new Ke(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ke(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(pe.paint_raster["raster-saturation"]),"raster-contrast":new Ke(pe.paint_raster["raster-contrast"]),"raster-resampling":new Ke(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(pe.paint_raster["raster-fade-duration"])})}};class Z0 extends Fn{constructor(t){super(t,G0)}}class q0 extends Fn{constructor(t){super(t,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class W0{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let H0={once:!0},ad=63710088e-1;class Pa{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pa(Ho(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let i=Math.PI/180,a=this.lat*i,l=t.lat*i,d=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((t.lng-this.lng)*i);return ad*Math.acos(Math.min(d,1))}static convert(t){if(t instanceof Pa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Pa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Pa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let Sf=2*Math.PI*ad;function If(n){return Sf*Math.cos(n*Math.PI/180)}function Pf(n){return(180+n)/360}function Cf(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Mf(n,t){return n/If(t)}function sd(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Ef(n,t){return n*If(sd(t))}class nu{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){let a=Pa.convert(t);return new nu(Pf(a.lng),Cf(a.lat),Mf(i,a.lat))}toLngLat(){return new Pa(360*this.x-180,sd(this.y))}toAltitude(){return Ef(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Sf*(t=sd(this.y),1/Math.cos(t*Math.PI/180));var t}}function Af(n,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class ld{constructor(t,i,a){if(!(function(l,d,f){return!(l<0||l>25||f<0||f>=Math.pow(2,l)||d<0||d>=Math.pow(2,l))})(t,i,a))throw new Error(`x=${i}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=a,this.key=Tl(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,a){let l=(f=this.y,v=this.z,b=Af(256*(d=this.x),256*(f=Math.pow(2,v)-f-1),v),S=Af(256*(d+1),256*(f+1),v),b[0]+","+b[1]+","+S[0]+","+S[1]);var d,f,v,b,S;let I=(function(E,L,z){let R,j="";for(let V=E;V>0;V--)R=1<<V-1,j+=(L&R?1:0)+(z&R?2:0);return j})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){let i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){let i=Math.pow(2,this.z);return new C((t.x*i-this.x)*Ot,(t.y*i-this.y)*Ot)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kf{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Tl(t,i.z,i.z,i.x,i.y)}}class ir{constructor(t,i,a,l,d){if(this.terrainRttPosMatrix32f=null,t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=i,this.canonical=new ld(a,+l,+d),this.key=Tl(i,t,a,l,d)}clone(){return new ir(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let i=this.canonical.z-t;return t>this.canonical.z?new ir(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ir(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let a=this.canonical.z-t;return t>this.canonical.z?Tl(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):Tl(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new ir(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new ir(i,this.wrap,i,a,l),new ir(i,this.wrap,i,a+1,l),new ir(i,this.wrap,i,a,l+1),new ir(i,this.wrap,i,a+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ir(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ir(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new nu(t.x-this.wrap,t.y))}}function Tl(n,t,i,a,l){(n*=2)<0&&(n=-1*n-1);let d=1<<i;return(d*d*n+d*l+a).toString(36)+i.toString(36)+t.toString(36)}function ru(n,t){return t?n.properties[t]:n.id}Ge("CanonicalTileID",ld),Ge("OverscaledTileID",ir,{omit:["terrainRttPosMatrix32f"]});class fs{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){let i=new fs;return i.extend(t(new C(this.minX,this.minY))),i.extend(t(new C(this.maxX,this.minY))),i.extend(t(new C(this.minX,this.maxY))),i.extend(t(new C(this.maxX,this.maxY))),i}static fromPoints(t){let i=new fs;for(let a of t)i.extend(a);return i}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Lf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){let a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Df{constructor(t,i,a,l,d){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=a,t._y=l,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class zf{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new cs(Ot,16,0),this.grid3D=new cs(Ot,16,0),this.featureIndexArray=new oe,this.promoteId=i}insert(t,i,a,l,d,f){let v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,d);let b=f?this.grid3D:this.grid;for(let S=0;S<i.length;S++){let I=i[S],E=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){let z=I[L];E[0]=Math.min(E[0],z.x),E[1]=Math.min(E[1],z.y),E[2]=Math.max(E[2],z.x),E[3]=Math.max(E[3],z.y)}E[0]<Ot&&E[1]<Ot&&E[2]>=0&&E[3]>=0&&b.insert(v,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Xm(new Yp(this.rawTileData)).layers,this.sourceLayerCoder=new Lf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,a,l){this.loadVTLayers();let d=t.params,f=Ot/t.tileSize/t.scale,v=ko(d.filter),b=t.queryGeometry,S=t.queryPadding*f,I=fs.fromPoints(b),E=this.grid.query(I.minX-S,I.minY-S,I.maxX+S,I.maxY+S),L=fs.fromPoints(t.cameraQueryGeometry).expandBy(S),z=this.grid3D.query(L.minX,L.minY,L.maxX,L.maxY,(V,H,se,te)=>(function(re,fe,we,Ee,Ne){for(let je of re)if(fe<=je.x&&we<=je.y&&Ee>=je.x&&Ne>=je.y)return!0;let Fe=[new C(fe,we),new C(fe,Ne),new C(Ee,Ne),new C(Ee,we)];if(re.length>2){for(let je of Fe)if(fl(re,je))return!0}for(let je=0;je<re.length-1;je++)if(Py(re[je],re[je+1],Fe))return!0;return!1})(t.cameraQueryGeometry,V-S,H-S,se+S,te+S));for(let V of z)E.push(V);E.sort(X0);let R={},j;for(let V=0;V<E.length;V++){let H=E[V];if(H===j)continue;j=H;let se=this.featureIndexArray.get(H),te=null;this.loadMatchingFeature(R,se.bucketIndex,se.sourceLayerIndex,se.featureIndex,v,d.layers,d.availableImages,i,a,l,(re,fe,we)=>(te||(te=lo(re)),fe.queryIntersectsFeature({queryGeometry:b,feature:re,featureState:we,geometry:te,zoom:this.z,transform:t.transform,pixelsToTileUnits:f,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return R}loadMatchingFeature(t,i,a,l,d,f,v,b,S,I,E){let L=this.bucketLayerIDs[i];if(f&&!L.some(V=>f.has(V)))return;let z=this.sourceLayerCoder.decode(a),R=this.vtLayers[z].feature(l);if(d.needGeometry){let V=Dr(R,!0);if(!d.filter(new Qt(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!d.filter(new Qt(this.tileID.overscaledZ),R))return;let j=this.getId(R,z);for(let V=0;V<L.length;V++){let H=L[V];if(f&&!f.has(H))continue;let se=b[H];if(!se)continue;let te={};j&&I&&(te=I.getState(se.sourceLayer||"_geojsonTileLayer",j));let re=Dn({},S[H]);re.paint=Rf(re.paint,se.paint,R,te,v),re.layout=Rf(re.layout,se.layout,R,te,v);let fe=!E||E(R,se,te);if(!fe)continue;let we=new Df(R,this.z,this.x,this.y,j);we.layer=re;let Ee=t[H];Ee===void 0&&(Ee=t[H]=[]),Ee.push({featureIndex:l,feature:we,intersectionZ:fe})}}lookupSymbolFeatures(t,i,a,l,d,f,v,b){let S={};this.loadVTLayers();let I=ko(d);for(let E of t)this.loadMatchingFeature(S,a,l,E,I,f,v,b,i);return S}hasLayer(t){for(let i of this.bucketLayerIDs)for(let a of i)if(t===a)return!0;return!1}getId(t,i){var a;let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&(!((a=t.properties)===null||a===void 0)&&a.cluster)&&this.promoteId&&(l=Number(t.properties.cluster_id))),l}}function Rf(n,t,i,a,l){return Xo(n,(d,f)=>{let v=t instanceof sl?t.get(f):null;return v&&v.evaluate?v.evaluate(i,a,l):v})}function X0(n,t){return t-n}function Ff(n,t,i,a,l){let d=[];for(let f=0;f<n.length;f++){let v=n[f],b;for(let S=0;S<v.length-1;S++){let I=v[S],E=v[S+1];I.x<t&&E.x<t||(I.x<t?I=new C(t,I.y+(t-I.x)/(E.x-I.x)*(E.y-I.y))._round():E.x<t&&(E=new C(t,I.y+(t-I.x)/(E.x-I.x)*(E.y-I.y))._round()),I.y<i&&E.y<i||(I.y<i?I=new C(I.x+(i-I.y)/(E.y-I.y)*(E.x-I.x),i)._round():E.y<i&&(E=new C(I.x+(i-I.y)/(E.y-I.y)*(E.x-I.x),i)._round()),I.x>=a&&E.x>=a||(I.x>=a?I=new C(a,I.y+(a-I.x)/(E.x-I.x)*(E.y-I.y))._round():E.x>=a&&(E=new C(a,I.y+(a-I.x)/(E.x-I.x)*(E.y-I.y))._round()),I.y>=l&&E.y>=l||(I.y>=l?I=new C(I.x+(l-I.y)/(E.y-I.y)*(E.x-I.x),l)._round():E.y>=l&&(E=new C(I.x+(l-I.y)/(E.y-I.y)*(E.x-I.x),l)._round()),b&&I.equals(b[b.length-1])||(b=[I],d.push(b)),b.push(E)))))}}return d}Ge("FeatureIndex",zf,{omit:["rawTileData","sourceLayerCoder"]});class Ca extends C{constructor(t,i,a,l){super(t,i),this.angle=a,l!==void 0&&(this.segment=l)}clone(){return new Ca(this.x,this.y,this.angle,this.segment)}}function Bf(n,t,i,a,l){if(t.segment===void 0||i===0)return!0;let d=t,f=t.segment+1,v=0;for(;v>-i/2;){if(f--,f<0)return!1;v-=n[f].dist(d),d=n[f]}v+=n[f].dist(n[f+1]),f++;let b=[],S=0;for(;v<i/2;){let I=n[f],E=n[f+1];if(!E)return!1;let L=n[f-1].angleTo(I)-I.angleTo(E);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:L}),S+=L;v-b[0].distance>a;)S-=b.shift().angleDelta;if(S>l)return!1;f++,v+=I.dist(E)}return!0}function Of(n){let t=0;for(let i=0;i<n.length-1;i++)t+=n[i].dist(n[i+1]);return t}function jf(n,t,i){return n?.6*t*i:0}function Uf(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function K0(n,t,i,a,l,d){let f=jf(i,l,d),v=Uf(i,a)*d,b=0,S=Of(n)/2;for(let I=0;I<n.length-1;I++){let E=n[I],L=n[I+1],z=E.dist(L);if(b+z>S){let R=(S-b)/z,j=gr.number(E.x,L.x,R),V=gr.number(E.y,L.y,R),H=new Ca(j,V,L.angleTo(E),I);return H._round(),!f||Bf(n,H,v,f,t)?H:void 0}b+=z}}function Y0(n,t,i,a,l,d,f,v,b){let S=jf(a,d,f),I=Uf(a,l),E=I*f,L=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return t-E<t/4&&(t=E+t/4),Nf(n,L?t/2*v%t:(I/2+2*d)*f*v%t,t,S,i,E,L,!1,b)}function Nf(n,t,i,a,l,d,f,v,b){let S=d/2,I=Of(n),E=0,L=t-i,z=[];for(let R=0;R<n.length-1;R++){let j=n[R],V=n[R+1],H=j.dist(V),se=V.angleTo(j);for(;L+i<E+H;){L+=i;let te=(L-E)/H,re=gr.number(j.x,V.x,te),fe=gr.number(j.y,V.y,te);if(re>=0&&re<b&&fe>=0&&fe<b&&L-S>=0&&L+S<=I){let we=new Ca(re,fe,se,R);we._round(),a&&!Bf(n,we,d,a,l)||z.push(we)}}E+=H}return v||z.length||f||(z=Nf(n,E/2,i,a,l,d,f,!0,b)),z}function Vf(n,t,i,a){let l=[],d=n.image,f=d.pixelRatio,v=d.paddedRect.w-2,b=d.paddedRect.h-2,S={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom},I=d.stretchX||[[0,v]],E=d.stretchY||[[0,b]],L=(Se,ot)=>Se+ot[1]-ot[0],z=I.reduce(L,0),R=E.reduce(L,0),j=v-z,V=b-R,H=0,se=z,te=0,re=R,fe=0,we=j,Ee=0,Ne=V;if(d.content&&a){let Se=d.content,ot=Se[2]-Se[0],at=Se[3]-Se[1];(d.textFitWidth||d.textFitHeight)&&(S=gf(n)),H=Sh(I,0,Se[0]),te=Sh(E,0,Se[1]),se=Sh(I,Se[0],Se[2]),re=Sh(E,Se[1],Se[3]),fe=Se[0]-H,Ee=Se[1]-te,we=ot-se,Ne=at-re}let Fe=S.x1,je=S.y1,Ye=S.x2-Fe,Oe=S.y2-je,Ue=(Se,ot,at,et)=>{let He=Ih(Se.stretch-H,se,Ye,Fe),Mt=Ph(Se.fixed-fe,we,Se.stretch,z),ui=Ih(ot.stretch-te,re,Oe,je),Ai=Ph(ot.fixed-Ee,Ne,ot.stretch,R),en=Ih(at.stretch-H,se,Ye,Fe),nr=Ph(at.fixed-fe,we,at.stretch,z),Mn=Ih(et.stretch-te,re,Oe,je),qi=Ph(et.fixed-Ee,Ne,et.stretch,R),ri=new C(He,ui),Oi=new C(en,ui),Wi=new C(en,Mn),Hi=new C(He,Mn),xn=new C(Mt/f,Ai/f),rr=new C(nr/f,qi/f),ji=t*Math.PI/180;if(ji){let Ui=Math.sin(ji),Ni=Math.cos(ji),Si=[Ni,-Ui,Ui,Ni];ri._matMult(Si),Oi._matMult(Si),Hi._matMult(Si),Wi._matMult(Si)}let En=Se.stretch+Se.fixed,ki=ot.stretch+ot.fixed;return{tl:ri,tr:Oi,bl:Hi,br:Wi,tex:{x:d.paddedRect.x+1+En,y:d.paddedRect.y+1+ki,w:at.stretch+at.fixed-En,h:et.stretch+et.fixed-ki},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xn,pixelOffsetBR:rr,minFontScaleX:we/f/Ye,minFontScaleY:Ne/f/Oe,isSDF:i}};if(a&&(d.stretchX||d.stretchY)){let Se=$f(I,j,z),ot=$f(E,V,R);for(let at=0;at<Se.length-1;at++){let et=Se[at],He=Se[at+1];for(let Mt=0;Mt<ot.length-1;Mt++)l.push(Ue(et,ot[Mt],He,ot[Mt+1]))}}else l.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return l}function Sh(n,t,i){let a=0;for(let l of n)a+=Math.max(t,Math.min(i,l[1]))-Math.max(t,Math.min(i,l[0]));return a}function $f(n,t,i){let a=[{fixed:-1,stretch:0}];for(let[l,d]of n){let f=a[a.length-1];a.push({fixed:l-f.stretch,stretch:f.stretch}),a.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return a.push({fixed:t+1,stretch:i}),a}function Ih(n,t,i,a){return n/t*i+a}function Ph(n,t,i,a){return n-t*i/a}Ge("Anchor",Ca);class Ch{constructor(t,i,a,l,d,f,v,b,S,I){var E;if(this.boxStartIndex=t.length,S){let L=f.top,z=f.bottom,R=f.collisionPadding;R&&(L-=R[1],z+=R[3]);let j=z-L;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let L=!((E=f.image)===null||E===void 0)&&E.content&&(f.image.textFitWidth||f.image.textFitHeight)?gf(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};L.y1=L.y1*v-b[0],L.y2=L.y2*v+b[2],L.x1=L.x1*v-b[3],L.x2=L.x2*v+b[1];let z=f.collisionPadding;if(z&&(L.x1-=z[0]*v,L.y1-=z[1]*v,L.x2+=z[2]*v,L.y2+=z[3]*v),I){let R=new C(L.x1,L.y1),j=new C(L.x2,L.y1),V=new C(L.x1,L.y2),H=new C(L.x2,L.y2),se=I*Math.PI/180;R._rotate(se),j._rotate(se),V._rotate(se),H._rotate(se),L.x1=Math.min(R.x,j.x,V.x,H.x),L.x2=Math.max(R.x,j.x,V.x,H.x),L.y1=Math.min(R.y,j.y,V.y,H.y),L.y2=Math.max(R.y,j.y,V.y,H.y)}t.emplaceBack(i.x,i.y,L.x1,L.y1,L.x2,L.y2,a,l,d)}this.boxEndIndex=t.length}}class J0{constructor(t=[],i=(a,l)=>a<l?-1:a>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:i,compare:a}=this,l=i[t];for(;t>0;){let d=t-1>>1,f=i[d];if(a(l,f)>=0)break;i[t]=f,t=d}i[t]=l}_down(t){let{data:i,compare:a}=this,l=this.length>>1,d=i[t];for(;t<l;){let f=1+(t<<1),v=f+1;if(v<this.length&&a(i[v],i[f])<0&&(f=v),a(i[f],d)>=0)break;i[t]=i[f],t=f}i[t]=d}}function Q0(n,t=1,i=!1){let a=fs.fromPoints(n[0]),l=Math.min(a.width(),a.height()),d=l/2,f=new J0([],ev),{minX:v,minY:b,maxX:S,maxY:I}=a;if(l===0)return new C(v,b);for(let z=v;z<S;z+=l)for(let R=b;R<I;R+=l)f.push(new Sl(z+d,R+d,d,n));let E=(function(z){let R=0,j=0,V=0,H=z[0];for(let se=0,te=H.length,re=te-1;se<te;re=se++){let fe=H[se],we=H[re],Ee=fe.x*we.y-we.x*fe.y;j+=(fe.x+we.x)*Ee,V+=(fe.y+we.y)*Ee,R+=3*Ee}return new Sl(j/R,V/R,0,z)})(n),L=f.length;for(;f.length;){let z=f.pop();(z.d>E.d||!E.d)&&(E=z,i&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,L)),z.max-E.d<=t||(d=z.h/2,f.push(new Sl(z.p.x-d,z.p.y-d,d,n)),f.push(new Sl(z.p.x+d,z.p.y-d,d,n)),f.push(new Sl(z.p.x-d,z.p.y+d,d,n)),f.push(new Sl(z.p.x+d,z.p.y+d,d,n)),L+=4)}return i&&(console.log(`num probes: ${L}`),console.log(`best distance: ${E.d}`)),E.p}function ev(n,t){return t.max-n.max}function Sl(n,t,i,a){this.p=new C(n,t),this.h=i,this.d=(function(l,d){let f=!1,v=1/0;for(let b=0;b<d.length;b++){let S=d[b];for(let I=0,E=S.length,L=E-1;I<E;L=I++){let z=S[I],R=S[L];z.y>l.y!=R.y>l.y&&l.x<(R.x-z.x)*(l.y-z.y)/(R.y-z.y)+z.x&&(f=!f),v=Math.min(v,Pm(l,z,R))}}return(f?1:-1)*Math.sqrt(v)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Qi;_.aE=void 0,(Qi=_.aE||(_.aE={}))[Qi.center=1]="center",Qi[Qi.left=2]="left",Qi[Qi.right=3]="right",Qi[Qi.top=4]="top",Qi[Qi.bottom=5]="bottom",Qi[Qi["top-left"]=6]="top-left",Qi[Qi["top-right"]=7]="top-right",Qi[Qi["bottom-left"]=8]="bottom-left",Qi[Qi["bottom-right"]=9]="bottom-right";let cd=Number.POSITIVE_INFINITY;function Gf(n,t){return t[1]!==cd?(function(i,a,l){let d=0,f=0;switch(a=Math.abs(a),l=Math.abs(l),i){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(i){case"top-right":case"bottom-right":case"right":d=-a;break;case"top-left":case"bottom-left":case"left":d=a}return[d,f]})(n,t[0],t[1]):(function(i,a){let l=0,d=0;a<0&&(a=0);let f=a/Math.SQRT2;switch(i){case"top-right":case"top-left":d=f-7;break;case"bottom-right":case"bottom-left":d=7-f;break;case"bottom":d=7-a;break;case"top":d=a-7}switch(i){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=a;break;case"right":l=-a}return[l,d]})(n,t[0])}function Zf(n,t,i){var a;let l=n.layout,d=(a=l.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},i);if(d){let v=d.values,b=[];for(let S=0;S<v.length;S+=2){let I=b[S]=v[S],E=v[S+1].map(L=>L*Bi);I.startsWith("top")?E[1]-=7:I.startsWith("bottom")&&(E[1]+=7),b[S+1]=E}return new on(b)}let f=l.get("text-variable-anchor");if(f){let v;v=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},i)*Bi,cd]:l.get("text-offset").evaluate(t,{},i).map(S=>S*Bi);let b=[];for(let S of f)b.push(S,Gf(S,v));return new on(b)}return null}function ud(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tv(n,t,i,a,l,d,f,v,b,S,I,E){let L=d.textMaxSize.evaluate(t,{});L===void 0&&(L=f);let z=n.layers[0].layout,R=z.get("icon-offset").evaluate(t,{},I),j=Wf(i.horizontal),V=f/24,H=n.tilePixelRatio*V,se=n.tilePixelRatio*L/24,te=n.tilePixelRatio*v,re=n.tilePixelRatio*z.get("symbol-spacing"),fe=z.get("text-padding")*n.tilePixelRatio,we=(function(at,et,He,Mt=1){let ui=at.get("icon-padding").evaluate(et,{},He),Ai=ui&&ui.values;return[Ai[0]*Mt,Ai[1]*Mt,Ai[2]*Mt,Ai[3]*Mt]})(z,t,I,n.tilePixelRatio),Ee=z.get("text-max-angle")/180*Math.PI,Ne=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",Fe=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",je=z.get("symbol-placement"),Ye=re/2,Oe=z.get("icon-text-fit"),Ue;a&&Oe!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Ue=_f(a,i.vertical,Oe,z.get("icon-text-fit-padding"),R,V)),j&&(a=_f(a,j,Oe,z.get("icon-text-fit-padding"),R,V)));let Se=I?E.line.getGranularityForZoomLevel(I.z):1,ot=(at,et)=>{et.x<0||et.x>=Ot||et.y<0||et.y>=Ot||(function(He,Mt,ui,Ai,en,nr,Mn,qi,ri,Oi,Wi,Hi,xn,rr,ji,En,ki,Ui,Ni,Si,ti,zr,Il,Rr,rv){let Pl=He.addToLineVertexArray(Mt,ui),gs,Cl,Ml,El,Yf=0,Jf=0,Qf=0,eg=0,yd=-1,vd=-1,Uo={},tg=wa("");if(He.allowVerticalPlacement&&Ai.vertical){let cn=qi.layout.get("text-rotate").evaluate(ti,{},Rr)+90;Ml=new Ch(ri,Mt,Oi,Wi,Hi,Ai.vertical,xn,rr,ji,cn),Mn&&(El=new Ch(ri,Mt,Oi,Wi,Hi,Mn,ki,Ui,ji,cn))}if(en){let cn=qi.layout.get("icon-rotate").evaluate(ti,{}),or=qi.layout.get("icon-text-fit")!=="none",_s=Vf(en,cn,Il,or),Br=Mn?Vf(Mn,cn,Il,or):void 0;Cl=new Ch(ri,Mt,Oi,Wi,Hi,en,ki,Ui,!1,cn),Yf=4*_s.length;let ys=He.iconSizeData,co=null;ys.kind==="source"?(co=[jo*qi.layout.get("icon-size").evaluate(ti,{})],co[0]>Ia&&fi(`${He.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ys.kind==="composite"&&(co=[jo*zr.compositeIconSizes[0].evaluate(ti,{},Rr),jo*zr.compositeIconSizes[1].evaluate(ti,{},Rr)],(co[0]>Ia||co[1]>Ia)&&fi(`${He.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),He.addSymbols(He.icon,_s,co,Si,Ni,ti,_.ao.none,Mt,Pl.lineStartIndex,Pl.lineLength,-1,Rr),yd=He.icon.placedSymbolArray.length-1,Br&&(Jf=4*Br.length,He.addSymbols(He.icon,Br,co,Si,Ni,ti,_.ao.vertical,Mt,Pl.lineStartIndex,Pl.lineLength,-1,Rr),vd=He.icon.placedSymbolArray.length-1)}let ig=Object.keys(Ai.horizontal);for(let cn of ig){let or=Ai.horizontal[cn];if(!gs){tg=wa(or.text);let Br=qi.layout.get("text-rotate").evaluate(ti,{},Rr);gs=new Ch(ri,Mt,Oi,Wi,Hi,or,xn,rr,ji,Br)}let _s=or.positionedLines.length===1;if(Qf+=qf(He,Mt,or,nr,qi,ji,ti,En,Pl,Ai.vertical?_.ao.horizontal:_.ao.horizontalOnly,_s?ig:[cn],Uo,yd,zr,Rr),_s)break}Ai.vertical&&(eg+=qf(He,Mt,Ai.vertical,nr,qi,ji,ti,En,Pl,_.ao.vertical,["vertical"],Uo,vd,zr,Rr));let ov=gs?gs.boxStartIndex:He.collisionBoxArray.length,av=gs?gs.boxEndIndex:He.collisionBoxArray.length,sv=Ml?Ml.boxStartIndex:He.collisionBoxArray.length,lv=Ml?Ml.boxEndIndex:He.collisionBoxArray.length,cv=Cl?Cl.boxStartIndex:He.collisionBoxArray.length,uv=Cl?Cl.boxEndIndex:He.collisionBoxArray.length,hv=El?El.boxStartIndex:He.collisionBoxArray.length,pv=El?El.boxEndIndex:He.collisionBoxArray.length,Fr=-1,Eh=(cn,or)=>cn&&cn.circleDiameter?Math.max(cn.circleDiameter,or):or;Fr=Eh(gs,Fr),Fr=Eh(Ml,Fr),Fr=Eh(Cl,Fr),Fr=Eh(El,Fr);let ng=Fr>-1?1:0;ng&&(Fr*=rv/Bi),He.glyphOffsetArray.length>=wl.MAX_GLYPHS&&fi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ti.sortKey!==void 0&&He.addToSortKeyRanges(He.symbolInstances.length,ti.sortKey);let dv=Zf(qi,ti,Rr),[mv,fv]=(function(cn,or){let _s=cn.length,Br=or?.values;if(Br?.length>0)for(let ys=0;ys<Br.length;ys+=2){let co=Br[ys+1];cn.emplaceBack(_.aE[Br[ys]],co[0],co[1])}return[_s,cn.length]})(He.textAnchorOffsets,dv);He.symbolInstances.emplaceBack(Mt.x,Mt.y,Uo.right>=0?Uo.right:-1,Uo.center>=0?Uo.center:-1,Uo.left>=0?Uo.left:-1,Uo.vertical||-1,yd,vd,tg,ov,av,sv,lv,cv,uv,hv,pv,Oi,Qf,eg,Yf,Jf,ng,0,xn,Fr,mv,fv)})(n,et,at,i,a,l,Ue,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,H,[fe,fe,fe,fe],Ne,b,te,we,Fe,R,t,d,S,I,f)};if(je==="line")for(let at of Ff(t.geometry,0,0,Ot,Ot)){let et=ms(at,Se),He=Y0(et,re,Ee,i.vertical||j,a,24,se,n.overscaling,Ot);for(let Mt of He)j&&iv(n,j.text,Ye,Mt)||ot(et,Mt)}else if(je==="line-center"){for(let at of t.geometry)if(at.length>1){let et=ms(at,Se),He=K0(et,Ee,i.vertical||j,a,24,se);He&&ot(et,He)}}else if(t.type==="Polygon")for(let at of Ya(t.geometry,0)){let et=Q0(at,16);ot(ms(at[0],Se,!0),new Ca(et.x,et.y,0))}else if(t.type==="LineString")for(let at of t.geometry){let et=ms(at,Se);ot(et,new Ca(et[0].x,et[0].y,0))}else if(t.type==="Point")for(let at of t.geometry)for(let et of at)ot([et],new Ca(et.x,et.y,0))}function qf(n,t,i,a,l,d,f,v,b,S,I,E,L,z,R){let j=(function(se,te,re,fe,we,Ee,Ne,Fe){let je=fe.layout.get("text-rotate").evaluate(Ee,{})*Math.PI/180,Ye=[];for(let Oe of te.positionedLines)for(let Ue of Oe.positionedGlyphs){if(!Ue.rect)continue;let Se=Ue.rect||{},ot=4,at=!0,et=1,He=0,Mt=(we||Fe)&&Ue.vertical,ui=Ue.metrics.advance*Ue.scale/2;if(Fe&&te.verticalizable&&(He=Oe.lineOffset/2-(Ue.imageName?-(Bi-Ue.metrics.width*Ue.scale)/2:(Ue.scale-1)*Bi)),Ue.imageName){let Ui=Ne[Ue.imageName];at=Ui.sdf,et=Ui.pixelRatio,ot=1/et}let Ai=we?[Ue.x+ui,Ue.y]:[0,0],en=we?[0,0]:[Ue.x+ui+re[0],Ue.y+re[1]-He],nr=[0,0];Mt&&(nr=en,en=[0,0]);let Mn=Ue.metrics.isDoubleResolution?2:1,qi=(Ue.metrics.left-ot)*Ue.scale-ui+en[0],ri=(-Ue.metrics.top-ot)*Ue.scale+en[1],Oi=qi+Se.w/Mn*Ue.scale/et,Wi=ri+Se.h/Mn*Ue.scale/et,Hi=new C(qi,ri),xn=new C(Oi,ri),rr=new C(qi,Wi),ji=new C(Oi,Wi);if(Mt){let Ui=new C(-ui,ui- -17),Ni=-Math.PI/2,Si=12-ui,ti=new C(22-Si,-(Ue.imageName?Si:0)),zr=new C(...nr);Hi._rotateAround(Ni,Ui)._add(ti)._add(zr),xn._rotateAround(Ni,Ui)._add(ti)._add(zr),rr._rotateAround(Ni,Ui)._add(ti)._add(zr),ji._rotateAround(Ni,Ui)._add(ti)._add(zr)}if(je){let Ui=Math.sin(je),Ni=Math.cos(je),Si=[Ni,-Ui,Ui,Ni];Hi._matMult(Si),xn._matMult(Si),rr._matMult(Si),ji._matMult(Si)}let En=new C(0,0),ki=new C(0,0);Ye.push({tl:Hi,tr:xn,bl:rr,br:ji,tex:Se,writingMode:te.writingMode,glyphOffset:Ai,sectionIndex:Ue.sectionIndex,isSDF:at,pixelOffsetTL:En,pixelOffsetBR:ki,minFontScaleX:0,minFontScaleY:0})}return Ye})(0,i,v,l,d,f,a,n.allowVerticalPlacement),V=n.textSizeData,H=null;V.kind==="source"?(H=[jo*l.layout.get("text-size").evaluate(f,{})],H[0]>Ia&&fi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):V.kind==="composite"&&(H=[jo*z.compositeTextSizes[0].evaluate(f,{},R),jo*z.compositeTextSizes[1].evaluate(f,{},R)],(H[0]>Ia||H[1]>Ia)&&fi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,j,H,v,d,f,S,t,b.lineStartIndex,b.lineLength,L,R);for(let se of I)E[se]=n.text.placedSymbolArray.length-1;return 4*j.length}function Wf(n){for(let t in n)return n[t];return null}function iv(n,t,i,a){let l=n.compareText;if(t in l){let d=l[t];for(let f=d.length-1;f>=0;f--)if(a.dist(d[f])<i)return!0}else l[t]=[];return l[t].push(a),!1}let Hf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,a]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let d=Hf[15&a];if(!d)throw new Error("Unrecognized array type.");let[f]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new hd(v,f,d,t)}constructor(t,i=64,a=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let d=Hf.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=i,a}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return pd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:f,nodeSize:v}=this,b=[0,d.length-1,0],S=[];for(;b.length;){let I=b.pop()||0,E=b.pop()||0,L=b.pop()||0;if(E-L<=v){for(let V=L;V<=E;V++){let H=f[2*V],se=f[2*V+1];H>=t&&H<=a&&se>=i&&se<=l&&S.push(d[V])}continue}let z=L+E>>1,R=f[2*z],j=f[2*z+1];R>=t&&R<=a&&j>=i&&j<=l&&S.push(d[z]),(I===0?t<=R:i<=j)&&(b.push(L),b.push(z-1),b.push(1-I)),(I===0?a>=R:l>=j)&&(b.push(z+1),b.push(E),b.push(1-I))}return S}within(t,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:d,nodeSize:f}=this,v=[0,l.length-1,0],b=[],S=a*a;for(;v.length;){let I=v.pop()||0,E=v.pop()||0,L=v.pop()||0;if(E-L<=f){for(let V=L;V<=E;V++)Kf(d[2*V],d[2*V+1],t,i)<=S&&b.push(l[V]);continue}let z=L+E>>1,R=d[2*z],j=d[2*z+1];Kf(R,j,t,i)<=S&&b.push(l[z]),(I===0?t-a<=R:i-a<=j)&&(v.push(L),v.push(z-1),v.push(1-I)),(I===0?t+a>=R:i+a>=j)&&(v.push(z+1),v.push(E),v.push(1-I))}return b}}function pd(n,t,i,a,l,d){if(l-a<=i)return;let f=a+l>>1;Xf(n,t,f,a,l,d),pd(n,t,i,a,f-1,1-d),pd(n,t,i,f+1,l,1-d)}function Xf(n,t,i,a,l,d){for(;l>a;){if(l-a>600){let S=l-a+1,I=i-a+1,E=Math.log(S),L=.5*Math.exp(2*E/3),z=.5*Math.sqrt(E*L*(S-L)/S)*(I-S/2<0?-1:1);Xf(n,t,i,Math.max(a,Math.floor(i-I*L/S+z)),Math.min(l,Math.floor(i+(S-I)*L/S+z)),d)}let f=t[2*i+d],v=a,b=l;for(ou(n,t,a,i),t[2*l+d]>f&&ou(n,t,a,l);v<b;){for(ou(n,t,v,b),v++,b--;t[2*v+d]<f;)v++;for(;t[2*b+d]>f;)b--}t[2*a+d]===f?ou(n,t,a,b):(b++,ou(n,t,b,l)),b<=i&&(a=b+1),i<=b&&(l=b-1)}}function ou(n,t,i,a){dd(n,i,a),dd(t,2*i,2*a),dd(t,2*i+1,2*a+1)}function dd(n,t,i){let a=n[t];n[t]=n[i],n[i]=a}function Kf(n,t,i,a){let l=n-i,d=t-a;return l*l+d*d}var md;_.cx=void 0,(md=_.cx||(_.cx={})).create="create",md.load="load",md.fullLoad="fullLoad";let Mh=null,au=[],fd=1e3/60,gd="loadTime",_d="fullLoadTime",nv={mark(n){performance.mark(n)},frame(n){let t=n;Mh!=null&&au.push(t-Mh),Mh=t},clearMetrics(){Mh=null,au=[],performance.clearMeasures(gd),performance.clearMeasures(_d);for(let n in _.cx)performance.clearMarks(_.cx[n])},getPerformanceMetrics(){performance.measure(gd,_.cx.create,_.cx.load),performance.measure(_d,_.cx.create,_.cx.fullLoad);let n=performance.getEntriesByName(gd)[0].duration,t=performance.getEntriesByName(_d)[0].duration,i=au.length,a=1/(au.reduce((d,f)=>d+f,0)/i/1e3),l=au.filter(d=>d>fd).reduce((d,f)=>d+(f-fd)/fd,0);return{loadTime:n,fullLoadTime:t,fps:a,percentDroppedFrames:l/(i+l)*100,totalFrames:i}}};_.$=Ot,_.A=Qe,_.B=function([n,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(i),y:n*Math.sin(t)*Math.sin(i),z:n*Math.cos(i)}},_.C=gr,_.D=Ke,_.E=Xe,_.F=Qt,_.G=ss,_.H=function(n){if(_o==null){let t=n.navigator?n.navigator.userAgent:null;_o=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return _o},_.I=Jp,_.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new W0(()=>this.process()),this.subscription=Zr(this.target,"message",i=>this.receive(i),!1),this.globalScope=ur(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((i,a)=>{let l=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=t?Zr(t.signal,"abort",()=>{d?.unsubscribe(),delete this.resolveRejects[l];let b={id:l,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)},H0):null;this.resolveRejects[l]={resolve:b=>{d?.unsubscribe(),i(b)},reject:b=>{d?.unsubscribe(),a(b)}};let f=[],v=Object.assign(Object.assign({},n),{id:l,sourceMapId:this.mapId,origin:location.origin,data:ga(n.data,f)});this.target.postMessage(v,{transfer:f})})}receive(n){let t=n.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];let a=this.abortControllers[i];return delete this.abortControllers[i],void(a&&a.abort())}if(ur(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;let n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return o(this,void 0,void 0,function*(){if(t.type==="<response>"){let l=this.resolveRejects[n];return delete this.resolveRejects[n],l?void(t.error?l.reject(zo(t.error)):l.resolve(zo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let i=zo(t.data),a=new AbortController;this.abortControllers[n]=a;try{let l=yield this.messageHandlers[t.type](t.sourceMapId,i,a);this.completeTask(n,null,l)}catch(l){this.completeTask(n,l)}})}completeTask(n,t,i){let a=[];delete this.abortControllers[n];let l={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ga(t):null,data:ga(i,a)};this.target.postMessage(l,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},_.K=N,_.L=function(){var n=new Qe(16);return Qe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},_.M=function(n,t,i){var a,l,d,f,v,b,S,I,E,L,z,R,j=i[0],V=i[1],H=i[2];return t===n?(n[12]=t[0]*j+t[4]*V+t[8]*H+t[12],n[13]=t[1]*j+t[5]*V+t[9]*H+t[13],n[14]=t[2]*j+t[6]*V+t[10]*H+t[14],n[15]=t[3]*j+t[7]*V+t[11]*H+t[15]):(l=t[1],d=t[2],f=t[3],v=t[4],b=t[5],S=t[6],I=t[7],E=t[8],L=t[9],z=t[10],R=t[11],n[0]=a=t[0],n[1]=l,n[2]=d,n[3]=f,n[4]=v,n[5]=b,n[6]=S,n[7]=I,n[8]=E,n[9]=L,n[10]=z,n[11]=R,n[12]=a*j+v*V+E*H+t[12],n[13]=l*j+b*V+L*H+t[13],n[14]=d*j+S*V+z*H+t[14],n[15]=f*j+I*V+R*H+t[15]),n},_.N=function(n,t,i){var a=i[0],l=i[1],d=i[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*l,n[5]=t[5]*l,n[6]=t[6]*l,n[7]=t[7]*l,n[8]=t[8]*d,n[9]=t[9]*d,n[10]=t[10]*d,n[11]=t[11]*d,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},_.O=function(n,t,i){var a=t[0],l=t[1],d=t[2],f=t[3],v=t[4],b=t[5],S=t[6],I=t[7],E=t[8],L=t[9],z=t[10],R=t[11],j=t[12],V=t[13],H=t[14],se=t[15],te=i[0],re=i[1],fe=i[2],we=i[3];return n[0]=te*a+re*v+fe*E+we*j,n[1]=te*l+re*b+fe*L+we*V,n[2]=te*d+re*S+fe*z+we*H,n[3]=te*f+re*I+fe*R+we*se,n[4]=(te=i[4])*a+(re=i[5])*v+(fe=i[6])*E+(we=i[7])*j,n[5]=te*l+re*b+fe*L+we*V,n[6]=te*d+re*S+fe*z+we*H,n[7]=te*f+re*I+fe*R+we*se,n[8]=(te=i[8])*a+(re=i[9])*v+(fe=i[10])*E+(we=i[11])*j,n[9]=te*l+re*b+fe*L+we*V,n[10]=te*d+re*S+fe*z+we*H,n[11]=te*f+re*I+fe*R+we*se,n[12]=(te=i[12])*a+(re=i[13])*v+(fe=i[14])*E+(we=i[15])*j,n[13]=te*l+re*b+fe*L+we*V,n[14]=te*d+re*S+fe*z+we*H,n[15]=te*f+re*I+fe*R+we*se,n},_.P=C,_.Q=function(n,t){let i={};for(let a=0;a<t.length;a++){let l=t[a];l in n&&(i[l]=n[l])}return i},_.R=Cn,_.S=Pa,_.T=Np,_.U=Cf,_.V=Pf,_.W=Ae,_.X=De,_.Y=Yo,_.Z=ir,_._=o,_.a=O,_.a$=Vn,_.a0=function(n,t){var i,a,l,d;if(!n)return t??{};if(!t)return n;let f=Object.assign({},n);if(t.removeAll&&(f.removeAll=!0),t.remove){let v=new Set(f.remove?f.remove.concat(t.remove):t.remove);f.remove=Array.from(v.values())}if(t.add){let v=f.add?f.add.concat(t.add):t.add,b=new Map(v.map(S=>[S.id,S]));f.add=Array.from(b.values())}if(t.update){let v=new Map((i=f.update)===null||i===void 0?void 0:i.map(b=>[b.id,b]));for(let b of t.update){let S=(a=v.get(b.id))!==null&&a!==void 0?a:{id:b.id};b.newGeometry&&(S.newGeometry=b.newGeometry),b.addOrUpdateProperties&&(S.addOrUpdateProperties=((l=S.addOrUpdateProperties)!==null&&l!==void 0?l:[]).concat(b.addOrUpdateProperties)),b.removeProperties&&(S.removeProperties=((d=S.removeProperties)!==null&&d!==void 0?d:[]).concat(b.removeProperties)),b.removeAllProperties&&(S.removeAllProperties=!0),v.set(b.id,S)}f.update=Array.from(v.values())}return f},_.a1=nu,_.a2=fs,_.a3=25,_.a4=ld,_.a5=n=>{let t=window.document.createElement("video");return t.muted=!0,new Promise(i=>{t.onloadstart=()=>{i(t)};for(let a of n){let l=window.document.createElement("source");_e(a)||(t.crossOrigin="Anonymous"),l.src=a,t.appendChild(l)}})},_.a6=Re,_.a7=function(){return $n++},_.a8=A,_.a9=wl,_.aA=function(n){let t=1/0,i=1/0,a=-1/0,l=-1/0;for(let d of n)t=Math.min(t,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),l=Math.max(l,d.y);return[t,i,a,l]},_.aB=Bi,_.aC=Nr,_.aD=function(n,t,i,a,l=!1){if(!i[0]&&!i[1])return[0,0];let d=l?a==="map"?-n.bearingInRadians:0:a==="viewport"?n.bearingInRadians:0;if(d){let f=Math.sin(d),v=Math.cos(d);i=[i[0]*v-i[1]*f,i[0]*f+i[1]*v]}return[l?i[0]:Nr(t,i[0],n.zoom),l?i[1]:Nr(t,i[1],n.zoom)]},_.aF=td,_.aG=ud,_.aH=ed,_.aI=hd,_.aJ=mi,_.aK=yh,_.aL=J,_.aM=dt,_.aN=Vt,_.aO=Ho,_.aP=qr,_.aQ=Ef,_.aR=Ii,_.aS=pn,_.aT=function(n){var t=new Qe(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},_.aU=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],n},_.aV=function(n,t){var i=t[0],a=t[1],l=t[2],d=i*i+a*a+l*l;return d>0&&(d=1/Math.sqrt(d)),n[0]=t[0]*d,n[1]=t[1]*d,n[2]=t[2]*d,n},_.aW=On,_.aX=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},_.aY=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n[3]=t[3]*i[3],n},_.aZ=At,_.a_=function(n,t,i){let a=t[0]*i[0]+t[1]*i[1]+t[2]*i[2];return a===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/a},_.aa=ko,_.ab=Dr,_.ac=Df,_.ad=function(n){let t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,l,d)=>{let f=l||d;return t[a]=!f||f.toLowerCase(),""}),t["max-age"]){let i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},_.ae=yo,_.af=function(n){return Math.pow(2,n)},_.ag=vt,_.ah=fn,_.ai=85.051129,_.aj=Mf,_.ak=function(n){return Math.log(n)/Math.LN2},_.al=function(n){var t=n[0],i=n[1];return t*t+i*i},_.am=function(n,t){let i=[];for(let a in n)a in t||i.push(a);return i},_.an=function(n,t){let i=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){let{interpolationType:l,minZoom:d,maxZoom:f}=n,v=l?fn(Zi.interpolationFactor(l,t,d,f),0,1):0;n.kind==="camera"?a=gr.number(n.minSize,n.maxSize,v):i=v}return{uSizeT:i,uSize:a}},_.ap=function(n,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:l}){return n.kind==="source"?a/jo:n.kind==="composite"?gr.number(a/jo,l/jo,i):t},_.aq=function(n,t){var i=t[0],a=t[1],l=t[2],d=t[3],f=t[4],v=t[5],b=t[6],S=t[7],I=t[8],E=t[9],L=t[10],z=t[11],R=t[12],j=t[13],V=t[14],H=t[15],se=i*v-a*f,te=i*b-l*f,re=i*S-d*f,fe=a*b-l*v,we=a*S-d*v,Ee=l*S-d*b,Ne=I*j-E*R,Fe=I*V-L*R,je=I*H-z*R,Ye=E*V-L*j,Oe=E*H-z*j,Ue=L*H-z*V,Se=se*Ue-te*Oe+re*Ye+fe*je-we*Fe+Ee*Ne;return Se?(n[0]=(v*Ue-b*Oe+S*Ye)*(Se=1/Se),n[1]=(l*Oe-a*Ue-d*Ye)*Se,n[2]=(j*Ee-V*we+H*fe)*Se,n[3]=(L*we-E*Ee-z*fe)*Se,n[4]=(b*je-f*Ue-S*Fe)*Se,n[5]=(i*Ue-l*je+d*Fe)*Se,n[6]=(V*re-R*Ee-H*te)*Se,n[7]=(I*Ee-L*re+z*te)*Se,n[8]=(f*Oe-v*je+S*Ne)*Se,n[9]=(a*je-i*Oe-d*Ne)*Se,n[10]=(R*we-j*re+H*se)*Se,n[11]=(E*re-I*we-z*se)*Se,n[12]=(v*Fe-f*Ye-b*Ne)*Se,n[13]=(i*Ye-a*Fe+l*Ne)*Se,n[14]=(j*te-R*fe-V*se)*Se,n[15]=(I*fe-E*te+L*se)*Se,n):null},_.ar=Cr,_.as=function(n){return Math.hypot(n[0],n[1])},_.at=function(n){return n[0]=0,n[1]=0,n},_.au=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n},_.av=id,_.aw=mo,_.ax=function(n,t,i,a){let l=t.y-n.y,d=t.x-n.x,f=a.y-i.y,v=a.x-i.x,b=f*d-v*l;if(b===0)return null;let S=(v*(n.y-i.y)-f*(n.x-i.x))/b;return new C(n.x+S*d,n.y+S*l)},_.ay=Ff,_.az=Sm,_.b=hr,_.b$=class extends h{},_.b0=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n},_.b1=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},_.b2=kf,_.b3=Tl,_.b4=function(n,t,i,a,l){var d,f=1/Math.tan(t/2);return n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,l!=null&&l!==1/0?(n[10]=(l+a)*(d=1/(a-l)),n[14]=2*l*a*d):(n[10]=-1,n[14]=-2*a),n},_.b5=function(n){var t=new Qe(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},_.b6=function(n,t,i){var a=Math.sin(i),l=Math.cos(i),d=t[0],f=t[1],v=t[2],b=t[3],S=t[4],I=t[5],E=t[6],L=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*l+S*a,n[1]=f*l+I*a,n[2]=v*l+E*a,n[3]=b*l+L*a,n[4]=S*l-d*a,n[5]=I*l-f*a,n[6]=E*l-v*a,n[7]=L*l-b*a,n},_.b7=function(n,t,i){var a=Math.sin(i),l=Math.cos(i),d=t[4],f=t[5],v=t[6],b=t[7],S=t[8],I=t[9],E=t[10],L=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=d*l+S*a,n[5]=f*l+I*a,n[6]=v*l+E*a,n[7]=b*l+L*a,n[8]=S*l-d*a,n[9]=I*l-f*a,n[10]=E*l-v*a,n[11]=L*l-b*a,n},_.b8=function(){let n=new Float32Array(16);return vt(n),n},_.b9=function(){let n=new Float64Array(16);return vt(n),n},_.bA=function(n,t){let i=Xi(n,360),a=Xi(t,360),l=a-i,d=a>i?l-360:l+360;return Math.abs(l)<Math.abs(d)?l:d},_.bB=function(n){return n[0]=0,n[1]=0,n[2]=0,n},_.bC=function(n,t,i,a){let l=Math.sqrt(n*n+t*t),d=Math.sqrt(i*i+a*a);n/=l,t/=l,i/=d,a/=d;let f=Math.acos(n*i+t*a);return-t*i+n*a>0?f:-f},_.bD=function(n,t){let i=Xi(n,2*Math.PI),a=Xi(t,2*Math.PI);return Math.min(Math.abs(i-a),Math.abs(i-a+2*Math.PI),Math.abs(i-a-2*Math.PI))},_.bE=function(){let n={},t=pe.$version;for(let i in pe.$root){let a=pe.$root[i];if(a.required){let l=null;l=i==="version"?t:a.type==="array"?[]:{},l!=null&&(n[i]=l)}}return n},_.bF=rl,_.bG=ae,_.bH=function n(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(!n(t[a],i[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(let a in t)if(!n(t[a],i[a]))return!1;return!0}return t===i},_.bI=function(n){n=n.slice();let t=Object.create(null);for(let i=0;i<n.length;i++)t[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=xt(n[i],t[n[i].ref]));return n},_.bJ=function(n){if(n.type==="custom")return new q0(n);switch(n.type){case"background":return new $0(n);case"circle":return new My(n);case"color-relief":return new zy(n);case"fill":return new Xy(n);case"fill-extrusion":return new a0(n);case"heatmap":return new Ay(n);case"hillshade":return new Ly(n);case"line":return new d0(n);case"raster":return new Z0(n);case"symbol":return new Th(n)}},_.bK=Tn,_.bL=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let i=[];try{if(!Je(n.version,t.version))return[{command:"setStyle",args:[t]}];Je(n.center,t.center)||i.push({command:"setCenter",args:[t.center]}),Je(n.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),Je(n.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Je(n.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),Je(n.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),Je(n.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),Je(n.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),Je(n.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),Je(n.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),Je(n.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),Je(n.light,t.light)||i.push({command:"setLight",args:[t.light]}),Je(n.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),Je(n.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),Je(n.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});let a={},l=[];(function(f,v,b,S){let I;for(I in v=v||{},f=f||{})Object.prototype.hasOwnProperty.call(f,I)&&(Object.prototype.hasOwnProperty.call(v,I)||Pi(I,b,S));for(I in v)Object.prototype.hasOwnProperty.call(v,I)&&(Object.prototype.hasOwnProperty.call(f,I)?Je(f[I],v[I])||(f[I].type==="geojson"&&v[I].type==="geojson"&&gi(f,v,I)?pt(b,{command:"setGeoJSONSourceData",args:[I,v[I].data]}):Ci(I,v,b,S)):Jt(I,v,b))})(n.sources,t.sources,l,a);let d=[];n.layers&&n.layers.forEach(f=>{"source"in f&&a[f.source]?i.push({command:"removeLayer",args:[f.id]}):d.push(f)}),i=i.concat(l),(function(f,v,b){v=v||[];let S=(f=f||[]).map(kt),I=v.map(kt),E=f.reduce(vi,{}),L=v.reduce(vi,{}),z=S.slice(),R=Object.create(null),j,V,H,se,te;for(let re=0,fe=0;re<S.length;re++)j=S[re],Object.prototype.hasOwnProperty.call(L,j)?fe++:(pt(b,{command:"removeLayer",args:[j]}),z.splice(z.indexOf(j,fe),1));for(let re=0,fe=0;re<I.length;re++)j=I[I.length-1-re],z[z.length-1-re]!==j&&(Object.prototype.hasOwnProperty.call(E,j)?(pt(b,{command:"removeLayer",args:[j]}),z.splice(z.lastIndexOf(j,z.length-fe),1)):fe++,se=z[z.length-re],pt(b,{command:"addLayer",args:[L[j],se]}),z.splice(z.length-re,0,j),R[j]=!0);for(let re=0;re<I.length;re++)if(j=I[re],V=E[j],H=L[j],!R[j]&&!Je(V,H))if(Je(V.source,H.source)&&Je(V["source-layer"],H["source-layer"])&&Je(V.type,H.type)){for(te in It(V.layout,H.layout,b,j,null,"setLayoutProperty"),It(V.paint,H.paint,b,j,null,"setPaintProperty"),Je(V.filter,H.filter)||pt(b,{command:"setFilter",args:[j,H.filter]}),Je(V.minzoom,H.minzoom)&&Je(V.maxzoom,H.maxzoom)||pt(b,{command:"setLayerZoomRange",args:[j,H.minzoom,H.maxzoom]}),V)Object.prototype.hasOwnProperty.call(V,te)&&te!=="layout"&&te!=="paint"&&te!=="filter"&&te!=="metadata"&&te!=="minzoom"&&te!=="maxzoom"&&(te.indexOf("paint.")===0?It(V[te],H[te],b,j,te.slice(6),"setPaintProperty"):Je(V[te],H[te])||pt(b,{command:"setLayerProperty",args:[j,te,H[te]]}));for(te in H)Object.prototype.hasOwnProperty.call(H,te)&&!Object.prototype.hasOwnProperty.call(V,te)&&te!=="layout"&&te!=="paint"&&te!=="filter"&&te!=="metadata"&&te!=="minzoom"&&te!=="maxzoom"&&(te.indexOf("paint.")===0?It(V[te],H[te],b,j,te.slice(6),"setPaintProperty"):Je(V[te],H[te])||pt(b,{command:"setLayerProperty",args:[j,te,H[te]]}))}else pt(b,{command:"removeLayer",args:[j]}),se=z[z.lastIndexOf(j)+1],pt(b,{command:"addLayer",args:[H,se]})})(d,t.layers,i)}catch(a){console.warn("Unable to compute style diff:",a),i=[{command:"setStyle",args:[t]}]}return i},_.bM=function(n){let t=[],i=n.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},_.bN=Xo,_.bO=Ko,_.bP=class extends ln{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},_.bQ=Ei,_.bR=class extends ln{constructor(n,t){super(n,t),this.current=Bn}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},_.bS=wi,_.bT=class extends ln{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},_.bU=class extends ln{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},_.bV=nt,_.bW=function(n,t){var i=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},_.bX=function(n,t,i){var a=t[0],l=t[1],d=t[2];return n[0]=a*i[0]+l*i[3]+d*i[6],n[1]=a*i[1]+l*i[4]+d*i[7],n[2]=a*i[2]+l*i[5]+d*i[8],n},_.bY=function(n,t,i,a,l,d,f){var v=1/(t-i),b=1/(a-l),S=1/(d-f);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*S,n[11]=0,n[12]=(t+i)*v,n[13]=(l+a)*b,n[14]=(f+d)*S,n[15]=1,n},_.bZ=class extends ln{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;let t=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)t[4*i]=n[i].r,t[4*i+1]=n[i].g,t[4*i+2]=n[i].b,t[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,t)}}},_.b_=class extends ln{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;let t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},_.ba=function(){return new Float64Array(16)},_.bb=function(n,t,i){let a=new Float64Array(4);return Pr(a,n,t-90,i),a},_.bc=function(n,t,i,a){var l,d,f,v,b,S=t[0],I=t[1],E=t[2],L=t[3],z=i[0],R=i[1],j=i[2],V=i[3];return(d=S*z+I*R+E*j+L*V)<0&&(d=-d,z=-z,R=-R,j=-j,V=-V),1-d>qe?(l=Math.acos(d),f=Math.sin(l),v=Math.sin((1-a)*l)/f,b=Math.sin(a*l)/f):(v=1-a,b=a),n[0]=v*S+b*z,n[1]=v*I+b*R,n[2]=v*E+b*j,n[3]=v*L+b*V,n},_.bd=function(n){let t=new Float64Array(9);var i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se,te;E=(l=(a=n)[0])*(b=l+l),L=(d=a[1])*b,R=(f=a[2])*b,j=f*(S=d+d),H=(v=a[3])*b,se=v*S,te=v*(I=f+f),(i=t)[0]=1-(z=d*S)-(V=f*I),i[3]=L-te,i[6]=R+se,i[1]=L+te,i[4]=1-E-V,i[7]=j-H,i[2]=R-se,i[5]=j+H,i[8]=1-E-z;let re=qr(-Math.asin(fn(t[2],-1,1))),fe,we;return Math.hypot(t[5],t[8])<.001?(fe=0,we=-qr(Math.atan2(t[3],t[4]))):(fe=qr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),we=qr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:fe,pitch:re+90,bearing:we}},_.be=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},_.bf=Tt,_.bg=ao,_.bh=yl,_.bi=Yc,_.bj=_l,_.bk=fo,_.bl=cr,_.bm=Yi,_.bn=function(n,t,i,a,l){return fo(a,l,fn((n-t)/(i-t),0,1))},_.bo=Xi,_.bp=function(){return new Float64Array(3)},_.bq=function(n,t,i,a){return n[0]=t[0]+i[0]*a,n[1]=t[1]+i[1]*a,n[2]=t[2]+i[2]*a,n},_.br=Pr,_.bs=function(n,t,i){var a=i[0],l=i[1],d=i[2],f=t[0],v=t[1],b=t[2],S=l*b-d*v,I=d*f-a*b,E=a*v-l*f,L=l*E-d*I,z=d*S-a*E,R=a*I-l*S,j=2*i[3];return I*=j,E*=j,z*=2,R*=2,n[0]=f+(S*=j)+(L*=2),n[1]=v+I+z,n[2]=b+E+R,n},_.bt=function(n,t,i){let a=(l=[n[0],n[1],n[2],t[0],t[1],t[2],i[0],i[1],i[2]])[0]*((I=l[8])*(f=l[4])-(v=l[5])*(S=l[7]))+l[1]*(-I*(d=l[3])+v*(b=l[6]))+l[2]*(S*d-f*b);var l,d,f,v,b,S,I;if(a===0)return null;let E=On([],[t[0],t[1],t[2]],[i[0],i[1],i[2]]),L=On([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),z=On([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),R=Ii([],E,-n[3]);return pn(R,R,Ii([],L,-t[3])),pn(R,R,Ii([],z,-i[3])),Ii(R,R,1/a),R},_.bu=ad,_.bv=function(){return new Float64Array(4)},_.bw=function(n,t,i,a){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[0]*Math.cos(a)-l[1]*Math.sin(a),d[1]=l[0]*Math.sin(a)+l[1]*Math.cos(a),d[2]=l[2],n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},_.bx=function(n,t,i,a){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[0],d[1]=l[1]*Math.cos(a)-l[2]*Math.sin(a),d[2]=l[1]*Math.sin(a)+l[2]*Math.cos(a),n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},_.by=function(n,t,i,a){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[2]*Math.sin(a)+l[0]*Math.cos(a),d[1]=l[1],d[2]=l[2]*Math.cos(a)-l[0]*Math.sin(a),n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},_.bz=function(n,t,i){var a=Math.sin(i),l=Math.cos(i),d=t[0],f=t[1],v=t[2],b=t[3],S=t[8],I=t[9],E=t[10],L=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*l-S*a,n[1]=f*l-I*a,n[2]=v*l-E*a,n[3]=b*l-L*a,n[8]=d*a+S*l,n[9]=f*a+I*l,n[10]=v*a+E*l,n[11]=b*a+L*l,n},_.c=le,_.c0=_0,_.c1=class extends r{},_.c2=Up,_.c3=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},_.c4=zm,_.c5=function(n,t,i){var a=t[0],l=t[1],d=t[2],f=i[3]*a+i[7]*l+i[11]*d+i[15];return n[0]=(i[0]*a+i[4]*l+i[8]*d+i[12])/(f=f||1),n[1]=(i[1]*a+i[5]*l+i[9]*d+i[13])/f,n[2]=(i[2]*a+i[6]*l+i[10]*d+i[14])/f,n},_.c6=class extends Uc{},_.c7=class extends P{},_.c8=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},_.c9=function(n,t){var i=n[0],a=n[1],l=n[2],d=n[3],f=n[4],v=n[5],b=n[6],S=n[7],I=n[8],E=n[9],L=n[10],z=n[11],R=n[12],j=n[13],V=n[14],H=n[15],se=t[0],te=t[1],re=t[2],fe=t[3],we=t[4],Ee=t[5],Ne=t[6],Fe=t[7],je=t[8],Ye=t[9],Oe=t[10],Ue=t[11],Se=t[12],ot=t[13],at=t[14],et=t[15];return Math.abs(i-se)<=qe*Math.max(1,Math.abs(i),Math.abs(se))&&Math.abs(a-te)<=qe*Math.max(1,Math.abs(a),Math.abs(te))&&Math.abs(l-re)<=qe*Math.max(1,Math.abs(l),Math.abs(re))&&Math.abs(d-fe)<=qe*Math.max(1,Math.abs(d),Math.abs(fe))&&Math.abs(f-we)<=qe*Math.max(1,Math.abs(f),Math.abs(we))&&Math.abs(v-Ee)<=qe*Math.max(1,Math.abs(v),Math.abs(Ee))&&Math.abs(b-Ne)<=qe*Math.max(1,Math.abs(b),Math.abs(Ne))&&Math.abs(S-Fe)<=qe*Math.max(1,Math.abs(S),Math.abs(Fe))&&Math.abs(I-je)<=qe*Math.max(1,Math.abs(I),Math.abs(je))&&Math.abs(E-Ye)<=qe*Math.max(1,Math.abs(E),Math.abs(Ye))&&Math.abs(L-Oe)<=qe*Math.max(1,Math.abs(L),Math.abs(Oe))&&Math.abs(z-Ue)<=qe*Math.max(1,Math.abs(z),Math.abs(Ue))&&Math.abs(R-Se)<=qe*Math.max(1,Math.abs(R),Math.abs(Se))&&Math.abs(j-ot)<=qe*Math.max(1,Math.abs(j),Math.abs(ot))&&Math.abs(V-at)<=qe*Math.max(1,Math.abs(V),Math.abs(at))&&Math.abs(H-et)<=qe*Math.max(1,Math.abs(H),Math.abs(et))},_.cA=function(n,t){O.REGISTERED_PROTOCOLS[n]=t},_.cB=function(n){delete O.REGISTERED_PROTOCOLS[n]},_.cC=function(n,t){let i={};for(let l=0;l<n.length;l++){let d=t&&t[n[l].id]||Mp(n[l]);t&&(t[n[l].id]=d);let f=i[d];f||(f=i[d]=[]),f.push(n[l])}let a=[];for(let l in i)a.push(i[l]);return a},_.cD=Ge,_.cE=Lf,_.cF=zf,_.cG=uf,_.cH=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Ot/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;let t=n.bucket.layers[0],i=t.layout,a=t._unevaluatedLayout._values,l={layoutIconSize:a["icon-size"].possiblyEvaluate(new Qt(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Qt(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Qt(18))};if(n.bucket.textSizeData.kind==="composite"){let{minZoom:S,maxZoom:I}=n.bucket.textSizeData;l.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Qt(S),n.canonical),a["text-size"].possiblyEvaluate(new Qt(I),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){let{minZoom:S,maxZoom:I}=n.bucket.iconSizeData;l.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Qt(S),n.canonical),a["icon-size"].possiblyEvaluate(new Qt(I),n.canonical)]}let d=i.get("text-line-height")*Bi,f=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",v=i.get("text-keep-upright"),b=i.get("text-size");for(let S of n.bucket.features){let I=i.get("text-font").evaluate(S,{},n.canonical).join(","),E=b.evaluate(S,{},n.canonical),L=l.layoutTextSize.evaluate(S,{},n.canonical),z=l.layoutIconSize.evaluate(S,{},n.canonical),R={horizontal:{},vertical:void 0},j=S.text,V,H=[0,0];if(j){let re=j.toString(),fe=i.get("text-letter-spacing").evaluate(S,{},n.canonical)*Bi,we=Lp(re)?fe:0,Ee=i.get("text-anchor").evaluate(S,{},n.canonical),Ne=Zf(t,S,n.canonical);if(!Ne){let Oe=i.get("text-radial-offset").evaluate(S,{},n.canonical);H=Oe?Gf(Ee,[Oe*Bi,cd]):i.get("text-offset").evaluate(S,{},n.canonical).map(Ue=>Ue*Bi)}let Fe=f?"center":i.get("text-justify").evaluate(S,{},n.canonical),je=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(S,{},n.canonical)*Bi:1/0,Ye=()=>{n.bucket.allowVerticalPlacement&&ol(re)&&(R.vertical=xh(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,d,Ee,"left",we,H,_.ao.vertical,!0,L,E))};if(!f&&Ne){let Oe=new Set;if(Fe==="auto")for(let Se=0;Se<Ne.values.length;Se+=2)Oe.add(ud(Ne.values[Se]));else Oe.add(Fe);let Ue=!1;for(let Se of Oe)if(!R.horizontal[Se])if(Ue)R.horizontal[Se]=R.horizontal[0];else{let ot=xh(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,d,"center",Se,we,H,_.ao.horizontal,!1,L,E);ot&&(R.horizontal[Se]=ot,Ue=ot.positionedLines.length===1)}Ye()}else{Fe==="auto"&&(Fe=ud(Ee));let Oe=xh(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,d,Ee,Fe,we,H,_.ao.horizontal,!1,L,E);Oe&&(R.horizontal[Fe]=Oe),Ye(),ol(re)&&f&&v&&(R.vertical=xh(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,d,Ee,Fe,we,H,_.ao.vertical,!1,L,E))}}let se=!1;if(S.icon&&S.icon.name){let re=n.imageMap[S.icon.name];re&&(V=j0(n.imagePositions[S.icon.name],i.get("icon-offset").evaluate(S,{},n.canonical),i.get("icon-anchor").evaluate(S,{},n.canonical)),se=!!re.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=se:n.bucket.sdfIcons!==se&&fi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(re.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}let te=Wf(R.horizontal)||R.vertical;n.bucket.iconsInText=!!te&&te.iconsInText,(te||V)&&tv(n.bucket,S,R,V,n.imageMap,l,L,z,H,se,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},_.cI=Xp,_.cJ=qp,_.cK=Hp,_.cL=Xm,_.cM=Yp,_.cN=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},_.cO=function(n,t,i,a,l){return o(this,void 0,void 0,function*(){if(De())try{return yield Yo(n,t,i,a,l)}catch{}return(function(d,f,v,b,S){let I=d.width,E=d.height;$r&&Gr||($r=new OffscreenCanvas(I,E),Gr=$r.getContext("2d",{willReadFrequently:!0})),$r.width=I,$r.height=E,Gr.drawImage(d,0,0,I,E);let L=Gr.getImageData(f,v,b,S);return Gr.clearRect(0,0,I,E),L.data})(n,t,i,a,l)})},_.cP=Bm,_.cQ=B,_.cR=Hm,_.cS=vl,_.cT=ts,_.cU=function(n,t){let i=new Map;if(n!=null)if(n.type==="Feature")i.set(ru(n,t),n);else for(let a of n.features)i.set(ru(a,t),a);return i},_.cV=function(n,t){if(n==null)return!0;if(n.type==="Feature")return ru(n,t)!=null;if(n.type==="FeatureCollection"){let i=new Set;for(let a of n.features){let l=ru(a,t);if(l==null||i.has(l))return!1;i.add(l)}return!0}return!1},_.cW=function(n,t,i){var a,l,d,f;if(t.removeAll&&n.clear(),t.remove)for(let v of t.remove)n.delete(v);if(t.add)for(let v of t.add){let b=ru(v,i);b!=null&&n.set(b,v)}if(t.update)for(let v of t.update){let b=n.get(v.id);if(b==null)continue;let S=!v.removeAllProperties&&(((a=v.removeProperties)===null||a===void 0?void 0:a.length)>0||((l=v.addOrUpdateProperties)===null||l===void 0?void 0:l.length)>0);if((v.newGeometry||v.removeAllProperties||S)&&(b=Object.assign({},b),n.set(v.id,b),S&&(b.properties=Object.assign({},b.properties))),v.newGeometry&&(b.geometry=v.newGeometry),v.removeAllProperties)b.properties={};else if(((d=v.removeProperties)===null||d===void 0?void 0:d.length)>0)for(let I of v.removeProperties)Object.prototype.hasOwnProperty.call(b.properties,I)&&delete b.properties[I];if(((f=v.addOrUpdateProperties)===null||f===void 0?void 0:f.length)>0)for(let{key:I,value:E}of v.addOrUpdateProperties)b.properties[I]=E}},_.cX=Jn,_.ca=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},_.cb=n=>n.type==="symbol",_.cc=n=>n.type==="circle",_.cd=n=>n.type==="heatmap",_.ce=n=>n.type==="line",_.cf=n=>n.type==="fill",_.cg=n=>n.type==="fill-extrusion",_.ch=n=>n.type==="hillshade",_.ci=n=>n.type==="color-relief",_.cj=n=>n.type==="raster",_.ck=n=>n.type==="background",_.cl=n=>n.type==="custom",_.cm=Vr,_.cn=function(n,t,i){let a=Oa(t.x-i.x,t.y-i.y),l=Oa(n.x-i.x,n.y-i.y);var d,f;return qr(Math.atan2(a[0]*l[1]-a[1]*l[0],(d=a)[0]*(f=l)[0]+d[1]*f[1]))},_.co=go,_.cp=function(n,t){return Hr[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},_.cq=function(n,t){return Wr[t]&&"touches"in n},_.cr=function(n){return Wr[n]||Hr[n]},_.cs=function(n,t,i){var a=t[0],l=t[1];return n[0]=i[0]*a+i[4]*l+i[12],n[1]=i[1]*a+i[5]*l+i[13],n},_.ct=function(n,t){let{x:i,y:a}=nu.fromLngLat(t);return!(n<0||n>25||a<0||a>=1||i<0||i>=1)},_.cu=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},_.cv=class extends va{},_.cw=nv,_.cy=function(n){return n.message===Jo},_.cz=Q,_.d=_e,_.e=Dn,_.f=n=>o(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),_.g=U,_.h=n=>new Promise((t,i)=>{let a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=pr})},a.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let l=new Blob([new Uint8Array(n)],{type:"image/png"});a.src=n.byteLength?URL.createObjectURL(l):pr}),_.i=ur,_.j=(n,t)=>ce(Dn(n,{type:"json"}),t),_.k=Pe,_.l=ke,_.m=ce,_.n=(n,t)=>ce(Dn(n,{type:"arrayBuffer"}),t),_.o=function(n){return new Yp(n).readFields(M0,[])},_.p=cf,_.q=qc,_.r=an,_.s=Zr,_.t=ch,_.u=Ct,_.v=pe,_.w=fi,_.x=Ep,_.y=ls,_.z=fa}),u("worker",["./shared"],function(_){"use strict";class o{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,U){for(let Q of O){this._layerConfigs[Q.id]=Q;let ae=this._layers[Q.id]=_.bJ(Q);ae._featureFilter=_.aa(ae.filter),this.keyCache[Q.id]&&delete this.keyCache[Q.id]}for(let Q of U)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};let N=_.cC(Object.values(this._layerConfigs),this.keyCache);for(let Q of N){let ae=Q.map(Pe=>this._layers[Pe.id]),ce=ae[0];if(ce.visibility==="none")continue;let _e=ce.source||"",he=this.familiesBySource[_e];he||(he=this.familiesBySource[_e]={});let Te=ce.sourceLayer||"_geojsonTileLayer",ke=he[Te];ke||(ke=he[Te]=[]),ke.push(ae)}}}class C{constructor(O){let U={},N=[];for(let _e in O){let he=O[_e],Te=U[_e]={};for(let ke in he){let Pe=he[+ke];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;let Xe={x:0,y:0,w:Pe.bitmap.width+2,h:Pe.bitmap.height+2};N.push(Xe),Te[ke]={rect:Xe,metrics:Pe.metrics}}}let{w:Q,h:ae}=_.p(N),ce=new _.q({width:Q||1,height:ae||1});for(let _e in O){let he=O[_e];for(let Te in he){let ke=he[+Te];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;let Pe=U[_e][Te].rect;_.q.copy(ke.bitmap,ce,{x:0,y:0},{x:Pe.x+1,y:Pe.y+1},ke.bitmap)}}this.image=ce,this.positions=U}}_.cD("GlyphAtlas",C);class B{constructor(O){this.tileID=new _.Z(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[],this.globalState=O.globalState}parse(O,U,N,Q,ae){return _._(this,void 0,void 0,function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new _.a8;let ce=new _.cE(Object.keys(O.layers).sort()),_e=new _.cF(this.tileID,this.promoteId);_e.bucketLayerIDs=[];let he={},Te={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N,subdivisionGranularity:ae},ke=U.familiesBySource[this.source];for(let It in ke){let kt=O.layers[It];if(!kt)continue;kt.version===1&&_.w(`Vector tile source "${this.source}" layer "${It}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let vi=ce.encode(It),Re=[];for(let Ki=0;Ki<kt.length;Ki++){let si=kt.feature(Ki),Xr=_e.getId(si,It);Re.push({feature:si,id:Xr,index:Ki,sourceLayerIndex:vi})}for(let Ki of ke[It]){let si=Ki[0];si.source!==this.source&&_.w(`layer.source = ${si.source} does not equal this.source = ${this.source}`),si.minzoom&&this.zoom<Math.floor(si.minzoom)||si.maxzoom&&this.zoom>=si.maxzoom||si.visibility!=="none"&&($(Ki,this.zoom,N),(he[si.id]=si.createBucket({index:_e.bucketLayerIDs.length,layers:Ki,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vi,sourceID:this.source,globalState:this.globalState})).populate(Re,Te,this.tileID.canonical),_e.bucketLayerIDs.push(Ki.map(Xr=>Xr.id)))}}let Pe=_.bN(Te.glyphDependencies,It=>Object.keys(It).map(Number));this.inFlightDependencies.forEach(It=>It?.abort()),this.inFlightDependencies=[];let Xe=Promise.resolve({});if(Object.keys(Pe).length){let It=new AbortController;this.inFlightDependencies.push(It),Xe=Q.sendAsync({type:"GG",data:{stacks:Pe,source:this.source,tileID:this.tileID,type:"glyphs"}},It)}let pe=Object.keys(Te.iconDependencies),lt=Promise.resolve({});if(pe.length){let It=new AbortController;this.inFlightDependencies.push(It),lt=Q.sendAsync({type:"GI",data:{icons:pe,source:this.source,tileID:this.tileID,type:"icons"}},It)}let xt=Object.keys(Te.patternDependencies),Je=Promise.resolve({});if(xt.length){let It=new AbortController;this.inFlightDependencies.push(It),Je=Q.sendAsync({type:"GI",data:{icons:xt,source:this.source,tileID:this.tileID,type:"patterns"}},It)}let[pt,Jt,Pi]=yield Promise.all([Xe,lt,Je]),Ci=new C(pt),gi=new _.cG(Jt,Pi);for(let It in he){let kt=he[It];kt instanceof _.a9?($(kt.layers,this.zoom,N),_.cH({bucket:kt,glyphMap:pt,glyphPositions:Ci.positions,imageMap:Jt,imagePositions:gi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Te.subdivisionGranularity})):kt.hasPattern&&(kt instanceof _.cI||kt instanceof _.cJ||kt instanceof _.cK)&&($(kt.layers,this.zoom,N),kt.addFeatures(Te,this.tileID.canonical,gi.patternPositions))}return this.status="done",{buckets:Object.values(he).filter(It=>!It.isEmpty()),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:gi,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?Jt:null,glyphPositions:this.returnDependencies?Ci.positions:null}})}}function $(le,O,U){let N=new _.F(O);for(let Q of le)Q.recalculate(N,U)}class Y{constructor(O,U,N){this.actor=O,this.layerIndex=U,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,U){return _._(this,void 0,void 0,function*(){let N=yield _.n(O.request,U);try{return{vectorTile:new _.cL(new _.cM(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(Q){let ae=new Uint8Array(N.data),ce=`Unable to parse the tile at ${O.request.url}, `;throw ce+=ae[0]===31&&ae[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Q.message}`,new Error(ce)}})}loadTile(O){return _._(this,void 0,void 0,function*(){let U=O.uid,N=!!(O&&O.request&&O.request.collectResourceTiming)&&new _.cN(O.request),Q=new B(O);this.loading[U]=Q;let ae=new AbortController;Q.abort=ae;try{let ce=yield this.loadVectorTile(O,ae);if(delete this.loading[U],!ce)return null;let _e=ce.rawData,he={};ce.expires&&(he.expires=ce.expires),ce.cacheControl&&(he.cacheControl=ce.cacheControl);let Te={};if(N){let Pe=N.finish();Pe&&(Te.resourceTiming=JSON.parse(JSON.stringify(Pe)))}Q.vectorTile=ce.vectorTile;let ke=Q.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity);this.loaded[U]=Q,this.fetching[U]={rawTileData:_e,cacheControl:he,resourceTiming:Te};try{let Pe=yield ke;return _.e({rawTileData:_e.slice(0)},Pe,he,Te)}finally{delete this.fetching[U]}}catch(ce){throw delete this.loading[U],Q.status="done",this.loaded[U]=Q,ce}})}reloadTile(O){return _._(this,void 0,void 0,function*(){let U=O.uid;if(!this.loaded||!this.loaded[U])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let N=this.loaded[U];if(N.showCollisionBoxes=O.showCollisionBoxes,N.globalState=O.globalState,N.status==="parsing"){let Q=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity),ae;if(this.fetching[U]){let{rawTileData:ce,cacheControl:_e,resourceTiming:he}=this.fetching[U];delete this.fetching[U],ae=_.e({rawTileData:ce.slice(0)},Q,_e,he)}else ae=Q;return ae}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity)})}abortTile(O){return _._(this,void 0,void 0,function*(){let U=this.loading,N=O.uid;U&&U[N]&&U[N].abort&&(U[N].abort.abort(),delete U[N])})}removeTile(O){return _._(this,void 0,void 0,function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]})}}class ne{constructor(){this.loaded={}}loadTile(O){return _._(this,void 0,void 0,function*(){let{uid:U,encoding:N,rawImageData:Q,redFactor:ae,greenFactor:ce,blueFactor:_e,baseShift:he}=O,Te=Q.width+2,ke=Q.height+2,Pe=_.b(Q)?new _.R({width:Te,height:ke},yield _.cO(Q,-1,-1,Te,ke)):Q,Xe=new _.cP(U,Pe,N,ae,ce,_e,he);return this.loaded=this.loaded||{},this.loaded[U]=Xe,Xe})}removeTile(O){let U=this.loaded,N=O.uid;U&&U[N]&&delete U[N]}}var q,Ce,Ie=(function(){if(Ce)return q;function le(U,N){if(U.length!==0){O(U[0],N);for(var Q=1;Q<U.length;Q++)O(U[Q],!N)}}function O(U,N){for(var Q=0,ae=0,ce=0,_e=U.length,he=_e-1;ce<_e;he=ce++){var Te=(U[ce][0]-U[he][0])*(U[he][1]+U[ce][1]),ke=Q+Te;ae+=Math.abs(Q)>=Math.abs(Te)?Q-ke+Te:Te-ke+Q,Q=ke}Q+ae>=0!=!!N&&U.reverse()}return Ce=1,q=function U(N,Q){var ae,ce=N&&N.type;if(ce==="FeatureCollection")for(ae=0;ae<N.features.length;ae++)U(N.features[ae],Q);else if(ce==="GeometryCollection")for(ae=0;ae<N.geometries.length;ae++)U(N.geometries[ae],Q);else if(ce==="Feature")U(N.geometry,Q);else if(ce==="Polygon")le(N.coordinates,Q);else if(ce==="MultiPolygon")for(ae=0;ae<N.coordinates.length;ae++)le(N.coordinates[ae],Q);return N}})(),Ae=_.cQ(Ie);class De extends _.cS{constructor(O,U){super(new _.cM,0,U,[],[]),this.feature=O,this.type=O.type,this.properties=O.tags?O.tags:{},"id"in O&&(typeof O.id=="string"?this.id=parseInt(O.id,10):typeof O.id!="number"||isNaN(O.id)||(this.id=O.id))}loadGeometry(){let O=[],U=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let N of U){let Q=[];for(let ae of N)Q.push(new _.P(ae[0],ae[1]));O.push(Q)}return O}}class qe extends _.cR{constructor(O,U){super(new _.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=U?U.version:1,this.extent=U?U.extent:4096,this.length=O.length,this.features=O}feature(O){return new De(this.features[O],this.extent)}}function Qe(le,O){O.writeVarintField(15,le.version||1),O.writeStringField(1,le.name||""),O.writeVarintField(5,le.extent||4096);let U={keys:[],values:[],keycache:{},valuecache:{}};for(let ae=0;ae<le.length;ae++)U.feature=le.feature(ae),O.writeMessage(2,nt,U);let N=U.keys;for(let ae of N)O.writeStringField(3,ae);let Q=U.values;for(let ae of Q)O.writeMessage(4,pn,ae)}function nt(le,O){if(!le.feature)return;let U=le.feature;U.id!==void 0&&O.writeVarintField(1,U.id),O.writeMessage(2,vt,le),O.writeVarintField(3,U.type),O.writeMessage(4,Yt,U)}function vt(le,O){for(let U in le.feature?.properties){let N=le.feature.properties[U],Q=le.keycache[U];if(N===null)continue;Q===void 0&&(le.keys.push(U),Q=le.keys.length-1,le.keycache[U]=Q),O.writeVarint(Q),typeof N!="string"&&typeof N!="boolean"&&typeof N!="number"&&(N=JSON.stringify(N));let ae=typeof N+":"+N,ce=le.valuecache[ae];ce===void 0&&(le.values.push(N),ce=le.values.length-1,le.valuecache[ae]=ce),O.writeVarint(ce)}}function tt(le,O){return(O<<3)+(7&le)}function At(le){return le<<1^le>>31}function Yt(le,O){let U=le.loadGeometry(),N=le.type,Q=0,ae=0;for(let ce of U){let _e=1;N===1&&(_e=ce.length),O.writeVarint(tt(1,_e));let he=N===3?ce.length-1:ce.length;for(let Te=0;Te<he;Te++){Te===1&&N!==1&&O.writeVarint(tt(2,he-1));let ke=ce[Te].x-Q,Pe=ce[Te].y-ae;O.writeVarint(At(ke)),O.writeVarint(At(Pe)),Q+=ke,ae+=Pe}le.type===3&&O.writeVarint(tt(7,1))}}function pn(le,O){let U=typeof le;U==="string"?O.writeStringField(1,le):U==="boolean"?O.writeBooleanField(7,le):U==="number"&&(le%1!=0?O.writeDoubleField(3,le):le<0?O.writeSVarintField(6,le):O.writeVarintField(5,le))}let Ii={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},On=Math.fround||(wn=new Float32Array(1),le=>(wn[0]=+le,wn[0]));var wn;class Vn{constructor(O){this.options=Object.assign(Object.create(Ii),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){let{log:U,minZoom:N,maxZoom:Q}=this.options;U&&console.time("total time");let ae=`prepare ${O.length} points`;U&&console.time(ae),this.points=O;let ce=[];for(let he=0;he<O.length;he++){let Te=O[he];if(!Te.geometry)continue;let[ke,Pe]=Te.geometry.coordinates,Xe=On(Pr(ke)),pe=On(Cr(Pe));ce.push(Xe,pe,1/0,he,-1,1),this.options.reduce&&ce.push(0)}let _e=this.trees[Q+1]=this._createTree(ce);U&&console.timeEnd(ae);for(let he=Q;he>=N;he--){let Te=+Date.now();_e=this.trees[he]=this._createTree(this._cluster(_e,he)),U&&console.log("z%d: %d clusters in %dms",he,_e.numItems,+Date.now()-Te)}return U&&console.timeEnd("total time"),this}getClusters(O,U){let N=((O[0]+180)%360+360)%360-180,Q=Math.max(-90,Math.min(90,O[1])),ae=O[2]===180?180:((O[2]+180)%360+360)%360-180,ce=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)N=-180,ae=180;else if(N>ae){let Pe=this.getClusters([N,Q,180,ce],U),Xe=this.getClusters([-180,Q,ae,ce],U);return Pe.concat(Xe)}let _e=this.trees[this._limitZoom(U)],he=_e.range(Pr(N),Cr(ce),Pr(ae),Cr(Q)),Te=_e.data,ke=[];for(let Pe of he){let Xe=this.stride*Pe;ke.push(Te[Xe+5]>1?mo(Te,Xe,this.clusterProps):this.points[Te[Xe+3]])}return ke}getChildren(O){let U=this._getOriginId(O),N=this._getOriginZoom(O),Q="No cluster with the specified id.",ae=this.trees[N];if(!ae)throw new Error(Q);let ce=ae.data;if(U*this.stride>=ce.length)throw new Error(Q);let _e=this.options.radius/(this.options.extent*Math.pow(2,N-1)),he=ae.within(ce[U*this.stride],ce[U*this.stride+1],_e),Te=[];for(let ke of he){let Pe=ke*this.stride;ce[Pe+4]===O&&Te.push(ce[Pe+5]>1?mo(ce,Pe,this.clusterProps):this.points[ce[Pe+3]])}if(Te.length===0)throw new Error(Q);return Te}getLeaves(O,U,N){let Q=[];return this._appendLeaves(Q,O,U=U||10,N=N||0,0),Q}getTile(O,U,N){let Q=this.trees[this._limitZoom(O)],ae=Math.pow(2,O),{extent:ce,radius:_e}=this.options,he=_e/ce,Te=(N-he)/ae,ke=(N+1+he)/ae,Pe={features:[]};return this._addTileFeatures(Q.range((U-he)/ae,Te,(U+1+he)/ae,ke),Q.data,U,N,ae,Pe),U===0&&this._addTileFeatures(Q.range(1-he/ae,Te,1,ke),Q.data,ae,N,ae,Pe),U===ae-1&&this._addTileFeatures(Q.range(0,Te,he/ae,ke),Q.data,-1,N,ae,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(O){let U=this._getOriginZoom(O)-1;for(;U<=this.options.maxZoom;){let N=this.getChildren(O);if(U++,N.length!==1)break;O=N[0].properties.cluster_id}return U}_appendLeaves(O,U,N,Q,ae){let ce=this.getChildren(U);for(let _e of ce){let he=_e.properties;if(he&&he.cluster?ae+he.point_count<=Q?ae+=he.point_count:ae=this._appendLeaves(O,he.cluster_id,N,Q,ae):ae<Q?ae++:O.push(_e),O.length===N)break}return ae}_createTree(O){let U=new _.aI(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<O.length;N+=this.stride)U.add(O[N],O[N+1]);return U.finish(),U.data=O,U}_addTileFeatures(O,U,N,Q,ae,ce){for(let _e of O){let he=_e*this.stride,Te=U[he+5]>1,ke,Pe,Xe;if(Te)ke=Ir(U,he,this.clusterProps),Pe=U[he],Xe=U[he+1];else{let xt=this.points[U[he+3]];ke=xt.properties;let[Je,pt]=xt.geometry.coordinates;Pe=Pr(Je),Xe=Cr(pt)}let pe={type:1,geometry:[[Math.round(this.options.extent*(Pe*ae-N)),Math.round(this.options.extent*(Xe*ae-Q))]],tags:ke},lt;lt=Te||this.options.generateId?U[he+3]:this.points[U[he+3]].id,lt!==void 0&&(pe.id=lt),ce.features.push(pe)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,U){let{radius:N,extent:Q,reduce:ae,minPoints:ce}=this.options,_e=N/(Q*Math.pow(2,U)),he=O.data,Te=[],ke=this.stride;for(let Pe=0;Pe<he.length;Pe+=ke){if(he[Pe+2]<=U)continue;he[Pe+2]=U;let Xe=he[Pe],pe=he[Pe+1],lt=O.within(he[Pe],he[Pe+1],_e),xt=he[Pe+5],Je=xt;for(let pt of lt){let Jt=pt*ke;he[Jt+2]>U&&(Je+=he[Jt+5])}if(Je>xt&&Je>=ce){let pt,Jt=Xe*xt,Pi=pe*xt,Ci=-1,gi=(Pe/ke<<5)+(U+1)+this.points.length;for(let It of lt){let kt=It*ke;if(he[kt+2]<=U)continue;he[kt+2]=U;let vi=he[kt+5];Jt+=he[kt]*vi,Pi+=he[kt+1]*vi,he[kt+4]=gi,ae&&(pt||(pt=this._map(he,Pe,!0),Ci=this.clusterProps.length,this.clusterProps.push(pt)),ae(pt,this._map(he,kt)))}he[Pe+4]=gi,Te.push(Jt/Je,Pi/Je,1/0,gi,-1,Je),ae&&Te.push(Ci)}else{for(let pt=0;pt<ke;pt++)Te.push(he[Pe+pt]);if(Je>1)for(let pt of lt){let Jt=pt*ke;if(!(he[Jt+2]<=U)){he[Jt+2]=U;for(let Pi=0;Pi<ke;Pi++)Te.push(he[Jt+Pi])}}}}return Te}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,U,N){if(O[U+5]>1){let ce=this.clusterProps[O[U+6]];return N?Object.assign({},ce):ce}let Q=this.points[O[U+3]].properties,ae=this.options.map(Q);return N&&ae===Q?Object.assign({},ae):ae}}function mo(le,O,U){return{type:"Feature",id:le[O+3],properties:Ir(le,O,U),geometry:{type:"Point",coordinates:[(N=le[O],360*(N-.5)),Oa(le[O+1])]}};var N}function Ir(le,O,U){let N=le[O+5],Q=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,ae=le[O+6],ce=ae===-1?{}:Object.assign({},U[ae]);return Object.assign(ce,{cluster:!0,cluster_id:le[O+3],point_count:N,point_count_abbreviated:Q})}function Pr(le){return le/360+.5}function Cr(le){let O=Math.sin(le*Math.PI/180),U=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return U<0?0:U>1?1:U}function Oa(le){let O=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function Ot(le,O,U,N){let Q=N,ae=O+(U-O>>1),ce,_e=U-O,he=le[O],Te=le[O+1],ke=le[U],Pe=le[U+1];for(let Xe=O+3;Xe<U;Xe+=3){let pe=Nr(le[Xe],le[Xe+1],he,Te,ke,Pe);if(pe>Q)ce=Xe,Q=pe;else if(pe===Q){let lt=Math.abs(Xe-ae);lt<_e&&(ce=Xe,_e=lt)}}Q>N&&(ce-O>3&&Ot(le,O,ce,N),le[ce+2]=Q,U-ce>3&&Ot(le,ce,U,N))}function Nr(le,O,U,N,Q,ae){let ce=Q-U,_e=ae-N;if(ce!==0||_e!==0){let he=((le-U)*ce+(O-N)*_e)/(ce*ce+_e*_e);he>1?(U=Q,N=ae):he>0&&(U+=ce*he,N+=_e*he)}return ce=le-U,_e=O-N,ce*ce+_e*_e}function Xi(le,O,U,N){let Q={id:le??null,type:O,geometry:U,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(O==="Point"||O==="MultiPoint"||O==="LineString")fo(Q,U);else if(O==="Polygon")fo(Q,U[0]);else if(O==="MultiLineString")for(let ae of U)fo(Q,ae);else if(O==="MultiPolygon")for(let ae of U)fo(Q,ae[0]);return Q}function fo(le,O){for(let U=0;U<O.length;U+=3)le.minX=Math.min(le.minX,O[U]),le.minY=Math.min(le.minY,O[U+1]),le.maxX=Math.max(le.maxX,O[U]),le.maxY=Math.max(le.maxY,O[U+1])}function cr(le,O,U,N){if(!O.geometry)return;let Q=O.geometry.coordinates;if(Q&&Q.length===0)return;let ae=O.geometry.type,ce=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),_e=[],he=O.id;if(U.promoteId?he=O.properties[U.promoteId]:U.generateId&&(he=N||0),ae==="Point")Vr(Q,_e);else if(ae==="MultiPoint")for(let Te of Q)Vr(Te,_e);else if(ae==="LineString")go(Q,_e,ce,!1);else if(ae==="MultiLineString"){if(U.lineMetrics){for(let Te of Q)_e=[],go(Te,_e,ce,!1),le.push(Xi(he,"LineString",_e,O.properties));return}fn(Q,_e,ce,!1)}else if(ae==="Polygon")fn(Q,_e,ce,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(let Te of O.geometry.geometries)cr(le,{id:he,geometry:Te,properties:O.properties},U,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Te of Q){let ke=[];fn(Te,ke,ce,!0),_e.push(ke)}}le.push(Xi(he,ae,_e,O.properties))}function Vr(le,O){O.push(Ho(le[0]),Dn(le[1]),0)}function go(le,O,U,N){let Q,ae,ce=0;for(let he=0;he<le.length;he++){let Te=Ho(le[he][0]),ke=Dn(le[he][1]);O.push(Te,ke,0),he>0&&(ce+=N?(Q*ke-Te*ae)/2:Math.sqrt(Math.pow(Te-Q,2)+Math.pow(ke-ae,2))),Q=Te,ae=ke}let _e=O.length-3;O[2]=1,Ot(O,0,_e,U),O[_e+2]=1,O.size=Math.abs(ce),O.start=0,O.end=O.size}function fn(le,O,U,N){for(let Q=0;Q<le.length;Q++){let ae=[];go(le[Q],ae,U,N),O.push(ae)}}function Ho(le){return le/360+.5}function Dn(le){let O=Math.sin(le*Math.PI/180),U=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return U<0?0:U>1?1:U}function $n(le,O,U,N,Q,ae,ce,_e){if(N/=O,ae>=(U/=O)&&ce<N)return le;if(ce<U||ae>=N)return null;let he=[];for(let Te of le){let ke=Te.geometry,Pe=Te.type,Xe=Q===0?Te.minX:Te.minY,pe=Q===0?Te.maxX:Te.maxY;if(Xe>=U&&pe<N){he.push(Te);continue}if(pe<U||Xe>=N)continue;let lt=[];if(Pe==="Point"||Pe==="MultiPoint")Xo(ke,lt,U,N,Q);else if(Pe==="LineString")Ko(ke,lt,U,N,Q,!1,_e.lineMetrics);else if(Pe==="MultiLineString")hi(ke,lt,U,N,Q,!1);else if(Pe==="Polygon")hi(ke,lt,U,N,Q,!0);else if(Pe==="MultiPolygon")for(let xt of ke){let Je=[];hi(xt,Je,U,N,Q,!0),Je.length&&lt.push(Je)}if(lt.length){if(_e.lineMetrics&&Pe==="LineString"){for(let xt of lt)he.push(Xi(Te.id,Pe,xt,Te.tags));continue}Pe!=="LineString"&&Pe!=="MultiLineString"||(lt.length===1?(Pe="LineString",lt=lt[0]):Pe="MultiLineString"),Pe!=="Point"&&Pe!=="MultiPoint"||(Pe=lt.length===3?"Point":"MultiPoint"),he.push(Xi(Te.id,Pe,lt,Te.tags))}}return he.length?he:null}function Xo(le,O,U,N,Q){for(let ae=0;ae<le.length;ae+=3){let ce=le[ae+Q];ce>=U&&ce<=N&&fi(O,le[ae],le[ae+1],le[ae+2])}}function Ko(le,O,U,N,Q,ae,ce){let _e=Tn(le),he=Q===0?Gn:ur,Te,ke,Pe=le.start;for(let Je=0;Je<le.length-3;Je+=3){let pt=le[Je],Jt=le[Je+1],Pi=le[Je+2],Ci=le[Je+3],gi=le[Je+4],It=Q===0?pt:Jt,kt=Q===0?Ci:gi,vi=!1;ce&&(Te=Math.sqrt(Math.pow(pt-Ci,2)+Math.pow(Jt-gi,2))),It<U?kt>U&&(ke=he(_e,pt,Jt,Ci,gi,U),ce&&(_e.start=Pe+Te*ke)):It>N?kt<N&&(ke=he(_e,pt,Jt,Ci,gi,N),ce&&(_e.start=Pe+Te*ke)):fi(_e,pt,Jt,Pi),kt<U&&It>=U&&(ke=he(_e,pt,Jt,Ci,gi,U),vi=!0),kt>N&&It<=N&&(ke=he(_e,pt,Jt,Ci,gi,N),vi=!0),!ae&&vi&&(ce&&(_e.end=Pe+Te*ke),O.push(_e),_e=Tn(le)),ce&&(Pe+=Te)}let Xe=le.length-3,pe=le[Xe],lt=le[Xe+1],xt=Q===0?pe:lt;xt>=U&&xt<=N&&fi(_e,pe,lt,le[Xe+2]),Xe=_e.length-3,ae&&Xe>=3&&(_e[Xe]!==_e[0]||_e[Xe+1]!==_e[1])&&fi(_e,_e[0],_e[1],_e[2]),_e.length&&O.push(_e)}function Tn(le){let O=[];return O.size=le.size,O.start=le.start,O.end=le.end,O}function hi(le,O,U,N,Q,ae){for(let ce of le)Ko(ce,O,U,N,Q,ae,!1)}function fi(le,O,U,N){le.push(O,U,N)}function Gn(le,O,U,N,Q,ae){let ce=(ae-O)/(N-O);return fi(le,ae,U+(Q-U)*ce,1),ce}function ur(le,O,U,N,Q,ae){let ce=(ae-U)/(Q-U);return fi(le,O+(N-O)*ce,ae,1),ce}function _o(le,O){let U=[];for(let N=0;N<le.length;N++){let Q=le[N],ae=Q.type,ce;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")ce=hr(Q.geometry,O);else if(ae==="MultiLineString"||ae==="Polygon"){ce=[];for(let _e of Q.geometry)ce.push(hr(_e,O))}else if(ae==="MultiPolygon"){ce=[];for(let _e of Q.geometry){let he=[];for(let Te of _e)he.push(hr(Te,O));ce.push(he)}}U.push(Xi(Q.id,ae,ce,Q.tags))}return U}function hr(le,O){let U=[];U.size=le.size,le.start!==void 0&&(U.start=le.start,U.end=le.end);for(let N=0;N<le.length;N+=3)U.push(le[N]+O,le[N+1],le[N+2]);return U}function pr(le,O){if(le.transformed)return le;let U=1<<le.z,N=le.x,Q=le.y;for(let ae of le.features){let ce=ae.geometry,_e=ae.type;if(ae.geometry=[],_e===1)for(let he=0;he<ce.length;he+=2)ae.geometry.push(Yo(ce[he],ce[he+1],O,U,N,Q));else for(let he=0;he<ce.length;he++){let Te=[];for(let ke=0;ke<ce[he].length;ke+=2)Te.push(Yo(ce[he][ke],ce[he][ke+1],O,U,N,Q));ae.geometry.push(Te)}}return le.transformed=!0,le}function Yo(le,O,U,N,Q,ae){return[Math.round(U*(le*N-Q)),Math.round(U*(O*N-ae))]}function $r(le,O,U,N,Q){let ae=O===Q.maxZoom?0:Q.tolerance/((1<<O)*Q.extent),ce={features:[],numPoints:0,numSimplified:0,numFeatures:le.length,source:null,x:U,y:N,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let _e of le)Gr(ce,_e,ae,Q);return ce}function Gr(le,O,U,N){let Q=O.geometry,ae=O.type,ce=[];if(le.minX=Math.min(le.minX,O.minX),le.minY=Math.min(le.minY,O.minY),le.maxX=Math.max(le.maxX,O.maxX),le.maxY=Math.max(le.maxY,O.maxY),ae==="Point"||ae==="MultiPoint")for(let _e=0;_e<Q.length;_e+=3)ce.push(Q[_e],Q[_e+1]),le.numPoints++,le.numSimplified++;else if(ae==="LineString")Zr(ce,Q,le,U,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(let _e=0;_e<Q.length;_e++)Zr(ce,Q[_e],le,U,ae==="Polygon",_e===0);else if(ae==="MultiPolygon")for(let _e=0;_e<Q.length;_e++){let he=Q[_e];for(let Te=0;Te<he.length;Te++)Zr(ce,he[Te],le,U,!0,Te===0)}if(ce.length){let _e=O.tags||null;if(ae==="LineString"&&N.lineMetrics){_e={};for(let Te in O.tags)_e[Te]=O.tags[Te];_e.mapbox_clip_start=Q.start/Q.size,_e.mapbox_clip_end=Q.end/Q.size}let he={geometry:ce,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:_e};O.id!==null&&(he.id=O.id),le.features.push(he)}}function Zr(le,O,U,N,Q,ae){let ce=N*N;if(N>0&&O.size<(Q?ce:N))return void(U.numPoints+=O.length/3);let _e=[];for(let he=0;he<O.length;he+=3)(N===0||O[he+2]>ce)&&(U.numSimplified++,_e.push(O[he],O[he+1])),U.numPoints++;Q&&(function(he,Te){let ke=0;for(let Pe=0,Xe=he.length,pe=Xe-2;Pe<Xe;pe=Pe,Pe+=2)ke+=(he[Pe]-he[pe])*(he[Pe+1]+he[pe+1]);if(ke>0===Te)for(let Pe=0,Xe=he.length;Pe<Xe/2;Pe+=2){let pe=he[Pe],lt=he[Pe+1];he[Pe]=he[Xe-2-Pe],he[Pe+1]=he[Xe-1-Pe],he[Xe-2-Pe]=pe,he[Xe-1-Pe]=lt}})(_e,ae),le.push(_e)}let yo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class qr{constructor(O,U){let N=(U=this.options=(function(ae,ce){for(let _e in ce)ae[_e]=ce[_e];return ae})(Object.create(yo),U)).debug;if(N&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");let Q=(function(ae,ce){let _e=[];if(ae.type==="FeatureCollection")for(let he=0;he<ae.features.length;he++)cr(_e,ae.features[he],ce,he);else cr(_e,ae.type==="Feature"?ae:{geometry:ae},ce);return _e})(O,U);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Q=(function(ae,ce){let _e=ce.buffer/ce.extent,he=ae,Te=$n(ae,1,-1-_e,_e,0,-1,2,ce),ke=$n(ae,1,1-_e,2+_e,0,-1,2,ce);return(Te||ke)&&(he=$n(ae,1,-_e,1+_e,0,-1,2,ce)||[],Te&&(he=_o(Te,1).concat(he)),ke&&(he=he.concat(_o(ke,-1)))),he})(Q,U),Q.length&&this.splitTile(Q,0,0,0),N&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(O,U,N,Q,ae,ce,_e){let he=[O,U,N,Q],Te=this.options,ke=Te.debug;for(;he.length;){Q=he.pop(),N=he.pop(),U=he.pop(),O=he.pop();let Pe=1<<U,Xe=Wr(U,N,Q),pe=this.tiles[Xe];if(!pe&&(ke>1&&console.time("creation"),pe=this.tiles[Xe]=$r(O,U,N,Q,Te),this.tileCoords.push({z:U,x:N,y:Q}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,N,Q,pe.numFeatures,pe.numPoints,pe.numSimplified),console.timeEnd("creation"));let vi=`z${U}`;this.stats[vi]=(this.stats[vi]||0)+1,this.total++}if(pe.source=O,ae==null){if(U===Te.indexMaxZoom||pe.numPoints<=Te.indexMaxPoints)continue}else{if(U===Te.maxZoom||U===ae)continue;if(ae!=null){let vi=ae-U;if(N!==ce>>vi||Q!==_e>>vi)continue}}if(pe.source=null,O.length===0)continue;ke>1&&console.time("clipping");let lt=.5*Te.buffer/Te.extent,xt=.5-lt,Je=.5+lt,pt=1+lt,Jt=null,Pi=null,Ci=null,gi=null,It=$n(O,Pe,N-lt,N+Je,0,pe.minX,pe.maxX,Te),kt=$n(O,Pe,N+xt,N+pt,0,pe.minX,pe.maxX,Te);O=null,It&&(Jt=$n(It,Pe,Q-lt,Q+Je,1,pe.minY,pe.maxY,Te),Pi=$n(It,Pe,Q+xt,Q+pt,1,pe.minY,pe.maxY,Te),It=null),kt&&(Ci=$n(kt,Pe,Q-lt,Q+Je,1,pe.minY,pe.maxY,Te),gi=$n(kt,Pe,Q+xt,Q+pt,1,pe.minY,pe.maxY,Te),kt=null),ke>1&&console.timeEnd("clipping"),he.push(Jt||[],U+1,2*N,2*Q),he.push(Pi||[],U+1,2*N,2*Q+1),he.push(Ci||[],U+1,2*N+1,2*Q),he.push(gi||[],U+1,2*N+1,2*Q+1)}}getTile(O,U,N){O=+O,U=+U,N=+N;let Q=this.options,{extent:ae,debug:ce}=Q;if(O<0||O>24)return null;let _e=1<<O,he=Wr(O,U=U+_e&_e-1,N);if(this.tiles[he])return pr(this.tiles[he],ae);ce>1&&console.log("drilling down to z%d-%d-%d",O,U,N);let Te,ke=O,Pe=U,Xe=N;for(;!Te&&ke>0;)ke--,Pe>>=1,Xe>>=1,Te=this.tiles[Wr(ke,Pe,Xe)];return Te&&Te.source?(ce>1&&(console.log("found parent tile z%d-%d-%d",ke,Pe,Xe),console.time("drilling down")),this.splitTile(Te.source,ke,Pe,Xe,O,U,N),ce>1&&console.timeEnd("drilling down"),this.tiles[he]?pr(this.tiles[he],ae):null):null}}function Wr(le,O,U){return 32*((1<<le)*U+O)+le}class Hr extends Y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(O,U){return _._(this,void 0,void 0,function*(){let N=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let Q=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!Q)return null;let ae=new qe(Q.features,{version:2,extent:_.$}),ce=(function(_e){let he=new _.cM;return(function(Te,ke){for(let Pe in Te.layers)ke.writeMessage(3,Qe,Te.layers[Pe])})(_e,he),he.finish()})(ae);return ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),{vectorTile:ae,rawData:ce.buffer}})}loadData(O){return _._(this,void 0,void 0,function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();let N=!!(O&&O.request&&O.request.collectResourceTiming)&&new _.cN(O.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(O,this._pendingRequest);let Q=yield this._pendingData;this._geoJSONIndex=O.cluster?new Vn((function({superclusterOptions:ce,clusterProperties:_e}){if(!_e||!ce)return ce;let he={},Te={},ke={accumulated:null,zoom:0},Pe={properties:null},Xe=Object.keys(_e);for(let pe of Xe){let[lt,xt]=_e[pe],Je=_.cT(xt),pt=_.cT(typeof lt=="string"?[lt,["accumulated"],["get",pe]]:lt);he[pe]=Je.value,Te[pe]=pt.value}return ce.map=pe=>{Pe.properties=pe;let lt={};for(let xt of Xe)lt[xt]=he[xt].evaluate(ke,Pe);return lt},ce.reduce=(pe,lt)=>{Pe.properties=lt;for(let xt of Xe)ke.accumulated=pe[xt],pe[xt]=Te[xt].evaluate(ke,Pe)},ce})(O)).load(Q.features):(function(ce,_e){return new qr(ce,_e)})(Q,O.geojsonVtOptions),this.loaded={};let ae={data:Q};if(N){let ce=N.finish();ce&&(ae.resourceTiming={},ae.resourceTiming[O.source]=JSON.parse(JSON.stringify(ce)))}return ae}catch(Q){if(delete this._pendingRequest,_.cy(Q))return{abandoned:!0};throw Q}})}getData(){return _._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(O){let U=this.loaded;return U&&U[O.uid]?super.reloadTile(O):this.loadTile(O)}loadAndProcessGeoJSON(O,U){return _._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(O,U);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(Ae(N,!0),O.filter){let Q=_.cT(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(ce=>`${ce.key}: ${ce.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(ce=>Q.value.evaluate({zoom:0},ce))}}return N})}loadGeoJSON(O,U){return _._(this,void 0,void 0,function*(){let{promoteId:N}=O;if(O.request){let Q=yield _.j(O.request,U);return this._dataUpdateable=_.cV(Q.data,N)?_.cU(Q.data,N):void 0,Q.data}if(typeof O.data=="string")try{let Q=JSON.parse(O.data);return this._dataUpdateable=_.cV(Q,N)?_.cU(Q,N):void 0,Q}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return _.cW(this._dataUpdateable,O.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(O){return _._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}class Jo{constructor(O){this.self=O,this.actor=new _.J(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(U,N)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=N},this.self.addProtocol=_.cA,this.self.removeProtocol=_.cB,this.self.registerRTLTextPlugin=U=>{_.cX.setMethods(U)},this.actor.registerMessageHandler("LDT",(U,N)=>this._getDEMWorkerSource(U,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(U,N)=>_._(this,void 0,void 0,function*(){this._getDEMWorkerSource(U,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(U,N)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(U,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(U,N)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(U,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(U,N)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(U,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(U,N)=>this._getWorkerSource(U,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(U,N)=>this._getWorkerSource(U,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(U,N)=>this._getWorkerSource(U,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(U,N)=>this._getWorkerSource(U,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(U,N)=>this._getWorkerSource(U,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(U,N)=>this._getWorkerSource(U,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(U,N)=>_._(this,void 0,void 0,function*(){if(!this.workerSources[U]||!this.workerSources[U][N.type]||!this.workerSources[U][N.type][N.source])return;let Q=this.workerSources[U][N.type][N.source];delete this.workerSources[U][N.type][N.source],Q.removeSource!==void 0&&Q.removeSource(N)})),this.actor.registerMessageHandler("RM",U=>_._(this,void 0,void 0,function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U]})),this.actor.registerMessageHandler("SR",(U,N)=>_._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(U,N)=>this._syncRTLPluginState(U,N)),this.actor.registerMessageHandler("IS",(U,N)=>_._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(U,N)=>this._setImages(U,N)),this.actor.registerMessageHandler("UL",(U,N)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(U).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(U,N)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(U).replace(N)}))}_setImages(O,U){return _._(this,void 0,void 0,function*(){this.availableImages[O]=U;for(let N in this.workerSources[O]){let Q=this.workerSources[O][N];for(let ae in Q)Q[ae].availableImages=U}})}_syncRTLPluginState(O,U){return _._(this,void 0,void 0,function*(){return yield _.cX.syncState(U,this.self.importScripts)})}_getAvailableImages(O){let U=this.availableImages[O];return U||(U=[]),U}_getLayerIndex(O){let U=this.layerIndexes[O];return U||(U=this.layerIndexes[O]=new o),U}_getWorkerSource(O,U,N){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][U]||(this.workerSources[O][U]={}),!this.workerSources[O][U][N]){let Q={sendAsync:(ae,ce)=>(ae.targetMapId=O,this.actor.sendAsync(ae,ce))};switch(U){case"vector":this.workerSources[O][U][N]=new Y(Q,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][U][N]=new Hr(Q,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][U][N]=new this.externalWorkerSourceTypes[U](Q,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][U][N]}_getDEMWorkerSource(O,U){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][U]||(this.demWorkerSources[O][U]=new ne),this.demWorkerSources[O][U]}}return _.i(self)&&(self.worker=new Jo(self)),Jo}),u("index",["exports","./shared"],function(_,o){"use strict";var C="5.6.2";function B(){var h=new o.A(4);return o.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}let $,Y,ne={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h,e,r){let s=requestAnimationFrame(p=>{c(),e(p)}),{unsubscribe:c}=o.s(h.signal,"abort",()=>{c(),cancelAnimationFrame(s),r(o.c())},!1)},frameAsync(h){return new Promise((e,r)=>{this.frame(h,e,r)})},getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){let e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,r.drawImage(h,0,0,h.width,h.height),r},resolveURL:h=>($||($=document.createElement("a")),$.href=h,$.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Y==null&&(Y=matchMedia("(prefers-reduced-motion: reduce)")),Y.matches)}};class q{static testProp(e){if(!q.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in q.docStyle)return e[r];return e[0]}static create(e,r,s){let c=window.document.createElement(e);return r!==void 0&&(c.className=r),s&&s.appendChild(c),c}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(e,r){e.style[q.transformProp]=r}static addEventListener(e,r,s,c={}){e.addEventListener(r,s,"passive"in c?c:c.capture)}static removeEventListener(e,r,s,c={}){e.removeEventListener(r,s,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",q.suppressClickInternal,!0)},0)}static getScale(e){let r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,s){let c=r.boundingClientRect;return new o.P((s.clientX-c.left)/r.x-e.clientLeft,(s.clientY-c.top)/r.y-e.clientTop)}static mousePos(e,r){let s=q.getScale(e);return q.getPoint(e,s,r)}static touchPos(e,r){let s=[],c=q.getScale(e);for(let p=0;p<r.length;p++)s.push(q.getPoint(e,c,r[p]));return s}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),s=r.querySelectorAll("script");for(let c of s)c.remove();return q.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){let s=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!s.includes("javascript:")&&!s.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let r=e.children;for(let s of r)q.removeAttributes(s),q.clean(s)}static removeAttributes(e){for(let{name:r,value:s}of e.attributes)q.isPossiblyDangerous(r,s)&&e.removeAttribute(r)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);let Ce={supported:!1,testSupport:function(h){!De&&Ae&&(qe?Qe(h):Ie=h)}},Ie,Ae,De=!1,qe=!1;function Qe(h){let e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Ae),h.isContextLost())return;Ce.supported=!0}catch{}h.deleteTexture(e),De=!0}var nt;typeof document<"u"&&(Ae=document.createElement("img"),Ae.onload=()=>{Ie&&Qe(Ie),Ie=null,qe=!0},Ae.onerror=()=>{De=!0,Ie=null},Ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(h){let e,r,s,c;h.resetRequestQueue=()=>{e=[],r=0,s=0,c={}},h.addThrottleControl=T=>{let P=s++;return c[P]=T,P},h.removeThrottleControl=T=>{delete c[T],y()},h.getImage=(T,P,M=!0)=>new Promise((k,A)=>{Ce.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),o.e(T,{type:"image"}),e.push({abortController:P,requestParameters:T,supportImageRefresh:M,state:"queued",onError:D=>{A(D)},onSuccess:D=>{k(D)}}),y()});let p=T=>o._(this,void 0,void 0,function*(){T.state="running";let{requestParameters:P,supportImageRefresh:M,onError:k,onSuccess:A,abortController:D}=T,F=M===!1&&!o.i(self)&&!o.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((W,X)=>W&&X==="accept",!0));r++;let Z=F?w(P,D):o.m(P,D);try{let W=yield Z;delete T.abortController,T.state="completed",W.data instanceof HTMLImageElement||o.b(W.data)?A(W):W.data&&A({data:yield(G=W.data,typeof createImageBitmap=="function"?o.f(G):o.h(G)),cacheControl:W.cacheControl,expires:W.expires})}catch(W){delete T.abortController,k(W)}finally{r--,y()}var G}),y=()=>{let T=(()=>{for(let P of Object.keys(c))if(c[P]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=r;P<T&&e.length>0;P++){let M=e.shift();M.abortController.signal.aborted?P--:p(M)}},w=(T,P)=>new Promise((M,k)=>{let A=new Image,D=T.url,F=T.credentials;F&&F==="include"?A.crossOrigin="use-credentials":(F&&F==="same-origin"||!o.d(D))&&(A.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{A.src="",k(o.c())}),A.fetchPriority="high",A.onload=()=>{A.onerror=A.onload=null,M({data:A})},A.onerror=()=>{A.onerror=A.onload=null,P.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},A.src=D})})(nt||(nt={})),nt.resetRequestQueue();class vt{constructor(e){this._transformRequestFn=e??null}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function tt(h){let e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){let r=[];for(let{id:s,url:c}of h){let p=`${s}${c}`;r.indexOf(p)===-1&&(r.push(p),e.push({id:s,url:c}))}}return e}function At(h,e,r){try{let s=new URL(h);return s.pathname+=`${e}${r}`,s.toString()}catch{throw new Error(`Invalid sprite URL "${h}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Yt(h){let{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class pn extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:r,promiseResolve:s}of this.requestors)s(this._getImagesForIds(r));this.requestors=[]}}getImage(e){let r=this.images[e];if(r&&!r.data&&r.spriteData){let s=r.spriteData;r.data=new o.R({width:s.width,height:s.height},s.context.getImageData(s.x,s.y,s.width,s.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let s=!0,c=r.data||r.spriteData;return this._validateStretch(r.stretchX,c&&c.width)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchX" value`))),s=!1),this._validateStretch(r.stretchY,c&&c.height)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchY" value`))),s=!1),this._validateContent(r.content,r)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "content" value`))),s=!1),s}_validateStretch(e,r){if(!e)return!0;let s=0;for(let c of e){if(c[0]<s||c[1]<c[0]||r<c[1])return!1;s=c[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;let s=r.spriteData,c=s&&s.width||r.data.width,p=s&&s.height||r.data.height;return!(e[0]<0||c<e[0]||e[1]<0||p<e[1]||e[2]<0||c<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,s=!0){let c=this.getImage(e);if(s&&(c.data.width!==r.data.width||c.data.height!==r.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=c.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){let r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,s)=>{let c=!0;if(!this.isLoaded())for(let p of e)this.images[p]||(c=!1);this.isLoaded()||c?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){let r={};for(let s of e){let c=this.getImage(s);c||(this.fire(new o.l("styleimagemissing",{id:s})),c=this.getImage(s)),c?r[s]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:o.w(`Image "${s}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){let{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){let r=this.patterns[e],s=this.getImage(e);if(!s)return null;if(r&&r.position.version===s.version)return r.position;if(r)r.position.version=s.version;else{let c={w:s.data.width+2,h:s.data.height+2,x:0,y:0},p=new o.I(c,s);this.patterns[e]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let p in this.patterns)e.push(this.patterns[p].bin);let{w:r,h:s}=o.p(e),c=this.atlasImage;c.resize({width:r||1,height:s||1});for(let p in this.patterns){let{bin:y}=this.patterns[p],w=y.x+1,T=y.y+1,P=this.getImage(p).data,M=P.width,k=P.height;o.R.copy(P,c,{x:0,y:0},{x:w,y:T},{width:M,height:k}),o.R.copy(P,c,{x:0,y:k-1},{x:w,y:T-1},{width:M,height:1}),o.R.copy(P,c,{x:0,y:0},{x:w,y:T+k},{width:M,height:1}),o.R.copy(P,c,{x:M-1,y:0},{x:w-1,y:T},{width:1,height:k}),o.R.copy(P,c,{x:0,y:0},{x:w+M,y:T},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;let s=this.getImage(r);s||o.w(`Image with ID: "${r}" was not found`),Yt(s)&&this.updateImage(r,s)}}}let Ii=1e20;function On(h,e,r,s,c,p,y,w,T){for(let P=e;P<e+s;P++)wn(h,r*p+P,p,c,y,w,T);for(let P=r;P<r+c;P++)wn(h,P*p+e,1,s,y,w,T)}function wn(h,e,r,s,c,p,y){p[0]=0,y[0]=-Ii,y[1]=Ii,c[0]=h[e];for(let w=1,T=0,P=0;w<s;w++){c[w]=h[e+w*r];let M=w*w;do{let k=p[T];P=(c[w]-c[k]+M-k*k)/(w-k)/2}while(P<=y[T]&&--T>-1);T++,p[T]=w,y[T]=P,y[T+1]=Ii}for(let w=0,T=0;w<s;w++){for(;y[T+1]<w;)T++;let P=p[T],M=w-P;h[e+w*r]=c[P]+M*M}}class Vn{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,function*(){let r=[];for(let p in e)for(let y of e[p])r.push(this._getAndCacheGlyphsPromise(p,y));let s=yield Promise.all(r),c={};for(let{stack:p,id:y,glyph:w}of s)c[p]||(c[p]={}),c[p][y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return c})}_getAndCacheGlyphsPromise(e,r){return o._(this,void 0,void 0,function*(){let s=this.entries[e];s||(s=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=s.glyphs[r];if(c!==void 0)return{stack:e,id:r,glyph:c};if(c=this._tinySDF(s,e,r),c)return s.glyphs[r]=c,{stack:e,id:r,glyph:c};let p=Math.floor(r/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(s.ranges[p])return{stack:e,id:r,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!s.requests[p]){let w=Vn.loadGlyphRange(e,p,this.url,this.requestManager);s.requests[p]=w}let y=yield s.requests[p];for(let w in y)this._doesCharSupportLocalGlyph(+w)||(s.glyphs[+w]=y[+w]);return s.ranges[p]=!0,{stack:e,id:r,glyph:y[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||o.u["CJK Unified Ideographs"](e)||o.u["Hangul Syllables"](e)||o.u.Hiragana(e)||o.u.Katakana(e)||o.u["CJK Symbols and Punctuation"](e)||o.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,s){let c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),p=e.tinySDF=new Vn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:w})}let y=p.draw(String.fromCharCode(s));return{id:s,bitmap:new o.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}Vn.loadGlyphRange=function(h,e,r,s){return o._(this,void 0,void 0,function*(){let c=256*e,p=c+255,y=s.transformRequest(r.replace("{fontstack}",h).replace("{range}",`${c}-${p}`),"Glyphs"),w=yield o.n(y,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${p}`);let T={};for(let P of o.o(w.data))T[P.id]=P;return T})},Vn.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:y="normal",lang:w=null}={}){this.buffer=e,this.cutoff=s,this.radius=r,this.lang=w;let T=this.size=h+4*e,P=this._createCanvas(T),M=this.ctx=P.getContext("2d",{willReadFrequently:!0});M.font=`${y} ${p} ${h}px ${c}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(h){let e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(h),y=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),T=Math.min(this.size-this.buffer,y+Math.ceil(s)),P=w+2*this.buffer,M=T+2*this.buffer,k=Math.max(P*M,0),A=new Uint8ClampedArray(k),D={data:A,width:P,height:M,glyphWidth:w,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return D;let{ctx:F,buffer:Z,gridInner:G,gridOuter:W}=this;this.lang&&(F.lang=this.lang),F.clearRect(Z,Z,w,T),F.fillText(h,Z,Z+y);let X=F.getImageData(Z,Z,w,T);W.fill(Ii,0,k),G.fill(0,0,k);for(let ee=0;ee<T;ee++)for(let K=0;K<w;K++){let ie=X.data[4*(ee*w+K)+3]/255;if(ie===0)continue;let oe=(ee+Z)*P+K+Z;if(ie===1)W[oe]=0,G[oe]=Ii;else{let J=.5-ie;W[oe]=J>0?J*J:0,G[oe]=J<0?J*J:0}}On(W,0,0,P,M,P,this.f,this.v,this.z),On(G,Z,Z,w,T,P,this.f,this.v,this.z);for(let ee=0;ee<k;ee++){let K=Math.sqrt(W[ee])-Math.sqrt(G[ee]);A[ee]=Math.round(255-255*(K/this.radius+this.cutoff))}return D}};class mo{constructor(){this.specification=o.v.light.position}possiblyEvaluate(e,r){return o.B(e.expression.evaluate(r))}interpolate(e,r,s){return{x:o.C.number(e.x,r.x,s),y:o.C.number(e.y,r.y,s),z:o.C.number(e.z,r.z,s)}}}let Ir;class Pr extends o.E{constructor(e){super(),Ir=Ir||new o.r({anchor:new o.D(o.v.light.anchor),position:new mo,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(Ir),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(o.x,e,r))for(let s in e){let c=e[s];s.endsWith("-transition")?this._transitionable.setTransition(s.slice(0,-11),c):this._transitionable.setValue(s,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,s){return(!s||s.validate!==!1)&&o.y(this,e.call(o.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}let Cr=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class Oa extends o.E{constructor(e){super(),this._transitionable=new o.t(Cr),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(e,r={}){if(!this._validate(o.G,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let s in e){let c=e[s];s.endsWith("-transition")?this._transitionable.setTransition(s.slice(0,-11),c):this._transitionable.setValue(s,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,s={}){return s?.validate!==!1&&o.y(this,e.call(o.z,o.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ot{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){let s=e.join(",")+String(r);return this.dashEntry[s]||(this.dashEntry[s]=this.addDash(e,r)),this.dashEntry[s]}getDashRanges(e,r,s){let c=[],p=e.length%2==1?-e[e.length-1]*s:0,y=e[0]*s,w=!0;c.push({left:p,right:y,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let P=1;P<e.length;P++){w=!w;let M=e[P];p=T*s,T+=M,y=T*s,c.push({left:p,right:y,isDash:w,zeroLength:M===0})}return c}addRoundDash(e,r,s){let c=r/2;for(let p=-s;p<=s;p++){let y=this.width*(this.nextRow+s+p),w=0,T=e[w];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++w]);let M=Math.abs(P-T.left),k=Math.abs(P-T.right),A=Math.min(M,k),D,F=p/s*(c+1);if(T.isDash){let Z=c-Math.abs(F);D=Math.sqrt(A*A+Z*Z)}else D=c-Math.sqrt(A*A+F*F);this.data[y+P]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){let T=e[w],P=e[w+1];T.zeroLength?e.splice(w,1):P&&P.isDash===T.isDash&&(P.left=T.left,e.splice(w,1))}let r=e[0],s=e[e.length-1];r.isDash===s.isDash&&(r.left=s.left-this.width,s.right=r.right+this.width);let c=this.width*this.nextRow,p=0,y=e[p];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++p]);let T=Math.abs(w-y.left),P=Math.abs(w-y.right),M=Math.min(T,P);this.data[c+w]=Math.max(0,Math.min(255,(y.isDash?M:-M)+128))}}addDash(e,r){let s=r?7:0,c=2*s+1;if(this.nextRow+c>this.height)return o.w("LineAtlas out of space"),null;let p=0;for(let w=0;w<e.length;w++)p+=e[w];if(p!==0){let w=this.width/p,T=this.getDashRanges(e,this.width,w);r?this.addRoundDash(T,w,s):this.addRegularDash(T)}let y={y:(this.nextRow+s+.5)/this.height,height:2*s/this.height,width:p};return this.nextRow+=c,this.dirty=!0,y}bind(e){let r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}let Nr="maplibre_preloaded_worker_pool";class Xi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Xi.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Nr]}numActive(){return Object.keys(this.active).length}}let fo=Math.floor(ne.hardwareConcurrency/2),cr,Vr;function go(){return cr||(cr=new Xi),cr}Xi.workerCount=o.H(globalThis)?Math.max(Math.min(fo,3),1):1;class fn{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;let s=this.workerPool.acquire(r);for(let c=0;c<s.length;c++){let p=new o.J(s[c],r);p.name=`Worker ${c}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){let s=[];for(let c of this.actors)s.push(c.sendAsync({type:e,data:r}));return Promise.all(s)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(let s of this.actors)s.registerMessageHandler(e,r)}}function Ho(){return Vr||(Vr=new fn(go(),o.K),Vr.registerMessageHandler("GR",(h,e,r)=>o.m(e,r))),Vr}function Dn(h,e){let r=o.L();return o.M(r,r,[1,1,0]),o.N(r,r,[.5*h.width,.5*h.height,1]),h.calculatePosMatrix?o.O(r,r,h.calculatePosMatrix(e.toUnwrapped())):r}function $n(h,e,r,s,c,p,y){var w;let T=(function(A,D,F){if(A)for(let Z of A){let G=D[Z];if(G&&G.source===F&&G.type==="fill-extrusion")return!0}else for(let Z in D){let G=D[Z];if(G.source===F&&G.type==="fill-extrusion")return!0}return!1})((w=c?.layers)!==null&&w!==void 0?w:null,e,h.id),P=p.maxPitchScaleFactor(),M=h.tilesIn(s,P,T);M.sort(Xo);let k=[];for(let A of M)k.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(e,r,h._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,c,p,P,Dn(h.transform,A.tileID),y?(D,F)=>y(A.tileID,D,F):void 0)});return(function(A,D){for(let F in A)for(let Z of A[F])Ko(Z,D);return A})((function(A){let D={},F={};for(let Z of A){let G=Z.queryResults,W=Z.wrappedTileID,X=F[W]=F[W]||{};for(let ee in G){let K=G[ee],ie=X[ee]=X[ee]||{},oe=D[ee]=D[ee]||[];for(let J of K)ie[J.featureIndex]||(ie[J.featureIndex]=!0,oe.push(J))}}return D})(k),h)}function Xo(h,e){let r=h.tileID,s=e.tileID;return r.overscaledZ-s.overscaledZ||r.canonical.y-s.canonical.y||r.wrap-s.wrap||r.canonical.x-s.canonical.x}function Ko(h,e){let r=h.feature,s=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=s}function Tn(h,e,r){return o._(this,void 0,void 0,function*(){let s=h;if(h.url?s=(yield o.j(e.transformRequest(h.url,"Source"),r)).data:yield ne.frameAsync(r),!s)return null;let c=o.Q(o.e(s,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in s&&s.vector_layers&&(c.vectorLayerIds=s.vector_layers.map(p=>p.id)),c})}class hi{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}extend(e){let r=this._sw,s=this._ne,c,p;if(e instanceof o.S)c=e,p=e;else{if(!(e instanceof hi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(hi.convert(e)):this.extend(o.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.S.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return r||s?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new o.S(c.lng,c.lat),this._ne=new o.S(p.lng,p.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:s}=o.S.convert(e),c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return e instanceof hi?e:e&&new hi(e)}static fromLngLat(e,r=0){let s=360*r/40075017,c=s/Math.cos(Math.PI/180*e.lat);return new hi(new o.S(e.lng-c,e.lat-s),new o.S(e.lng+c,e.lat+s))}adjustAntiMeridian(){let e=new o.S(this._sw.lng,this._sw.lat),r=new o.S(this._ne.lng,this._ne.lat);return new hi(e,e.lng>r.lng?new o.S(r.lng+360,r.lat):r)}}class fi{constructor(e,r,s){this.bounds=hi.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=s||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let r=Math.pow(2,e.z),s=Math.floor(o.V(this.bounds.getWest())*r),c=Math.floor(o.U(this.bounds.getNorth())*r),p=Math.ceil(o.V(this.bounds.getEast())*r),y=Math.ceil(o.U(this.bounds.getSouth())*r);return e.x>=s&&e.x<p&&e.y>=c&&e.y<y}}class Gn extends o.E{constructor(e,r,s,c){if(super(),this.id=e,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(r,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Tn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new fi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,function*(){let r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};s.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,y)=>{e.reloadPromise={resolve:p,reject:y}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{let p=yield e.actor.sendAsync({type:c,data:s},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){let s=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(s.resolve).catch(s.reject)}}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ur extends o.E{constructor(e,r,s,c){super(),this.id=e,this.dispatcher=s,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},r),o.e(this,o.Q(r,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let r=yield Tn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(o.e(this,r),r.bounds&&(this.tileBounds=new fi(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this.fire(new o.k(r))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,function*(){let r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let s=yield nt.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){this.map._refreshExpiredTiles&&(s.cacheControl||s.expires)&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});let c=this.map.painter.context,p=c.gl,y=s.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new o.T(c,y,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class _o extends ur{constructor(e,r,s,c){super(e,r,s,c),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return o._(this,void 0,void 0,function*(){let r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let c=yield nt.getImage(s,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){let p=c.data;this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});let y=o.b(p)&&o.W()?p:yield this.readImageNow(p),w={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.X()){let r=e.width+2,s=e.height+2;try{return new o.R({width:r,height:s},yield o.Y(e,-1,-1,r,s))}catch{}}return ne.getImageData(e,1)})}_getNeighboringTiles(e){let r=e.canonical,s=Math.pow(2,r.z),c=(r.x-1+s)%s,p=r.x===0?e.wrap-1:e.wrap,y=(r.x+1+s)%s,w=r.x+1===s?e.wrap+1:e.wrap,T={};return T[new o.Z(e.overscaledZ,p,r.z,c,r.y).key]={backfilled:!1},T[new o.Z(e.overscaledZ,w,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(T[new o.Z(e.overscaledZ,p,r.z,c,r.y-1).key]={backfilled:!1},T[new o.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new o.Z(e.overscaledZ,w,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<s&&(T[new o.Z(e.overscaledZ,p,r.z,c,r.y+1).key]={backfilled:!1},T[new o.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new o.Z(e.overscaledZ,w,r.z,y,r.y+1).key]={backfilled:!1}),T}unloadTile(e){return o._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class hr extends o.E{constructor(e,r,s,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=s.getActor(),this.setEventedParent(c),this._data=r.data,this._options=o.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(o.$/this.tileSize)}_getClusterMaxZoom(e){let r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=o.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return o._(this,void 0,void 0,function*(){let e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(r=>r.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,function*(){let e=new hi,r=yield this.getData(),s;switch(r.type){case"FeatureCollection":s=r.features.map(c=>this.getCoordinatesFromGeometry(c.geometry)).flat(1/0);break;case"Feature":s=this.getCoordinatesFromGeometry(r.geometry);break;default:s=this.getCoordinatesFromGeometry(r)}if(s.length==0)return e;for(let c=0;c<s.length-1;c+=2)e.extend([s[c],s[c+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,s){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:s}})}_updateWorkerData(){return o._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;let{data:e,diff:r}=this._pendingWorkerUpdate;if(!e&&!r)return void o.w(`No data or diff provided to GeoJSONSource ${this.id}.`);let s=o.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(s.request=this.map._requestManager.transformRequest(ne.resolveURL(e),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):r&&(s.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{let c=yield this.actor.sendAsync({type:"LD",data:s});if(this._isUpdatingWorker=!1,this._removed||c.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));this._data=c.data;let p=null;c.resourceTiming&&c.resourceTiming[this.id]&&(p=c.resourceTiming[this.id].slice(0));let y={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&o.e(y,{resourceTiming:p}),this.fire(new o.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(c){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(c))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return o._(this,void 0,void 0,function*(){let r=e.actor?"RT":"LT";e.actor=this.actor;let s={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;let c=yield this.actor.sendAsync({type:r,data:s},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,r==="RT")})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class pr extends o.E{constructor(e,r,s,c){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=s,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=r}load(e){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let r=yield nt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new o.k(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let r=e.map(o.a1.fromLngLat);var s;return this.tileID=(function(c){let p=o.a2.fromPoints(c),y=p.width(),w=p.height(),T=Math.max(y,w),P=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),M=Math.pow(2,P);return new o.a4(P,Math.floor((p.minX+p.maxX)/2*M),Math.floor((p.minY+p.maxY)/2*M))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(c=>this.tileID.getTilePoint(c)._round()),this.flippedWindingOrder=((s=this.tileCoords)[1].x-s[0].x)*(s[2].y-s[0].y)-(s[1].y-s[0].y)*(s[2].x-s[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new o.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let s=!1;for(let c in this.tiles){let p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,s=!0)}s&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let{minX:r,minY:s,maxX:c,maxY:p}=o.a2.fromPoints(e),y={};for(let w=0;w<=o.a3;w++){let T=Math.pow(2,w),P=Math.floor(r*T),M=Math.floor(s*T),k=Math.floor(c*T),A=Math.floor(p*T);y[w]={minTileX:P,minTileY:M,maxTileX:k,maxTileY:A}}return y}}class Yo extends pr{constructor(e,r,s,c){super(e,r,s,c),this.roundZoom=!0,this.type="video",this.options=r}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{let r=yield o.a5(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new o.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new o.k(new o.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let s=!1;for(let c in this.tiles){let p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,s=!0)}s&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class $r extends pr{constructor(e,r,s,c){super(e,r,s,c),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(y=>typeof y!="number"))||this.fire(new o.k(new o.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a6(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.k(new o.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let r=this.map.painter.context,s=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,s.RGBA,{premultiply:!0});let c=!1;for(let p in this.tiles){let y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let Gr={},Zr=h=>{switch(h){case"geojson":return hr;case"image":return pr;case"raster":return ur;case"raster-dem":return _o;case"vector":return Gn;case"video":return Yo;case"canvas":return $r}return Gr[h]},yo="RTLPluginLoaded";class qr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ho()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,function*(r,s=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ne.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!s)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(yo))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Wr=null;function Hr(){return Wr||(Wr=new qr),Wr}class Jo{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=o.a7(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(c,p){let y={};if(!p)return y;for(let w of c){let T=w.layerIds.map(P=>p.getLayer(P)).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(P=>T.filter(M=>M.id===P)[0]));for(let P of T)y[P.id]=w}}return y})(e.buckets,r?.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let p=this.buckets[c];if(p instanceof o.a9){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let p=this.buckets[c];if(p instanceof o.a9&&p.hasRTLText){this.hasRTLText=!0,Hr().lazyLoad();break}}this.queryPadding=0;for(let c in this.buckets){let p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o.a8}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let s in this.buckets){let c=this.buckets[s];c.uploadPending()&&c.upload(e)}let r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,c,p,y,w,T,P,M,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:y,tileSize:this.tileSize,pixelPosMatrix:M,transform:T,params:w,queryPadding:this.queryPadding*P,getElevation:k},e,r,s):{}}querySourceFeatures(e,r){let s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;let c=s.loadVTLayers(),p=r&&r.sourceLayer?r.sourceLayer:"",y=c._geojsonTileLayer||c[p];if(!y)return;let w=o.aa(r&&r.filter),{z:T,x:P,y:M}=this.tileID.canonical,k={z:T,x:P,y:M};for(let A=0;A<y.length;A++){let D=y.feature(A);if(w.needGeometry){let G=o.ab(D,!0);if(!w.filter(new o.F(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!w.filter(new o.F(this.tileID.overscaledZ),D))continue;let F=s.getId(D,p),Z=new o.ac(D,T,P,M,F);Z.tile=k,e.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let r=this.expirationTime;if(e.cacheControl){let s=o.ad(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let s=Date.now(),c=!1;if(this.expirationTime>s)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{let p=this.expirationTime-r;p?this.expirationTime=s+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let s=this.latestFeatureIndex.loadVTLayers();for(let c in this.buckets){if(!r.style.hasLayer(c))continue;let p=this.buckets[c],y=p.layers[0].sourceLayer||"_geojsonTileLayer",w=s[y],T=e[y];if(!w||!T||Object.keys(T).length===0)continue;p.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});let P=r&&r.style&&r.style.getLayer(c);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ne.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ne.now()+e}setDependencies(e,r){let s={};for(let c of r)s[c]=!0;this.dependencies[e]=s}hasDependency(e,r){for(let s of e){let c=this.dependencies[s];if(c){for(let p of r)if(c[p])return!0}}return!1}}class le{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(let e in this.data)for(let r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){let c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let p={value:r,timeout:void 0};if(s!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},s)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){let y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){let r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;let s=e.wrapped().key,c=r===void 0?0:this.data[s].indexOf(r),p=this.data[s][c];return this.data[s].splice(c,1),p.timeout&&clearTimeout(p.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){let r=[];for(let s in this.data)for(let c of this.data[s])e(c.value)||r.push(c);for(let s of r)this.remove(s.value.tileID,s)}}class O{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){let c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},o.e(this.stateChanges[e][c],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(let p in this.state[e])p!==c&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(let p in this.state[e][c])s[p]||(this.deletedStates[e][c][p]=null)}else for(let p in s)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][p]===null&&delete this.deletedStates[e][c][p]}removeFeatureState(e,r,s){if(this.deletedStates[e]===null)return;let c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&r!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){let s=String(r),c=o.e({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let p=this.deletedStates[e][r];if(p===null)return{};for(let y in p)delete c[y]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){let s={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let p={};for(let y in this.stateChanges[c])this.state[c][y]||(this.state[c][y]={}),o.e(this.state[c][y],this.stateChanges[c][y]),p[y]=this.state[c][y];s[c]=p}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let p={};if(this.deletedStates[c]===null)for(let y in this.state[c])p[y]={},this.state[c][y]={};else for(let y in this.deletedStates[c]){if(this.deletedStates[c][y]===null)this.state[c][y]={};else for(let w of Object.keys(this.deletedStates[c][y]))delete this.state[c][y][w];p[y]=this.state[c][y]}s[c]=s[c]||{},o.e(s[c],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(let c in e)e[c].setFeatureState(s,r)}}let U=89.25;function N(h,e){let r=o.ah(e.lat,-o.ai,o.ai);return new o.P(o.V(e.lng)*h,o.U(r)*h)}function Q(h,e){return new o.a1(e.x/h,e.y/h).toLngLat()}function ae(h){return h.cameraToCenterDistance*Math.min(.85*Math.tan(o.ae(90-h.pitch)),Math.tan(o.ae(U-h.pitch)))}function ce(h,e){let r=h.canonical,s=e/o.af(r.z),c=r.x+Math.pow(2,r.z)*h.wrap,p=o.ag(new Float64Array(16));return o.M(p,p,[c*s,r.y*s,0]),o.N(p,p,[s/o.$,s/o.$,1]),p}function _e(h,e,r,s,c){let p=o.a1.fromLngLat(h,e),y=c*o.aj(1,h.lat),w=y*Math.cos(o.ae(r)),T=Math.sqrt(y*y-w*w),P=T*Math.sin(o.ae(-s)),M=T*Math.cos(o.ae(-s));return new o.a1(p.x+P,p.y+M,p.z+w)}function he(h,e,r){let s=e.intersectsFrustum(h);if(!r||s===0)return s;let c=e.intersectsPlane(r);return c===0?0:s===2&&c===2?2:1}function Te(h,e,r){let s=0,c=(r-e)/10;for(let p=0;p<10;p++)s+=c*Math.pow(Math.cos(e+(p+.5)/10*(r-e)),h);return s}function ke(h,e){return function(r,s,c,p,y){let w=2*((h-1)/o.ak(Math.cos(o.ae(U-y))/Math.cos(o.ae(U)))-1),T=Math.acos(c/p),P=2*Te(w-1,0,o.ae(y/2)),M=Math.min(o.ae(U),T+o.ae(y/2)),k=Te(w-1,Math.min(M,T-o.ae(y/2)),M),A=Math.atan(s/c),D=Math.hypot(s,c),F=r;return F+=o.ak(p/D/Math.max(.5,Math.cos(o.ae(y/2)))),F+=w*o.ak(Math.cos(A))/2,F-=o.ak(Math.max(1,k/P/e))/2,F}}let Pe=ke(9.314,3);function Xe(h,e){let r=(e.roundZoom?Math.round:Math.floor)(h.zoom+o.ak(h.tileSize/e.tileSize));return Math.max(0,r)}function pe(h,e){let r=h.getCameraFrustum(),s=h.getClippingPlane(),c=h.screenPointToMercatorCoordinate(h.getCameraPoint()),p=o.a1.fromLngLat(h.center,h.elevation);c.z=p.z+Math.cos(h.pitchInRadians)*h.cameraToCenterDistance/h.worldSize;let y=h.getCoveringTilesDetailsProvider(),w=y.allowVariableZoom(h,e),T=Xe(h,e),P=e.minzoom||0,M=e.maxzoom!==void 0?e.maxzoom:h.maxZoom,k=Math.min(Math.max(0,T),M),A=Math.pow(2,k),D=[A*c.x,A*c.y,0],F=[A*p.x,A*p.y,0],Z=Math.hypot(p.x-c.x,p.y-c.y),G=Math.abs(p.z-c.z),W=Math.hypot(Z,G),X=ie=>({zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}),ee=[],K=[];if(h.renderWorldCopies&&y.allowWorldCopies())for(let ie=1;ie<=3;ie++)ee.push(X(-ie)),ee.push(X(ie));for(ee.push(X(0));ee.length>0;){let ie=ee.pop(),oe=ie.x,J=ie.y,ue=ie.fullyVisible,xe={x:oe,y:J,z:ie.zoom},de=y.getTileBoundingVolume(xe,ie.wrap,h.elevation,e);if(!ue){let Be=he(r,de,s);if(Be===0)continue;ue=Be===2}let me=y.distanceToTile2d(c.x,c.y,xe,de),ye=T;w&&(ye=(e.calculateTileZoom||Pe)(h.zoom+o.ak(h.tileSize/e.tileSize),me,G,W,h.fov)),ye=(e.roundZoom?Math.round:Math.floor)(ye),ye=Math.max(0,ye);let ze=Math.min(ye,M);if(ie.wrap=y.getWrap(p,xe,ie.wrap),ie.zoom>=ze){if(ie.zoom<P)continue;let Be=k-ie.zoom,Me=D[0]-.5-(oe<<Be),We=D[1]-.5-(J<<Be),gt=e.reparseOverscaled?Math.max(ie.zoom,ye):ie.zoom;K.push({tileID:new o.Z(ie.zoom===M?gt:ie.zoom,ie.wrap,ie.zoom,oe,J),distanceSq:o.al([F[0]-.5-oe,F[1]-.5-J]),tileDistanceToCamera:Math.sqrt(Me*Me+We*We)})}else for(let Be=0;Be<4;Be++)ee.push({zoom:ie.zoom+1,x:(oe<<1)+Be%2,y:(J<<1)+(Be>>1),wrap:ie.wrap,fullyVisible:ue})}return K.sort((ie,oe)=>ie.distanceSq-oe.distanceSq).map(ie=>ie.tileID)}let lt=o.a2.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class xt extends o.E{constructor(e,r,s){super(),this.id=e,this.dispatcher=s,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,p,y,w)=>{let T=new(Zr(p.type))(c,p,y,w);if(T.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${T.id}`);return T})(e,r,s,this),this._tiles={},this._cache=new le(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new O,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,s){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,s)}catch(c){e.state="errored",c.status!==404?this._source.fire(new o.k(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let r in this._tiles){let s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Je).map(e=>e.key)}getRenderableIds(e){let r=[];for(let s in this._tiles)this._isIdRenderable(s,e)&&r.push(this._tiles[s]);return e?r.sort((s,c)=>{let p=s.tileID,y=c.tileID,w=new o.P(p.canonical.x,p.canonical.y)._rotate(-this.transform.bearingInRadians),T=new o.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return p.overscaledZ-y.overscaledZ||T.y-w.y||T.x-w.x}).map(s=>s.tileID.key):r.map(s=>s.tileID).sort(Je).map(s=>s.key)}hasRenderableParent(e){let r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let r in this._tiles)e?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return o._(this,void 0,void 0,function*(){let s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=r),yield this._loadTile(s,e,r))})}_tileLoaded(e,r,s){e.timeAdded=ne.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let r=this.getRenderableIds();for(let c=0;c<r.length;c++){let p=r[c];if(e.neighboringTiles&&e.neighboringTiles[p]){let y=this.getTileByID(p);s(e,y),s(y,e)}}function s(c,p){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let y=p.tileID.canonical.x-c.tileID.canonical.x,w=p.tileID.canonical.y-c.tileID.canonical.y,T=Math.pow(2,c.tileID.canonical.z),P=p.tileID.key;y===0&&w===0||Math.abs(w)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,y,w),c.neighboringTiles&&c.neighboringTiles[P]&&(c.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,c){for(let p in this._tiles){let y=this._tiles[p];if(c[p]||!y.hasData()||y.tileID.overscaledZ<=r||y.tileID.overscaledZ>s)continue;let w=y.tileID;for(;y&&y.tileID.overscaledZ>r+1;){let P=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[P.key],y&&y.hasData()&&(w=P)}let T=w;for(;T.overscaledZ>r;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]||e[T.canonical.key]){c[w.key]=w;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){let s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){let c=e.scaledTo(s),p=this._getLoadedTile(c);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let r=Math.ceil(e.width/this._source.tileSize)+1,s=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(r*s*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(e){let r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){let s={};for(let c in this._tiles){let p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),s[p.tileID.key]=p}this._tiles=s;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,r,s,c,p,y){let w={},T={},P=Object.keys(e),M=ne.now();for(let k of P){let A=e[k],D=this._tiles[k];if(!D||D.fadeEndTime!==0&&D.fadeEndTime<=M)continue;let F=this.findLoadedParent(A,r),Z=this.findLoadedSibling(A),G=F||Z||null;G&&(this._addTile(G.tileID),w[G.tileID.key]=G.tileID),T[k]=A}this._retainLoadedChildren(T,c,s,e);for(let k in w)e[k]||(this._coveredTiles[k]=!0,e[k]=w[k]);if(y){let k={},A={};for(let D of p)this._tiles[D.key].hasData()?k[D.key]=D:A[D.key]=D;for(let D in A){let F=A[D].children(this._source.maxzoom);this._tiles[F[0].key]&&this._tiles[F[1].key]&&this._tiles[F[2].key]&&this._tiles[F[3].key]&&(k[F[0].key]=e[F[0].key]=F[0],k[F[1].key]=e[F[1].key]=F[1],k[F[2].key]=e[F[2].key]=F[2],k[F[3].key]=e[F[3].key]=F[3],delete A[D])}for(let D in A){let F=A[D],Z=this.findLoadedParent(F,this._source.minzoom),G=this.findLoadedSibling(F),W=Z||G||null;if(W){k[W.tileID.key]=e[W.tileID.key]=W.tileID;for(let X in k)k[X].isChildOf(W.tileID)&&delete k[X]}}for(let D in this._tiles)k[D]||(this._coveredTiles[D]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let s;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new o.Z(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(s=pe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(s=s.filter(M=>this._source.hasTile(M)))):s=[];let c=Xe(e,this._source),p=Math.max(c-xt.maxOverzooming,this._source.minzoom),y=Math.max(c+xt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let M={};for(let k of s)if(k.canonical.z>this._source.minzoom){let A=k.scaledTo(k.canonical.z-1);M[A.key]=A;let D=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));M[D.key]=D}s=s.concat(Object.values(M))}let w=s.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let T=this._updateRetainedTiles(s,c);pt(this._source.type)&&this._updateCoveredAndRetainedTiles(T,p,y,c,s,r);for(let M in T)this._tiles[M].clearFadeHold();let P=o.am(this._tiles,T);for(let M of P){let k=this._tiles[M];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var s;let c={},p={},y=Math.max(r-xt.maxOverzooming,this._source.minzoom),w=Math.max(r+xt.maxUnderzooming,this._source.minzoom),T={};for(let P of e){let M=this._addTile(P);c[P.key]=P,M.hasData()||r<this._source.maxzoom&&(T[P.key]=P)}this._retainLoadedChildren(T,r,w,c);for(let P of e){let M=this._tiles[P.key];if(M.hasData())continue;if(r+1>this._source.maxzoom){let A=P.children(this._source.maxzoom)[0],D=this.getTile(A);if(D&&D.hasData()){c[A.key]=A;continue}}else{let A=P.children(this._source.maxzoom);if(c[A[0].key]&&c[A[1].key]&&c[A[2].key]&&c[A[3].key])continue}let k=M.wasRequested();for(let A=P.overscaledZ-1;A>=y;--A){let D=P.scaledTo(A);if(p[D.key])break;if(p[D.key]=!0,M=this.getTile(D),!M&&k&&(M=this._addTile(D)),M){let F=M.hasData();if((F||!(!((s=this.map)===null||s===void 0)&&s.cancelPendingTileRequestsWhileZooming)||k)&&(c[D.key]=D),k=M.wasRequested(),F)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let r=[],s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}r.push(c.key);let p=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(p),s)break;c=p}for(let p of r)this._loadedParentTiles[p]=s}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let r=this._tiles[e].tileID,s=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));let s=r;return r||(r=new Jo(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,s||this._source.fire(new o.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}refreshTiles(e){for(let r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some(s=>s.equals(this._tiles[r].tileID.canonical))&&this._reloadTile(r,"expired")}_removeTile(e){let r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){let r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,s){let c=[],p=this.transform;if(!p)return c;let y=p.getCoveringTilesDetailsProvider().allowWorldCopies(),w=s?p.getCameraQueryGeometry(e):e,T=D=>p.screenPointToMercatorCoordinate(D,this.terrain),P=this.transformBbox(e,T,!y),M=this.transformBbox(w,T,!y),k=this.getIds(),A=o.a2.fromPoints(M);for(let D=0;D<k.length;D++){let F=this._tiles[k[D]];if(F.holdingForFade())continue;let Z=y?[F.tileID]:[F.tileID.unwrapTo(-1),F.tileID.unwrapTo(0)],G=Math.pow(2,p.zoom-F.tileID.overscaledZ),W=r*F.queryPadding*o.$/F.tileSize/G;for(let X of Z){let ee=A.map(K=>X.getTilePoint(new o.a1(K.x,K.y)));if(ee.expandBy(W),ee.intersects(lt)){let K=P.map(oe=>X.getTilePoint(oe)),ie=M.map(oe=>X.getTilePoint(oe));c.push({tile:F,tileID:y?X:X.unwrapTo(0),queryGeometry:K,cameraQueryGeometry:ie,scale:G})}}}return c}transformBbox(e,r,s){let c=e.map(r);if(s){let p=o.a2.fromPoints(e);p.shrinkBy(.001*Math.min(p.width(),p.height()));let y=p.map(r);o.a2.fromPoints(c).covers(y)||(c=c.map(w=>w.x>.5?new o.a1(w.x-1,w.y,w.z):w))}return c}getVisibleCoordinates(e){let r=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(pt(this._source.type)){let e=ne.now();for(let r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){let c=this._tiles[e];c&&c.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(let s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}}function Je(h,e){let r=Math.abs(2*h.wrap)-+(h.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||s-r||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function pt(h){return h==="raster"||h==="image"||h==="video"}xt.maxOverzooming=10,xt.maxUnderzooming=3;class Jt{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.ah(e,0,1);let r=1,s=this._distances[r],c=e*this.paddedLength+this.padding;for(;s<c&&r<this._distances.length;)s=this._distances[++r];let p=r-1,y=this._distances[p],w=s-y,T=w>0?(c-y)/w:0;return this.points[p].mult(1-T).add(this.points[r].mult(T))}}function Pi(h,e){let r=!0;return h==="always"||h!=="never"&&e!=="never"||(r=!1),r}class Ci{constructor(e,r,s){let c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/s),this.yCellCount=Math.ceil(r/s);for(let y=0;y<this.xCellCount*this.yCellCount;y++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,s,c,p){this._forEachCell(r,s,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(e,r,s,c){this._forEachCell(r-c,s-c,r+c,s+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(s),this.circles.push(c)}_insertBoxCell(e,r,s,c,p,y){this.boxCells[p].push(y)}_insertCircleCell(e,r,s,c,p,y){this.circleCells[p].push(y)}_query(e,r,s,c,p,y,w){if(s<0||e>this.width||c<0||r>this.height)return[];let T=[];if(e<=0&&r<=0&&this.width<=s&&this.height<=c){if(p)return[{key:null,x1:e,y1:r,x2:s,y2:c}];for(let P=0;P<this.boxKeys.length;P++)T.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){let M=this.circles[3*P],k=this.circles[3*P+1],A=this.circles[3*P+2];T.push({key:this.circleKeys[P],x1:M-A,y1:k-A,x2:M+A,y2:k+A})}}else this._forEachCell(e,r,s,c,this._queryCell,T,{hitTest:p,overlapMode:y,seenUids:{box:{},circle:{}}},w);return T}query(e,r,s,c){return this._query(e,r,s,c,!1,null)}hitTest(e,r,s,c,p,y){return this._query(e,r,s,c,!0,p,y).length>0}hitTestCircle(e,r,s,c,p){let y=e-s,w=e+s,T=r-s,P=r+s;if(w<0||y>this.width||P<0||T>this.height)return!1;let M=[];return this._forEachCell(y,T,w,P,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:e,y:r,radius:s},seenUids:{box:{},circle:{}}},p),M.length>0}_queryCell(e,r,s,c,p,y,w,T){let{seenUids:P,hitTest:M,overlapMode:k}=w,A=this.boxCells[p];if(A!==null){let F=this.bboxes;for(let Z of A)if(!P.box[Z]){P.box[Z]=!0;let G=4*Z,W=this.boxKeys[Z];if(e<=F[G+2]&&r<=F[G+3]&&s>=F[G+0]&&c>=F[G+1]&&(!T||T(W))&&(!M||!Pi(k,W.overlapMode))&&(y.push({key:W,x1:F[G],y1:F[G+1],x2:F[G+2],y2:F[G+3]}),M))return!0}}let D=this.circleCells[p];if(D!==null){let F=this.circles;for(let Z of D)if(!P.circle[Z]){P.circle[Z]=!0;let G=3*Z,W=this.circleKeys[Z];if(this._circleAndRectCollide(F[G],F[G+1],F[G+2],e,r,s,c)&&(!T||T(W))&&(!M||!Pi(k,W.overlapMode))){let X=F[G],ee=F[G+1],K=F[G+2];if(y.push({key:W,x1:X-K,y1:ee-K,x2:X+K,y2:ee+K}),M)return!0}}}return!1}_queryCellCircle(e,r,s,c,p,y,w,T){let{circle:P,seenUids:M,overlapMode:k}=w,A=this.boxCells[p];if(A!==null){let F=this.bboxes;for(let Z of A)if(!M.box[Z]){M.box[Z]=!0;let G=4*Z,W=this.boxKeys[Z];if(this._circleAndRectCollide(P.x,P.y,P.radius,F[G+0],F[G+1],F[G+2],F[G+3])&&(!T||T(W))&&!Pi(k,W.overlapMode))return y.push(!0),!0}}let D=this.circleCells[p];if(D!==null){let F=this.circles;for(let Z of D)if(!M.circle[Z]){M.circle[Z]=!0;let G=3*Z,W=this.circleKeys[Z];if(this._circlesCollide(F[G],F[G+1],F[G+2],P.x,P.y,P.radius)&&(!T||T(W))&&!Pi(k,W.overlapMode))return y.push(!0),!0}}}_forEachCell(e,r,s,c,p,y,w,T){let P=this._convertToXCellCoord(e),M=this._convertToYCellCoord(r),k=this._convertToXCellCoord(s),A=this._convertToYCellCoord(c);for(let D=P;D<=k;D++)for(let F=M;F<=A;F++)if(p.call(this,e,r,s,c,this.xCellCount*F+D,y,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,s,c,p,y){let w=c-e,T=p-r,P=s+y;return P*P>w*w+T*T}_circleAndRectCollide(e,r,s,c,p,y,w){let T=(y-c)/2,P=Math.abs(e-(c+T));if(P>T+s)return!1;let M=(w-p)/2,k=Math.abs(r-(p+M));if(k>M+s)return!1;if(P<=T||k<=M)return!0;let A=P-T,D=k-M;return A*A+D*D<=s*s}}function gi(h,e,r){let s=o.L();if(!h){let{vecSouth:k,vecEast:A}=kt(e),D=B();D[0]=A[0],D[1]=A[1],D[2]=k[0],D[3]=k[1],c=D,(M=(y=(p=D)[0])*(P=p[3])-(T=p[2])*(w=p[1]))&&(c[0]=P*(M=1/M),c[1]=-w*M,c[2]=-T*M,c[3]=y*M),s[0]=D[0],s[1]=D[1],s[4]=D[2],s[5]=D[3]}var c,p,y,w,T,P,M;return o.N(s,s,[1/r,1/r,1]),s}function It(h,e,r,s){if(h){let c=o.L();if(!e){let{vecSouth:p,vecEast:y}=kt(r);c[0]=y[0],c[1]=y[1],c[4]=p[0],c[5]=p[1]}return o.N(c,c,[s,s,1]),c}return r.pixelsToClipSpaceMatrix}function kt(h){let e=Math.cos(h.rollInRadians),r=Math.sin(h.rollInRadians),s=Math.cos(h.pitchInRadians),c=Math.cos(h.bearingInRadians),p=Math.sin(h.bearingInRadians),y=o.ar();y[0]=-c*s*r-p*e,y[1]=-p*s*r+c*e;let w=o.as(y);w<1e-9?o.at(y):o.au(y,y,1/w);let T=o.ar();T[0]=c*s*e-p*r,T[1]=p*s*e+c*r;let P=o.as(T);return P<1e-9?o.at(T):o.au(T,T,1/P),{vecEast:T,vecSouth:y}}function vi(h,e,r,s){let c;s?(c=[h,e,s(h,e),1],o.aw(c,c,r)):(c=[h,e,0,1],ea(c,c,r));let p=c[3];return{point:new o.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function Re(h,e){return .5+h/e*.5}function Ki(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function si(h,e,r,s,c,p,y,w,T,P,M,k,A){let D=r?h.textSizeData:h.iconSizeData,F=o.an(D,e.transform.zoom),Z=[256/e.width*2+1,256/e.height*2+1],G=r?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();let W=h.lineVertexArray,X=r?h.text.placedSymbolArray:h.icon.placedSymbolArray,ee=e.transform.width/e.transform.height,K=!1;for(let ie=0;ie<X.length;ie++){let oe=X.get(ie);if(oe.hidden||oe.writingMode===o.ao.vertical&&!K){dr(oe.numGlyphs,G);continue}K=!1;let J=new o.P(oe.anchorX,oe.anchorY),ue={getElevation:A,pitchedLabelPlaneMatrix:s,lineVertexArray:W,pitchWithMap:p,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:J,unwrappedTileID:T,width:P,height:M,translation:k},xe=Kr(oe.anchorX,oe.anchorY,ue);if(!Ki(xe.point,Z)){dr(oe.numGlyphs,G);continue}let de=Re(e.transform.cameraToCenterDistance,xe.signedDistanceFromCamera),me=o.ap(D,F,oe),ye=p?me*e.transform.getPitchedTextCorrection(oe.anchorX,oe.anchorY,T)/de:me*de,ze=$e({projectionContext:ue,pitchedLabelPlaneMatrixInverse:c,symbol:oe,fontSize:ye,flip:!1,keepUpright:y,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:G,aspectRatio:ee,rotateToLine:w});K=ze.useVertical,(ze.notEnoughRoom||K||ze.needsFlipping&&$e({projectionContext:ue,pitchedLabelPlaneMatrixInverse:c,symbol:oe,fontSize:ye,flip:!0,keepUpright:y,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:G,aspectRatio:ee,rotateToLine:w}).notEnoughRoom)&&dr(oe.numGlyphs,G)}r?h.text.dynamicLayoutVertexBuffer.updateData(G):h.icon.dynamicLayoutVertexBuffer.updateData(G)}function Xr(h,e,r,s,c,p,y,w){let T=p.glyphStartIndex+p.numGlyphs,P=p.lineStartIndex,M=p.lineStartIndex+p.lineLength,k=e.getoffsetX(p.glyphStartIndex),A=e.getoffsetX(T-1),D=Yr(h*k,r,s,c,p.segment,P,M,w,y);if(!D)return null;let F=Yr(h*A,r,s,c,p.segment,P,M,w,y);return F?w.projectionCache.anyProjectionOccluded?null:{first:D,last:F}:null}function Qo(h,e,r,s){return h===o.ao.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*s?{useVertical:!0}:(h===o.ao.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function $e(h){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:s,fontSize:c,flip:p,keepUpright:y,glyphOffsetArray:w,dynamicLayoutVertexArray:T,aspectRatio:P,rotateToLine:M}=h,k=c/24,A=s.lineOffsetX*k,D=s.lineOffsetY*k,F;if(s.numGlyphs>1){let Z=s.glyphStartIndex+s.numGlyphs,G=s.lineStartIndex,W=s.lineStartIndex+s.lineLength,X=Xr(k,w,A,D,p,s,M,e);if(!X)return{notEnoughRoom:!0};let ee=vo(X.first.point.x,X.first.point.y,e,r),K=vo(X.last.point.x,X.last.point.y,e,r);if(y&&!p){let ie=Qo(s.writingMode,ee,K,P);if(ie)return ie}F=[X.first];for(let ie=s.glyphStartIndex+1;ie<Z-1;ie++){let oe=Yr(k*w.getoffsetX(ie),A,D,p,s.segment,G,W,e,M);if(!oe)return{notEnoughRoom:!0};F.push(oe)}F.push(X.last)}else{if(y&&!p){let G=Gi(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,W=s.lineStartIndex+s.segment+1,X=new o.P(e.lineVertexArray.getx(W),e.lineVertexArray.gety(W)),ee=Gi(X.x,X.y,e),K=ee.signedDistanceFromCamera>0?ee.point:bt(e.tileAnchorPoint,X,G,1,e),ie=vo(G.x,G.y,e,r),oe=vo(K.x,K.y,e,r),J=Qo(s.writingMode,ie,oe,P);if(J)return J}let Z=Yr(k*w.getoffsetX(s.glyphStartIndex),A,D,p,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,e,M);if(!Z||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};F=[Z]}for(let Z of F)o.av(T,Z.point,Z.angle);return{}}function bt(h,e,r,s,c){let p=h.add(h.sub(e)._unit()),y=Gi(p.x,p.y,c).point,w=r.sub(y);return r.add(w._mult(s/w.mag()))}function _t(h,e,r){let s=e.projectionCache;if(s.projections[h])return s.projections[h];let c=new o.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),p=Gi(c.x,c.y,e);if(p.signedDistanceFromCamera>0)return s.projections[h]=p.point,s.anyProjectionOccluded=s.anyProjectionOccluded||p.isOccluded,p.point;let y=h-r.direction;return bt(r.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),c,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Gi(h,e,r){let s=h+r.translation[0],c=e+r.translation[1],p;return r.pitchWithMap?(p=vi(s,c,r.pitchedLabelPlaneMatrix,r.getElevation),p.isOccluded=!1):(p=r.transform.projectTileCoordinates(s,c,r.unwrappedTileID,r.getElevation),p.point.x=(.5*p.point.x+.5)*r.width,p.point.y=(.5*-p.point.y+.5)*r.height),p}function vo(h,e,r,s){if(r.pitchWithMap){let c=[h,e,0,1];return o.aw(c,c,s),r.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],r.unwrappedTileID,r.getElevation).point}return{x:h/r.width*2-1,y:1-e/r.height*2}}function Kr(h,e,r){return r.transform.projectTileCoordinates(h,e,r.unwrappedTileID,r.getElevation)}function ft(h,e,r){return h._unit()._perp()._mult(e*r)}function Es(h,e,r,s,c,p,y,w,T){if(w.projectionCache.offsets[h])return w.projectionCache.offsets[h];let P=r.add(e);if(h+T.direction<s||h+T.direction>=c)return w.projectionCache.offsets[h]=P,P;let M=_t(h+T.direction,w,T),k=ft(M.sub(r),y,T.direction),A=r.add(k),D=M.add(k);return w.projectionCache.offsets[h]=o.ax(p,P,A,D)||P,w.projectionCache.offsets[h]}function Yr(h,e,r,s,c,p,y,w,T){let P=s?h-e:h+e,M=P>0?1:-1,k=0;s&&(M*=-1,k=Math.PI),M<0&&(k+=Math.PI);let A,D=M>0?p+c:p+c+1;w.projectionCache.cachedAnchorPoint?A=w.projectionCache.cachedAnchorPoint:(A=Gi(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=A);let F,Z,G=A,W=A,X=0,ee=0,K=Math.abs(P),ie=[],oe;for(;X+ee<=K;){if(D+=M,D<p||D>=y)return null;X+=ee,W=G,Z=F;let xe={absOffsetX:K,direction:M,distanceFromAnchor:X,previousVertex:W};if(G=_t(D,w,xe),r===0)ie.push(W),oe=G.sub(W);else{let de,me=G.sub(W);de=me.mag()===0?ft(_t(D+M,w,xe).sub(G),r,M):ft(me,r,M),Z||(Z=W.add(de)),F=Es(D,de,G,p,y,Z,r,w,xe),ie.push(Z),oe=F.sub(Z)}ee=oe.mag()}let J=oe._mult((K-X)/ee)._add(Z||W),ue=k+Math.atan2(G.y-W.y,G.x-W.x);return ie.push(J),{point:J,angle:T?ue:0,path:ie}}let As=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dr(h,e){for(let r=0;r<h;r++){let s=e.length;e.resize(s+4),e.float32.set(As,3*s)}}function ea(h,e,r){let s=e[0],c=e[1];return h[0]=r[0]*s+r[4]*c+r[12],h[1]=r[1]*s+r[5]*c+r[13],h[3]=r[3]*s+r[7]*c+r[15],h}let pi=100;class ks{constructor(e,r=new Ci(e.width+200,e.height+200,25),s=new Ci(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=s,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+pi,this.screenBottomBoundary=e.height+pi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,s,c,p,y,w,T,P,M,k,A){let D=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],p,M,A),F=s*D.perspectiveRatio,Z;if(y||w)Z=this._projectCollisionBox(e,F,c,p,y,w,T,D,M,k,A);else{let oe=D.x+(k?k.x*F:0),J=D.y+(k?k.y*F:0);Z={allPointsOccluded:!1,box:[oe+e.x1*F,J+e.y1*F,oe+e.x2*F,J+e.y2*F]}}let[G,W,X,ee]=Z.box,K=y?Z.allPointsOccluded:D.isOccluded,ie=K;return ie||(ie=D.perspectiveRatio<this.perspectiveRatioCutoff),ie||(ie=!this.isInsideGrid(G,W,X,ee)),ie||r!=="always"&&this.grid.hitTest(G,W,X,ee,r,P)?{box:[G,W,X,ee],placeable:!1,offscreen:!1,occluded:K}:{box:[G,W,X,ee],placeable:!0,offscreen:this.isOffscreen(G,W,X,ee),occluded:K}}placeCollisionCircles(e,r,s,c,p,y,w,T,P,M,k,A,D,F){let Z=[],G=new o.P(r.anchorX,r.anchorY),W=this.getPerspectiveRatio(G.x,G.y,y,F),X=(P?p*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,y)/W:p*W)/o.aB,ee={getElevation:F,pitchedLabelPlaneMatrix:w,lineVertexArray:s,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:G,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:D},K=Xr(X,c,r.lineOffsetX*X,r.lineOffsetY*X,!1,r,!1,ee),ie=!1,oe=!1,J=!0;if(K){let ue=.5*k*W+A,xe=new o.P(-100,-100),de=new o.P(this.screenRightBoundary,this.screenBottomBoundary),me=new Jt,ye=K.first,ze=K.last,Be=[];for(let gt=ye.path.length-1;gt>=1;gt--)Be.push(ye.path[gt]);for(let gt=1;gt<ze.path.length;gt++)Be.push(ze.path[gt]);let Me=2.5*ue;if(P){let gt=this.projectPathToScreenSpace(Be,ee);Be=gt.some(Bt=>Bt.signedDistanceFromCamera<=0)?[]:gt.map(Bt=>Bt.point)}let We=[];if(Be.length>0){let gt=Be[0].clone(),Bt=Be[0].clone();for(let Vt=1;Vt<Be.length;Vt++)gt.x=Math.min(gt.x,Be[Vt].x),gt.y=Math.min(gt.y,Be[Vt].y),Bt.x=Math.max(Bt.x,Be[Vt].x),Bt.y=Math.max(Bt.y,Be[Vt].y);We=gt.x>=xe.x&&Bt.x<=de.x&&gt.y>=xe.y&&Bt.y<=de.y?[Be]:Bt.x<xe.x||gt.x>de.x||Bt.y<xe.y||gt.y>de.y?[]:o.ay([Be],xe.x,xe.y,de.x,de.y)}for(let gt of We){me.reset(gt,.25*ue);let Bt=0;Bt=me.length<=.5*ue?1:Math.ceil(me.paddedLength/Me)+1;for(let Vt=0;Vt<Bt;Vt++){let jt=Vt/Math.max(Bt-1,1),ni=me.lerp(jt),ci=ni.x+pi,dt=ni.y+pi;Z.push(ci,dt,ue,0);let $t=ci-ue,bi=dt-ue,Mi=ci+ue,Fi=dt+ue;if(J=J&&this.isOffscreen($t,bi,Mi,Fi),oe=oe||this.isInsideGrid($t,bi,Mi,Fi),e!=="always"&&this.grid.hitTestCircle(ci,dt,ue,e,M)&&(ie=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ie}}}}return{circles:!T&&ie||!oe||W<this.perspectiveRatioCutoff?[]:Z,offscreen:J,collisionDetected:ie}}projectPathToScreenSpace(e,r){let s=(function(c,p){let y=o.L();return o.aq(y,p.pitchedLabelPlaneMatrix),c.map(w=>{let T=vi(w.x,w.y,y,p.getElevation),P=p.transform.projectTileCoordinates(T.point.x,T.point.y,p.unwrappedTileID,p.getElevation);return P.point.x=(.5*P.point.x+.5)*p.width,P.point.y=(.5*-P.point.y+.5)*p.height,P})})(e,r);return(function(c){let p=0,y=0,w=0,T=0;for(let P=0;P<c.length;P++)c[P].isOccluded?(w=P+1,T=0):(T++,T>y&&(y=T,p=w));return c.slice(p,p+y)})(s)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let r=[],s=new o.a2;for(let k of e){let A=new o.P(k.x+pi,k.y+pi);s.extend(A),r.push(A)}let{minX:c,minY:p,maxX:y,maxY:w}=s,T=this.grid.query(c,p,y,w).concat(this.ignoredGrid.query(c,p,y,w)),P={},M={};for(let k of T){let A=k.key;if(P[A.bucketInstanceId]===void 0&&(P[A.bucketInstanceId]={}),P[A.bucketInstanceId][A.featureIndex])continue;let D=[new o.P(k.x1,k.y1),new o.P(k.x2,k.y1),new o.P(k.x2,k.y2),new o.P(k.x1,k.y2)];o.az(r,D)&&(P[A.bucketInstanceId][A.featureIndex]=!0,M[A.bucketInstanceId]===void 0&&(M[A.bucketInstanceId]=[]),M[A.bucketInstanceId].push(A.featureIndex))}return M}insertCollisionBox(e,r,s,c,p,y){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:y,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,s,c,p,y){let w=s?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:p,collisionGroupID:y,overlapMode:r};for(let P=0;P<e.length;P+=4)w.insertCircle(T,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,r,s,c,p){if(p){let y;c?(y=[e,r,c(e,r),1],o.aw(y,y,p)):(y=[e,r,0,1],ea(y,y,p));let w=y[3];return{x:(y[0]/w+1)/2*this.transform.width+pi,y:(-y[1]/w+1)/2*this.transform.height+pi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{let y=this.transform.projectTileCoordinates(e,r,s,c);return{x:(y.point.x+1)/2*this.transform.width+pi,y:(1-y.point.y)/2*this.transform.height+pi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,s,c){let p=this.transform.projectTileCoordinates(e,r,s,c);return .5+this.transform.cameraToCenterDistance/p.signedDistanceFromCamera*.5}isOffscreen(e,r,s,c){return s<pi||e>=this.screenRightBoundary||c<pi||r>this.screenBottomBoundary}isInsideGrid(e,r,s,c){return s>=0&&e<this.gridRightBoundary&&c>=0&&r<this.gridBottomBoundary}getViewportMatrix(){let e=o.ag([]);return o.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,s,c,p,y,w,T,P,M,k){let A=1,D=0,F=0,Z=1,G=e.anchorPointX+w[0],W=e.anchorPointY+w[1];if(y&&!p){let Be=this.projectAndGetPerspectiveRatio(G+1,W,c,P,k),Me=Be.x-T.x,We=Math.atan((Be.y-T.y)/Me)+(Me<0?Math.PI:0),gt=Math.sin(We),Bt=Math.cos(We);A=Bt,D=gt,F=-gt,Z=Bt}else if(!y&&p){let Be=kt(this.transform);A=Be.vecEast[0],D=Be.vecEast[1],F=Be.vecSouth[0],Z=Be.vecSouth[1]}let X=T.x,ee=T.y,K=r;p&&(X=G,ee=W,K=Math.pow(2,-(this.transform.zoom-s.overscaledZ)),K*=this.transform.getPitchedTextCorrection(G,W,c),M||(K*=o.ah(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),M&&(X+=A*M.x*K+F*M.y*K,ee+=D*M.x*K+Z*M.y*K);let ie=e.x1*K,oe=e.x2*K,J=(ie+oe)/2,ue=e.y1*K,xe=e.y2*K,de=(ue+xe)/2,me=[{offsetX:ie,offsetY:ue},{offsetX:J,offsetY:ue},{offsetX:oe,offsetY:ue},{offsetX:oe,offsetY:de},{offsetX:oe,offsetY:xe},{offsetX:J,offsetY:xe},{offsetX:ie,offsetY:xe},{offsetX:ie,offsetY:de}],ye=[];for(let{offsetX:Be,offsetY:Me}of me)ye.push(new o.P(X+A*Be+F*Me,ee+D*Be+Z*Me));let ze=!1;if(p){let Be=ye.map(Me=>this.projectAndGetPerspectiveRatio(Me.x,Me.y,c,P,k));ze=Be.some(Me=>!Me.isOccluded),ye=Be.map(Me=>new o.P(Me.x,Me.y))}else ze=!0;return{box:o.aA(ye),allPointsOccluded:!ze}}}class gn{constructor(e,r,s,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):c&&s?1:0,this.placed=s}isHidden(){return this.opacity===0&&!this.placed}}class qt{constructor(e,r,s,c,p){this.text=new gn(e?e.text:null,r,s,p),this.icon=new gn(e?e.icon:null,r,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xu{constructor(e,r,s){this.text=e,this.icon=r,this.skipFade=s}}class ja{constructor(e,r,s,c,p){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=s,this.bucketIndex=c,this.tileID=p}}class Yl{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:s=>s.collisionGroupID===r}}return this.collisionGroups[e]}}function Jr(h,e,r,s,c){let{horizontalAlign:p,verticalAlign:y}=o.aH(h);return new o.P(-(p-.5)*e+s[0]*c,-(y-.5)*r+s[1]*c)}class Qr{constructor(e,r,s,c,p){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new ks(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Yl(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let r=this.terrain;return r?(s,c)=>r.getElevation(e,s,c):null}getBucketParts(e,r,s,c){let p=s.getBucket(r),y=s.latestFeatureIndex;if(!p||!y||r.id!==p.layerIds[0])return;let w=s.collisionBoxArray,T=p.layers[0].layout,P=p.layers[0].paint,M=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),k=s.tileSize/o.$,A=s.tileID.toUnwrapped(),D=T.get("text-rotation-alignment")==="map",F=o.aC(s,1,this.transform.zoom),Z=o.aD(this.collisionIndex.transform,s,P.get("text-translate"),P.get("text-translate-anchor")),G=o.aD(this.collisionIndex.transform,s,P.get("icon-translate"),P.get("icon-translate-anchor")),W=gi(D,this.transform,F);this.retainedQueryData[p.bucketInstanceId]=new ja(p.bucketInstanceId,y,p.sourceLayerIndex,p.index,s.tileID);let X={bucket:p,layout:T,translationText:Z,translationIcon:G,unwrappedTileID:A,pitchedLabelPlaneMatrix:W,scale:M,textPixelRatio:k,holdingForFade:s.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:o.an(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(let ee of p.sortKeyRanges){let{sortKey:K,symbolInstanceStart:ie,symbolInstanceEnd:oe}=ee;e.push({sortKey:K,symbolInstanceStart:ie,symbolInstanceEnd:oe,parameters:X})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:X})}attemptAnchorPlacement(e,r,s,c,p,y,w,T,P,M,k,A,D,F,Z,G,W,X,ee,K){let ie=o.aE[e.textAnchor],oe=[e.textOffset0,e.textOffset1],J=Jr(ie,s,c,oe,p),ue=this.collisionIndex.placeCollisionBox(r,A,T,P,M,w,y,G,k.predicate,ee,J,K);if((!X||this.collisionIndex.placeCollisionBox(X,A,T,P,M,w,y,W,k.predicate,ee,J,K).placeable)&&ue.placeable){let xe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[D.crossTileID]&&this.prevPlacement.placements[D.crossTileID]&&this.prevPlacement.placements[D.crossTileID].text&&(xe=this.prevPlacement.variableOffsets[D.crossTileID].anchor),D.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[D.crossTileID]={textOffset:oe,width:s,height:c,anchor:ie,textBoxScale:p,prevAnchor:xe},this.markUsedJustification(F,ie,D,Z),F.allowVerticalPlacement&&(this.markUsedOrientation(F,Z,D),this.placedOrientations[D.crossTileID]=Z),{shift:J,placedGlyphBoxes:ue}}}placeLayerBucketPart(e,r,s){let{bucket:c,layout:p,translationText:y,translationIcon:w,unwrappedTileID:T,pitchedLabelPlaneMatrix:P,textPixelRatio:M,holdingForFade:k,collisionBoxArray:A,partiallyEvaluatedTextSize:D,collisionGroup:F}=e.parameters,Z=p.get("text-optional"),G=p.get("icon-optional"),W=o.aF(p,"text-overlap","text-allow-overlap"),X=W==="always",ee=o.aF(p,"icon-overlap","icon-allow-overlap"),K=ee==="always",ie=p.get("text-rotation-alignment")==="map",oe=p.get("text-pitch-alignment")==="map",J=p.get("icon-text-fit")!=="none",ue=p.get("symbol-z-order")==="viewport-y",xe=X&&(K||!c.hasIconData()||G),de=K&&(X||!c.hasTextData()||Z);!c.collisionArrays&&A&&c.deserializeCollisionBoxes(A);let me=this.retainedQueryData[c.bucketInstanceId].tileID,ye=this._getTerrainElevationFunc(me),ze=this.transform.getFastPathSimpleProjectionMatrix(me),Be=(Me,We,gt)=>{var Bt,Vt;if(r[Me.crossTileID])return;if(k)return void(this.placements[Me.crossTileID]=new xu(!1,!1,!1));let jt=!1,ni=!1,ci=!0,dt=null,$t={box:null,placeable:!1,offscreen:null,occluded:!1},bi={placeable:!1},Mi=null,Fi=null,sn=null,Qn=0,ro=0,oo=0;We.textFeatureIndex?Qn=We.textFeatureIndex:Me.useRuntimeCollisionCircles&&(Qn=Me.featureIndex),We.verticalTextFeatureIndex&&(ro=We.verticalTextFeatureIndex);let ba=We.textBox;if(ba){let vn=wi=>{let Ei=o.ao.horizontal;if(c.allowVerticalPlacement&&!wi&&this.prevPlacement){let Bn=this.prevPlacement.placedOrientations[Me.crossTileID];Bn&&(this.placedOrientations[Me.crossTileID]=Bn,Ei=Bn,this.markUsedOrientation(c,Ei,Me))}return Ei},er=(wi,Ei)=>{if(c.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&We.verticalTextBox){for(let Bn of c.writingModes)if(Bn===o.ao.vertical?($t=Ei(),bi=$t):$t=wi(),$t&&$t.placeable)break}else $t=wi()},ln=Me.textAnchorOffsetStartIndex,ao=Me.textAnchorOffsetEndIndex;if(ao===ln){let wi=(Ei,Bn)=>{let Ti=this.collisionIndex.placeCollisionBox(Ei,W,M,me,T,oe,ie,y,F.predicate,ye,void 0,ze);return Ti&&Ti.placeable&&(this.markUsedOrientation(c,Bn,Me),this.placedOrientations[Me.crossTileID]=Bn),Ti};er(()=>wi(ba,o.ao.horizontal),()=>{let Ei=We.verticalTextBox;return c.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&Ei?wi(Ei,o.ao.vertical):{box:null,offscreen:null}}),vn($t&&$t.placeable)}else{let wi=o.aE[(Vt=(Bt=this.prevPlacement)===null||Bt===void 0?void 0:Bt.variableOffsets[Me.crossTileID])===null||Vt===void 0?void 0:Vt.anchor],Ei=(Ti,ps,Ta)=>{let Lr=Ti.x2-Ti.x1,tr=Ti.y2-Ti.y1,so=Me.textBoxScale,ph=J&&ee==="never"?ps:null,Pn=null,dh=W==="never"?1:2,Gc="never";wi&&dh++;for(let dl=0;dl<dh;dl++){for(let ml=ln;ml<ao;ml++){let lo=c.textAnchorOffsets.get(ml);if(wi&&lo.textAnchor!==wi)continue;let Dr=this.attemptAnchorPlacement(lo,Ti,Lr,tr,so,ie,oe,M,me,T,F,Gc,Me,c,Ta,y,w,ph,ye);if(Dr&&(Pn=Dr.placedGlyphBoxes,Pn&&Pn.placeable))return jt=!0,dt=Dr.shift,Pn}wi?wi=null:Gc=W}return s&&!Pn&&(Pn={box:this.collisionIndex.placeCollisionBox(ba,"always",M,me,T,oe,ie,y,F.predicate,ye,void 0,ze).box,offscreen:!1,placeable:!1,occluded:!1}),Pn};er(()=>Ei(ba,We.iconBox,o.ao.horizontal),()=>{let Ti=We.verticalTextBox;return c.allowVerticalPlacement&&(!$t||!$t.placeable)&&Me.numVerticalGlyphVertices>0&&Ti?Ei(Ti,We.verticalIconBox,o.ao.vertical):{box:null,occluded:!0,offscreen:null}}),$t&&(jt=$t.placeable,ci=$t.offscreen);let Bn=vn($t&&$t.placeable);if(!jt&&this.prevPlacement){let Ti=this.prevPlacement.variableOffsets[Me.crossTileID];Ti&&(this.variableOffsets[Me.crossTileID]=Ti,this.markUsedJustification(c,Ti.anchor,Me,Bn))}}}if(Mi=$t,jt=Mi&&Mi.placeable,ci=Mi&&Mi.offscreen,Me.useRuntimeCollisionCircles){let vn=c.text.placedSymbolArray.get(Me.centerJustifiedTextSymbolIndex),er=o.ap(c.textSizeData,D,vn),ln=p.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(W,vn,c.lineVertexArray,c.glyphOffsetArray,er,T,P,s,oe,F.predicate,Me.collisionCircleDiameter,ln,y,ye),Fi.circles.length&&Fi.collisionDetected&&!s&&o.w("Collisions detected, but collision boxes are not shown"),jt=X||Fi.circles.length>0&&!Fi.collisionDetected,ci=ci&&Fi.offscreen}if(We.iconFeatureIndex&&(oo=We.iconFeatureIndex),We.iconBox){let vn=er=>this.collisionIndex.placeCollisionBox(er,ee,M,me,T,oe,ie,w,F.predicate,ye,J&&dt?dt:void 0,ze);bi&&bi.placeable&&We.verticalIconBox?(sn=vn(We.verticalIconBox),ni=sn.placeable):(sn=vn(We.iconBox),ni=sn.placeable),ci=ci&&sn.offscreen}let wa=Z||Me.numHorizontalGlyphVertices===0&&Me.numVerticalGlyphVertices===0,Bo=G||Me.numIconVertices===0;wa||Bo?Bo?wa||(ni=ni&&jt):jt=ni&&jt:ni=jt=ni&&jt;let Oo=ni&&sn.placeable;if(jt&&Mi.placeable&&this.collisionIndex.insertCollisionBox(Mi.box,W,p.get("text-ignore-placement"),c.bucketInstanceId,bi&&bi.placeable&&ro?ro:Qn,F.ID),Oo&&this.collisionIndex.insertCollisionBox(sn.box,ee,p.get("icon-ignore-placement"),c.bucketInstanceId,oo,F.ID),Fi&&jt&&this.collisionIndex.insertCollisionCircles(Fi.circles,W,p.get("text-ignore-placement"),c.bucketInstanceId,Qn,F.ID),s&&this.storeCollisionData(c.bucketInstanceId,gt,We,Mi,sn,Fi),Me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Me.crossTileID]=new xu((jt||xe)&&!Mi?.occluded,(ni||de)&&!sn?.occluded,ci||c.justReloaded),r[Me.crossTileID]=!0};if(ue){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Me=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let We=Me.length-1;We>=0;--We){let gt=Me[We];Be(c.symbolInstances.get(gt),c.collisionArrays[gt],gt)}}else for(let Me=e.symbolInstanceStart;Me<e.symbolInstanceEnd;Me++)Be(c.symbolInstances.get(Me),c.collisionArrays[Me],Me);c.justReloaded=!1}storeCollisionData(e,r,s,c,p,y){if(s.textBox||s.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(r)?T=w.get(r):(T={text:null,icon:null},w.set(r,T)),s.textBox&&(T.text=c.box),s.iconBox&&(T.icon=p.box)}if(y){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)w.push(y.circles[T+0]-pi),w.push(y.circles[T+1]-pi),w.push(y.circles[T+2]),w.push(y.collisionDetected?1:0)}}markUsedJustification(e,r,s,c){let p;p=c===o.ao.vertical?s.verticalPlacedTextSymbolIndex:{left:s.leftJustifiedTextSymbolIndex,center:s.centerJustifiedTextSymbolIndex,right:s.rightJustifiedTextSymbolIndex}[o.aG(r)];let y=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex,s.verticalPlacedTextSymbolIndex];for(let w of y)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=p>=0&&w!==p?0:s.crossTileID)}markUsedOrientation(e,r,s){let c=r===o.ao.horizontal||r===o.ao.horizontalOnly?r:0,p=r===o.ao.vertical?r:0,y=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex];for(let w of y)e.text.placedSymbolArray.get(w).placedOrientation=c;s.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(s.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let r=this.prevPlacement,s=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;let c=r?r.symbolFadeChange(e):1,p=r?r.opacities:{},y=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(let T in this.placements){let P=this.placements[T],M=p[T];M?(this.opacities[T]=new qt(M,c,P.text,P.icon),s=s||P.text!==M.text.placed||P.icon!==M.icon.placed):(this.opacities[T]=new qt(null,c,P.text,P.icon,P.skipFade),s=s||P.text||P.icon)}for(let T in p){let P=p[T];if(!this.opacities[T]){let M=new qt(P,c,!1,!1);M.isHidden()||(this.opacities[T]=M,s=s||P.text.placed||P.icon.placed)}}for(let T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(let T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");s?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){let s={};for(let c of r){let p=c.getBucket(e);p&&c.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,c.tileID,s,c.collisionBoxArray)}}updateBucketOpacities(e,r,s,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let p=e.layers[0],y=p.layout,w=new qt(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),M=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=y.get("text-rotation-alignment")==="map",A=y.get("text-pitch-alignment")==="map",D=y.get("icon-text-fit")!=="none",F=new qt(null,0,T&&(P||!e.hasIconData()||y.get("icon-optional")),P&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);let Z=(W,X,ee)=>{for(let K=0;K<X/4;K++)W.opacityVertexArray.emplaceBack(ee);W.hasVisibleVertices=W.hasVisibleVertices||ee!==ia},G=this.collisionBoxArrays.get(e.bucketInstanceId);for(let W=0;W<e.symbolInstances.length;W++){let X=e.symbolInstances.get(W),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:K,crossTileID:ie}=X,oe=this.opacities[ie];s[ie]?oe=w:oe||(oe=F,this.opacities[ie]=oe),s[ie]=!0;let J=X.numIconVertices>0,ue=this.placedOrientations[X.crossTileID],xe=ue===o.ao.vertical,de=ue===o.ao.horizontal||ue===o.ao.horizontalOnly;if(ee>0||K>0){let ye=Ql(oe.text);Z(e.text,ee,xe?ia:ye),Z(e.text,K,de?ia:ye);let ze=oe.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(We=>{We>=0&&(e.text.placedSymbolArray.get(We).hidden=ze||xe?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=ze||de?1:0);let Be=this.variableOffsets[X.crossTileID];Be&&this.markUsedJustification(e,Be.anchor,X,ue);let Me=this.placedOrientations[X.crossTileID];Me&&(this.markUsedJustification(e,"left",X,Me),this.markUsedOrientation(e,Me,X))}if(J){let ye=Ql(oe.icon),ze=!(D&&X.verticalPlacedIconSymbolIndex&&xe);X.placedIconSymbolIndex>=0&&(Z(e.icon,X.numIconVertices,ze?ye:ia),e.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=oe.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(Z(e.icon,X.numVerticalIconVertices,ze?ia:ye),e.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=oe.icon.isHidden())}let me=G&&G.has(W)?G.get(W):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let ye=e.collisionArrays[W];if(ye){let ze=new o.P(0,0);if(ye.textBox||ye.verticalTextBox){let Be=!0;if(M){let Me=this.variableOffsets[ie];Me?(ze=Jr(Me.anchor,Me.width,Me.height,Me.textOffset,Me.textBoxScale),k&&ze._rotate(A?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Be=!1}if(ye.textBox||ye.verticalTextBox){let Me;ye.textBox&&(Me=xe),ye.verticalTextBox&&(Me=de),Jl(e.textCollisionBox.collisionVertexArray,oe.text.placed,!Be||Me,me.text,ze.x,ze.y)}}if(ye.iconBox||ye.verticalIconBox){let Be=!!(!de&&ye.verticalIconBox),Me;ye.iconBox&&(Me=Be),ye.verticalIconBox&&(Me=!Be),Jl(e.iconCollisionBox.collisionVertexArray,oe.icon.placed,Me,me.icon,D?ze.x:0,D?ze.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){let s=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*s>e}setStale(){this.stale=!0}}function Jl(h,e,r,s,c,p){s&&s.length!==0||(s=[0,0,0,0]);let y=s[0]-pi,w=s[1]-pi,T=s[2]-pi,P=s[3]-pi;h.emplaceBack(e?1:0,r?1:0,c||0,p||0,y,w),h.emplaceBack(e?1:0,r?1:0,c||0,p||0,T,w),h.emplaceBack(e?1:0,r?1:0,c||0,p||0,T,P),h.emplaceBack(e?1:0,r?1:0,c||0,p||0,y,P)}let bu=Math.pow(2,25),wu=Math.pow(2,24),ta=Math.pow(2,17),Tu=Math.pow(2,16),ap=Math.pow(2,9),sp=Math.pow(2,8),lp=Math.pow(2,1);function Ql(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;let e=h.placed?1:0,r=Math.floor(127*h.opacity);return r*bu+e*wu+r*ta+e*Tu+r*ap+e*sp+r*lp+e}let ia=0;class ec{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,s,c,p){let y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(y,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<y.length;)if(r.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,s),this._currentPartIndex++,p())return!0;return!1}}class tc{constructor(e,r,s,c,p,y,w,T){this.placement=new Qr(e,r,y,w,T),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,r,s){let c=ne.now(),p=()=>!this._forceFullPlacement&&ne.now()-c>2;for(;this._currentPlacementIndex>=0;){let y=r[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=w)&&(!y.maxzoom||y.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new ec(y)),this._inProgressLayer.continuePlacement(s[y.source],this.placement,this._showCollisionBoxes,y,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let na=512/o.$/2;class ic{constructor(e,r,s){this.tileID=e,this.bucketInstanceId=s,this._symbolsByKey={};let c=new Map;for(let p=0;p<r.length;p++){let y=r.get(p),w=y.key,T=c.get(w);T?T.push(y):c.set(w,[y])}for(let[p,y]of c){let w={positions:y.map(T=>({x:Math.floor(T.anchorX*na),y:Math.floor(T.anchorY*na)})),crossTileIDs:y.map(T=>T.crossTileID)};if(w.positions.length>128){let T=new o.aI(w.positions.length,16,Uint16Array);for(let{x:P,y:M}of w.positions)T.add(P,M);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[p]=w}}getScaledCoordinates(e,r){let{x:s,y:c,z:p}=this.tileID.canonical,{x:y,y:w,z:T}=r.canonical,P=na/Math.pow(2,T-p),M=(w*o.$+e.anchorY)*P,k=c*o.$*na;return{x:Math.floor((y*o.$+e.anchorX)*P-s*o.$*na),y:Math.floor(M-k)}}findMatches(e,r,s){let c=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let p=0;p<e.length;p++){let y=e.get(p);if(y.crossTileID)continue;let w=this._symbolsByKey[y.key];if(!w)continue;let T=this.getScaledCoordinates(y,r);if(w.index){let P=w.index.range(T.x-c,T.y-c,T.x+c,T.y+c).sort();for(let M of P){let k=w.crossTileIDs[M];if(!s[k]){s[k]=!0,y.crossTileID=k;break}}}else if(w.positions)for(let P=0;P<w.positions.length;P++){let M=w.positions[P],k=w.crossTileIDs[P];if(Math.abs(M.x-T.x)<=c&&Math.abs(M.y-T.y)<=c&&!s[k]){s[k]=!0,y.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class nc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let r=Math.round((e-this.lng)/360);if(r!==0)for(let s in this.indexes){let c=this.indexes[s],p={};for(let y in c){let w=c[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),p[w.tileID.key]=w}this.indexes[s]=p}this.lng=e}addBucket(e,r,s){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<r.symbolInstances.length;p++)r.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let c=this.usedCrossTileIDs[e.overscaledZ];for(let p in this.indexes){let y=this.indexes[p];if(Number(p)>e.overscaledZ)for(let w in y){let T=y[w];T.tileID.isChildOf(e)&&T.findMatches(r.symbolInstances,e,c)}else{let w=y[e.scaledTo(Number(p)).key];w&&w.findMatches(r.symbolInstances,e,c)}}for(let p=0;p<r.symbolInstances.length;p++){let y=r.symbolInstances.get(p);y.crossTileID||(y.crossTileID=s.generate(),c[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ic(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(let s of r.getCrossTileIDsLists())for(let c of s)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let r=!1;for(let s in this.indexes){let c=this.indexes[s];for(let p in c)e[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,c[p]),delete c[p],r=!0)}return r}}class ra{constructor(){this.layerIndexes={},this.crossTileIDs=new nc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,s){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new cp);let p=!1,y={};c.handleWrapJump(s);for(let w of r){let T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(w.tileID,T,this.crossTileIDs)&&(p=!0),y[T.bucketInstanceId]=!0)}return c.removeStaleBuckets(y)&&(p=!0),p}pruneUnusedLayers(e){let r={};e.forEach(s=>{r[s]=!0});for(let s in this.layerIndexes)r[s]||delete this.layerIndexes[s]}}var Ua="void main() {fragColor=vec4(1.0);}";let Zn={prelude:wt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:wt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:wt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:wt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:wt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wt(Ua,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:wt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:wt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:wt(Ua,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:wt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:wt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:wt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:wt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:wt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:wt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:wt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:wt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:wt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:wt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:wt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function wt(h,e){let r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=e.match(/in ([\w]+) ([\w]+)/g),c=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=p?p.concat(c):c,w={};return{fragmentSource:h=h.replace(r,(T,P,M,k,A)=>(w[A]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
in ${M} ${k} ${A};
#else
uniform ${M} ${k} u_${A};
#endif
`:`
#ifdef HAS_UNIFORM_u_${A}
    ${M} ${k} ${A} = u_${A};
#endif
`)),vertexSource:e=e.replace(r,(T,P,M,k,A)=>{let D=k==="float"?"vec2":"vec4",F=A.match(/color/)?"color":D;return w[A]?P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${M} ${D} a_${A};
out ${M} ${k} ${A};
#else
uniform ${M} ${k} u_${A};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${M} ${k} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = unpack_mix_${F}(a_${A}, u_${A}_t);
#else
    ${M} ${k} ${A} = u_${A};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${M} ${D} a_${A};
#else
uniform ${M} ${k} u_${A};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${M} ${k} ${A} = a_${A};
#else
    ${M} ${k} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${M} ${k} ${A} = unpack_mix_${F}(a_${A}, u_${A}_t);
#else
    ${M} ${k} ${A} = u_${A};
#endif
`}),staticAttributes:s,staticUniforms:y}}class xo{constructor(e,r,s){this.vertexBuffer=e,this.indexBuffer=r,this.segments=s}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var eo=o.aJ([{name:"a_pos",type:"Int16",components:2}]);let Mr="#define PROJECTION_MERCATOR",bo="mercator";class Tt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return bo}get shaderDefine(){return Mr}get shaderPreludeCode(){return Zn.projectionMercator}get vertexShaderPreludeCode(){return Zn.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,s,c,p){if(this._cachedMesh)return this._cachedMesh;let y=new o.aL;y.emplaceBack(0,0),y.emplaceBack(o.$,0),y.emplaceBack(0,o.$),y.emplaceBack(o.$,o.$);let w=e.createVertexBuffer(y,eo.members),T=o.aM.simpleSegment(0,0,4,2),P=new o.aN;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3);let M=e.createIndexBuffer(P);return this._cachedMesh=new xo(w,M,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class wo{constructor(e=0,r=0,s=0,c=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(s)||s<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=s,this.right=c}interpolate(e,r,s){return r.top!=null&&e.top!=null&&(this.top=o.C.number(e.top,r.top,s)),r.bottom!=null&&e.bottom!=null&&(this.bottom=o.C.number(e.bottom,r.bottom,s)),r.left!=null&&e.left!=null&&(this.left=o.C.number(e.left,r.left,s)),r.right!=null&&e.right!=null&&(this.right=o.C.number(e.right,r.right,s)),this}getCenter(e,r){let s=o.ah((this.left+e-this.right)/2,0,e),c=o.ah((this.top+r-this.bottom)/2,0,r);return new o.P(s,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new wo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ls(h,e){if(!h.renderWorldCopies||h.lngRange)return;let r=e.lng-h.center.lng;e.lng+=r>180?-360:r<-180?360:0}function Ds(h){return Math.max(0,Math.floor(h))}class nn{constructor(e,r,s,c,p,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ds(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new wo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,s){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Ds(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new wo(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!s&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let r=o.aO(e,-180,180)*Math.PI/180;var s,c,p,y,w,T,P,M,k;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=B(),s=this._rotationMatrix,p=-this._bearingInRadians,y=(c=this._rotationMatrix)[0],w=c[1],T=c[2],P=c[3],M=Math.sin(p),k=Math.cos(p),s[0]=y*k+T*M,s[1]=w*k+P*M,s[2]=y*-M+T*k,s[3]=w*-M+P*k)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let r=o.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aP(this._fovInRadians)}setFov(e){e=o.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=o.af(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,s){this._unmodified=!1,this._edgeInsets.interpolate(e,r,s),this._constrain(),this._calcMatrices()}resize(e,r,s=!0){this._width=e,this._height=r,s&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new hi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-o.ai,o.ai])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{let{minX:s,minY:c,maxX:p,maxY:y}=o.a2.fromPoints(r).extend(e);return[new o.P(s,c),new o.P(p,c),new o.P(p,y),new o.P(s,y),new o.P(s,c)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:r,zoom:s}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(s),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.ag(new Float64Array(16));o.N(e,e,[this._width/2,-this._height/2,1]),o.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.ag(new Float64Array(16)),o.N(e,e,[1,-1,1]),o.M(e,e,[-1,-1,0]),o.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,s,c){let p=s!==void 0?s:this.bearing,y=c=c!==void 0?c:this.pitch,w=o.a1.fromLngLat(e,r),T=-Math.cos(o.ae(y)),P=Math.sin(o.ae(y)),M=P*Math.sin(o.ae(p)),k=-P*Math.cos(o.ae(p)),A=this.elevation,D=r-A,F;T*D>=0||Math.abs(T)<.1?(F=1e4,A=r+F*T):F=-D/T;let Z,G,W=o.aQ(1,w.y),X=0;do{if(X+=1,X>10)break;G=F/W,Z=new o.a1(w.x+M*G,w.y+k*G),W=1/Z.meterInMercatorCoordinateUnits()}while(Math.abs(F-G*W)>1e-12);return{center:Z.toLngLat(),elevation:A,zoom:o.ak(this.height/2/Math.tan(this.fovInRadians/2)/G/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let r=o.aj(1,this.center.lat)*this.worldSize,s=this.cameraToCenterDistance/r,c=o.a1.fromLngLat(this.center,this.elevation),p=_e(this.center,this.elevation,this.pitch,this.bearing,s);this._elevation=e;let y=this.calculateCenterFromCameraLngLatAlt(p.toLngLat(),o.aQ(p.z,c.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=o.aj(1,this.center.lat)*this.worldSize;return _e(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/o.$,1/r/o.$]}}class zi{constructor(e,r){this.min=e,this.max=r,this.center=o.aR([],o.aS([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],s=o.aT(this.min),c=o.aT(this.max);for(let p=0;p<r.length;p++)s[p]=r[p]?this.min[p]:this.center[p],c[p]=r[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new zi(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let s=0;s<e.planes.length;s++){let c=this.intersectsPlane(e.planes[s]);if(c===0)return 0;c===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],s=e[3];for(let c=0;c<3;c++)e[c]>0?(r+=e[c]*this.min[c],s+=e[c]*this.max[c]):(s+=e[c]*this.min[c],r+=e[c]*this.max[c]);return r>=0?2:s<0?0:1}}class rn{distanceToTile2d(e,r,s,c){let p=c.distanceX([e,r]),y=c.distanceY([e,r]);return Math.hypot(p,y)}getWrap(e,r,s){return s}getTileBoundingVolume(e,r,s,c){var p,y;let w=0,T=0;if(c?.terrain){let M=new o.Z(e.z,r,e.z,e.x,e.y),k=c.terrain.getMinMaxElevation(M);w=(p=k.minElevation)!==null&&p!==void 0?p:Math.min(0,s),T=(y=k.maxElevation)!==null&&y!==void 0?y:Math.max(0,s)}let P=1<<e.z;return new zi([r+e.x/P,e.y/P,w],[r+(e.x+1)/P,(e.y+1)/P,T])}allowVariableZoom(e,r){let s=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,c=o.ah(78.5-s/2,0,60);return!!r.terrain||e.pitch>c}allowWorldCopies(){return!0}prepareNextFrame(){}}class xi{constructor(e,r,s){this.points=e,this.planes=r,this.aabb=s}static fromInvProjectionMatrix(e,r=1,s=0,c,p){let y=p?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,s),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>(function(D,F,Z,G){let W=o.aw([],D,F),X=1/W[3]/Z*G;return o.aY(W,W,[X,X,1/W[3],X])})(A,e,r,w));c&&(function(A,D,F,Z){let G=Z?4:0,W=Z?0:4,X=0,ee=[],K=[];for(let J=0;J<4;J++){let ue=o.aU([],A[J+W],A[J+G]),xe=o.aZ(ue);o.aR(ue,ue,1/xe),ee.push(xe),K.push(ue)}for(let J=0;J<4;J++){let ue=o.a_(A[J+G],K[J],F);X=ue!==null&&ue>=0?Math.max(X,ue):Math.max(X,ee[J])}let ie=(function(J,ue){let xe=o.aU([],J[ue[0]],J[ue[1]]),de=o.aU([],J[ue[2]],J[ue[1]]),me=[0,0,0,0];return o.aV(me,o.aW([],xe,de)),me[3]=-o.aX(me,J[ue[0]]),me})(A,D),oe=(function(J,ue){let xe=o.a$(J),de=o.b0([],J,1/xe),me=o.aU([],ue,o.aR([],de,o.aX(ue,de))),ye=o.a$(me);if(ye>0){let ze=Math.sqrt(1-de[3]*de[3]),Be=o.aR([],de,-de[3]),Me=o.aS([],Be,o.aR([],me,ze/ye));return o.b1(ue,Me)}return null})(F,ie);if(oe!==null){let J=oe/o.aX(K[0],ie);X=Math.min(X,J)}for(let J=0;J<4;J++){let ue=Math.min(X,ee[J]);A[J+W]=[A[J+G][0]+K[J][0]*ue,A[J+G][1]+K[J][1]*ue,A[J+G][2]+K[J][2]*ue,1]}})(T,y[0],c,p);let P=y.map(A=>{let D=o.aU([],T[A[0]],T[A[1]]),F=o.aU([],T[A[2]],T[A[1]]),Z=o.aV([],o.aW([],D,F)),G=-o.aX(Z,T[A[1]]);return Z.concat(G)}),M=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],k=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let A of T)for(let D=0;D<3;D++)M[D]=Math.min(M[D],A[D]),k[D]=Math.max(k[D],A[D]);return new xi(T,P,new zi(M,k))}}class Wt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,s){return this._helper.interpolatePadding(e,r,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,s=!0){this._helper.resize(e,r,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,s,c,p){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new nn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,w)=>this.getConstrained(y,w)},e,r,s,c,p),this._coveringTilesDetailsProvider=new rn}clone(){let e=new Wt;return e.apply(this),e}apply(e,r,s){this._helper.apply(e,r,s)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let r=[new o.b2(0,e)];if(this._helper._renderWorldCopies){let s=this.screenPointToMercatorCoordinate(new o.P(0,0)),c=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),p=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),w=Math.floor(Math.min(s.x,c.x,p.x,y.x)),T=Math.floor(Math.max(s.x,c.x,p.x,y.x)),P=1;for(let M=w-P;M<=T+P;M++)M!==0&&r.push(new o.b2(M,e))}return r}getCameraFrustum(){return xi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let r=this.screenPointToLocation(this.centerPoint,e),s=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(s)}setLocationAtPoint(e,r){let s=o.aj(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(r,s),p=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,s),y=o.a1.fromLngLat(e),w=new o.a1(y.x-(c.x-p.x),y.y-(c.y-p.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(o.a1.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a1.fromLngLat(e))}screenPointToLocation(e,r){var s;return(s=this.screenPointToMercatorCoordinate(e,r))===null||s===void 0?void 0:s.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){let s=r.pointCoordinate(e);if(s!=null)return s}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){let s=r||0,c=[e.x,e.y,0,1],p=[e.x,e.y,1,1];o.aw(c,c,this._pixelMatrixInverse),o.aw(p,p,this._pixelMatrixInverse);let y=c[3],w=p[3],T=c[1]/y,P=p[1]/w,M=c[2]/y,k=p[2]/w,A=M===k?0:(s-M)/(k-M);return new o.a1(o.C.number(c[0]/y,p[0]/w,A)/this.worldSize,o.C.number(T,P,A)/this.worldSize,s)}coordinatePoint(e,r=0,s=this._pixelMatrix){let c=[e.x*this.worldSize,e.y*this.worldSize,r,1];return o.aw(c,c,s),new o.P(c[0]/c[3],c[1]/c[3])}getBounds(){let e=Math.max(0,this._helper._height/2-ae(this));return new hi().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-ae(this)}calculatePosMatrix(e,r=!1,s){var c;let p=(c=e.key)!==null&&c!==void 0?c:o.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=r?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(p)){let P=y.get(p);return s?P.f32:P.f64}let w=ce(e,this.worldSize);o.O(w,r?this._alignedProjMatrix:this._viewProjMatrix,w);let T={f64:w,f32:new Float32Array(w)};return y.set(p,T),s?T.f32:T.f64}calculateFogMatrix(e){let r=e.key,s=this._fogMatrixCacheF32;if(s.has(r))return s.get(r);let c=ce(e,this.worldSize);return o.O(c,this._fogMatrix,c),s.set(r,new Float32Array(c)),s.get(r)}getConstrained(e,r){r=o.ah(+r,this.minZoom,this.maxZoom);let s={center:new o.S(e.lng,e.lat),zoom:r},c=this._helper._lngRange;if(!this._helper._renderWorldCopies&&c===null){let ee=179.9999999999;c=[-ee,ee]}let p=this.tileSize*o.af(s.zoom),y=0,w=p,T=0,P=p,M=0,k=0,{x:A,y:D}=this.size;if(this._helper._latRange){let ee=this._helper._latRange;y=o.U(ee[1])*p,w=o.U(ee[0])*p,w-y<D&&(M=D/(w-y))}c&&(T=o.aO(o.V(c[0])*p,0,p),P=o.aO(o.V(c[1])*p,0,p),P<T&&(P+=p),P-T<A&&(k=A/(P-T)));let{x:F,y:Z}=N(p,e),G,W,X=Math.max(k||0,M||0);if(X){let ee=new o.P(k?(P+T)/2:F,M?(w+y)/2:Z);return s.center=Q(p,ee).wrap(),s.zoom+=o.ak(X),s}if(this._helper._latRange){let ee=D/2;Z-ee<y&&(W=y+ee),Z+ee>w&&(W=w-ee)}if(c){let ee=(T+P)/2,K=F;this._helper._renderWorldCopies&&(K=o.aO(F,ee-p/2,ee+p/2));let ie=A/2;K-ie<T&&(G=T+ie),K+ie>P&&(G=P-ie)}if(G!==void 0||W!==void 0){let ee=new o.P(G??F,W??Z);s.center=Q(p,ee).wrap()}return s}calculateCenterFromCameraLngLatAlt(e,r,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,s,c)}_calculateNearFarZIfNeeded(e,r,s){if(!this._helper.autoCalculateNearFarZ)return;let c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),p=e-c*this._helper._pixelPerMeter/Math.cos(r),y=c<0?p:e,w=Math.PI/2+this.pitchInRadians,T=o.ae(this.fov)*(Math.abs(Math.cos(o.ae(this.roll)))*this.height+Math.abs(Math.sin(o.ae(this.roll)))*this.width)/this.height*(.5+s.y/this.height),P=Math.sin(T)*y/Math.sin(o.ah(Math.PI-w-T,.01,Math.PI-.01)),M=ae(this),k=Math.atan(M/this._helper.cameraToCenterDistance),A=o.ae(.75),D=k>A?2*k*(.5+s.y/(2*M)):A,F=Math.sin(D)*y/Math.sin(o.ah(Math.PI-w-D,.01,Math.PI-.01)),Z=Math.min(P,F);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*Z+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,r=N(this.worldSize,this.center),s=r.x,c=r.y;this._helper._pixelPerMeter=o.aj(1,this.center.lat)*this.worldSize;let p=o.ae(Math.min(this.pitch,U)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(p)),w;this._calculateNearFarZIfNeeded(y,p,e),w=new Float64Array(16),o.b4(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aq(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=o.b5(w),o.N(w,w,[1,-1,1]),o.M(w,w,[0,0,-this._helper.cameraToCenterDistance]),o.b6(w,w,-this.rollInRadians),o.b7(w,w,this.pitchInRadians),o.b6(w,w,-this.bearingInRadians),o.M(w,w,[-s,-c,0]),this._mercatorMatrix=o.N([],w,[this.worldSize,this.worldSize,this.worldSize]),o.N(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),o.M(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=o.aq([],w);let T=[0,0,-1,1];o.aw(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),o.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-s,-c,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);let P=this._helper._width%2/2,M=this._helper._height%2/2,k=Math.cos(this.bearingInRadians),A=Math.sin(-this.bearingInRadians),D=s-Math.round(s)+k*P+A*M,F=c-Math.round(c)+k*M+A*P,Z=new Float64Array(w);if(o.M(Z,Z,[D>.5?D-1:D,F>.5?F-1:F,0]),this._alignedProjMatrix=Z,w=o.aq(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new o.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.aw(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=o.aj(1,this.center.lat)*this.worldSize;return _e(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){let s=o.a1.fromLngLat(e),c=[s.x*this.worldSize,s.y*this.worldSize,r,1];return o.aw(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(e){let{overscaledTileID:r,aligned:s,applyTerrainMatrix:c}=e,p=this._helper.getMercatorTileCoordinates(r),y=r?this.calculatePosMatrix(r,s,!0):null,w;return w=r&&r.terrainRttPosMatrix32f&&c?r.terrainRttPosMatrix32f:y||o.b8(),{mainMatrix:w,tileMercatorCoords:p,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,s){return 1}transformLightDirection(e){return o.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,s,c){let p=this.calculatePosMatrix(s),y;c?(y=[e,r,c(e,r),1],o.aw(y,y,p)):(y=[e,r,0,1],ea(y,y,p));let w=y[3];return{point:new o.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(let r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){let s=o.a1.fromLngLat(e,r),c=s.meterInMercatorCoordinateUnits(),p=o.b9();return o.M(p,p,[s.x,s.y,s.z]),o.b6(p,p,Math.PI),o.b7(p,p,Math.PI/2),o.N(p,p,[-c,c,c]),p}getProjectionDataForCustomLayer(e=!0){let r=new o.Z(0,0,0,0,0),s=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),c=ce(r,this.worldSize);o.O(c,this._viewProjMatrix,c),s.tileMercatorCoords=[0,0,1,1];let p=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],y=o.ba();return o.N(y,c,p),s.fallbackMatrix=y,s.mainMatrix=y,s}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Su(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function on(h){if(h.useSlerp)if(h.k<1){let e=o.bb(h.startEulerAngles.roll,h.startEulerAngles.pitch,h.startEulerAngles.bearing),r=o.bb(h.endEulerAngles.roll,h.endEulerAngles.pitch,h.endEulerAngles.bearing),s=new Float64Array(4);o.bc(s,e,r,h.k);let c=o.bd(s);h.tr.setRoll(c.roll),h.tr.setPitch(c.pitch),h.tr.setBearing(c.bearing)}else h.tr.setRoll(h.endEulerAngles.roll),h.tr.setPitch(h.endEulerAngles.pitch),h.tr.setBearing(h.endEulerAngles.bearing);else h.tr.setRoll(o.C.number(h.startEulerAngles.roll,h.endEulerAngles.roll,h.k)),h.tr.setPitch(o.C.number(h.startEulerAngles.pitch,h.endEulerAngles.pitch,h.k)),h.tr.setBearing(o.C.number(h.startEulerAngles.bearing,h.endEulerAngles.bearing,h.k))}function Sn(h,e,r,s,c){let p=c.padding,y=N(c.worldSize,r.getNorthWest()),w=N(c.worldSize,r.getNorthEast()),T=N(c.worldSize,r.getSouthEast()),P=N(c.worldSize,r.getSouthWest()),M=o.ae(-s),k=y.rotate(M),A=w.rotate(M),D=T.rotate(M),F=P.rotate(M),Z=new o.P(Math.max(k.x,A.x,F.x,D.x),Math.max(k.y,A.y,F.y,D.y)),G=new o.P(Math.min(k.x,A.x,F.x,D.x),Math.min(k.y,A.y,F.y,D.y)),W=Z.sub(G),X=(c.width-(p.left+p.right+e.left+e.right))/W.x,ee=(c.height-(p.top+p.bottom+e.top+e.bottom))/W.y;if(ee<0||X<0)return void Su();let K=Math.min(o.ak(c.scale*Math.min(X,ee)),h.maxZoom),ie=o.P.convert(h.offset),oe=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.ae(s)),J=ie.add(oe).mult(c.scale/o.af(K));return{center:Q(c.worldSize,y.add(T).div(2).sub(J)),zoom:K,bearing:s}}class Yi{get useGlobeControls(){return!1}handlePanInertia(e,r){return{easingOffset:e,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,s){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(s,e.around)}cameraForBoxAndBearing(e,r,s,c,p){return Sn(e,r,s,c,p)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(o.S.convert(r.center))}handleEaseTo(e,r){let s=e.zoom,c=e.padding,p={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},w=r.zoom!==void 0,T=!e.isPaddingEqual(r.padding),P=!1,M=w?+r.zoom:e.zoom,k=e.centerPoint.add(r.offsetAsPoint),A=e.screenPointToLocation(k),{center:D,zoom:F}=e.getConstrained(o.S.convert(r.center||A),M??s);Ls(e,D);let Z=N(e.worldSize,A),G=N(e.worldSize,D).sub(Z),W=o.af(F-s);return P=F!==s,{easeFunc:X=>{if(P&&e.setZoom(o.C.number(s,F,X)),o.be(p,y)||on({startEulerAngles:p,endEulerAngles:y,tr:e,k:X,useSlerp:p.roll!=y.roll}),T&&(e.interpolatePadding(c,r.padding,X),k=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{let ee=o.af(e.zoom-s),K=F>s?Math.min(2,W):Math.max(.5,W),ie=Math.pow(K,1-X),oe=Q(e.worldSize,Z.add(G.mult(X*ie)).mult(ee));e.setLocationAtPoint(e.renderWorldCopies?oe.wrap():oe,k)}},isZooming:P,elevationCenter:D}}handleFlyTo(e,r){let s=r.zoom!==void 0,c=e.zoom,p=e.getConstrained(o.S.convert(r.center||r.locationAtOffset),s?+r.zoom:c),y=p.center,w=p.zoom;Ls(e,y);let T=N(e.worldSize,r.locationAtOffset),P=N(e.worldSize,y).sub(T),M=P.mag(),k=o.af(w-c),A;if(r.minZoom!==void 0){let D=Math.min(+r.minZoom,c,w),F=e.getConstrained(y,D).zoom;A=o.af(F-c)}return{easeFunc:(D,F,Z,G)=>{e.setZoom(D===1?w:c+o.ak(F));let W=D===1?y:Q(e.worldSize,T.add(P.mult(Z)).mult(F));e.setLocationAtPoint(e.renderWorldCopies?W.wrap():W,G)},scaleOfZoom:k,targetCenter:y,scaleOfMinZoom:A,pixelPathLength:M}}}class ei{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}ei.Replace=[1,0],ei.disabled=new ei(ei.Replace,o.bf.transparent,[!1,!1,!1,!1]),ei.unblended=new ei(ei.Replace,o.bf.transparent,[!0,!0,!0,!0]),ei.alphaBlended=new ei([1,771],o.bf.transparent,[!0,!0,!0,!0]);let To=2305;class rt{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}rt.disabled=new rt(!1,1029,To),rt.backCCW=new rt(!0,1029,To),rt.frontCCW=new rt(!0,1028,To);class ht{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}ht.ReadOnly=!1,ht.ReadWrite=!0,ht.disabled=new ht(519,ht.ReadOnly,[0,1]);let Er=7680;class Lt{constructor(e,r,s,c,p,y){this.test=e,this.ref=r,this.mask=s,this.fail=c,this.depthFail=p,this.pass=y}}Lt.disabled=new Lt({func:519,mask:0},0,0,Er,Er,Er);let In=new WeakMap;function mr(h){var e;if(In.has(h))return In.get(h);{let r=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return In.set(h,r),r}}class fr{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let r=e.context,s=r.gl;this._texFormat=s.RGBA,this._texType=s.UNSIGNED_BYTE;let c=new o.aL;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);let p=new o.aN;p.emplaceBack(0,1,2),this._fullscreenTriangle=new xo(r.createVertexBuffer(c,eo.members),r.createIndexBuffer(p),o.aM.simpleSegment(0,0,c.length,p.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(s.TEXTURE1);let y=s.createTexture();s.bindTexture(s.TEXTURE_2D,y),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),mr(s)&&(this._pbo=s.createBuffer(),s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.bufferData(s.PIXEL_PACK_BUFFER,4,s.STREAM_READ),s.bindBuffer(s.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){let s=this._updateCount;return this._readbackQueue?s>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():s>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){let s=this._cachedRenderContext.context,c=s.gl;if(this._bindFramebuffer(),s.viewport.set([0,0,this._texWidth,this._texHeight]),s.clear({color:o.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(s,c.TRIANGLES,ht.disabled,Lt.disabled,ei.unblended,rt.disabled,((p,y)=>({u_input:p,u_output_expected:y}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&mr(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);let p=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:p}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&mr(e)){let r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=fr._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}let zs=o.$/128;function rc(h,e){let r=h.granularity!==void 0?Math.max(h.granularity,1):1,s=r+(h.generateBorders?2:0),c=r+(h.extendToNorthPole||h.generateBorders?1:0)+(h.extendToSouthPole||h.generateBorders?1:0),p=s+1,y=c+1,w=h.generateBorders?-1:0,T=h.generateBorders||h.extendToNorthPole?-1:0,P=r+(h.generateBorders?1:0),M=r+(h.generateBorders||h.extendToSouthPole?1:0),k=p*y,A=s*c*6,D=p*y>65536;if(D&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let F=D||e==="32bit",Z=new Int16Array(2*k),G=0;for(let ee=T;ee<=M;ee++)for(let K=w;K<=P;K++){let ie=K/r*o.$;K===-1&&(ie=-zs),K===r+1&&(ie=o.$+zs);let oe=ee/r*o.$;ee===-1&&(oe=h.extendToNorthPole?o.bh:-zs),ee===r+1&&(oe=h.extendToSouthPole?o.bi:o.$+zs),Z[G++]=ie,Z[G++]=oe}let W=F?new Uint32Array(A):new Uint16Array(A),X=0;for(let ee=0;ee<c;ee++)for(let K=0;K<s;K++){let ie=K+1+ee*p,oe=K+(ee+1)*p,J=K+1+(ee+1)*p;W[X++]=K+ee*p,W[X++]=oe,W[X++]=ie,W[X++]=ie,W[X++]=oe,W[X++]=J}return{vertices:Z.buffer.slice(0),indices:W.buffer.slice(0),uses32bitIndices:F}}let oa=new o.aK({fill:new o.bj(128,2),line:new o.bj(512,0),tile:new o.bj(128,32),stencil:new o.bj(128,1),circle:3});class Na{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Zn.projectionGlobe}get vertexShaderPreludeCode(){return Zn.projectionMercator.vertexSource}get subdivisionGranularity(){return oa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new fr(e));let r=o.U(this._errorQueryLatitudeDegrees),s=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(r,s),p=ne.now();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=p);let y=Math.min(Math.max((p-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bl(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,s,c,p){let y=(p==="stencil"?oa.stencil:oa.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:y,generateBorders:s,extendToNorthPole:r.y===0&&c,extendToSouthPole:r.y===(1<<r.z)-1&&c})}_getMesh(e,r){let s=this._getMeshKey(r);if(s in this._tileMeshCache)return this._tileMeshCache[s];let c=(function(p,y){let w=rc(y,"16bit"),T=o.aL.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),P=o.aN.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new xo(p.createVertexBuffer(T,eo.members),p.createIndexBuffer(P),o.aM.simpleSegment(0,0,T.length,P.length))})(e,r);return this._tileMeshCache[s]=c,c}recalculate(e){}hasTransition(){let e=ne.now(),r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let Rs=new o.r({type:new o.D(o.v.projection.type)});class Fs extends o.E{constructor(e){super(),this._transitionable=new o.t(Rs),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new Tt,this._verticalPerspectiveProjection=new Na}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,s,c,p){return this.currentProjection.getMeshFromTileID(e,r,s,c,p)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Bs(h){let e=aa(h.worldSize,h.center.lat);return 2*Math.PI*e}function qn(h,e,r,s,c){let p=1/(1<<c),y=e/o.$*p+s*p,w=o.bo((h/o.$*p+r*p)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,P=Math.cos(T),M=new Float64Array(3);return M[0]=Math.sin(w)*P,M[1]=Math.sin(T),M[2]=Math.cos(w)*P,M}function Ri(h){return(function(e,r){let s=Math.cos(r),c=new Float64Array(3);return c[0]=Math.sin(e)*s,c[1]=Math.sin(r),c[2]=Math.cos(e)*s,c})(h.lng*Math.PI/180,h.lat*Math.PI/180)}function aa(h,e){return h/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Va(h){let e=Math.asin(h[1])/Math.PI*180,r=Math.sqrt(h[0]*h[0]+h[2]*h[2]);if(r>1e-6){let s=h[0]/r,c=Math.acos(h[2]/r),p=(s>0?c:-c)/Math.PI*180;return new o.S(o.aO(p,-180,180),e)}return new o.S(0,e)}function So(h){return Math.cos(h*Math.PI/180)}function di(h,e){let r=So(h),s=So(e);return o.ak(s/r)}function Iu(h,e){let r=h.rotate(e.bearingInRadians),s=e.zoom+di(e.center.lat,0),c=o.bk(1/So(e.center.lat),1/So(Math.min(Math.abs(e.center.lat),60)),o.bn(s,7,3,0,1)),p=360/Bs({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.S(e.center.lng-r.x*p*c,o.ah(e.center.lat+r.y*p,-o.ai,o.ai))}function $a(h){let e=.5*h,r=Math.sin(e),s=Math.cos(e);return Math.log(r+s)-Math.log(s-r)}function oc(h,e,r,s){let c=h.lat+r*s;if(Math.abs(r)>1){let p=(Math.sign(h.lat+r)!==Math.sign(h.lat)?-Math.abs(h.lat):Math.abs(h.lat))*Math.PI/180,y=Math.abs(h.lat+r)*Math.PI/180,w=$a(p+s*(y-p)),T=$a(p),P=$a(y);return new o.S(h.lng+e*((w-T)/(P-T)),c)}return new o.S(h.lng+e*s,c)}class up{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,s,c){let p=`${e.z}_${e.x}_${e.y}_${c?.terrain?"t":""}`,y=this._cache.get(p);if(y)return y;let w=this._cachePrevious.get(p);if(w)return this._cache.set(p,w),w;let T=this._boundingVolumeFactory(e,r,s,c);return this._cache.set(p,T),this._hadAnyChanges=!0,T}}class sa{constructor(e,r,s,c){this.min=s,this.max=c,this.points=e,this.planes=r}static fromAabb(e,r){let s=[];for(let c=0;c<8;c++)s.push([1&~c?e[0]:r[0],(c>>1&1)==1?r[1]:e[1],(c>>2&1)==1?r[2]:e[2]]);return new sa(s,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,s){let c=o.br([],s[0],s[1],s[2]),p=o.bs([],[r[0],0,0],c),y=o.bs([],[0,r[1],0],c),w=o.bs([],[0,0,r[2]],c),T=[...e],P=[...e];for(let k=0;k<8;k++)for(let A=0;A<3;A++){let D=e[A]+p[A]*(1&~k?-1:1)+y[A]*((k>>1&1)==1?1:-1)+w[A]*((k>>2&1)==1?1:-1);T[A]=Math.min(T[A],D),P[A]=Math.max(P[A],D)}let M=[];for(let k=0;k<8;k++){let A=[...e];o.aS(A,A,o.aR([],p,1&~k?-1:1)),o.aS(A,A,o.aR([],y,(k>>1&1)==1?1:-1)),o.aS(A,A,o.aR([],w,(k>>2&1)==1?1:-1)),M.push(A)}return new sa(M,[[...p,-o.aX(p,M[0])],[...y,-o.aX(y,M[0])],[...w,-o.aX(w,M[0])],[-p[0],-p[1],-p[2],-o.aX(p,M[7])],[-y[0],-y[1],-y[2],-o.aX(y,M[7])],[-w[0],-w[1],-w[2],-o.aX(w,M[7])]],T,P)}intersectsFrustum(e){let r=!0,s=this.points.length,c=this.planes.length,p=e.planes.length,y=e.points.length;for(let w=0;w<p;w++){let T=e.planes[w],P=0;for(let M=0;M<s;M++){let k=this.points[M];T[0]*k[0]+T[1]*k[1]+T[2]*k[2]+T[3]>=0&&P++}if(P===0)return 0;P<s&&(r=!1)}if(r)return 2;for(let w=0;w<c;w++){let T=this.planes[w],P=0;for(let M=0;M<y;M++){let k=e.points[M];T[0]*k[0]+T[1]*k[1]+T[2]*k[2]+T[3]>=0&&P++}if(P===0)return 0}return 1}intersectsPlane(e){let r=this.points.length,s=0;for(let c=0;c<r;c++){let p=this.points[c];e[0]*p[0]+e[1]*p[1]+e[2]*p[2]+e[3]>=0&&s++}return s===r?2:s===0?0:1}}function Zi(h,e,r){let s=h-e;return s<0?-s:Math.max(0,s-r)}function Ga(h,e,r,s,c){let p=h-r,y;return y=p<0?Math.min(-p,1+p-c):p>1?Math.min(Math.max(p-c,0),1-p):0,Math.max(y,Zi(e,s,c))}class gr{constructor(){this._boundingVolumeCache=new up(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,s,c){let p=1<<s.z,y=1/p,w=s.x/p,T=s.y/p,P=2;return P=Math.min(P,Ga(e,r,w,T,y)),P=Math.min(P,Ga(e,r,w+.5,-T-y,y)),P=Math.min(P,Ga(e,r,w+.5,2-T-y,y)),P}getWrap(e,r,s){let c=1<<r.z,p=1/c,y=r.x/c,w=Zi(e.x,y,p),T=Zi(e.x,y-1,p),P=Zi(e.x,y+1,p),M=Math.min(w,T,P);return M===P?1:M===T?-1:0}allowVariableZoom(e,r){return Xe(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,s,c){return this._boundingVolumeCache.getTileBoundingVolume(e,r,s,c)}_computeTileBoundingVolume(e,r,s,c){var p,y;let w=0,T=0;if(c?.terrain){let P=new o.Z(e.z,r,e.z,e.x,e.y),M=c.terrain.getMinMaxElevation(P);w=(p=M.minElevation)!==null&&p!==void 0?p:Math.min(0,s),T=(y=M.maxElevation)!==null&&y!==void 0?y:Math.max(0,s)}if(w/=o.bu,T/=o.bu,w+=1,T+=1,e.z<=0)return sa.fromAabb([-T,-T,-T],[T,T,T]);if(e.z===1)return sa.fromAabb([e.x===0?-T:0,e.y===0?0:-T,-T],[e.x===0?0:T,e.y===0?T:0,T]);{let P=[qn(0,0,e.x,e.y,e.z),qn(o.$,0,e.x,e.y,e.z),qn(o.$,o.$,e.x,e.y,e.z),qn(0,o.$,e.x,e.y,e.z)],M=[];for(let me of P)M.push(o.aR([],me,T));if(T!==w)for(let me of P)M.push(o.aR([],me,w));e.y===0&&M.push([0,1,0]),e.y===(1<<e.z)-1&&M.push([0,-1,0]);let k=[1,1,1],A=[-1,-1,-1];for(let me of M)for(let ye=0;ye<3;ye++)k[ye]=Math.min(k[ye],me[ye]),A[ye]=Math.max(A[ye],me[ye]);let D=qn(o.$/2,o.$/2,e.x,e.y,e.z),F=o.aW([],[0,1,0],D);o.aV(F,F);let Z=o.aW([],D,F);o.aV(Z,Z);let G=o.aW([],P[2],P[1]);o.aV(G,G);let W=o.aW([],P[0],P[3]);o.aV(W,W),M.push(o.aR([],D,T)),e.y>=(1<<e.z)/2&&M.push(o.aR([],qn(o.$/2,0,e.x,e.y,e.z),T)),e.y<(1<<e.z)/2&&M.push(o.aR([],qn(o.$/2,o.$,e.x,e.y,e.z),T));let X=Za(D,M),ee=Za(Z,M),K=[-D[0],-D[1],-D[2],X.max],ie=[D[0],D[1],D[2],-X.min],oe=[-Z[0],-Z[1],-Z[2],ee.max],J=[Z[0],Z[1],Z[2],-ee.min],ue=[...G,0],xe=[...W,0],de=[];return e.y===0?de.push(o.bt(xe,ue,K),o.bt(xe,ue,ie)):de.push(o.bt(oe,ue,K),o.bt(oe,ue,ie),o.bt(oe,xe,K),o.bt(oe,xe,ie)),e.y===(1<<e.z)-1?de.push(o.bt(xe,ue,K),o.bt(xe,ue,ie)):de.push(o.bt(J,ue,K),o.bt(J,ue,ie),o.bt(J,xe,K),o.bt(J,xe,ie)),new sa(de,[K,ie,oe,J,ue,xe],k,A)}}}function Za(h,e){let r=1/0,s=-1/0;for(let c of e){let p=o.aX(h,c);r=Math.min(r,p),s=Math.max(s,p)}return{min:r,max:s}}class qa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,s){return this._helper.interpolatePadding(e,r,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=o.bv(),this._projectionMatrix=o.b9(),this._globeViewProjMatrix32f=o.b8(),this._globeViewProjMatrixNoCorrection=o.b9(),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),this._globeProjMatrixInverted=o.b9(),this._cameraPosition=o.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new nn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new gr}clone(){let e=new qa;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=o.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:r,applyGlobeMatrix:s}=e,c=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:s?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let r=this.pitchInRadians,s=this.cameraToCenterDistance/e,c=Math.sin(r)*s,p=Math.cos(r)*s+1,y=1/Math.sqrt(c*c+p*p)*1,w=-c,T=p,P=Math.sqrt(w*w+T*T);w/=P,T/=P;let M=[0,w,T];o.bw(M,M,[0,0,0],-this.bearingInRadians),o.bx(M,M,[0,0,0],-1*this.center.lat*Math.PI/180),o.by(M,M,[0,0,0],this.center.lng*Math.PI/180);let k=1/o.aZ(M);return o.aR(M,M,k),[...M,-y*k]}isLocationOccluded(e){return!this.isSurfacePointVisible(Ri(e))}transformLightDirection(e){let r=this._helper._center.lng*Math.PI/180,s=this._helper._center.lat*Math.PI/180,c=Math.cos(s),p=[Math.sin(r)*c,Math.sin(s),Math.cos(r)*c],y=[p[2],0,-p[0]],w=[0,0,0];o.aW(w,y,p),o.aV(y,y),o.aV(w,w);let T=[0,0,0];return o.aV(T,[y[0]*e[0]+w[0]*e[1]+p[0]*e[2],y[1]*e[0]+w[1]*e[1]+p[1]*e[2],y[2]*e[0]+w[2]*e[1]+p[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,s){let c=(function(w,T,P){let M=1/(1<<P.z);return new o.a1(w/o.$*M+P.x*M,T/o.$*M+P.y*M)})(e,r,s.canonical),p=(y=c.y,[o.bo(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(p[1])}projectTileCoordinates(e,r,s,c){let p=s.canonical,y=qn(e,r,p.x,p.y,p.z),w=1+(c?c(e,r):0)/o.bu,T=[y[0]*w,y[1]*w,y[2]*w,1];o.aw(T,T,this._globeViewProjMatrixNoCorrection);let P=this._cachedClippingPlane,M=P[0]*y[0]+P[1]*y[1]+P[2]*y[2]+P[3]<0;return{point:new o.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:M}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=aa(this.worldSize,this.center.lat),r=o.ba(),s=o.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.b4(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let c=this.centerOffset;r[8]=2*-c.x/this._helper._width,r[9]=2*c.y/this._helper._height,this._projectionMatrix=o.b5(r),this._globeProjMatrixInverted=o.ba(),o.aq(this._globeProjMatrixInverted,r),o.M(r,r,[0,0,-this.cameraToCenterDistance]),o.b6(r,r,this.rollInRadians),o.b7(r,r,-this.pitchInRadians),o.b6(r,r,this.bearingInRadians),o.M(r,r,[0,0,-e]);let p=o.bp();p[0]=e,p[1]=e,p[2]=e,o.b7(s,r,this.center.lat*Math.PI/180),o.bz(s,s,-this.center.lng*Math.PI/180),o.N(s,s,p),this._globeViewProjMatrixNoCorrection=s,o.b7(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bz(r,r,-this.center.lng*Math.PI/180),o.N(r,r,p),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=o.ba(),o.aq(this._globeViewProjMatrixNoCorrectionInverted,s);let y=o.bp();this._cameraPosition=o.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bw(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),o.bx(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),o.bw(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),o.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bx(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),o.by(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let w=o.b5(this._globeViewProjMatrixNoCorrectionInverted);o.N(w,w,[1,1,-1]),this._cachedFrustum=xi.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");let r=o.ba();return o.ag(r),r}getVisibleUnwrappedCoordinates(e){return[new o.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;let s=Ri(e);o.aR(s,s,1+r/o.bu);let c=o.bv();return o.aw(c,[s[0],s[1],s[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(e){}getBounds(){let e=.5*this.width,r=.5*this.height,s=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,r),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,r)],c=[];for(let k of s)c.push(this.unprojectScreenPoint(k));let p=0,y=0,w=0,T=0,P=this.center;for(let k of c){let A=o.bA(P.lng,k.lng),D=o.bA(P.lat,k.lat);A<y&&(y=A),A>p&&(p=A),D<T&&(T=D),D>w&&(w=D)}let M=[P.lng+y,P.lat+T,P.lng+p,P.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(M[3]=90,M[0]=-180,M[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(M[1]=-90,M[0]=-180,M[2]=180),new hi(M)}getConstrained(e,r){let s=o.ah(e.lat,-o.ai,o.ai),c=o.ah(+r,this.minZoom+di(0,s),this.maxZoom);return{center:new o.S(e.lng,s),zoom:c}}calculateCenterFromCameraLngLatAlt(e,r,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,s,c)}setLocationAtPoint(e,r){let s=Ri(this.unprojectScreenPoint(r)),c=Ri(e),p=o.bp();o.bB(p);let y=o.bp();o.by(y,s,p,-this.center.lng*Math.PI/180),o.bx(y,y,p,this.center.lat*Math.PI/180);let w=c[0]*c[0]+c[2]*c[2],T=y[0]*y[0];if(w<T)return;let P=Math.sqrt(w-T),M=-P,k=o.bC(c[0],c[2],y[0],P),A=o.bC(c[0],c[2],y[0],M),D=o.bp();o.by(D,c,p,-k);let F=o.bC(D[1],D[2],y[1],y[2]),Z=o.bp();o.by(Z,c,p,-A);let G=o.bC(Z[1],Z[2],y[1],y[2]),W=.5*Math.PI,X=F>=-W&&F<=W,ee=G>=-W&&G<=W,K,ie;if(X&&ee){let xe=this.center.lng*Math.PI/180,de=this.center.lat*Math.PI/180;o.bD(k,xe)+o.bD(F,de)<o.bD(A,xe)+o.bD(G,de)?(K=k,ie=F):(K=A,ie=G)}else if(X)K=k,ie=F;else{if(!ee)return;K=A,ie=G}let oe=K/Math.PI*180,J=ie/Math.PI*180,ue=this.center.lat;this.setCenter(new o.S(oe,o.ah(J,-90,90))),this.setZoom(this.zoom+di(ue,this.center.lat))}locationToScreenPoint(e,r){let s=Ri(e);if(r){let c=r.getElevationForLngLatZoom(e,this._helper._tileZoom);o.aR(s,s,1+c/o.bu)}return this._projectSurfacePointToScreen(s)}_projectSurfacePointToScreen(e){let r=o.bv();return o.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new o.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){let s=r.pointCoordinate(e);if(s)return s}return o.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var s;return(s=this.screenPointToMercatorCoordinate(e,r))===null||s===void 0?void 0:s.toLngLat()}isPointOnMapSurface(e,r){let s=this._cameraPosition,c=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(s,c)}getRayDirectionFromPixel(e){let r=o.bv();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,o.aw(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];let s=o.bp();s[0]=r[0]-this._cameraPosition[0],s[1]=r[1]-this._cameraPosition[1],s[2]=r[2]-this._cameraPosition[2];let c=o.bp();return o.aV(c,s),c}isSurfacePointVisible(e){let r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let r=o.bv();return o.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){let s=o.aX(e,r),c=o.bp(),p=o.bp();o.aR(p,r,s),o.aU(c,e,p);let y=1-o.aX(c,c);if(y<0)return null;let w=o.aX(e,e)-1,T=-s+(s<0?1:-1)*Math.sqrt(y),P=w/T,M=T;return{tMin:Math.min(P,M),tMax:Math.max(P,M)}}unprojectScreenPoint(e){let r=this._cameraPosition,s=this.getRayDirectionFromPixel(e),c=this.rayPlanetIntersection(r,s);if(c){let M=o.bp();o.aS(M,r,[s[0]*c.tMin,s[1]*c.tMin,s[2]*c.tMin]);let k=o.bp();return o.aV(k,M),Va(k)}let p=this._cachedClippingPlane,y=p[0]*s[0]+p[1]*s[1]+p[2]*s[2],w=-o.b1(p,r)/y,T=o.bp();if(w>0)o.aS(T,r,[s[0]*w,s[1]*w,s[2]*w]);else{let M=o.bp();o.aS(M,r,[2*s[0],2*s[1],2*s[2]]);let k=o.b1(this._cachedClippingPlane,M);o.aU(T,M,[this._cachedClippingPlane[0]*k,this._cachedClippingPlane[1]*k,this._cachedClippingPlane[2]*k])}let P=(function(M){let k=o.bp();return k[0]=M[0]*-M[3],k[1]=M[1]*-M[3],k[2]=M[2]*-M[3],{center:k,radius:Math.sqrt(1-M[3]*M[3])}})(p);return Va((function(M,k,A){let D=o.bp();o.aU(D,A,M);let F=o.bp();return o.bq(F,M,D,k/o.a$(D)),F})(P.center,P.radius,T))}getMatrixForModel(e,r){let s=o.S.convert(e),c=1/o.bu,p=o.b9();return o.bz(p,p,s.lng/180*Math.PI),o.b7(p,p,-s.lat/180*Math.PI),o.M(p,p,[0,0,1+r/o.bu]),o.b7(p,p,.5*Math.PI),o.N(p,p,[c,c,c]),p}getProjectionDataForCustomLayer(e=!0){let r=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Wa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,s){return this._helper.interpolatePadding(e,r,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,s=!0){this._helper.resize(e,r,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new nn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new Wt,this._verticalPerspectiveTransform=new qa}clone(){let e=new Wa;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let r=this._mercatorTransform.getProjectionData(e),s=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?s.mainMatrix:r.mainMatrix,clippingPlane:s.clippingPlane,tileMercatorCoords:s.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,s){let c=this._mercatorTransform.getPitchedTextCorrection(e,r,s),p=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,s);return o.bk(c,p,this._globeness)}projectTileCoordinates(e,r,s,c){return this.currentTransform.projectTileCoordinates(e,r,s,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,s,c)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){let r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;let s=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return s.fallbackMatrix=r.mainMatrix,s}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Ji{get useGlobeControls(){return!0}handlePanInertia(e,r){let s=Iu(e,r);return Math.abs(s.lng-r.center.lng)>180&&(s.lng=r.center.lng+179.5*Math.sign(s.lng-r.center.lng)),{easingCenter:s,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){let s=e.around,c=r.screenPointToLocation(s);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);let p=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);let y=r.zoom-p;if(y===0)return;let w=o.bA(r.center.lng,c.lng),T=w/(Math.abs(w/180)+1),P=o.bA(r.center.lat,c.lat),M=r.getRayDirectionFromPixel(s),k=r.cameraPosition,A=-1*o.aX(k,M),D=o.bp();o.aS(D,k,[M[0]*A,M[1]*A,M[2]*A]);let F=o.aZ(D)-1,Z=Math.exp(.5*-Math.max(F-.3,0)),G=aa(r.worldSize,r.center.lat)/Math.min(r.width,r.height),W=o.bn(G,.9,.5,1,.25),X=(1-o.af(-y))*Math.min(Z,W),ee=r.center.lat,K=r.zoom,ie=new o.S(r.center.lng+T*X,o.ah(r.center.lat+P*X,-o.ai,o.ai));r.setLocationAtPoint(c,s);let oe=r.center,J=o.bn(Math.abs(w),45,85,0,1),ue=o.bn(G,.75,.35,0,1),xe=Math.pow(Math.max(J,ue),.25),de=o.bA(oe.lng,ie.lng),me=o.bA(oe.lat,ie.lat);r.setCenter(new o.S(oe.lng+de*xe,oe.lat+me*xe).wrap()),r.setZoom(K+di(ee,r.center.lat))}handleMapControlsPan(e,r,s){if(!e.panDelta)return;let c=r.center.lat,p=r.zoom;r.setCenter(Iu(e.panDelta,r).wrap()),r.setZoom(p+di(c,r.center.lat))}cameraForBoxAndBearing(e,r,s,c,p){let y=Sn(e,r,s,c,p),w=r.left/p.width*2-1,T=(p.width-r.right)/p.width*2-1,P=r.top/p.height*-2+1,M=(p.height-r.bottom)/p.height*-2+1,k=o.bA(s.getWest(),s.getEast())<0,A=k?s.getEast():s.getWest(),D=k?s.getWest():s.getEast(),F=Math.max(s.getNorth(),s.getSouth()),Z=Math.min(s.getNorth(),s.getSouth()),G=A+.5*o.bA(A,D),W=F+.5*o.bA(F,Z),X=p.clone();X.setCenter(y.center),X.setBearing(y.bearing),X.setPitch(0),X.setRoll(0),X.setZoom(y.zoom);let ee=X.modelViewProjectionMatrix,K=[Ri(s.getNorthWest()),Ri(s.getNorthEast()),Ri(s.getSouthWest()),Ri(s.getSouthEast()),Ri(new o.S(D,W)),Ri(new o.S(A,W)),Ri(new o.S(G,F)),Ri(new o.S(G,Z))],ie=Ri(y.center),oe=Number.POSITIVE_INFINITY;for(let J of K)w<0&&(oe=Ji.getLesserNonNegativeNonNull(oe,Ji.solveVectorScale(J,ie,ee,"x",w))),T>0&&(oe=Ji.getLesserNonNegativeNonNull(oe,Ji.solveVectorScale(J,ie,ee,"x",T))),P>0&&(oe=Ji.getLesserNonNegativeNonNull(oe,Ji.solveVectorScale(J,ie,ee,"y",P))),M<0&&(oe=Ji.getLesserNonNegativeNonNull(oe,Ji.solveVectorScale(J,ie,ee,"y",M)));if(Number.isFinite(oe)&&oe!==0)return y.zoom=X.zoom+o.ak(oe),y;Su()}handleJumpToCenterZoom(e,r){let s=e.center.lat,c=e.getConstrained(r.center?o.S.convert(r.center):e.center,e.zoom).center;e.setCenter(c.wrap());let p=r.zoom!==void 0?+r.zoom:e.zoom+di(s,c.lat);e.zoom!==p&&e.setZoom(p)}handleEaseTo(e,r){let s=e.zoom,c=e.center,p=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},T=r.zoom!==void 0,P=!e.isPaddingEqual(r.padding),M=!1,k=r.center?o.S.convert(r.center):c,A=e.getConstrained(k,s).center;Ls(e,A);let D=e.clone();D.setCenter(A),D.setZoom(T?+r.zoom:s+di(c.lat,k.lat)),D.setBearing(r.bearing);let F=new o.P(o.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),o.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));D.setLocationAtPoint(A,F);let Z=(r.offset&&r.offsetAsPoint.mag())>0?D.center:A,G=T?+r.zoom:s+di(c.lat,Z.lat),W=s+di(c.lat,0),X=G+di(Z.lat,0),ee=o.bA(c.lng,Z.lng),K=o.bA(c.lat,Z.lat),ie=o.af(X-W);return M=G!==s,{easeFunc:oe=>{if(o.be(y,w)||on({startEulerAngles:y,endEulerAngles:w,tr:e,k:oe,useSlerp:y.roll!=w.roll}),P&&e.interpolatePadding(p,r.padding,oe),r.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{let J=X>W?Math.min(2,ie):Math.max(.5,ie),ue=Math.pow(J,1-oe),xe=oc(c,ee,K,oe*ue);e.setCenter(xe.wrap())}if(M){let J=o.C.number(W,X,oe)+di(0,e.center.lat);e.setZoom(J)}},isZooming:M,elevationCenter:Z}}handleFlyTo(e,r){let s=r.zoom!==void 0,c=e.center,p=e.zoom,y=e.padding,w=!e.isPaddingEqual(r.padding),T=e.getConstrained(o.S.convert(r.center||r.locationAtOffset),p).center,P=s?+r.zoom:e.zoom+di(e.center.lat,T.lat),M=e.clone();M.setCenter(T),M.setZoom(P),M.setBearing(r.bearing);let k=new o.P(o.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),o.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));M.setLocationAtPoint(T,k);let A=M.center;Ls(e,A);let D=(function(K,ie,oe){let J=Ri(ie),ue=Ri(oe),xe=o.aX(J,ue),de=Math.acos(xe),me=Bs(K);return de/(2*Math.PI)*me})(e,c,A),F=p+di(c.lat,0),Z=P+di(A.lat,0),G=o.af(Z-F),W;if(typeof r.minZoom=="number"){let K=+r.minZoom+di(A.lat,0),ie=Math.min(K,F,Z)+di(0,A.lat),oe=e.getConstrained(A,ie).zoom+di(A.lat,0);W=o.af(oe-F)}let X=o.bA(c.lng,A.lng),ee=o.bA(c.lat,A.lat);return{easeFunc:(K,ie,oe,J)=>{let ue=oc(c,X,ee,oe);w&&e.interpolatePadding(y,r.padding,K);let xe=K===1?A:ue;e.setCenter(xe.wrap());let de=F+o.ak(ie);e.setZoom(K===1?P:de+di(0,xe.lat))},scaleOfZoom:G,targetCenter:A,scaleOfMinZoom:W,pixelPathLength:D}}static solveVectorScale(e,r,s,c,p){let y=c==="x"?[s[0],s[4],s[8],s[12]]:[s[1],s[5],s[9],s[13]],w=[s[3],s[7],s[11],s[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],P=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],M=r[0]*y[0]+r[1]*y[1]+r[2]*y[2],k=r[0]*w[0]+r[1]*w[1]+r[2]*w[2];return M+p*P===T+p*k||w[3]*(T-M)+y[3]*(k-P)+T*k==M*P?null:(M+y[3]-p*k-p*w[3])/(M-T-p*k+p*P)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class Pu{constructor(e){this._globe=e,this._mercatorCameraHelper=new Yi,this._verticalPerspectiveCameraHelper=new Ji}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,s){this.currentHelper.handleMapControlsPan(e,r,s)}cameraForBoxAndBearing(e,r,s,c,p){return this.currentHelper.cameraForBoxAndBearing(e,r,s,c,p)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}let Os=(h,e)=>o.y(h,e&&e.filter(r=>r.identifier!=="source.canvas")),hp=o.bE();class ac extends o.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(let s in this.sourceCaches){let c=this.sourceCaches[s].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[s].reload()}},this.map=e,this.dispatcher=new fn(go(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(s,c)=>this.getGlyphs(s,c)),this.dispatcher.registerMessageHandler("GI",(s,c)=>this.getImages(s,c)),this.imageManager=new pn,this.imageManager.setEventedParent(this),this.glyphManager=new Vn(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new Ot(256,512),this.crossTileSymbolIndex=new ra,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bG()),Hr().on(yo,this._rtlPluginLoaded),this.on("data",s=>{if(s.dataType!=="source"||s.sourceDataType!=="metadata")return;let c=this.sourceCaches[s.sourceId];if(!c)return;let p=c.getSource();if(p&&p.vectorLayerIds)for(let y in this._layers){let w=this._layers[y];w.source===p.id&&this._validateLayer(w)}})}setGlobalStateProperty(e,r){var s,c,p;this._checkLoaded();let y=r===null?(p=(c=(s=this.stylesheet.state)===null||s===void 0?void 0:s[e])===null||c===void 0?void 0:c.default)!==null&&p!==void 0?p:null:r;if(o.bH(y,this._globalState[e]))return this;this._globalState[e]=y;let w=this._findGlobalStateAffectedSources([e]);for(let T in this.sourceCaches)w.has(T)&&(this._reloadSource(T),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();let r=[];for(let c in e)!o.bH(this._globalState[c],e[c].default)&&(r.push(c),this._globalState[c]=e[c].default);let s=this._findGlobalStateAffectedSources(r);for(let c in this.sourceCaches)s.has(c)&&(this._reloadSource(c),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;let r=new Set;for(let s in this._layers){let c=this._layers[s],p=c.getLayoutAffectingGlobalStateRefs();for(let y of e)p.has(y)&&r.add(c.source)}return r}loadURL(e,r={},s){this.fire(new o.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;let c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let p=this._loadStyleRequest;o.j(c,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,r,s)}).catch(y=>{this._loadStyleRequest=null,y&&!p.signal.aborted&&this.fire(new o.k(y))})}loadJSON(e,r={},s){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ne.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,s)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(hp,{validate:!1})}_load(e,r,s){var c,p,y;let w=r.transformStyle?r.transformStyle(s,e):e;if(!r.validate||!Os(this,o.z(w))){this._loaded=!0,this.stylesheet=w;for(let T in w.sources)this.addSource(T,w.sources[T],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Pr(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new Oa(this.stylesheet.sky),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.setGlobalState((y=this.stylesheet.state)!==null&&y!==void 0?y:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){let e=o.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(let r of e){let s=o.bJ(r);s.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=s}}_loadSprite(e,r=!1,s=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(p,y,w,T){return o._(this,void 0,void 0,function*(){let P=tt(p),M=w>1?"@2x":"",k={},A={};for(let{id:D,url:F}of P){let Z=y.transformRequest(At(F,M,".json"),"SpriteJSON");k[D]=o.j(Z,T);let G=y.transformRequest(At(F,M,".png"),"SpriteImage");A[D]=nt.getImage(G,T)}return yield Promise.all([...Object.values(k),...Object.values(A)]),(function(D,F){return o._(this,void 0,void 0,function*(){let Z={};for(let G in D){Z[G]={};let W=ne.getImageCanvasContext((yield F[G]).data),X=(yield D[G]).data;for(let ee in X){let{width:K,height:ie,x:oe,y:J,sdf:ue,pixelRatio:xe,stretchX:de,stretchY:me,content:ye,textFitWidth:ze,textFitHeight:Be}=X[ee];Z[G][ee]={data:null,pixelRatio:xe,sdf:ue,stretchX:de,stretchY:me,content:ye,textFitWidth:ze,textFitHeight:Be,spriteData:{width:K,height:ie,x:oe,y:J,context:W}}}}return Z})})(k,A)})})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(let y in p){this._spritesImagesIds[y]=[];let w=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(T=>!(T in p)):[];for(let T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(let T in p[y]){let P=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,p[y][T],!1):this.imageManager.addImage(P,p[y][T]),r&&(this._changedImages[P]=!0)}}}).catch(p=>{this._spriteRequest=null,c=p,this.fire(new o.k(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),s&&s(c)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(e){let r=this.sourceCaches[e.source];if(!r)return;let s=e.sourceLayer;if(!s)return;let c=r.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(s)===-1)&&this.fire(new o.k(new Error(`Source layer "${s}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){let s=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?o.bK(s):s);let c=[];for(let p of e)if(s[p]){let y=r?o.bK(s[p]):s[p];c.push(y)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let r=Object.keys(this._layers);for(let s of r){let c=this._layers[s];c.type!=="custom"&&(e[s]=c.serialize())}return e}hasTransitions(){var e,r,s;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((s=this.projection)===null||s===void 0)&&s.hasTransition())return!0;for(let c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(let c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let r=this._changed;if(r){let c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(let y in this._updatedSources){let w=this._updatedSources[y];if(w==="reload")this._reloadSource(y);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let s={};for(let c in this.sourceCaches){let p=this.sourceCaches[c];s[c]=p.used,p.used=!1}for(let c of this._order){let p=this._layers[c];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(let c in s){let p=this.sourceCaches[c];!!s[c]!=!!p.used&&p.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var s;this._checkLoaded();let c=this.serialize();if(e=r.transformStyle?r.transformStyle(c,e):e,((s=r.validate)===null||s===void 0||s)&&Os(this,o.z(e)))return!1;(e=o.bK(e)).layers=o.bI(e.layers);let p=o.bL(c,e),y=this._getOperationsToPerform(p);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(let w of y.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let r=[],s=[];for(let c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":r.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":r.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setSky":r.push(()=>this.setSky.apply(this,c.args));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setGlobalState":r.push(()=>this.setGlobalState.apply(this,c.args));break;case"setTransition":r.push(()=>{});break;default:s.push(c.command)}return{operations:r,unimplemented:s}}addImage(e,r){if(this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,s={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.z.source,`sources.${e}`,r,null,s))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);let c=this.sourceCaches[e]=new xt(e,r,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let s in this._layers)if(this._layers[s].source===e)return this.fire(new o.k(new Error(`Source "${e}" cannot be removed while layer "${s}" is using it.`)));let r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let s=this.sourceCaches[e].getSource();if(s.type!=="geojson")throw new Error(`geojsonSource.type is ${s.type}, which is !== 'geojson`);s.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,s={}){this._checkLoaded();let c=e.id;if(this.getLayer(c))return void this.fire(new o.k(new Error(`Layer "${c}" already exists on this map.`)));let p;if(e.type==="custom"){if(Os(this,o.bM(e)))return;p=o.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=o.bK(e),e=o.e(e,{source:c})),this._validate(o.z.layer,`layers.${c}`,e,{arrayIndex:-1},s))return;p=o.bJ(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}let y=r?this._order.indexOf(r):this._order.length;if(r&&y===-1)this.fire(new o.k(new Error(`Cannot add layer "${c}" before non-existing layer "${r}".`)));else{if(this._order.splice(y,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){let w=this._removedLayers[c];delete this._removedLayers[c],w.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;let s=this._order.indexOf(e);this._order.splice(s,1);let c=r?this._order.indexOf(r):this._order.length;r&&c===-1?this.fire(new o.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let r=this._layers[e];if(!r)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);let s=this._order.indexOf(e);this._order.splice(s,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,s){this._checkLoaded();let c=this.getLayer(e);c?c.minzoom===r&&c.maxzoom===s||(r!=null&&(c.minzoom=r),s!=null&&(c.maxzoom=s),this._updateLayer(c)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,s={}){this._checkLoaded();let c=this.getLayer(e);if(c){if(!o.bH(c.filter,r))return r==null?(c.setFilter(void 0),void this._updateLayer(c)):void(this._validate(o.z.filter,`layers.${c.id}.filter`,r,null,s)||(c.setFilter(o.bK(r)),this._updateLayer(c)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bK(this.getLayer(e).filter)}setLayoutProperty(e,r,s,c={}){this._checkLoaded();let p=this.getLayer(e);p?o.bH(p.getLayoutProperty(r),s)||(p.setLayoutProperty(r,s,c),this._updateLayer(p)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){let s=this.getLayer(e);if(s)return s.getLayoutProperty(r);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,s,c={}){this._checkLoaded();let p=this.getLayer(e);p?o.bH(p.getPaintProperty(r),s)||(p.setPaintProperty(r,s,c)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();let s=e.source,c=e.sourceLayer,p=this.sourceCaches[s];if(p===void 0)return void this.fire(new o.k(new Error(`The source '${s}' does not exist in the map's style.`)));let y=p.getSource().type;y==="geojson"&&c?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||c?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,e.id,r)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();let s=e.source,c=this.sourceCaches[s];if(c===void 0)return void this.fire(new o.k(new Error(`The source '${s}' does not exist in the map's style.`)));let p=c.getSource().type,y=p==="vector"?e.sourceLayer:void 0;p!=="vector"||y?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(y,e.id,r):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let r=e.source,s=e.sourceLayer,c=this.sourceCaches[r];if(c!==void 0)return c.getSource().type!=="vector"||s?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),c.getFeatureState(s,e.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=o.bN(this.sourceCaches,p=>p.serialize()),r=this._serializeByIds(this._order,!0),s=this.map.getTerrain()||void 0,c=this.stylesheet;return o.bO({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:e,layers:r,terrain:s},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let r=y=>this._layers[y].type==="fill-extrusion",s={},c=[];for(let y=this._order.length-1;y>=0;y--){let w=this._order[y];if(r(w)){s[w]=y;for(let T of e){let P=T[w];if(P)for(let M of P)c.push(M)}}}c.sort((y,w)=>w.intersectionZ-y.intersectionZ);let p=[];for(let y=this._order.length-1;y>=0;y--){let w=this._order[y];if(r(w))for(let T=c.length-1;T>=0;T--){let P=c[T].feature;if(s[P.layer.id]<y)break;p.push(P),c.pop()}else for(let T of e){let P=T[w];if(P)for(let M of P)p.push(M.feature)}}return p}queryRenderedFeatures(e,r,s){r&&r.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);let c={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let P of r.layers){let M=this._layers[P];if(!M)return this.fire(new o.k(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];c[M.source]=!0}}let p=[];r.availableImages=this._availableImages;let y=this._serializedAllLayers(),w=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,T=Object.assign(Object.assign({},r),{layers:w});for(let P in this.sourceCaches)r.layers&&!c[P]||p.push($n(this.sourceCaches[P],this._layers,y,e,T,s,this.map.terrain?(M,k,A)=>this.map.terrain.getElevation(M,k,A):void 0));return this.placement&&p.push((function(P,M,k,A,D,F,Z){let G={},W=F.queryRenderedSymbols(A),X=[];for(let ee of Object.keys(W).map(Number))X.push(Z[ee]);X.sort(Xo);for(let ee of X){let K=ee.featureIndex.lookupSymbolFeatures(W[ee.bucketInstanceId],M,ee.bucketIndex,ee.sourceLayerIndex,D.filter,D.layers,D.availableImages,P);for(let ie in K){let oe=G[ie]=G[ie]||[],J=K[ie];J.sort((ue,xe)=>{let de=ee.featureSortOrder;if(de){let me=de.indexOf(ue.featureIndex);return de.indexOf(xe.featureIndex)-me}return xe.featureIndex-ue.featureIndex});for(let ue of J)oe.push(ue)}}return(function(ee,K,ie){for(let oe in ee)for(let J of ee[oe])Ko(J,ie[K[oe].source]);return ee})(G,P,k)})(this._layers,y,this.sourceCaches,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,r){r&&r.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",r.filter,null,r);let s=this.sourceCaches[e];return s?(function(c,p){let y=c.getRenderableIds().map(P=>c.getTileByID(P)),w=[],T={};for(let P=0;P<y.length;P++){let M=y[P],k=M.tileID.canonical.key;T[k]||(T[k]=!0,M.querySourceFeatures(w,p))}return w})(s,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();let s=this.light.getLight(),c=!1;for(let y in e)if(!o.bH(e[y],s[y])){c=!0;break}if(!c)return;let p={now:ne.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(p)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();let s=this.getSky(),c=!1;if(!e&&!s)return;if(e&&!s)c=!0;else if(!e&&s)c=!0;else for(let y in e)if(!o.bH(e[y],s[y])){c=!0;break}if(!c)return;let p={now:ne.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(p)}_setProjectionInternal(e){let r=(function(s){if(Array.isArray(s)){let c=new Fs({type:s});return{projection:c,transform:new Wa,cameraHelper:new Pu(c)}}switch(s){case"mercator":return{projection:new Tt,transform:new Wt,cameraHelper:new Yi};case"globe":{let c=new Fs({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:c,transform:new Wa,cameraHelper:new Pu(c)}}case"vertical-perspective":return{projection:new Na,transform:new qa,cameraHelper:new Ji};default:return o.w(`Unknown projection name: ${s}. Falling back to mercator projection.`),{projection:new Tt,transform:new Wt,cameraHelper:new Yi}}})(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(let s in this.sourceCaches)this.sourceCaches[s].reload()}_validate(e,r,s,c,p={}){return(!p||p.validate!==!1)&&Os(this,e.call(o.z,o.e({key:r,style:this.serialize(),value:s,styleSpec:o.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Hr().off(yo,this._rtlPluginLoaded);for(let r in this._layers)this._layers[r].setEventedParent(null);for(let r in this.sourceCaches){let s=this.sourceCaches[r];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,s,c,p=!1){let y=!1,w=!1,T={};for(let P of this._order){let M=this._layers[P];if(M.type!=="symbol")continue;if(!T[M.source]){let A=this.sourceCaches[M.source];T[M.source]=A.getRenderableIds(!0).map(D=>A.getTileByID(D)).sort((D,F)=>F.tileID.overscaledZ-D.tileID.overscaledZ||(D.tileID.isLessThan(F.tileID)?-1:1))}let k=this.crossTileSymbolIndex.addLayer(M,T[M.source],e.center.lng);y=y||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||s===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ne.now(),e.zoom))&&(this.pauseablePlacement=new tc(e,this.map.terrain,this._order,p,r,s,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ne.now()),w=!0),y&&this.pauseablePlacement.placement.setStale()),w||y)for(let P of this._order){let M=this._layers[P];M.type==="symbol"&&this.placement.updateLayerOpacities(M,T[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ne.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return o._(this,void 0,void 0,function*(){let s=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();let c=this.sourceCaches[r.source];return c&&c.setDependencies(r.tileID.key,r.type,r.icons),s})}getGlyphs(e,r){return o._(this,void 0,void 0,function*(){let s=yield this.glyphManager.getGlyphs(r.stacks),c=this.sourceCaches[r.source];return c&&c.setDependencies(r.tileID.key,r.type,[""]),s})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(o.z.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,s={},c){this._checkLoaded();let p=[{id:e,url:r}],y=[...tt(this.stylesheet.sprite),...p];this._validate(o.z.sprite,"sprite",y,null,s)||(this.stylesheet.sprite=y,this._loadSprite(p,!0,c))}removeSprite(e){this._checkLoaded();let r=tt(this.stylesheet.sprite);if(r.find(s=>s.id===e)){if(this._spritesImagesIds[e])for(let s of this._spritesImagesIds[e])this.imageManager.removeImage(s),this._changedImages[s]=!0;r.splice(r.findIndex(s=>s.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return tt(this.stylesheet.sprite)}setSprite(e,r={},s){this._checkLoaded(),e&&this._validate(o.z.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,s):(this._unloadSprite(),s&&s(null)))}}var pp=o.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class dp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,s,c,p,y,w,T,P){this.context=e;let M=this.boundPaintVertexBuffers.length!==c.length;for(let k=0;!M&&k<c.length;k++)this.boundPaintVertexBuffers[k]!==c[k]&&(M=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==s||M||this.boundIndexBuffer!==p||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==P?this.freshBind(r,s,c,p,y,w,T,P):(e.bindVertexArray.set(this.vao),w&&w.bind(),p&&p.dynamicDraw&&p.bind(),T&&T.bind(),P&&P.bind())}freshBind(e,r,s,c,p,y,w,T){let P=e.numAttributes,M=this.context,k=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,r.enableAttributes(k,e);for(let A of s)A.enableAttributes(k,e);y&&y.enableAttributes(k,e),w&&w.enableAttributes(k,e),T&&T.enableAttributes(k,e),r.bind(),r.setVertexAttribPointers(k,e,p);for(let A of s)A.bind(),A.setVertexAttribPointers(k,e,p);y&&(y.bind(),y.setVertexAttribPointers(k,e,p)),c&&c.bind(),w&&(w.bind(),w.setVertexAttribPointers(k,e,p)),T&&(T.bind(),T.setVertexAttribPointers(k,e,p)),M.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let js=(h,e,r,s,c)=>({u_texture:0,u_ele_delta:h,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):o.bf.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:r?r.calculateFogBlendOpacity(s):0,u_horizon_color:r?r.properties.get("horizon-color"):o.bf.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),sc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Io(h){let e=[];for(let r=0;r<h.length;r++){if(h[r]===null)continue;let s=h[r].split(" ");e.push(s.pop())}return e}class lc{constructor(e,r,s,c,p,y,w,T,P=[]){let M=e.gl;this.program=M.createProgram();let k=Io(r.staticAttributes),A=s?s.getBinderAttributes():[],D=k.concat(A),F=Zn.prelude.staticUniforms?Io(Zn.prelude.staticUniforms):[],Z=w.staticUniforms?Io(w.staticUniforms):[],G=r.staticUniforms?Io(r.staticUniforms):[],W=s?s.getBinderUniforms():[],X=F.concat(Z).concat(G).concat(W),ee=[];for(let de of X)ee.indexOf(de)<0&&ee.push(de);let K=s?s.defines():[];mr(M)&&K.unshift("#version 300 es"),p&&K.push("#define OVERDRAW_INSPECTOR;"),y&&K.push("#define TERRAIN3D;"),T&&K.push(T),P&&K.push(...P);let ie=K.concat(Zn.prelude.fragmentSource,w.fragmentSource,r.fragmentSource).join(`
`),oe=K.concat(Zn.prelude.vertexSource,w.vertexSource,r.vertexSource).join(`
`);mr(M)||(ie=(function(de){return de.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ie),oe=(function(de){return de.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(oe));let J=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(J,ie),M.compileShader(J),!M.getShaderParameter(J,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(J)}`);M.attachShader(this.program,J);let ue=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(ue,oe),M.compileShader(ue),!M.getShaderParameter(ue,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(ue)}`);M.attachShader(this.program,ue),this.attributes={};let xe={};this.numAttributes=D.length;for(let de=0;de<this.numAttributes;de++)D[de]&&(M.bindAttribLocation(this.program,de,D[de]),this.attributes[D[de]]=de);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(ue),M.deleteShader(J);for(let de=0;de<ee.length;de++){let me=ee[de];if(me&&!xe[me]){let ye=M.getUniformLocation(this.program,me);ye&&(xe[me]=ye)}}this.fixedUniforms=c(e,xe),this.terrainUniforms=((de,me)=>({u_depth:new o.bP(de,me.u_depth),u_terrain:new o.bP(de,me.u_terrain),u_terrain_dim:new o.bg(de,me.u_terrain_dim),u_terrain_matrix:new o.bR(de,me.u_terrain_matrix),u_terrain_unpack:new o.bS(de,me.u_terrain_unpack),u_terrain_exaggeration:new o.bg(de,me.u_terrain_exaggeration)}))(e,xe),this.projectionUniforms=((de,me)=>({u_projection_matrix:new o.bR(de,me.u_projection_matrix),u_projection_tile_mercator_coords:new o.bS(de,me.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bS(de,me.u_projection_clipping_plane),u_projection_transition:new o.bg(de,me.u_projection_transition),u_projection_fallback_matrix:new o.bR(de,me.u_projection_fallback_matrix)}))(e,xe),this.binderUniforms=s?s.getUniforms(e,xe):[]}draw(e,r,s,c,p,y,w,T,P,M,k,A,D,F,Z,G,W,X,ee){let K=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(s),e.setStencilMode(c),e.setColorMode(p),e.setCullFace(y),T){e.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,T.depthTexture),e.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,T.texture);for(let oe in this.terrainUniforms)this.terrainUniforms[oe].set(T[oe])}if(P)for(let oe in P)this.projectionUniforms[sc[oe]].set(P[oe]);if(w)for(let oe in this.fixedUniforms)this.fixedUniforms[oe].set(w[oe]);G&&G.setUniforms(e,this.binderUniforms,F,{zoom:Z});let ie=0;switch(r){case K.LINES:ie=2;break;case K.TRIANGLES:ie=3;break;case K.LINE_STRIP:ie=1}for(let oe of D.get()){let J=oe.vaos||(oe.vaos={});(J[M]||(J[M]=new dp)).bind(e,this,k,G?G.getPaintVertexBuffers():[],A,oe.vertexOffset,W,X,ee),K.drawElements(r,oe.primitiveLength*ie,K.UNSIGNED_SHORT,oe.primitiveOffset*ie*2)}}}function Us(h,e,r){let s=1/o.aC(r,1,e.transform.tileZoom),c=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,e.transform.tileZoom)/c,y=p*(r.tileID.canonical.x+r.tileID.wrap*c),w=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[s,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w]}}let Wn=(h,e,r,s)=>{let c=h.style.light,p=c.properties.get("position"),y=[p.x,p.y,p.z],w=o.bV();c.properties.get("anchor")==="viewport"&&o.bW(w,h.transform.bearingInRadians),o.bX(y,y,w);let T=h.transform.transformLightDirection(y),P=c.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:s}},mp=(h,e,r,s,c,p,y)=>o.e(Wn(h,e,r,s),Us(p,h,y),{u_height_factor:-Math.pow(2,c.overscaledZ)/y.tileSize/8}),Ns=(h,e,r,s)=>o.e(Us(e,h,r),{u_fill_translate:s}),Ha=(h,e)=>({u_world:h,u_fill_translate:e}),Xa=(h,e,r,s,c)=>o.e(Ns(h,e,r,c),{u_world:s}),fp=(h,e,r,s,c)=>{let p=h.transform,y,w,T=0;if(r.paint.get("circle-pitch-alignment")==="map"){let P=o.aC(e,1,p.zoom);y=!0,w=[P,P],T=P/(o.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*c}else y=!1,w=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:T,u_translate:s}},Vs=h=>({u_pixel_extrude_scale:[1/h.width,1/h.height]}),gp=h=>({u_viewport_size:[h.width,h.height]}),Po=(h,e=1)=>({u_color:h,u_overlay:0,u_overlay_scale:e}),Cu=(h,e,r,s)=>{let c=o.aC(h,1,e)/(o.$*Math.pow(2,h.tileID.overscaledZ))*2*Math.PI*s;return{u_extrude_scale:o.aC(h,1,e),u_intensity:r,u_globe_extrude_scale:c}},cc=(h,e,r,s)=>{let c=o.L();o.bY(c,0,h.width,h.height,0,0,1);let p=h.context.gl;return{u_matrix:c,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:r,u_color_ramp:s,u_opacity:e.paint.get("heatmap-opacity")}},_p=(h,e,r)=>{let s=r.paint.get("hillshade-accent-color"),c;switch(r.paint.get("hillshade-method")){case"basic":c=4;break;case"combined":c=1;break;case"igor":c=2;break;case"multidirectional":c=3;break;default:c=0}let p=r.getIlluminationProperties();for(let y=0;y<p.directionRadians.length;y++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(p.directionRadians[y]+=h.transform.bearingInRadians);return{u_image:0,u_latrange:uc(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:p.altitudeRadians,u_azimuths:p.directionRadians,u_accent:s,u_method:c,u_highlights:p.highlightColor,u_shadows:p.shadowColor}},Mu=(h,e)=>{let r=e.stride,s=o.L();return o.bY(s,0,o.$,-o.$,0,0,1),o.M(s,s,[0,-o.$,0]),{u_matrix:s,u_image:1,u_dimension:[r,r],u_zoom:h.overscaledZ,u_unpack:e.getUnpackVector()}};function uc(h,e){let r=Math.pow(2,e.canonical.z),s=e.canonical.y;return[new o.a1(0,s/r).toLngLat().lat,new o.a1(0,(s+1)/r).toLngLat().lat]}let Eu=(h,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:h.paint.get("color-relief-opacity")}),$s=(h,e,r,s)=>{let c=h.transform;return{u_translation:pc(h,e,r),u_ratio:s/o.aC(e,1,c.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Au=(h,e,r,s,c)=>o.e($s(h,e,r,s),{u_image:0,u_image_height:c}),ku=(h,e,r,s,c)=>{let p=h.transform,y=hc(e,p);return{u_translation:pc(h,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:s/o.aC(e,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[y,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Co=(h,e,r,s,c,p)=>{let y=h.lineAtlas,w=hc(e,h.transform),T=r.layout.get("line-cap")==="round",P=y.getDash(c.from,T),M=y.getDash(c.to,T),k=P.width*p.fromScale,A=M.width*p.toScale;return o.e($s(h,e,r,s),{u_patternscale_a:[w/k,-P.height/2],u_patternscale_b:[w/A,-M.height/2],u_sdfgamma:y.width/(256*Math.min(k,A)*h.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:M.y,u_mix:p.t})};function hc(h,e){return 1/o.aC(h,1,e.tileZoom)}function pc(h,e,r){return o.aD(h.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}let Ka=(h,e,r,s,c)=>{return{u_tl_parent:h,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(y=s.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(p=s.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:yp(s.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var p,y};function yp(h){h*=Math.PI/180;let e=Math.sin(h),r=Math.cos(h);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}let Ya=(h,e,r,s,c,p,y,w,T,P,M,k,A)=>{let D=y.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:D.width/D.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+M,u_pitch_with_map:+s,u_is_along_line:c,u_is_variable_anchor:p,u_texsize:k,u_texture:0,u_translation:P,u_pitched_scale:A}},Lu=(h,e,r,s,c,p,y,w,T,P,M,k,A,D)=>{let F=y.transform;return o.e(Ya(h,e,r,s,c,p,y,w,T,P,M,k,D),{u_gamma_scale:s?Math.cos(F.pitch*Math.PI/180)*F.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},vp=(h,e,r,s,c,p,y,w,T,P,M,k,A)=>o.e(Lu(h,e,r,s,c,p,y,w,T,P,!0,M,0,A),{u_texsize_icon:k,u_texture_icon:1}),Du=(h,e)=>({u_opacity:h,u_color:e}),zu=(h,e,r,s,c)=>o.e((function(p,y,w,T){let P=w.imageManager.getPattern(p.from.toString()),M=w.imageManager.getPattern(p.to.toString()),{width:k,height:A}=w.imageManager.getPixelSize(),D=Math.pow(2,T.tileID.overscaledZ),F=T.tileSize*Math.pow(2,w.transform.tileZoom)/D,Z=F*(T.tileID.canonical.x+T.tileID.wrap*D),G=F*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[k,A],u_mix:y.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/o.aC(T,1,w.transform.tileZoom),u_pixel_coord_upper:[Z>>16,G>>16],u_pixel_coord_lower:[65535&Z,65535&G]}})(r,c,e,s),{u_opacity:h}),dc=(h,e)=>{},mc={fillExtrusion:(h,e)=>({u_lightpos:new o.bT(h,e.u_lightpos),u_lightpos_globe:new o.bT(h,e.u_lightpos_globe),u_lightintensity:new o.bg(h,e.u_lightintensity),u_lightcolor:new o.bT(h,e.u_lightcolor),u_vertical_gradient:new o.bg(h,e.u_vertical_gradient),u_opacity:new o.bg(h,e.u_opacity),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillExtrusionPattern:(h,e)=>({u_lightpos:new o.bT(h,e.u_lightpos),u_lightpos_globe:new o.bT(h,e.u_lightpos_globe),u_lightintensity:new o.bg(h,e.u_lightintensity),u_lightcolor:new o.bT(h,e.u_lightcolor),u_vertical_gradient:new o.bg(h,e.u_vertical_gradient),u_height_factor:new o.bg(h,e.u_height_factor),u_opacity:new o.bg(h,e.u_opacity),u_fill_translate:new o.bU(h,e.u_fill_translate),u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade)}),fill:(h,e)=>({u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillPattern:(h,e)=>({u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillOutline:(h,e)=>({u_world:new o.bU(h,e.u_world),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillOutlinePattern:(h,e)=>({u_world:new o.bU(h,e.u_world),u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade),u_fill_translate:new o.bU(h,e.u_fill_translate)}),circle:(h,e)=>({u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_scale_with_map:new o.bP(h,e.u_scale_with_map),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_extrude_scale:new o.bU(h,e.u_extrude_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.bg(h,e.u_globe_extrude_scale),u_translate:new o.bU(h,e.u_translate)}),collisionBox:(h,e)=>({u_pixel_extrude_scale:new o.bU(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_viewport_size:new o.bU(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new o.bQ(h,e.u_color),u_overlay:new o.bP(h,e.u_overlay),u_overlay_scale:new o.bg(h,e.u_overlay_scale)}),depth:dc,clippingMask:dc,heatmap:(h,e)=>({u_extrude_scale:new o.bg(h,e.u_extrude_scale),u_intensity:new o.bg(h,e.u_intensity),u_globe_extrude_scale:new o.bg(h,e.u_globe_extrude_scale)}),heatmapTexture:(h,e)=>({u_matrix:new o.bR(h,e.u_matrix),u_world:new o.bU(h,e.u_world),u_image:new o.bP(h,e.u_image),u_color_ramp:new o.bP(h,e.u_color_ramp),u_opacity:new o.bg(h,e.u_opacity)}),hillshade:(h,e)=>({u_image:new o.bP(h,e.u_image),u_latrange:new o.bU(h,e.u_latrange),u_exaggeration:new o.bg(h,e.u_exaggeration),u_altitudes:new o.b_(h,e.u_altitudes),u_azimuths:new o.b_(h,e.u_azimuths),u_accent:new o.bQ(h,e.u_accent),u_method:new o.bP(h,e.u_method),u_shadows:new o.bZ(h,e.u_shadows),u_highlights:new o.bZ(h,e.u_highlights)}),hillshadePrepare:(h,e)=>({u_matrix:new o.bR(h,e.u_matrix),u_image:new o.bP(h,e.u_image),u_dimension:new o.bU(h,e.u_dimension),u_zoom:new o.bg(h,e.u_zoom),u_unpack:new o.bS(h,e.u_unpack)}),colorRelief:(h,e)=>({u_image:new o.bP(h,e.u_image),u_unpack:new o.bS(h,e.u_unpack),u_dimension:new o.bU(h,e.u_dimension),u_elevation_stops:new o.bP(h,e.u_elevation_stops),u_color_stops:new o.bP(h,e.u_color_stops),u_color_ramp_size:new o.bP(h,e.u_color_ramp_size),u_opacity:new o.bg(h,e.u_opacity)}),line:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_image:new o.bP(h,e.u_image),u_image_height:new o.bg(h,e.u_image_height)}),linePattern:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_texsize:new o.bU(h,e.u_texsize),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_image:new o.bP(h,e.u_image),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade)}),lineSDF:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_patternscale_a:new o.bU(h,e.u_patternscale_a),u_patternscale_b:new o.bU(h,e.u_patternscale_b),u_sdfgamma:new o.bg(h,e.u_sdfgamma),u_image:new o.bP(h,e.u_image),u_tex_y_a:new o.bg(h,e.u_tex_y_a),u_tex_y_b:new o.bg(h,e.u_tex_y_b),u_mix:new o.bg(h,e.u_mix)}),raster:(h,e)=>({u_tl_parent:new o.bU(h,e.u_tl_parent),u_scale_parent:new o.bg(h,e.u_scale_parent),u_buffer_scale:new o.bg(h,e.u_buffer_scale),u_fade_t:new o.bg(h,e.u_fade_t),u_opacity:new o.bg(h,e.u_opacity),u_image0:new o.bP(h,e.u_image0),u_image1:new o.bP(h,e.u_image1),u_brightness_low:new o.bg(h,e.u_brightness_low),u_brightness_high:new o.bg(h,e.u_brightness_high),u_saturation_factor:new o.bg(h,e.u_saturation_factor),u_contrast_factor:new o.bg(h,e.u_contrast_factor),u_spin_weights:new o.bT(h,e.u_spin_weights),u_coords_top:new o.bS(h,e.u_coords_top),u_coords_bottom:new o.bS(h,e.u_coords_bottom)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texture:new o.bP(h,e.u_texture),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texture:new o.bP(h,e.u_texture),u_gamma_scale:new o.bg(h,e.u_gamma_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_is_halo:new o.bP(h,e.u_is_halo),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texsize_icon:new o.bU(h,e.u_texsize_icon),u_texture:new o.bP(h,e.u_texture),u_texture_icon:new o.bP(h,e.u_texture_icon),u_gamma_scale:new o.bg(h,e.u_gamma_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_is_halo:new o.bP(h,e.u_is_halo),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),background:(h,e)=>({u_opacity:new o.bg(h,e.u_opacity),u_color:new o.bQ(h,e.u_color)}),backgroundPattern:(h,e)=>({u_opacity:new o.bg(h,e.u_opacity),u_image:new o.bP(h,e.u_image),u_pattern_tl_a:new o.bU(h,e.u_pattern_tl_a),u_pattern_br_a:new o.bU(h,e.u_pattern_br_a),u_pattern_tl_b:new o.bU(h,e.u_pattern_tl_b),u_pattern_br_b:new o.bU(h,e.u_pattern_br_b),u_texsize:new o.bU(h,e.u_texsize),u_mix:new o.bg(h,e.u_mix),u_pattern_size_a:new o.bU(h,e.u_pattern_size_a),u_pattern_size_b:new o.bU(h,e.u_pattern_size_b),u_scale_a:new o.bg(h,e.u_scale_a),u_scale_b:new o.bg(h,e.u_scale_b),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bg(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_texture:new o.bP(h,e.u_texture),u_ele_delta:new o.bg(h,e.u_ele_delta),u_fog_matrix:new o.bR(h,e.u_fog_matrix),u_fog_color:new o.bQ(h,e.u_fog_color),u_fog_ground_blend:new o.bg(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bg(h,e.u_fog_ground_blend_opacity),u_horizon_color:new o.bQ(h,e.u_horizon_color),u_horizon_fog_blend:new o.bg(h,e.u_horizon_fog_blend),u_is_globe_mode:new o.bg(h,e.u_is_globe_mode)}),terrainDepth:(h,e)=>({u_ele_delta:new o.bg(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_texture:new o.bP(h,e.u_texture),u_terrain_coords_id:new o.bg(h,e.u_terrain_coords_id),u_ele_delta:new o.bg(h,e.u_ele_delta)}),projectionErrorMeasurement:(h,e)=>({u_input:new o.bg(h,e.u_input),u_output_expected:new o.bg(h,e.u_output_expected)}),atmosphere:(h,e)=>({u_sun_pos:new o.bT(h,e.u_sun_pos),u_atmosphere_blend:new o.bg(h,e.u_atmosphere_blend),u_globe_position:new o.bT(h,e.u_globe_position),u_globe_radius:new o.bg(h,e.u_globe_radius),u_inv_proj_matrix:new o.bR(h,e.u_inv_proj_matrix)}),sky:(h,e)=>({u_sky_color:new o.bQ(h,e.u_sky_color),u_horizon_color:new o.bQ(h,e.u_horizon_color),u_horizon:new o.bU(h,e.u_horizon),u_horizon_normal:new o.bU(h,e.u_horizon_normal),u_sky_horizon_blend:new o.bg(h,e.u_sky_horizon_blend),u_sky_blend:new o.bg(h,e.u_sky_blend)})};class Ru{constructor(e,r,s){this.context=e;let c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Gs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ar{constructor(e,r,s,c){this.length=r.length,this.attributes=s,this.itemSize=r.bytesPerElement,this.dynamicDraw=c,this.context=e;let p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let s=0;s<this.attributes.length;s++){let c=r.attributes[this.attributes[s].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,r,s){for(let c=0;c<this.attributes.length;c++){let p=this.attributes[c],y=r.attributes[p.name];y!==void 0&&e.vertexAttribPointer(y,p.components,e[Gs[p.type]],!1,this.itemSize,p.offset+this.itemSize*(s||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fc extends zt{getDefault(){return o.bf.transparent}set(e){let r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class gc extends zt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Fu extends zt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class _c extends zt{getDefault(){return[!0,!0,!0,!0]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Mo extends zt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class yc extends zt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class xp extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class bp extends zt{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class wp extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Tp extends zt{getDefault(){return[0,1]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Bu extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class Sp extends zt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ou extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Zs extends zt{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class qs extends zt{getDefault(){return o.bf.transparent}set(e){let r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ws extends zt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class vc extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Eo extends zt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ja extends zt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class la extends zt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class zn extends zt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ju extends zt{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Uu extends zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class xc extends zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ao extends zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Hs extends zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Xs extends zt{getDefault(){return null}set(e){let r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Qa extends zt{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;let s=this.gl;mr(s)?s.bindVertexArray(e):(r=s.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Ks extends zt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Nu extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ca extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class to extends zt{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class Vu extends to{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class bc extends to{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Pt extends to{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let es="Framebuffer is not complete";class Ip{constructor(e,r,s,c,p){this.context=e,this.width=r,this.height=s;let y=e.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Vu(e,w),c)this.depthAttachment=p?new Pt(e,w):new bc(e,w);else if(p)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(es)}destroy(){let e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){let s=this.depthAttachment.get();s&&e.deleteRenderbuffer(s)}e.deleteFramebuffer(this.framebuffer)}}class $u{constructor(e){var r,s;if(this.gl=e,this.clearColor=new fc(this),this.clearDepth=new gc(this),this.clearStencil=new Fu(this),this.colorMask=new _c(this),this.depthMask=new Mo(this),this.stencilMask=new yc(this),this.stencilFunc=new xp(this),this.stencilOp=new bp(this),this.stencilTest=new wp(this),this.depthRange=new Tp(this),this.depthTest=new Bu(this),this.depthFunc=new Sp(this),this.blend=new Ou(this),this.blendFunc=new Zs(this),this.blendColor=new qs(this),this.blendEquation=new Ws(this),this.cullFace=new vc(this),this.cullFaceSide=new Eo(this),this.frontFace=new Ja(this),this.program=new la(this),this.activeTexture=new zn(this),this.viewport=new ju(this),this.bindFramebuffer=new Uu(this),this.bindRenderbuffer=new xc(this),this.bindTexture=new Ao(this),this.bindVertexBuffer=new Hs(this),this.bindElementBuffer=new Xs(this),this.bindVertexArray=new Qa(this),this.pixelStoreUnpack=new Ks(this),this.pixelStoreUnpackPremultiplyAlpha=new Nu(this),this.pixelStoreUnpackFlipY=new ca(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),mr(e)){this.HALF_FLOAT=e.HALF_FLOAT;let c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:c?.RGBA16F_EXT,this.RGB16F=(s=e.RGB16F)!==null&&s!==void 0?s:c?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Ru(this,e,r)}createVertexBuffer(e,r,s){return new Ar(this,e,r,s)}createRenderbuffer(e,r,s){let c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,e,r,s),this.bindRenderbuffer.set(null),p}createFramebuffer(e,r,s,c){return new Ip(this,e,r,s,c)}clear({color:e,depth:r,stencil:s}){let c=this.gl,p=0;e&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),s!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(s),this.stencilMask.set(255)),c.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bH(e.blendFunction,ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return mr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return mr(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let io;function Gu(h,e,r,s,c){let p=h.context,y=h.transform,w=p.gl,T=h.useProgram("collisionBox"),P=[],M=0,k=0;for(let W=0;W<s.length;W++){let X=s[W],ee=e.getTile(X).getBucket(r);if(!ee)continue;let K=c?ee.textCollisionBox:ee.iconCollisionBox,ie=ee.collisionCircleArray;ie.length>0&&(P.push({circleArray:ie,circleOffset:k,coord:X}),M+=ie.length/4,k=M),K&&T.draw(p,w.LINES,ht.disabled,Lt.disabled,h.colorModeForRenderPass(),rt.disabled,Vs(h.transform),h.style.map.terrain&&h.style.map.terrain.getTerrainData(X),y.getProjectionData({overscaledTileID:X,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,null,h.transform.zoom,null,null,K.collisionVertexBuffer)}if(!c||!P.length)return;let A=h.useProgram("collisionCircle"),D=new o.b$;D.resize(4*M),D._trim();let F=0;for(let W of P)for(let X=0;X<W.circleArray.length/4;X++){let ee=4*X,K=W.circleArray[ee+0],ie=W.circleArray[ee+1],oe=W.circleArray[ee+2],J=W.circleArray[ee+3];D.emplace(F++,K,ie,oe,J,0),D.emplace(F++,K,ie,oe,J,1),D.emplace(F++,K,ie,oe,J,2),D.emplace(F++,K,ie,oe,J,3)}(!io||io.length<2*M)&&(io=(function(W){let X=2*W,ee=new o.c1;ee.resize(X),ee._trim();for(let K=0;K<X;K++){let ie=6*K;ee.uint16[ie+0]=4*K+0,ee.uint16[ie+1]=4*K+1,ee.uint16[ie+2]=4*K+2,ee.uint16[ie+3]=4*K+2,ee.uint16[ie+4]=4*K+3,ee.uint16[ie+5]=4*K+0}return ee})(M));let Z=p.createIndexBuffer(io,!0),G=p.createVertexBuffer(D,o.c0.members,!0);for(let W of P){let X=gp(h.transform);A.draw(p,w.TRIANGLES,ht.disabled,Lt.disabled,h.colorModeForRenderPass(),rt.disabled,X,h.style.map.terrain&&h.style.map.terrain.getTerrainData(W.coord),null,r.id,G,Z,o.aM.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,h.transform.zoom,null,null,null)}G.destroy(),Z.destroy()}let Pp=o.ag(new Float32Array(16));function Zu(h,e,r,s,c,p){let{horizontalAlign:y,verticalAlign:w}=o.aH(h);return new o.P((-(y-.5)*e/c+s[0])*p,(-(w-.5)*r/c+s[1])*p)}function Cp(h,e,r,s,c,p){let y=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=s.mult(p);r||(w=w.rotate(-c));let T=y.add(w);return vi(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){let w=Gi(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return h.add(s.rotate(T))}return h.add(s)}function wc(h,e,r,s,c,p,y,w,T,P,M,k){let A=h.text.placedSymbolArray,D=h.text.dynamicLayoutVertexArray,F=h.icon.dynamicLayoutVertexArray,Z={};D.clear();for(let G=0;G<A.length;G++){let W=A.get(G),X=W.hidden||!W.crossTileID||h.allowVerticalPlacement&&!W.placedOrientation?null:s[W.crossTileID];if(X){let ee=new o.P(W.anchorX,W.anchorY),K={getElevation:k,width:c.width,height:c.height,pitchedLabelPlaneMatrix:p,pitchWithMap:r,transform:c,tileAnchorPoint:ee,translation:P,unwrappedTileID:M},ie=r?Kr(ee.x,ee.y,K):Gi(ee.x,ee.y,K),oe=Re(c.cameraToCenterDistance,ie.signedDistanceFromCamera),J=o.ap(h.textSizeData,w,W)*oe/o.aB;r&&(J*=h.tilePixelRatio/y);let{width:ue,height:xe,anchor:de,textOffset:me,textBoxScale:ye}=X,ze=Zu(de,ue,xe,me,ye,J),Be=c.getPitchedTextCorrection(ee.x+P[0],ee.y+P[1],M),Me=Cp(ie.point,K,e,ze,-c.bearingInRadians,Be),We=h.allowVerticalPlacement&&W.placedOrientation===o.ao.vertical?Math.PI/2:0;for(let gt=0;gt<W.numGlyphs;gt++)o.av(D,Me,We);T&&W.associatedIconIndex>=0&&(Z[W.associatedIconIndex]={shiftedAnchor:Me,angle:We})}else dr(W.numGlyphs,D)}if(T){F.clear();let G=h.icon.placedSymbolArray;for(let W=0;W<G.length;W++){let X=G.get(W);if(X.hidden)dr(X.numGlyphs,F);else{let ee=Z[W];if(ee)for(let K=0;K<X.numGlyphs;K++)o.av(F,ee.shiftedAnchor,ee.angle);else dr(X.numGlyphs,F)}}h.icon.dynamicLayoutVertexBuffer.updateData(F)}h.text.dynamicLayoutVertexBuffer.updateData(D)}function Ys(h,e,r){return r.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function ts(h,e,r,s,c,p,y,w,T,P,M,k,A){let D=h.context,F=D.gl,Z=h.transform,G=w==="map",W=T==="map",X=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",ee=G&&!W&&!X,K=!r.layout.get("symbol-sort-key").isConstant(),ie=!1,oe=h.getDepthModeForSublayer(0,ht.ReadOnly),J=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ue=[],xe=Z.getCircleRadiusCorrection();for(let de of s){let me=e.getTile(de),ye=me.getBucket(r);if(!ye)continue;let ze=c?ye.text:ye.icon;if(!ze||!ze.segments.get().length||!ze.hasVisibleVertices)continue;let Be=ze.programConfigurations.get(r.id),Me=c||ye.sdfIcons,We=c?ye.textSizeData:ye.iconSizeData,gt=W||Z.pitch!==0,Bt=h.useProgram(Ys(Me,c,ye),Be),Vt=o.an(We,Z.zoom),jt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(de),ni,ci,dt,$t,bi=[0,0],Mi=null;if(c)ci=me.glyphAtlasTexture,dt=F.LINEAR,ni=me.glyphAtlasTexture.size,ye.iconsInText&&(bi=me.imageAtlasTexture.size,Mi=me.imageAtlasTexture,$t=gt||h.options.rotating||h.options.zooming||We.kind==="composite"||We.kind==="camera"?F.LINEAR:F.NEAREST);else{let wi=r.layout.get("icon-size").constantOr(0)!==1||ye.iconsNeedLinear;ci=me.imageAtlasTexture,dt=Me||h.options.rotating||h.options.zooming||wi||gt?F.LINEAR:F.NEAREST,ni=me.imageAtlasTexture.size}let Fi=o.aC(me,1,h.transform.zoom),sn=gi(G,h.transform,Fi),Qn=o.L();o.aq(Qn,sn);let ro=It(W,G,h.transform,Fi),oo=o.aD(Z,me,p,y),ba=Z.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),wa=J&&ye.hasTextData(),Bo=r.layout.get("icon-text-fit")!=="none"&&wa&&ye.hasIconData();if(X){let wi=h.style.map.terrain?(Bn,Ti)=>h.style.map.terrain.getElevation(de,Bn,Ti):null,Ei=r.layout.get("text-rotation-alignment")==="map";si(ye,h,c,sn,Qn,W,P,Ei,de.toUnwrapped(),Z.width,Z.height,oo,wi)}let Oo=c&&J||Bo,vn=X||Oo?Pp:W?sn:h.transform.clipSpaceToPixelsMatrix,er=Me&&r.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ln;ln=Me?ye.iconsInText?vp(We.kind,Vt,ee,W,X,Oo,h,vn,ro,oo,ni,bi,xe):Lu(We.kind,Vt,ee,W,X,Oo,h,vn,ro,oo,c,ni,0,xe):Ya(We.kind,Vt,ee,W,X,Oo,h,vn,ro,oo,c,ni,xe);let ao={program:Bt,buffers:ze,uniformValues:ln,projectionData:ba,atlasTexture:ci,atlasTextureIcon:Mi,atlasInterpolation:dt,atlasInterpolationIcon:$t,isSDF:Me,hasHalo:er};if(K&&ye.canOverlap){ie=!0;let wi=ze.segments.get();for(let Ei of wi)ue.push({segments:new o.aM([Ei]),sortKey:Ei.sortKey,state:ao,terrainData:jt})}else ue.push({segments:ze.segments,sortKey:0,state:ao,terrainData:jt})}ie&&ue.sort((de,me)=>de.sortKey-me.sortKey);for(let de of ue){let me=de.state;if(D.activeTexture.set(F.TEXTURE0),me.atlasTexture.bind(me.atlasInterpolation,F.CLAMP_TO_EDGE),me.atlasTextureIcon&&(D.activeTexture.set(F.TEXTURE1),me.atlasTextureIcon&&me.atlasTextureIcon.bind(me.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),me.isSDF){let ye=me.uniformValues;me.hasHalo&&(ye.u_is_halo=1,is(me.buffers,de.segments,r,h,me.program,oe,M,k,ye,me.projectionData,de.terrainData)),ye.u_is_halo=0}is(me.buffers,de.segments,r,h,me.program,oe,M,k,me.uniformValues,me.projectionData,de.terrainData)}}function is(h,e,r,s,c,p,y,w,T,P,M){let k=s.context;c.draw(k,k.gl.TRIANGLES,p,y,w,rt.backCCW,T,M,P,r.id,h.layoutVertexBuffer,h.indexBuffer,e,r.paint,s.transform.zoom,h.programConfigurations.get(r.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Tc(h,e,r,s,c){let p=h.context,y=p.gl,w=Lt.disabled,T=new ei([y.ONE,y.ONE],o.bf.transparent,[!0,!0,!0,!0]),P=e.getBucket(r);if(!P)return;let M=s.key,k=r.heatmapFbos.get(M);k||(k=ns(p,e.tileSize,e.tileSize),r.heatmapFbos.set(M,k)),p.bindFramebuffer.set(k.framebuffer),p.viewport.set([0,0,e.tileSize,e.tileSize]),p.clear({color:o.bf.transparent});let A=P.programConfigurations.get(r.id),D=h.useProgram("heatmap",A,!c),F=h.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Z=h.style.map.terrain.getTerrainData(s);D.draw(p,y.TRIANGLES,ht.disabled,w,T,rt.disabled,Cu(e,h.transform.zoom,r.paint.get("heatmap-intensity"),1),Z,F,r.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,r.paint,h.transform.zoom,A)}function qu(h,e,r,s,c){let p=h.context,y=p.gl,w=h.transform;p.setColorMode(h.colorModeForRenderPass());let T=rs(p,e),P=r.key,M=e.heatmapFbos.get(P);if(!M)return;p.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,M.colorAttachment.get()),p.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);let k=w.getProjectionData({overscaledTileID:r,applyTerrainMatrix:c,applyGlobeMatrix:!s});h.useProgram("heatmapTexture").draw(p,y.TRIANGLES,ht.disabled,Lt.disabled,h.colorModeForRenderPass(),rt.disabled,cc(h,e,0,1),null,k,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,w.zoom),M.destroy(),e.heatmapFbos.delete(P)}function ns(h,e,r){var s,c;let p=h.gl,y=p.createTexture();p.bindTexture(p.TEXTURE_2D,y),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);let w=(s=h.HALF_FLOAT)!==null&&s!==void 0?s:p.UNSIGNED_BYTE,T=(c=h.RGBA16F)!==null&&c!==void 0?c:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,T,e,r,0,p.RGBA,w,null);let P=h.createFramebuffer(e,r,!1,!1);return P.colorAttachment.set(y),P}function rs(h,e){return e.colorRampTexture||(e.colorRampTexture=new o.T(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function os(h,e,r,s,c){if(!r||!s||!s.imageAtlas)return;let p=s.imageAtlas.patternPositions,y=p[r.to.toString()],w=p[r.from.toString()];if(!y&&w&&(y=w),!w&&y&&(w=y),!y||!w){let T=c.getPaintProperty(e);y=p[T],w=p[T]}y&&w&&h.setConstantPatternPositions(y,w)}function Js(h,e,r,s,c,p,y,w){let T=h.context.gl,P="fill-pattern",M=r.paint.get(P),k=M&&M.constantOr(1),A=r.getCrossfadeParameters(),D,F,Z,G,W,X=h.transform,ee=r.paint.get("fill-translate"),K=r.paint.get("fill-translate-anchor");y?(F=k&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=T.LINES):(F=k?"fillPattern":"fill",D=T.TRIANGLES);let ie=M.constantOr(null);for(let oe of s){let J=e.getTile(oe);if(k&&!J.patternsLoaded())continue;let ue=J.getBucket(r);if(!ue)continue;let xe=ue.programConfigurations.get(r.id),de=h.useProgram(F,xe),me=h.style.map.terrain&&h.style.map.terrain.getTerrainData(oe);k&&(h.context.activeTexture.set(T.TEXTURE0),J.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),xe.updatePaintBuffers(A)),os(xe,P,ie,J,r);let ye=X.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),ze=o.aD(X,J,ee,K);if(y){G=ue.indexBuffer2,W=ue.segments2;let Me=[T.drawingBufferWidth,T.drawingBufferHeight];Z=F==="fillOutlinePattern"&&k?Xa(h,A,J,Me,ze):Ha(Me,ze)}else G=ue.indexBuffer,W=ue.segments,Z=k?Ns(h,A,J,ze):{u_fill_translate:ze};let Be=h.stencilModeForClipping(oe);de.draw(h.context,D,c,Be,p,rt.backCCW,Z,me,ye,r.id,ue.layoutVertexBuffer,G,W,r.paint,h.transform.zoom,xe)}}function Sc(h,e,r,s,c,p,y,w){let T=h.context,P=T.gl,M="fill-extrusion-pattern",k=r.paint.get(M),A=k.constantOr(1),D=r.getCrossfadeParameters(),F=r.paint.get("fill-extrusion-opacity"),Z=k.constantOr(null),G=h.transform;for(let W of s){let X=e.getTile(W),ee=X.getBucket(r);if(!ee)continue;let K=h.style.map.terrain&&h.style.map.terrain.getTerrainData(W),ie=ee.programConfigurations.get(r.id),oe=h.useProgram(A?"fillExtrusionPattern":"fillExtrusion",ie);A&&(h.context.activeTexture.set(P.TEXTURE0),X.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ie.updatePaintBuffers(D));let J=G.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!w,applyTerrainMatrix:!0});os(ie,M,Z,X,r);let ue=o.aD(G,X,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),xe=r.paint.get("fill-extrusion-vertical-gradient"),de=A?mp(h,xe,F,ue,W,D,X):Wn(h,xe,F,ue);oe.draw(T,T.gl.TRIANGLES,c,p,y,rt.backCCW,de,K,J,r.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,r.paint,h.transform.zoom,ie,h.style.map.terrain&&ee.centroidVertexBuffer)}}function ko(h,e,r,s,c,p,y,w,T){var P;let M=h.style.projection,k=h.context,A=h.transform,D=k.gl,F=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],Z=h.useProgram("hillshade",null,!1,F),G=!h.options.moving;for(let W of s){let X=e.getTile(W),ee=X.fbo;if(!ee)continue;let K=M.getMeshFromTileID(k,W.canonical,w,!0,"raster"),ie=(P=h.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(W);k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,ee.colorAttachment.get());let oe=A.getProjectionData({overscaledTileID:W,aligned:G,applyGlobeMatrix:!T,applyTerrainMatrix:!0});Z.draw(k,D.TRIANGLES,p,c[W.overscaledZ],y,rt.backCCW,_p(h,X,r),ie,oe,r.id,K.vertexBuffer,K.indexBuffer,K.segments)}}function Ic(h,e,r,s,c,p,y,w,T){var P;let M=h.style.projection,k=h.context,A=h.transform,D=k.gl,F=h.useProgram("colorRelief"),Z=!h.options.moving,G=!0,W=0;for(let X of s){let ee=e.getTile(X),K=ee.dem;if(G){let de=D.getParameter(D.MAX_TEXTURE_SIZE),{elevationTexture:me,colorTexture:ye}=r.getColorRampTextures(k,de,K.getUnpackVector());k.activeTexture.set(D.TEXTURE1),me.bind(D.NEAREST,D.CLAMP_TO_EDGE),k.activeTexture.set(D.TEXTURE4),ye.bind(D.LINEAR,D.CLAMP_TO_EDGE),G=!1,W=me.size[0]}if(!K||!K.data)continue;let ie=K.stride,oe=K.getPixels();if(k.activeTexture.set(D.TEXTURE0),k.pixelStoreUnpackPremultiplyAlpha.set(!1),ee.demTexture=ee.demTexture||h.getTileTexture(ie),ee.demTexture){let de=ee.demTexture;de.update(oe,{premultiply:!1}),de.bind(D.LINEAR,D.CLAMP_TO_EDGE)}else ee.demTexture=new o.T(k,oe,D.RGBA,{premultiply:!1}),ee.demTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);let J=M.getMeshFromTileID(k,X.canonical,w,!0,"raster"),ue=(P=h.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(X),xe=A.getProjectionData({overscaledTileID:X,aligned:Z,applyGlobeMatrix:!T,applyTerrainMatrix:!0});F.draw(k,D.TRIANGLES,p,c[X.overscaledZ],y,rt.backCCW,Eu(r,ee.dem,W),ue,xe,r.id,J.vertexBuffer,J.indexBuffer,J.segments)}}let Qs=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function Lo(h,e,r,s,c,p,y,w,T=!1,P=!1){let M=s[s.length-1].overscaledZ,k=h.context,A=k.gl,D=h.useProgram("raster"),F=h.transform,Z=h.style.projection,G=h.colorModeForRenderPass(),W=!h.options.moving;for(let X of s){let ee=h.getDepthModeForSublayer(X.overscaledZ-M,r.paint.get("raster-opacity")===1?ht.ReadWrite:ht.ReadOnly,A.LESS),K=e.getTile(X);K.registerFadeDuration(r.paint.get("raster-fade-duration"));let ie=e.findLoadedParent(X,0),oe=e.findLoadedSibling(X),J=Pc(K,ie||oe||null,e,r,h.transform,h.style.map.terrain),ue,xe,de=r.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;k.activeTexture.set(A.TEXTURE0),K.texture.bind(de,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(A.TEXTURE1),ie?(ie.texture.bind(de,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ue=Math.pow(2,ie.tileID.overscaledZ-K.tileID.overscaledZ),xe=[K.tileID.canonical.x*ue%1,K.tileID.canonical.y*ue%1]):K.texture.bind(de,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),K.texture.useMipmap&&k.extTextureFilterAnisotropic&&h.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);let me=h.style.map.terrain&&h.style.map.terrain.getTerrainData(X),ye=F.getProjectionData({overscaledTileID:X,aligned:W,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),ze=Ka(xe||[0,0],ue||1,J,r,w),Be=Z.getMeshFromTileID(k,X.canonical,p,y,"raster");D.draw(k,A.TRIANGLES,ee,c?c[X.overscaledZ]:Lt.disabled,G,T?rt.frontCCW:rt.backCCW,ze,me,ye,r.id,Be.vertexBuffer,Be.indexBuffer,Be.segments)}}function Pc(h,e,r,s,c,p){let y=s.paint.get("raster-fade-duration");if(!p&&y>0){let w=ne.now(),T=(w-h.timeAdded)/y,P=e?(w-e.timeAdded)/y:-1,M=r.getSource(),k=Xe(c,{tileSize:M.tileSize,roundZoom:M.roundZoom}),A=!e||Math.abs(e.tileID.overscaledZ-k)>Math.abs(h.tileID.overscaledZ-k),D=A&&h.refreshedUponExpiration?1:o.ah(A?T:1-P,0,1);return h.refreshedUponExpiration&&T>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-D}:{opacity:D,mix:0}}return{opacity:1,mix:0}}let Wu=new o.bf(1,0,0,1),Hu=new o.bf(0,1,0,1),el=new o.bf(0,0,1,1),Cc=new o.bf(1,0,1,1),Mp=new o.bf(0,1,1,1);function Mc(h,e,r,s){_r(h,0,e+r/2,h.transform.width,r,s)}function li(h,e,r,s){_r(h,e-r/2,0,r,h.transform.height,s)}function _r(h,e,r,s,c,p){let y=h.context,w=y.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*h.pixelRatio,r*h.pixelRatio,s*h.pixelRatio,c*h.pixelRatio),y.clear({color:p}),w.disable(w.SCISSOR_TEST)}function Rn(h,e,r){let s=h.context,c=s.gl,p=h.useProgram("debug"),y=ht.disabled,w=Lt.disabled,T=h.colorModeForRenderPass(),P="$debug",M=h.style.map.terrain&&h.style.map.terrain.getTerrainData(r);s.activeTexture.set(c.TEXTURE0);let k=e.getTileByID(r.key).latestRawTileData,A=Math.floor((k&&k.byteLength||0)/1024),D=e.getTile(r).tileSize,F=512/Math.min(D,512)*(r.overscaledZ/h.transform.zoom)*.5,Z=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Z+=` => ${r.overscaledZ}`),(function(W,X){W.initDebugOverlayCanvas();let ee=W.debugOverlayCanvas,K=W.context.gl,ie=W.debugOverlayCanvas.getContext("2d");ie.clearRect(0,0,ee.width,ee.height),ie.shadowColor="white",ie.shadowBlur=2,ie.lineWidth=1.5,ie.strokeStyle="white",ie.textBaseline="top",ie.font="bold 36px Open Sans, sans-serif",ie.fillText(X,5,5),ie.strokeText(X,5,5),W.debugOverlayTexture.update(ee),W.debugOverlayTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE)})(h,`${Z} ${A}kB`);let G=h.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(s,c.TRIANGLES,y,w,ei.alphaBlended,rt.disabled,Po(o.bf.transparent,F),null,G,P,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),p.draw(s,c.LINE_STRIP,y,w,T,rt.disabled,Po(o.bf.red),M,G,P,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function tl(h,e,r,s){let{isRenderingGlobe:c}=s,p=h.context,y=p.gl,w=h.transform,T=h.colorModeForRenderPass(),P=h.getDepthModeFor3D(),M=h.useProgram("terrain");p.bindFramebuffer.set(null),p.viewport.set([0,0,h.width,h.height]);for(let k of r){let A=e.getTerrainMesh(k.tileID),D=h.renderToTexture.getTexture(k),F=e.getTerrainData(k.tileID);p.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,D.texture);let Z=e.getMeshFrameDelta(w.zoom),G=w.calculateFogMatrix(k.tileID.toUnwrapped()),W=js(Z,G,h.style.sky,w.pitch,c),X=w.getProjectionData({overscaledTileID:k.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});M.draw(p,y.TRIANGLES,P,Lt.disabled,T,rt.backCCW,W,F,X,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}function as(h,e){if(!e.mesh){let r=new o.aL;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);let s=new o.aN;s.emplaceBack(0,1,2),s.emplaceBack(0,2,3),e.mesh=new xo(h.createVertexBuffer(r,eo.members),h.createIndexBuffer(s),o.aM.simpleSegment(0,0,r.length,s.length))}return e.mesh}class Xu{constructor(e,r){this.context=new $u(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=xt.maxUnderzooming+xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ra}resize(e,r,s){if(this.width=Math.floor(e*s),this.height=Math.floor(r*s),this.pixelRatio=s,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let c of this.style._order)this.style._layers[c].resize()}setup(){let e=this.context,r=new o.aL;r.emplaceBack(0,0),r.emplaceBack(o.$,0),r.emplaceBack(0,o.$),r.emplaceBack(o.$,o.$),this.tileExtentBuffer=e.createVertexBuffer(r,eo.members),this.tileExtentSegments=o.aM.simpleSegment(0,0,4,2);let s=new o.aL;s.emplaceBack(0,0),s.emplaceBack(o.$,0),s.emplaceBack(0,o.$),s.emplaceBack(o.$,o.$),this.debugBuffer=e.createVertexBuffer(s,eo.members),this.debugSegments=o.aM.simpleSegment(0,0,4,5);let c=new o.c6;c.emplaceBack(0,0,0,0),c.emplaceBack(o.$,0,o.$,0),c.emplaceBack(0,o.$,0,o.$),c.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=e.createVertexBuffer(c,pp.members),this.rasterBoundsSegments=o.aM.simpleSegment(0,0,4,2);let p=new o.aL;p.emplaceBack(0,0),p.emplaceBack(o.$,0),p.emplaceBack(0,o.$),p.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(p,eo.members),this.rasterBoundsSegmentsPosOnly=o.aM.simpleSegment(0,0,4,5);let y=new o.aL;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,eo.members),this.viewportSegments=o.aM.simpleSegment(0,0,4,2);let w=new o.c7;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);let T=new o.aN;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);let P=this.context.gl;this.stencilClearMode=new Lt({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.tileExtentMesh=new xo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let s=o.L();o.bY(s,0,this.width,this.height,0,0,1),o.N(s,s,[r.drawingBufferWidth,r.drawingBufferHeight,0]);let c={mainMatrix:s,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:s};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,ht.disabled,this.stencilClearMode,ei.disabled,rt.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();let c=this.context;c.setColorMode(ei.disabled),c.setDepthMode(ht.disabled);let p={};for(let y of r)p[y.key]=this.nextStencilID++;this._renderTileMasks(p,r,s,!0),this._renderTileMasks(p,r,s,!1),this._tileClippingMaskIDs=p}_renderTileMasks(e,r,s,c){let p=this.context,y=p.gl,w=this.style.projection,T=this.transform,P=this.useProgram("clippingMask");for(let M of r){let k=e[M.key],A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),D=w.getMeshFromTileID(this.context,M.canonical,c,!0,"stencil"),F=T.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!s,applyTerrainMatrix:!0});P.draw(p,y.TRIANGLES,ht.disabled,new Lt({func:y.ALWAYS,mask:0},k,255,y.KEEP,y.KEEP,y.REPLACE),ei.disabled,s?rt.disabled:rt.backCCW,null,A,F,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}_renderTilesDepthBuffer(){let e=this.context,r=e.gl,s=this.style.projection,c=this.transform,p=this.useProgram("depth"),y=this.getDepthModeFor3D(),w=pe(c,{tileSize:c.tileSize});for(let T of w){let P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),M=s.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),k=c.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(e,r.TRIANGLES,y,Lt.disabled,ei.disabled,rt.backCCW,null,P,k,"$clipping",M.vertexBuffer,M.indexBuffer,M.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,r=this.context.gl;return new Lt({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){let r=this.context.gl;return new Lt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let r=this.context.gl,s=e.sort((y,w)=>w.overscaledZ-y.overscaledZ),c=s[s.length-1].overscaledZ,p=s[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();let y={};for(let w=0;w<p;w++)y[w+c]=new Lt({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=p,[y,s]}return[{[c]:Lt.disabled},s]}stencilConfigForOverlapTwoPass(e){let r=this.context.gl,s=e.sort((y,w)=>w.overscaledZ-y.overscaledZ),c=s[s.length-1].overscaledZ,p=s[0].overscaledZ-c+1;if(this.clearStencil(),p>1){let y={},w={};for(let T=0;T<p;T++)y[T+c]=new Lt({func:r.GREATER,mask:255},p+1+T,255,r.KEEP,r.KEEP,r.REPLACE),w[T+c]=new Lt({func:r.GREATER,mask:255},1+T,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*p+1,[y,w,s]}return this.nextStencilID=3,[{[c]:new Lt({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[c]:new Lt({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},s]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new ei([e.CONSTANT_COLOR,e.ONE],new o.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ei.unblended:ei.alphaBlended}getDepthModeForSublayer(e,r,s){if(!this.opaquePassEnabledForLayer())return ht.disabled;let c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ht(s||this.context.gl.LEQUAL,r,[c,c])}getDepthModeFor3D(){return new ht(this.context.gl.LEQUAL,ht.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var s,c;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ne.now()),this.imageManager.beginFrame();let p=this.style._order,y=this.style.sourceCaches,w={},T={},P={},M={isRenderingToTexture:!1,isRenderingGlobe:((s=e.projection)===null||s===void 0?void 0:s.transitionState)>0};for(let A in y){let D=y[A];D.used&&D.prepare(this.context),w[A]=D.getVisibleCoordinates(!1),T[A]=w[A].slice().reverse(),P[A]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let A of p){let D=this.style._layers[A];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;let F=T[D.source];(D.type==="custom"||F.length)&&this.renderLayer(this,y[D.source],D,F,M)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:A=>this.useProgram(A)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.bf.black:o.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(A,D){let F=A.context,Z=F.gl,G=((oe,J,ue)=>{let xe=Math.cos(J.rollInRadians),de=Math.sin(J.rollInRadians),me=ae(J),ye=J.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:oe.properties.get("sky-color"),u_horizon_color:oe.properties.get("horizon-color"),u_horizon:[(J.width/2-me*de)*ue,(J.height/2+me*xe)*ue],u_horizon_normal:[-de,xe],u_sky_horizon_blend:oe.properties.get("sky-horizon-blend")*J.height/2*ue,u_sky_blend:ye}})(D,A.style.map.transform,A.pixelRatio),W=new ht(Z.LEQUAL,ht.ReadWrite,[0,1]),X=Lt.disabled,ee=A.colorModeForRenderPass(),K=A.useProgram("sky"),ie=as(F,D);K.draw(F,Z.TRIANGLES,W,X,ee,rt.disabled,G,null,void 0,"sky",ie.vertexBuffer,ie.indexBuffer,ie.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){let A=this.style._layers[p[this.currentLayer]],D=y[A.source],F=w[A.source];this._renderTileClippingMasks(A,F,!1),this.renderLayer(this,D,A,F,M)}this.renderPass="translucent";let k=!1;for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){let A=this.style._layers[p[this.currentLayer]],D=y[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A,M))continue;this.opaquePassEnabledForLayer()||k||(k=!0,M.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let F=(A.type==="symbol"?P:T)[A.source];this._renderTileClippingMasks(A,w[A.source],!!this.renderToTexture),this.renderLayer(this,D,A,F,M)}if(M.isRenderingGlobe&&(function(A,D,F){let Z=A.context,G=Z.gl,W=A.useProgram("atmosphere"),X=new ht(G.LEQUAL,ht.ReadOnly,[0,1]),ee=A.transform,K=(function(ye,ze){let Be=ye.properties.get("position"),Me=[-Be.x,-Be.y,-Be.z],We=o.ag(new Float64Array(16));return ye.properties.get("anchor")==="map"&&(o.b6(We,We,ze.rollInRadians),o.b7(We,We,-ze.pitchInRadians),o.b6(We,We,ze.bearingInRadians),o.b7(We,We,ze.center.lat*Math.PI/180),o.bz(We,We,-ze.center.lng*Math.PI/180)),o.c5(Me,Me,We),Me})(F,A.transform),ie=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),oe=D.properties.get("atmosphere-blend")*ie.projectionTransition;if(oe===0)return;let J=aa(ee.worldSize,ee.center.lat),ue=ee.inverseProjectionMatrix,xe=new Float64Array(4);xe[3]=1,o.aw(xe,xe,ee.modelViewProjectionMatrix),xe[0]/=xe[3],xe[1]/=xe[3],xe[2]/=xe[3],xe[3]=1,o.aw(xe,xe,ue),xe[0]/=xe[3],xe[1]/=xe[3],xe[2]/=xe[3],xe[3]=1;let de=((ye,ze,Be,Me,We)=>({u_sun_pos:ye,u_atmosphere_blend:ze,u_globe_position:Be,u_globe_radius:Me,u_inv_proj_matrix:We}))(K,oe,[xe[0],xe[1],xe[2]],J,ue),me=as(Z,D);W.draw(Z,G.TRIANGLES,X,Lt.disabled,ei.alphaBlended,rt.disabled,de,null,null,"atmosphere",me.vertexBuffer,me.indexBuffer,me.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let A=(function(D,F){let Z=null,G=Object.values(D._layers).flatMap(K=>K.source&&!K.isHidden(F)?[D.sourceCaches[K.source]]:[]),W=G.filter(K=>K.getSource().type==="vector"),X=G.filter(K=>K.getSource().type!=="vector"),ee=K=>{(!Z||Z.getSource().maxzoom<K.getSource().maxzoom)&&(Z=K)};return W.forEach(K=>ee(K)),Z||X.forEach(K=>ee(K)),Z})(this.style,this.transform.zoom);A&&(function(D,F,Z){for(let G=0;G<Z.length;G++)Rn(D,F,Z[G])})(this,A,A.getVisibleCoordinates())}this.options.showPadding&&(function(A){let D=A.transform.padding;Mc(A,A.transform.height-(D.top||0),3,Wu),Mc(A,D.bottom||0,3,Hu),li(A,D.left||0,3,el),li(A,A.transform.width-(D.right||0),3,Cc);let F=A.transform.centerPoint;(function(Z,G,W,X){_r(Z,G-1,W-10,2,20,X),_r(Z,G-10,W-1,20,2,X)})(A,F.x,A.transform.height-F.y,Mp)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let r=this.terrainFacilitator.matrix,s=this.transform.modelViewProjectionMatrix,c=this.terrainFacilitator.dirty;c||(c=e?!o.c8(r,s):!o.c9(r,s)),c||(c=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(o.ca(r,s),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(p,y){let w=p.context,T=w.gl,P=p.transform,M=ei.unblended,k=new ht(T.LEQUAL,ht.ReadWrite,[0,1]),A=y.sourceCache.getRenderableTiles(),D=p.useProgram("terrainDepth");w.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:o.bf.transparent,depth:1});for(let F of A){let Z=y.getTerrainMesh(F.tileID),G=y.getTerrainData(F.tileID),W=P.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),X={u_ele_delta:y.getMeshFrameDelta(P.zoom)};D.draw(w,T.TRIANGLES,k,Lt.disabled,M,rt.backCCW,X,G,W,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain),(function(p,y){let w=p.context,T=w.gl,P=p.transform,M=ei.unblended,k=new ht(T.LEQUAL,ht.ReadWrite,[0,1]),A=y.getCoordsTexture(),D=y.sourceCache.getRenderableTiles(),F=p.useProgram("terrainCoords");w.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:o.bf.transparent,depth:1}),y.coordsIndex=[];for(let Z of D){let G=y.getTerrainMesh(Z.tileID),W=y.getTerrainData(Z.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,A.texture);let X={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(P.zoom)},ee=P.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});F.draw(w,T.TRIANGLES,k,Lt.disabled,M,rt.backCCW,X,W,ee,"terrain",G.vertexBuffer,G.indexBuffer,G.segments),y.coordsIndex.push(Z.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain))}renderLayer(e,r,s,c,p){s.isHidden(this.transform.zoom)||(s.type==="background"||s.type==="custom"||(c||[]).length)&&(this.id=s.id,o.cb(s)?(function(y,w,T,P,M,k){if(y.renderPass!=="translucent")return;let{isRenderingToTexture:A}=k,D=Lt.disabled,F=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Z,G,W,X,ee,K,ie,oe,J){let ue=G.transform,xe=G.style.map.terrain,de=ee==="map",me=K==="map";for(let ye of Z){let ze=X.getTile(ye),Be=ze.getBucket(W);if(!Be||!Be.text||!Be.text.segments.get().length)continue;let Me=o.an(Be.textSizeData,ue.zoom),We=o.aC(ze,1,G.transform.zoom),gt=gi(de,G.transform,We),Bt=W.layout.get("icon-text-fit")!=="none"&&Be.hasIconData();if(Me){let Vt=Math.pow(2,ue.zoom-ze.tileID.overscaledZ),jt=xe?(ni,ci)=>xe.getElevation(ye,ni,ci):null;wc(Be,de,me,J,ue,gt,Vt,Me,Bt,o.aD(ue,ze,ie,oe),ye.toUnwrapped(),jt)}}})(P,y,T,w,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),M),T.paint.get("icon-opacity").constantOr(1)!==0&&ts(y,w,T,P,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),D,F,A),T.paint.get("text-opacity").constantOr(1)!==0&&ts(y,w,T,P,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),D,F,A),w.map.showCollisionBoxes&&(Gu(y,w,T,P,!0),Gu(y,w,T,P,!1))})(e,r,s,c,this.style.placement.variableOffsets,p):o.cc(s)?(function(y,w,T,P,M){if(y.renderPass!=="translucent")return;let{isRenderingToTexture:k}=M,A=T.paint.get("circle-opacity"),D=T.paint.get("circle-stroke-width"),F=T.paint.get("circle-stroke-opacity"),Z=!T.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(D.constantOr(1)===0||F.constantOr(1)===0))return;let G=y.context,W=G.gl,X=y.transform,ee=y.getDepthModeForSublayer(0,ht.ReadOnly),K=Lt.disabled,ie=y.colorModeForRenderPass(),oe=[],J=X.getCircleRadiusCorrection();for(let ue=0;ue<P.length;ue++){let xe=P[ue],de=w.getTile(xe),me=de.getBucket(T);if(!me)continue;let ye=T.paint.get("circle-translate"),ze=T.paint.get("circle-translate-anchor"),Be=o.aD(X,de,ye,ze),Me=me.programConfigurations.get(T.id),We=y.useProgram("circle",Me),gt=me.layoutVertexBuffer,Bt=me.indexBuffer,Vt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(xe),jt={programConfiguration:Me,program:We,layoutVertexBuffer:gt,indexBuffer:Bt,uniformValues:fp(y,de,T,Be,J),terrainData:Vt,projectionData:X.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!k,applyTerrainMatrix:!0})};if(Z){let ni=me.segments.get();for(let ci of ni)oe.push({segments:new o.aM([ci]),sortKey:ci.sortKey,state:jt})}else oe.push({segments:me.segments,sortKey:0,state:jt})}Z&&oe.sort((ue,xe)=>ue.sortKey-xe.sortKey);for(let ue of oe){let{programConfiguration:xe,program:de,layoutVertexBuffer:me,indexBuffer:ye,uniformValues:ze,terrainData:Be,projectionData:Me}=ue.state;de.draw(G,W.TRIANGLES,ee,K,ie,rt.backCCW,ze,Be,Me,T.id,me,ye,ue.segments,T.paint,y.transform.zoom,xe)}})(e,r,s,c,p):o.cd(s)?(function(y,w,T,P,M){if(T.paint.get("heatmap-opacity")===0)return;let k=y.context,{isRenderingToTexture:A,isRenderingGlobe:D}=M;if(y.style.map.terrain){for(let F of P){let Z=w.getTile(F);w.hasRenderableParent(F)||(y.renderPass==="offscreen"?Tc(y,Z,T,F,D):y.renderPass==="translucent"&&qu(y,T,F,A,D))}k.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?(function(F,Z,G,W){let X=F.context,ee=X.gl,K=F.transform,ie=Lt.disabled,oe=new ei([ee.ONE,ee.ONE],o.bf.transparent,[!0,!0,!0,!0]);(function(J,ue,xe){let de=J.gl;J.activeTexture.set(de.TEXTURE1),J.viewport.set([0,0,ue.width/4,ue.height/4]);let me=xe.heatmapFbos.get(o.c2);me?(de.bindTexture(de.TEXTURE_2D,me.colorAttachment.get()),J.bindFramebuffer.set(me.framebuffer)):(me=ns(J,ue.width/4,ue.height/4),xe.heatmapFbos.set(o.c2,me))})(X,F,G),X.clear({color:o.bf.transparent});for(let J=0;J<W.length;J++){let ue=W[J];if(Z.hasRenderableParent(ue))continue;let xe=Z.getTile(ue),de=xe.getBucket(G);if(!de)continue;let me=de.programConfigurations.get(G.id),ye=F.useProgram("heatmap",me),ze=K.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Be=K.getCircleRadiusCorrection();ye.draw(X,ee.TRIANGLES,ht.disabled,ie,oe,rt.backCCW,Cu(xe,K.zoom,G.paint.get("heatmap-intensity"),Be),null,ze,G.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,G.paint,K.zoom,me)}X.viewport.set([0,0,F.width,F.height])})(y,w,T,P):y.renderPass==="translucent"&&(function(F,Z){let G=F.context,W=G.gl;G.setColorMode(F.colorModeForRenderPass());let X=Z.heatmapFbos.get(o.c2);X&&(G.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,X.colorAttachment.get()),G.activeTexture.set(W.TEXTURE1),rs(G,Z).bind(W.LINEAR,W.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(G,W.TRIANGLES,ht.disabled,Lt.disabled,F.colorModeForRenderPass(),rt.disabled,cc(F,Z,0,1),null,null,Z.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,Z.paint,F.transform.zoom))})(y,T)})(e,r,s,c,p):o.ce(s)?(function(y,w,T,P,M){if(y.renderPass!=="translucent")return;let{isRenderingToTexture:k}=M,A=T.paint.get("line-opacity"),D=T.paint.get("line-width");if(A.constantOr(1)===0||D.constantOr(1)===0)return;let F=y.getDepthModeForSublayer(0,ht.ReadOnly),Z=y.colorModeForRenderPass(),G=T.paint.get("line-dasharray"),W=T.paint.get("line-pattern"),X=W.constantOr(1),ee=T.paint.get("line-gradient"),K=T.getCrossfadeParameters(),ie=X?"linePattern":G?"lineSDF":ee?"lineGradient":"line",oe=y.context,J=oe.gl,ue=y.transform,xe=!0;for(let de of P){let me=w.getTile(de);if(X&&!me.patternsLoaded())continue;let ye=me.getBucket(T);if(!ye)continue;let ze=ye.programConfigurations.get(T.id),Be=y.context.program.get(),Me=y.useProgram(ie,ze),We=xe||Me.program!==Be,gt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(de),Bt=W.constantOr(null);if(Bt&&me.imageAtlas){let dt=me.imageAtlas,$t=dt.patternPositions[Bt.to.toString()],bi=dt.patternPositions[Bt.from.toString()];$t&&bi&&ze.setConstantPatternPositions($t,bi)}let Vt=ue.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),jt=ue.getPixelScale(),ni=X?ku(y,me,T,jt,K):G?Co(y,me,T,jt,G,K):ee?Au(y,me,T,jt,ye.lineClipsArray.length):$s(y,me,T,jt);if(X)oe.activeTexture.set(J.TEXTURE0),me.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ze.updatePaintBuffers(K);else if(G&&(We||y.lineAtlas.dirty))oe.activeTexture.set(J.TEXTURE0),y.lineAtlas.bind(oe);else if(ee){let dt=ye.gradients[T.id],$t=dt.texture;if(T.gradientVersion!==dt.version){let bi=256;if(T.stepInterpolant){let Mi=w.getSource().maxzoom,Fi=de.canonical.z===Mi?Math.ceil(1<<y.transform.maxZoom-de.canonical.z):1;bi=o.ah(o.c3(ye.maxLineLength/o.$*1024*Fi),256,oe.maxTextureSize)}dt.gradient=o.c4({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:bi,image:dt.gradient||void 0,clips:ye.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new o.T(oe,dt.gradient,J.RGBA),dt.version=T.gradientVersion,$t=dt.texture}oe.activeTexture.set(J.TEXTURE0),$t.bind(T.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}let ci=y.stencilModeForClipping(de);Me.draw(oe,J.TRIANGLES,F,ci,Z,rt.disabled,ni,gt,Vt,T.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,T.paint,y.transform.zoom,ze,ye.layoutVertexBuffer2),xe=!1}})(e,r,s,c,p):o.cf(s)?(function(y,w,T,P,M){let k=T.paint.get("fill-color"),A=T.paint.get("fill-opacity");if(A.constantOr(1)===0)return;let{isRenderingToTexture:D}=M,F=y.colorModeForRenderPass(),Z=T.paint.get("fill-pattern"),G=y.opaquePassEnabledForLayer()&&!Z.constantOr(1)&&k.constantOr(o.bf.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===G){let W=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?ht.ReadWrite:ht.ReadOnly);Js(y,w,T,P,W,F,!1,D)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){let W=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,ht.ReadOnly);Js(y,w,T,P,W,F,!0,D)}})(e,r,s,c,p):o.cg(s)?(function(y,w,T,P,M){let k=T.paint.get("fill-extrusion-opacity");if(k===0)return;let{isRenderingToTexture:A}=M;if(y.renderPass==="translucent"){let D=new ht(y.context.gl.LEQUAL,ht.ReadWrite,y.depthRangeFor3D);if(k!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))Sc(y,w,T,P,D,Lt.disabled,ei.disabled,A),Sc(y,w,T,P,D,y.stencilModeFor3D(),y.colorModeForRenderPass(),A);else{let F=y.colorModeForRenderPass();Sc(y,w,T,P,D,Lt.disabled,F,A)}}})(e,r,s,c,p):o.ch(s)?(function(y,w,T,P,M){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;let{isRenderingToTexture:k}=M,A=y.context,D=y.style.projection.useSubdivision,F=y.getDepthModeForSublayer(0,ht.ReadOnly),Z=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(G,W,X,ee,K,ie,oe){let J=G.context,ue=J.gl;for(let xe of X){let de=W.getTile(xe),me=de.dem;if(!me||!me.data||!de.needsHillshadePrepare)continue;let ye=me.dim,ze=me.stride,Be=me.getPixels();if(J.activeTexture.set(ue.TEXTURE1),J.pixelStoreUnpackPremultiplyAlpha.set(!1),de.demTexture=de.demTexture||G.getTileTexture(ze),de.demTexture){let We=de.demTexture;We.update(Be,{premultiply:!1}),We.bind(ue.NEAREST,ue.CLAMP_TO_EDGE)}else de.demTexture=new o.T(J,Be,ue.RGBA,{premultiply:!1}),de.demTexture.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);J.activeTexture.set(ue.TEXTURE0);let Me=de.fbo;if(!Me){let We=new o.T(J,{width:ye,height:ye,data:null},ue.RGBA);We.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),Me=de.fbo=J.createFramebuffer(ye,ye,!0,!1),Me.colorAttachment.set(We.texture)}J.bindFramebuffer.set(Me.framebuffer),J.viewport.set([0,0,ye,ye]),G.useProgram("hillshadePrepare").draw(J,ue.TRIANGLES,K,ie,oe,rt.disabled,Mu(de.tileID,me),null,null,ee.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments),de.needsHillshadePrepare=!1}})(y,w,P,T,F,Lt.disabled,Z),A.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(D){let[G,W,X]=y.stencilConfigForOverlapTwoPass(P);ko(y,w,T,X,G,F,Z,!1,k),ko(y,w,T,X,W,F,Z,!0,k)}else{let[G,W]=y.getStencilConfigForOverlapAndUpdateStencilID(P);ko(y,w,T,W,G,F,Z,!1,k)}})(e,r,s,c,p):o.ci(s)?(function(y,w,T,P,M){if(y.renderPass!=="translucent"||!P.length)return;let{isRenderingToTexture:k}=M,A=y.style.projection.useSubdivision,D=y.getDepthModeForSublayer(0,ht.ReadOnly),F=y.colorModeForRenderPass();if(A){let[Z,G,W]=y.stencilConfigForOverlapTwoPass(P);Ic(y,w,T,W,Z,D,F,!1,k),Ic(y,w,T,W,G,D,F,!0,k)}else{let[Z,G]=y.getStencilConfigForOverlapAndUpdateStencilID(P);Ic(y,w,T,G,Z,D,F,!1,k)}})(e,r,s,c,p):o.cj(s)?(function(y,w,T,P,M){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!P.length)return;let{isRenderingToTexture:k}=M,A=w.getSource(),D=y.style.projection.useSubdivision;if(A instanceof pr)Lo(y,w,T,P,null,!1,!1,A.tileCoords,A.flippedWindingOrder,k);else if(D){let[F,Z,G]=y.stencilConfigForOverlapTwoPass(P);Lo(y,w,T,G,F,!1,!0,Qs,!1,k),Lo(y,w,T,G,Z,!0,!0,Qs,!1,k)}else{let[F,Z]=y.getStencilConfigForOverlapAndUpdateStencilID(P);Lo(y,w,T,Z,F,!1,!0,Qs,!1,k)}})(e,r,s,c,p):o.ck(s)?(function(y,w,T,P,M){let k=T.paint.get("background-color"),A=T.paint.get("background-opacity");if(A===0)return;let{isRenderingToTexture:D}=M,F=y.context,Z=F.gl,G=y.style.projection,W=y.transform,X=W.tileSize,ee=T.paint.get("background-pattern");if(y.isPatternMissing(ee))return;let K=!ee&&k.a===1&&A===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==K)return;let ie=Lt.disabled,oe=y.getDepthModeForSublayer(0,K==="opaque"?ht.ReadWrite:ht.ReadOnly),J=y.colorModeForRenderPass(),ue=y.useProgram(ee?"backgroundPattern":"background"),xe=P||pe(W,{tileSize:X,terrain:y.style.map.terrain});ee&&(F.activeTexture.set(Z.TEXTURE0),y.imageManager.bind(y.context));let de=T.getCrossfadeParameters();for(let me of xe){let ye=W.getProjectionData({overscaledTileID:me,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),ze=ee?zu(A,y,ee,{tileID:me,tileSize:X},de):Du(A,k),Be=y.style.map.terrain&&y.style.map.terrain.getTerrainData(me),Me=G.getMeshFromTileID(F,me.canonical,!1,!0,"raster");ue.draw(F,Z.TRIANGLES,oe,ie,J,rt.backCCW,ze,Be,ye,T.id,Me.vertexBuffer,Me.indexBuffer,Me.segments)}})(e,0,s,c,p):o.cl(s)&&(function(y,w,T,P){let{isRenderingGlobe:M}=P,k=y.context,A=T.implementation,D=y.style.projection,F=y.transform,Z=F.getProjectionDataForCustomLayer(M),G={farZ:F.farZ,nearZ:F.nearZ,fov:F.fov*Math.PI/180,modelViewProjectionMatrix:F.modelViewProjectionMatrix,projectionMatrix:F.projectionMatrix,shaderData:{variantName:D.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${D.shaderPreludeCode.vertexSource}`,define:D.shaderDefine},defaultProjectionData:Z},W=A.renderingMode?A.renderingMode:"2d";if(y.renderPass==="offscreen"){let X=A.prerender;X&&(y.setCustomLayerDefaults(),k.setColorMode(y.colorModeForRenderPass()),X.call(A,k.gl,G),k.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),k.setColorMode(y.colorModeForRenderPass()),k.setStencilMode(Lt.disabled);let X=W==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,ht.ReadOnly);k.setDepthMode(X),A.render(k.gl,G),k.setDirty(),y.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,s,p))}saveTileTexture(e){let r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let r=this.imageManager.getPattern(e.from.toString()),s=this.imageManager.getPattern(e.to.toString());return!r||!s}useProgram(e,r,s=!1,c=[]){this.cache=this.cache||{};let p=!!this.style.map.terrain,y=this.style.projection,w=s?Zn.projectionMercator:y.shaderPreludeCode,T=s?Mr:y.shaderDefine,P=e+(r?r.cacheKey:"")+`/${s?bo:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(p?"/terrain":"")+(c?`/${c.join("/")}`:"");return this.cache[P]||(this.cache[P]=new lc(this.context,Zn[e],r,mc[e],this._showOverdrawInspector,p,w,T,c)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function Do(h,e){let r,s=!1,c=null,p=null,y=()=>{c=null,s&&(h.apply(p,r),c=setTimeout(y,e),s=!1)};return(...w)=>(s=!0,p=this,r=w,c||y(),c)}class il{constructor(e){this._getCurrentHash=()=>{let r=window.location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(s=c)}),(s&&s[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{let r=this._getCurrentHash();if(!this._isValidHash(r))return!1;let s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:s,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{let r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{let r=this._getCurrentHash();if(r.length===0)return;let s=r.join("/"),c=s;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${s}`);let p=window.location.hash.replace(c,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let y=window.location.href.replace(/(#.+)?$/,p);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Do(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let r=this._map.getCenter(),s=Math.round(100*this._map.getZoom())/100,c=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),y=Math.round(r.lng*p)/p,w=Math.round(r.lat*p)/p,T=this._map.getBearing(),P=this._map.getPitch(),M="";if(M+=e?`/${y}/${w}/${s}`:`${s}/${w}/${y}`,(T||P)&&(M+="/"+Math.round(10*T)/10),P&&(M+=`/${Math.round(P)}`),this._hashName){let k=this._hashName,A=!1,D=window.location.hash.slice(1).split("&").map(F=>{let Z=F.split("=")[0];return Z===k?(A=!0,`${Z}=${M}`):F}).filter(F=>F);return A||D.push(`${k}=${M}`),`#${D.join("&")}`}return`#${M}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.S(+e[2],+e[1])}catch{return!1}let r=+e[0],s=+(e[3]||0),c=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&s>=-180&&s<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}let kr={linearity:.3,easing:o.cm(0,0,.3,1)},Ec=o.e({deceleration:2500,maxSpeed:1400},kr),Ku=o.e({deceleration:20,maxSpeed:1400},kr),Yu=o.e({deceleration:1e3,maxSpeed:360},kr),Ju=o.e({deceleration:1e3,maxSpeed:90},kr),Qu=o.e({deceleration:1e3,maxSpeed:360},kr);class eh{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ne.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,r=ne.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let r={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:p}of this._inertiaBuffer)r.zoom+=p.zoomDelta||0,r.bearing+=p.bearingDelta||0,r.pitch+=p.pitchDelta||0,r.roll+=p.rollDelta||0,p.panDelta&&r.pan._add(p.panDelta),p.around&&(r.around=p.around),p.pinchAround&&(r.pinchAround=p.pinchAround);let s=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(r.pan.mag()){let p=ua(r.pan.mag(),s,o.e({},Ec,e||{})),y=r.pan.mult(p.amount/r.pan.mag()),w=this._map.cameraHelper.handlePanInertia(y,this._map.transform);c.center=w.easingCenter,c.offset=w.easingOffset,Hn(c,p)}if(r.zoom){let p=ua(r.zoom,s,Ku);c.zoom=this._map.transform.zoom+p.amount,Hn(c,p)}if(r.bearing){let p=ua(r.bearing,s,Yu);c.bearing=this._map.transform.bearing+o.ah(p.amount,-179,179),Hn(c,p)}if(r.pitch){let p=ua(r.pitch,s,Ju);c.pitch=this._map.transform.pitch+p.amount,Hn(c,p)}if(r.roll){let p=ua(r.roll,s,Qu);c.roll=this._map.transform.roll+o.ah(p.amount,-179,179),Hn(c,p)}if(c.zoom||c.bearing){let p=r.pinchAround===void 0?r.around:r.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),o.e(c,{noMoveStart:!0})}}function Hn(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function ua(h,e,r){let{maxSpeed:s,linearity:c,deceleration:p}=r,y=o.ah(h*c/(e/1e3),-s,s),w=Math.abs(y)/(p*c);return{easing:r.easing,duration:1e3*w,amount:y*(w/2)}}class _n extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,s,c={}){s=s instanceof MouseEvent?s:new MouseEvent(e,s);let p=q.mousePos(r.getCanvas(),s),y=r.unproject(p);super(e,o.e({point:p,lngLat:y,originalEvent:s},c)),this._defaultPrevented=!1,this.target=r}}class ha extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,s){let c=e==="touchend"?s.changedTouches:s.touches,p=q.touchPos(r.getCanvasContainer(),c),y=p.map(T=>r.unproject(T)),w=p.reduce((T,P,M,k)=>T.add(P.div(k.length)),new o.P(0,0));super(e,{points:p,point:w,lngLats:y,lngLat:r.unproject(w),originalEvent:s}),this._defaultPrevented=!1}}class Ac extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,s){super(e,{originalEvent:s}),this._defaultPrevented=!1}}class th{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ac(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new _n(e.type,this._map,e))}mouseup(e){this._map.fire(new _n(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new _n(e.type,this._map,e))}dblclick(e){return this._firePreventable(new _n(e.type,this._map,e))}mouseover(e){this._map.fire(new _n(e.type,this._map,e))}mouseout(e){this._map.fire(new _n(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ha(e.type,this._map,e))}touchmove(e){this._map.fire(new ha(e.type,this._map,e))}touchend(e){this._map.fire(new ha(e.type,this._map,e))}touchcancel(e){this._map.fire(new ha(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ih{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new _n(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _n("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new _n(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pa{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class kc{constructor(e,r){this._map=e,this._tr=new pa(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(q.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;let s=r;if(this._lastPos.equals(s)||!this._box&&s.dist(this._startPos)<this._clickTolerance)return;let c=this._startPos;this._lastPos=s,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let p=Math.min(c.x,s.x),y=Math.max(c.x,s.x),w=Math.min(c.y,s.y),T=Math.max(c.y,s.y);q.setTransform(this._box,`translate(${p}px,${w}px)`),this._box.style.width=y-p+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;let s=this._startPos,c=r;if(this.reset(),q.suppressClick(),s.x!==c.x||s.y!==c.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(s,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new o.l(e,{originalEvent:r}))}}function da(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);let r={};for(let s=0;s<h.length;s++)r[h[s].identifier]=e[s];return r}class nh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),s.length===this.numTouches&&(this.centroid=(function(c){let p=new o.P(0,0);for(let y of c)p._add(y);return p.div(c.length)})(r),this.touches=da(s,r)))}touchmove(e,r,s){if(this.aborted||!this.centroid)return;let c=da(s,r);for(let p in this.touches){let y=c[p];(!y||y.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,r,s){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),s.length===0){let c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class yn{constructor(e){this.singleTap=new nh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,s){this.singleTap.touchstart(e,r,s)}touchmove(e,r,s){this.singleTap.touchmove(e,r,s)}touchend(e,r,s){let c=this.singleTap.touchend(e,r,s);if(c){let p=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(c)<30;if(p&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class Xn{constructor(e){this._tr=new pa(e),this._zoomIn=new yn({numTouches:1,numTaps:2}),this._zoomOut=new yn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,s){this._zoomIn.touchstart(e,r,s),this._zoomOut.touchstart(e,r,s)}touchmove(e,r,s){this._zoomIn.touchmove(e,r,s),this._zoomOut.touchmove(e,r,s)}touchend(e,r,s){let c=this._zoomIn.touchend(e,r,s),p=this._zoomOut.touchend(e,r,s),y=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(c)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ma{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;let s=this._lastPoint;if(!s)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let c=Array.isArray(r)?r[0]:r;return!this._moved&&c.dist(s)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(s,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Kn=0,fa=2,Ep={[Kn]:1,[fa]:2};class ss{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let r=q.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(r,s){let c=Ep[s];return r.buttons===void 0||(r.buttons&c)!==c})(e,this._eventButton)}isValidEndEvent(e){return q.mouseButton(e)===this._eventButton}}class Ap{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class kp{constructor(e=new ss({checkCorrectEvent:()=>!0}),r=new Ap){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,s){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?s(e):void 0}startMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}let ls=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}};class cs{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,s){return this._calculateTransform(e,r,s)}touchmove(e,r,s){if(this._active){if(!this._shouldBePrevented(s.length))return e.preventDefault(),this._calculateTransform(e,r,s);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,s){this._calculateTransform(e,r,s),this._active&&this._shouldBePrevented(s.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,s){s.length>0&&(this._active=!0);let c=da(s,r),p=new o.P(0,0),y=new o.P(0,0),w=0;for(let P in c){let M=c[P],k=this._touches[P];k&&(p._add(M),y._add(M.sub(k)),w++,c[P]=M)}if(this._touches=c,this._shouldBePrevented(w)||!y.mag())return;let T=y.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,s){if(!this._firstTwoTouches)return;e.preventDefault();let[c,p]=this._firstTwoTouches,y=Ge(s,r,c),w=Ge(s,r,p);if(!y||!w)return;let T=this._aroundCenter?null:y.add(w).div(2);return this._move([y,w],T,e)}touchend(e,r,s){if(!this._firstTwoTouches)return;let[c,p]=this._firstTwoTouches,y=Ge(s,r,c),w=Ge(s,r,p);y&&w||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ge(h,e,r){for(let s=0;s<h.length;s++)if(h[s].identifier===r)return e[s]}function Lc(h,e){return Math.log(h/e)/Math.LN2}class nl extends Yn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){let s=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Lc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lc(this._distance,s),pinchAround:r}}}function Dc(h,e){return 180*h.angleWith(e)/Math.PI}class ga extends Yn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,s){let c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Dc(this._vector,c),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let r=25/(Math.PI*this._minDiameter)*360,s=Dc(e,this._startVector);return Math.abs(s)<r}}function zo(h){return Math.abs(h.y)>Math.abs(h.x)}class rl extends Yn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,s){super.touchstart(e,r,s),this._currentTouchCount=s.length}_start(e){this._lastPoints=e,zo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,s){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let c=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,s.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,s){if(this._valid!==void 0)return this._valid;let c=e.mag()>=2,p=r.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=s),s-this._firstMove<100&&void 0;let y=e.y>0==r.y>0;return zo(e)&&zo(r)&&y}}let Ct={panStep:100,bearingStep:15,pitchStep:10};class ol{constructor(e){this._tr=new pa(e);let r=Ct;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,s=0,c=0,p=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?s=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?s=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(s=0,c=0),{cameraAnimation:w=>{let T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Lp,zoom:r?Math.round(T.zoom)+r*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+s*this._bearingStep,pitch:T.pitch+c*this._pitchStep,offset:[-p*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Lp(h){return h*(2-h)}let al=4.000244140625,Dp=1/450;class rh{constructor(e,r){this._onTimeout=s=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)},this._map=e,this._tr=new pa(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Dp}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,s=ne.now(),c=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,r!==0&&r%al==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let r=q.mousePos(this._map.getCanvas(),e),s=this._tr;this._aroundPoint=this._aroundCenter?s.transform.locationToScreenPoint(o.S.convert(s.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){let w=this._type==="wheel"&&Math.abs(this._delta)>al?this._wheelZoomRate:this._defaultZoomRate,T=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&T!==0&&(T=1/T);let P=typeof this._targetZoom!="number"?e.scale:o.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),o.ak(P*T)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,s=this._startZoom,c=this._easing,p,y=!1;if(this._type==="wheel"&&s&&c){let w=ne.now()-this._lastWheelEventTime,T=Math.min((w+5)/200,1),P=c(T);p=o.C.number(s,r,P),T<1?this._frameId||(this._frameId=!0):y=!0}else p=r,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=p,{noInertia:!0,needsRenderFrame:!y,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=o.co;if(this._prevEase){let s=this._prevEase,c=(ne.now()-s.start)/s.duration,p=s.easing(c+.01)-s.easing(c),y=.27/Math.sqrt(p*p+1e-4)*.01,w=Math.sqrt(.0729-y*y);r=o.cm(y,w,.25,1)}return this._prevEase={start:ne.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zc{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rc{constructor(e){this._tr=new pa(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:s=>{s.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oh{constructor(){this._tap=new yn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,s){if(!this._swipePoint)if(this._tapTime){let c=r[0],p=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(c)<30;p&&y?s.length>0&&(this._swipePoint=c,this._swipeTouch=s[0].identifier):this.reset()}else this._tap.touchstart(e,r,s)}touchmove(e,r,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;let c=r[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,r,s)}touchend(e,r,s){if(this._tapTime)this._swipePoint&&s.length===0&&this.reset();else{let c=this._tap.touchend(e,r,s);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ah{constructor(e,r,s){this._el=e,this._mousePan=r,this._touchPan=s}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fc{constructor(e,r,s,c){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=s,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class sh{constructor(e,r,s,c){this._el=e,this._touchZoom=r,this._touchRotate=s,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class lh{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=q.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let s=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=r,this._container.appendChild(c);let p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=s,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let Jn=h=>h.zoom||h.drag||h.roll||h.pitch||h.rotate;class Qt extends o.l{}function _a(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta||h.rollDelta}class Bc{constructor(e,r){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let y=c.type==="renderFrame"?void 0:c,w={needsRenderFrame:!1},T={},P={};for(let{handlerName:A,handler:D,allowed:F}of this._handlers){if(!D.isEnabled())continue;let Z;if(this._blockedByActive(P,F,A))D.reset();else if(D[p||c.type]){if(o.cp(c,p||c.type)){let G=q.mousePos(this._map.getCanvas(),c);Z=D[p||c.type](c,G)}else if(o.cq(c,p||c.type)){let G=this._getMapTouches(c.touches),W=q.touchPos(this._map.getCanvas(),G);Z=D[p||c.type](c,W,G)}else o.cr(p||c.type)||(Z=D[p||c.type](c));this.mergeHandlerResult(w,T,Z,A,y),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()}(Z||D.isActive())&&(P[A]=D)}let M={};for(let A in this._previousActiveHandlers)P[A]||(M[A]=y);this._previousActiveHandlers=P,(Object.keys(M).length||_a(w))&&(this._changes.push([w,T,M]),this._triggerRenderFrame()),(Object.keys(P).length||_a(w))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:k}=w;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new eh(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);let s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[window,"blur",void 0]];for(let[c,p,y]of this._listeners)q.addEventListener(c,p,c===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(let[e,r,s]of this._listeners)q.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,s)}_addDefaultHandlers(e){let r=this._map,s=r.getCanvasContainer();this._add("mapEvent",new th(r,e));let c=r.boxZoom=new kc(r,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();let p=r.cooperativeGestures=new lh(r,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();let y=new Xn(r),w=new Rc(r);r.doubleClickZoom=new zc(w,y),this._add("tapZoom",y),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();let T=new oh;this._add("tapDragZoom",T);let P=r.touchPitch=new rl(r);this._add("touchPitch",P),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);let M=()=>r.project(r.getCenter()),k=(function({enable:K,clickTolerance:ie,aroundCenter:oe=!0,minPixelCenterThreshold:J=100,rotateDegreesPerPixelMoved:ue=.8},xe){let de=new ss({checkCorrectEvent:me=>q.mouseButton(me)===0&&me.ctrlKey||q.mouseButton(me)===2&&!me.ctrlKey});return new ma({clickTolerance:ie,move:(me,ye)=>{let ze=xe();if(oe&&Math.abs(ze.y-me.y)>J)return{bearingDelta:o.cn(new o.P(me.x,ye.y),ye,ze)};let Be=(ye.x-me.x)*ue;return oe&&ye.y<ze.y&&(Be=-Be),{bearingDelta:Be}},moveStateManager:de,enable:K,assignEvents:ls})})(e,M),A=(function({enable:K,clickTolerance:ie,pitchDegreesPerPixelMoved:oe=-.5}){let J=new ss({checkCorrectEvent:ue=>q.mouseButton(ue)===0&&ue.ctrlKey||q.mouseButton(ue)===2});return new ma({clickTolerance:ie,move:(ue,xe)=>({pitchDelta:(xe.y-ue.y)*oe}),moveStateManager:J,enable:K,assignEvents:ls})})(e),D=(function({enable:K,clickTolerance:ie,rollDegreesPerPixelMoved:oe=.3},J){let ue=new ss({checkCorrectEvent:xe=>q.mouseButton(xe)===2&&xe.ctrlKey});return new ma({clickTolerance:ie,move:(xe,de)=>{let me=J(),ye=(de.x-xe.x)*oe;return de.y<me.y&&(ye=-ye),{rollDelta:ye}},moveStateManager:ue,enable:K,assignEvents:ls})})(e,M);r.dragRotate=new Fc(e,k,A,D),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",A,["mouseRotate","mouseRoll"]),this._add("mouseRoll",D,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();let F=(function({enable:K,clickTolerance:ie}){let oe=new ss({checkCorrectEvent:J=>q.mouseButton(J)===0&&!J.ctrlKey});return new ma({clickTolerance:ie,move:(J,ue)=>({around:ue,panDelta:ue.sub(J)}),activateOnStart:!0,moveStateManager:oe,enable:K,assignEvents:ls})})(e),Z=new cs(e,r);r.dragPan=new ah(s,F,Z),this._add("mousePan",F),this._add("touchPan",Z,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);let G=new ga,W=new nl;r.touchZoomRotate=new sh(s,W,G,T),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);let X=r.scrollZoom=new rh(r,()=>this._triggerRenderFrame());this._add("scrollZoom",X,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);let ee=r.keyboard=new ol(r);this._add("keyboard",ee),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new ih(r))}_add(e,r,s){this._handlers.push({handlerName:e,handler:r,allowed:s}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(let{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Jn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,s){for(let c in e)if(c!==s&&(!r||r.indexOf(c)<0))return!0;return!1}_getMapTouches(e){let r=[];for(let s of e)this._el.contains(s.target)&&r.push(s);return r}mergeHandlerResult(e,r,s,c,p){if(!s)return;o.e(e,s);let y={handlerName:c,originalEvent:s.originalEvent||p};s.zoomDelta!==void 0&&(r.zoom=y),s.panDelta!==void 0&&(r.drag=y),s.rollDelta!==void 0&&(r.roll=y),s.pitchDelta!==void 0&&(r.pitch=y),s.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){let e={},r={},s={};for(let[c,p,y]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(e.rollDelta=(e.rollDelta||0)+c.rollDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),o.e(r,p),o.e(s,y);this._updateMapTransform(e,r,s),this._changes=[]}_updateMapTransform(e,r,s){let c=this._map,p=c._getTransformForUpdate(),y=c.terrain;if(!(_a(e)||y&&this._terrainMovement))return this._fireEvents(r,s,!0);c._stop(!0);let{panDelta:w,zoomDelta:T,bearingDelta:P,pitchDelta:M,rollDelta:k,around:A,pinchAround:D}=e;D!==void 0&&(A=D),A=A||c.transform.centerPoint,y&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);let F={panDelta:w,zoomDelta:T,rollDelta:k,pitchDelta:M,bearingDelta:P,around:A};this._map.cameraHelper.useGlobeControls&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);let Z=A.distSqr(p.centerPoint)<.01?p.center:p.screenPointToLocation(w?A.sub(w):A);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(F,p),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?p.setCenter(p.screenPointToLocation(p.centerPoint.sub(w))):this._map.cameraHelper.handleMapControlsPan(F,p,Z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(F,p,Z))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(F,p),this._map.cameraHelper.handleMapControlsPan(F,p,Z)),c._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,s,!0)}_fireEvents(e,r,s){let c=Jn(this._eventsInProgress),p=Jn(e),y={};for(let k in e){let{originalEvent:A}=e[k];this._eventsInProgress[k]||(y[`${k}start`]=A),this._eventsInProgress[k]=e[k]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(let k in y)this._fireEvent(k,y[k]);p&&this._fireEvent("move",p.originalEvent);for(let k in e){let{originalEvent:A}=e[k];this._fireEvent(k,A)}let w={},T;for(let k in this._eventsInProgress){let{handlerName:A,originalEvent:D}=this._eventsInProgress[k];this._handlersById[A].isActive()||(delete this._eventsInProgress[k],T=r[A]||D,w[`${k}end`]=T)}for(let k in w)this._fireEvent(k,w[k]);let P=Jn(this._eventsInProgress),M=(c||p)&&!P;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let k=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&k.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(k)}if(s&&M){this._updatingCamera=!0;let k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;!k||!k.essential&&ne.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:T})),A(this._map.getBearing())&&this._map.resetNorth()):(A(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new o.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Qt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ch extends o.E{constructor(e,r,s){super(),this._renderFrameCallback=()=>{let c=Math.min((ne.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,s){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},r),s)}panTo(e,r,s){return this.easeTo(o.e({center:e},r),s)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,s){return this.easeTo(o.e({zoom:e},r),s)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)).fire(new o.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,s){return this.easeTo(o.e({bearing:e},r),s)}resetNorth(e,r){return this.rotateTo(0,o.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=hi.convert(e).adjustAntiMeridian();let s=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),s,r)}_cameraForBoxAndBearing(e,r,s,c){let p={top:0,bottom:0,right:0,left:0};if(typeof(c=o.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){let P=c.padding;c.padding={top:P,bottom:P,right:P,left:P}}let y=o.e(p,c.padding);c.padding=y;let w=this.transform,T=new hi(e,r);return this.cameraHelper.cameraForBoxAndBearing(c,y,T,s,w)}fitBounds(e,r,s){return this._fitInternal(this.cameraForBounds(e,r),r,s)}fitScreenCoordinates(e,r,s,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(r)),s,c),c,p)}_fitInternal(e,r,s){return e?(delete(r=o.e(e,r)).padding,r.linear?this.easeTo(r,s):this.flyTo(r,s)):this}jumpTo(e,r){this.stop();let s=this._getTransformForUpdate(),c=!1,p=!1,y=!1,w=s.zoom;this.cameraHelper.handleJumpToCenterZoom(s,e);let T=s.zoom!==w;return"elevation"in e&&s.elevation!==+e.elevation&&s.setElevation(+e.elevation),"bearing"in e&&s.bearing!==+e.bearing&&(c=!0,s.setBearing(+e.bearing)),"pitch"in e&&s.pitch!==+e.pitch&&(p=!0,s.setPitch(+e.pitch)),"roll"in e&&s.roll!==+e.roll&&(y=!0,s.setRoll(+e.roll)),e.padding==null||s.isPaddingEqual(e.padding)||s.setPadding(e.padding),this._applyUpdatedTransform(s),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)),T&&this.fire(new o.l("zoomstart",r)).fire(new o.l("zoom",r)).fire(new o.l("zoomend",r)),c&&this.fire(new o.l("rotatestart",r)).fire(new o.l("rotate",r)).fire(new o.l("rotateend",r)),p&&this.fire(new o.l("pitchstart",r)).fire(new o.l("pitch",r)).fire(new o.l("pitchend",r)),y&&this.fire(new o.l("rollstart",r)).fire(new o.l("roll",r)).fire(new o.l("rollend",r)),this.fire(new o.l("moveend",r))}calculateCameraOptionsFromTo(e,r,s,c=0){let p=o.a1.fromLngLat(e,r),y=o.a1.fromLngLat(s,c),w=y.x-p.x,T=y.y-p.y,P=y.z-p.z,M=Math.hypot(w,T,P);if(M===0)throw new Error("Can't calculate camera options with same From and To");let k=Math.hypot(w,T),A=o.ak(this.transform.cameraToCenterDistance/M/this.transform.tileSize),D=180*Math.atan2(w,-T)/Math.PI,F=180*Math.acos(k/M)/Math.PI;return F=P<0?90-F:90+F,{center:y.toLngLat(),elevation:c,zoom:A,pitch:F,bearing:D}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,s,c,p){let y=this.transform.calculateCenterFromCameraLngLatAlt(e,r,s,c);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:s,pitch:c,roll:p}}easeTo(e,r){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.co},e)).animate===!1||!e.essential&&ne.prefersReducedMotion)&&(e.duration=0);let s=this._getTransformForUpdate(),c=this.getBearing(),p=s.pitch,y=s.roll,w="bearing"in e?this._normalizeBearing(e.bearing,c):c,T="pitch"in e?+e.pitch:p,P="roll"in e?this._normalizeBearing(e.roll,y):y,M="padding"in e?e.padding:s.padding,k=o.P.convert(e.offset),A,D;e.around&&(A=o.S.convert(e.around),D=s.locationToScreenPoint(A));let F={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Z=this.cameraHelper.handleEaseTo(s,{bearing:w,pitch:T,roll:P,padding:M,around:A,aroundPoint:D,offsetAsPoint:k,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||c!==w,this._pitching=this._pitching||T!==p,this._rolling=this._rolling||P!==y,this._padding=!s.isPaddingEqual(M),this._zooming=this._zooming||Z.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,F),this.terrain&&this._prepareElevation(Z.elevationCenter),this._ease(G=>{Z.easeFunc(G),this.terrain&&!e.freezeElevation&&this._updateElevation(G),this._applyUpdatedTransform(s),this._fireMoveEvents(r)},G=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,G)},e),this}_prepareEase(e,r,s={}){this._moving=!0,r||s.moving||this.fire(new o.l("movestart",e)),this._zooming&&!s.zooming&&this.fire(new o.l("zoomstart",e)),this._rotating&&!s.rotating&&this.fire(new o.l("rotatestart",e)),this._pitching&&!s.pitching&&this.fire(new o.l("pitchstart",e)),this._rolling&&!s.rolling&&this.fire(new o.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){let s=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(s-(r-(s*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let r=e.getCameraLngLat(),s=e.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(s<c){let p=this.calculateCameraOptionsFromTo(r,c,e.center,e.elevation);return{pitch:p.pitch,zoom:p.zoom}}return{}}_applyUpdatedTransform(e){let r=[];if(r.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&r.push(c=>this.transformCameraUpdate(c)),!r.length)return;let s=e.clone();for(let c of r){let p=s.clone(),{center:y,zoom:w,roll:T,pitch:P,bearing:M,elevation:k}=c(p);y&&p.setCenter(y),k!==void 0&&p.setElevation(k),w!==void 0&&p.setZoom(w),T!==void 0&&p.setRoll(T),P!==void 0&&p.setPitch(P),M!==void 0&&p.setBearing(M),s.apply(p)}this.transform.apply(s)}_fireMoveEvents(e){this.fire(new o.l("move",e)),this._zooming&&this.fire(new o.l("zoom",e)),this._rotating&&this.fire(new o.l("rotate",e)),this._pitching&&this.fire(new o.l("pitch",e)),this._rolling&&this.fire(new o.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;let s=this._zooming,c=this._rotating,p=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,s&&this.fire(new o.l("zoomend",e)),c&&this.fire(new o.l("rotateend",e)),p&&this.fire(new o.l("pitchend",e)),y&&this.fire(new o.l("rollend",e)),this.fire(new o.l("moveend",e))}flyTo(e,r){if(!e.essential&&ne.prefersReducedMotion){let ye=o.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(ye,r)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.co},e);let s=this._getTransformForUpdate(),c=s.bearing,p=s.pitch,y=s.roll,w=s.padding,T="bearing"in e?this._normalizeBearing(e.bearing,c):c,P="pitch"in e?+e.pitch:p,M="roll"in e?this._normalizeBearing(e.roll,y):y,k="padding"in e?e.padding:s.padding,A=o.P.convert(e.offset),D=s.centerPoint.add(A),F=s.screenPointToLocation(D),Z=this.cameraHelper.handleFlyTo(s,{bearing:T,pitch:P,roll:M,padding:k,locationAtOffset:F,offsetAsPoint:A,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),G=e.curve,W=Math.max(s.width,s.height),X=W/Z.scaleOfZoom,ee=Z.pixelPathLength;typeof Z.scaleOfMinZoom=="number"&&(G=Math.sqrt(W/Z.scaleOfMinZoom/ee*2));let K=G*G;function ie(ye){let ze=(X*X-W*W+(ye?-1:1)*K*K*ee*ee)/(2*(ye?X:W)*K*ee);return Math.log(Math.sqrt(ze*ze+1)-ze)}function oe(ye){return(Math.exp(ye)-Math.exp(-ye))/2}function J(ye){return(Math.exp(ye)+Math.exp(-ye))/2}let ue=ie(!1),xe=function(ye){return J(ue)/J(ue+G*ye)},de=function(ye){return W*((J(ue)*(oe(ze=ue+G*ye)/J(ze))-oe(ue))/K)/ee;var ze},me=(ie(!0)-ue)/G;if(Math.abs(ee)<2e-6||!isFinite(me)){if(Math.abs(W-X)<1e-6)return this.easeTo(e,r);let ye=X<W?-1:1;me=Math.abs(Math.log(X/W))/G,de=()=>0,xe=ze=>Math.exp(ye*G*ze)}return e.duration="duration"in e?+e.duration:1e3*me/("screenSpeed"in e?+e.screenSpeed/G:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=c!==T,this._pitching=P!==p,this._rolling=M!==y,this._padding=!s.isPaddingEqual(k),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(Z.targetCenter),this._ease(ye=>{let ze=ye*me,Be=1/xe(ze),Me=de(ze);this._rotating&&s.setBearing(o.C.number(c,T,ye)),this._pitching&&s.setPitch(o.C.number(p,P,ye)),this._rolling&&s.setRoll(o.C.number(y,M,ye)),this._padding&&(s.interpolatePadding(w,k,ye),D=s.centerPoint.add(A)),Z.easeFunc(ye,Be,Me,D),this.terrain&&!e.freezeElevation&&this._updateElevation(ye),this._applyUpdatedTransform(s),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var s;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,r)}return e||(s=this.handlers)===null||s===void 0||s.stop(!1),this}_ease(e,r,s){s.animate===!1||s.duration===0?(e(1),r()):(this._easeStart=ne.now(),this._easeOptions=s,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=o.aO(e,-180,180);let s=Math.abs(e-r);return Math.abs(e-360-r)<s&&(e-=360),Math.abs(e+360-r)<s&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(e),this.transform.tileZoom):null}}let Oc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class jc{constructor(e=Oc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){let s=this._map._getUIString(`AttributionControl.${r}`);e.title=s,e.setAttribute("aria-label",s)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}let r=this._map.style.sourceCaches;for(let c in r){let p=r[c];if(p.used||p.usedForTerrain){let y=p.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,p)=>c.length-p.length),e=e.filter((c,p)=>{for(let y=p+1;y<e.length;y++)if(e[y].indexOf(c)>=0)return!1;return!0});let s=e.join(" | ");s!==this._attribHTML&&(this._attribHTML=s,e.length?(this._innerContainer.innerHTML=q.sanitize(s),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class uh{constructor(e={}){this._updateCompact=()=>{let r=this._container.children;if(r.length){let s=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact"):s.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");let r=q.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class yr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){let r=this._currentlyRunning,s=r?this._queue.concat(r):this._queue;for(let c of s)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let r=this._currentlyRunning=this._queue;this._queue=[];for(let s of r)if(!s.cancelled&&(s.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var sl=o.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ke extends o.E{constructor(e){super(),this._lastTilesetChange=ne.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];let s={};for(let c of pe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))s[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),o.bY(c.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[c.key]=new Jo(c,this.tileSize),this._lastTilesetChange=ne.now());for(let c in this._tiles)s[c]||delete this._tiles[c]}freeRtt(e){for(let r in this._tiles){let s=this._tiles[r];(!e||s.tileID.equals(e)||s.tileID.isChildOf(e)||e.isChildOf(s.tileID))&&(s.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){let r={};for(let s of this._renderableTilesKeys){let c=this._tiles[s].tileID,p=e.clone(),y=o.ba();if(c.canonical.equals(e.canonical))o.bY(y,0,o.$,o.$,0,0,1);else if(c.canonical.isChildOf(e.canonical)){let w=c.canonical.z-e.canonical.z,T=c.canonical.x-(c.canonical.x>>w<<w),P=c.canonical.y-(c.canonical.y>>w<<w),M=o.$>>w;o.bY(y,0,M,M,0,0,1),o.M(y,y,[-T*M,-P*M,0])}else{if(!e.canonical.isChildOf(c.canonical))continue;{let w=e.canonical.z-c.canonical.z,T=e.canonical.x-(e.canonical.x>>w<<w),P=e.canonical.y-(e.canonical.y>>w<<w),M=o.$>>w;o.bY(y,0,o.$,o.$,0,0,1),o.M(y,y,[T*M,P*M,0]),o.N(y,y,[1/2**w,1/2**w,0])}}p.terrainRttPosMatrix32f=new Float32Array(y),r[s]=p}return r}_getTerrainCoordsForTileRanges(e,r){let s={};for(let c of this._renderableTilesKeys){let p=this._tiles[c].tileID;if(!this._isWithinTileRanges(p,r))continue;let y=e.clone(),w=o.ba();if(p.canonical.z===e.canonical.z){let T=e.canonical.x-p.canonical.x,P=e.canonical.y-p.canonical.y;o.bY(w,0,o.$,o.$,0,0,1),o.M(w,w,[T*o.$,P*o.$,0])}else if(p.canonical.z>e.canonical.z){let T=p.canonical.z-e.canonical.z,P=p.canonical.x-(p.canonical.x>>T<<T),M=p.canonical.y-(p.canonical.y>>T<<T),k=e.canonical.x-(p.canonical.x>>T),A=e.canonical.y-(p.canonical.y>>T),D=o.$>>T;o.bY(w,0,D,D,0,0,1),o.M(w,w,[-P*D+k*o.$,-M*D+A*o.$,0])}else{let T=e.canonical.z-p.canonical.z,P=e.canonical.x-(e.canonical.x>>T<<T),M=e.canonical.y-(e.canonical.y>>T<<T),k=(e.canonical.x>>T)-p.canonical.x,A=(e.canonical.y>>T)-p.canonical.y,D=o.$<<T;o.bY(w,0,D,D,0,0,1),o.M(w,w,[P*o.$+k*D,M*o.$+A*D,0])}y.terrainRttPosMatrix32f=new Float32Array(w),s[c]=y}return s}getSourceTile(e,r){let s=this.sourceCache._source,c=e.overscaledZ-this.deltaZoom;if(c>s.maxzoom&&(c=s.maxzoom),c<s.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&r)for(;c>=s.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(c--).key);return p}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class it{constructor(e,r,s){this._meshCache={},this.painter=e,this.sourceCache=new Ke(r),this.options=s,this.exaggeration=typeof s.exaggeration=="number"?s.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,s,c=o.$){var p;if(!(r>=0&&r<c&&s>=0&&s<c))return 0;let y=this.getTerrainData(e),w=(p=y.tile)===null||p===void 0?void 0:p.dem;if(!w)return 0;let T=o.cs([],[r/c*o.$,s/c*o.$],y.u_terrain_matrix),P=[T[0]*w.dim,T[1]*w.dim],M=Math.floor(P[0]),k=Math.floor(P[1]),A=P[0]-M,D=P[1]-k;return w.get(M,k)*(1-A)*(1-D)+w.get(M+1,k)*A*(1-D)+w.get(M,k+1)*(1-A)*D+w.get(M+1,k+1)*A*D}getElevationForLngLatZoom(e,r){if(!o.ct(r,e.wrap()))return 0;let{tileID:s,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(s,c%o.$,p%o.$,o.$)}getElevation(e,r,s,c=o.$){return this.getDEMElevation(e,r,s,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let c=this.painter.context,p=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(c,new o.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ag([])}let r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){let c=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new o.T(c,r.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),r.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}let s=r&&r+r.tileID.key+e.key;if(s&&!this._demMatrixCache[s]){let c=this.sourceCache.sourceCache._source.maxzoom,p=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?p=e.canonical.z-c:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let y=e.canonical.x-(e.canonical.x>>p<<p),w=e.canonical.y-(e.canonical.y>>p<<p),T=o.cu(new Float64Array(16),[1/(o.$<<p),1/(o.$<<p),0]);o.M(T,T,[y*o.$,w*o.$,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:s?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){let r=this.painter,s=r.width/devicePixelRatio,c=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===s&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(r.context,{width:s,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(r.context,{width:s,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(s,c,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,s,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,y=0;p<this._coordsTextureSize;p++)for(let w=0;w<this._coordsTextureSize;w++,y+=4)r[y+0]=255&w,r[y+1]=255&p,r[y+2]=w>>8<<4|p>>8,r[y+3]=0;let s=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),c=new o.T(e,s,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let r=new Uint8Array(4),s=this.painter.context,c=s.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);s.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(p,w-y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),s.bindFramebuffer.set(null);let T=r[0]+(r[2]>>4<<8),P=r[1]+((15&r[2])<<8),M=this.coordsIndex[255-r[3]],k=M&&this.sourceCache.getTileByID(M);if(!k)return null;let A=this._coordsTextureSize,D=(1<<k.tileID.canonical.z)*A;return new o.a1((k.tileID.canonical.x*A+T)/D+k.tileID.wrap,(k.tileID.canonical.y*A+P)/D,this.getElevation(k.tileID,T,P,A))}depthAtPoint(e){let r=new Uint8Array(4),s=this.painter.context,c=s.gl;return s.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),s.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;let s=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,c=s&&e.canonical.y===0,p=s&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${c?"n":""}_${p?"s":""}`;if(this._meshCache[y])return this._meshCache[y];let w=this.painter.context,T=new o.cv,P=new o.aN,M=this.meshSize,k=o.$/M,A=M*M;for(let J=0;J<=M;J++)for(let ue=0;ue<=M;ue++)T.emplaceBack(ue*k,J*k,0);for(let J=0;J<A;J+=M+1)for(let ue=0;ue<M;ue++)P.emplaceBack(ue+J,M+ue+J+1,M+ue+J+2),P.emplaceBack(ue+J,M+ue+J+2,ue+J+1);let D=T.length,F=D+(M+1),Z=(M+1)*M,G=c?o.bh:0,W=c?0:1,X=p?o.bi:o.$,ee=p?0:1;for(let J=0;J<=M;J++)T.emplaceBack(J*k,G,W);for(let J=0;J<=M;J++)T.emplaceBack(J*k,X,ee);for(let J=0;J<M;J++)P.emplaceBack(Z+J,F+J,F+J+1),P.emplaceBack(Z+J,F+J+1,Z+J+1),P.emplaceBack(0+J,D+J+1,D+J),P.emplaceBack(0+J,0+J+1,D+J+1);let K=T.length,ie=K+2*(M+1);for(let J of[0,1])for(let ue=0;ue<=M;ue++)for(let xe of[0,1])T.emplaceBack(J*o.$,ue*k,xe);for(let J=0;J<2*M;J+=2)P.emplaceBack(K+J,K+J+1,K+J+3),P.emplaceBack(K+J,K+J+3,K+J+2),P.emplaceBack(ie+J,ie+J+3,ie+J+1),P.emplaceBack(ie+J,ie+J+2,ie+J+3);let oe=new xo(w.createVertexBuffer(T,sl.members),w.createIndexBuffer(P),o.aM.simpleSegment(0,0,T.length,P.length));return this._meshCache[y]=oe,oe}getMeshFrameDelta(e){return 2*Math.PI*o.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var s;let{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(s=this.getMinMaxElevation(c).minElevation)!==null&&s!==void 0?s:0}getMinMaxElevation(e){let r=this.getTerrainData(e).tile,s={minElevation:null,maxElevation:null};return r&&r.dem&&(s.minElevation=r.dem.min*this.exaggeration,s.maxElevation=r.dem.max*this.exaggeration),s}_getOverscaledTileIDFromLngLatZoom(e,r){let s=o.a1.fromLngLat(e.wrap()),c=(1<<r)*o.$,p=s.x*c,y=s.y*c,w=Math.floor(p/o.$),T=Math.floor(y/o.$);return{tileID:new o.Z(r,0,r,w,T),mercatorX:p,mercatorY:y}}}class ll{constructor(e,r,s){this._context=e,this._size=r,this._tileSize=s,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),s=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return s.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(s.texture),{id:e,fbo:r,texture:s,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let no={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class cl{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new ll(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(s=>!e._layers[s].isHidden(r)),this._coordsAscending={};for(let s in e.sourceCaches){this._coordsAscending[s]={};let c=e.sourceCaches[s].getVisibleCoordinates(),p=e.sourceCaches[s].getSource(),y=p instanceof pr?p.terrainTileRanges:null;for(let w of c){let T=this.terrain.sourceCache.getTerrainCoords(w,y);for(let P in T)this._coordsAscending[s][P]||(this._coordsAscending[s][P]=[]),this._coordsAscending[s][P].push(T[P])}}this._coordsAscendingStr={};for(let s of e._order){let c=e._layers[s],p=c.source;if(no[c.type]&&!this._coordsAscendingStr[p]){this._coordsAscendingStr[p]={};for(let y in this._coordsAscending[p])this._coordsAscendingStr[p][y]=this._coordsAscending[p][y].map(w=>w.key).sort().join()}}for(let s of this._renderableTiles)for(let c in this._coordsAscendingStr){let p=this._coordsAscendingStr[c][s.tileID.key];p&&p!==s.rttCoords[c]&&(s.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;let s=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),c=e.type,p=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(no[c]&&(this._prevType&&no[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(no[this._prevType]||no[c]&&y){this._prevType=c;let w=this._stacks.length-1,T=this._stacks[w]||[];for(let P of this._renderableTiles){if(this.pool.isFull()&&(tl(this.painter,this.terrain,this._rttTiles,s),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[w]){let k=this.pool.getObjectForId(P.rtt[w].id);if(k.stamp===P.rtt[w].stamp){this.pool.useObject(k);continue}}let M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),P.rtt[w]={id:M.id,stamp:M.stamp},p.context.bindFramebuffer.set(M.fbo.framebuffer),p.context.clear({color:o.bf.transparent,stencil:0}),p.currentStencilSource=void 0;for(let k=0;k<T.length;k++){let A=p.style._layers[T[k]],D=A.source?this._coordsAscending[A.source][P.tileID.key]:[P.tileID];p.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),p._renderTileClippingMasks(A,D,!0),p.renderLayer(p,p.style.sourceCaches[A.source],A,D,s),A.source&&(P.rttCoords[A.source]=this._coordsAscendingStr[A.source][P.tileID.key])}}return tl(this.painter,this.terrain,this._rttTiles,s),this._rttTiles=[],this.pool.freeAllObjects(),no[c]}return!1}}let an={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},hh=C,Fn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Oc,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},zp={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class us{constructor(e,r,s=!1){this.mousedown=p=>{this.startMove(p,q.mousePos(this.element,p)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=p=>{this.move(p,q.mousePos(this.element,p))},this.mouseup=p=>{this._rotatePitchHandler.dragEnd(p),this.offTemp()},this.touchstart=p=>{p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,p.targetTouches)[0],this.startMove(p,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=p=>{p.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,p.targetTouches)[0],this.move(p,this._lastPos))},this.touchend=p=>{p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;let c=new kp;this._rotatePitchHandler=new ma({clickTolerance:3,move:(p,y)=>{let w=r.getBoundingClientRect(),T=new o.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:o.cn(new o.P(p.x,y.y),y,T),pitchDelta:s?-.5*(y.y-p.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=e,q.addEventListener(r,"mousedown",this.mousedown),q.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHandler.dragStart(e,r),q.disableDrag()}move(e,r){let s=this.map,{bearingDelta:c,pitchDelta:p}=this._rotatePitchHandler.dragMove(e,r)||{};c&&s.setBearing(s.getBearing()+c),p&&s.setPitch(s.getPitch()+p)}off(){let e=this.element;q.removeEventListener(e,"mousedown",this.mousedown),q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let Nt;function mi(h,e,r,s=!1){if(s||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return h?.wrap();let c=new o.S(h.lng,h.lat);if(h=new o.S(h.lng,h.lat),e){let p=new o.S(h.lng-360,h.lat),y=new o.S(h.lng+360,h.lat),w=r.locationToScreenPoint(h).distSqr(e);r.locationToScreenPoint(p).distSqr(e)<w?h=p:r.locationToScreenPoint(y).distSqr(e)<w&&(h=y)}for(;Math.abs(h.lng-r.center.lng)>180;){let p=r.locationToScreenPoint(h);if(p.x>=0&&p.y>=0&&p.x<=r.width&&p.y<=r.height)break;h.lng>r.center.lng?h.lng-=360:h.lng+=360}return h.lng!==c.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(h))?h:c}let ul={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ya(h,e,r){let s=h.classList;for(let c in ul)s.remove(`maplibregl-${r}-anchor-${c}`);s.add(`maplibregl-${r}-anchor-${e}`)}class va extends o.E{constructor(e){if(super(),this._onKeyPress=r=>{let s=r.code,c=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=r=>{let s=r.originalEvent.target,c=this._element;this._popup&&(s===c||c.contains(s))&&this.togglePopup()},this._update=r=>{if(!this._map)return;let s=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!s)&&this._map.once("render",this._update),this._lngLat=mi(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${ul[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`),ne.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){let s=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div");let r=q.createNS("http://www.w3.org/2000/svg","svg"),s=41,c=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${s}px`),r.setAttributeNS(null,"width",`${c}px`),r.setAttributeNS(null,"viewBox",`0 0 ${c} ${s}`);let p=q.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");let y=q.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");let w=q.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");let T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let W of T){let X=q.createNS("http://www.w3.org/2000/svg","ellipse");X.setAttributeNS(null,"opacity","0.04"),X.setAttributeNS(null,"cx","10.5"),X.setAttributeNS(null,"cy","5.80029008"),X.setAttributeNS(null,"rx",W.rx),X.setAttributeNS(null,"ry",W.ry),w.appendChild(X)}let P=q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);let M=q.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(M);let k=q.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");let A=q.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(A);let D=q.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(6.0, 7.0)"),D.setAttributeNS(null,"fill","#FFFFFF");let F=q.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(8.0, 8.0)");let Z=q.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");let G=q.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),F.appendChild(Z),F.appendChild(G),y.appendChild(w),y.appendChild(P),y.appendChild(k),y.appendChild(D),y.appendChild(F),r.appendChild(y),r.setAttributeNS(null,"height",s*this._scale+"px"),r.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(r),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),ya(this._element,this._anchor,"marker"),e&&e.className)for(let r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,s;let c=(r=this._map)===null||r===void 0?void 0:r.terrain,p=this._map.transform.isLocationOccluded(this._lngLat);if(!c||p){let D=p?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==D&&(this._element.style.opacity=D))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let y=this._map,w=y.terrain.depthAtPoint(this._pos),T=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,T)-w<.006)return void(this._element.style.opacity=this._opacity);let P=-this._offset.y/y.transform.pixelsPerMeter,M=Math.sin(y.getPitch()*Math.PI/180)*P,k=y.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),A=y.transform.lngLatToCameraDepth(this._lngLat,T+M)-k>.006;!((s=this._popup)===null||s===void 0)&&s.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}let Uc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},xa=0,Ro=!1,hs={maxWidth:100,unit:"metric"};function hl(h,e,r){let s=r&&r.maxWidth||100,c=h._container.clientHeight/2,p=h._container.clientWidth/2,y=h.unproject([p-s/2,c]),w=h.unproject([p+s/2,c]),T=Math.round(h.project(w).x-h.project(y).x),P=Math.min(s,T,h._container.clientWidth),M=y.distanceTo(w);if(r&&r.unit==="imperial"){let k=3.2808*M;k>5280?Fo(e,P,k/5280,h._getUIString("ScaleControl.Miles")):Fo(e,P,k,h._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Fo(e,P,M/1852,h._getUIString("ScaleControl.NauticalMiles")):M>=1e3?Fo(e,P,M/1e3,h._getUIString("ScaleControl.Kilometers")):Fo(e,P,M,h._getUIString("ScaleControl.Meters"))}function Fo(h,e,r,s){let c=(function(p){let y=Math.pow(10,`${Math.floor(p)}`.length-1),w=p/y;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(T){let P=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*P)/P})(w),y*w})(r);h.style.width=e*(c/r)+"px",h.innerHTML=`${c}&nbsp;${s}`}let Nc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pl(h){if(h){if(typeof h=="number"){let e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,h),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-h),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(h,0),right:new o.P(-h,0)}}if(h instanceof o.P||Array.isArray(h)){let e=o.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(h.center||[0,0]),top:o.P.convert(h.top||[0,0]),"top-left":o.P.convert(h["top-left"]||[0,0]),"top-right":o.P.convert(h["top-right"]||[0,0]),bottom:o.P.convert(h.bottom||[0,0]),"bottom-left":o.P.convert(h["bottom-left"]||[0,0]),"bottom-right":o.P.convert(h["bottom-right"]||[0,0]),left:o.P.convert(h.left||[0,0]),right:o.P.convert(h.right||[0,0])}}return pl(new o.P(0,0))}let $c=C;_.AJAXError=o.cz,_.Event=o.l,_.Evented=o.E,_.LngLat=o.S,_.MercatorCoordinate=o.a1,_.Point=o.P,_.addProtocol=o.cA,_.config=o.a,_.removeProtocol=o.cB,_.AttributionControl=jc,_.BoxZoomHandler=kc,_.CanvasSource=$r,_.CooperativeGesturesHandler=lh,_.DoubleClickZoomHandler=zc,_.DragPanHandler=ah,_.DragRotateHandler=Fc,_.EdgeInsets=wo,_.FullscreenControl=class extends o.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let h=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_.GeoJSONSource=hr,_.GeolocateControl=class extends o.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{let r=new o.S(e.coords.longitude,e.coords.latitude),s=e.coords.accuracy,c=this._map.getBearing(),p=o.e({bearing:c},this.options.fitBoundsOptions),y=hi.fromLngLat(r,s);this._map.fitBounds(y,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let r=new o.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ro)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{let r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new va({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new va({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{let s=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},Uc,h)}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,function*(e=!1){if(Nt!==void 0&&!e)return Nt;if(window.navigator.permissions===void 0)return Nt=!!window.navigator.geolocation,Nt;try{Nt=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Nt=!!window.navigator.geolocation}return Nt})})().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xa=0,Ro=!1}_isOutOfMapMaxBounds(h){let e=this._map.getMaxBounds(),r=h.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let h=this._map.getBounds(),e=h.getSouthEast(),r=h.getNorthEast(),s=e.distanceTo(r),c=Math.ceil(this._accuracy/(s/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xa--,Ro=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xa++,xa>1?(h={maximumAge:6e5,timeout:0},Ro=!0):(h=this.options.positionOptions,Ro=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_.GlobeControl=class{constructor(){this._toggleProjection=()=>{var h;let e=(h=this._map.getProjection())===null||h===void 0?void 0:h.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var h;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((h=this._map.getProjection())===null||h===void 0?void 0:h.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=q.create("button","maplibregl-ctrl-globe",this._container),q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},_.Hash=il,_.ImageSource=pr,_.KeyboardHandler=ol,_.LngLatBounds=hi,_.LogoControl=uh,_.Map=class extends ch{constructor(h){var e,r;o.cw.mark(o.cx.create);let s=Object.assign(Object.assign(Object.assign({},Fn),h),{canvasContextAttributes:Object.assign(Object.assign({},Fn.canvasContextAttributes),h.canvasContextAttributes)});if(s.minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let c=new Wt,p=new Yi;if(s.minZoom!==void 0&&c.setMinZoom(s.minZoom),s.maxZoom!==void 0&&c.setMaxZoom(s.maxZoom),s.minPitch!==void 0&&c.setMinPitch(s.minPitch),s.maxPitch!==void 0&&c.setMaxPitch(s.maxPitch),s.renderWorldCopies!==void 0&&c.setRenderWorldCopies(s.renderWorldCopies),super(c,p,{bearingSnap:s.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new yr,this._controls=[],this._mapId=o.a7(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._maxTileCacheZoomLevels=s.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},s.canvasContextAttributes),this._trackResize=s.trackResize===!0,this._bearingSnap=s.bearingSnap,this._centerClampedToGround=s.centerClampedToGround,this._refreshExpiredTiles=s.refreshExpiredTiles===!0,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions===!0,this._collectResourceTiming=s.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},an),s.locale),this._clickTolerance=s.clickTolerance,this._overridePixelRatio=s.pixelRatio,this._maxCanvasSize=s.maxCanvasSize,this.transformCameraUpdate=s.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=s.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=nt.addThrottleControl(()=>this.isMoving()),this._requestManager=new vt(s.transformRequest),typeof s.container=="string"){if(this._container=document.getElementById(s.container),!this._container)throw new Error(`Container '${s.container}' not found.`)}else{if(!(s.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1,T=Do(P=>{this._trackResize&&!this._removed&&(this.resize(P),this.redraw())},50);this._resizeObserver=new ResizeObserver(P=>{w?T(P):w=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Bc(this,s),this._hash=s.hash&&new il(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,elevation:s.elevation,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch,roll:s.roll}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,o.e({},s.fitBoundsOptions,{duration:0}))));let y=typeof s.style=="string"||((r=(e=s.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=s.localIdeographFontFamily,this._validateStyle=s.validateStyle,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new jc(typeof s.attributionControl=="boolean"?void 0:s.attributionControl)),s.maplibreLogo&&this.addControl(new uh,s.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){let w=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}}),this.on("data",w=>{this._update(w.dataType==="style"),this.fire(new o.l(`${w.dataType}data`,w))}),this.on("dataloading",w=>{this.fire(new o.l(`${w.dataType}dataloading`,w))}),this.on("dataabort",w=>{this.fire(new o.l("sourcedataabort",w))})}_getMapId(){return this._mapId}setGlobalStateProperty(h,e){return this.style.setGlobalStateProperty(h,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let r=h.onAdd(this);this._controls.push(h);let s=this._controlPositions[e];return e.indexOf("bottom")!==-1?s.insertBefore(r,s.firstChild):s.appendChild(r),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,r,s){return s==null&&this.terrain&&(s=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,r,s)}resize(h,e=!0){let[r,s]=this._containerDimensions(),c=this._getClampedPixelRatio(r,s);if(this._resizeCanvas(r,s,c),this.painter.resize(r,s,c),this.painter.overLimit()){let y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];let w=this._getClampedPixelRatio(r,s);this._resizeCanvas(r,s,w),this.painter.resize(r,s,w)}this._resizeTransform(e);let p=!this._moving;return p&&(this.stop(),this.fire(new o.l("movestart",h)).fire(new o.l("move",h))),this.fire(new o.l("resize",h)),p&&this.fire(new o.l("moveend",h)),this}_resizeTransform(h=!0){var e;let[r,s]=this._containerDimensions();this.transform.resize(r,s,h),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,s,h)}_getClampedPixelRatio(h,e){let{0:r,1:s}=this._maxCanvasSize,c=this.getPixelRatio(),p=h*c,y=e*c;return Math.min(p>r?r/p:1,y>s?s/y:1)*c}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(hi.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.setMinZoom(h),this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.setMaxZoom(h),this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.setMinPitch(h),this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(h>=this.transform.minPitch)return this.transform.setMaxPitch(h),this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.setRenderWorldCopies(h),this._update()}project(h){return this.transform.locationToScreenPoint(o.S.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.screenPointToLocation(o.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,r){if(h==="mouseenter"||h==="mouseover"){let s=!1;return{layers:e,listener:r,delegates:{mousemove:p=>{let y=e.filter(T=>this.getLayer(T)),w=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];w.length?s||(s=!0,r.call(this,new _n(h,this,p.originalEvent,{features:w}))):s=!1},mouseout:()=>{s=!1}}}}if(h==="mouseleave"||h==="mouseout"){let s=!1;return{layers:e,listener:r,delegates:{mousemove:y=>{let w=e.filter(T=>this.getLayer(T));(w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[]).length?s=!0:s&&(s=!1,r.call(this,new _n(h,this,y.originalEvent)))},mouseout:y=>{s&&(s=!1,r.call(this,new _n(h,this,y.originalEvent)))}}}}{let s=c=>{let p=e.filter(w=>this.getLayer(w)),y=p.length!==0?this.queryRenderedFeatures(c.point,{layers:p}):[];y.length&&(c.features=y,r.call(this,c),delete c.features)};return{layers:e,listener:r,delegates:{[h]:s}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,r){if(!this._delegatedListeners||!this._delegatedListeners[h])return;let s=this._delegatedListeners[h];for(let c=0;c<s.length;c++){let p=s[c];if(p.listener===r&&p.layers.length===e.length&&p.layers.every(y=>e.includes(y))){for(let y in p.delegates)this.off(y,p.delegates[y]);return void s.splice(c,1)}}}on(h,e,r){if(r===void 0)return super.on(h,e);let s=typeof e=="string"?[e]:e,c=this._createDelegatedListener(h,s,r);this._saveDelegatedListener(h,c);for(let p in c.delegates)this.on(p,c.delegates[p]);return{unsubscribe:()=>{this._removeDelegatedListener(h,s,r)}}}once(h,e,r){if(r===void 0)return super.once(h,e);let s=typeof e=="string"?[e]:e,c=this._createDelegatedListener(h,s,r);for(let p in c.delegates){let y=c.delegates[p];c.delegates[p]=(...w)=>{this._removeDelegatedListener(h,s,r),y(...w)}}this._saveDelegatedListener(h,c);for(let p in c.delegates)this.once(p,c.delegates[p]);return this}off(h,e,r){return r===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let r,s=h instanceof o.P||Array.isArray(h),c=s?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(s?{}:h)||{},c instanceof o.P||typeof c[0]=="number")r=[o.P.convert(c)];else{let p=o.P.convert(c[0]),y=o.P.convert(c[1]);r=[p,new o.P(y.x,p.y),y,new o.P(p.x,y.y),p]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){let e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){var r,s;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,e));let c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new ac(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,c):this.style.loadJSON(h,e,c),this):((s=(r=this.style)===null||r===void 0?void 0:r.projection)===null||s===void 0||s.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ac(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){let r=this._requestManager.transformRequest(h,"Style");o.j(r,new AbortController).then(s=>{this._updateDiff(s.data,e)}).catch(s=>{s&&this.fire(new o.k(s))})}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(r){o.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){let e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new o.k(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){let e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(let r in this.style._layers){let s=this.style._layers[r];s.type==="hillshade"&&s.source===h.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),s.type==="color-relief"&&s.source===h.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new it(this.painter,e,h),this.painter.renderToTexture=new cl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var s;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==h.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((s=r.source)===null||s===void 0?void 0:s.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let h=this.style&&this.style.sourceCaches;for(let e in h){let r=h[e]._tiles;for(let s in r){let c=r[s];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}setSourceTileLodParams(h,e,r){if(r){let s=this.getSource(r);if(!s)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);s.calculateTileZoom=ke(Math.max(1,h),Math.max(1,e))}else for(let s in this.style.sourceCaches)this.style.sourceCaches[s].getSource().calculateTileZoom=ke(Math.max(1,h),Math.max(1,e));return this._update(!0),this}refreshTiles(h,e){let r=this.style.sourceCaches[h];if(!r)throw new Error(`There is no source cache with ID "${h}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map(s=>new o.a4(s.z,s.x,s.y)))}addImage(h,e,r={}){let{pixelRatio:s=1,sdf:c=!1,stretchX:p,stretchY:y,content:w,textFitWidth:T,textFitHeight:P}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:M,height:k,data:A}=e,D=e;return this.style.addImage(h,{data:new o.R({width:M,height:k},new Uint8Array(A)),pixelRatio:s,stretchX:p,stretchY:y,content:w,textFitWidth:T,textFitHeight:P,sdf:c,version:0,userImage:D}),D.onAdd&&D.onAdd(this,h),this}}{let{width:M,height:k,data:A}=ne.getImageData(e);this.style.addImage(h,{data:new o.R({width:M,height:k},A),pixelRatio:s,stretchX:p,stretchY:y,content:w,textFitWidth:T,textFitHeight:P,sdf:c,version:0})}}updateImage(h,e){let r=this.style.getImage(h);if(!r)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let s=e instanceof HTMLImageElement||o.b(e)?ne.getImageData(e):e,{width:c,height:p,data:y}=s;if(c===void 0||p===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==r.data.width||p!==r.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let w=!(e instanceof HTMLImageElement||o.b(e));return r.data.replace(y,w),this.style.updateImage(h,r),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return nt.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,r){return this.style.setLayerZoomRange(h,e,r),this._update(!0)}setFilter(h,e,r={}){return this.style.setFilter(h,e,r),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,r,s={}){return this.style.setPaintProperty(h,e,r,s),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,r,s={}){return this.style.setLayoutProperty(h,e,r,s),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,r,s=>{s||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,r=>{r||this._update(!0)}),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(h,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){let h=this._container;h.classList.add("maplibregl-map");let e=this._canvasContainer=q.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let r=this._containerDimensions(),s=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],s);let c=this._controlContainer=q.create("div","maplibregl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{p[y]=q.create("div",`maplibregl-ctrl-${y} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,r){this._canvas.width=Math.floor(r*h),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let h=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",s=>{e={requestedAttributes:h},s&&(e.statusMessage=s.statusMessage,e.type=s.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,h):this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h),!r){let s="Failed to initialize WebGL";throw e?(e.message=s,new Error(JSON.stringify(e))):new Error(s)}this.painter=new Xu(r,this.transform),Ce.testSupport(r)}migrateProjection(h,e){super.migrateProjection(h,e),this.painter.transform=h,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){var e,r,s,c,p;let y=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let k=this.transform.zoom,A=ne.now();this.style.zoomHistory.update(k,A);let D=new o.F(k,{now:A,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),F=D.crossFadingFactor();F===1&&F===this._crossFadingFactor||(T=!0,this._crossFadingFactor=F),this.style.update(D)}let P=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==w;(s=this.style.projection)===null||s===void 0||s.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(p=this.style.projection)===null||p===void 0?void 0:p.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||P)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,P),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cw.mark(o.cx.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let M=this._sourcesDirty||this._styleDirty||this._placementDirty;return M||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,o.cw.mark(o.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(let r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),nt.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cw.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ne.frame(this._frameRequest,h=>{o.cw.frame(h),this._frameRequest=null;try{this._render(h)}catch(e){if(!o.cy(e)&&!(function(r){return r.message===es})(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return hh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),this.style.setProjection(h),this._update(!0)}},_.MapMouseEvent=_n,_.MapTouchEvent=ha,_.MapWheelEvent=Ac,_.Marker=va,_.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{let e=this._map.getZoom(),r=e===this._map.getMaxZoom(),s=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{let s=this._map._getUIString(`NavigationControl.${r}`);e.title=s,e.setAttribute("aria-label",s)},this.options=o.e({},zp,h),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new us(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){let r=q.create("button",h,this._container);return r.type="button",r.addEventListener("click",e),r}},_.Popup=class extends o.E{constructor(h){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=mi(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;let r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let s=this.options.anchor,c=pl(this.options.offset);if(!s){let y=this._container.offsetWidth,w=this._container.offsetHeight,T;T=r.y+c.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<y/2?T.push("left"):r.x>this._map.transform.width-y/2&&T.push("right"),s=T.length===0?"bottom":T.join("-")}let p=r.add(c[s]);this.options.subpixelPositioning||(p=p.round()),q.setTransform(this._container,`${ul[s]} translate(${p.x}px,${p.y}px)`),ya(this._container,s,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Nc),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=o.S.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){let e=document.createDocumentFragment(),r=document.createElement("body"),s;for(r.innerHTML=h;s=r.firstChild,s;)e.appendChild(s);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let h=this._container.querySelector(Vc);h&&h.focus()}},_.RasterDEMTileSource=_o,_.RasterTileSource=ur,_.ScaleControl=class{constructor(h){this._onMove=()=>{hl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,hl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},hs),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_.ScrollZoomHandler=rh,_.Style=ac,_.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_.TwoFingersTouchPitchHandler=rl,_.TwoFingersTouchRotateHandler=ga,_.TwoFingersTouchZoomHandler=nl,_.TwoFingersTouchZoomRotateHandler=sh,_.VectorTileSource=Gn,_.VideoSource=Yo,_.addSourceType=(h,e)=>o._(void 0,void 0,void 0,function*(){if(Zr(h))throw new Error(`A source type called "${h}" already exists.`);((r,s)=>{Gr[r]=s})(h,e)}),_.clearPrewarmedResources=function(){let h=cr;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Nr),cr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_.createTileMesh=rc,_.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},_.getRTLTextPluginStatus=function(){return Hr().getRTLTextPluginStatus()},_.getVersion=function(){return $c},_.getWorkerCount=function(){return Xi.workerCount},_.getWorkerUrl=function(){return o.a.WORKER_URL},_.importScriptInWorkers=function(h){return Ho().broadcast("IS",h)},_.prewarm=function(){go().acquire(Nr)},_.setMaxParallelImageRequests=function(h){o.a.MAX_PARALLEL_IMAGE_REQUESTS=h},_.setRTLTextPlugin=function(h,e){return Hr().setRTLTextPlugin(h,e)},_.setWorkerCount=function(h){Xi.workerCount=h},_.setWorkerUrl=function(h){o.a.WORKER_URL=h}});var x=g;return x})});var Zb=gv((rz,Uv)=>{"use strict";var am=typeof Reflect=="object"?Reflect:null,Rb=am&&typeof am.apply=="function"?am.apply:function(m,u,x){return Function.prototype.apply.call(m,u,x)},m_;am&&typeof am.ownKeys=="function"?m_=am.ownKeys:Object.getOwnPropertySymbols?m_=function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:m_=function(m){return Object.getOwnPropertyNames(m)};function sS(g){console&&console.warn&&console.warn(g)}var Bb=Number.isNaN||function(m){return m!==m};function Nn(){Nn.init.call(this)}Uv.exports=Nn;Uv.exports.once=hS;Nn.EventEmitter=Nn;Nn.prototype._events=void 0;Nn.prototype._eventsCount=0;Nn.prototype._maxListeners=void 0;var Fb=10;function f_(g){if(typeof g!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof g)}Object.defineProperty(Nn,"defaultMaxListeners",{enumerable:!0,get:function(){return Fb},set:function(g){if(typeof g!="number"||g<0||Bb(g))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+g+".");Fb=g}});Nn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Nn.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||Bb(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this};function Ob(g){return g._maxListeners===void 0?Nn.defaultMaxListeners:g._maxListeners}Nn.prototype.getMaxListeners=function(){return Ob(this)};Nn.prototype.emit=function(m){for(var u=[],x=1;x<arguments.length;x++)u.push(arguments[x]);var _=m==="error",o=this._events;if(o!==void 0)_=_&&o.error===void 0;else if(!_)return!1;if(_){var C;if(u.length>0&&(C=u[0]),C instanceof Error)throw C;var B=new Error("Unhandled error."+(C?" ("+C.message+")":""));throw B.context=C,B}var $=o[m];if($===void 0)return!1;if(typeof $=="function")Rb($,this,u);else for(var Y=$.length,ne=$b($,Y),x=0;x<Y;++x)Rb(ne[x],this,u);return!0};function jb(g,m,u,x){var _,o,C;if(f_(u),o=g._events,o===void 0?(o=g._events=Object.create(null),g._eventsCount=0):(o.newListener!==void 0&&(g.emit("newListener",m,u.listener?u.listener:u),o=g._events),C=o[m]),C===void 0)C=o[m]=u,++g._eventsCount;else if(typeof C=="function"?C=o[m]=x?[u,C]:[C,u]:x?C.unshift(u):C.push(u),_=Ob(g),_>0&&C.length>_&&!C.warned){C.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+C.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=g,B.type=m,B.count=C.length,sS(B)}return g}Nn.prototype.addListener=function(m,u){return jb(this,m,u,!1)};Nn.prototype.on=Nn.prototype.addListener;Nn.prototype.prependListener=function(m,u){return jb(this,m,u,!0)};function lS(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Ub(g,m,u){var x={fired:!1,wrapFn:void 0,target:g,type:m,listener:u},_=lS.bind(x);return _.listener=u,x.wrapFn=_,_}Nn.prototype.once=function(m,u){return f_(u),this.on(m,Ub(this,m,u)),this};Nn.prototype.prependOnceListener=function(m,u){return f_(u),this.prependListener(m,Ub(this,m,u)),this};Nn.prototype.removeListener=function(m,u){var x,_,o,C,B;if(f_(u),_=this._events,_===void 0)return this;if(x=_[m],x===void 0)return this;if(x===u||x.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete _[m],_.removeListener&&this.emit("removeListener",m,x.listener||u));else if(typeof x!="function"){for(o=-1,C=x.length-1;C>=0;C--)if(x[C]===u||x[C].listener===u){B=x[C].listener,o=C;break}if(o<0)return this;o===0?x.shift():cS(x,o),x.length===1&&(_[m]=x[0]),_.removeListener!==void 0&&this.emit("removeListener",m,B||u)}return this};Nn.prototype.off=Nn.prototype.removeListener;Nn.prototype.removeAllListeners=function(m){var u,x,_;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[m]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[m]),this;if(arguments.length===0){var o=Object.keys(x),C;for(_=0;_<o.length;++_)C=o[_],C!=="removeListener"&&this.removeAllListeners(C);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=x[m],typeof u=="function")this.removeListener(m,u);else if(u!==void 0)for(_=u.length-1;_>=0;_--)this.removeListener(m,u[_]);return this};function Nb(g,m,u){var x=g._events;if(x===void 0)return[];var _=x[m];return _===void 0?[]:typeof _=="function"?u?[_.listener||_]:[_]:u?uS(_):$b(_,_.length)}Nn.prototype.listeners=function(m){return Nb(this,m,!0)};Nn.prototype.rawListeners=function(m){return Nb(this,m,!1)};Nn.listenerCount=function(g,m){return typeof g.listenerCount=="function"?g.listenerCount(m):Vb.call(g,m)};Nn.prototype.listenerCount=Vb;function Vb(g){var m=this._events;if(m!==void 0){var u=m[g];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}Nn.prototype.eventNames=function(){return this._eventsCount>0?m_(this._events):[]};function $b(g,m){for(var u=new Array(m),x=0;x<m;++x)u[x]=g[x];return u}function cS(g,m){for(;m+1<g.length;m++)g[m]=g[m+1];g.pop()}function uS(g){for(var m=new Array(g.length),u=0;u<m.length;++u)m[u]=g[u].listener||g[u];return m}function hS(g,m){return new Promise(function(u,x){function _(C){g.removeListener(m,o),x(C)}function o(){typeof g.removeListener=="function"&&g.removeListener("error",_),u([].slice.call(arguments))}Gb(g,m,o,{once:!0}),m!=="error"&&pS(g,_,{once:!0})})}function pS(g,m,u){typeof g.on=="function"&&Gb(g,"error",m,u)}function Gb(g,m,u,x){if(typeof g.on=="function")x.once?g.once(m,u):g.on(m,u);else if(typeof g.addEventListener=="function")g.addEventListener(m,function _(o){x.once&&g.removeEventListener(m,_),u(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof g)}});var cT=gv((w1,T1)=>{(function(g,m){typeof w1=="object"&&typeof T1<"u"?T1.exports=m():typeof define=="function"&&define.amd?define(m):(g=typeof globalThis<"u"?globalThis:g||self,g.maplibregl=m())})(w1,function(){"use strict";var g={},m={};function u(_,o,C){if(m[_]=C,_==="index"){var B="var sharedModule = {}; ("+m.shared+")(sharedModule); ("+m.worker+")(sharedModule);",$={};return m.shared($),m.index(g,$),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([B],{type:"text/javascript"}))),g}}u("shared",["exports"],function(_){"use strict";function o(n,t,i,a){return new(i||(i=Promise))(function(l,d){function f(S){try{b(a.next(S))}catch(I){d(I)}}function v(S){try{b(a.throw(S))}catch(I){d(I)}}function b(S){var I;S.done?l(S.value):(I=S.value,I instanceof i?I:new i(function(E){E(I)})).then(f,v)}b((a=a.apply(n,t||[])).next())})}function C(n,t){this.x=n,this.y=t}function B(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $,Y;typeof SuppressedError=="function"&&SuppressedError,C.prototype={clone(){return new C(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,t){return this.clone()._rotateAround(n,t)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){let t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult(n){let t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){let n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){let t=Math.cos(n),i=Math.sin(n),a=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=a,this},_rotateAround(n,t){let i=Math.cos(n),a=Math.sin(n),l=t.y+a*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-a*(this.y-t.y),this.y=l,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(n){if(n instanceof C)return n;if(Array.isArray(n))return new C(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new C(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var ne=(function(){if(Y)return $;function n(t,i,a,l){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=a,this.p2y=l}return Y=1,$=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,l=0;l<8;l++){var d=this.sampleCurveX(a)-t;if(Math.abs(d)<i)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=d/f}var v=0,b=1;for(a=t,l=0;l<20&&(d=this.sampleCurveX(a),!(Math.abs(d-t)<i));l++)t>d?v=a:b=a,a=.5*(b-v)+v;return a},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},$})(),q=B(ne);let Ce,Ie;function Ae(){return Ce==null&&(Ce=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ce}function De(){if(Ie==null&&(Ie=!1,Ae())){let t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<25;a++){let l=4*a;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}let i=t.getImageData(0,0,5,5).data;for(let a=0;a<100;a++)if(a%4!=3&&i[a]!==a){Ie=!0;break}}}return Ie||!1}var qe=1e-6,Qe=typeof Float32Array<"u"?Float32Array:Array;function nt(){var n=new Qe(9);return Qe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function vt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function tt(){var n=new Qe(3);return Qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function At(n){var t=n[0],i=n[1],a=n[2];return Math.sqrt(t*t+i*i+a*a)}function Yt(n,t,i){var a=new Qe(3);return a[0]=n,a[1]=t,a[2]=i,a}function pn(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n[2]=t[2]+i[2],n}function Ii(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n}function On(n,t,i){var a=t[0],l=t[1],d=t[2],f=i[0],v=i[1],b=i[2];return n[0]=l*b-d*v,n[1]=d*f-a*b,n[2]=a*v-l*f,n}var wn,Vn=At;function mo(n,t,i){var a=t[0],l=t[1],d=t[2],f=t[3];return n[0]=i[0]*a+i[4]*l+i[8]*d+i[12]*f,n[1]=i[1]*a+i[5]*l+i[9]*d+i[13]*f,n[2]=i[2]*a+i[6]*l+i[10]*d+i[14]*f,n[3]=i[3]*a+i[7]*l+i[11]*d+i[15]*f,n}function Ir(){var n=new Qe(4);return Qe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Pr(n,t,i,a){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",d=Math.PI/360;t*=d,a*=d,i*=d;var f=Math.sin(t),v=Math.cos(t),b=Math.sin(i),S=Math.cos(i),I=Math.sin(a),E=Math.cos(a);switch(l){case"xyz":n[0]=f*S*E+v*b*I,n[1]=v*b*E-f*S*I,n[2]=v*S*I+f*b*E,n[3]=v*S*E-f*b*I;break;case"xzy":n[0]=f*S*E-v*b*I,n[1]=v*b*E-f*S*I,n[2]=v*S*I+f*b*E,n[3]=v*S*E+f*b*I;break;case"yxz":n[0]=f*S*E+v*b*I,n[1]=v*b*E-f*S*I,n[2]=v*S*I-f*b*E,n[3]=v*S*E+f*b*I;break;case"yzx":n[0]=f*S*E+v*b*I,n[1]=v*b*E+f*S*I,n[2]=v*S*I-f*b*E,n[3]=v*S*E-f*b*I;break;case"zxy":n[0]=f*S*E-v*b*I,n[1]=v*b*E+f*S*I,n[2]=v*S*I+f*b*E,n[3]=v*S*E-f*b*I;break;case"zyx":n[0]=f*S*E-v*b*I,n[1]=v*b*E+f*S*I,n[2]=v*S*I-f*b*E,n[3]=v*S*E+f*b*I;break;default:throw new Error("Unknown angle order "+l)}return n}function Cr(){var n=new Qe(2);return Qe!=Float32Array&&(n[0]=0,n[1]=0),n}function Oa(n,t){var i=new Qe(2);return i[0]=n,i[1]=t,i}tt(),wn=new Qe(4),Qe!=Float32Array&&(wn[0]=0,wn[1]=0,wn[2]=0,wn[3]=0),tt(),Yt(1,0,0),Yt(0,1,0),Ir(),Ir(),nt(),Cr();let Ot=8192;function Nr(n,t,i){return t*(Ot/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function Xi(n,t){return(n%t+t)%t}function fo(n,t,i){return n*(1-i)+t*i}function cr(n){if(n<=0)return 0;if(n>=1)return 1;let t=n*n,i=t*n;return 4*(n<.5?i:3*(n-t)+i-.75)}function Vr(n,t,i,a){let l=new q(n,t,i,a);return d=>l.solve(d)}let go=Vr(.25,.1,.25,1);function fn(n,t,i){return Math.min(i,Math.max(t,n))}function Ho(n,t,i){let a=i-t,l=((n-t)%a+a)%a+t;return l===t?i:l}function Dn(n,...t){for(let i of t)for(let a in i)n[a]=i[a];return n}let $n=1;function Xo(n,t,i){let a={};for(let l in n)a[l]=t.call(this,n[l],l,n);return a}function Ko(n,t,i){let a={};for(let l in n)t.call(this,n[l],l,n)&&(a[l]=n[l]);return a}function Tn(n){return Array.isArray(n)?n.map(Tn):typeof n=="object"&&n?Xo(n,Tn):n}let hi={};function fi(n){hi[n]||(typeof console<"u"&&console.warn(n),hi[n]=!0)}function Gn(n,t,i){return(i.y-n.y)*(t.x-n.x)>(t.y-n.y)*(i.x-n.x)}function ur(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let _o=null;function hr(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}let pr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Yo(n,t,i,a,l){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let d=new VideoFrame(n,{timestamp:0});try{let f=d?.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);let v=f.startsWith("BGR"),b=new Uint8ClampedArray(a*l*4);if(yield d.copyTo(b,(function(S,I,E,L,z){let R=4*Math.max(-I,0),j=(Math.max(0,E)-E)*L*4+R,V=4*L,H=Math.max(0,I),se=Math.max(0,E);return{rect:{x:H,y:se,width:Math.min(S.width,I+L)-H,height:Math.min(S.height,E+z)-se},layout:[{offset:j,stride:V}]}})(n,t,i,a,l)),v)for(let S=0;S<b.length;S+=4){let I=b[S];b[S]=b[S+2],b[S+2]=I}return b}finally{d.close()}})}let $r,Gr;function Zr(n,t,i,a){return n.addEventListener(t,i,a),{unsubscribe:()=>{n.removeEventListener(t,i,a)}}}function yo(n){return n*Math.PI/180}function qr(n){return n/Math.PI*180}let Wr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Hr={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Jo="AbortError";function le(){return new Error(Jo)}let O={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function U(n){return O.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}let N="global-dispatcher";class Q extends Error{constructor(t,i,a,l){super(`AJAXError: ${i} (${t}): ${a}`),this.status=t,this.statusText=i,this.url=a,this.body=l}}let ae=()=>ur(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ce=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){let a=U(n.url);if(a)return a(n,t);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:N},t)}if(!(/^file:/.test(i=n.url)||/^file:/.test(ae())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(a,l){return o(this,void 0,void 0,function*(){let d=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:ae(),signal:l.signal}),f,v;a.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{f=yield fetch(d)}catch(S){throw new Q(0,S.message,a.url,new Blob)}if(!f.ok){let S=yield f.blob();throw new Q(f.status,f.statusText,a.url,S)}v=a.type==="arrayBuffer"||a.type==="image"?f.arrayBuffer():a.type==="json"?f.json():f.text();let b=yield v;if(l.signal.aborted)throw le();return{data:b,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}})})(n,t);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:N},t)}var i;return(function(a,l){return new Promise((d,f)=>{var v;let b=new XMLHttpRequest;b.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(b.responseType="arraybuffer");for(let S in a.headers)b.setRequestHeader(S,a.headers[S]);a.type==="json"&&(b.responseType="text",!((v=a.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=a.credentials==="include",b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if(!l.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let S=b.response;if(a.type==="json")try{S=JSON.parse(b.response)}catch(I){return void f(I)}d({data:S,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{let S=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});f(new Q(b.status,b.statusText,a.url,S))}},l.signal.addEventListener("abort",()=>{b.abort(),f(le())}),b.send(a.body)})})(n,t)};function _e(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;let t=new URL(n),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function he(n,t,i){i[n]&&i[n].indexOf(t)!==-1||(i[n]=i[n]||[],i[n].push(t))}function Te(n,t,i){if(i&&i[n]){let a=i[n].indexOf(t);a!==-1&&i[n].splice(a,1)}}class ke{constructor(t,i={}){Dn(this,i),this.type=t}}class Pe extends ke{constructor(t,i={}){super("error",Dn({error:t},i))}}class Xe{on(t,i){return this._listeners=this._listeners||{},he(t,i,this._listeners),{unsubscribe:()=>{this.off(t,i)}}}off(t,i){return Te(t,i,this._listeners),Te(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},he(t,i,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,i){typeof t=="string"&&(t=new ke(t,i||{}));let a=t.type;if(this.listens(a)){t.target=this;let l=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let v of l)v.call(this,t);let d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let v of d)Te(a,v,this._oneTimeListeners),v.call(this,t);let f=this._eventedParent;f&&(Dn(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof Pe&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let lt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xt(n,t){let i={};for(let a in n)a!=="ref"&&(i[a]=n[a]);return lt.forEach(a=>{a in t&&(i[a]=t[a])}),i}function Je(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let i=0;i<n.length;i++)if(!Je(n[i],t[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(let i in n)if(!Je(n[i],t[i]))return!1;return!0}return n===t}function pt(n,t){n.push(t)}function Jt(n,t,i){pt(i,{command:"addSource",args:[n,t[n]]})}function Pi(n,t,i){pt(t,{command:"removeSource",args:[n]}),i[n]=!0}function Ci(n,t,i,a){Pi(n,i,a),Jt(n,t,i)}function gi(n,t,i){let a;for(a in n[i])if(Object.prototype.hasOwnProperty.call(n[i],a)&&a!=="data"&&!Je(n[i][a],t[i][a]))return!1;for(a in t[i])if(Object.prototype.hasOwnProperty.call(t[i],a)&&a!=="data"&&!Je(n[i][a],t[i][a]))return!1;return!0}function It(n,t,i,a,l,d){n=n||{},t=t||{};for(let f in n)Object.prototype.hasOwnProperty.call(n,f)&&(Je(n[f],t[f])||i.push({command:d,args:[a,f,t[f],l]}));for(let f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(n,f)&&(Je(n[f],t[f])||i.push({command:d,args:[a,f,t[f],l]}))}function kt(n){return n.id}function vi(n,t){return n[t.id]=t,n}class Re{constructor(t,i,a,l){this.message=(t?`${t}: `:"")+a,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function Ki(n,...t){for(let i of t)for(let a in i)n[a]=i[a];return n}class si extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class Xr{constructor(t,i=[]){this.parent=t,this.bindings={};for(let[a,l]of i)this.bindings[a]=l}concat(t){return new Xr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Qo={kind:"null"},$e={kind:"number"},bt={kind:"string"},_t={kind:"boolean"},Gi={kind:"color"},vo={kind:"projectionDefinition"},Kr={kind:"object"},ft={kind:"value"},Es={kind:"collator"},Yr={kind:"formatted"},As={kind:"padding"},dr={kind:"colorArray"},ea={kind:"numberArray"},pi={kind:"resolvedImage"},ks={kind:"variableAnchorOffsetCollection"};function gn(n,t){return{kind:"array",itemType:n,N:t}}function qt(n){if(n.kind==="array"){let t=qt(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}let xu=[Qo,$e,bt,_t,Gi,vo,Yr,Kr,gn(ft),As,ea,dr,pi,ks];function ja(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ja(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(let i of xu)if(!ja(i,t))return null}}return`Expected ${qt(n)} but found ${qt(t)} instead.`}function Yl(n,t){return t.some(i=>i.kind===n.kind)}function Jr(n,t){return t.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function Qr(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}let Jl=.96422,bu=.82521,wu=4/29,ta=6/29,Tu=3*ta*ta,ap=ta*ta*ta,sp=Math.PI/180,lp=180/Math.PI;function Ql(n){return(n%=360)<0&&(n+=360),n}function ia([n,t,i,a]){let l,d,f=tc((.2225045*(n=ec(n))+.7168786*(t=ec(t))+.0606169*(i=ec(i)))/1);n===t&&t===i?l=d=f:(l=tc((.4360747*n+.3850649*t+.1430804*i)/Jl),d=tc((.0139322*n+.0971045*t+.7141733*i)/bu));let v=116*f-16;return[v<0?0:v,500*(l-f),200*(f-d),a]}function ec(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function tc(n){return n>ap?Math.pow(n,1/3):n/Tu+wu}function na([n,t,i,a]){let l=(n+16)/116,d=isNaN(t)?l:l+t/500,f=isNaN(i)?l:l-i/200;return l=1*nc(l),d=Jl*nc(d),f=bu*nc(f),[ic(3.1338561*d-1.6168667*l-.4906146*f),ic(-.9787684*d+1.9161415*l+.033454*f),ic(.0719453*d-.2289914*l+1.4052427*f),a]}function ic(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function nc(n){return n>ta?n*n*n:Tu*(n-wu)}let cp=Object.hasOwn||function(n,t){return Object.prototype.hasOwnProperty.call(n,t)};function ra(n,t){return cp(n,t)?n[t]:void 0}function Ua(n){return parseInt(n.padEnd(2,n),16)/255}function Zn(n,t){return wt(t?n/100:n,0,1)}function wt(n,t,i){return Math.min(Math.max(t,n),i)}function xo(n){return!n.some(Number.isNaN)}let eo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Mr(n,t,i){return n+i*(t-n)}function bo(n,t,i){return n.map((a,l)=>Mr(a,t[l],i))}class Tt{constructor(t,i,a,l=1,d=!0){this.r=t,this.g=i,this.b=a,this.a=l,d||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,i,a,l]))}static parse(t){if(t instanceof Tt)return t;if(typeof t!="string")return;let i=(function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];let l=ra(eo,a);if(l){let[f,v,b]=l;return[f/255,v/255,b/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){let f=a.length<6?1:2,v=1;return[Ua(a.slice(v,v+=f)),Ua(a.slice(v,v+=f)),Ua(a.slice(v,v+=f)),Ua(a.slice(v,v+f)||"ff")]}if(a.startsWith("rgb")){let f=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){let[v,b,S,I,E,L,z,R,j,V,H,se]=f,te=[I||" ",z||" ",V].join("");if(te==="  "||te==="  /"||te===",,"||te===",,,"){let re=[S,L,j].join(""),fe=re==="%%%"?100:re===""?255:0;if(fe){let we=[wt(+b/fe,0,1),wt(+E/fe,0,1),wt(+R/fe,0,1),H?Zn(+H,se):1];if(xo(we))return we}}return}}let d=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){let[f,v,b,S,I,E,L,z,R]=d,j=[b||" ",I||" ",L].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){let V=[+v,wt(+S,0,100),wt(+E,0,100),z?Zn(+z,R):1];if(xo(V))return(function([H,se,te,re]){function fe(we){let Ee=(we+H/30)%12,Ne=se*Math.min(te,1-te);return te-Ne*Math.max(-1,Math.min(Ee-3,9-Ee,1))}return H=Ql(H),se/=100,te/=100,[fe(0),fe(8),fe(4),re]})(V)}}})(t);return i?new Tt(...i,!1):void 0}get rgb(){let{r:t,g:i,b:a,a:l}=this,d=l||1/0;return this.overwriteGetter("rgb",[t/d,i/d,a/d,l])}get hcl(){return this.overwriteGetter("hcl",(function(t){let[i,a,l,d]=ia(t),f=Math.sqrt(a*a+l*l);return[Math.round(1e4*f)?Ql(Math.atan2(l,a)*lp):NaN,f,i,d]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ia(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){let[t,i,a,l]=this.rgb;return`rgba(${[t,i,a].map(d=>Math.round(255*d)).join(",")},${l})`}static interpolate(t,i,a,l="rgb"){switch(l){case"rgb":{let[d,f,v,b]=bo(t.rgb,i.rgb,a);return new Tt(d,f,v,b,!1)}case"hcl":{let[d,f,v,b]=t.hcl,[S,I,E,L]=i.hcl,z,R;if(isNaN(d)||isNaN(S))isNaN(d)?isNaN(S)?z=NaN:(z=S,v!==1&&v!==0||(R=I)):(z=d,E!==1&&E!==0||(R=f));else{let te=S-d;S>d&&te>180?te-=360:S<d&&d-S>180&&(te+=360),z=d+a*te}let[j,V,H,se]=(function([te,re,fe,we]){return te=isNaN(te)?0:te*sp,na([fe,Math.cos(te)*re,Math.sin(te)*re,we])})([z,R??Mr(f,I,a),Mr(v,E,a),Mr(b,L,a)]);return new Tt(j,V,H,se,!1)}case"lab":{let[d,f,v,b]=na(bo(t.lab,i.lab,a));return new Tt(d,f,v,b,!1)}}}}Tt.black=new Tt(0,0,0,1),Tt.white=new Tt(1,1,1,1),Tt.transparent=new Tt(0,0,0,0),Tt.red=new Tt(1,0,0,1);class wo{constructor(t,i,a){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let Ls=["bottom","center","top"];class Ds{constructor(t,i,a,l,d,f){this.text=t,this.image=i,this.scale=a,this.fontStack=l,this.textColor=d,this.verticalAlign=f}}class nn{constructor(t){this.sections=t}static fromString(t){return new nn([new Ds(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof nn?t:nn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class zi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof zi)return t;if(typeof t=="number")return new zi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new zi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){return new zi(bo(t.values,i.values,a))}}class rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof rn)return t;if(typeof t=="number")return new rn([t]);if(Array.isArray(t)){for(let i of t)if(typeof i!="number")return;return new rn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){return new rn(bo(t.values,i.values,a))}}class xi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof xi)return t;if(typeof t=="string"){let a=Tt.parse(t);return a?new xi([a]):void 0}if(!Array.isArray(t))return;let i=[];for(let a of t){if(typeof a!="string")return;let l=Tt.parse(a);if(!l)return;i.push(l)}return new xi(i)}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a,l="rgb"){let d=[];if(t.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let f=0;f<t.values.length;f++)d.push(Tt.interpolate(t.values[f],i.values[f],a,l));return new xi(d)}}class Wt extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}let Su=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class on{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof on)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){let a=t[i],l=t[i+1];if(typeof a!="string"||!Su.has(a)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new on(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,a){let l=t.values,d=i.values;if(l.length!==d.length)throw new Wt(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${i.toString()}`);let f=[];for(let v=0;v<l.length;v+=2){if(l[v]!==d[v])throw new Wt(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${l[v]}, to[${v}]: ${d[v]}`);f.push(l[v]);let[b,S]=l[v+1],[I,E]=d[v+1];f.push([Mr(b,I,a),Mr(S,E,a)])}return new on(f)}}class Sn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Sn({name:t,available:!1}):null}}class Yi{constructor(t,i,a){this.from=t,this.to=i,this.transition=a}static interpolate(t,i,a){return new Yi(t,i,a)}static parse(t){return t instanceof Yi?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Yi(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Yi(t.from,t.to,t.transition):typeof t=="string"?new Yi(t,t,1):void 0}}function ei(n,t,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,i,a]:[n,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function To(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Yi||n instanceof Tt||n instanceof wo||n instanceof nn||n instanceof zi||n instanceof rn||n instanceof xi||n instanceof on||n instanceof Sn)return!0;if(Array.isArray(n)){for(let t of n)if(!To(t))return!1;return!0}if(typeof n=="object"){for(let t in n)if(!To(n[t]))return!1;return!0}return!1}function rt(n){if(n===null)return Qo;if(typeof n=="string")return bt;if(typeof n=="boolean")return _t;if(typeof n=="number")return $e;if(n instanceof Tt)return Gi;if(n instanceof Yi)return vo;if(n instanceof wo)return Es;if(n instanceof nn)return Yr;if(n instanceof zi)return As;if(n instanceof rn)return ea;if(n instanceof xi)return dr;if(n instanceof on)return ks;if(n instanceof Sn)return pi;if(Array.isArray(n)){let t=n.length,i;for(let a of n){let l=rt(a);if(i){if(i===l)continue;i=ft;break}i=l}return gn(i||ft,t)}return Kr}function ht(n){let t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Tt||n instanceof Yi||n instanceof nn||n instanceof zi||n instanceof rn||n instanceof xi||n instanceof on||n instanceof Sn?n.toString():JSON.stringify(n)}class Er{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!To(t[1]))return i.error("invalid value");let a=t[1],l=rt(a),d=i.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new Er(l,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let Lt={string:bt,number:$e,boolean:_t,object:Kr};class In{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a,l=1,d=t[0];if(d==="array"){let v,b;if(t.length>2){let S=t[1];if(typeof S!="string"||!(S in Lt)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=Lt[S],l++}else v=ft;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=t[2],l++}a=gn(v,b)}else{if(!Lt[d])throw new Error(`Types doesn't contain name = ${d}`);a=Lt[d]}let f=[];for(;l<t.length;l++){let v=i.parse(t[l],l,ft);if(!v)return null;f.push(v)}return new In(a,f)}evaluate(t){for(let i=0;i<this.args.length;i++){let a=this.args[i].evaluate(t);if(!ja(this.type,rt(a)))return a;if(i===this.args.length-1)throw new Wt(`Expected value to be of type ${qt(this.type)}, but found ${qt(rt(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let mr={"to-boolean":_t,"to-color":Gi,"to-number":$e,"to-string":bt};class fr{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a=t[0];if(!mr[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return i.error("Expected one argument.");let l=mr[a],d=[];for(let f=1;f<t.length;f++){let v=i.parse(t[f],f,ft);if(!v)return null;d.push(v)}return new fr(l,d)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,a;for(let l of this.args){if(i=l.evaluate(t),a=null,i instanceof Tt)return i;if(typeof i=="string"){let d=t.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ei(i[0],i[1],i[2],i[3]),!a))return new Tt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Wt(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(let a of this.args){i=a.evaluate(t);let l=zi.parse(i);if(l)return l}throw new Wt(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(let a of this.args){i=a.evaluate(t);let l=rn.parse(i);if(l)return l}throw new Wt(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(let a of this.args){i=a.evaluate(t);let l=xi.parse(i);if(l)return l}throw new Wt(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(let a of this.args){i=a.evaluate(t);let l=on.parse(i);if(l)return l}throw new Wt(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(let a of this.args){if(i=a.evaluate(t),i===null)return 0;let l=Number(i);if(!isNaN(l))return l}throw new Wt(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return nn.fromString(ht(this.args[0].evaluate(t)));case"resolvedImage":return Sn.fromString(ht(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ht(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let zs=["Unknown","Point","LineString","Polygon"];class rc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache.get(t);return i||(i=Tt.parse(t),this._parseColorCache.set(t,i)),i}}class oa{constructor(t,i,a=[],l,d=new Xr,f=[]){this.registry=t,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=d,this.errors=f,this.expectedType=l,this._isConstant=i}parse(t,i,a,l,d={}){return i?this.concat(i,a,l)._parse(t,d):this._parse(t,d)}_parse(t,i){function a(l,d,f){return f==="assert"?new In(d,[l]):f==="coerce"?new fr(d,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let d=this.registry[l];if(d){let f=d.parse(t,this);if(!f)return null;if(this.expectedType){let v=this.expectedType,b=f.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(b.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(b.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(b.kind)||v.kind==="colorArray"&&["value","string","array"].includes(b.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(b.kind))f=a(f,v,i.typeAnnotation||"coerce");else if(this.checkSubtype(v,b))return null}else f=a(f,v,i.typeAnnotation||"assert")}if(!(f instanceof Er)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){let v=new rc;try{f=new Er(f.type,f.evaluate(v))}catch(b){return this.error(b.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,a){let l=typeof t=="number"?this.path.concat(t):this.path,d=a?this.scope.concat(a):this.scope;return new oa(this.registry,this._isConstant,l,i||null,d,this.errors)}error(t,...i){let a=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new si(a,t))}checkSubtype(t,i){let a=ja(t,i);return a&&this.error(a),a}}class Na{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let a=[];for(let d=1;d<t.length-1;d+=2){let f=t[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);let v=i.parse(t[d+1],d+1);if(!v)return null;a.push([f,v])}let l=i.parse(t[t.length-1],t.length-1,i.expectedType,a);return l?new Na(a,l):null}outputDefined(){return this.result.outputDefined()}}class Rs{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let a=t[1];return i.scope.has(a)?new Rs(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Fs{constructor(t,i,a){this.type=t,this.index=i,this.input=a}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=i.parse(t[1],1,$e),l=i.parse(t[2],2,gn(i.expectedType||ft));return a&&l?new Fs(l.type.itemType,a,l):null}evaluate(t){let i=this.index.evaluate(t),a=this.input.evaluate(t);if(i<0)throw new Wt(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Wt(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Wt(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Bs{constructor(t,i){this.type=_t,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=i.parse(t[1],1,ft),l=i.parse(t[2],2,ft);return a&&l?Yl(a.type,[_t,bt,$e,Qo,ft])?new Bs(a,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${qt(a.type)} instead`):null}evaluate(t){let i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!Jr(i,["boolean","string","number","null"]))throw new Wt(`Expected first argument to be of type boolean, string, number or null, but found ${qt(rt(i))} instead.`);if(!Jr(a,["string","array"]))throw new Wt(`Expected second argument to be of type array or string, but found ${qt(rt(a))} instead.`);return a.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class qn{constructor(t,i,a){this.type=$e,this.needle=t,this.haystack=i,this.fromIndex=a}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=i.parse(t[1],1,ft),l=i.parse(t[2],2,ft);if(!a||!l)return null;if(!Yl(a.type,[_t,bt,$e,Qo,ft]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${qt(a.type)} instead`);if(t.length===4){let d=i.parse(t[3],3,$e);return d?new qn(a,l,d):null}return new qn(a,l)}evaluate(t){let i=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!Jr(i,["boolean","string","number","null"]))throw new Wt(`Expected first argument to be of type boolean, string, number or null, but found ${qt(rt(i))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),Jr(a,["string"])){let d=a.indexOf(i,l);return d===-1?-1:[...a.slice(0,d)].length}if(Jr(a,["array"]))return a.indexOf(i,l);throw new Wt(`Expected second argument to be of type array or string, but found ${qt(rt(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Ri{constructor(t,i,a,l,d,f){this.inputType=t,this.type=i,this.input=a,this.cases=l,this.outputs=d,this.otherwise=f}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let a,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);let d={},f=[];for(let S=2;S<t.length-1;S+=2){let I=t[S],E=t[S+1];Array.isArray(I)||(I=[I]);let L=i.concat(S);if(I.length===0)return L.error("Expected at least one branch label.");for(let R of I){if(typeof R!="number"&&typeof R!="string")return L.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return L.error("Numeric branch labels must be integer values.");if(a){if(L.checkSubtype(a,rt(R)))return null}else a=rt(R);if(d[String(R)]!==void 0)return L.error("Branch labels must be unique.");d[String(R)]=f.length}let z=i.parse(E,S,l);if(!z)return null;l=l||z.type,f.push(z)}let v=i.parse(t[1],1,ft);if(!v)return null;let b=i.parse(t[t.length-1],t.length-1,l);return b?v.type.kind!=="value"&&i.concat(1).checkSubtype(a,v.type)?null:new Ri(a,l,v,d,f,b):null}evaluate(t){let i=this.input.evaluate(t);return(rt(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class aa{constructor(t,i,a){this.type=t,this.branches=i,this.otherwise=a}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);let l=[];for(let f=1;f<t.length-1;f+=2){let v=i.parse(t[f],f,_t);if(!v)return null;let b=i.parse(t[f+1],f+1,a);if(!b)return null;l.push([v,b]),a=a||b.type}let d=i.parse(t[t.length-1],t.length-1,a);if(!d)return null;if(!a)throw new Error("Can't infer output type");return new aa(a,l,d)}evaluate(t){for(let[i,a]of this.branches)if(i.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[i,a]of this.branches)t(i),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class Va{constructor(t,i,a,l){this.type=t,this.input=i,this.beginIndex=a,this.endIndex=l}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=i.parse(t[1],1,ft),l=i.parse(t[2],2,$e);if(!a||!l)return null;if(!Yl(a.type,[gn(ft),bt,ft]))return i.error(`Expected first argument to be of type array or string, but found ${qt(a.type)} instead`);if(t.length===4){let d=i.parse(t[3],3,$e);return d?new Va(a.type,a,l,d):null}return new Va(a.type,a,l)}evaluate(t){let i=this.input.evaluate(t),a=this.beginIndex.evaluate(t),l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),Jr(i,["string"]))return[...i].slice(a,l).join("");if(Jr(i,["array"]))return i.slice(a,l);throw new Wt(`Expected first argument to be of type array or string, but found ${qt(rt(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function So(n,t){let i=n.length-1,a,l,d=0,f=i,v=0;for(;d<=f;)if(v=Math.floor((d+f)/2),a=n[v],l=n[v+1],a<=t){if(v===i||t<l)return v;d=v+1}else{if(!(a>t))throw new Wt("Input is not a number.");f=v-1}return 0}class di{constructor(t,i,a){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(let[l,d]of a)this.labels.push(l),this.outputs.push(d)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");let a=i.parse(t[1],1,$e);if(!a)return null;let l=[],d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<t.length;f+=2){let v=f===1?-1/0:t[f],b=t[f+1],S=f,I=f+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(l.length&&l[l.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);let E=i.parse(b,I,d);if(!E)return null;d=d||E.type,l.push([v,E])}return new di(d,a,l)}evaluate(t){let i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=i[0])return a[0].evaluate(t);let d=i.length;return l>=i[d-1]?a[d-1].evaluate(t):a[So(i,l)].evaluate(t)}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Iu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $a,oc,up=(function(){if(oc)return $a;function n(t,i,a,l){this.cx=3*t,this.bx=3*(a-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=a,this.p2y=l}return oc=1,$a=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var a=t,l=0;l<8;l++){var d=this.sampleCurveX(a)-t;if(Math.abs(d)<i)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=d/f}var v=0,b=1;for(a=t,l=0;l<20&&(d=this.sampleCurveX(a),!(Math.abs(d-t)<i));l++)t>d?v=a:b=a,a=.5*(b-v)+v;return a},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},$a})(),sa=Iu(up);class Zi{constructor(t,i,a,l,d){this.type=t,this.operator=i,this.interpolation=a,this.input=l,this.labels=[],this.outputs=[];for(let[f,v]of d)this.labels.push(f),this.outputs.push(v)}static interpolationFactor(t,i,a,l){let d=0;if(t.name==="exponential")d=Ga(i,t.base,a,l);else if(t.name==="linear")d=Ga(i,1,a,l);else if(t.name==="cubic-bezier"){let f=t.controlPoints;d=new sa(f[0],f[1],f[2],f[3]).solve(Ga(i,1,a,l))}return d}static parse(t,i){let[a,l,d,...f]=t;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let S=l[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:S}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let S=l.slice(1);if(S.length!==4||S.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,$e),!d)return null;let v=[],b=null;a!=="interpolate-hcl"&&a!=="interpolate-lab"||i.expectedType==dr?i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType):b=Gi;for(let S=0;S<f.length;S+=2){let I=f[S],E=f[S+1],L=S+3,z=S+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);let R=i.parse(E,z,b);if(!R)return null;b=b||R.type,v.push([I,R])}return Qr(b,$e)||Qr(b,vo)||Qr(b,Gi)||Qr(b,As)||Qr(b,ea)||Qr(b,dr)||Qr(b,ks)||Qr(b,gn($e))?new Zi(b,a,l,d,v):i.error(`Type ${qt(b)} is not interpolatable.`)}evaluate(t){let i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(t);let l=this.input.evaluate(t);if(l<=i[0])return a[0].evaluate(t);let d=i.length;if(l>=i[d-1])return a[d-1].evaluate(t);let f=So(i,l),v=Zi.interpolationFactor(this.interpolation,l,i[f],i[f+1]),b=a[f].evaluate(t),S=a[f+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Mr(b,S,v);case"color":return Tt.interpolate(b,S,v);case"padding":return zi.interpolate(b,S,v);case"colorArray":return xi.interpolate(b,S,v);case"numberArray":return rn.interpolate(b,S,v);case"variableAnchorOffsetCollection":return on.interpolate(b,S,v);case"array":return bo(b,S,v);case"projectionDefinition":return Yi.interpolate(b,S,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Tt.interpolate(b,S,v,"hcl");case"colorArray":return xi.interpolate(b,S,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Tt.interpolate(b,S,v,"lab");case"colorArray":return xi.interpolate(b,S,v,"lab")}}}eachChild(t){t(this.input);for(let i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ga(n,t,i,a){let l=a-i,d=n-i;return l===0?0:t===1?d/l:(Math.pow(t,d)-1)/(Math.pow(t,l)-1)}let gr={color:Tt.interpolate,number:Mr,padding:zi.interpolate,numberArray:rn.interpolate,colorArray:xi.interpolate,variableAnchorOffsetCollection:on.interpolate,array:bo};class Za{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a=null,l=i.expectedType;l&&l.kind!=="value"&&(a=l);let d=[];for(let v of t.slice(1)){let b=i.parse(v,1+d.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,d.push(b)}if(!a)throw new Error("No output type");let f=l&&d.some(v=>ja(l,v.type));return new Za(f?ft:a,d)}evaluate(t){let i,a=null,l=0;for(let d of this.args)if(l++,a=d.evaluate(t),a&&a instanceof Sn&&!a.available&&(i||(i=a.name),a=null,l===this.args.length&&(a=i)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function qa(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Wa(n,t,i,a){return a.compare(t,i)===0}function Ji(n,t,i){let a=n!=="=="&&n!=="!=";return class lT{constructor(d,f,v){this.type=_t,this.lhs=d,this.rhs=f,this.collator=v,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");let v=d[0],b=f.parse(d[1],1,ft);if(!b)return null;if(!qa(v,b.type))return f.concat(1).error(`"${v}" comparisons are not supported for type '${qt(b.type)}'.`);let S=f.parse(d[2],2,ft);if(!S)return null;if(!qa(v,S.type))return f.concat(2).error(`"${v}" comparisons are not supported for type '${qt(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error(`Cannot compare types '${qt(b.type)}' and '${qt(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new In(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new In(b.type,[S])));let I=null;if(d.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(I=f.parse(d[3],3,Es),!I)return null}return new lT(b,S,I)}evaluate(d){let f=this.lhs.evaluate(d),v=this.rhs.evaluate(d);if(a&&this.hasUntypedArgument){let b=rt(f),S=rt(v);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new Wt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let b=rt(f),S=rt(v);if(b.kind!=="string"||S.kind!=="string")return t(d,f,v)}return this.collator?i(d,f,v,this.collator.evaluate(d)):t(d,f,v)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}let Pu=Ji("==",function(n,t,i){return t===i},Wa),Os=Ji("!=",function(n,t,i){return t!==i},function(n,t,i,a){return!Wa(0,t,i,a)}),hp=Ji("<",function(n,t,i){return t<i},function(n,t,i,a){return a.compare(t,i)<0}),ac=Ji(">",function(n,t,i){return t>i},function(n,t,i,a){return a.compare(t,i)>0}),pp=Ji("<=",function(n,t,i){return t<=i},function(n,t,i,a){return a.compare(t,i)<=0}),dp=Ji(">=",function(n,t,i){return t>=i},function(n,t,i,a){return a.compare(t,i)>=0});class js{constructor(t,i,a){this.type=Es,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");let a=t[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");let l=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,_t);if(!l)return null;let d=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,_t);if(!d)return null;let f=null;return a.locale&&(f=i.parse(a.locale,1,bt),!f)?null:new js(l,d,f)}evaluate(t){return new wo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class sc{constructor(t,i,a,l,d){this.type=bt,this.number=t,this.locale=i,this.currency=a,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");let a=i.parse(t[1],1,$e);if(!a)return null;let l=t[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=i.parse(l.locale,1,bt),!d))return null;let f=null;if(l.currency&&(f=i.parse(l.currency,1,bt),!f))return null;let v=null;if(l["min-fraction-digits"]&&(v=i.parse(l["min-fraction-digits"],1,$e),!v))return null;let b=null;return l["max-fraction-digits"]&&(b=i.parse(l["max-fraction-digits"],1,$e),!b)?null:new sc(a,d,f,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Io{constructor(t){this.type=Yr,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let a=t[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");let l=[],d=!1;for(let f=1;f<=t.length-1;++f){let v=t[f];if(d&&typeof v=="object"&&!Array.isArray(v)){d=!1;let b=null;if(v["font-scale"]&&(b=i.parse(v["font-scale"],1,$e),!b))return null;let S=null;if(v["text-font"]&&(S=i.parse(v["text-font"],1,gn(bt)),!S))return null;let I=null;if(v["text-color"]&&(I=i.parse(v["text-color"],1,Gi),!I))return null;let E=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!Ls.includes(v["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(E=i.parse(v["vertical-align"],1,bt),!E)return null}let L=l[l.length-1];L.scale=b,L.font=S,L.textColor=I,L.verticalAlign=E}else{let b=i.parse(t[f],1,ft);if(!b)return null;let S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:b,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Io(l)}evaluate(t){return new nn(this.sections.map(i=>{let a=i.content.evaluate(t);return rt(a)===pi?new Ds("",a,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(t):null):new Ds(ht(a),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null,i.verticalAlign?i.verticalAlign.evaluate(t):null)}))}eachChild(t){for(let i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor),i.verticalAlign&&t(i.verticalAlign)}outputDefined(){return!1}}class lc{constructor(t){this.type=pi,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");let a=i.parse(t[1],1,bt);return a?new lc(a):i.error("No image name provided.")}evaluate(t){let i=this.input.evaluate(t),a=Sn.fromString(i);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(i)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class Us{constructor(t){this.type=$e,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=i.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${qt(a.type)} instead.`):new Us(a):null}evaluate(t){let i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Wt(`Expected value to be of type string or array, but found ${qt(rt(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Wn=8192;function mp(n,t){let i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(i*l*Wn),Math.round(a*l*Wn)]}function Ns(n,t){let i=Math.pow(2,t.z);return[(l=(n[0]/Wn+t.x)/i,360*l-180),(a=(n[1]/Wn+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,l}function Ha(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Xa(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function fp(n,t,i){let a=n[0]-t[0],l=n[1]-t[1],d=n[0]-i[0],f=n[1]-i[1];return a*f-d*l==0&&a*d<=0&&l*f<=0}function Vs(n,t,i,a){return(l=[a[0]-i[0],a[1]-i[1]])[0]*(d=[t[0]-n[0],t[1]-n[1]])[1]-l[1]*d[0]!=0&&!(!Mu(n,t,i,a)||!Mu(i,a,n,t));var l,d}function gp(n,t,i){for(let a of i)for(let l=0;l<a.length-1;++l)if(Vs(n,t,a[l],a[l+1]))return!0;return!1}function Po(n,t,i=!1){let a=!1;for(let v of t)for(let b=0;b<v.length-1;b++){if(fp(n,v[b],v[b+1]))return i;(d=v[b])[1]>(l=n)[1]!=(f=v[b+1])[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(a=!a)}var l,d,f;return a}function Cu(n,t){for(let i of t)if(Po(n,i))return!0;return!1}function cc(n,t){for(let i of n)if(!Po(i,t))return!1;for(let i=0;i<n.length-1;++i)if(gp(n[i],n[i+1],t))return!1;return!0}function _p(n,t){for(let i of t)if(cc(n,i))return!0;return!1}function Mu(n,t,i,a){let l=a[0]-i[0],d=a[1]-i[1],f=(n[0]-i[0])*d-l*(n[1]-i[1]),v=(t[0]-i[0])*d-l*(t[1]-i[1]);return f>0&&v<0||f<0&&v>0}function uc(n,t,i){let a=[];for(let l=0;l<n.length;l++){let d=[];for(let f=0;f<n[l].length;f++){let v=mp(n[l][f],i);Ha(t,v),d.push(v)}a.push(d)}return a}function Eu(n,t,i){let a=[];for(let l=0;l<n.length;l++){let d=uc(n[l],t,i);a.push(d)}return a}function $s(n,t,i,a){if(n[0]<i[0]||n[0]>i[2]){let l=.5*a,d=n[0]-i[0]>l?-a:i[0]-n[0]>l?a:0;d===0&&(d=n[0]-i[2]>l?-a:i[2]-n[0]>l?a:0),n[0]+=d}Ha(t,n)}function Au(n,t,i,a){let l=Math.pow(2,a.z)*Wn,d=[a.x*Wn,a.y*Wn],f=[];for(let v of n)for(let b of v){let S=[b.x+d[0],b.y+d[1]];$s(S,t,i,l),f.push(S)}return f}function ku(n,t,i,a){let l=Math.pow(2,a.z)*Wn,d=[a.x*Wn,a.y*Wn],f=[];for(let b of n){let S=[];for(let I of b){let E=[I.x+d[0],I.y+d[1]];Ha(t,E),S.push(E)}f.push(S)}if(t[2]-t[0]<=l/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let b of f)for(let S of b)$s(S,t,i,l)}var v;return f}class Co{constructor(t,i){this.type=_t,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(To(t[1])){let a=t[1];if(a.type==="FeatureCollection"){let l=[];for(let d of a.features){let{type:f,coordinates:v}=d.geometry;f==="Polygon"&&l.push(v),f==="MultiPolygon"&&l.push(...v)}if(l.length)return new Co(a,{type:"MultiPolygon",coordinates:l})}else if(a.type==="Feature"){let l=a.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Co(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Co(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,a){let l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(a.type==="Polygon"){let v=uc(a.coordinates,d,f),b=Au(i.geometry(),l,d,f);if(!Xa(l,d))return!1;for(let S of b)if(!Po(S,v))return!1}if(a.type==="MultiPolygon"){let v=Eu(a.coordinates,d,f),b=Au(i.geometry(),l,d,f);if(!Xa(l,d))return!1;for(let S of b)if(!Cu(S,v))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,a){let l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(a.type==="Polygon"){let v=uc(a.coordinates,d,f),b=ku(i.geometry(),l,d,f);if(!Xa(l,d))return!1;for(let S of b)if(!cc(S,v))return!1}if(a.type==="MultiPolygon"){let v=Eu(a.coordinates,d,f),b=ku(i.geometry(),l,d,f);if(!Xa(l,d))return!1;for(let S of b)if(!_p(S,v))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let hc=class{constructor(n=[],t=(i,a)=>i<a?-1:i>a?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;let n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){let{data:t,compare:i}=this,a=t[n];for(;n>0;){let l=n-1>>1,d=t[l];if(i(a,d)>=0)break;t[n]=d,n=l}t[n]=a}_down(n){let{data:t,compare:i}=this,a=this.length>>1,l=t[n];for(;n<a;){let d=1+(n<<1),f=d+1;if(f<this.length&&i(t[f],t[d])<0&&(d=f),i(t[d],l)>=0)break;t[n]=t[d],n=d}t[n]=l}};function pc(n,t,i=0,a=n.length-1,l=yp){for(;a>i;){if(a-i>600){let b=a-i+1,S=t-i+1,I=Math.log(b),E=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*E*(b-E)/b)*(S-b/2<0?-1:1);pc(n,t,Math.max(i,Math.floor(t-S*E/b+L)),Math.min(a,Math.floor(t+(b-S)*E/b+L)),l)}let d=n[t],f=i,v=a;for(Ka(n,i,t),l(n[a],d)>0&&Ka(n,i,a);f<v;){for(Ka(n,f,v),f++,v--;l(n[f],d)<0;)f++;for(;l(n[v],d)>0;)v--}l(n[i],d)===0?Ka(n,i,v):(v++,Ka(n,v,a)),v<=t&&(i=v+1),t<=v&&(a=v-1)}}function Ka(n,t,i){let a=n[t];n[t]=n[i],n[i]=a}function yp(n,t){return n<t?-1:n>t?1:0}function Ya(n,t){if(n.length<=1)return[n];let i=[],a,l;for(let d of n){let f=vp(d);f!==0&&(d.area=Math.abs(f),l===void 0&&(l=f<0),l===f<0?(a&&i.push(a),a=[d]):a.push(d))}if(a&&i.push(a),t>1)for(let d=0;d<i.length;d++)i[d].length<=t||(pc(i[d],t,1,i[d].length-1,Lu),i[d]=i[d].slice(0,t));return i}function Lu(n,t){return t.area-n.area}function vp(n){let t=0;for(let i,a,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],a=n[f],t+=(a.x-i.x)*(i.y+a.y);return t}let Du=1/298.257223563,zu=Du*(2-Du),dc=Math.PI/180;class mc{constructor(t){let i=6378.137*dc*1e3,a=Math.cos(t*dc),l=1/(1-zu*(1-a*a)),d=Math.sqrt(l);this.kx=i*d*a,this.ky=i*d*l*(1-zu)}distance(t,i){let a=this.wrap(t[0]-i[0])*this.kx,l=(t[1]-i[1])*this.ky;return Math.sqrt(a*a+l*l)}pointOnLine(t,i){let a,l,d,f,v=1/0;for(let b=0;b<t.length-1;b++){let S=t[b][0],I=t[b][1],E=this.wrap(t[b+1][0]-S)*this.kx,L=(t[b+1][1]-I)*this.ky,z=0;E===0&&L===0||(z=(this.wrap(i[0]-S)*this.kx*E+(i[1]-I)*this.ky*L)/(E*E+L*L),z>1?(S=t[b+1][0],I=t[b+1][1]):z>0&&(S+=E/this.kx*z,I+=L/this.ky*z)),E=this.wrap(i[0]-S)*this.kx,L=(i[1]-I)*this.ky;let R=E*E+L*L;R<v&&(v=R,a=S,l=I,d=b,f=z)}return{point:[a,l],index:d,t:Math.max(0,Math.min(1,f))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ru(n,t){return t[0]-n[0]}function Gs(n){return n[1]-n[0]+1}function Ar(n,t){return n[1]>=n[0]&&n[1]<t}function zt(n,t){if(n[0]>n[1])return[null,null];let i=Gs(n);if(t){if(i===2)return[n,null];let l=Math.floor(i/2);return[[n[0],n[0]+l],[n[0]+l,n[1]]]}if(i===1)return[n,null];let a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function fc(n,t){if(!Ar(t,n.length))return[1/0,1/0,-1/0,-1/0];let i=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)Ha(i,n[a]);return i}function gc(n){let t=[1/0,1/0,-1/0,-1/0];for(let i of n)for(let a of i)Ha(t,a);return t}function Fu(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function _c(n,t,i){if(!Fu(n)||!Fu(t))return NaN;let a=0,l=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(l=n[1]-t[3]),n[3]<t[1]&&(l=t[1]-n[3]),i.distance([0,0],[a,l])}function Mo(n,t,i){let a=i.pointOnLine(t,n);return i.distance(n,a.point)}function yc(n,t,i,a,l){let d=Math.min(Mo(n,[i,a],l),Mo(t,[i,a],l)),f=Math.min(Mo(i,[n,t],l),Mo(a,[n,t],l));return Math.min(d,f)}function xp(n,t,i,a,l){if(!Ar(t,n.length)||!Ar(a,i.length))return 1/0;let d=1/0;for(let f=t[0];f<t[1];++f){let v=n[f],b=n[f+1];for(let S=a[0];S<a[1];++S){let I=i[S],E=i[S+1];if(Vs(v,b,I,E))return 0;d=Math.min(d,yc(v,b,I,E,l))}}return d}function bp(n,t,i,a,l){if(!Ar(t,n.length)||!Ar(a,i.length))return NaN;let d=1/0;for(let f=t[0];f<=t[1];++f)for(let v=a[0];v<=a[1];++v)if(d=Math.min(d,l.distance(n[f],i[v])),d===0)return d;return d}function wp(n,t,i){if(Po(n,t,!0))return 0;let a=1/0;for(let l of t){let d=l[0],f=l[l.length-1];if(d!==f&&(a=Math.min(a,Mo(n,[f,d],i)),a===0))return a;let v=i.pointOnLine(l,n);if(a=Math.min(a,i.distance(n,v.point)),a===0)return a}return a}function Tp(n,t,i,a){if(!Ar(t,n.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Po(n[d],i,!0))return 0;let l=1/0;for(let d=t[0];d<t[1];++d){let f=n[d],v=n[d+1];for(let b of i)for(let S=0,I=b.length,E=I-1;S<I;E=S++){let L=b[E],z=b[S];if(Vs(f,v,L,z))return 0;l=Math.min(l,yc(f,v,L,z,a))}}return l}function Bu(n,t){for(let i of n)for(let a of i)if(Po(a,t,!0))return!0;return!1}function Sp(n,t,i,a=1/0){let l=gc(n),d=gc(t);if(a!==1/0&&_c(l,d,i)>=a)return a;if(Xa(l,d)){if(Bu(n,t))return 0}else if(Bu(t,n))return 0;let f=1/0;for(let v of n)for(let b=0,S=v.length,I=S-1;b<S;I=b++){let E=v[I],L=v[b];for(let z of t)for(let R=0,j=z.length,V=j-1;R<j;V=R++){let H=z[V],se=z[R];if(Vs(E,L,H,se))return 0;f=Math.min(f,yc(E,L,H,se,i))}}return f}function Ou(n,t,i,a,l,d){if(!d)return;let f=_c(fc(a,d),l,i);f<t&&n.push([f,d,[0,0]])}function Zs(n,t,i,a,l,d,f){if(!d||!f)return;let v=_c(fc(a,d),fc(l,f),i);v<t&&n.push([v,d,f])}function qs(n,t,i,a,l=1/0){let d=Math.min(a.distance(n[0],i[0][0]),l);if(d===0)return d;let f=new hc([[0,[0,n.length-1],[0,0]]],Ru),v=gc(i);for(;f.length>0;){let b=f.pop();if(b[0]>=d)continue;let S=b[1],I=t?50:100;if(Gs(S)<=I){if(!Ar(S,n.length))return NaN;if(t){let E=Tp(n,S,i,a);if(isNaN(E)||E===0)return E;d=Math.min(d,E)}else for(let E=S[0];E<=S[1];++E){let L=wp(n[E],i,a);if(d=Math.min(d,L),d===0)return 0}}else{let E=zt(S,t);Ou(f,d,a,n,v,E[0]),Ou(f,d,a,n,v,E[1])}}return d}function Ws(n,t,i,a,l,d=1/0){let f=Math.min(d,l.distance(n[0],i[0]));if(f===0)return f;let v=new hc([[0,[0,n.length-1],[0,i.length-1]]],Ru);for(;v.length>0;){let b=v.pop();if(b[0]>=f)continue;let S=b[1],I=b[2],E=t?50:100,L=a?50:100;if(Gs(S)<=E&&Gs(I)<=L){if(!Ar(S,n.length)&&Ar(I,i.length))return NaN;let z;if(t&&a)z=xp(n,S,i,I,l),f=Math.min(f,z);else if(t&&!a){let R=n.slice(S[0],S[1]+1);for(let j=I[0];j<=I[1];++j)if(z=Mo(i[j],R,l),f=Math.min(f,z),f===0)return f}else if(!t&&a){let R=i.slice(I[0],I[1]+1);for(let j=S[0];j<=S[1];++j)if(z=Mo(n[j],R,l),f=Math.min(f,z),f===0)return f}else z=bp(n,S,i,I,l),f=Math.min(f,z)}else{let z=zt(S,t),R=zt(I,a);Zs(v,f,l,n,i,z[0],R[0]),Zs(v,f,l,n,i,z[0],R[1]),Zs(v,f,l,n,i,z[1],R[0]),Zs(v,f,l,n,i,z[1],R[1])}}return f}function vc(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class Eo{constructor(t,i){this.type=$e,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(To(t[1])){let a=t[1];if(a.type==="FeatureCollection")return new Eo(a,a.features.map(l=>vc(l.geometry)).flat());if(a.type==="Feature")return new Eo(a,vc(a.geometry));if("type"in a&&"coordinates"in a)return new Eo(a,vc(a))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(i,a){let l=i.geometry(),d=l.flat().map(b=>Ns([b.x,b.y],i.canonical));if(l.length===0)return NaN;let f=new mc(d[0][1]),v=1/0;for(let b of a){switch(b.type){case"Point":v=Math.min(v,Ws(d,!1,[b.coordinates],!1,f,v));break;case"LineString":v=Math.min(v,Ws(d,!1,b.coordinates,!0,f,v));break;case"Polygon":v=Math.min(v,qs(d,!1,b.coordinates,f,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="LineString")return(function(i,a){let l=i.geometry(),d=l.flat().map(b=>Ns([b.x,b.y],i.canonical));if(l.length===0)return NaN;let f=new mc(d[0][1]),v=1/0;for(let b of a){switch(b.type){case"Point":v=Math.min(v,Ws(d,!0,[b.coordinates],!1,f,v));break;case"LineString":v=Math.min(v,Ws(d,!0,b.coordinates,!0,f,v));break;case"Polygon":v=Math.min(v,qs(d,!0,b.coordinates,f,v))}if(v===0)return v}return v})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(i,a){let l=i.geometry();if(l.length===0||l[0].length===0)return NaN;let d=Ya(l,0).map(b=>b.map(S=>S.map(I=>Ns([I.x,I.y],i.canonical)))),f=new mc(d[0][0][0][1]),v=1/0;for(let b of a)for(let S of d){switch(b.type){case"Point":v=Math.min(v,qs([b.coordinates],!1,S,f,v));break;case"LineString":v=Math.min(v,qs(b.coordinates,!0,S,f,v));break;case"Polygon":v=Math.min(v,Sp(S,b.coordinates,f,v))}if(v===0)return v}return v})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Ja{constructor(t){this.type=ft,this.key=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=t[1];return a==null?i.error("Global state property must be defined."):typeof a!="string"?i.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Ja(a)}evaluate(t){var i;let a=(i=t.globals)===null||i===void 0?void 0:i.globalState;return a&&Object.keys(a).length!==0?ra(a,this.key):null}eachChild(){}outputDefined(){return!1}}let la={"==":Pu,"!=":Os,">":ac,"<":hp,">=":dp,"<=":pp,array:In,at:Fs,boolean:In,case:aa,coalesce:Za,collator:js,format:Io,image:lc,in:Bs,"index-of":qn,interpolate:Zi,"interpolate-hcl":Zi,"interpolate-lab":Zi,length:Us,let:Na,literal:Er,match:Ri,number:In,"number-format":sc,object:In,slice:Va,step:di,string:In,"to-boolean":fr,"to-color":fr,"to-number":fr,"to-string":fr,var:Rs,within:Co,distance:Eo,"global-state":Ja};class zn{constructor(t,i,a,l){this.name=t,this.type=i,this._evaluate=a,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){let a=t[0],l=zn.definitions[a];if(!l)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,v=f.filter(([S])=>!Array.isArray(S)||S.length===t.length-1),b=null;for(let[S,I]of v){b=new oa(i.registry,Hs,i.path,null,i.scope);let E=[],L=!1;for(let z=1;z<t.length;z++){let R=t[z],j=Array.isArray(S)?S[z-1]:S.type,V=b.parse(R,1+E.length,j);if(!V){L=!0;break}E.push(V)}if(!L)if(Array.isArray(S)&&S.length!==E.length)b.error(`Expected ${S.length} arguments, but found ${E.length} instead.`);else{for(let z=0;z<E.length;z++){let R=Array.isArray(S)?S[z]:S.type,j=E[z];b.concat(z+1).checkSubtype(R,j.type)}if(b.errors.length===0)return new zn(a,d,I,E)}}if(v.length===1)i.errors.push(...b.errors);else{let S=(v.length?v:f).map(([E])=>{return L=E,Array.isArray(L)?`(${L.map(qt).join(", ")})`:`(${qt(L.type)}...)`;var L}).join(" | "),I=[];for(let E=1;E<t.length;E++){let L=i.parse(t[E],1+I.length);if(!L)return null;I.push(qt(L.type))}i.error(`Expected arguments of type ${S}, but found (${I.join(", ")}) instead.`)}return null}static register(t,i){zn.definitions=i;for(let a in i)t[a]=zn}}function ju(n,[t,i,a,l]){t=t.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);let d=l?l.evaluate(n):1,f=ei(t,i,a,d);if(f)throw new Wt(f);return new Tt(t/255,i/255,a/255,d,!1)}function Uu(n,t){return n in t}function xc(n,t){let i=t[n];return i===void 0?null:i}function Ao(n){return{type:n}}function Hs(n){if(n instanceof Rs)return Hs(n.boundExpression);if(n instanceof zn&&n.name==="error"||n instanceof js||n instanceof Co||n instanceof Eo||n instanceof Ja)return!1;let t=n instanceof fr||n instanceof In,i=!0;return n.eachChild(a=>{i=t?i&&Hs(a):i&&a instanceof Er}),!!i&&Xs(n)&&Ks(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Xs(n){if(n instanceof zn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Co||n instanceof Eo)return!1;let t=!0;return n.eachChild(i=>{t&&!Xs(i)&&(t=!1)}),t}function Qa(n){if(n instanceof zn&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(i=>{t&&!Qa(i)&&(t=!1)}),t}function Ks(n,t){if(n instanceof zn&&t.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!Ks(a,t)&&(i=!1)}),i}function Nu(n){return{result:"success",value:n}}function ca(n){return{result:"error",value:n}}function to(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Vu(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function bc(n){return!!n.expression&&n.expression.interpolated}function Pt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function es(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&rt(n)===Kr}function Ip(n){return n}function $u(n,t){let i=n.stops&&typeof n.stops[0][0]=="object",a=i||!(i||n.property!==void 0),l=n.type||(bc(t)?"exponential":"interval"),d=(function(I){switch(I.type){case"color":return Tt.parse;case"padding":return zi.parse;case"numberArray":return rn.parse;case"colorArray":return xi.parse;default:return null}})(t);if(d&&((n=Ki({},n)).stops&&(n.stops=n.stops.map(I=>[I[0],d(I[1])])),n.default=d(n.default?n.default:t.default)),n.colorSpace&&(f=n.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var f;let v=(function(I){switch(I){case"exponential":return Zu;case"interval":return Pp;case"categorical":return Gu;case"identity":return Cp;default:throw new Error(`Unknown function type "${I}"`)}})(l),b,S;if(l==="categorical"){b=Object.create(null);for(let I of n.stops)b[I[0]]=I[1];S=typeof n.stops[0][0]}if(i){let I={},E=[];for(let R=0;R<n.stops.length;R++){let j=n.stops[R],V=j[0].zoom;I[V]===void 0&&(I[V]={zoom:V,type:n.type,property:n.property,default:n.default,stops:[]},E.push(V)),I[V].stops.push([j[0].value,j[1]])}let L=[];for(let R of E)L.push([I[R].zoom,$u(I[R],t)]);let z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Zi.interpolationFactor.bind(void 0,z),zoomStops:L.map(R=>R[0]),evaluate:({zoom:R},j)=>Zu({stops:L,base:n.base},t,R).evaluate(R,j)}}if(a){let I=l==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Zi.interpolationFactor.bind(void 0,I),zoomStops:n.stops.map(E=>E[0]),evaluate:({zoom:E})=>v(n,t,E,b,S)}}return{kind:"source",evaluate(I,E){let L=E&&E.properties?E.properties[n.property]:void 0;return L===void 0?io(n.default,t.default):v(n,t,L,b,S)}}}function io(n,t,i){return n!==void 0?n:t!==void 0?t:i!==void 0?i:void 0}function Gu(n,t,i,a,l){return io(typeof i===l?a[i]:void 0,n.default,t.default)}function Pp(n,t,i){if(Pt(i)!=="number")return io(n.default,t.default);let a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];let l=So(n.stops.map(d=>d[0]),i);return n.stops[l][1]}function Zu(n,t,i){let a=n.base!==void 0?n.base:1;if(Pt(i)!=="number")return io(n.default,t.default);let l=n.stops.length;if(l===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[l-1][0])return n.stops[l-1][1];let d=So(n.stops.map(I=>I[0]),i),f=(function(I,E,L,z){let R=z-L,j=I-L;return R===0?0:E===1?j/R:(Math.pow(E,j)-1)/(Math.pow(E,R)-1)})(i,a,n.stops[d][0],n.stops[d+1][0]),v=n.stops[d][1],b=n.stops[d+1][1],S=gr[t.type]||Ip;return typeof v.evaluate=="function"?{evaluate(...I){let E=v.evaluate.apply(void 0,I),L=b.evaluate.apply(void 0,I);if(E!==void 0&&L!==void 0)return S(E,L,f,n.colorSpace)}}:S(v,b,f,n.colorSpace)}function Cp(n,t,i){switch(t.type){case"color":i=Tt.parse(i);break;case"formatted":i=nn.fromString(i.toString());break;case"resolvedImage":i=Sn.fromString(i.toString());break;case"padding":i=zi.parse(i);break;case"colorArray":i=xi.parse(i);break;case"numberArray":i=rn.parse(i);break;default:Pt(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return io(i,n.default,t.default)}zn.register(la,{error:[{kind:"error"},[bt],(n,[t])=>{throw new Wt(t.evaluate(n))}],typeof:[bt,[ft],(n,[t])=>qt(rt(t.evaluate(n)))],"to-rgba":[gn($e,4),[Gi],(n,[t])=>{let[i,a,l,d]=t.evaluate(n).rgb;return[255*i,255*a,255*l,d]}],rgb:[Gi,[$e,$e,$e],ju],rgba:[Gi,[$e,$e,$e,$e],ju],has:{type:_t,overloads:[[[bt],(n,[t])=>Uu(t.evaluate(n),n.properties())],[[bt,Kr],(n,[t,i])=>Uu(t.evaluate(n),i.evaluate(n))]]},get:{type:ft,overloads:[[[bt],(n,[t])=>xc(t.evaluate(n),n.properties())],[[bt,Kr],(n,[t,i])=>xc(t.evaluate(n),i.evaluate(n))]]},"feature-state":[ft,[bt],(n,[t])=>xc(t.evaluate(n),n.featureState||{})],properties:[Kr,[],n=>n.properties()],"geometry-type":[bt,[],n=>n.geometryType()],id:[ft,[],n=>n.id()],zoom:[$e,[],n=>n.globals.zoom],"heatmap-density":[$e,[],n=>n.globals.heatmapDensity||0],elevation:[$e,[],n=>n.globals.elevation||0],"line-progress":[$e,[],n=>n.globals.lineProgress||0],accumulated:[ft,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[$e,Ao($e),(n,t)=>{let i=0;for(let a of t)i+=a.evaluate(n);return i}],"*":[$e,Ao($e),(n,t)=>{let i=1;for(let a of t)i*=a.evaluate(n);return i}],"-":{type:$e,overloads:[[[$e,$e],(n,[t,i])=>t.evaluate(n)-i.evaluate(n)],[[$e],(n,[t])=>-t.evaluate(n)]]},"/":[$e,[$e,$e],(n,[t,i])=>t.evaluate(n)/i.evaluate(n)],"%":[$e,[$e,$e],(n,[t,i])=>t.evaluate(n)%i.evaluate(n)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(n,[t,i])=>Math.pow(t.evaluate(n),i.evaluate(n))],sqrt:[$e,[$e],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[$e,[$e],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[$e,[$e],(n,[t])=>Math.log(t.evaluate(n))],log2:[$e,[$e],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[$e,[$e],(n,[t])=>Math.sin(t.evaluate(n))],cos:[$e,[$e],(n,[t])=>Math.cos(t.evaluate(n))],tan:[$e,[$e],(n,[t])=>Math.tan(t.evaluate(n))],asin:[$e,[$e],(n,[t])=>Math.asin(t.evaluate(n))],acos:[$e,[$e],(n,[t])=>Math.acos(t.evaluate(n))],atan:[$e,[$e],(n,[t])=>Math.atan(t.evaluate(n))],min:[$e,Ao($e),(n,t)=>Math.min(...t.map(i=>i.evaluate(n)))],max:[$e,Ao($e),(n,t)=>Math.max(...t.map(i=>i.evaluate(n)))],abs:[$e,[$e],(n,[t])=>Math.abs(t.evaluate(n))],round:[$e,[$e],(n,[t])=>{let i=t.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[$e,[$e],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[$e,[$e],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[_t,[bt,ft],(n,[t,i])=>n.properties()[t.value]===i.value],"filter-id-==":[_t,[ft],(n,[t])=>n.id()===t.value],"filter-type-==":[_t,[bt],(n,[t])=>n.geometryType()===t.value],"filter-<":[_t,[bt,ft],(n,[t,i])=>{let a=n.properties()[t.value],l=i.value;return typeof a==typeof l&&a<l}],"filter-id-<":[_t,[ft],(n,[t])=>{let i=n.id(),a=t.value;return typeof i==typeof a&&i<a}],"filter->":[_t,[bt,ft],(n,[t,i])=>{let a=n.properties()[t.value],l=i.value;return typeof a==typeof l&&a>l}],"filter-id->":[_t,[ft],(n,[t])=>{let i=n.id(),a=t.value;return typeof i==typeof a&&i>a}],"filter-<=":[_t,[bt,ft],(n,[t,i])=>{let a=n.properties()[t.value],l=i.value;return typeof a==typeof l&&a<=l}],"filter-id-<=":[_t,[ft],(n,[t])=>{let i=n.id(),a=t.value;return typeof i==typeof a&&i<=a}],"filter->=":[_t,[bt,ft],(n,[t,i])=>{let a=n.properties()[t.value],l=i.value;return typeof a==typeof l&&a>=l}],"filter-id->=":[_t,[ft],(n,[t])=>{let i=n.id(),a=t.value;return typeof i==typeof a&&i>=a}],"filter-has":[_t,[ft],(n,[t])=>t.value in n.properties()],"filter-has-id":[_t,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[_t,[gn(bt)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[_t,[gn(ft)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[_t,[bt,gn(ft)],(n,[t,i])=>i.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[_t,[bt,gn(ft)],(n,[t,i])=>(function(a,l,d,f){for(;d<=f;){let v=d+f>>1;if(l[v]===a)return!0;l[v]>a?f=v-1:d=v+1}return!1})(n.properties()[t.value],i.value,0,i.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(n,[t,i])=>t.evaluate(n)&&i.evaluate(n)],[Ao(_t),(n,t)=>{for(let i of t)if(!i.evaluate(n))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(n,[t,i])=>t.evaluate(n)||i.evaluate(n)],[Ao(_t),(n,t)=>{for(let i of t)if(i.evaluate(n))return!0;return!1}]]},"!":[_t,[_t],(n,[t])=>!t.evaluate(n)],"is-supported-script":[_t,[bt],(n,[t])=>{let i=n.globals&&n.globals.isSupportedScript;return!i||i(t.evaluate(n))}],upcase:[bt,[bt],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[bt,[bt],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[bt,Ao(ft),(n,t)=>t.map(i=>ht(i.evaluate(n))).join("")],"resolved-locale":[bt,[Es],(n,[t])=>t.evaluate(n).resolvedLocale()]});class wc{constructor(t,i){this.expression=t,this._warningHistory={},this._evaluator=new rc,this._defaultValue=i?(function(a){if(a.type==="color"&&es(a.default))return new Tt(0,0,0,0);switch(a.type){case"color":return Tt.parse(a.default)||null;case"padding":return zi.parse(a.default)||null;case"numberArray":return rn.parse(a.default)||null;case"colorArray":return xi.parse(a.default)||null;case"variableAnchorOffsetCollection":return on.parse(a.default)||null;case"projectionDefinition":return Yi.parse(a.default)||null;default:return a.default===void 0?null:a.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,a,l,d,f){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,i,a,l,d,f){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=l,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{let v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Wt(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Ys(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in la}function ts(n,t){let i=new oa(la,Hs,[],t?(function(l){let d={color:Gi,string:bt,number:$e,enum:bt,boolean:_t,formatted:Yr,padding:As,numberArray:ea,colorArray:dr,projectionDefinition:vo,resolvedImage:pi,variableAnchorOffsetCollection:ks};return l.type==="array"?gn(d[l.value]||ft,l.length):d[l.type]})(t):void 0),a=i.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Nu(new wc(a,t)):ca(i.errors)}class is{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!Qa(i.expression),this.globalStateRefs=os(i.expression)}evaluateWithoutErrorHandling(t,i,a,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,l,d,f)}evaluate(t,i,a,l,d,f){return this._styleExpression.evaluate(t,i,a,l,d,f)}}class Tc{constructor(t,i,a,l){this.kind=t,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!Qa(i.expression),this.globalStateRefs=os(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,i,a,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,i,a,l,d,f)}evaluate(t,i,a,l,d,f){return this._styleExpression.evaluate(t,i,a,l,d,f)}interpolationFactor(t,i,a){return this.interpolationType?Zi.interpolationFactor(this.interpolationType,t,i,a):0}}function qu(n,t){let i=ts(n,t);if(i.result==="error")return i;let a=i.value.expression,l=Xs(a);if(!l&&!to(t))return ca([new si("","data expressions not supported")]);let d=Ks(a,["zoom"]);if(!d&&!Vu(t))return ca([new si("","zoom expressions not supported")]);let f=rs(a);return f||d?f instanceof si?ca([f]):f instanceof Zi&&!bc(t)?ca([new si("",'"interpolate" expressions cannot be used with this property')]):Nu(f?new Tc(l?"camera":"composite",i.value,f.labels,f instanceof Zi?f.interpolation:void 0):new is(l?"constant":"source",i.value)):ca([new si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ns{constructor(t,i){this._parameters=t,this._specification=i,Ki(this,$u(this._parameters,this._specification))}static deserialize(t){return new ns(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function rs(n){let t=null;if(n instanceof Na)t=rs(n.result);else if(n instanceof Za){for(let i of n.args)if(t=rs(i),t)break}else(n instanceof di||n instanceof Zi)&&n.input instanceof zn&&n.input.name==="zoom"&&(t=n);return t instanceof si||n.eachChild(i=>{let a=rs(i);a instanceof si?t=a:!t&&a?t=new si("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new si("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function os(n,t=new Set){return n instanceof Ja&&t.add(n.key),n.eachChild(i=>{os(i,t)}),t}function Js(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(let t of n.slice(1))if(!Js(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let Sc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ko(n){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Js(n)||(n=Lo(n));let t=ts(n,Sc);if(t.result==="error")throw new Error(t.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,a,l)=>t.value.evaluate(i,a,{},l),needGeometry:Qs(n),getGlobalStateRefs:()=>os(t.value.expression)}}function Ic(n,t){return n<t?-1:n>t?1:0}function Qs(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(Qs(n[t]))return!0;return!1}function Lo(n){if(!n)return!0;let t=n[0];return n.length<=1?t!=="any":t==="=="?Pc(n[1],n[2],"=="):t==="!="?el(Pc(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Pc(n[1],n[2],t):t==="any"?(i=n.slice(1),["any"].concat(i.map(Lo))):t==="all"?["all"].concat(n.slice(1).map(Lo)):t==="none"?["all"].concat(n.slice(1).map(Lo).map(el)):t==="in"?Wu(n[1],n.slice(2)):t==="!in"?el(Wu(n[1],n.slice(2))):t==="has"?Hu(n[1]):t!=="!has"||el(Hu(n[1]));var i}function Pc(n,t,i){switch(n){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,n,t]}}function Wu(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",n,["literal",t.sort(Ic)]]:["filter-in-small",n,["literal",t]]}}function Hu(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function el(n){return["!",n]}function Cc(n){let t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let l="[";for(let d of n)l+=`${Cc(d)},`;return`${l}]`}let i=Object.keys(n).sort(),a="{";for(let l=0;l<i.length;l++)a+=`${JSON.stringify(i[l])}:${Cc(n[i[l]])},`;return`${a}}`}function Mp(n){let t="";for(let i of lt)t+=`/${Cc(n[i])}`;return t}function Mc(n){let t=n.value;return t?[new Re(n.key,t,"constants have been deprecated as of v8")]:[]}function li(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function _r(n){if(Array.isArray(n))return n.map(_r);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){let t={};for(let i in n)t[i]=_r(n[i]);return t}return li(n)}function Rn(n){let t=n.key,i=n.value,a=n.valueSpec||{},l=n.objectElementValidators||{},d=n.style,f=n.styleSpec,v=n.validateSpec,b=[],S=Pt(i);if(S!=="object")return[new Re(t,i,`object expected, ${S} found`)];for(let I in i){let E=I.split(".")[0],L=ra(a,E)||a["*"],z;if(ra(l,E))z=l[E];else if(ra(a,E))z=v;else if(l["*"])z=l["*"];else{if(!a["*"]){b.push(new Re(t,i[I],`unknown property "${I}"`));continue}z=v}b=b.concat(z({key:(t&&`${t}.`)+I,value:i[I],valueSpec:L,style:d,styleSpec:f,object:i,objectKey:I,validateSpec:v},i))}for(let I in a)l[I]||a[I].required&&a[I].default===void 0&&i[I]===void 0&&b.push(new Re(t,i,`missing required property "${I}"`));return b}function tl(n){let t=n.value,i=n.valueSpec,a=n.style,l=n.styleSpec,d=n.key,f=n.arrayElementValidator||n.validateSpec;if(Pt(t)!=="array")return[new Re(d,t,`array expected, ${Pt(t)} found`)];if(i.length&&t.length!==i.length)return[new Re(d,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Re(d,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let v={type:i.value,values:i.values};l.$version<7&&(v.function=i.function),Pt(i.value)==="object"&&(v=i.value);let b=[];for(let S=0;S<t.length;S++)b=b.concat(f({array:t,arrayIndex:S,value:t[S],valueSpec:v,validateSpec:n.validateSpec,style:a,styleSpec:l,key:`${d}[${S}]`}));return b}function as(n){let t=n.key,i=n.value,a=n.valueSpec,l=Pt(i);return l==="number"&&i!=i&&(l="NaN"),l!=="number"?[new Re(t,i,`number expected, ${l} found`)]:"minimum"in a&&i<a.minimum?[new Re(t,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new Re(t,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function Xu(n){let t=n.valueSpec,i=li(n.value.type),a,l,d,f={},v=i!=="categorical"&&n.value.property===void 0,b=!v,S=Pt(n.value.stops)==="array"&&Pt(n.value.stops[0])==="array"&&Pt(n.value.stops[0][0])==="object",I=Rn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(z){if(i==="identity")return[new Re(z.key,z.value,'identity function may not have a "stops" property')];let R=[],j=z.value;return R=R.concat(tl({key:z.key,value:j,valueSpec:z.valueSpec,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:E})),Pt(j)==="array"&&j.length===0&&R.push(new Re(z.key,j,"array must have at least one stop")),R},default:function(z){return z.validateSpec({key:z.key,value:z.value,valueSpec:t,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec})}}});return i==="identity"&&v&&I.push(new Re(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||I.push(new Re(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!bc(n.valueSpec)&&I.push(new Re(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!to(n.valueSpec)?I.push(new Re(n.key,n.value,"property functions not supported")):v&&!Vu(n.valueSpec)&&I.push(new Re(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!S||n.value.property!==void 0||I.push(new Re(n.key,n.value,'"property" property is required')),I;function E(z){let R=[],j=z.value,V=z.key;if(Pt(j)!=="array")return[new Re(V,j,`array expected, ${Pt(j)} found`)];if(j.length!==2)return[new Re(V,j,`array length 2 expected, length ${j.length} found`)];if(S){if(Pt(j[0])!=="object")return[new Re(V,j,`object expected, ${Pt(j[0])} found`)];if(j[0].zoom===void 0)return[new Re(V,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new Re(V,j,"object stop key must have value")];if(d&&d>li(j[0].zoom))return[new Re(V,j[0].zoom,"stop zoom values must appear in ascending order")];li(j[0].zoom)!==d&&(d=li(j[0].zoom),l=void 0,f={}),R=R.concat(Rn({key:`${V}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:as,value:L}}))}else R=R.concat(L({key:`${V}[0]`,value:j[0],validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec},j));return Ys(_r(j[1]))?R.concat([new Re(`${V}[1]`,j[1],"expressions are not allowed in function stops.")]):R.concat(z.validateSpec({key:`${V}[1]`,value:j[1],valueSpec:t,validateSpec:z.validateSpec,style:z.style,styleSpec:z.styleSpec}))}function L(z,R){let j=Pt(z.value),V=li(z.value),H=z.value!==null?z.value:R;if(a){if(j!==a)return[new Re(z.key,H,`${j} stop domain type must match previous stop domain type ${a}`)]}else a=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new Re(z.key,H,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&i!=="categorical"){let se=`number expected, ${j} found`;return to(t)&&i===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(z.key,H,se)]}return i!=="categorical"||j!=="number"||isFinite(V)&&Math.floor(V)===V?i!=="categorical"&&j==="number"&&l!==void 0&&V<l?[new Re(z.key,H,"stop domain values must appear in ascending order")]:(l=V,i==="categorical"&&V in f?[new Re(z.key,H,"stop domain values must be unique")]:(f[V]=!0,[])):[new Re(z.key,H,`integer expected, found ${V}`)]}}function Do(n){let t=(n.expressionContext==="property"?qu:ts)(_r(n.value),n.valueSpec);if(t.result==="error")return t.value.map(a=>new Re(`${n.key}${a.key}`,n.value,a.message));let i=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new Re(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Qa(i))return[new Re(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Qa(i))return[new Re(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Ks(i,["zoom","feature-state"]))return[new Re(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Xs(i))return[new Re(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function il(n){let t=n.key,i=n.value,a=Pt(i);return a!=="string"?[new Re(t,i,`color expected, ${a} found`)]:Tt.parse(String(i))?[]:[new Re(t,i,`color expected, "${i}" found`)]}function kr(n){let t=n.key,i=n.value,a=n.valueSpec,l=[];return Array.isArray(a.values)?a.values.indexOf(li(i))===-1&&l.push(new Re(t,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(li(i))===-1&&l.push(new Re(t,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),l}function Ec(n){return Js(_r(n.value))?Do(Ki({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ku(n)}function Ku(n){let t=n.value,i=n.key;if(Pt(t)!=="array")return[new Re(i,t,`array expected, ${Pt(t)} found`)];let a=n.styleSpec,l,d=[];if(t.length<1)return[new Re(i,t,"filter array must have at least 1 element")];switch(d=d.concat(kr({key:`${i}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),li(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&li(t[1])==="$type"&&d.push(new Re(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new Re(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Pt(t[1]),l!=="string"&&d.push(new Re(`${i}[1]`,t[1],`string expected, ${l} found`)));for(let f=2;f<t.length;f++)l=Pt(t[f]),li(t[1])==="$type"?d=d.concat(kr({key:`${i}[${f}]`,value:t[f],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&d.push(new Re(`${i}[${f}]`,t[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)d=d.concat(Ku({key:`${i}[${f}]`,value:t[f],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":l=Pt(t[1]),t.length!==2?d.push(new Re(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&d.push(new Re(`${i}[1]`,t[1],`string expected, ${l} found`))}return d}function Yu(n,t){let i=n.key,a=n.validateSpec,l=n.style,d=n.styleSpec,f=n.value,v=n.objectKey,b=d[`${t}_${n.layerType}`];if(!b)return[];let S=v.match(/^(.*)-transition$/);if(t==="paint"&&S&&b[S[1]]&&b[S[1]].transition)return a({key:i,value:f,valueSpec:d.transition,style:l,styleSpec:d});let I=n.valueSpec||b[v];if(!I)return[new Re(i,f,`unknown property "${v}"`)];let E;if(Pt(f)==="string"&&to(I)&&!I.tokens&&(E=/^{([^}]+)}$/.exec(f)))return[new Re(i,f,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];let L=[];return n.layerType==="symbol"&&(v==="text-field"&&l&&!l.glyphs&&L.push(new Re(i,f,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&es(_r(f))&&li(f.type)==="identity"&&L.push(new Re(i,f,'"text-font" does not support identity functions'))),L.concat(a({key:n.key,value:f,valueSpec:I,style:l,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:v}))}function Ju(n){return Yu(n,"paint")}function Qu(n){return Yu(n,"layout")}function eh(n){let t=[],i=n.value,a=n.key,l=n.style,d=n.styleSpec;if(Pt(i)!=="object")return[new Re(a,i,`object expected, ${Pt(i)} found`)];i.type||i.ref||t.push(new Re(a,i,'either "type" or "ref" is required'));let f=li(i.type),v=li(i.ref);if(i.id){let b=li(i.id);for(let S=0;S<n.arrayIndex;S++){let I=l.layers[S];li(I.id)===b&&t.push(new Re(a,i.id,`duplicate layer id "${i.id}", previously used at line ${I.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(S=>{S in i&&t.push(new Re(a,i[S],`"${S}" is prohibited for ref layers`))}),l.layers.forEach(S=>{li(S.id)===v&&(b=S)}),b?b.ref?t.push(new Re(a,i.ref,"ref cannot reference another ref layer")):f=li(b.type):t.push(new Re(a,i.ref,`ref layer "${v}" not found`))}else if(f!=="background")if(i.source){let b=l.sources&&l.sources[i.source],S=b&&li(b.type);b?S==="vector"&&f==="raster"?t.push(new Re(a,i.source,`layer "${i.id}" requires a raster source`)):S!=="raster-dem"&&f==="hillshade"||S!=="raster-dem"&&f==="color-relief"?t.push(new Re(a,i.source,`layer "${i.id}" requires a raster-dem source`)):S==="raster"&&f!=="raster"?t.push(new Re(a,i.source,`layer "${i.id}" requires a vector source`)):S!=="vector"||i["source-layer"]?S==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?t.push(new Re(a,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f!=="line"||!i.paint||!i.paint["line-gradient"]||S==="geojson"&&b.lineMetrics||t.push(new Re(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Re(a,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Re(a,i.source,`source "${i.source}" not found`))}else t.push(new Re(a,i,'missing required property "source"'));return t=t.concat(Rn({key:a,value:i,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:i.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:Ec,layout:b=>Rn({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>Qu(Ki({layerType:f},S))}}),paint:b=>Rn({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":S=>Ju(Ki({layerType:f},S))}})}})),t}function Hn(n){let t=n.value,i=n.key,a=Pt(t);return a!=="string"?[new Re(i,t,`string expected, ${a} found`)]:[]}let ua={promoteId:function({key:n,value:t}){if(Pt(t)==="string")return Hn({key:n,value:t});{let i=[];for(let a in t)i.push(...Hn({key:`${n}.${a}`,value:t[a]}));return i}}};function _n(n){let t=n.value,i=n.key,a=n.styleSpec,l=n.style,d=n.validateSpec;if(!t.type)return[new Re(i,t,'"type" is required')];let f=li(t.type),v;switch(f){case"vector":case"raster":return v=Rn({key:i,value:t,valueSpec:a[`source_${f.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:ua,validateSpec:d}),v;case"raster-dem":return v=(function(b){var S;let I=(S=b.sourceName)!==null&&S!==void 0?S:"",E=b.value,L=b.styleSpec,z=L.source_raster_dem,R=b.style,j=[],V=Pt(E);if(E===void 0)return j;if(V!=="object")return j.push(new Re("source_raster_dem",E,`object expected, ${V} found`)),j;let H=li(E.encoding)==="custom",se=["redFactor","greenFactor","blueFactor","baseShift"],te=b.value.encoding?`"${b.value.encoding}"`:"Default";for(let re in E)!H&&se.includes(re)?j.push(new Re(re,E[re],`In "${I}": "${re}" is only valid when "encoding" is set to "custom". ${te} encoding found`)):z[re]?j=j.concat(b.validateSpec({key:re,value:E[re],valueSpec:z[re],validateSpec:b.validateSpec,style:R,styleSpec:L})):j.push(new Re(re,E[re],`unknown property "${re}"`));return j})({sourceName:i,value:t,style:n.style,styleSpec:a,validateSpec:d}),v;case"geojson":if(v=Rn({key:i,value:t,valueSpec:a.source_geojson,style:l,styleSpec:a,validateSpec:d,objectElementValidators:ua}),t.cluster)for(let b in t.clusterProperties){let[S,I]=t.clusterProperties[b],E=typeof S=="string"?[S,["accumulated"],["get",b]]:S;v.push(...Do({key:`${i}.${b}.map`,value:I,expressionContext:"cluster-map"})),v.push(...Do({key:`${i}.${b}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return v;case"video":return Rn({key:i,value:t,valueSpec:a.source_video,style:l,validateSpec:d,styleSpec:a});case"image":return Rn({key:i,value:t,valueSpec:a.source_image,style:l,validateSpec:d,styleSpec:a});case"canvas":return[new Re(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return kr({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ha(n){let t=n.value,i=n.styleSpec,a=i.light,l=n.style,d=[],f=Pt(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new Re("light",t,`object expected, ${f} found`)]),d;for(let v in t){let b=v.match(/^(.*)-transition$/);d=d.concat(b&&a[b[1]]&&a[b[1]].transition?n.validateSpec({key:v,value:t[v],valueSpec:i.transition,validateSpec:n.validateSpec,style:l,styleSpec:i}):a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:l,styleSpec:i}):[new Re(v,t[v],`unknown property "${v}"`)])}return d}function Ac(n){let t=n.value,i=n.styleSpec,a=i.sky,l=n.style,d=Pt(t);if(t===void 0)return[];if(d!=="object")return[new Re("sky",t,`object expected, ${d} found`)];let f=[];for(let v in t)f=f.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:l,styleSpec:i}):[new Re(v,t[v],`unknown property "${v}"`)]);return f}function th(n){let t=n.value,i=n.styleSpec,a=i.terrain,l=n.style,d=[],f=Pt(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new Re("terrain",t,`object expected, ${f} found`)]),d;for(let v in t)d=d.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:l,styleSpec:i}):[new Re(v,t[v],`unknown property "${v}"`)]);return d}function ih(n){let t=[],i=n.value,a=n.key;if(Array.isArray(i)){let l=[],d=[];for(let f in i)i[f].id&&l.includes(i[f].id)&&t.push(new Re(a,i,`all the sprites' ids must be unique, but ${i[f].id} is duplicated`)),l.push(i[f].id),i[f].url&&d.includes(i[f].url)&&t.push(new Re(a,i,`all the sprites' URLs must be unique, but ${i[f].url} is duplicated`)),d.push(i[f].url),t=t.concat(Rn({key:`${a}[${f}]`,value:i[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Hn({key:a,value:i})}function pa(n){return t=n.value,t&&t.constructor===Object?[]:[new Re(n.key,n.value,`object expected, ${Pt(n.value)} found`)];var t}let kc={"*":()=>[],array:tl,boolean:function(n){let t=n.value,i=n.key,a=Pt(t);return a!=="boolean"?[new Re(i,t,`boolean expected, ${a} found`)]:[]},number:as,color:il,constants:Mc,enum:kr,filter:Ec,function:Xu,layer:eh,object:Rn,source:_n,light:ha,sky:Ac,terrain:th,projection:function(n){let t=n.value,i=n.styleSpec,a=i.projection,l=n.style,d=Pt(t);if(t===void 0)return[];if(d!=="object")return[new Re("projection",t,`object expected, ${d} found`)];let f=[];for(let v in t)f=f.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:l,styleSpec:i}):[new Re(v,t[v],`unknown property "${v}"`)]);return f},projectionDefinition:function(n){let t=n.key,i=n.value;i=i instanceof String?i.valueOf():i;let a=Pt(i);return a!=="array"||(function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"})(i)||(function(l){return!!["interpolate","step","literal"].includes(l[0])})(i)?["array","string"].includes(a)?[]:[new Re(t,i,`projection expected, invalid type "${a}" found`)]:[new Re(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Hn,formatted:function(n){return Hn(n).length===0?[]:Do(n)},resolvedImage:function(n){return Hn(n).length===0?[]:Do(n)},padding:function(n){let t=n.key,i=n.value;if(Pt(i)==="array"){if(i.length<1||i.length>4)return[new Re(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];let a={type:"number"},l=[];for(let d=0;d<i.length;d++)l=l.concat(n.validateSpec({key:`${t}[${d}]`,value:i[d],validateSpec:n.validateSpec,valueSpec:a}));return l}return as({key:t,value:i,valueSpec:{}})},numberArray:function(n){let t=n.key,i=n.value;if(Pt(i)==="array"){let a={type:"number"};if(i.length<1)return[new Re(t,i,"array length at least 1 expected, length 0 found")];let l=[];for(let d=0;d<i.length;d++)l=l.concat(n.validateSpec({key:`${t}[${d}]`,value:i[d],validateSpec:n.validateSpec,valueSpec:a}));return l}return as({key:t,value:i,valueSpec:{}})},colorArray:function(n){let t=n.key,i=n.value;if(Pt(i)==="array"){if(i.length<1)return[new Re(t,i,"array length at least 1 expected, length 0 found")];let a=[];for(let l=0;l<i.length;l++)a=a.concat(il({key:`${t}[${l}]`,value:i[l]}));return a}return il({key:t,value:i})},variableAnchorOffsetCollection:function(n){let t=n.key,i=n.value,a=Pt(i),l=n.styleSpec;if(a!=="array"||i.length<1||i.length%2!=0)return[new Re(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<i.length;f+=2)d=d.concat(kr({key:`${t}[${f}]`,value:i[f],valueSpec:l.layout_symbol["text-anchor"]})),d=d.concat(tl({key:`${t}[${f+1}]`,value:i[f+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:l}));return d},sprite:ih,state:pa};function da(n){let t=n.value,i=n.valueSpec,a=n.styleSpec;return n.validateSpec=da,i.expression&&es(li(t))?Xu(n):i.expression&&Ys(_r(t))?Do(n):i.type&&kc[i.type]?kc[i.type](n):Rn(Ki({},n,{valueSpec:i.type?a[i.type]:i}))}function nh(n){let t=n.value,i=n.key,a=Hn(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Re(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Re(i,t,'"glyphs" url must include a "{range}" token'))),a}function yn(n,t=pe){let i=[];return i=i.concat(da({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:da,objectElementValidators:{glyphs:nh,"*":()=>[]}})),n.constants&&(i=i.concat(Mc({key:"constants",value:n.constants}))),ma(i)}function Xn(n){return function(t){return n(Rl(Vi({},t),{validateSpec:da}))}}function ma(n){return[].concat(n).sort((t,i)=>t.line-i.line)}function Kn(n){return function(...t){return ma(n.apply(this,t))}}yn.source=Kn(Xn(_n)),yn.sprite=Kn(Xn(ih)),yn.glyphs=Kn(Xn(nh)),yn.light=Kn(Xn(ha)),yn.sky=Kn(Xn(Ac)),yn.terrain=Kn(Xn(th)),yn.state=Kn(Xn(pa)),yn.layer=Kn(Xn(eh)),yn.filter=Kn(Xn(Ec)),yn.paintProperty=Kn(Xn(Ju)),yn.layoutProperty=Kn(Xn(Qu));let fa=yn,Ep=fa.light,ss=fa.sky,Ap=fa.paintProperty,kp=fa.layoutProperty;function ls(n,t){let i=!1;if(t&&t.length)for(let a of t)n.fire(new Pe(new Error(a.message))),i=!0;return i}class cs{constructor(t,i,a){let l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(i=f[1])+2*(a=f[2]);for(let b=0;b<this.d*this.d;b++){let S=f[3+b],I=f[3+b+1];l.push(S===I?null:f.subarray(S,I))}let v=f[3+l.length+1];this.keys=f.subarray(f[3+l.length],v),this.bboxes=f.subarray(v),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let f=0;f<this.d*this.d;f++)l.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=a,this.scale=i/t,this.uid=0;let d=a/i*t;this.min=-d,this.max=t+d}insert(t,i,a,l,d){this._forEachCell(i,a,l,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,a,l,d,f){this.cells[d].push(f)}query(t,i,a,l,d){let f=this.min,v=this.max;if(t<=f&&i<=f&&v<=a&&v<=l&&!d)return Array.prototype.slice.call(this.keys);{let b=[];return this._forEachCell(t,i,a,l,this._queryCell,b,{},d),b}}_queryCell(t,i,a,l,d,f,v,b){let S=this.cells[d];if(S!==null){let I=this.keys,E=this.bboxes;for(let L=0;L<S.length;L++){let z=S[L];if(v[z]===void 0){let R=4*z;(b?b(E[R+0],E[R+1],E[R+2],E[R+3]):t<=E[R+2]&&i<=E[R+3]&&a>=E[R+0]&&l>=E[R+1])?(v[z]=!0,f.push(I[z])):v[z]=!1}}}}_forEachCell(t,i,a,l,d,f,v,b){let S=this._convertToCellCoord(t),I=this._convertToCellCoord(i),E=this._convertToCellCoord(a),L=this._convertToCellCoord(l);for(let z=S;z<=E;z++)for(let R=I;R<=L;R++){let j=this.d*R+z;if((!b||b(this._convertFromCellCoord(z),this._convertFromCellCoord(R),this._convertFromCellCoord(z+1),this._convertFromCellCoord(R+1)))&&d.call(this,t,i,a,l,j,f,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,i=3+this.cells.length+1+1,a=0;for(let f=0;f<this.cells.length;f++)a+=this.cells[f].length;let l=new Int32Array(i+a+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let d=i;for(let f=0;f<t.length;f++){let v=t[f];l[3+f]=d,l.set(v,d),d+=v.length}return l[3+t.length]=d,l.set(this.keys,d),d+=this.keys.length,l[3+t.length+1]=d,l.set(this.bboxes,d),d+=this.bboxes.length,l.buffer}static serialize(t,i){let a=t.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(t){return new cs(t.buffer)}}let Yn={};function Ge(n,t,i={}){if(Yn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),Yn[n]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}Ge("Object",Object),Ge("Set",Set),Ge("TransferableGridIndex",cs),Ge("Color",Tt),Ge("Error",Error),Ge("AJAXError",Q),Ge("ResolvedImage",Sn),Ge("StylePropertyFunction",ns),Ge("StyleExpression",wc,{omit:["_evaluator"]}),Ge("ZoomDependentExpression",Tc),Ge("ZoomConstantExpression",is),Ge("CompoundExpression",zn,{omit:["_evaluate"]});for(let n in la)la[n]._classRegistryKey||Ge(`Expression_${n}`,la[n]);function Lc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function nl(n){return n.$name||n.constructor._classRegistryKey}function Dc(n){return!(function(t){if(t===null||typeof t!="object")return!1;let i=nl(t);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Lc(n)||hr(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function ga(n,t){if(Dc(n))return(Lc(n)||hr(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){let d=[];for(let f of n)d.push(ga(f,t));return d}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);let i=nl(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Yn[i])throw new Error(`${i} is not registered.`);let{klass:a}=Yn[i],l=a.serialize?a.serialize(n,t):{};if(a.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let d in n){if(!n.hasOwnProperty(d)||Yn[i].omit.indexOf(d)>=0)continue;let f=n[d];l[d]=Yn[i].shallow.indexOf(d)>=0?f:ga(f,t)}n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(l.$name=i),l}function zo(n){if(Dc(n))return n;if(Array.isArray(n))return n.map(zo);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);let t=nl(n)||"Object";if(!Yn[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:i}=Yn[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(n);let a=Object.create(i.prototype);for(let l of Object.keys(n)){if(l==="$name")continue;let d=n[l];a[l]=Yn[t].shallow.indexOf(l)>=0?d:zo(d)}return a}class rl{constructor(){this.first=!0}update(t,i){let a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}let Ct={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Hangul Syllables":n=>n>=44032&&n<=55215,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function ol(n){for(let t of n)if(Rc(t.charCodeAt(0)))return!0;return!1}function Lp(n){for(let t of n)if(!rh(t.charCodeAt(0)))return!1;return!0}function al(n){let t=n.map(i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}}).filter(i=>i);return new RegExp(t.join("|"),"u")}let Dp=al(["Arab","Dupl","Mong","Ougr","Syrc"]);function rh(n){return!Dp.test(String.fromCodePoint(n))}let zc=al(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Rc(n){return!(n!==746&&n!==747&&(n<4352||!(Ct["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Ct["CJK Compatibility"](n)||Ct["CJK Strokes"](n)||!(!Ct["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Ct["Enclosed CJK Letters and Months"](n)||Ct["Ideographic Description Characters"](n)||Ct.Kanbun(n)||Ct.Katakana(n)&&n!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ct["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ct["Vertical Forms"](n)||Ct["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||zc.test(String.fromCodePoint(n)))))}function oh(n){return!(Rc(n)||(function(t){return!!(Ct["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ct["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ct["Letterlike Symbols"](t)||Ct["Number Forms"](t)||Ct["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ct["Control Pictures"](t)&&t!==9251||Ct["Optical Character Recognition"](t)||Ct["Enclosed Alphanumerics"](t)||Ct["Geometric Shapes"](t)||Ct["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ct["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ct["CJK Symbols and Punctuation"](t)||Ct.Katakana(t)||Ct["Private Use Area"](t)||Ct["CJK Compatibility Forms"](t)||Ct["Small Form Variants"](t)||Ct["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(n))}let ah=al(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Fc(n){return ah.test(String.fromCodePoint(n))}function sh(n,t){return!(!t&&Fc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Ct.Khmer(n))}function lh(n){for(let t of n)if(Fc(t.charCodeAt(0)))return!0;return!1}let Jn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Jn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;let i=n.pluginURL,a=new Promise(d=>{this.loadScriptResolve=d});t(i);let l=new Promise(d=>setTimeout(()=>d(),this.TIMEOUT));if(yield Promise.race([a,l]),this.isParsed()){let d={pluginStatus:"loaded",pluginURL:i};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)})}};class Qt{constructor(t,i){this.zoom=t,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new rl,this.transition=i.transition||{},this.globalState=i.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new rl,this.transition={},this.globalState={})}isSupportedScript(t){return(function(i,a){for(let l of i)if(!sh(l.charCodeAt(0),a))return!1;return!0})(t,Jn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,i=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class _a{constructor(t,i){this.property=t,this.value=i,this.expression=(function(a,l){if(es(a))return new ns(a,l);if(Ys(a)){let d=qu(a,l);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=a;return l.type==="color"&&typeof a=="string"?d=Tt.parse(a):l.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?l.type!=="numberArray"||typeof a!="number"&&!Array.isArray(a)?l.type!=="colorArray"||typeof a!="string"&&!Array.isArray(a)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(a)?d=on.parse(a):l.type==="projectionDefinition"&&typeof a=="string"&&(d=Yi.parse(a)):d=xi.parse(a):d=rn.parse(a):d=zi.parse(a),{globalStateRefs:new Set,kind:"constant",evaluate:()=>d}}})(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,i,a){return this.property.possiblyEvaluate(this,t,i,a)}}class Bc{constructor(t){this.property=t,this.value=new _a(t,void 0)}transitioned(t,i){return new Oc(this.property,this.value,i,Dn({},t.transition,this.transition),t.now)}untransitioned(){return new Oc(this.property,this.value,null,{},0)}}class ch{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Tn(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bc(this._values[t].property)),this._values[t].value=new _a(this._values[t].property,i===null?void 0:Tn(i))}getTransition(t){return Tn(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Bc(this._values[t].property)),this._values[t].transition=Tn(i)||void 0}serialize(){let t={};for(let i of Object.keys(this._values)){let a=this.getValue(i);a!==void 0&&(t[i]=a);let l=this.getTransition(i);l!==void 0&&(t[`${i}-transition`]=l)}return t}transitioned(t,i){let a=new jc(this._properties);for(let l of Object.keys(this._values))a._values[l]=this._values[l].transitioned(t,i._values[l]);return a}untransitioned(){let t=new jc(this._properties);for(let i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Oc{constructor(t,i,a,l,d){this.property=t,this.value=i,this.begin=d+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=a)}possiblyEvaluate(t,i,a){let l=t.now||0,d=this.value.possiblyEvaluate(t,i,a),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(t,i,a);{let v=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,i,a),d,cr(v))}}return d}}class jc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,a){let l=new sl(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,i,a);return l}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class uh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Tn(this._values[t].value)}setValue(t,i){this._values[t]=new _a(this._values[t].property,i===null?void 0:Tn(i))}serialize(){let t={};for(let i of Object.keys(this._values)){let a=this.getValue(i);a!==void 0&&(t[i]=a)}return t}possiblyEvaluate(t,i,a){let l=new sl(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(t,i,a);return l}}class yr{constructor(t,i,a){this.property=t,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,a,l){return this.property.evaluate(this.value,this.parameters,t,i,a,l)}}class sl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ke{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,a){let l=gr[this.specification.type];return l?l(t,i,a):t}}class it{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,a,l){return new yr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},a,l)}:t.expression,i)}interpolate(t,i,a){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new yr(this,{kind:"constant",value:void 0},t.parameters);let l=gr[this.specification.type];if(l){let d=l(t.value.value,i.value.value,a);return new yr(this,{kind:"constant",value:d},t.parameters)}return t}evaluate(t,i,a,l,d,f){return t.kind==="constant"?t.value:t.evaluate(i,a,l,d,f)}}class ll extends it{possiblyEvaluate(t,i,a,l){if(t.value===void 0)return new yr(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){let d=t.expression.evaluate(i,null,{},a,l),f=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,v=this._calculate(f,f,f,i);return new yr(this,{kind:"constant",value:v},i)}if(t.expression.kind==="camera"){let d=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new yr(this,{kind:"constant",value:d},i)}return new yr(this,t.expression,i)}evaluate(t,i,a,l,d,f){if(t.kind==="source"){let v=t.evaluate(i,a,l,d,f);return this._calculate(v,v,v,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},a,l),t.evaluate({zoom:Math.floor(i.zoom)},a,l),t.evaluate({zoom:Math.floor(i.zoom)+1},a,l),i):t.value}_calculate(t,i,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class no{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,l){if(t.value!==void 0){if(t.expression.kind==="constant"){let d=t.expression.evaluate(i,null,{},a,l);return this._calculate(d,d,d,i)}return this._calculate(t.expression.evaluate(new Qt(Math.floor(i.zoom-1),i)),t.expression.evaluate(new Qt(Math.floor(i.zoom),i)),t.expression.evaluate(new Qt(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,a,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:a,to:i}}interpolate(t){return t}}class cl{constructor(t){this.specification=t}possiblyEvaluate(t,i,a,l){return!!t.expression.evaluate(i,null,{},a,l)}interpolate(){return!1}}class an{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let i in t){let a=t[i];a.specification.overridable&&this.overridableProperties.push(i);let l=this.defaultPropertyValues[i]=new _a(a,void 0),d=this.defaultTransitionablePropertyValues[i]=new Bc(a);this.defaultTransitioningPropertyValues[i]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate({})}}}Ge("DataDrivenProperty",it),Ge("DataConstantProperty",Ke),Ge("CrossFadedDataDrivenProperty",ll),Ge("CrossFadedProperty",no),Ge("ColorRampProperty",cl);let hh="-transition";class Fn extends Xe{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=ko(t.filter)),i.layout&&(this._unevaluatedLayout=new uh(i.layout)),i.paint)){this._transitionablePaint=new ch(i.paint);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new sl(i.paint)}}setFilter(t){this.filter=t,this._featureFilter=ko(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){let t=new Set;if(this._unevaluatedLayout)for(let i in this._unevaluatedLayout._values){let a=this._unevaluatedLayout._values[i];for(let l of a.getGlobalStateRefs())t.add(l)}for(let i of this._featureFilter.getGlobalStateRefs())t.add(i);return t}getPaintAffectingGlobalStateRefs(){var t;let i=new globalThis.Map;if(this._transitionablePaint)for(let a in this._transitionablePaint._values){let l=this._transitionablePaint._values[a].value;for(let d of l.getGlobalStateRefs()){let f=(t=i.get(d))!==null&&t!==void 0?t:[];f.push({name:a,value:l.value}),i.set(d,f)}}return i}setLayoutProperty(t,i,a={}){i!=null&&this._validate(kp,`layers.${this.id}.layout.${t}`,t,i,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(hh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,a={}){if(i!=null&&this._validate(Ap,`layers.${this.id}.paint.${t}`,t,i,a))return!1;if(t.endsWith(hh))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{let l=this._transitionablePaint._values[t],d=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),v=l.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);let b=this._transitionablePaint._values[t].value;return b.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ko(t,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(t,i,a,l,d={}){return(!d||d.validate!==!1)&&ls(this,t.call(fa,{key:i,layerType:this.type,objectKey:a,value:l,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let i=this.paint.get(t);if(i instanceof yr&&to(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let zp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class us{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mi(n,t=1){let i=0,a=0;return{members:n.map(l=>{let d=zp[l.type].BYTES_PER_ELEMENT,f=i=ul(i,Math.max(t,d)),v=l.components||1;return a=Math.max(a,d),i+=d*v,{name:l.name,type:l.type,components:v,offset:f}}),size:ul(i,Math.max(a,t)),alignment:t}}function ul(n,t){return Math.ceil(n/t)*t}class ya extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){let a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){let l=2*t;return this.int16[l+0]=i,this.int16[l+1]=a,t}}ya.prototype.bytesPerElement=4,Ge("StructArrayLayout2i4",ya);class va extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=3*t;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=l,t}}va.prototype.bytesPerElement=6,Ge("StructArrayLayout3i6",va);class Uc extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,l)}emplace(t,i,a,l,d){let f=4*t;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=l,this.int16[f+3]=d,t}}Uc.prototype.bytesPerElement=8,Ge("StructArrayLayout4i8",Uc);class xa extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f){let v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,l,d,f)}emplace(t,i,a,l,d,f,v){let b=6*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=v,t}}xa.prototype.bytesPerElement=12,Ge("StructArrayLayout2i4i12",xa);class Ro extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f){let v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,l,d,f)}emplace(t,i,a,l,d,f,v){let b=4*t,S=8*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.uint8[S+4]=l,this.uint8[S+5]=d,this.uint8[S+6]=f,this.uint8[S+7]=v,t}}Ro.prototype.bytesPerElement=8,Ge("StructArrayLayout2i4ub8",Ro);class hs extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){let a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){let l=2*t;return this.float32[l+0]=i,this.float32[l+1]=a,t}}hs.prototype.bytesPerElement=8,Ge("StructArrayLayout2f8",hs);class hl extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S,I){let E=this.length;return this.resize(E+1),this.emplace(E,t,i,a,l,d,f,v,b,S,I)}emplace(t,i,a,l,d,f,v,b,S,I,E){let L=10*t;return this.uint16[L+0]=i,this.uint16[L+1]=a,this.uint16[L+2]=l,this.uint16[L+3]=d,this.uint16[L+4]=f,this.uint16[L+5]=v,this.uint16[L+6]=b,this.uint16[L+7]=S,this.uint16[L+8]=I,this.uint16[L+9]=E,t}}hl.prototype.bytesPerElement=20,Ge("StructArrayLayout10ui20",hl);class Fo extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S,I,E,L){let z=this.length;return this.resize(z+1),this.emplace(z,t,i,a,l,d,f,v,b,S,I,E,L)}emplace(t,i,a,l,d,f,v,b,S,I,E,L,z){let R=12*t;return this.int16[R+0]=i,this.int16[R+1]=a,this.int16[R+2]=l,this.int16[R+3]=d,this.uint16[R+4]=f,this.uint16[R+5]=v,this.uint16[R+6]=b,this.uint16[R+7]=S,this.int16[R+8]=I,this.int16[R+9]=E,this.int16[R+10]=L,this.int16[R+11]=z,t}}Fo.prototype.bytesPerElement=24,Ge("StructArrayLayout4i4ui4i24",Fo);class Nc extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=3*t;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=l,t}}Nc.prototype.bytesPerElement=12,Ge("StructArrayLayout3f12",Nc);class Vc extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Vc.prototype.bytesPerElement=4,Ge("StructArrayLayout1ul4",Vc);class pl extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S){let I=this.length;return this.resize(I+1),this.emplace(I,t,i,a,l,d,f,v,b,S)}emplace(t,i,a,l,d,f,v,b,S,I){let E=10*t,L=5*t;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=l,this.int16[E+3]=d,this.int16[E+4]=f,this.int16[E+5]=v,this.uint32[L+3]=b,this.uint16[E+8]=S,this.uint16[E+9]=I,t}}pl.prototype.bytesPerElement=20,Ge("StructArrayLayout6i1ul2ui20",pl);class $c extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f){let v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,l,d,f)}emplace(t,i,a,l,d,f,v){let b=6*t;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=l,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=v,t}}$c.prototype.bytesPerElement=12,Ge("StructArrayLayout2i2i2i12",$c);class h extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d){let f=this.length;return this.resize(f+1),this.emplace(f,t,i,a,l,d)}emplace(t,i,a,l,d,f){let v=4*t,b=8*t;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=l,this.int16[b+6]=d,this.int16[b+7]=f,t}}h.prototype.bytesPerElement=16,Ge("StructArrayLayout2f1f2i16",h);class e extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f){let v=this.length;return this.resize(v+1),this.emplace(v,t,i,a,l,d,f)}emplace(t,i,a,l,d,f,v){let b=16*t,S=4*t,I=8*t;return this.uint8[b+0]=i,this.uint8[b+1]=a,this.float32[S+1]=l,this.float32[S+2]=d,this.int16[I+6]=f,this.int16[I+7]=v,t}}e.prototype.bytesPerElement=16,Ge("StructArrayLayout2ub2f2i16",e);class r extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=3*t;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=l,t}}r.prototype.bytesPerElement=6,Ge("StructArrayLayout3ui6",r);class s extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H){let se=this.length;return this.resize(se+1),this.emplace(se,t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H)}emplace(t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se){let te=24*t,re=12*t,fe=48*t;return this.int16[te+0]=i,this.int16[te+1]=a,this.uint16[te+2]=l,this.uint16[te+3]=d,this.uint32[re+2]=f,this.uint32[re+3]=v,this.uint32[re+4]=b,this.uint16[te+10]=S,this.uint16[te+11]=I,this.uint16[te+12]=E,this.float32[re+7]=L,this.float32[re+8]=z,this.uint8[fe+36]=R,this.uint8[fe+37]=j,this.uint8[fe+38]=V,this.uint32[re+10]=H,this.int16[te+22]=se,t}}s.prototype.bytesPerElement=48,Ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",s);class c extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se,te,re,fe,we,Ee,Ne,Fe,je,Ye,Oe){let Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se,te,re,fe,we,Ee,Ne,Fe,je,Ye,Oe)}emplace(t,i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se,te,re,fe,we,Ee,Ne,Fe,je,Ye,Oe,Ue){let Se=32*t,ot=16*t;return this.int16[Se+0]=i,this.int16[Se+1]=a,this.int16[Se+2]=l,this.int16[Se+3]=d,this.int16[Se+4]=f,this.int16[Se+5]=v,this.int16[Se+6]=b,this.int16[Se+7]=S,this.uint16[Se+8]=I,this.uint16[Se+9]=E,this.uint16[Se+10]=L,this.uint16[Se+11]=z,this.uint16[Se+12]=R,this.uint16[Se+13]=j,this.uint16[Se+14]=V,this.uint16[Se+15]=H,this.uint16[Se+16]=se,this.uint16[Se+17]=te,this.uint16[Se+18]=re,this.uint16[Se+19]=fe,this.uint16[Se+20]=we,this.uint16[Se+21]=Ee,this.uint16[Se+22]=Ne,this.uint32[ot+12]=Fe,this.float32[ot+13]=je,this.float32[ot+14]=Ye,this.uint16[Se+30]=Oe,this.uint16[Se+31]=Ue,t}}c.prototype.bytesPerElement=64,Ge("StructArrayLayout8i15ui1ul2f2ui64",c);class p extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}p.prototype.bytesPerElement=4,Ge("StructArrayLayout1f4",p);class y extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=3*t;return this.uint16[6*t+0]=i,this.float32[d+1]=a,this.float32[d+2]=l,t}}y.prototype.bytesPerElement=12,Ge("StructArrayLayout1ui2f12",y);class w extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,a){let l=this.length;return this.resize(l+1),this.emplace(l,t,i,a)}emplace(t,i,a,l){let d=4*t;return this.uint32[2*t+0]=i,this.uint16[d+2]=a,this.uint16[d+3]=l,t}}w.prototype.bytesPerElement=8,Ge("StructArrayLayout1ul2ui8",w);class T extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){let a=this.length;return this.resize(a+1),this.emplace(a,t,i)}emplace(t,i,a){let l=2*t;return this.uint16[l+0]=i,this.uint16[l+1]=a,t}}T.prototype.bytesPerElement=4,Ge("StructArrayLayout2ui4",T);class P extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}P.prototype.bytesPerElement=2,Ge("StructArrayLayout1ui2",P);class M extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,a,l){let d=this.length;return this.resize(d+1),this.emplace(d,t,i,a,l)}emplace(t,i,a,l,d){let f=4*t;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=l,this.float32[f+3]=d,t}}M.prototype.bytesPerElement=16,Ge("StructArrayLayout4f16",M);class k extends us{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}k.prototype.size=20;class A extends pl{get(t){return new k(this,t)}}Ge("CollisionBoxArray",A);class D extends us{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}D.prototype.size=48;class F extends s{get(t){return new D(this,t)}}Ge("PlacedSymbolArray",F);class Z extends us{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Z.prototype.size=64;class G extends c{get(t){return new Z(this,t)}}Ge("SymbolInstanceArray",G);class W extends p{getoffsetX(t){return this.float32[1*t+0]}}Ge("GlyphOffsetArray",W);class X extends va{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ge("SymbolLineVertexArray",X);class ee extends us{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ee.prototype.size=12;class K extends y{get(t){return new ee(this,t)}}Ge("TextAnchorOffsetArray",K);class ie extends us{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ie.prototype.size=8;class oe extends w{get(t){return new ie(this,t)}}Ge("FeatureIndexArray",oe);class J extends ya{}class ue extends ya{}class xe extends ya{}class de extends xa{}class me extends Ro{}class ye extends hs{}class ze extends hl{}class Be extends Fo{}class Me extends Nc{}class We extends Vc{}class gt extends $c{}class Bt extends e{}class Vt extends r{}class jt extends T{}let ni=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ci}=ni;class dt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,i,a,l){let d=this.segments[this.segments.length-1];return t>dt.MAX_VERTEX_ARRAY_LENGTH&&fi(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${dt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+t>dt.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l?this.createNewSegment(i,a,l):d}createNewSegment(t,i,a){let l={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return a!==void 0&&(l.sortKey=a),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(t,i,a){return this.prepareSegment(0,t,i,a)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let t of this.segments)for(let i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,a,l){return new dt([{vertexOffset:t,primitiveOffset:i,vertexLength:a,primitiveLength:l,vaos:{},sortKey:0}])}}function $t(n,t){return 256*(n=fn(Math.floor(n),0,255))+fn(Math.floor(t),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge("SegmentVector",dt);let bi=mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Mi,Fi,sn,Qn={exports:{}},ro={exports:{}},oo={exports:{}},ba=(function(){if(sn)return Qn.exports;sn=1;var n=(Mi||(Mi=1,ro.exports=function(i,a){var l,d,f,v,b,S,I,E;for(d=i.length-(l=3&i.length),f=a,b=3432918353,S=461845907,E=0;E<d;)I=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,f=27492+(65535&(v=5*(65535&(f=(f^=I=(65535&(I=(I=(65535&I)*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,l){case 3:I^=(255&i.charCodeAt(E+2))<<16;case 2:I^=(255&i.charCodeAt(E+1))<<8;case 1:f^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(E)))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),ro.exports),t=(Fi||(Fi=1,oo.exports=function(i,a){for(var l,d=i.length,f=a^d,v=0;d>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++v;switch(d){case 3:f^=(255&i.charCodeAt(v+2))<<16;case 2:f^=(255&i.charCodeAt(v+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(v)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),oo.exports);return Qn.exports=n,Qn.exports.murmur3=n,Qn.exports.murmur2=t,Qn.exports})(),wa=B(ba);class Bo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,a,l){this.ids.push(Oo(t)),this.positions.push(i,a,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let i=Oo(t),a=0,l=this.ids.length-1;for(;a<l;){let f=a+l>>1;this.ids[f]>=i?l=f:a=f+1}let d=[];for(;this.ids[a]===i;)d.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return d}static serialize(t,i){let a=new Float64Array(t.ids),l=new Uint32Array(t.positions);return vn(a,l,0,a.length-1),i&&i.push(a.buffer,l.buffer),{ids:a,positions:l}}static deserialize(t){let i=new Bo;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Oo(n){let t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:wa(String(n))}function vn(n,t,i,a){for(;i<a;){let l=n[i+a>>1],d=i-1,f=a+1;for(;;){do d++;while(n[d]<l);do f--;while(n[f]>l);if(d>=f)break;er(n,d,f),er(t,3*d,3*f),er(t,3*d+1,3*f+1),er(t,3*d+2,3*f+2)}f-i<a-f?(vn(n,t,i,f),i=f+1):(vn(n,t,f+1,a),a=f)}}function er(n,t,i){let a=n[t];n[t]=n[i],n[i]=a}Ge("FeaturePositionMap",Bo);class ln{constructor(t,i){this.gl=t.gl,this.location=i}}class ao extends ln{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class wi extends ln{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ei extends ln{constructor(t,i){super(t,i),this.current=Tt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let Bn=new Float32Array(16);function Ti(n){return[$t(255*n.r,255*n.g),$t(255*n.b,255*n.a)]}class ps{constructor(t,i,a){this.value=t,this.uniformNames=i.map(l=>`u_${l}`),this.type=a}setUniform(t,i,a){t.set(a.constantOr(this.value))}getBinding(t,i,a){return this.type==="color"?new Ei(t,i):new ao(t,i)}}class Ta{constructor(t,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setUniform(t,i,a,l){let d=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,i,a){return a.substr(0,9)==="u_pattern"?new wi(t,i):new ao(t,i)}}class Lr{constructor(t,i,a,l){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,i,a){let l=this.paintVertexArray.length,d=this.expression.evaluate(new Qt(0,a),i,{},a.canonical,[],a.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(l,t,d)}updatePaintArray(t,i,a,l,d){let f=this.expression.evaluate(new Qt(0,d),a,l);this._setPaintValue(t,i,f)}_setPaintValue(t,i,a){if(this.type==="color"){let l=Ti(a);for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=t;l<i;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tr{constructor(t,i,a,l,d,f){this.expression=t,this.uniformNames=i.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=l,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,i,a){let l=this.expression.evaluate(new Qt(this.zoom,a),i,{},a.canonical,[],a.formattedSection),d=this.expression.evaluate(new Qt(this.zoom+1,a),i,{},a.canonical,[],a.formattedSection),f=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(f,t,l,d)}updatePaintArray(t,i,a,l,d){let f=this.expression.evaluate(new Qt(this.zoom,d),a,l),v=this.expression.evaluate(new Qt(this.zoom+1,d),a,l);this._setPaintValue(t,i,f,v)}_setPaintValue(t,i,a,l){if(this.type==="color"){let d=Ti(a),f=Ti(l);for(let v=t;v<i;v++)this.paintVertexArray.emplace(v,d[0],d[1],f[0],f[1])}else{for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,a,l);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){let a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,l=fn(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,i,a){return new ao(t,i)}}class so{constructor(t,i,a,l,d,f){this.expression=t,this.type=i,this.useIntegerZoom=a,this.zoom=l,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,i,a){let l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,i.patterns&&i.patterns[this.layerId],a.imagePositions)}updatePaintArray(t,i,a,l,d){this._setPaintValues(t,i,a.patterns&&a.patterns[this.layerId],d.imagePositions)}_setPaintValues(t,i,a,l){if(!l||!a)return;let{min:d,mid:f,max:v}=a,b=l[d],S=l[f],I=l[v];if(b&&S&&I)for(let E=t;E<i;E++)this.zoomInPaintVertexArray.emplace(E,S.tl[0],S.tl[1],S.br[0],S.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],S.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,S.tl[0],S.tl[1],S.br[0],S.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],S.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,bi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,bi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ph{constructor(t,i,a){this.binders={},this._buffers=[];let l=[];for(let d in t.paint._values){if(!a(d))continue;let f=t.paint.get(d);if(!(f instanceof yr&&to(f.property.specification)))continue;let v=dh(d,t.type),b=f.value,S=f.property.specification.type,I=f.property.useIntegerZoom,E=f.property.specification["property-type"],L=E==="cross-faded"||E==="cross-faded-data-driven";if(b.kind==="constant")this.binders[d]=L?new Ta(b.value,v):new ps(b.value,v,S),l.push(`/u_${d}`);else if(b.kind==="source"||L){let z=Gc(d,S,"source");this.binders[d]=L?new so(b,S,I,i,z,t.id):new Lr(b,v,S,z),l.push(`/a_${d}`)}else{let z=Gc(d,S,"composite");this.binders[d]=new tr(b,v,S,I,i,z),l.push(`/z_${d}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){let i=this.binders[t];return i instanceof Lr||i instanceof tr?i.maxValue:0}populatePaintArrays(t,i,a){for(let l in this.binders){let d=this.binders[l];(d instanceof Lr||d instanceof tr||d instanceof so)&&d.populatePaintArray(t,i,a)}}setConstantPatternPositions(t,i){for(let a in this.binders){let l=this.binders[a];l instanceof Ta&&l.setConstantPatternPositions(t,i)}}updatePaintArrays(t,i,a,l,d){let f=!1;for(let v in t){let b=i.getPositions(v);for(let S of b){let I=a.feature(S.index);for(let E in this.binders){let L=this.binders[E];if((L instanceof Lr||L instanceof tr||L instanceof so)&&L.expression.isStateDependent===!0){let z=l.paint.get(E);L.expression=z.value,L.updatePaintArray(S.start,S.end,I,t[v],d),f=!0}}}}return f}defines(){let t=[];for(let i in this.binders){let a=this.binders[i];(a instanceof ps||a instanceof Ta)&&t.push(...a.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){let t=[];for(let i in this.binders){let a=this.binders[i];if(a instanceof Lr||a instanceof tr)for(let l=0;l<a.paintVertexAttributes.length;l++)t.push(a.paintVertexAttributes[l].name);else if(a instanceof so)for(let l=0;l<bi.members.length;l++)t.push(bi.members[l].name)}return t}getBinderUniforms(){let t=[];for(let i in this.binders){let a=this.binders[i];if(a instanceof ps||a instanceof Ta||a instanceof tr)for(let l of a.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){let a=[];for(let l in this.binders){let d=this.binders[l];if(d instanceof ps||d instanceof Ta||d instanceof tr){for(let f of d.uniformNames)if(i[f]){let v=d.getBinding(t,i[f],f);a.push({name:f,property:l,binding:v})}}}return a}setUniforms(t,i,a,l){for(let{name:d,property:f,binding:v}of i)this.binders[f].setUniform(v,l,a.get(f),d)}updatePaintBuffers(t){this._buffers=[];for(let i in this.binders){let a=this.binders[i];if(t&&a instanceof so){let l=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(a instanceof Lr||a instanceof tr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(let i in this.binders){let a=this.binders[i];(a instanceof Lr||a instanceof tr||a instanceof so)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let i=this.binders[t];(i instanceof Lr||i instanceof tr||i instanceof so)&&i.destroy()}}}class Pn{constructor(t,i,a=()=>!0){this.programConfigurations={};for(let l of t)this.programConfigurations[l.id]=new ph(l,i,a);this.needsUpload=!1,this._featureMap=new Bo,this._bufferOffset=0}populatePaintArrays(t,i,a,l){for(let d in this.programConfigurations)this.programConfigurations[d].populatePaintArrays(t,i,l);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,a,l){for(let d of a)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,i,d,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function dh(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function Gc(n,t,i){let a={color:{source:hs,composite:M},number:{source:p,composite:hs}},l=(function(d){return{"line-pattern":{source:ze,composite:ze},"fill-pattern":{source:ze,composite:ze},"fill-extrusion-pattern":{source:ze,composite:ze}}[d]})(n);return l&&l[i]||a[t][i]}Ge("ConstantBinder",ps),Ge("CrossFadedConstantBinder",Ta),Ge("SourceExpressionBinder",Lr),Ge("CrossFadedCompositeBinder",so),Ge("CompositeExpressionBinder",tr),Ge("ProgramConfiguration",ph,{omit:["_buffers"]}),Ge("ProgramConfigurationSet",Pn);let dl=Math.pow(2,14)-1,ml=-dl-1;function lo(n){let t=Ot/n.extent,i=n.loadGeometry();for(let a=0;a<i.length;a++){let l=i[a];for(let d=0;d<l.length;d++){let f=l[d],v=Math.round(f.x*t),b=Math.round(f.y*t);f.x=fn(v,ml,dl),f.y=fn(b,ml,dl),(v<f.x||v>f.x+1||b<f.y||b>f.y+1)&&fi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Dr(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?lo(n):[]}}let Tm=-32768;function wy(n,t,i,a,l){n.emplaceBack(Tm+8*t+a,Tm+8*i+l)}class Rp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ue,this.indexArray=new Vt,this.segments=new dt,this.programConfigurations=new Pn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){let l=this.layers[0],d=[],f=null,v=!1,b=l.type==="heatmap";if(l.type==="circle"){let I=l;f=I.layout.get("circle-sort-key"),v=!f.isConstant(),b=b||I.paint.get("circle-pitch-alignment")==="map"}let S=b?i.subdivisionGranularity.circle:1;for(let{feature:I,id:E,index:L,sourceLayerIndex:z}of t){let R=this.layers[0]._featureFilter.needGeometry,j=Dr(I,R);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom,{globalState:this.globalState}),j,a))continue;let V=v?f.evaluate(j,{},a):void 0,H={id:E,properties:I.properties,type:I.type,sourceLayerIndex:z,index:L,geometry:R?j.geometry:lo(I),patterns:{},sortKey:V};d.push(H)}v&&d.sort((I,E)=>I.sortKey-E.sortKey);for(let I of d){let{geometry:E,index:L,sourceLayerIndex:z}=I,R=t[L].feature;this.addFeature(I,E,L,a,S),i.featureIndex.insert(R,E,L,z,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:a,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ci),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,a,l,d=1){let f;switch(d){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}let v=f.length;for(let b of i)for(let S of b){let I=S.x,E=S.y;if(I<0||I>=Ot||E<0||E>=Ot)continue;let L=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),z=L.vertexLength;for(let R=0;R<v;R++)for(let j=0;j<v;j++)wy(this.layoutVertexArray,I,E,f[j],f[R]);for(let R=0;R<v-1;R++)for(let j=0;j<v-1;j++){let V=z+R*v+j,H=z+(R+1)*v+j;this.indexArray.emplaceBack(V,H+1,V+1),this.indexArray.emplaceBack(V,H,H+1)}L.vertexLength+=v*v,L.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{imagePositions:{},canonical:l,globalState:this.globalState})}}function Sm(n,t){for(let i=0;i<n.length;i++)if(fl(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(fl(n,t[i]))return!0;return!!Fp(n,t)}function Ty(n,t,i){return!!fl(n,t)||!!Bp(t,n,i)}function Im(n,t){if(n.length===1)return Cm(t,n[0]);for(let i=0;i<t.length;i++){let a=t[i];for(let l=0;l<a.length;l++)if(fl(n,a[l]))return!0}for(let i=0;i<n.length;i++)if(Cm(t,n[i]))return!0;for(let i=0;i<t.length;i++)if(Fp(n,t[i]))return!0;return!1}function Sy(n,t,i){if(n.length>1){if(Fp(n,t))return!0;for(let a=0;a<t.length;a++)if(Bp(t[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Bp(n[a],t,i))return!0;return!1}function Fp(n,t){if(n.length===0||t.length===0)return!1;for(let i=0;i<n.length-1;i++){let a=n[i],l=n[i+1];for(let d=0;d<t.length-1;d++)if(Iy(a,l,t[d],t[d+1]))return!0}return!1}function Iy(n,t,i,a){return Gn(n,i,a)!==Gn(t,i,a)&&Gn(n,t,i)!==Gn(n,t,a)}function Bp(n,t,i){let a=i*i;if(t.length===1)return n.distSqr(t[0])<a;for(let l=1;l<t.length;l++)if(Pm(n,t[l-1],t[l])<a)return!0;return!1}function Pm(n,t,i){let a=t.distSqr(i);if(a===0)return n.distSqr(t);let l=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/a;return n.distSqr(l<0?t:l>1?i:i.sub(t)._mult(l)._add(t))}function Cm(n,t){let i,a,l,d=!1;for(let f=0;f<n.length;f++){i=n[f];for(let v=0,b=i.length-1;v<i.length;b=v++)a=i[v],l=i[b],a.y>t.y!=l.y>t.y&&t.x<(l.x-a.x)*(t.y-a.y)/(l.y-a.y)+a.x&&(d=!d)}return d}function fl(n,t){let i=!1;for(let a=0,l=n.length-1;a<n.length;l=a++){let d=n[a],f=n[l];d.y>t.y!=f.y>t.y&&t.x<(f.x-d.x)*(t.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function Py(n,t,i){let a=i[0],l=i[2];if(n.x<a.x&&t.x<a.x||n.x>l.x&&t.x>l.x||n.y<a.y&&t.y<a.y||n.y>l.y&&t.y>l.y)return!1;let d=Gn(n,t,i[0]);return d!==Gn(n,t,i[1])||d!==Gn(n,t,i[2])||d!==Gn(n,t,i[3])}function Zc(n,t,i){let a=t.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(t.id).getMaxValue(n)}function mh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function fh(n,t,i,a,l){if(!t[0]&&!t[1])return n;let d=C.convert(t)._mult(l);i==="viewport"&&d._rotate(-a);let f=[];for(let v=0;v<n.length;v++)f.push(n[v].sub(d));return f}let Mm,Em;Ge("CircleBucket",Rp,{omit:["layers"]});var Cy={get paint(){return Em=Em||new an({"circle-radius":new it(pe.paint_circle["circle-radius"]),"circle-color":new it(pe.paint_circle["circle-color"]),"circle-blur":new it(pe.paint_circle["circle-blur"]),"circle-opacity":new it(pe.paint_circle["circle-opacity"]),"circle-translate":new Ke(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new it(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new it(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new it(pe.paint_circle["circle-stroke-opacity"])})},get layout(){return Mm=Mm||new an({"circle-sort-key":new it(pe.layout_circle["circle-sort-key"])})}};class My extends Fn{constructor(t){super(t,Cy)}createBucket(t){return new Rp(t)}queryRadius(t){let i=t;return Zc("circle-radius",this,i)+Zc("circle-stroke-width",this,i)+mh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:l,transform:d,pixelsToTileUnits:f,unwrappedTileID:v,getElevation:b}){let S=fh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,f),I=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a),E=this.paint.get("circle-pitch-alignment")==="map",L=E?S:(function(R,j,V,H){return R.map(se=>Am(se,j,V,H))})(S,d,v,b),z=E?I*f:I;for(let R of l)for(let j of R){let V=E?j:Am(j,d,v,b),H=z,se=d.projectTileCoordinates(j.x,j.y,v,b).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?H*=se/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(H*=d.cameraToCenterDistance/se),Ty(L,V,H))return!0}return!1}}function Am(n,t,i,a){let l=t.projectTileCoordinates(n.x,n.y,i,a).point;return new C((.5*l.x+.5)*t.width,(.5*-l.y+.5)*t.height)}class km extends Rp{}let Lm;Ge("HeatmapBucket",km,{omit:["layers"]});var Ey={get paint(){return Lm=Lm||new an({"heatmap-radius":new it(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new it(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new cl(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(pe.paint_heatmap["heatmap-opacity"])})}};function Op(n,{width:t,height:i},a,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*i*a)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*i*a}`)}else l=new Uint8Array(t*i*a);return n.width=t,n.height=i,n.data=l,n}function Dm(n,{width:t,height:i},a){if(t===n.width&&i===n.height)return;let l=Op({},{width:t,height:i},a);jp(n,l,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,i)},a),n.width=t,n.height=i,n.data=l.data}function jp(n,t,i,a,l,d){if(l.width===0||l.height===0)return t;if(l.width>n.width||l.height>n.height||i.x>n.width-l.width||i.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||a.x>t.width-l.width||a.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let f=n.data,v=t.data;if(f===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<l.height;b++){let S=((i.y+b)*n.width+i.x)*d,I=((a.y+b)*t.width+a.x)*d;for(let E=0;E<l.width*d;E++)v[I+E]=f[S+E]}return t}class qc{constructor(t,i){Op(this,t,1,i)}resize(t){Dm(this,t,1)}clone(){return new qc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,l,d){jp(t,i,a,l,d,1)}}class Cn{constructor(t,i){Op(this,t,4,i)}resize(t){Dm(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Cn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,a,l,d){jp(t,i,a,l,d,4)}setPixel(t,i,a){let l=4*(t*this.width+i);this.data[l+0]=Math.round(255*a.r/a.a),this.data[l+1]=Math.round(255*a.g/a.a),this.data[l+2]=Math.round(255*a.b/a.a),this.data[l+3]=Math.round(255*a.a)}}function zm(n){let t={},i=n.resolution||256,a=n.clips?n.clips.length:1,l=n.image||new Cn({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);let d=(f,v,b)=>{t[n.evaluationKey]=b;let S=n.expression.evaluate(t);l.setPixel(f/4/i,v/4,S)};if(n.clips)for(let f=0,v=0;f<a;++f,v+=4*i)for(let b=0,S=0;b<i;b++,S+=4){let I=b/(i-1),{start:E,end:L}=n.clips[f];d(v,S,E*(1-I)+L*I)}else for(let f=0,v=0;f<i;f++,v+=4)d(0,v,f/(i-1));return l}Ge("AlphaImage",qc),Ge("RGBAImage",Cn);let Up="big-fb";class Ay extends Fn{createBucket(t){return new km(t)}constructor(t){super(t,Ey),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=zm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Up)&&this.heatmapFbos.delete(Up)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Rm;var ky={get paint(){return Rm=Rm||new an({"hillshade-illumination-direction":new Ke(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ke(pe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ke(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(pe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ke(pe.paint_hillshade["hillshade-method"])})}};class Ly extends Fn{constructor(t){super(t,ky),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,a=this.paint.get("hillshade-highlight-color").values,l=this.paint.get("hillshade-shadow-color").values,d=Math.max(t.length,i.length,a.length,l.length);t=t.concat(Array(d-t.length).fill(t.at(-1))),i=i.concat(Array(d-i.length).fill(i.at(-1))),a=a.concat(Array(d-a.length).fill(a.at(-1))),l=l.concat(Array(d-l.length).fill(l.at(-1)));let f=i.map(yo);return{directionRadians:t.map(yo),altitudeRadians:f,shadowColor:l,highlightColor:a}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Fm;var Dy={get paint(){return Fm=Fm||new an({"color-relief-opacity":new Ke(pe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new cl(pe["paint_color-relief"]["color-relief-color"])})}};class Np{constructor(t,i,a,l){this.context=t,this.format=a,this.texture=t.gl.createTexture(),this.update(i,l)}update(t,i,a){let{width:l,height:d}=t,f=!(this.size&&this.size[0]===l&&this.size[1]===d||a),{context:v}=this,{gl:b}=v;if(this.useMipmap=!!(i&&i.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!i||i.premultiply!==!1)),f)this.size=[l,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||hr(t)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,t):b.texImage2D(b.TEXTURE_2D,0,this.format,l,d,0,this.format,b.UNSIGNED_BYTE,t.data);else{let{x:S,y:I}=a||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||hr(t)?b.texSubImage2D(b.TEXTURE_2D,0,S,I,b.RGBA,b.UNSIGNED_BYTE,t):b.texSubImage2D(b.TEXTURE_2D,0,S,I,l,d,b.RGBA,b.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,i,a){let{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),t!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||t),this.filter=t),i!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Bm{constructor(t,i,a,l=1,d=1,f=1,v=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void fi(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;let b=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=d,this.blueFactor=f,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<b;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(b,S)]=this.data[this._idx(b-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,b)]=this.data[this._idx(S,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<b;S++)for(let I=0;I<b;I++){let E=this.get(S,I);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,i){let a=new Uint8Array(this.data.buffer),l=4*this._idx(t,i);return this.unpack(a[l],a[l+1],a[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,a){return t*this.redFactor+i*this.greenFactor+a*this.blueFactor-this.baseShift}pack(t){return Om(t,this.getUnpackVector())}getPixels(){return new Cn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,d=i*this.dim+this.dim,f=a*this.dim,v=a*this.dim+this.dim;switch(i){case-1:l=d-1;break;case 1:d=l+1}switch(a){case-1:f=v-1;break;case 1:v=f+1}let b=-i*this.dim,S=-a*this.dim;for(let I=f;I<v;I++)for(let E=l;E<d;E++)this.data[this._idx(E,I)]=t.data[this._idx(E+b,I+S)]}}function Om(n,t){let i=t[0],a=t[1],l=t[2],d=t[3],f=Math.min(i,a,l),v=Math.round((n+d)/f);return{r:Math.floor(v*f/i)%256,g:Math.floor(v*f/a)%256,b:Math.floor(v*f/l)%256}}Ge("DEMData",Bm);class zy extends Fn{constructor(t){super(t,Dy)}_createColorRamp(t){let i={elevationStops:[],colorStops:[]},a=this._transitionablePaint._values["color-relief-color"].value.expression;if(a instanceof is&&a._styleExpression.expression instanceof Zi){this.colorRampExpression=a;let f=a._styleExpression.expression;i.elevationStops=f.labels,i.colorStops=[];for(let v of i.elevationStops)i.colorStops.push(f.evaluate({globals:{elevation:v}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Tt.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=t)return i;let l={elevationStops:[],colorStops:[]},d=(i.elevationStops.length-1)/(t-1);for(let f=0;f<i.elevationStops.length-.5;f+=d)l.elevationStops.push(i.elevationStops[Math.round(f)]),l.colorStops.push(i.colorStops[Math.round(f)]);return fi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),l}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,i,a){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let l=this._createColorRamp(i),d=new Cn({width:l.colorStops.length,height:1}),f=new Cn({width:l.colorStops.length,height:1});for(let v=0;v<l.elevationStops.length;v++){let b=Om(l.elevationStops[v],a);f.setPixel(0,v,new Tt(b.r/255,b.g/255,b.b/255,1)),d.setPixel(0,v,l.colorStops[v])}return this.colorRampTextures={elevationTexture:new Np(t,f,t.gl.RGBA),colorTexture:new Np(t,d,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}let Ry=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fy}=Ry;function Vp(n,t,i){let a=i.patternDependencies,l=!1;for(let d of t){let f=d.paint.get(`${n}-pattern`);f.isConstant()||(l=!0);let v=f.constantOr(null);v&&(l=!0,a[v.to]=!0,a[v.from]=!0)}return l}function $p(n,t,i,a,l){let d=l.patternDependencies;for(let f of t){let v=f.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:a-1},i,{},l.availableImages),S=v.evaluate({zoom:a},i,{},l.availableImages),I=v.evaluate({zoom:a+1},i,{},l.availableImages);b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,d[b]=!0,d[S]=!0,d[I]=!0,i.patterns[f.id]={min:b,mid:S,max:I}}}return i}function jm(n,t,i,a,l){let d;if(l===(function(f,v,b,S){let I=0;for(let E=v,L=b-S;E<b;E+=S)I+=(f[L]-f[E])*(f[E+1]+f[L+1]),L=E;return I})(n,t,i,a)>0)for(let f=t;f<i;f+=a)d=$m(f/a|0,n[f],n[f+1],d);else for(let f=i-a;f>=t;f-=a)d=$m(f/a|0,n[f],n[f+1],d);return d&&gl(d,d.next)&&(Kc(d),d=d.next),d}function ds(n,t){if(!n)return n;t||(t=n);let i,a=n;do if(i=!1,a.steiner||!gl(a,a.next)&&_i(a.prev,a,a.next)!==0)a=a.next;else{if(Kc(a),a=t=a.prev,a===a.next)break;i=!0}while(i||a!==t);return t}function Wc(n,t,i,a,l,d,f){if(!n)return;!f&&d&&(function(b,S,I,E){let L=b;do L.z===0&&(L.z=Gp(L.x,L.y,S,I,E)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==b);L.prevZ.nextZ=null,L.prevZ=null,(function(z){let R,j=1;do{let V,H=z;z=null;let se=null;for(R=0;H;){R++;let te=H,re=0;for(let we=0;we<j&&(re++,te=te.nextZ,te);we++);let fe=j;for(;re>0||fe>0&&te;)re!==0&&(fe===0||!te||H.z<=te.z)?(V=H,H=H.nextZ,re--):(V=te,te=te.nextZ,fe--),se?se.nextZ=V:z=V,V.prevZ=se,se=V;H=te}se.nextZ=null,j*=2}while(R>1)})(L)})(n,a,l,d);let v=n;for(;n.prev!==n.next;){let b=n.prev,S=n.next;if(d?Oy(n,a,l,d):By(n))t.push(b.i,n.i,S.i),Kc(n),n=S.next,v=S.next;else if((n=S)===v){f?f===1?Wc(n=jy(ds(n),t),t,i,a,l,d,2):f===2&&Uy(n,t,i,a,l,d):Wc(ds(n),t,i,a,l,d,1);break}}}function By(n){let t=n.prev,i=n,a=n.next;if(_i(t,i,a)>=0)return!1;let l=t.x,d=i.x,f=a.x,v=t.y,b=i.y,S=a.y,I=Math.min(l,d,f),E=Math.min(v,b,S),L=Math.max(l,d,f),z=Math.max(v,b,S),R=a.next;for(;R!==t;){if(R.x>=I&&R.x<=L&&R.y>=E&&R.y<=z&&Hc(l,v,d,b,f,S,R.x,R.y)&&_i(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function Oy(n,t,i,a){let l=n.prev,d=n,f=n.next;if(_i(l,d,f)>=0)return!1;let v=l.x,b=d.x,S=f.x,I=l.y,E=d.y,L=f.y,z=Math.min(v,b,S),R=Math.min(I,E,L),j=Math.max(v,b,S),V=Math.max(I,E,L),H=Gp(z,R,t,i,a),se=Gp(j,V,t,i,a),te=n.prevZ,re=n.nextZ;for(;te&&te.z>=H&&re&&re.z<=se;){if(te.x>=z&&te.x<=j&&te.y>=R&&te.y<=V&&te!==l&&te!==f&&Hc(v,I,b,E,S,L,te.x,te.y)&&_i(te.prev,te,te.next)>=0||(te=te.prevZ,re.x>=z&&re.x<=j&&re.y>=R&&re.y<=V&&re!==l&&re!==f&&Hc(v,I,b,E,S,L,re.x,re.y)&&_i(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;te&&te.z>=H;){if(te.x>=z&&te.x<=j&&te.y>=R&&te.y<=V&&te!==l&&te!==f&&Hc(v,I,b,E,S,L,te.x,te.y)&&_i(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;re&&re.z<=se;){if(re.x>=z&&re.x<=j&&re.y>=R&&re.y<=V&&re!==l&&re!==f&&Hc(v,I,b,E,S,L,re.x,re.y)&&_i(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function jy(n,t){let i=n;do{let a=i.prev,l=i.next.next;!gl(a,l)&&Nm(a,i,i.next,l)&&Xc(a,l)&&Xc(l,a)&&(t.push(a.i,i.i,l.i),Kc(i),Kc(i.next),i=n=l),i=i.next}while(i!==n);return ds(i)}function Uy(n,t,i,a,l,d){let f=n;do{let v=f.next.next;for(;v!==f.prev;){if(f.i!==v.i&&Zy(f,v)){let b=Vm(f,v);return f=ds(f,f.next),b=ds(b,b.next),Wc(f,t,i,a,l,d,0),void Wc(b,t,i,a,l,d,0)}v=v.next}f=f.next}while(f!==n)}function Ny(n,t){let i=n.x-t.x;return i===0&&(i=n.y-t.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function Vy(n,t){let i=(function(l,d){let f=d,v=l.x,b=l.y,S,I=-1/0;if(gl(l,f))return f;do{if(gl(l,f.next))return f.next;if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){let j=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(j<=v&&j>I&&(I=j,S=f.x<f.next.x?f:f.next,j===v))return S}f=f.next}while(f!==d);if(!S)return null;let E=S,L=S.x,z=S.y,R=1/0;f=S;do{if(v>=f.x&&f.x>=L&&v!==f.x&&Um(b<z?v:I,b,L,z,b<z?I:v,b,f.x,f.y)){let j=Math.abs(b-f.y)/(v-f.x);Xc(f,l)&&(j<R||j===R&&(f.x>S.x||f.x===S.x&&$y(S,f)))&&(S=f,R=j)}f=f.next}while(f!==E);return S})(n,t);if(!i)return t;let a=Vm(i,n);return ds(a,a.next),ds(i,i.next)}function $y(n,t){return _i(n.prev,n,t.prev)<0&&_i(t.next,n,n.next)<0}function Gp(n,t,i,a,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Gy(n){let t=n,i=n;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==n);return i}function Um(n,t,i,a,l,d,f,v){return(l-f)*(t-v)>=(n-f)*(d-v)&&(n-f)*(a-v)>=(i-f)*(t-v)&&(i-f)*(d-v)>=(l-f)*(a-v)}function Hc(n,t,i,a,l,d,f,v){return!(n===f&&t===v)&&Um(n,t,i,a,l,d,f,v)}function Zy(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(i,a){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==a.i&&l.next.i!==a.i&&Nm(l,l.next,i,a))return!0;l=l.next}while(l!==i);return!1})(n,t)&&(Xc(n,t)&&Xc(t,n)&&(function(i,a){let l=i,d=!1,f=(i.x+a.x)/2,v=(i.y+a.y)/2;do l.y>v!=l.next.y>v&&l.next.y!==l.y&&f<(l.next.x-l.x)*(v-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==i);return d})(n,t)&&(_i(n.prev,n,t.prev)||_i(n,t.prev,t))||gl(n,t)&&_i(n.prev,n,n.next)>0&&_i(t.prev,t,t.next)>0)}function _i(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function gl(n,t){return n.x===t.x&&n.y===t.y}function Nm(n,t,i,a){let l=_h(_i(n,t,i)),d=_h(_i(n,t,a)),f=_h(_i(i,a,n)),v=_h(_i(i,a,t));return l!==d&&f!==v||!(l!==0||!gh(n,i,t))||!(d!==0||!gh(n,a,t))||!(f!==0||!gh(i,n,a))||!(v!==0||!gh(i,t,a))}function gh(n,t,i){return t.x<=Math.max(n.x,i.x)&&t.x>=Math.min(n.x,i.x)&&t.y<=Math.max(n.y,i.y)&&t.y>=Math.min(n.y,i.y)}function _h(n){return n>0?1:n<0?-1:0}function Xc(n,t){return _i(n.prev,n,n.next)<0?_i(n,t,n.next)>=0&&_i(n,n.prev,t)>=0:_i(n,t,n.prev)<0||_i(n,n.next,t)<0}function Vm(n,t){let i=Zp(n.i,n.x,n.y),a=Zp(t.i,t.x,t.y),l=n.next,d=t.prev;return n.next=t,t.prev=n,i.next=l,l.prev=i,a.next=i,i.prev=a,d.next=a,a.prev=d,a}function $m(n,t,i,a){let l=Zp(n,t,i);return a?(l.next=a.next,l.prev=a,a.next.prev=l,a.next=l):(l.prev=l,l.next=l),l}function Kc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Zp(n,t,i){return{i:n,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class _l{constructor(t,i){if(i>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=i}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class yh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}yh.noSubdivision=new yh({fill:new _l(0,0),line:new _l(0,0),tile:new _l(0,0),stencil:new _l(0,0),circle:1}),Ge("SubdivisionGranularityExpression",_l),Ge("SubdivisionGranularitySetting",yh);let yl=-32768,Yc=32767;class qy{constructor(t,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Ot/t,this._canonical=i}_getKey(t,i){return(t+=32768)<<16|i+32768}_vertexToIndex(t,i){if(t<-32768||i<-32768||t>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let a=0|Math.round(t),l=0|Math.round(i),d=this._getKey(a,l);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);let f=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,f),this._vertexBuffer.push(a,l),f}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(l,d){let f=[];for(let v=0;v<d.length;v+=3){let b=d[v],S=d[v+1],I=d[v+2],E=l[2*b],L=l[2*b+1];(l[2*S]-E)*(l[2*I+1]-L)-(l[2*S+1]-L)*(l[2*I]-E)>0?(f.push(b),f.push(I),f.push(S)):(f.push(b),f.push(S),f.push(I))}return f})(this._vertexBuffer,t);let i=[],a=t.length;for(let l=0;l<a;l+=3){let d=[t[l+0],t[l+1],t[l+2]],f=[this._vertexBuffer[2*t[l+0]+0],this._vertexBuffer[2*t[l+0]+1],this._vertexBuffer[2*t[l+1]+0],this._vertexBuffer[2*t[l+1]+1],this._vertexBuffer[2*t[l+2]+0],this._vertexBuffer[2*t[l+2]+1]],v=1/0,b=1/0,S=-1/0,I=-1/0;for(let j=0;j<3;j++){let V=f[2*j],H=f[2*j+1];v=Math.min(v,V),S=Math.max(S,V),b=Math.min(b,H),I=Math.max(I,H)}if(v===S||b===I)continue;let E=Math.floor(v/this._granularityCellSize),L=Math.ceil(S/this._granularityCellSize),z=Math.floor(b/this._granularityCellSize),R=Math.ceil(I/this._granularityCellSize);if(E!==L||z!==R)for(let j=z;j<R;j++){let V=this._scanlineGenerateVertexRingForCellRow(j,f,d);Wy(this._vertexBuffer,V,i)}else i.push(...d)}return i}_scanlineGenerateVertexRingForCellRow(t,i,a){let l=t*this._granularityCellSize,d=l+this._granularityCellSize,f=[];for(let v=0;v<3;v++){let b=i[2*v],S=i[2*v+1],I=i[2*(v+1)%6],E=i[(2*(v+1)+1)%6],L=i[2*(v+2)%6],z=i[(2*(v+2)+1)%6],R=I-b,j=E-S,V=R===0,H=j===0,se=(l-S)/j,te=(d-S)/j,re=Math.min(se,te),fe=Math.max(se,te);if(!H&&(re>=1||fe<=0)||H&&(S<l||S>d)){E>=l&&E<=d&&f.push(a[(v+1)%3]);continue}!H&&re>0&&f.push(this._vertexToIndex(b+R*re,S+j*re));let we=b+R*Math.max(re,0),Ee=b+R*Math.min(fe,1);V||this._generateIntraEdgeVertices(f,b,S,I,E,we,Ee),!H&&fe<1&&f.push(this._vertexToIndex(b+R*fe,S+j*fe)),(H||E>=l&&E<=d)&&f.push(a[(v+1)%3]),!H&&(E<=l||E>=d)&&this._generateInterEdgeVertices(f,b,S,I,E,L,z,Ee,l,d)}return f}_generateIntraEdgeVertices(t,i,a,l,d,f,v){let b=l-i,S=d-a,I=S===0,E=I?Math.min(i,l):Math.min(f,v),L=I?Math.max(i,l):Math.max(f,v),z=Math.floor(E/this._granularityCellSize)+1,R=Math.ceil(L/this._granularityCellSize)-1;if(I?i<l:f<v)for(let j=z;j<=R;j++){let V=j*this._granularityCellSize;t.push(this._vertexToIndex(V,a+S*(V-i)/b))}else for(let j=R;j>=z;j--){let V=j*this._granularityCellSize;t.push(this._vertexToIndex(V,a+S*(V-i)/b))}}_generateInterEdgeVertices(t,i,a,l,d,f,v,b,S,I){let E=d-a,L=f-l,z=v-d,R=(S-d)/z,j=(I-d)/z,V=Math.min(R,j),H=Math.max(R,j),se=l+L*V,te=Math.floor(Math.min(se,b)/this._granularityCellSize)+1,re=Math.ceil(Math.max(se,b)/this._granularityCellSize)-1,fe=b<se,we=z===0;if(we&&(v===S||v===I))return;if(we||V>=1||H<=0){let Ne=a-v,Fe=f+(i-f)*Math.min((S-v)/Ne,(I-v)/Ne);te=Math.floor(Math.min(Fe,b)/this._granularityCellSize)+1,re=Math.ceil(Math.max(Fe,b)/this._granularityCellSize)-1,fe=b<Fe}let Ee=E>0?I:S;if(fe)for(let Ne=te;Ne<=re;Ne++)t.push(this._vertexToIndex(Ne*this._granularityCellSize,Ee));else for(let Ne=re;Ne>=te;Ne--)t.push(this._vertexToIndex(Ne*this._granularityCellSize,Ee))}_generateOutline(t){let i=[];for(let a of t){let l=ms(a,this._granularity,!0),d=this._pointArrayToIndices(l),f=[];for(let v=1;v<d.length;v++)f.push(d[v-1]),f.push(d[v]);i.push(f)}return i}_handlePoles(t){let i=!1,a=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(a=!0)),(i||a)&&this._fillPoles(t,i,a)}_ensureNoPoleVertices(){let t=this._vertexBuffer;for(let i=0;i<t.length;i+=2){let a=t[i+1];a===yl&&(t[i+1]=-32767),a===Yc&&(t[i+1]=32766)}}_generatePoleQuad(t,i,a,l,d,f){l>d!=(f===yl)?(t.push(i),t.push(a),t.push(this._vertexToIndex(l,f)),t.push(a),t.push(this._vertexToIndex(d,f)),t.push(this._vertexToIndex(l,f))):(t.push(a),t.push(i),t.push(this._vertexToIndex(l,f)),t.push(this._vertexToIndex(d,f)),t.push(a),t.push(this._vertexToIndex(l,f)))}_fillPoles(t,i,a){let l=this._vertexBuffer,d=Ot,f=t.length;for(let v=2;v<f;v+=3){let b=t[v-2],S=t[v-1],I=t[v],E=l[2*b],L=l[2*b+1],z=l[2*S],R=l[2*S+1],j=l[2*I],V=l[2*I+1];i&&(L===0&&R===0&&this._generatePoleQuad(t,b,S,E,z,yl),R===0&&V===0&&this._generatePoleQuad(t,S,I,z,j,yl),V===0&&L===0&&this._generatePoleQuad(t,I,b,j,E,yl)),a&&(L===d&&R===d&&this._generatePoleQuad(t,b,S,E,z,Yc),R===d&&V===d&&this._generatePoleQuad(t,S,I,z,j,Yc),V===d&&L===d&&this._generatePoleQuad(t,I,b,j,E,Yc))}}_initializeVertices(t){for(let i=0;i<t.length;i+=2)this._vertexToIndex(t[i],t[i+1])}subdividePolygonInternal(t,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:a,holeIndices:l}=(function(v){let b=[],S=[];for(let I of v)if(I.length!==0){I!==v[0]&&b.push(S.length/2);for(let E=0;E<I.length;E++)S.push(I[E].x),S.push(I[E].y)}return{flattened:S,holeIndices:b}})(t),d;this._initializeVertices(a);try{let v=(function(S,I,E=2){let L=I&&I.length,z=L?I[0]*E:S.length,R=jm(S,0,z,E,!0),j=[];if(!R||R.next===R.prev)return j;let V,H,se;if(L&&(R=(function(te,re,fe,we){let Ee=[];for(let Ne=0,Fe=re.length;Ne<Fe;Ne++){let je=jm(te,re[Ne]*we,Ne<Fe-1?re[Ne+1]*we:te.length,we,!1);je===je.next&&(je.steiner=!0),Ee.push(Gy(je))}Ee.sort(Ny);for(let Ne=0;Ne<Ee.length;Ne++)fe=Vy(Ee[Ne],fe);return fe})(S,I,R,E)),S.length>80*E){V=S[0],H=S[1];let te=V,re=H;for(let fe=E;fe<z;fe+=E){let we=S[fe],Ee=S[fe+1];we<V&&(V=we),Ee<H&&(H=Ee),we>te&&(te=we),Ee>re&&(re=Ee)}se=Math.max(te-V,re-H),se=se!==0?32767/se:0}return Wc(R,j,E,V,H,se,0),j})(a,l),b=this._convertIndices(a,v);d=this._subdivideTrianglesScanline(b)}catch(v){console.error(v)}let f=[];return i&&(f=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:f}}_convertIndices(t,i){let a=[];for(let l=0;l<i.length;l++)a.push(this._vertexToIndex(t[2*i[l]],t[2*i[l]+1]));return a}_pointArrayToIndices(t){let i=[];for(let a=0;a<t.length;a++){let l=t[a];i.push(this._vertexToIndex(l.x,l.y))}return i}}function Gm(n,t,i,a=!0){return new qy(i,t).subdividePolygonInternal(n,a)}function ms(n,t,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];let a=n[0],l=n[n.length-1],d=i&&(a.x!==l.x||a.y!==l.y);if(t<2)return d?[...n,n[0]]:[...n];let f=Math.floor(Ot/t),v=[];v.push(new C(n[0].x,n[0].y));let b=n.length,S=d?b:b-1;for(let I=0;I<S;I++){let E=n[I],L=I<b-1?n[I+1]:n[0],z=E.x,R=E.y,j=L.x,V=L.y,H=z!==j,se=R!==V;if(!H&&!se)continue;let te=j-z,re=V-R,fe=Math.abs(te),we=Math.abs(re),Ee=z,Ne=R;for(;;){let je=te>0?(Math.floor(Ee/f)+1)*f:(Math.ceil(Ee/f)-1)*f,Ye=re>0?(Math.floor(Ne/f)+1)*f:(Math.ceil(Ne/f)-1)*f,Oe=Math.abs(Ee-je),Ue=Math.abs(Ne-Ye),Se=Math.abs(Ee-j),ot=Math.abs(Ne-V),at=H?Oe/fe:Number.POSITIVE_INFINITY,et=se?Ue/we:Number.POSITIVE_INFINITY;if((Se<=Oe||!H)&&(ot<=Ue||!se))break;if(at<et&&H||!se){Ee=je,Ne+=re*at;let He=new C(Ee,Math.round(Ne));v[v.length-1].x===He.x&&v[v.length-1].y===He.y||v.push(He)}else{Ee+=te*et,Ne=Ye;let He=new C(Math.round(Ee),Ne);v[v.length-1].x===He.x&&v[v.length-1].y===He.y||v.push(He)}}let Fe=new C(j,V);v[v.length-1].x===Fe.x&&v[v.length-1].y===Fe.y||v.push(Fe)}return v}function Wy(n,t,i){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let a=0,l=n[2*t[0]];for(let b=1;b<t.length;b++){let S=n[2*t[b]];S<l&&(l=S,a=b)}let d=t.length,f=a,v=(f+1)%d;for(;;){let b=f-1>=0?f-1:d-1,S=(v+1)%d,I=n[2*t[b]],E=n[2*t[S]],L=n[2*t[f]],z=n[2*t[f]+1],R=n[2*t[v]+1],j=!1;if(I<E)j=!0;else if(I>E)j=!1;else{let V=R-z,H=-(n[2*t[v]]-L),se=z<R?1:-1;((I-L)*V+(n[2*t[b]+1]-z)*H)*se>((E-L)*V+(n[2*t[S]+1]-z)*H)*se&&(j=!0)}if(j){let V=t[b],H=t[f],se=t[v];V!==H&&V!==se&&H!==se&&i.push(se,H,V),f--,f<0&&(f=d-1)}else{let V=t[S],H=t[f],se=t[v];V!==H&&V!==se&&H!==se&&i.push(se,H,V),v++,v>=d&&(v=0)}if(b===S)break}}function Zm(n,t,i,a,l,d,f,v,b){let S=l.length/2,I=f&&v&&b;if(S<dt.MAX_VERTEX_ARRAY_LENGTH){let E=t.prepareSegment(S,i,a),L=E.vertexLength;for(let j=0;j<d.length;j+=3)a.emplaceBack(L+d[j],L+d[j+1],L+d[j+2]);let z,R;E.vertexLength+=S,E.primitiveLength+=d.length/3,I&&(R=f.prepareSegment(S,i,v),z=R.vertexLength,R.vertexLength+=S);for(let j=0;j<l.length;j+=2)n(l[j],l[j+1]);if(I)for(let j=0;j<b.length;j++){let V=b[j];for(let H=1;H<V.length;H+=2)v.emplaceBack(z+V[H-1],z+V[H]);R.primitiveLength+=V.length/2}}else(function(E,L,z,R,j,V){let H=[];for(let we=0;we<R.length/2;we++)H.push(-1);let se={count:0},te=0,re=E.getOrCreateLatestSegment(L,z),fe=re.vertexLength;for(let we=2;we<j.length;we+=3){let Ee=j[we-2],Ne=j[we-1],Fe=j[we],je=H[Ee]<te,Ye=H[Ne]<te,Oe=H[Fe]<te;re.vertexLength+((je?1:0)+(Ye?1:0)+(Oe?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(re=E.createNewSegment(L,z),te=se.count,je=!0,Ye=!0,Oe=!0,fe=0);let Ue=Jc(H,R,V,se,Ee,je,re),Se=Jc(H,R,V,se,Ne,Ye,re),ot=Jc(H,R,V,se,Fe,Oe,re);z.emplaceBack(fe+Ue-te,fe+Se-te,fe+ot-te),re.primitiveLength++}})(t,i,a,l,d,n),I&&(function(E,L,z,R,j,V){let H=[];for(let we=0;we<R.length/2;we++)H.push(-1);let se={count:0},te=0,re=E.getOrCreateLatestSegment(L,z),fe=re.vertexLength;for(let we=0;we<j.length;we++){let Ee=j[we];for(let Ne=1;Ne<j[we].length;Ne+=2){let Fe=Ee[Ne-1],je=Ee[Ne],Ye=H[Fe]<te,Oe=H[je]<te;re.vertexLength+((Ye?1:0)+(Oe?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(re=E.createNewSegment(L,z),te=se.count,Ye=!0,Oe=!0,fe=0);let Ue=Jc(H,R,V,se,Fe,Ye,re),Se=Jc(H,R,V,se,je,Oe,re);z.emplaceBack(fe+Ue-te,fe+Se-te),re.primitiveLength++}}})(f,i,v,l,b,n),t.forceNewSegmentOnNextPrepare(),f?.forceNewSegmentOnNextPrepare()}function Jc(n,t,i,a,l,d,f){if(d){let v=a.count;return i(t[2*l],t[2*l+1]),n[l]=a.count,a.count++,f.vertexLength++,v}return n[l]}class qp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xe,this.indexArray=new Vt,this.indexArray2=new jt,this.programConfigurations=new Pn(t.layers,t.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=Vp("fill",this.layers,i);let l=this.layers[0].layout.get("fill-sort-key"),d=!l.isConstant(),f=[];for(let{feature:v,id:b,index:S,sourceLayerIndex:I}of t){let E=this.layers[0]._featureFilter.needGeometry,L=Dr(v,E);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom,{globalState:this.globalState}),L,a))continue;let z=d?l.evaluate(L,{},a,i.availableImages):void 0,R={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:S,geometry:E?L.geometry:lo(v),patterns:{},sortKey:z};f.push(R)}d&&f.sort((v,b)=>v.sortKey-b.sortKey);for(let v of f){let{geometry:b,index:S,sourceLayerIndex:I}=v;if(this.hasPattern){let E=$p("fill",this.layers,v,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(v,b,S,a,{},i.subdivisionGranularity);i.featureIndex.insert(t[S].feature,b,S,I,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:a,globalState:this.globalState})}addFeatures(t,i,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,i,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fy),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,a,l,d,f){for(let v of Ya(i,500)){let b=Gm(v,l,f.fill.getGranularityForZoomLevel(l.z)),S=this.layoutVertexArray;Zm((I,E)=>{S.emplaceBack(I,E)},this.segments,this.layoutVertexArray,this.indexArray,b.verticesFlattened,b.indicesTriangles,this.segments2,this.indexArray2,b.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{imagePositions:d,canonical:l,globalState:this.globalState})}}let qm,Wm;Ge("FillBucket",qp,{omit:["layers","patternFeatures"]});var Hy={get paint(){return Wm=Wm||new an({"fill-antialias":new Ke(pe.paint_fill["fill-antialias"]),"fill-opacity":new it(pe.paint_fill["fill-opacity"]),"fill-color":new it(pe.paint_fill["fill-color"]),"fill-outline-color":new it(pe.paint_fill["fill-outline-color"]),"fill-translate":new Ke(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ll(pe.paint_fill["fill-pattern"])})},get layout(){return qm=qm||new an({"fill-sort-key":new it(pe.layout_fill["fill-sort-key"])})}};class Xy extends Fn{constructor(t){super(t,Hy)}recalculate(t,i){super.recalculate(t,i);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new qp(t)}queryRadius(){return mh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:i,transform:a,pixelsToTileUnits:l}){return Im(fh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-a.bearingInRadians,l),i)}isTileClipped(){return!0}}let Ky=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Yy=mi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Jy}=Ky;class vl{constructor(t,i,a,l,d){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=d,t.readFields(Qy,this,i)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let i=t.readVarint()+t.pos,a=[],l,d=1,f=0,v=0,b=0;for(;t.pos<i;){if(f<=0){let S=t.readVarint();d=7&S,f=S>>3}if(f--,d===1||d===2)v+=t.readSVarint(),b+=t.readSVarint(),d===1&&(l&&a.push(l),l=[]),l&&l.push(new C(v,b));else{if(d!==7)throw new Error(`unknown command ${d}`);l&&l.push(l[0].clone())}}return l&&a.push(l),a}bbox(){let t=this._pbf;t.pos=this._geometry;let i=t.readVarint()+t.pos,a=1,l=0,d=0,f=0,v=1/0,b=-1/0,S=1/0,I=-1/0;for(;t.pos<i;){if(l<=0){let E=t.readVarint();a=7&E,l=E>>3}if(l--,a===1||a===2)d+=t.readSVarint(),f+=t.readSVarint(),d<v&&(v=d),d>b&&(b=d),f<S&&(S=f),f>I&&(I=f);else if(a!==7)throw new Error(`unknown command ${a}`)}return[v,S,b,I]}toGeoJSON(t,i,a){let l=this.extent*Math.pow(2,a),d=this.extent*t,f=this.extent*i,v=this.loadGeometry();function b(L){return[360*(L.x+d)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+f)/l)*Math.PI))-90]}function S(L){return L.map(b)}let I;if(this.type===1){let L=[];for(let R of v)L.push(R[0]);let z=S(L);I=L.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){let L=v.map(S);I=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{let L=(function(R){let j=R.length;if(j<=1)return[R];let V=[],H,se;for(let te=0;te<j;te++){let re=e0(R[te]);re!==0&&(se===void 0&&(se=re<0),se===re<0?(H&&V.push(H),H=[R[te]]):H&&H.push(R[te]))}return H&&V.push(H),V})(v),z=[];for(let R of L)z.push(R.map(S));I=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}let E={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(E.id=this.id),E}}function Qy(n,t,i){n===1?t.id=i.readVarint():n===2?(function(a,l){let d=a.readVarint()+a.pos;for(;a.pos<d;){let f=l._keys[a.readVarint()],v=l._values[a.readVarint()];l.properties[f]=v}})(i,t):n===3?t.type=i.readVarint():n===4&&(t._geometry=i.pos)}function e0(n){let t=0;for(let i,a,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],a=n[f],t+=(a.x-i.x)*(i.y+a.y);return t}vl.types=["Unknown","Point","LineString","Polygon"];class Hm{constructor(t,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(t0,this,i),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let i=this._pbf.readVarint()+this._pbf.pos;return new vl(this._pbf,i,this.extent,this._keys,this._values)}}function t0(n,t,i){n===15?t.version=i.readVarint():n===1?t.name=i.readString():n===5?t.extent=i.readVarint():n===2?t._features.push(i.pos):n===3?t._keys.push(i.readString()):n===4&&t._values.push((function(a){let l=null,d=a.readVarint()+a.pos;for(;a.pos<d;){let f=a.readVarint()>>3;l=f===1?a.readString():f===2?a.readFloat():f===3?a.readDouble():f===4?a.readVarint64():f===5?a.readVarint():f===6?a.readSVarint():f===7?a.readBoolean():null}if(l==null)throw new Error("unknown feature value");return l})(i))}class Xm{constructor(t,i){this.layers=t.readFields(i0,{},i)}}function i0(n,t,i){if(n===3){let a=new Hm(i,i.readVarint()+i.pos);a.length&&(t[a.name]=a)}}let Wp=Math.pow(2,13);function Qc(n,t,i,a,l,d,f,v){n.emplaceBack(t,i,2*Math.floor(a*Wp)+f,l*Wp*2,d*Wp*2,Math.round(v))}class Hp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new de,this.centroidVertexArray=new J,this.indexArray=new Vt,this.programConfigurations=new Pn(t.layers,t.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.features=[],this.hasPattern=Vp("fill-extrusion",this.layers,i);for(let{feature:l,id:d,index:f,sourceLayerIndex:v}of t){let b=this.layers[0]._featureFilter.needGeometry,S=Dr(l,b);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom,{globalState:this.globalState}),S,a))continue;let I={id:d,sourceLayerIndex:v,index:f,geometry:b?S.geometry:lo(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push($p("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,f,a,{},i.subdivisionGranularity),i.featureIndex.insert(l,I.geometry,f,v,this.index,!0)}}addFeatures(t,i,a){for(let l of this.features){let{geometry:d}=l;this.addFeature(l,d,l.index,i,a,t.subdivisionGranularity)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:a,globalState:this.globalState})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jy),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Yy.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,a,l,d,f){for(let v of Ya(i,500)){let b={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(b,l,t,v,f);let I=this.layoutVertexArray.length-S,E=Math.floor(b.x/b.sampleCount),L=Math.floor(b.y/b.sampleCount);for(let z=0;z<I;z++)this.centroidVertexArray.emplaceBack(E,L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{imagePositions:d,canonical:l,globalState:this.globalState})}processPolygon(t,i,a,l,d){if(l.length<1||Km(l[0]))return;for(let E of l)E.length!==0&&n0(t,E);let f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=d.fill.getGranularityForZoomLevel(i.z),b=vl.types[a.type]==="Polygon";for(let E of l){if(E.length===0||Km(E))continue;let L=ms(E,v,b);this._generateSideFaces(L,f)}if(!b)return;let S=Gm(l,i,v,!1),I=this.layoutVertexArray;Zm((E,L)=>{Qc(I,E,L,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(t,i){let a=0;for(let l=1;l<t.length;l++){let d=t[l],f=t[l-1];if(r0(d,f))continue;i.segment.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let v=d.sub(f)._perp()._unit(),b=f.dist(d);a+b>32768&&(a=0),Qc(this.layoutVertexArray,d.x,d.y,v.x,v.y,0,0,a),Qc(this.layoutVertexArray,d.x,d.y,v.x,v.y,0,1,a),a+=b,Qc(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,0,a),Qc(this.layoutVertexArray,f.x,f.y,v.x,v.y,0,1,a);let S=i.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function n0(n,t){for(let i=0;i<t.length;i++){let a=t[i];i===t.length-1&&t[0].x===a.x&&t[0].y===a.y||(n.x+=a.x,n.y+=a.y,n.sampleCount++)}}function r0(n,t){return n.x===t.x&&(n.x<0||n.x>Ot)||n.y===t.y&&(n.y<0||n.y>Ot)}function Km(n){return n.every(t=>t.x<0)||n.every(t=>t.x>Ot)||n.every(t=>t.y<0)||n.every(t=>t.y>Ot)}let Ym;Ge("FillExtrusionBucket",Hp,{omit:["layers","features"]});var o0={get paint(){return Ym=Ym||new an({"fill-extrusion-opacity":new Ke(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new it(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ll(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new it(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new it(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class a0 extends Fn{constructor(t){super(t,o0)}createBucket(t){return new Hp(t)}queryRadius(){return mh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:l,transform:d,pixelsToTileUnits:f,pixelPosMatrix:v}){let b=fh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,f),S=this.paint.get("fill-extrusion-height").evaluate(i,a),I=this.paint.get("fill-extrusion-base").evaluate(i,a),E=(function(z,R){let j=[];for(let V of z){let H=[V.x,V.y,0,1];mo(H,H,R),j.push(new C(H[0]/H[3],H[1]/H[3]))}return j})(b,v),L=(function(z,R,j,V){let H=[],se=[],te=V[8]*R,re=V[9]*R,fe=V[10]*R,we=V[11]*R,Ee=V[8]*j,Ne=V[9]*j,Fe=V[10]*j,je=V[11]*j;for(let Ye of z){let Oe=[],Ue=[];for(let Se of Ye){let ot=Se.x,at=Se.y,et=V[0]*ot+V[4]*at+V[12],He=V[1]*ot+V[5]*at+V[13],Mt=V[2]*ot+V[6]*at+V[14],ui=V[3]*ot+V[7]*at+V[15],Ai=Mt+fe,en=ui+we,nr=et+Ee,Mn=He+Ne,qi=Mt+Fe,ri=ui+je,Oi=new C((et+te)/en,(He+re)/en);Oi.z=Ai/en,Oe.push(Oi);let Wi=new C(nr/ri,Mn/ri);Wi.z=qi/ri,Ue.push(Wi)}H.push(Oe),se.push(Ue)}return[H,se]})(l,I,S,v);return(function(z,R,j){let V=1/0;Im(j,R)&&(V=Jm(j,R[0]));for(let H=0;H<R.length;H++){let se=R[H],te=z[H];for(let re=0;re<se.length-1;re++){let fe=se[re],we=[fe,se[re+1],te[re+1],te[re],fe];Sm(j,we)&&(V=Math.min(V,Jm(j,we)))}}return V!==1/0&&V})(L[0],L[1],E)}}function eu(n,t){return n.x*t.x+n.y*t.y}function Jm(n,t){if(n.length===1){let i=0,a=t[i++],l;for(;!l||a.equals(l);)if(l=t[i++],!l)return 1/0;for(;i<t.length;i++){let d=t[i],f=n[0],v=l.sub(a),b=d.sub(a),S=f.sub(a),I=eu(v,v),E=eu(v,b),L=eu(b,b),z=eu(S,v),R=eu(S,b),j=I*L-E*E,V=(L*z-E*R)/j,H=(I*R-E*z)/j,se=a.z*(1-V-H)+l.z*V+d.z*H;if(isFinite(se))return se}return 1/0}{let i=1/0;for(let a of t)i=Math.min(i,a.z);return i}}let s0=mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:l0}=s0,c0=mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:u0}=c0,h0=Math.cos(Math.PI/180*37.5),Qm=Math.pow(2,14)/.5;class Xp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new me,this.layoutVertexArray2=new ye,this.indexArray=new Vt,this.programConfigurations=new Pn(t.layers,t.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,a){this.hasPattern=Vp("line",this.layers,i);let l=this.layers[0].layout.get("line-sort-key"),d=!l.isConstant(),f=[];for(let{feature:v,id:b,index:S,sourceLayerIndex:I}of t){let E=this.layers[0]._featureFilter.needGeometry,L=Dr(v,E);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom,{globalState:this.globalState}),L,a))continue;let z=d?l.evaluate(L,{},a):void 0,R={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:S,geometry:E?L.geometry:lo(v),patterns:{},sortKey:z};f.push(R)}d&&f.sort((v,b)=>v.sortKey-b.sortKey);for(let v of f){let{geometry:b,index:S,sourceLayerIndex:I}=v;if(this.hasPattern){let E=$p("line",this.layers,v,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(v,b,S,a,{},i.subdivisionGranularity);i.featureIndex.insert(t[S].feature,b,S,I,this.index)}}update(t,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:a,globalState:this.globalState})}addFeatures(t,i,a){for(let l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,i,a,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,u0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,l0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,a,l,d,f){let v=this.layers[0].layout,b=v.get("line-join").evaluate(t,{}),S=v.get("line-cap"),I=v.get("line-miter-limit"),E=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let L of i)this.addLine(L,t,b,S,I,E,l,f);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{imagePositions:d,canonical:l,globalState:this.globalState})}addLine(t,i,a,l,d,f,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=ms(t,v?b.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<t.length-1;te++)this.totalDistance+=t[te].dist(t[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let S=vl.types[i.type]==="Polygon",I=t.length;for(;I>=2&&t[I-1].equals(t[I-2]);)I--;let E=0;for(;E<I-1&&t[E].equals(t[E+1]);)E++;if(I<(S?3:2))return;a==="bevel"&&(d=1.05);let L=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray),R,j,V,H,se;this.e1=this.e2=-1,S&&(R=t[I-2],se=t[E].sub(R)._unit()._perp());for(let te=E;te<I;te++){if(V=te===I-1?S?t[E+1]:void 0:t[te+1],V&&t[te].equals(V))continue;se&&(H=se),R&&(j=R),R=t[te],se=V?V.sub(R)._unit()._perp():H,H=H||se;let re=H.add(se);re.x===0&&re.y===0||re._unit();let fe=H.x*se.x+H.y*se.y,we=re.x*se.x+re.y*se.y,Ee=we!==0?1/we:1/0,Ne=2*Math.sqrt(2-2*we),Fe=we<h0&&j&&V,je=H.x*se.y-H.y*se.x>0;if(Fe&&te>E){let Ue=R.dist(j);if(Ue>2*L){let Se=R.sub(R.sub(j)._mult(L/Ue)._round());this.updateDistance(j,Se),this.addCurrentVertex(Se,H,0,0,z),j=Se}}let Ye=j&&V,Oe=Ye?a:S?"butt":l;if(Ye&&Oe==="round"&&(Ee<f?Oe="miter":Ee<=2&&(Oe="fakeround")),Oe==="miter"&&Ee>d&&(Oe="bevel"),Oe==="bevel"&&(Ee>2&&(Oe="flipbevel"),Ee<d&&(Oe="miter")),j&&this.updateDistance(j,R),Oe==="miter")re._mult(Ee),this.addCurrentVertex(R,re,0,0,z);else if(Oe==="flipbevel"){if(Ee>100)re=se.mult(-1);else{let Ue=Ee*H.add(se).mag()/H.sub(se).mag();re._perp()._mult(Ue*(je?-1:1))}this.addCurrentVertex(R,re,0,0,z),this.addCurrentVertex(R,re.mult(-1),0,0,z)}else if(Oe==="bevel"||Oe==="fakeround"){let Ue=-Math.sqrt(Ee*Ee-1),Se=je?Ue:0,ot=je?0:Ue;if(j&&this.addCurrentVertex(R,H,Se,ot,z),Oe==="fakeround"){let at=Math.round(180*Ne/Math.PI/20);for(let et=1;et<at;et++){let He=et/at;if(He!==.5){let ui=He-.5;He+=He*ui*(He-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*ui*ui+(.848013+fe*(.215638*fe-1.06021)))}let Mt=se.sub(H)._mult(He)._add(H)._unit()._mult(je?-1:1);this.addHalfVertex(R,Mt.x,Mt.y,!1,je,0,z)}}V&&this.addCurrentVertex(R,se,-Se,-ot,z)}else if(Oe==="butt")this.addCurrentVertex(R,re,0,0,z);else if(Oe==="square"){let Ue=j?1:-1;this.addCurrentVertex(R,re,Ue,Ue,z)}else Oe==="round"&&(j&&(this.addCurrentVertex(R,H,0,0,z),this.addCurrentVertex(R,H,1,1,z,!0)),V&&(this.addCurrentVertex(R,se,-1,-1,z,!0),this.addCurrentVertex(R,se,0,0,z)));if(Fe&&te<I-1){let Ue=R.dist(V);if(Ue>2*L){let Se=R.add(V.sub(R)._mult(L/Ue)._round());this.updateDistance(R,Se),this.addCurrentVertex(Se,se,0,0,z),R=Se}}}}addCurrentVertex(t,i,a,l,d,f=!1){let v=i.y*l-i.x,b=-i.y-i.x*l;this.addHalfVertex(t,i.x+i.y*a,i.y-i.x*a,f,!1,a,d),this.addHalfVertex(t,v,b,f,!0,-l,d),this.distance>Qm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,a,l,d,f))}addHalfVertex({x:t,y:i},a,l,d,f,v,b){let S=.5*(this.lineClips?this.scaledDistance*(Qm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*l)+128,1+(v===0?0:v<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),b.primitiveLength++),f?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}let ef,tf;Ge("LineBucket",Xp,{omit:["layers","patternFeatures"]});var nf={get paint(){return tf=tf||new an({"line-opacity":new it(pe.paint_line["line-opacity"]),"line-color":new it(pe.paint_line["line-color"]),"line-translate":new Ke(pe.paint_line["line-translate"]),"line-translate-anchor":new Ke(pe.paint_line["line-translate-anchor"]),"line-width":new it(pe.paint_line["line-width"]),"line-gap-width":new it(pe.paint_line["line-gap-width"]),"line-offset":new it(pe.paint_line["line-offset"]),"line-blur":new it(pe.paint_line["line-blur"]),"line-dasharray":new no(pe.paint_line["line-dasharray"]),"line-pattern":new ll(pe.paint_line["line-pattern"]),"line-gradient":new cl(pe.paint_line["line-gradient"])})},get layout(){return ef=ef||new an({"line-cap":new Ke(pe.layout_line["line-cap"]),"line-join":new it(pe.layout_line["line-join"]),"line-miter-limit":new Ke(pe.layout_line["line-miter-limit"]),"line-round-limit":new Ke(pe.layout_line["line-round-limit"]),"line-sort-key":new it(pe.layout_line["line-sort-key"])})}};class p0 extends it{possiblyEvaluate(t,i){return i=new Qt(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,a,l){return i=Dn({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,a,l)}}let vh;class d0 extends Fn{constructor(t){super(t,nf),this.gradientVersion=0,vh||(vh=new p0(nf.paint.properties["line-width"].specification),vh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let i=this.gradientExpression();this.stepInterpolant=!!(function(a){return a._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof di,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=vh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Xp(t)}queryRadius(t){let i=t,a=rf(Zc("line-width",this,i),Zc("line-gap-width",this,i)),l=Zc("line-offset",this,i);return a/2+Math.abs(l)+mh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:a,geometry:l,transform:d,pixelsToTileUnits:f}){let v=fh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,f),b=f/2*rf(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),S=this.paint.get("line-offset").evaluate(i,a);return S&&(l=(function(I,E){let L=[];for(let z=0;z<I.length;z++){let R=I[z],j=[];for(let V=0;V<R.length;V++){let H=R[V-1],se=R[V],te=R[V+1],re=V===0?new C(0,0):se.sub(H)._unit()._perp(),fe=V===R.length-1?new C(0,0):te.sub(se)._unit()._perp(),we=re._add(fe)._unit(),Ee=we.x*fe.x+we.y*fe.y;Ee!==0&&we._mult(1/Ee),j.push(we._mult(E)._add(se))}L.push(j)}return L})(l,S*f)),(function(I,E,L){for(let z=0;z<E.length;z++){let R=E[z];if(I.length>=3){for(let j=0;j<R.length;j++)if(fl(I,R[j]))return!0}if(Sy(I,R,L))return!0}return!1})(v,l,b)}isTileClipped(){return!0}}function rf(n,t){return t>0?t+2*n:n}let m0=mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),f0=mi([{name:"a_projected_pos",components:3,type:"Float32"}],4);mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let g0=mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let of=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_0=mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function y0(n,t,i){return n.sections.forEach(a=>{a.text=(function(l,d,f){let v=d.layout.get("text-transform").evaluate(f,{});return v==="uppercase"?l=l.toLocaleUpperCase():v==="lowercase"&&(l=l.toLocaleLowerCase()),Jn.applyArabicShaping&&(l=Jn.applyArabicShaping(l)),l})(a.text,t,i)}),n}mi([{name:"triangle",components:3,type:"Uint16"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),mi([{type:"Float32",name:"offsetX"}]),mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),mi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let tu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Bi=24;let Kp=4294967296,af=1/Kp,sf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Yp{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,i,a=this.length){for(;this.pos<a;){let l=this.readVarint(),d=l>>3,f=this.pos;this.type=7&l,t(d,i,this),this.pos===f&&this.skip(l)}return i}readMessage(t,i){return this.readFields(t,i,this.readVarint()+this.pos)}readFixed32(){let t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){let t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Kp;return this.pos+=8,t}readSFixed64(){let t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Kp;return this.pos+=8,t}readFloat(){let t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){let t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){let i=this.buf,a,l;return l=i[this.pos++],a=127&l,l<128?a:(l=i[this.pos++],a|=(127&l)<<7,l<128?a:(l=i[this.pos++],a|=(127&l)<<14,l<128?a:(l=i[this.pos++],a|=(127&l)<<21,l<128?a:(l=i[this.pos],a|=(15&l)<<28,(function(d,f,v){let b=v.buf,S,I;if(I=b[v.pos++],S=(112&I)>>4,I<128||(I=b[v.pos++],S|=(127&I)<<3,I<128)||(I=b[v.pos++],S|=(127&I)<<10,I<128)||(I=b[v.pos++],S|=(127&I)<<17,I<128)||(I=b[v.pos++],S|=(127&I)<<24,I<128)||(I=b[v.pos++],S|=(1&I)<<31,I<128))return xl(d,S,f);throw new Error("Expected varint not more than 10 bytes")})(a,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){let t=this.readVarint()+this.pos,i=this.pos;return this.pos=t,t-i>=12&&sf?sf.decode(this.buf.subarray(i,t)):(function(a,l,d){let f="",v=l;for(;v<d;){let b=a[v],S,I,E,L=null,z=b>239?4:b>223?3:b>191?2:1;if(v+z>d)break;z===1?b<128&&(L=b):z===2?(S=a[v+1],(192&S)==128&&(L=(31&b)<<6|63&S,L<=127&&(L=null))):z===3?(S=a[v+1],I=a[v+2],(192&S)==128&&(192&I)==128&&(L=(15&b)<<12|(63&S)<<6|63&I,(L<=2047||L>=55296&&L<=57343)&&(L=null))):z===4&&(S=a[v+1],I=a[v+2],E=a[v+3],(192&S)==128&&(192&I)==128&&(192&E)==128&&(L=(15&b)<<18|(63&S)<<12|(63&I)<<6|63&E,(L<=65535||L>=1114112)&&(L=null))),L===null?(L=65533,z=1):L>65535&&(L-=65536,f+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),f+=String.fromCharCode(L),v+=z}return f})(this.buf,i,t)}readBytes(){let t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i}readPackedVarint(t=[],i){let a=this.readPackedEnd();for(;this.pos<a;)t.push(this.readVarint(i));return t}readPackedSVarint(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFloat());return t}readPackedDouble(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){let i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){let i=7&t;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(t,i){this.writeVarint(t<<3|i)}realloc(t){let i=this.length||16;for(;i<this.pos+t;)i*=2;if(i!==this.length){let a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*af),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*af),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(i,a){let l,d;if(i>=0?(l=i%4294967296|0,d=i/4294967296|0):(l=~(-i%4294967296),d=~(-i/4294967296),4294967295^l?l=l+1|0:(l=0,d=d+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(f,v,b){b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,b.buf[b.pos]=127&(f>>>=7)})(l,0,a),(function(f,v){let b=(7&f)<<4;v.buf[v.pos++]|=b|((f>>>=3)?128:0),f&&(v.buf[v.pos++]=127&f|((f>>>=7)?128:0),f&&(v.buf[v.pos++]=127&f|((f>>>=7)?128:0),f&&(v.buf[v.pos++]=127&f|((f>>>=7)?128:0),f&&(v.buf[v.pos++]=127&f|((f>>>=7)?128:0),f&&(v.buf[v.pos++]=127&f)))))})(d,a)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;let i=this.pos;this.pos=(function(l,d,f){for(let v,b,S=0;S<d.length;S++){if(v=d.charCodeAt(S),v>55295&&v<57344){if(!b){v>56319||S+1===d.length?(l[f++]=239,l[f++]=191,l[f++]=189):b=v;continue}if(v<56320){l[f++]=239,l[f++]=191,l[f++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(l[f++]=239,l[f++]=191,l[f++]=189,b=null);v<128?l[f++]=v:(v<2048?l[f++]=v>>6|192:(v<65536?l[f++]=v>>12|224:(l[f++]=v>>18|240,l[f++]=v>>12&63|128),l[f++]=v>>6&63|128),l[f++]=63&v|128)}return f})(this.buf,t,this.pos);let a=this.pos-i;a>=128&&lf(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){let i=t.length;this.writeVarint(i),this.realloc(i);for(let a=0;a<i;a++)this.buf[this.pos++]=t[a]}writeRawMessage(t,i){this.pos++;let a=this.pos;t(i,this);let l=this.pos-a;l>=128&&lf(a,l,this),this.pos=a-1,this.writeVarint(l),this.pos+=l}writeMessage(t,i,a){this.writeTag(t,2),this.writeRawMessage(i,a)}writePackedVarint(t,i){i.length&&this.writeMessage(t,v0,i)}writePackedSVarint(t,i){i.length&&this.writeMessage(t,x0,i)}writePackedBoolean(t,i){i.length&&this.writeMessage(t,T0,i)}writePackedFloat(t,i){i.length&&this.writeMessage(t,b0,i)}writePackedDouble(t,i){i.length&&this.writeMessage(t,w0,i)}writePackedFixed32(t,i){i.length&&this.writeMessage(t,S0,i)}writePackedSFixed32(t,i){i.length&&this.writeMessage(t,I0,i)}writePackedFixed64(t,i){i.length&&this.writeMessage(t,P0,i)}writePackedSFixed64(t,i){i.length&&this.writeMessage(t,C0,i)}writeBytesField(t,i){this.writeTag(t,2),this.writeBytes(i)}writeFixed32Field(t,i){this.writeTag(t,5),this.writeFixed32(i)}writeSFixed32Field(t,i){this.writeTag(t,5),this.writeSFixed32(i)}writeFixed64Field(t,i){this.writeTag(t,1),this.writeFixed64(i)}writeSFixed64Field(t,i){this.writeTag(t,1),this.writeSFixed64(i)}writeVarintField(t,i){this.writeTag(t,0),this.writeVarint(i)}writeSVarintField(t,i){this.writeTag(t,0),this.writeSVarint(i)}writeStringField(t,i){this.writeTag(t,2),this.writeString(i)}writeFloatField(t,i){this.writeTag(t,5),this.writeFloat(i)}writeDoubleField(t,i){this.writeTag(t,1),this.writeDouble(i)}writeBooleanField(t,i){this.writeVarintField(t,+i)}}function xl(n,t,i){return i?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function lf(n,t,i){let a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(a);for(let l=i.pos-1;l>=n;l--)i.buf[l+a]=i.buf[l]}function v0(n,t){for(let i=0;i<n.length;i++)t.writeVarint(n[i])}function x0(n,t){for(let i=0;i<n.length;i++)t.writeSVarint(n[i])}function b0(n,t){for(let i=0;i<n.length;i++)t.writeFloat(n[i])}function w0(n,t){for(let i=0;i<n.length;i++)t.writeDouble(n[i])}function T0(n,t){for(let i=0;i<n.length;i++)t.writeBoolean(n[i])}function S0(n,t){for(let i=0;i<n.length;i++)t.writeFixed32(n[i])}function I0(n,t){for(let i=0;i<n.length;i++)t.writeSFixed32(n[i])}function P0(n,t){for(let i=0;i<n.length;i++)t.writeFixed64(n[i])}function C0(n,t){for(let i=0;i<n.length;i++)t.writeSFixed64(n[i])}function M0(n,t,i){n===1&&i.readMessage(E0,t)}function E0(n,t,i){if(n===3){let{id:a,bitmap:l,width:d,height:f,left:v,top:b,advance:S}=i.readMessage(A0,{});t.push({id:a,bitmap:new qc({width:d+6,height:f+6},l),metrics:{width:d,height:f,left:v,top:b,advance:S}})}}function A0(n,t,i){n===1?t.id=i.readVarint():n===2?t.bitmap=i.readBytes():n===3?t.width=i.readVarint():n===4?t.height=i.readVarint():n===5?t.left=i.readSVarint():n===6?t.top=i.readSVarint():n===7&&(t.advance=i.readVarint())}function cf(n){let t=0,i=0;for(let f of n)t+=f.w*f.h,i=Math.max(i,f.w);n.sort((f,v)=>v.h-f.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}],l=0,d=0;for(let f of n)for(let v=a.length-1;v>=0;v--){let b=a[v];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===b.w&&f.h===b.h){let S=a.pop();S&&v<a.length&&(a[v]=S)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(a.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:l,h:d,fill:t/(l*d)||0}}class Jp{constructor(t,{pixelRatio:i,version:a,stretchX:l,stretchY:d,content:f,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=l,this.stretchY=d,this.content=f,this.version=a,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class uf{constructor(t,i){let a={},l={};this.haveRenderCallbacks=[];let d=[];this.addImages(t,a,d),this.addImages(i,l,d);let{w:f,h:v}=cf(d),b=new Cn({width:f||1,height:v||1});for(let S in t){let I=t[S],E=a[S].paddedRect;Cn.copy(I.data,b,{x:0,y:0},{x:E.x+1,y:E.y+1},I.data)}for(let S in i){let I=i[S],E=l[S].paddedRect,L=E.x+1,z=E.y+1,R=I.data.width,j=I.data.height;Cn.copy(I.data,b,{x:0,y:0},{x:L,y:z},I.data),Cn.copy(I.data,b,{x:0,y:j-1},{x:L,y:z-1},{width:R,height:1}),Cn.copy(I.data,b,{x:0,y:0},{x:L,y:z+j},{width:R,height:1}),Cn.copy(I.data,b,{x:R-1,y:0},{x:L-1,y:z},{width:1,height:j}),Cn.copy(I.data,b,{x:0,y:0},{x:L+R,y:z},{width:1,height:j})}this.image=b,this.iconPositions=a,this.patternPositions=l}addImages(t,i,a){for(let l in t){let d=t[l],f={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(f),i[l]=new Jp(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),i)}patchUpdatedImage(t,i,a){if(!t||!i||t.version===i.version)return;t.version=i.version;let[l,d]=t.tl;a.update(i.data,void 0,{x:l,y:d})}}var Sa;Ge("ImagePosition",Jp),Ge("ImageAtlas",uf),_.ao=void 0,(Sa=_.ao||(_.ao={}))[Sa.none=0]="none",Sa[Sa.horizontal=1]="horizontal",Sa[Sa.vertical=2]="vertical",Sa[Sa.horizontalOnly=3]="horizontalOnly";class iu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,i,a){let l=new iu;return l.scale=t||1,l.fontStack=i,l.verticalAlign=a||"bottom",l}static forImage(t,i){let a=new iu;return a.imageName=t,a.verticalAlign=i||"bottom",a}}class bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){let a=new bl;for(let l=0;l<t.sections.length;l++){let d=t.sections[l];d.image?a.addImageSection(d):a.addTextSection(d,i)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let i="";for(let a=0;a<t.length;a++){let l=t.charCodeAt(a+1)||null,d=t.charCodeAt(a-1)||null;i+=l&&oh(l)&&!tu[t[a+1]]||d&&oh(d)&&!tu[t[a-1]]||!tu[t[a]]?t[a]:tu[t[a]]}return i})(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&bh[this.text.charCodeAt(a)];a++)t++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&bh[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){let a=new bl;return a.text=this.text.substring(t,i),a.sectionIndex=this.sectionIndex.slice(t,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}getMaxImageSize(t){let i=0,a=0;for(let l=0;l<this.length();l++){let d=this.getSection(l);if(d.imageName){let f=t[d.imageName];if(!f)continue;let v=f.displaySize;i=Math.max(i,v[0]),a=Math.max(a,v[1])}}return{maxImageWidth:i,maxImageHeight:a}}addTextSection(t,i){this.text+=t.text,this.sections.push(iu.forText(t.scale,t.fontStack||i,t.verticalAlign));let a=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(a)}addImageSection(t){let i=t.image?t.image.name:"";if(i.length===0)return void fi("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(iu.forImage(i,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):fi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xh(n,t,i,a,l,d,f,v,b,S,I,E,L,z,R){let j=bl.fromFeature(n,l),V;E===_.ao.vertical&&j.verticalizePunctuation();let{processBidirectionalText:H,processStyledBidirectionalText:se}=Jn;if(H&&j.sections.length===1){V=[];let fe=H(j.toString(),Qp(j,S,d,t,a,z));for(let we of fe){let Ee=new bl;Ee.text=we,Ee.sections=j.sections;for(let Ne=0;Ne<we.length;Ne++)Ee.sectionIndex.push(0);V.push(Ee)}}else if(se){V=[];let fe=se(j.text,j.sectionIndex,Qp(j,S,d,t,a,z));for(let we of fe){let Ee=new bl;Ee.text=we[0],Ee.sectionIndex=we[1],Ee.sections=j.sections,V.push(Ee)}}else V=(function(fe,we){let Ee=[],Ne=fe.text,Fe=0;for(let je of we)Ee.push(fe.substring(Fe,je)),Fe=je;return Fe<Ne.length&&Ee.push(fe.substring(Fe,Ne.length)),Ee})(j,Qp(j,S,d,t,a,z));let te=[],re={positionedLines:te,text:j.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:E,iconsInText:!1,verticalizable:!1};return(function(fe,we,Ee,Ne,Fe,je,Ye,Oe,Ue,Se,ot,at){let et=0,He=0,Mt=0,ui=0,Ai=Oe==="right"?1:Oe==="left"?0:.5,en=Bi/at,nr=0;for(let ri of Fe){ri.trim();let Oi=ri.getMaxScale(),Wi={positionedGlyphs:[],lineOffset:0};fe.positionedLines[nr]=Wi;let Hi=Wi.positionedGlyphs,xn=0;if(!ri.length()){He+=je,++nr;continue}let rr=z0(Ne,ri,en);for(let En=0;En<ri.length();En++){let ki=ri.getSection(En),Ui=ri.getSectionIndex(En),Ni=ri.getCharCode(En),Si=R0(Ue,ot,Ni),ti;if(ki.imageName){if(fe.iconsInText=!0,ki.scale=ki.scale*en,ti=B0(ki,Si,Oi,rr,Ne),!ti)continue;xn=Math.max(xn,ti.imageOffset)}else if(ti=F0(ki,Ni,Si,rr,we,Ee),!ti)continue;let{rect:zr,metrics:Il,baselineOffset:Rr}=ti;Hi.push({glyph:Ni,imageName:ki.imageName,x:et,y:He+Rr+-17,vertical:Si,scale:ki.scale,fontStack:ki.fontStack,sectionIndex:Ui,metrics:Il,rect:zr}),Si?(fe.verticalizable=!0,et+=(ki.imageName?Il.advance:Bi)*ki.scale+Se):et+=Il.advance*ki.scale+Se}Hi.length!==0&&(Mt=Math.max(et-Se,Mt),O0(Hi,0,Hi.length-1,Ai)),et=0,Wi.lineOffset=Math.max(xn,(Oi-1)*Bi);let ji=je*Oi+xn;He+=ji,ui=Math.max(ji,ui),++nr}let{horizontalAlign:Mn,verticalAlign:qi}=ed(Ye);(function(ri,Oi,Wi,Hi,xn,rr,ji,En,ki){let Ui=(Oi-Wi)*xn,Ni=0;Ni=rr!==ji?-En*Hi- -17:-Hi*ki*ji+.5*ji;for(let Si of ri)for(let ti of Si.positionedGlyphs)ti.x+=Ui,ti.y+=Ni})(fe.positionedLines,Ai,Mn,qi,Mt,ui,je,He,Fe.length),fe.top+=-qi*He,fe.bottom=fe.top+He,fe.left+=-Mn*Mt,fe.right=fe.left+Mt})(re,t,i,a,V,f,v,b,E,S,L,R),!(function(fe){for(let we of fe)if(we.positionedGlyphs.length!==0)return!1;return!0})(te)&&re}let bh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},k0={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},L0={40:!0};function hf(n,t,i,a,l,d){if(t.imageName){let f=a[t.imageName];return f?f.displaySize[0]*t.scale*Bi/d+l:0}{let f=i[t.fontStack],v=f&&f[n];return v?v.metrics.advance*t.scale+l:0}}function pf(n,t,i,a){let l=Math.pow(n-t,2);return a?n<t?l/2:2*l:l+Math.abs(i)*i}function D0(n,t,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function df(n,t,i,a,l,d){let f=null,v=pf(t,i,l,d);for(let b of a){let S=pf(t-b.x,i,l,d)+b.badness;S<=v&&(f=b,v=S)}return{index:n,x:t,priorBreak:f,badness:v}}function mf(n){return n?mf(n.priorBreak).concat(n.index):[]}function Qp(n,t,i,a,l,d){if(!n)return[];let f=[],v=(function(E,L,z,R,j,V){let H=0;for(let se=0;se<E.length();se++){let te=E.getSection(se);H+=hf(E.getCharCode(se),te,R,j,L,V)}return H/Math.max(1,Math.ceil(H/z))})(n,t,i,a,l,d),b=n.text.indexOf("\u200B")>=0,S=0;for(let E=0;E<n.length();E++){let L=n.getSection(E),z=n.getCharCode(E);if(bh[z]||(S+=hf(z,L,a,l,t,d)),E<n.length()-1){let R=!((I=z)<11904)&&(!!Ct["CJK Compatibility Forms"](I)||!!Ct["CJK Compatibility"](I)||!!Ct["CJK Strokes"](I)||!!Ct["CJK Symbols and Punctuation"](I)||!!Ct["Enclosed CJK Letters and Months"](I)||!!Ct["Halfwidth and Fullwidth Forms"](I)||!!Ct["Ideographic Description Characters"](I)||!!Ct["Vertical Forms"](I)||zc.test(String.fromCodePoint(I)));(k0[z]||R||L.imageName||E!==n.length()-2&&L0[n.getCharCode(E+1)])&&f.push(df(E+1,S,v,f,D0(z,n.getCharCode(E+1),R&&b),!1))}}var I;return mf(df(n.length(),S,v,f,0,!0))}function ed(n){let t=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function z0(n,t,i){let a=t.getMaxScale()*Bi,{maxImageWidth:l,maxImageHeight:d}=t.getMaxImageSize(n),f=Math.max(a,d*i);return{verticalLineContentWidth:Math.max(a,l*i),horizontalLineContentHeight:f}}function ff(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function R0(n,t,i){return!(n===_.ao.horizontal||!t&&!Rc(i)||t&&(bh[i]||(a=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(a)))));var a}function F0(n,t,i,a,l,d){let f=d[n.fontStack],v=(function(S,I,E,L){if(S&&S.rect)return S;let z=I[E.fontStack],R=z&&z[L];return R?{rect:null,metrics:R.metrics}:null})(f&&f[t],l,n,t);if(v===null)return null;let b;if(i)b=a.verticalLineContentWidth-n.scale*Bi;else{let S=ff(n.verticalAlign);b=(a.horizontalLineContentHeight-n.scale*Bi)*S}return{rect:v.rect,metrics:v.metrics,baselineOffset:b}}function B0(n,t,i,a,l){let d=l[n.imageName];if(!d)return null;let f=d.paddedRect,v=d.displaySize,b={width:v[0],height:v[1],left:1,top:-3,advance:t?v[1]:v[0]},S;if(t)S=a.verticalLineContentWidth-v[1]*n.scale;else{let I=ff(n.verticalAlign);S=(a.horizontalLineContentHeight-v[1]*n.scale)*I}return{rect:f,metrics:b,baselineOffset:S,imageOffset:(t?v[0]:v[1])*n.scale-Bi*i}}function O0(n,t,i,a){if(a===0)return;let l=n[i],d=(n[i].x+l.metrics.advance*l.scale)*a;for(let f=t;f<=i;f++)n[f].x-=d}function j0(n,t,i){let{horizontalAlign:a,verticalAlign:l}=ed(i),d=t[0]-n.displaySize[0]*a,f=t[1]-n.displaySize[1]*l;return{image:n,top:f,bottom:f+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function gf(n){var t,i;let a=n.left,l=n.top,d=n.right-a,f=n.bottom-l,v=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",S=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&d/f<S||v==="proportional"){let I=Math.ceil(f*S);a*=I/d,d=I}}else if(v==="proportional"&&b==="stretchOnly"&&S!==0&&d/f>S){let I=Math.ceil(d/S);l*=I/f,f=I}return{x1:a,y1:l,x2:a+d,y2:l+f}}function _f(n,t,i,a,l,d){let f=n.image,v;if(f.content){let V=f.content,H=f.pixelRatio||1;v=[V[0]/H,V[1]/H,f.displaySize[0]-V[2]/H,f.displaySize[1]-V[3]/H]}let b=t.left*d,S=t.right*d,I,E,L,z;i==="width"||i==="both"?(z=l[0]+b-a[3],E=l[0]+S+a[1]):(z=l[0]+(b+S-f.displaySize[0])/2,E=z+f.displaySize[0]);let R=t.top*d,j=t.bottom*d;return i==="height"||i==="both"?(I=l[1]+R-a[0],L=l[1]+j+a[2]):(I=l[1]+(R+j-f.displaySize[1])/2,L=I+f.displaySize[1]),{image:f,top:I,right:E,bottom:L,left:z,collisionPadding:v}}let jo=128,Ia=32640;function yf(n,t){let{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Qt(n+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:l}=i,d=0;for(;d<a.length&&a[d]<=n;)d++;d=Math.max(0,d-1);let f=d;for(;f<a.length&&a[f]<n+1;)f++;f=Math.min(a.length-1,f);let v=a[d],b=a[f];return i.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:l}:{kind:"camera",minZoom:v,maxZoom:b,minSize:i.evaluate(new Qt(v)),maxSize:i.evaluate(new Qt(b)),interpolationType:l}}}function td(n,t,i){let a="never",l=n.get(t);return l?a=l:n.get(i)&&(a="always"),a}let U0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wh(n,t,i,a,l,d,f,v,b,S,I,E,L){let z=v?Math.min(Ia,Math.round(v[0])):0,R=v?Math.min(Ia,Math.round(v[1])):0;n.emplaceBack(t,i,Math.round(32*a),Math.round(32*l),d,f,(z<<1)+(b?1:0),R,16*S,16*I,256*E,256*L)}function id(n,t,i){n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i),n.emplaceBack(t.x,t.y,i)}function N0(n){for(let t of n.sections)if(lh(t.text))return!0;return!1}class nd{constructor(t){this.layoutVertexArray=new Be,this.indexArray=new Vt,this.programConfigurations=t,this.segments=new dt,this.dynamicLayoutVertexArray=new Me,this.opacityVertexArray=new We,this.hasVisibleVertices=!1,this.placedSymbolArray=new F}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,a,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,m0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,f0.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,U0,!0),this.opacityVertexBuffer.itemSize=1),(a||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ge("SymbolBuffers",nd);class rd{constructor(t,i,a){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new a,this.segments=new dt,this.collisionVertexArray=new Bt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,g0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ge("CollisionBuffers",rd);class wl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yf(this.zoom,i["text-size"]),this.iconSizeData=yf(this.zoom,i["icon-size"]);let a=this.layers[0].layout,l=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=td(a,"text-overlap","text-allow-overlap")!=="never"||td(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(f=>_.ao[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID}createArrays(){this.text=new nd(new Pn(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new nd(new Pn(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new W,this.lineVertexArray=new X,this.symbolInstances=new G,this.textAnchorOffsets=new K}calculateGlyphDependencies(t,i,a,l,d){for(let f=0;f<t.length;f++)if(i[t.charCodeAt(f)]=!0,(a||l)&&d){let v=tu[t.charAt(f)];v&&(i[v.charCodeAt(0)]=!0)}}populate(t,i,a){let l=this.layers[0],d=l.layout,f=d.get("text-font"),v=d.get("text-field"),b=d.get("icon-image"),S=(v.value.kind!=="constant"||v.value.value instanceof nn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,E=d.get("symbol-sort-key");if(this.features=[],!S&&!I)return;let L=i.iconDependencies,z=i.glyphDependencies,R=i.availableImages,j=new Qt(this.zoom,{globalState:this.globalState});for(let{feature:V,id:H,index:se,sourceLayerIndex:te}of t){let re=l._featureFilter.needGeometry,fe=Dr(V,re);if(!l._featureFilter.filter(j,fe,a))continue;let we,Ee;if(re||(fe.geometry=lo(V)),S){let Fe=l.getValueAndResolveTokens("text-field",fe,a,R),je=nn.factory(Fe),Ye=this.hasRTLText=this.hasRTLText||N0(je);(!Ye||Jn.getRTLTextPluginStatus()==="unavailable"||Ye&&Jn.isParsed())&&(we=y0(je,l,fe))}if(I){let Fe=l.getValueAndResolveTokens("icon-image",fe,a,R);Ee=Fe instanceof Sn?Fe:Sn.fromString(Fe)}if(!we&&!Ee)continue;let Ne=this.sortFeaturesByKey?E.evaluate(fe,{},a):void 0;if(this.features.push({id:H,text:we,icon:Ee,index:se,sourceLayerIndex:te,geometry:fe.geometry,properties:V.properties,type:vl.types[V.type],sortKey:Ne}),Ee&&(L[Ee.name]=!0),we){let Fe=f.evaluate(fe,{},a).join(","),je=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_.ao.vertical)>=0;for(let Ye of we.sections)if(Ye.image)L[Ye.image.name]=!0;else{let Oe=ol(we.toString()),Ue=Ye.fontStack||Fe,Se=z[Ue]=z[Ue]||{};this.calculateGlyphDependencies(Ye.text,Se,je,this.allowVerticalPlacement,Oe)}}}d.get("symbol-placement")==="line"&&(this.features=(function(V){let H={},se={},te=[],re=0;function fe(Fe){te.push(V[Fe]),re++}function we(Fe,je,Ye){let Oe=se[Fe];return delete se[Fe],se[je]=Oe,te[Oe].geometry[0].pop(),te[Oe].geometry[0]=te[Oe].geometry[0].concat(Ye[0]),Oe}function Ee(Fe,je,Ye){let Oe=H[je];return delete H[je],H[Fe]=Oe,te[Oe].geometry[0].shift(),te[Oe].geometry[0]=Ye[0].concat(te[Oe].geometry[0]),Oe}function Ne(Fe,je,Ye){let Oe=Ye?je[0][je[0].length-1]:je[0][0];return`${Fe}:${Oe.x}:${Oe.y}`}for(let Fe=0;Fe<V.length;Fe++){let je=V[Fe],Ye=je.geometry,Oe=je.text?je.text.toString():null;if(!Oe){fe(Fe);continue}let Ue=Ne(Oe,Ye),Se=Ne(Oe,Ye,!0);if(Ue in se&&Se in H&&se[Ue]!==H[Se]){let ot=Ee(Ue,Se,Ye),at=we(Ue,Se,te[ot].geometry);delete H[Ue],delete se[Se],se[Ne(Oe,te[at].geometry,!0)]=at,te[ot].geometry=null}else Ue in se?we(Ue,Se,Ye):Se in H?Ee(Ue,Se,Ye):(fe(Fe),H[Ue]=re-1,se[Se]=re-1)}return te.filter(Fe=>Fe.geometry)})(this.features)),this.sortFeaturesByKey&&this.features.sort((V,H)=>V.sortKey-H.sortKey)}update(t,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:a,globalState:this.globalState}),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:a,globalState:this.globalState}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){let a=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(i[t.segment+1]),d=t.dist(i[t.segment]),f={};for(let v=t.segment+1;v<i.length;v++)f[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:l},v<i.length-1&&(l+=i[v+1].dist(i[v]));for(let v=t.segment||0;v>=0;v--)f[v]={x:i[v].x,y:i[v].y,tileUnitDistanceFromAnchor:d},v>0&&(d+=i[v-1].dist(i[v]));for(let v=0;v<i.length;v++){let b=f[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,i,a,l,d,f,v,b,S,I,E,L){let z=t.indexArray,R=t.layoutVertexArray,j=t.segments.prepareSegment(4*i.length,R,z,this.canOverlap?f.sortKey:void 0),V=this.glyphOffsetArray.length,H=j.vertexLength,se=this.allowVerticalPlacement&&v===_.ao.vertical?Math.PI/2:0,te=f.text&&f.text.sections;for(let re=0;re<i.length;re++){let{tl:fe,tr:we,bl:Ee,br:Ne,tex:Fe,pixelOffsetTL:je,pixelOffsetBR:Ye,minFontScaleX:Oe,minFontScaleY:Ue,glyphOffset:Se,isSDF:ot,sectionIndex:at}=i[re],et=j.vertexLength,He=Se[1];wh(R,b.x,b.y,fe.x,He+fe.y,Fe.x,Fe.y,a,ot,je.x,je.y,Oe,Ue),wh(R,b.x,b.y,we.x,He+we.y,Fe.x+Fe.w,Fe.y,a,ot,Ye.x,je.y,Oe,Ue),wh(R,b.x,b.y,Ee.x,He+Ee.y,Fe.x,Fe.y+Fe.h,a,ot,je.x,Ye.y,Oe,Ue),wh(R,b.x,b.y,Ne.x,He+Ne.y,Fe.x+Fe.w,Fe.y+Fe.h,a,ot,Ye.x,Ye.y,Oe,Ue),id(t.dynamicLayoutVertexArray,b,se),z.emplaceBack(et,et+2,et+1),z.emplaceBack(et+1,et+2,et+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Se[0]),re!==i.length-1&&at===i[re+1].sectionIndex||t.programConfigurations.populatePaintArrays(R.length,f,f.index,{imagePositions:{},canonical:L,formattedSection:te&&te[at],globalState:this.globalState})}t.placedSymbolArray.emplaceBack(b.x,b.y,V,this.glyphOffsetArray.length-V,H,S,I,b.segment,a?a[0]:0,a?a[1]:0,l[0],l[1],v,0,!1,0,E)}_addCollisionDebugVertex(t,i,a,l,d,f){return i.emplaceBack(0,0),t.emplaceBack(a.x,a.y,l,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,i,a,l,d,f,v){let b=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),S=b.vertexLength,I=d.layoutVertexArray,E=d.collisionVertexArray,L=v.anchorX,z=v.anchorY;this._addCollisionDebugVertex(I,E,f,L,z,new C(t,i)),this._addCollisionDebugVertex(I,E,f,L,z,new C(a,i)),this._addCollisionDebugVertex(I,E,f,L,z,new C(a,l)),this._addCollisionDebugVertex(I,E,f,L,z,new C(t,l)),b.vertexLength+=4;let R=d.indexArray;R.emplaceBack(S,S+1),R.emplaceBack(S+1,S+2),R.emplaceBack(S+2,S+3),R.emplaceBack(S+3,S),b.primitiveLength+=4}addDebugCollisionBoxes(t,i,a,l){for(let d=t;d<i;d++){let f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,l?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rd(gt,of.members,jt),this.iconCollisionBox=new rd(gt,of.members,jt);for(let t=0;t<this.symbolInstances.length;t++){let i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,a,l,d,f,v,b,S){let I={};for(let E=i;E<a;E++){let L=t.get(E);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let E=l;E<d;E++){let L=t.get(E);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let E=f;E<v;E++){let L=t.get(E);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let E=b;E<S;E++){let L=t.get(E);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){let a=t.placedSymbolArray.get(i),l=a.vertexStartIndex+4*a.numGlyphs;for(let d=a.vertexStartIndex;d<l;d+=4)t.indexArray.emplaceBack(d,d+2,d+1),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(t),a=Math.cos(t),l=[],d=[],f=[];for(let v=0;v<this.symbolInstances.length;++v){f.push(v);let b=this.symbolInstances.get(v);l.push(0|Math.round(i*b.anchorX+a*b.anchorY)),d.push(b.featureIndex)}return f.sort((v,b)=>l[v]-l[b]||d[b]-d[v]),f}addToSortKeyRanges(t,i){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((l,d,f)=>{l>=0&&f.indexOf(l)===d&&this.addIndicesForPlacedSymbol(this.text,l)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vf,xf;Ge("SymbolBucket",wl,{omit:["layers","collisionBoxArray","features","compareText"]}),wl.MAX_GLYPHS=65535,wl.addDynamicAttributes=id;var od={get paint(){return xf=xf||new an({"icon-opacity":new it(pe.paint_symbol["icon-opacity"]),"icon-color":new it(pe.paint_symbol["icon-color"]),"icon-halo-color":new it(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new it(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new it(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new it(pe.paint_symbol["text-opacity"]),"text-color":new it(pe.paint_symbol["text-color"],{runtimeType:Gi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new it(pe.paint_symbol["text-halo-color"]),"text-halo-width":new it(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new it(pe.paint_symbol["text-halo-blur"]),"text-translate":new Ke(pe.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(pe.paint_symbol["text-translate-anchor"])})},get layout(){return vf=vf||new an({"symbol-placement":new Ke(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new it(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ke(pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ke(pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ke(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new it(pe.layout_symbol["icon-size"]),"icon-text-fit":new Ke(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ke(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new it(pe.layout_symbol["icon-image"]),"icon-rotate":new it(pe.layout_symbol["icon-rotate"]),"icon-padding":new it(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new it(pe.layout_symbol["icon-offset"]),"icon-anchor":new it(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(pe.layout_symbol["text-rotation-alignment"]),"text-field":new it(pe.layout_symbol["text-field"]),"text-font":new it(pe.layout_symbol["text-font"]),"text-size":new it(pe.layout_symbol["text-size"]),"text-max-width":new it(pe.layout_symbol["text-max-width"]),"text-line-height":new Ke(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new it(pe.layout_symbol["text-letter-spacing"]),"text-justify":new it(pe.layout_symbol["text-justify"]),"text-radial-offset":new it(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new it(pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new it(pe.layout_symbol["text-anchor"]),"text-max-angle":new Ke(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(pe.layout_symbol["text-writing-mode"]),"text-rotate":new it(pe.layout_symbol["text-rotate"]),"text-padding":new Ke(pe.layout_symbol["text-padding"]),"text-keep-upright":new Ke(pe.layout_symbol["text-keep-upright"]),"text-transform":new it(pe.layout_symbol["text-transform"]),"text-offset":new it(pe.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(pe.layout_symbol["text-allow-overlap"]),"text-overlap":new Ke(pe.layout_symbol["text-overlap"]),"text-ignore-placement":new Ke(pe.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(pe.layout_symbol["text-optional"])})}};class bf{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Qo,this.defaultValue=t}evaluate(t){if(t.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge("FormatSectionOverride",bf,{omit:["defaultValue"]});class Th extends Fn{constructor(t){super(t,od)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let a=this.layout.get("text-writing-mode");if(a){let l=[];for(let d of a)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,a,l){let d=this.layout.get(t).evaluate(i,{},a,l),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||Ys(f.value)||!d?d:(function(v,b){return b.replace(/{([^{}]+)}/g,(S,I)=>v&&I in v?String(v[I]):"")})(i.properties,d)}createBucket(t){return new wl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of od.paint.overridableProperties){if(!Th.hasPaintOverride(this.layout,t))continue;let i=this.paint.get(t),a=new bf(i),l=new wc(a,i.property.specification),d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new is("source",l):new Tc("composite",l,i.value.zoomStops),this.paint._values[t]=new yr(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Th.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){let a=t.get("text-field"),l=od.paint.properties[i],d=!1,f=v=>{for(let b of v)if(l.overrides&&l.overrides.hasOverride(b))return void(d=!0)};if(a.value.kind==="constant"&&a.value.value instanceof nn)f(a.value.value.sections);else if(a.value.kind==="source"){let v=S=>{d||(S instanceof Er&&rt(S.value)===Yr?f(S.value.sections):S instanceof Io?f(S.sections):S.eachChild(v))},b=a.value;b._styleExpression&&v(b._styleExpression.expression)}return d}}let wf;var V0={get paint(){return wf=wf||new an({"background-color":new Ke(pe.paint_background["background-color"]),"background-pattern":new no(pe.paint_background["background-pattern"]),"background-opacity":new Ke(pe.paint_background["background-opacity"])})}};class $0 extends Fn{constructor(t){super(t,V0)}}let Tf;var G0={get paint(){return Tf=Tf||new an({"raster-opacity":new Ke(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ke(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(pe.paint_raster["raster-saturation"]),"raster-contrast":new Ke(pe.paint_raster["raster-contrast"]),"raster-resampling":new Ke(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(pe.paint_raster["raster-fade-duration"])})}};class Z0 extends Fn{constructor(t){super(t,G0)}}class q0 extends Fn{constructor(t){super(t,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class W0{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let H0={once:!0},ad=63710088e-1;class Pa{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pa(Ho(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let i=Math.PI/180,a=this.lat*i,l=t.lat*i,d=Math.sin(a)*Math.sin(l)+Math.cos(a)*Math.cos(l)*Math.cos((t.lng-this.lng)*i);return ad*Math.acos(Math.min(d,1))}static convert(t){if(t instanceof Pa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Pa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Pa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let Sf=2*Math.PI*ad;function If(n){return Sf*Math.cos(n*Math.PI/180)}function Pf(n){return(180+n)/360}function Cf(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Mf(n,t){return n/If(t)}function sd(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Ef(n,t){return n*If(sd(t))}class nu{constructor(t,i,a=0){this.x=+t,this.y=+i,this.z=+a}static fromLngLat(t,i=0){let a=Pa.convert(t);return new nu(Pf(a.lng),Cf(a.lat),Mf(i,a.lat))}toLngLat(){return new Pa(360*this.x-180,sd(this.y))}toAltitude(){return Ef(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Sf*(t=sd(this.y),1/Math.cos(t*Math.PI/180));var t}}function Af(n,t,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class ld{constructor(t,i,a){if(!(function(l,d,f){return!(l<0||l>25||f<0||f>=Math.pow(2,l)||d<0||d>=Math.pow(2,l))})(t,i,a))throw new Error(`x=${i}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=a,this.key=Tl(0,t,t,i,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,a){let l=(f=this.y,v=this.z,b=Af(256*(d=this.x),256*(f=Math.pow(2,v)-f-1),v),S=Af(256*(d+1),256*(f+1),v),b[0]+","+b[1]+","+S[0]+","+S[1]);var d,f,v,b,S;let I=(function(E,L,z){let R,j="";for(let V=E;V>0;V--)R=1<<V-1,j+=(L&R?1:0)+(z&R?2:0);return j})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){let i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){let i=Math.pow(2,this.z);return new C((t.x*i-this.x)*Ot,(t.y*i-this.y)*Ot)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kf{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Tl(t,i.z,i.z,i.x,i.y)}}class ir{constructor(t,i,a,l,d){if(this.terrainRttPosMatrix32f=null,t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=i,this.canonical=new ld(a,+l,+d),this.key=Tl(i,t,a,l,d)}clone(){return new ir(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let i=this.canonical.z-t;return t>this.canonical.z?new ir(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ir(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let a=this.canonical.z-t;return t>this.canonical.z?Tl(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):Tl(this.wrap*+i,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new ir(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,a=2*this.canonical.x,l=2*this.canonical.y;return[new ir(i,this.wrap,i,a,l),new ir(i,this.wrap,i,a+1,l),new ir(i,this.wrap,i,a,l+1),new ir(i,this.wrap,i,a+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ir(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ir(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new nu(t.x-this.wrap,t.y))}}function Tl(n,t,i,a,l){(n*=2)<0&&(n=-1*n-1);let d=1<<i;return(d*d*n+d*l+a).toString(36)+i.toString(36)+t.toString(36)}function ru(n,t){return t?n.properties[t]:n.id}Ge("CanonicalTileID",ld),Ge("OverscaledTileID",ir,{omit:["terrainRttPosMatrix32f"]});class fs{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){let i=new fs;return i.extend(t(new C(this.minX,this.minY))),i.extend(t(new C(this.maxX,this.minY))),i.extend(t(new C(this.minX,this.maxY))),i.extend(t(new C(this.maxX,this.maxY))),i}static fromPoints(t){let i=new fs;for(let a of t)i.extend(a);return i}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Lf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){let a=t[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Df{constructor(t,i,a,l,d){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=a,t._y=l,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class zf{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new cs(Ot,16,0),this.grid3D=new cs(Ot,16,0),this.featureIndexArray=new oe,this.promoteId=i}insert(t,i,a,l,d,f){let v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,l,d);let b=f?this.grid3D:this.grid;for(let S=0;S<i.length;S++){let I=i[S],E=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){let z=I[L];E[0]=Math.min(E[0],z.x),E[1]=Math.min(E[1],z.y),E[2]=Math.max(E[2],z.x),E[3]=Math.max(E[3],z.y)}E[0]<Ot&&E[1]<Ot&&E[2]>=0&&E[3]>=0&&b.insert(v,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Xm(new Yp(this.rawTileData)).layers,this.sourceLayerCoder=new Lf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,a,l){this.loadVTLayers();let d=t.params,f=Ot/t.tileSize/t.scale,v=ko(d.filter),b=t.queryGeometry,S=t.queryPadding*f,I=fs.fromPoints(b),E=this.grid.query(I.minX-S,I.minY-S,I.maxX+S,I.maxY+S),L=fs.fromPoints(t.cameraQueryGeometry).expandBy(S),z=this.grid3D.query(L.minX,L.minY,L.maxX,L.maxY,(V,H,se,te)=>(function(re,fe,we,Ee,Ne){for(let je of re)if(fe<=je.x&&we<=je.y&&Ee>=je.x&&Ne>=je.y)return!0;let Fe=[new C(fe,we),new C(fe,Ne),new C(Ee,Ne),new C(Ee,we)];if(re.length>2){for(let je of Fe)if(fl(re,je))return!0}for(let je=0;je<re.length-1;je++)if(Py(re[je],re[je+1],Fe))return!0;return!1})(t.cameraQueryGeometry,V-S,H-S,se+S,te+S));for(let V of z)E.push(V);E.sort(X0);let R={},j;for(let V=0;V<E.length;V++){let H=E[V];if(H===j)continue;j=H;let se=this.featureIndexArray.get(H),te=null;this.loadMatchingFeature(R,se.bucketIndex,se.sourceLayerIndex,se.featureIndex,v,d.layers,d.availableImages,i,a,l,(re,fe,we)=>(te||(te=lo(re)),fe.queryIntersectsFeature({queryGeometry:b,feature:re,featureState:we,geometry:te,zoom:this.z,transform:t.transform,pixelsToTileUnits:f,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return R}loadMatchingFeature(t,i,a,l,d,f,v,b,S,I,E){let L=this.bucketLayerIDs[i];if(f&&!L.some(V=>f.has(V)))return;let z=this.sourceLayerCoder.decode(a),R=this.vtLayers[z].feature(l);if(d.needGeometry){let V=Dr(R,!0);if(!d.filter(new Qt(this.tileID.overscaledZ),V,this.tileID.canonical))return}else if(!d.filter(new Qt(this.tileID.overscaledZ),R))return;let j=this.getId(R,z);for(let V=0;V<L.length;V++){let H=L[V];if(f&&!f.has(H))continue;let se=b[H];if(!se)continue;let te={};j&&I&&(te=I.getState(se.sourceLayer||"_geojsonTileLayer",j));let re=Dn({},S[H]);re.paint=Rf(re.paint,se.paint,R,te,v),re.layout=Rf(re.layout,se.layout,R,te,v);let fe=!E||E(R,se,te);if(!fe)continue;let we=new Df(R,this.z,this.x,this.y,j);we.layer=re;let Ee=t[H];Ee===void 0&&(Ee=t[H]=[]),Ee.push({featureIndex:l,feature:we,intersectionZ:fe})}}lookupSymbolFeatures(t,i,a,l,d,f,v,b){let S={};this.loadVTLayers();let I=ko(d);for(let E of t)this.loadMatchingFeature(S,a,l,E,I,f,v,b,i);return S}hasLayer(t){for(let i of this.bucketLayerIDs)for(let a of i)if(t===a)return!0;return!1}getId(t,i){var a;let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&(!((a=t.properties)===null||a===void 0)&&a.cluster)&&this.promoteId&&(l=Number(t.properties.cluster_id))),l}}function Rf(n,t,i,a,l){return Xo(n,(d,f)=>{let v=t instanceof sl?t.get(f):null;return v&&v.evaluate?v.evaluate(i,a,l):v})}function X0(n,t){return t-n}function Ff(n,t,i,a,l){let d=[];for(let f=0;f<n.length;f++){let v=n[f],b;for(let S=0;S<v.length-1;S++){let I=v[S],E=v[S+1];I.x<t&&E.x<t||(I.x<t?I=new C(t,I.y+(t-I.x)/(E.x-I.x)*(E.y-I.y))._round():E.x<t&&(E=new C(t,I.y+(t-I.x)/(E.x-I.x)*(E.y-I.y))._round()),I.y<i&&E.y<i||(I.y<i?I=new C(I.x+(i-I.y)/(E.y-I.y)*(E.x-I.x),i)._round():E.y<i&&(E=new C(I.x+(i-I.y)/(E.y-I.y)*(E.x-I.x),i)._round()),I.x>=a&&E.x>=a||(I.x>=a?I=new C(a,I.y+(a-I.x)/(E.x-I.x)*(E.y-I.y))._round():E.x>=a&&(E=new C(a,I.y+(a-I.x)/(E.x-I.x)*(E.y-I.y))._round()),I.y>=l&&E.y>=l||(I.y>=l?I=new C(I.x+(l-I.y)/(E.y-I.y)*(E.x-I.x),l)._round():E.y>=l&&(E=new C(I.x+(l-I.y)/(E.y-I.y)*(E.x-I.x),l)._round()),b&&I.equals(b[b.length-1])||(b=[I],d.push(b)),b.push(E)))))}}return d}Ge("FeatureIndex",zf,{omit:["rawTileData","sourceLayerCoder"]});class Ca extends C{constructor(t,i,a,l){super(t,i),this.angle=a,l!==void 0&&(this.segment=l)}clone(){return new Ca(this.x,this.y,this.angle,this.segment)}}function Bf(n,t,i,a,l){if(t.segment===void 0||i===0)return!0;let d=t,f=t.segment+1,v=0;for(;v>-i/2;){if(f--,f<0)return!1;v-=n[f].dist(d),d=n[f]}v+=n[f].dist(n[f+1]),f++;let b=[],S=0;for(;v<i/2;){let I=n[f],E=n[f+1];if(!E)return!1;let L=n[f-1].angleTo(I)-I.angleTo(E);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:L}),S+=L;v-b[0].distance>a;)S-=b.shift().angleDelta;if(S>l)return!1;f++,v+=I.dist(E)}return!0}function Of(n){let t=0;for(let i=0;i<n.length-1;i++)t+=n[i].dist(n[i+1]);return t}function jf(n,t,i){return n?.6*t*i:0}function Uf(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function K0(n,t,i,a,l,d){let f=jf(i,l,d),v=Uf(i,a)*d,b=0,S=Of(n)/2;for(let I=0;I<n.length-1;I++){let E=n[I],L=n[I+1],z=E.dist(L);if(b+z>S){let R=(S-b)/z,j=gr.number(E.x,L.x,R),V=gr.number(E.y,L.y,R),H=new Ca(j,V,L.angleTo(E),I);return H._round(),!f||Bf(n,H,v,f,t)?H:void 0}b+=z}}function Y0(n,t,i,a,l,d,f,v,b){let S=jf(a,d,f),I=Uf(a,l),E=I*f,L=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return t-E<t/4&&(t=E+t/4),Nf(n,L?t/2*v%t:(I/2+2*d)*f*v%t,t,S,i,E,L,!1,b)}function Nf(n,t,i,a,l,d,f,v,b){let S=d/2,I=Of(n),E=0,L=t-i,z=[];for(let R=0;R<n.length-1;R++){let j=n[R],V=n[R+1],H=j.dist(V),se=V.angleTo(j);for(;L+i<E+H;){L+=i;let te=(L-E)/H,re=gr.number(j.x,V.x,te),fe=gr.number(j.y,V.y,te);if(re>=0&&re<b&&fe>=0&&fe<b&&L-S>=0&&L+S<=I){let we=new Ca(re,fe,se,R);we._round(),a&&!Bf(n,we,d,a,l)||z.push(we)}}E+=H}return v||z.length||f||(z=Nf(n,E/2,i,a,l,d,f,!0,b)),z}function Vf(n,t,i,a){let l=[],d=n.image,f=d.pixelRatio,v=d.paddedRect.w-2,b=d.paddedRect.h-2,S={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom},I=d.stretchX||[[0,v]],E=d.stretchY||[[0,b]],L=(Se,ot)=>Se+ot[1]-ot[0],z=I.reduce(L,0),R=E.reduce(L,0),j=v-z,V=b-R,H=0,se=z,te=0,re=R,fe=0,we=j,Ee=0,Ne=V;if(d.content&&a){let Se=d.content,ot=Se[2]-Se[0],at=Se[3]-Se[1];(d.textFitWidth||d.textFitHeight)&&(S=gf(n)),H=Sh(I,0,Se[0]),te=Sh(E,0,Se[1]),se=Sh(I,Se[0],Se[2]),re=Sh(E,Se[1],Se[3]),fe=Se[0]-H,Ee=Se[1]-te,we=ot-se,Ne=at-re}let Fe=S.x1,je=S.y1,Ye=S.x2-Fe,Oe=S.y2-je,Ue=(Se,ot,at,et)=>{let He=Ih(Se.stretch-H,se,Ye,Fe),Mt=Ph(Se.fixed-fe,we,Se.stretch,z),ui=Ih(ot.stretch-te,re,Oe,je),Ai=Ph(ot.fixed-Ee,Ne,ot.stretch,R),en=Ih(at.stretch-H,se,Ye,Fe),nr=Ph(at.fixed-fe,we,at.stretch,z),Mn=Ih(et.stretch-te,re,Oe,je),qi=Ph(et.fixed-Ee,Ne,et.stretch,R),ri=new C(He,ui),Oi=new C(en,ui),Wi=new C(en,Mn),Hi=new C(He,Mn),xn=new C(Mt/f,Ai/f),rr=new C(nr/f,qi/f),ji=t*Math.PI/180;if(ji){let Ui=Math.sin(ji),Ni=Math.cos(ji),Si=[Ni,-Ui,Ui,Ni];ri._matMult(Si),Oi._matMult(Si),Hi._matMult(Si),Wi._matMult(Si)}let En=Se.stretch+Se.fixed,ki=ot.stretch+ot.fixed;return{tl:ri,tr:Oi,bl:Hi,br:Wi,tex:{x:d.paddedRect.x+1+En,y:d.paddedRect.y+1+ki,w:at.stretch+at.fixed-En,h:et.stretch+et.fixed-ki},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xn,pixelOffsetBR:rr,minFontScaleX:we/f/Ye,minFontScaleY:Ne/f/Oe,isSDF:i}};if(a&&(d.stretchX||d.stretchY)){let Se=$f(I,j,z),ot=$f(E,V,R);for(let at=0;at<Se.length-1;at++){let et=Se[at],He=Se[at+1];for(let Mt=0;Mt<ot.length-1;Mt++)l.push(Ue(et,ot[Mt],He,ot[Mt+1]))}}else l.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return l}function Sh(n,t,i){let a=0;for(let l of n)a+=Math.max(t,Math.min(i,l[1]))-Math.max(t,Math.min(i,l[0]));return a}function $f(n,t,i){let a=[{fixed:-1,stretch:0}];for(let[l,d]of n){let f=a[a.length-1];a.push({fixed:l-f.stretch,stretch:f.stretch}),a.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return a.push({fixed:t+1,stretch:i}),a}function Ih(n,t,i,a){return n/t*i+a}function Ph(n,t,i,a){return n-t*i/a}Ge("Anchor",Ca);class Ch{constructor(t,i,a,l,d,f,v,b,S,I){var E;if(this.boxStartIndex=t.length,S){let L=f.top,z=f.bottom,R=f.collisionPadding;R&&(L-=R[1],z+=R[3]);let j=z-L;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let L=!((E=f.image)===null||E===void 0)&&E.content&&(f.image.textFitWidth||f.image.textFitHeight)?gf(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};L.y1=L.y1*v-b[0],L.y2=L.y2*v+b[2],L.x1=L.x1*v-b[3],L.x2=L.x2*v+b[1];let z=f.collisionPadding;if(z&&(L.x1-=z[0]*v,L.y1-=z[1]*v,L.x2+=z[2]*v,L.y2+=z[3]*v),I){let R=new C(L.x1,L.y1),j=new C(L.x2,L.y1),V=new C(L.x1,L.y2),H=new C(L.x2,L.y2),se=I*Math.PI/180;R._rotate(se),j._rotate(se),V._rotate(se),H._rotate(se),L.x1=Math.min(R.x,j.x,V.x,H.x),L.x2=Math.max(R.x,j.x,V.x,H.x),L.y1=Math.min(R.y,j.y,V.y,H.y),L.y2=Math.max(R.y,j.y,V.y,H.y)}t.emplaceBack(i.x,i.y,L.x1,L.y1,L.x2,L.y2,a,l,d)}this.boxEndIndex=t.length}}class J0{constructor(t=[],i=(a,l)=>a<l?-1:a>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:i,compare:a}=this,l=i[t];for(;t>0;){let d=t-1>>1,f=i[d];if(a(l,f)>=0)break;i[t]=f,t=d}i[t]=l}_down(t){let{data:i,compare:a}=this,l=this.length>>1,d=i[t];for(;t<l;){let f=1+(t<<1),v=f+1;if(v<this.length&&a(i[v],i[f])<0&&(f=v),a(i[f],d)>=0)break;i[t]=i[f],t=f}i[t]=d}}function Q0(n,t=1,i=!1){let a=fs.fromPoints(n[0]),l=Math.min(a.width(),a.height()),d=l/2,f=new J0([],ev),{minX:v,minY:b,maxX:S,maxY:I}=a;if(l===0)return new C(v,b);for(let z=v;z<S;z+=l)for(let R=b;R<I;R+=l)f.push(new Sl(z+d,R+d,d,n));let E=(function(z){let R=0,j=0,V=0,H=z[0];for(let se=0,te=H.length,re=te-1;se<te;re=se++){let fe=H[se],we=H[re],Ee=fe.x*we.y-we.x*fe.y;j+=(fe.x+we.x)*Ee,V+=(fe.y+we.y)*Ee,R+=3*Ee}return new Sl(j/R,V/R,0,z)})(n),L=f.length;for(;f.length;){let z=f.pop();(z.d>E.d||!E.d)&&(E=z,i&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,L)),z.max-E.d<=t||(d=z.h/2,f.push(new Sl(z.p.x-d,z.p.y-d,d,n)),f.push(new Sl(z.p.x+d,z.p.y-d,d,n)),f.push(new Sl(z.p.x-d,z.p.y+d,d,n)),f.push(new Sl(z.p.x+d,z.p.y+d,d,n)),L+=4)}return i&&(console.log(`num probes: ${L}`),console.log(`best distance: ${E.d}`)),E.p}function ev(n,t){return t.max-n.max}function Sl(n,t,i,a){this.p=new C(n,t),this.h=i,this.d=(function(l,d){let f=!1,v=1/0;for(let b=0;b<d.length;b++){let S=d[b];for(let I=0,E=S.length,L=E-1;I<E;L=I++){let z=S[I],R=S[L];z.y>l.y!=R.y>l.y&&l.x<(R.x-z.x)*(l.y-z.y)/(R.y-z.y)+z.x&&(f=!f),v=Math.min(v,Pm(l,z,R))}}return(f?1:-1)*Math.sqrt(v)})(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Qi;_.aE=void 0,(Qi=_.aE||(_.aE={}))[Qi.center=1]="center",Qi[Qi.left=2]="left",Qi[Qi.right=3]="right",Qi[Qi.top=4]="top",Qi[Qi.bottom=5]="bottom",Qi[Qi["top-left"]=6]="top-left",Qi[Qi["top-right"]=7]="top-right",Qi[Qi["bottom-left"]=8]="bottom-left",Qi[Qi["bottom-right"]=9]="bottom-right";let cd=Number.POSITIVE_INFINITY;function Gf(n,t){return t[1]!==cd?(function(i,a,l){let d=0,f=0;switch(a=Math.abs(a),l=Math.abs(l),i){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(i){case"top-right":case"bottom-right":case"right":d=-a;break;case"top-left":case"bottom-left":case"left":d=a}return[d,f]})(n,t[0],t[1]):(function(i,a){let l=0,d=0;a<0&&(a=0);let f=a/Math.SQRT2;switch(i){case"top-right":case"top-left":d=f-7;break;case"bottom-right":case"bottom-left":d=7-f;break;case"bottom":d=7-a;break;case"top":d=a-7}switch(i){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=a;break;case"right":l=-a}return[l,d]})(n,t[0])}function Zf(n,t,i){var a;let l=n.layout,d=(a=l.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},i);if(d){let v=d.values,b=[];for(let S=0;S<v.length;S+=2){let I=b[S]=v[S],E=v[S+1].map(L=>L*Bi);I.startsWith("top")?E[1]-=7:I.startsWith("bottom")&&(E[1]+=7),b[S+1]=E}return new on(b)}let f=l.get("text-variable-anchor");if(f){let v;v=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},i)*Bi,cd]:l.get("text-offset").evaluate(t,{},i).map(S=>S*Bi);let b=[];for(let S of f)b.push(S,Gf(S,v));return new on(b)}return null}function ud(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tv(n,t,i,a,l,d,f,v,b,S,I,E){let L=d.textMaxSize.evaluate(t,{});L===void 0&&(L=f);let z=n.layers[0].layout,R=z.get("icon-offset").evaluate(t,{},I),j=Wf(i.horizontal),V=f/24,H=n.tilePixelRatio*V,se=n.tilePixelRatio*L/24,te=n.tilePixelRatio*v,re=n.tilePixelRatio*z.get("symbol-spacing"),fe=z.get("text-padding")*n.tilePixelRatio,we=(function(at,et,He,Mt=1){let ui=at.get("icon-padding").evaluate(et,{},He),Ai=ui&&ui.values;return[Ai[0]*Mt,Ai[1]*Mt,Ai[2]*Mt,Ai[3]*Mt]})(z,t,I,n.tilePixelRatio),Ee=z.get("text-max-angle")/180*Math.PI,Ne=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",Fe=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",je=z.get("symbol-placement"),Ye=re/2,Oe=z.get("icon-text-fit"),Ue;a&&Oe!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Ue=_f(a,i.vertical,Oe,z.get("icon-text-fit-padding"),R,V)),j&&(a=_f(a,j,Oe,z.get("icon-text-fit-padding"),R,V)));let Se=I?E.line.getGranularityForZoomLevel(I.z):1,ot=(at,et)=>{et.x<0||et.x>=Ot||et.y<0||et.y>=Ot||(function(He,Mt,ui,Ai,en,nr,Mn,qi,ri,Oi,Wi,Hi,xn,rr,ji,En,ki,Ui,Ni,Si,ti,zr,Il,Rr,rv){let Pl=He.addToLineVertexArray(Mt,ui),gs,Cl,Ml,El,Yf=0,Jf=0,Qf=0,eg=0,yd=-1,vd=-1,Uo={},tg=wa("");if(He.allowVerticalPlacement&&Ai.vertical){let cn=qi.layout.get("text-rotate").evaluate(ti,{},Rr)+90;Ml=new Ch(ri,Mt,Oi,Wi,Hi,Ai.vertical,xn,rr,ji,cn),Mn&&(El=new Ch(ri,Mt,Oi,Wi,Hi,Mn,ki,Ui,ji,cn))}if(en){let cn=qi.layout.get("icon-rotate").evaluate(ti,{}),or=qi.layout.get("icon-text-fit")!=="none",_s=Vf(en,cn,Il,or),Br=Mn?Vf(Mn,cn,Il,or):void 0;Cl=new Ch(ri,Mt,Oi,Wi,Hi,en,ki,Ui,!1,cn),Yf=4*_s.length;let ys=He.iconSizeData,co=null;ys.kind==="source"?(co=[jo*qi.layout.get("icon-size").evaluate(ti,{})],co[0]>Ia&&fi(`${He.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ys.kind==="composite"&&(co=[jo*zr.compositeIconSizes[0].evaluate(ti,{},Rr),jo*zr.compositeIconSizes[1].evaluate(ti,{},Rr)],(co[0]>Ia||co[1]>Ia)&&fi(`${He.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),He.addSymbols(He.icon,_s,co,Si,Ni,ti,_.ao.none,Mt,Pl.lineStartIndex,Pl.lineLength,-1,Rr),yd=He.icon.placedSymbolArray.length-1,Br&&(Jf=4*Br.length,He.addSymbols(He.icon,Br,co,Si,Ni,ti,_.ao.vertical,Mt,Pl.lineStartIndex,Pl.lineLength,-1,Rr),vd=He.icon.placedSymbolArray.length-1)}let ig=Object.keys(Ai.horizontal);for(let cn of ig){let or=Ai.horizontal[cn];if(!gs){tg=wa(or.text);let Br=qi.layout.get("text-rotate").evaluate(ti,{},Rr);gs=new Ch(ri,Mt,Oi,Wi,Hi,or,xn,rr,ji,Br)}let _s=or.positionedLines.length===1;if(Qf+=qf(He,Mt,or,nr,qi,ji,ti,En,Pl,Ai.vertical?_.ao.horizontal:_.ao.horizontalOnly,_s?ig:[cn],Uo,yd,zr,Rr),_s)break}Ai.vertical&&(eg+=qf(He,Mt,Ai.vertical,nr,qi,ji,ti,En,Pl,_.ao.vertical,["vertical"],Uo,vd,zr,Rr));let ov=gs?gs.boxStartIndex:He.collisionBoxArray.length,av=gs?gs.boxEndIndex:He.collisionBoxArray.length,sv=Ml?Ml.boxStartIndex:He.collisionBoxArray.length,lv=Ml?Ml.boxEndIndex:He.collisionBoxArray.length,cv=Cl?Cl.boxStartIndex:He.collisionBoxArray.length,uv=Cl?Cl.boxEndIndex:He.collisionBoxArray.length,hv=El?El.boxStartIndex:He.collisionBoxArray.length,pv=El?El.boxEndIndex:He.collisionBoxArray.length,Fr=-1,Eh=(cn,or)=>cn&&cn.circleDiameter?Math.max(cn.circleDiameter,or):or;Fr=Eh(gs,Fr),Fr=Eh(Ml,Fr),Fr=Eh(Cl,Fr),Fr=Eh(El,Fr);let ng=Fr>-1?1:0;ng&&(Fr*=rv/Bi),He.glyphOffsetArray.length>=wl.MAX_GLYPHS&&fi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ti.sortKey!==void 0&&He.addToSortKeyRanges(He.symbolInstances.length,ti.sortKey);let dv=Zf(qi,ti,Rr),[mv,fv]=(function(cn,or){let _s=cn.length,Br=or?.values;if(Br?.length>0)for(let ys=0;ys<Br.length;ys+=2){let co=Br[ys+1];cn.emplaceBack(_.aE[Br[ys]],co[0],co[1])}return[_s,cn.length]})(He.textAnchorOffsets,dv);He.symbolInstances.emplaceBack(Mt.x,Mt.y,Uo.right>=0?Uo.right:-1,Uo.center>=0?Uo.center:-1,Uo.left>=0?Uo.left:-1,Uo.vertical||-1,yd,vd,tg,ov,av,sv,lv,cv,uv,hv,pv,Oi,Qf,eg,Yf,Jf,ng,0,xn,Fr,mv,fv)})(n,et,at,i,a,l,Ue,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,H,[fe,fe,fe,fe],Ne,b,te,we,Fe,R,t,d,S,I,f)};if(je==="line")for(let at of Ff(t.geometry,0,0,Ot,Ot)){let et=ms(at,Se),He=Y0(et,re,Ee,i.vertical||j,a,24,se,n.overscaling,Ot);for(let Mt of He)j&&iv(n,j.text,Ye,Mt)||ot(et,Mt)}else if(je==="line-center"){for(let at of t.geometry)if(at.length>1){let et=ms(at,Se),He=K0(et,Ee,i.vertical||j,a,24,se);He&&ot(et,He)}}else if(t.type==="Polygon")for(let at of Ya(t.geometry,0)){let et=Q0(at,16);ot(ms(at[0],Se,!0),new Ca(et.x,et.y,0))}else if(t.type==="LineString")for(let at of t.geometry){let et=ms(at,Se);ot(et,new Ca(et[0].x,et[0].y,0))}else if(t.type==="Point")for(let at of t.geometry)for(let et of at)ot([et],new Ca(et.x,et.y,0))}function qf(n,t,i,a,l,d,f,v,b,S,I,E,L,z,R){let j=(function(se,te,re,fe,we,Ee,Ne,Fe){let je=fe.layout.get("text-rotate").evaluate(Ee,{})*Math.PI/180,Ye=[];for(let Oe of te.positionedLines)for(let Ue of Oe.positionedGlyphs){if(!Ue.rect)continue;let Se=Ue.rect||{},ot=4,at=!0,et=1,He=0,Mt=(we||Fe)&&Ue.vertical,ui=Ue.metrics.advance*Ue.scale/2;if(Fe&&te.verticalizable&&(He=Oe.lineOffset/2-(Ue.imageName?-(Bi-Ue.metrics.width*Ue.scale)/2:(Ue.scale-1)*Bi)),Ue.imageName){let Ui=Ne[Ue.imageName];at=Ui.sdf,et=Ui.pixelRatio,ot=1/et}let Ai=we?[Ue.x+ui,Ue.y]:[0,0],en=we?[0,0]:[Ue.x+ui+re[0],Ue.y+re[1]-He],nr=[0,0];Mt&&(nr=en,en=[0,0]);let Mn=Ue.metrics.isDoubleResolution?2:1,qi=(Ue.metrics.left-ot)*Ue.scale-ui+en[0],ri=(-Ue.metrics.top-ot)*Ue.scale+en[1],Oi=qi+Se.w/Mn*Ue.scale/et,Wi=ri+Se.h/Mn*Ue.scale/et,Hi=new C(qi,ri),xn=new C(Oi,ri),rr=new C(qi,Wi),ji=new C(Oi,Wi);if(Mt){let Ui=new C(-ui,ui- -17),Ni=-Math.PI/2,Si=12-ui,ti=new C(22-Si,-(Ue.imageName?Si:0)),zr=new C(...nr);Hi._rotateAround(Ni,Ui)._add(ti)._add(zr),xn._rotateAround(Ni,Ui)._add(ti)._add(zr),rr._rotateAround(Ni,Ui)._add(ti)._add(zr),ji._rotateAround(Ni,Ui)._add(ti)._add(zr)}if(je){let Ui=Math.sin(je),Ni=Math.cos(je),Si=[Ni,-Ui,Ui,Ni];Hi._matMult(Si),xn._matMult(Si),rr._matMult(Si),ji._matMult(Si)}let En=new C(0,0),ki=new C(0,0);Ye.push({tl:Hi,tr:xn,bl:rr,br:ji,tex:Se,writingMode:te.writingMode,glyphOffset:Ai,sectionIndex:Ue.sectionIndex,isSDF:at,pixelOffsetTL:En,pixelOffsetBR:ki,minFontScaleX:0,minFontScaleY:0})}return Ye})(0,i,v,l,d,f,a,n.allowVerticalPlacement),V=n.textSizeData,H=null;V.kind==="source"?(H=[jo*l.layout.get("text-size").evaluate(f,{})],H[0]>Ia&&fi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):V.kind==="composite"&&(H=[jo*z.compositeTextSizes[0].evaluate(f,{},R),jo*z.compositeTextSizes[1].evaluate(f,{},R)],(H[0]>Ia||H[1]>Ia)&&fi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,j,H,v,d,f,S,t,b.lineStartIndex,b.lineLength,L,R);for(let se of I)E[se]=n.text.placedSymbolArray.length-1;return 4*j.length}function Wf(n){for(let t in n)return n[t];return null}function iv(n,t,i,a){let l=n.compareText;if(t in l){let d=l[t];for(let f=d.length-1;f>=0;f--)if(a.dist(d[f])<i)return!0}else l[t]=[];return l[t].push(a),!1}let Hf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,a]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=a>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let d=Hf[15&a];if(!d)throw new Error("Unrecognized array type.");let[f]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new hd(v,f,d,t)}constructor(t,i=64,a=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let d=Hf.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${a}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=i,a}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return pd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,a,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:f,nodeSize:v}=this,b=[0,d.length-1,0],S=[];for(;b.length;){let I=b.pop()||0,E=b.pop()||0,L=b.pop()||0;if(E-L<=v){for(let V=L;V<=E;V++){let H=f[2*V],se=f[2*V+1];H>=t&&H<=a&&se>=i&&se<=l&&S.push(d[V])}continue}let z=L+E>>1,R=f[2*z],j=f[2*z+1];R>=t&&R<=a&&j>=i&&j<=l&&S.push(d[z]),(I===0?t<=R:i<=j)&&(b.push(L),b.push(z-1),b.push(1-I)),(I===0?a>=R:l>=j)&&(b.push(z+1),b.push(E),b.push(1-I))}return S}within(t,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:d,nodeSize:f}=this,v=[0,l.length-1,0],b=[],S=a*a;for(;v.length;){let I=v.pop()||0,E=v.pop()||0,L=v.pop()||0;if(E-L<=f){for(let V=L;V<=E;V++)Kf(d[2*V],d[2*V+1],t,i)<=S&&b.push(l[V]);continue}let z=L+E>>1,R=d[2*z],j=d[2*z+1];Kf(R,j,t,i)<=S&&b.push(l[z]),(I===0?t-a<=R:i-a<=j)&&(v.push(L),v.push(z-1),v.push(1-I)),(I===0?t+a>=R:i+a>=j)&&(v.push(z+1),v.push(E),v.push(1-I))}return b}}function pd(n,t,i,a,l,d){if(l-a<=i)return;let f=a+l>>1;Xf(n,t,f,a,l,d),pd(n,t,i,a,f-1,1-d),pd(n,t,i,f+1,l,1-d)}function Xf(n,t,i,a,l,d){for(;l>a;){if(l-a>600){let S=l-a+1,I=i-a+1,E=Math.log(S),L=.5*Math.exp(2*E/3),z=.5*Math.sqrt(E*L*(S-L)/S)*(I-S/2<0?-1:1);Xf(n,t,i,Math.max(a,Math.floor(i-I*L/S+z)),Math.min(l,Math.floor(i+(S-I)*L/S+z)),d)}let f=t[2*i+d],v=a,b=l;for(ou(n,t,a,i),t[2*l+d]>f&&ou(n,t,a,l);v<b;){for(ou(n,t,v,b),v++,b--;t[2*v+d]<f;)v++;for(;t[2*b+d]>f;)b--}t[2*a+d]===f?ou(n,t,a,b):(b++,ou(n,t,b,l)),b<=i&&(a=b+1),i<=b&&(l=b-1)}}function ou(n,t,i,a){dd(n,i,a),dd(t,2*i,2*a),dd(t,2*i+1,2*a+1)}function dd(n,t,i){let a=n[t];n[t]=n[i],n[i]=a}function Kf(n,t,i,a){let l=n-i,d=t-a;return l*l+d*d}var md;_.cx=void 0,(md=_.cx||(_.cx={})).create="create",md.load="load",md.fullLoad="fullLoad";let Mh=null,au=[],fd=1e3/60,gd="loadTime",_d="fullLoadTime",nv={mark(n){performance.mark(n)},frame(n){let t=n;Mh!=null&&au.push(t-Mh),Mh=t},clearMetrics(){Mh=null,au=[],performance.clearMeasures(gd),performance.clearMeasures(_d);for(let n in _.cx)performance.clearMarks(_.cx[n])},getPerformanceMetrics(){performance.measure(gd,_.cx.create,_.cx.load),performance.measure(_d,_.cx.create,_.cx.fullLoad);let n=performance.getEntriesByName(gd)[0].duration,t=performance.getEntriesByName(_d)[0].duration,i=au.length,a=1/(au.reduce((d,f)=>d+f,0)/i/1e3),l=au.filter(d=>d>fd).reduce((d,f)=>d+(f-fd)/fd,0);return{loadTime:n,fullLoadTime:t,fps:a,percentDroppedFrames:l/(i+l)*100,totalFrames:i}}};_.$=Ot,_.A=Qe,_.B=function([n,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(i),y:n*Math.sin(t)*Math.sin(i),z:n*Math.cos(i)}},_.C=gr,_.D=Ke,_.E=Xe,_.F=Qt,_.G=ss,_.H=function(n){if(_o==null){let t=n.navigator?n.navigator.userAgent:null;_o=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return _o},_.I=Jp,_.J=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new W0(()=>this.process()),this.subscription=Zr(this.target,"message",i=>this.receive(i),!1),this.globalScope=ur(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((i,a)=>{let l=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=t?Zr(t.signal,"abort",()=>{d?.unsubscribe(),delete this.resolveRejects[l];let b={id:l,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)},H0):null;this.resolveRejects[l]={resolve:b=>{d?.unsubscribe(),i(b)},reject:b=>{d?.unsubscribe(),a(b)}};let f=[],v=Object.assign(Object.assign({},n),{id:l,sourceMapId:this.mapId,origin:location.origin,data:ga(n.data,f)});this.target.postMessage(v,{transfer:f})})}receive(n){let t=n.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];let a=this.abortControllers[i];return delete this.abortControllers[i],void(a&&a.abort())}if(ur(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;let n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return o(this,void 0,void 0,function*(){if(t.type==="<response>"){let l=this.resolveRejects[n];return delete this.resolveRejects[n],l?void(t.error?l.reject(zo(t.error)):l.resolve(zo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let i=zo(t.data),a=new AbortController;this.abortControllers[n]=a;try{let l=yield this.messageHandlers[t.type](t.sourceMapId,i,a);this.completeTask(n,null,l)}catch(l){this.completeTask(n,l)}})}completeTask(n,t,i){let a=[];delete this.abortControllers[n];let l={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ga(t):null,data:ga(i,a)};this.target.postMessage(l,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},_.K=N,_.L=function(){var n=new Qe(16);return Qe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},_.M=function(n,t,i){var a,l,d,f,v,b,S,I,E,L,z,R,j=i[0],V=i[1],H=i[2];return t===n?(n[12]=t[0]*j+t[4]*V+t[8]*H+t[12],n[13]=t[1]*j+t[5]*V+t[9]*H+t[13],n[14]=t[2]*j+t[6]*V+t[10]*H+t[14],n[15]=t[3]*j+t[7]*V+t[11]*H+t[15]):(l=t[1],d=t[2],f=t[3],v=t[4],b=t[5],S=t[6],I=t[7],E=t[8],L=t[9],z=t[10],R=t[11],n[0]=a=t[0],n[1]=l,n[2]=d,n[3]=f,n[4]=v,n[5]=b,n[6]=S,n[7]=I,n[8]=E,n[9]=L,n[10]=z,n[11]=R,n[12]=a*j+v*V+E*H+t[12],n[13]=l*j+b*V+L*H+t[13],n[14]=d*j+S*V+z*H+t[14],n[15]=f*j+I*V+R*H+t[15]),n},_.N=function(n,t,i){var a=i[0],l=i[1],d=i[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*l,n[5]=t[5]*l,n[6]=t[6]*l,n[7]=t[7]*l,n[8]=t[8]*d,n[9]=t[9]*d,n[10]=t[10]*d,n[11]=t[11]*d,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},_.O=function(n,t,i){var a=t[0],l=t[1],d=t[2],f=t[3],v=t[4],b=t[5],S=t[6],I=t[7],E=t[8],L=t[9],z=t[10],R=t[11],j=t[12],V=t[13],H=t[14],se=t[15],te=i[0],re=i[1],fe=i[2],we=i[3];return n[0]=te*a+re*v+fe*E+we*j,n[1]=te*l+re*b+fe*L+we*V,n[2]=te*d+re*S+fe*z+we*H,n[3]=te*f+re*I+fe*R+we*se,n[4]=(te=i[4])*a+(re=i[5])*v+(fe=i[6])*E+(we=i[7])*j,n[5]=te*l+re*b+fe*L+we*V,n[6]=te*d+re*S+fe*z+we*H,n[7]=te*f+re*I+fe*R+we*se,n[8]=(te=i[8])*a+(re=i[9])*v+(fe=i[10])*E+(we=i[11])*j,n[9]=te*l+re*b+fe*L+we*V,n[10]=te*d+re*S+fe*z+we*H,n[11]=te*f+re*I+fe*R+we*se,n[12]=(te=i[12])*a+(re=i[13])*v+(fe=i[14])*E+(we=i[15])*j,n[13]=te*l+re*b+fe*L+we*V,n[14]=te*d+re*S+fe*z+we*H,n[15]=te*f+re*I+fe*R+we*se,n},_.P=C,_.Q=function(n,t){let i={};for(let a=0;a<t.length;a++){let l=t[a];l in n&&(i[l]=n[l])}return i},_.R=Cn,_.S=Pa,_.T=Np,_.U=Cf,_.V=Pf,_.W=Ae,_.X=De,_.Y=Yo,_.Z=ir,_._=o,_.a=O,_.a$=Vn,_.a0=function(n,t){var i,a,l,d;if(!n)return t??{};if(!t)return n;let f=Object.assign({},n);if(t.removeAll&&(f.removeAll=!0),t.remove){let v=new Set(f.remove?f.remove.concat(t.remove):t.remove);f.remove=Array.from(v.values())}if(t.add){let v=f.add?f.add.concat(t.add):t.add,b=new Map(v.map(S=>[S.id,S]));f.add=Array.from(b.values())}if(t.update){let v=new Map((i=f.update)===null||i===void 0?void 0:i.map(b=>[b.id,b]));for(let b of t.update){let S=(a=v.get(b.id))!==null&&a!==void 0?a:{id:b.id};b.newGeometry&&(S.newGeometry=b.newGeometry),b.addOrUpdateProperties&&(S.addOrUpdateProperties=((l=S.addOrUpdateProperties)!==null&&l!==void 0?l:[]).concat(b.addOrUpdateProperties)),b.removeProperties&&(S.removeProperties=((d=S.removeProperties)!==null&&d!==void 0?d:[]).concat(b.removeProperties)),b.removeAllProperties&&(S.removeAllProperties=!0),v.set(b.id,S)}f.update=Array.from(v.values())}return f},_.a1=nu,_.a2=fs,_.a3=25,_.a4=ld,_.a5=n=>{let t=window.document.createElement("video");return t.muted=!0,new Promise(i=>{t.onloadstart=()=>{i(t)};for(let a of n){let l=window.document.createElement("source");_e(a)||(t.crossOrigin="Anonymous"),l.src=a,t.appendChild(l)}})},_.a6=Re,_.a7=function(){return $n++},_.a8=A,_.a9=wl,_.aA=function(n){let t=1/0,i=1/0,a=-1/0,l=-1/0;for(let d of n)t=Math.min(t,d.x),i=Math.min(i,d.y),a=Math.max(a,d.x),l=Math.max(l,d.y);return[t,i,a,l]},_.aB=Bi,_.aC=Nr,_.aD=function(n,t,i,a,l=!1){if(!i[0]&&!i[1])return[0,0];let d=l?a==="map"?-n.bearingInRadians:0:a==="viewport"?n.bearingInRadians:0;if(d){let f=Math.sin(d),v=Math.cos(d);i=[i[0]*v-i[1]*f,i[0]*f+i[1]*v]}return[l?i[0]:Nr(t,i[0],n.zoom),l?i[1]:Nr(t,i[1],n.zoom)]},_.aF=td,_.aG=ud,_.aH=ed,_.aI=hd,_.aJ=mi,_.aK=yh,_.aL=J,_.aM=dt,_.aN=Vt,_.aO=Ho,_.aP=qr,_.aQ=Ef,_.aR=Ii,_.aS=pn,_.aT=function(n){var t=new Qe(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},_.aU=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],n},_.aV=function(n,t){var i=t[0],a=t[1],l=t[2],d=i*i+a*a+l*l;return d>0&&(d=1/Math.sqrt(d)),n[0]=t[0]*d,n[1]=t[1]*d,n[2]=t[2]*d,n},_.aW=On,_.aX=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},_.aY=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n[2]=t[2]*i[2],n[3]=t[3]*i[3],n},_.aZ=At,_.a_=function(n,t,i){let a=t[0]*i[0]+t[1]*i[1]+t[2]*i[2];return a===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/a},_.aa=ko,_.ab=Dr,_.ac=Df,_.ad=function(n){let t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,l,d)=>{let f=l||d;return t[a]=!f||f.toLowerCase(),""}),t["max-age"]){let i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},_.ae=yo,_.af=function(n){return Math.pow(2,n)},_.ag=vt,_.ah=fn,_.ai=85.051129,_.aj=Mf,_.ak=function(n){return Math.log(n)/Math.LN2},_.al=function(n){var t=n[0],i=n[1];return t*t+i*i},_.am=function(n,t){let i=[];for(let a in n)a in t||i.push(a);return i},_.an=function(n,t){let i=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){let{interpolationType:l,minZoom:d,maxZoom:f}=n,v=l?fn(Zi.interpolationFactor(l,t,d,f),0,1):0;n.kind==="camera"?a=gr.number(n.minSize,n.maxSize,v):i=v}return{uSizeT:i,uSize:a}},_.ap=function(n,{uSize:t,uSizeT:i},{lowerSize:a,upperSize:l}){return n.kind==="source"?a/jo:n.kind==="composite"?gr.number(a/jo,l/jo,i):t},_.aq=function(n,t){var i=t[0],a=t[1],l=t[2],d=t[3],f=t[4],v=t[5],b=t[6],S=t[7],I=t[8],E=t[9],L=t[10],z=t[11],R=t[12],j=t[13],V=t[14],H=t[15],se=i*v-a*f,te=i*b-l*f,re=i*S-d*f,fe=a*b-l*v,we=a*S-d*v,Ee=l*S-d*b,Ne=I*j-E*R,Fe=I*V-L*R,je=I*H-z*R,Ye=E*V-L*j,Oe=E*H-z*j,Ue=L*H-z*V,Se=se*Ue-te*Oe+re*Ye+fe*je-we*Fe+Ee*Ne;return Se?(n[0]=(v*Ue-b*Oe+S*Ye)*(Se=1/Se),n[1]=(l*Oe-a*Ue-d*Ye)*Se,n[2]=(j*Ee-V*we+H*fe)*Se,n[3]=(L*we-E*Ee-z*fe)*Se,n[4]=(b*je-f*Ue-S*Fe)*Se,n[5]=(i*Ue-l*je+d*Fe)*Se,n[6]=(V*re-R*Ee-H*te)*Se,n[7]=(I*Ee-L*re+z*te)*Se,n[8]=(f*Oe-v*je+S*Ne)*Se,n[9]=(a*je-i*Oe-d*Ne)*Se,n[10]=(R*we-j*re+H*se)*Se,n[11]=(E*re-I*we-z*se)*Se,n[12]=(v*Fe-f*Ye-b*Ne)*Se,n[13]=(i*Ye-a*Fe+l*Ne)*Se,n[14]=(j*te-R*fe-V*se)*Se,n[15]=(I*fe-E*te+L*se)*Se,n):null},_.ar=Cr,_.as=function(n){var t=n[0],i=n[1];return Math.sqrt(t*t+i*i)},_.at=function(n){return n[0]=0,n[1]=0,n},_.au=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n},_.av=id,_.aw=mo,_.ax=function(n,t,i,a){let l=t.y-n.y,d=t.x-n.x,f=a.y-i.y,v=a.x-i.x,b=f*d-v*l;if(b===0)return null;let S=(v*(n.y-i.y)-f*(n.x-i.x))/b;return new C(n.x+S*d,n.y+S*l)},_.ay=Ff,_.az=Sm,_.b=hr,_.b$=class extends h{},_.b0=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n},_.b1=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},_.b2=kf,_.b3=Tl,_.b4=function(n,t,i,a,l){var d=1/Math.tan(t/2);if(n[0]=d/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,l!=null&&l!==1/0){var f=1/(a-l);n[10]=(l+a)*f,n[14]=2*l*a*f}else n[10]=-1,n[14]=-2*a;return n},_.b5=function(n){var t=new Qe(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},_.b6=function(n,t,i){var a=Math.sin(i),l=Math.cos(i),d=t[0],f=t[1],v=t[2],b=t[3],S=t[4],I=t[5],E=t[6],L=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*l+S*a,n[1]=f*l+I*a,n[2]=v*l+E*a,n[3]=b*l+L*a,n[4]=S*l-d*a,n[5]=I*l-f*a,n[6]=E*l-v*a,n[7]=L*l-b*a,n},_.b7=function(n,t,i){var a=Math.sin(i),l=Math.cos(i),d=t[4],f=t[5],v=t[6],b=t[7],S=t[8],I=t[9],E=t[10],L=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=d*l+S*a,n[5]=f*l+I*a,n[6]=v*l+E*a,n[7]=b*l+L*a,n[8]=S*l-d*a,n[9]=I*l-f*a,n[10]=E*l-v*a,n[11]=L*l-b*a,n},_.b8=function(){let n=new Float32Array(16);return vt(n),n},_.b9=function(){let n=new Float64Array(16);return vt(n),n},_.bA=function(n,t){let i=Xi(n,360),a=Xi(t,360),l=a-i,d=a>i?l-360:l+360;return Math.abs(l)<Math.abs(d)?l:d},_.bB=function(n){return n[0]=0,n[1]=0,n[2]=0,n},_.bC=function(n,t,i,a){let l=Math.sqrt(n*n+t*t),d=Math.sqrt(i*i+a*a);n/=l,t/=l,i/=d,a/=d;let f=Math.acos(n*i+t*a);return-t*i+n*a>0?f:-f},_.bD=function(n,t){let i=Xi(n,2*Math.PI),a=Xi(t,2*Math.PI);return Math.min(Math.abs(i-a),Math.abs(i-a+2*Math.PI),Math.abs(i-a-2*Math.PI))},_.bE=function(){let n={},t=pe.$version;for(let i in pe.$root){let a=pe.$root[i];if(a.required){let l=null;l=i==="version"?t:a.type==="array"?[]:{},l!=null&&(n[i]=l)}}return n},_.bF=rl,_.bG=ae,_.bH=function n(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let a=0;a<t.length;a++)if(!n(t[a],i[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(let a in t)if(!n(t[a],i[a]))return!1;return!0}return t===i},_.bI=function(n){n=n.slice();let t=Object.create(null);for(let i=0;i<n.length;i++)t[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=xt(n[i],t[n[i].ref]));return n},_.bJ=function(n){if(n.type==="custom")return new q0(n);switch(n.type){case"background":return new $0(n);case"circle":return new My(n);case"color-relief":return new zy(n);case"fill":return new Xy(n);case"fill-extrusion":return new a0(n);case"heatmap":return new Ay(n);case"hillshade":return new Ly(n);case"line":return new d0(n);case"raster":return new Z0(n);case"symbol":return new Th(n)}},_.bK=Tn,_.bL=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let i=[];try{if(!Je(n.version,t.version))return[{command:"setStyle",args:[t]}];Je(n.center,t.center)||i.push({command:"setCenter",args:[t.center]}),Je(n.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),Je(n.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Je(n.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),Je(n.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),Je(n.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),Je(n.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),Je(n.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),Je(n.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),Je(n.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),Je(n.light,t.light)||i.push({command:"setLight",args:[t.light]}),Je(n.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),Je(n.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),Je(n.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});let a={},l=[];(function(f,v,b,S){let I;for(I in v=v||{},f=f||{})Object.prototype.hasOwnProperty.call(f,I)&&(Object.prototype.hasOwnProperty.call(v,I)||Pi(I,b,S));for(I in v)Object.prototype.hasOwnProperty.call(v,I)&&(Object.prototype.hasOwnProperty.call(f,I)?Je(f[I],v[I])||(f[I].type==="geojson"&&v[I].type==="geojson"&&gi(f,v,I)?pt(b,{command:"setGeoJSONSourceData",args:[I,v[I].data]}):Ci(I,v,b,S)):Jt(I,v,b))})(n.sources,t.sources,l,a);let d=[];n.layers&&n.layers.forEach(f=>{"source"in f&&a[f.source]?i.push({command:"removeLayer",args:[f.id]}):d.push(f)}),i=i.concat(l),(function(f,v,b){v=v||[];let S=(f=f||[]).map(kt),I=v.map(kt),E=f.reduce(vi,{}),L=v.reduce(vi,{}),z=S.slice(),R=Object.create(null),j,V,H,se,te;for(let re=0,fe=0;re<S.length;re++)j=S[re],Object.prototype.hasOwnProperty.call(L,j)?fe++:(pt(b,{command:"removeLayer",args:[j]}),z.splice(z.indexOf(j,fe),1));for(let re=0,fe=0;re<I.length;re++)j=I[I.length-1-re],z[z.length-1-re]!==j&&(Object.prototype.hasOwnProperty.call(E,j)?(pt(b,{command:"removeLayer",args:[j]}),z.splice(z.lastIndexOf(j,z.length-fe),1)):fe++,se=z[z.length-re],pt(b,{command:"addLayer",args:[L[j],se]}),z.splice(z.length-re,0,j),R[j]=!0);for(let re=0;re<I.length;re++)if(j=I[re],V=E[j],H=L[j],!R[j]&&!Je(V,H))if(Je(V.source,H.source)&&Je(V["source-layer"],H["source-layer"])&&Je(V.type,H.type)){for(te in It(V.layout,H.layout,b,j,null,"setLayoutProperty"),It(V.paint,H.paint,b,j,null,"setPaintProperty"),Je(V.filter,H.filter)||pt(b,{command:"setFilter",args:[j,H.filter]}),Je(V.minzoom,H.minzoom)&&Je(V.maxzoom,H.maxzoom)||pt(b,{command:"setLayerZoomRange",args:[j,H.minzoom,H.maxzoom]}),V)Object.prototype.hasOwnProperty.call(V,te)&&te!=="layout"&&te!=="paint"&&te!=="filter"&&te!=="metadata"&&te!=="minzoom"&&te!=="maxzoom"&&(te.indexOf("paint.")===0?It(V[te],H[te],b,j,te.slice(6),"setPaintProperty"):Je(V[te],H[te])||pt(b,{command:"setLayerProperty",args:[j,te,H[te]]}));for(te in H)Object.prototype.hasOwnProperty.call(H,te)&&!Object.prototype.hasOwnProperty.call(V,te)&&te!=="layout"&&te!=="paint"&&te!=="filter"&&te!=="metadata"&&te!=="minzoom"&&te!=="maxzoom"&&(te.indexOf("paint.")===0?It(V[te],H[te],b,j,te.slice(6),"setPaintProperty"):Je(V[te],H[te])||pt(b,{command:"setLayerProperty",args:[j,te,H[te]]}))}else pt(b,{command:"removeLayer",args:[j]}),se=z[z.lastIndexOf(j)+1],pt(b,{command:"addLayer",args:[H,se]})})(d,t.layers,i)}catch(a){console.warn("Unable to compute style diff:",a),i=[{command:"setStyle",args:[t]}]}return i},_.bM=function(n){let t=[],i=n.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},_.bN=Xo,_.bO=Ko,_.bP=class extends ln{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},_.bQ=Ei,_.bR=class extends ln{constructor(n,t){super(n,t),this.current=Bn}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},_.bS=wi,_.bT=class extends ln{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},_.bU=class extends ln{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},_.bV=nt,_.bW=function(n,t){var i=Math.sin(t),a=Math.cos(t);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},_.bX=function(n,t,i){var a=t[0],l=t[1],d=t[2];return n[0]=a*i[0]+l*i[3]+d*i[6],n[1]=a*i[1]+l*i[4]+d*i[7],n[2]=a*i[2]+l*i[5]+d*i[8],n},_.bY=function(n,t,i,a,l,d,f){var v=1/(t-i),b=1/(a-l),S=1/(d-f);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*S,n[11]=0,n[12]=(t+i)*v,n[13]=(l+a)*b,n[14]=(f+d)*S,n[15]=1,n},_.bZ=class extends ln{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;let t=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)t[4*i]=n[i].r,t[4*i+1]=n[i].g,t[4*i+2]=n[i].b,t[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,t)}}},_.b_=class extends ln{constructor(n,t){super(n,t),this.current=new Array}set(n){if(n!=this.current){this.current=n;let t=new Float32Array(n);this.gl.uniform1fv(this.location,t)}}},_.ba=function(){return new Float64Array(16)},_.bb=function(n,t,i){let a=new Float64Array(4);return Pr(a,n,t-90,i),a},_.bc=function(n,t,i,a){var l,d,f,v,b,S=t[0],I=t[1],E=t[2],L=t[3],z=i[0],R=i[1],j=i[2],V=i[3];return(d=S*z+I*R+E*j+L*V)<0&&(d=-d,z=-z,R=-R,j=-j,V=-V),1-d>qe?(l=Math.acos(d),f=Math.sin(l),v=Math.sin((1-a)*l)/f,b=Math.sin(a*l)/f):(v=1-a,b=a),n[0]=v*S+b*z,n[1]=v*I+b*R,n[2]=v*E+b*j,n[3]=v*L+b*V,n},_.bd=function(n){let t=new Float64Array(9);var i,a,l,d,f,v,b,S,I,E,L,z,R,j,V,H,se,te;E=(l=(a=n)[0])*(b=l+l),L=(d=a[1])*b,R=(f=a[2])*b,j=f*(S=d+d),H=(v=a[3])*b,se=v*S,te=v*(I=f+f),(i=t)[0]=1-(z=d*S)-(V=f*I),i[3]=L-te,i[6]=R+se,i[1]=L+te,i[4]=1-E-V,i[7]=j-H,i[2]=R-se,i[5]=j+H,i[8]=1-E-z;let re=qr(-Math.asin(fn(t[2],-1,1))),fe,we;return Math.hypot(t[5],t[8])<.001?(fe=0,we=-qr(Math.atan2(t[3],t[4]))):(fe=qr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),we=qr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:fe,pitch:re+90,bearing:we}},_.be=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},_.bf=Tt,_.bg=ao,_.bh=yl,_.bi=Yc,_.bj=_l,_.bk=fo,_.bl=cr,_.bm=Yi,_.bn=function(n,t,i,a,l){return fo(a,l,fn((n-t)/(i-t),0,1))},_.bo=Xi,_.bp=function(){return new Float64Array(3)},_.bq=function(n,t,i,a){return n[0]=t[0]+i[0]*a,n[1]=t[1]+i[1]*a,n[2]=t[2]+i[2]*a,n},_.br=Pr,_.bs=function(n,t,i){var a=i[0],l=i[1],d=i[2],f=i[3],v=t[0],b=t[1],S=t[2],I=l*S-d*b,E=d*v-a*S,L=a*b-l*v;return n[0]=v+f*(I+=I)+l*(L+=L)-d*(E+=E),n[1]=b+f*E+d*I-a*L,n[2]=S+f*L+a*E-l*I,n},_.bt=function(n,t,i){let a=(l=[n[0],n[1],n[2],t[0],t[1],t[2],i[0],i[1],i[2]])[0]*((I=l[8])*(f=l[4])-(v=l[5])*(S=l[7]))+l[1]*(-I*(d=l[3])+v*(b=l[6]))+l[2]*(S*d-f*b);var l,d,f,v,b,S,I;if(a===0)return null;let E=On([],[t[0],t[1],t[2]],[i[0],i[1],i[2]]),L=On([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),z=On([],[n[0],n[1],n[2]],[t[0],t[1],t[2]]),R=Ii([],E,-n[3]);return pn(R,R,Ii([],L,-t[3])),pn(R,R,Ii([],z,-i[3])),Ii(R,R,1/a),R},_.bu=ad,_.bv=function(){return new Float64Array(4)},_.bw=function(n,t,i,a){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[0]*Math.cos(a)-l[1]*Math.sin(a),d[1]=l[0]*Math.sin(a)+l[1]*Math.cos(a),d[2]=l[2],n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},_.bx=function(n,t,i,a){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[0],d[1]=l[1]*Math.cos(a)-l[2]*Math.sin(a),d[2]=l[1]*Math.sin(a)+l[2]*Math.cos(a),n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},_.by=function(n,t,i,a){var l=[],d=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],d[0]=l[2]*Math.sin(a)+l[0]*Math.cos(a),d[1]=l[1],d[2]=l[2]*Math.cos(a)-l[0]*Math.sin(a),n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},_.bz=function(n,t,i){var a=Math.sin(i),l=Math.cos(i),d=t[0],f=t[1],v=t[2],b=t[3],S=t[8],I=t[9],E=t[10],L=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*l-S*a,n[1]=f*l-I*a,n[2]=v*l-E*a,n[3]=b*l-L*a,n[8]=d*a+S*l,n[9]=f*a+I*l,n[10]=v*a+E*l,n[11]=b*a+L*l,n},_.c=le,_.c0=_0,_.c1=class extends r{},_.c2=Up,_.c3=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},_.c4=zm,_.c5=function(n,t,i){var a=t[0],l=t[1],d=t[2],f=i[3]*a+i[7]*l+i[11]*d+i[15];return n[0]=(i[0]*a+i[4]*l+i[8]*d+i[12])/(f=f||1),n[1]=(i[1]*a+i[5]*l+i[9]*d+i[13])/f,n[2]=(i[2]*a+i[6]*l+i[10]*d+i[14])/f,n},_.c6=class extends Uc{},_.c7=class extends P{},_.c8=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},_.c9=function(n,t){var i=n[0],a=n[1],l=n[2],d=n[3],f=n[4],v=n[5],b=n[6],S=n[7],I=n[8],E=n[9],L=n[10],z=n[11],R=n[12],j=n[13],V=n[14],H=n[15],se=t[0],te=t[1],re=t[2],fe=t[3],we=t[4],Ee=t[5],Ne=t[6],Fe=t[7],je=t[8],Ye=t[9],Oe=t[10],Ue=t[11],Se=t[12],ot=t[13],at=t[14],et=t[15];return Math.abs(i-se)<=qe*Math.max(1,Math.abs(i),Math.abs(se))&&Math.abs(a-te)<=qe*Math.max(1,Math.abs(a),Math.abs(te))&&Math.abs(l-re)<=qe*Math.max(1,Math.abs(l),Math.abs(re))&&Math.abs(d-fe)<=qe*Math.max(1,Math.abs(d),Math.abs(fe))&&Math.abs(f-we)<=qe*Math.max(1,Math.abs(f),Math.abs(we))&&Math.abs(v-Ee)<=qe*Math.max(1,Math.abs(v),Math.abs(Ee))&&Math.abs(b-Ne)<=qe*Math.max(1,Math.abs(b),Math.abs(Ne))&&Math.abs(S-Fe)<=qe*Math.max(1,Math.abs(S),Math.abs(Fe))&&Math.abs(I-je)<=qe*Math.max(1,Math.abs(I),Math.abs(je))&&Math.abs(E-Ye)<=qe*Math.max(1,Math.abs(E),Math.abs(Ye))&&Math.abs(L-Oe)<=qe*Math.max(1,Math.abs(L),Math.abs(Oe))&&Math.abs(z-Ue)<=qe*Math.max(1,Math.abs(z),Math.abs(Ue))&&Math.abs(R-Se)<=qe*Math.max(1,Math.abs(R),Math.abs(Se))&&Math.abs(j-ot)<=qe*Math.max(1,Math.abs(j),Math.abs(ot))&&Math.abs(V-at)<=qe*Math.max(1,Math.abs(V),Math.abs(at))&&Math.abs(H-et)<=qe*Math.max(1,Math.abs(H),Math.abs(et))},_.cA=function(n,t){O.REGISTERED_PROTOCOLS[n]=t},_.cB=function(n){delete O.REGISTERED_PROTOCOLS[n]},_.cC=function(n,t){let i={};for(let l=0;l<n.length;l++){let d=t&&t[n[l].id]||Mp(n[l]);t&&(t[n[l].id]=d);let f=i[d];f||(f=i[d]=[]),f.push(n[l])}let a=[];for(let l in i)a.push(i[l]);return a},_.cD=Ge,_.cE=Lf,_.cF=zf,_.cG=uf,_.cH=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Ot/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;let t=n.bucket.layers[0],i=t.layout,a=t._unevaluatedLayout._values,l={layoutIconSize:a["icon-size"].possiblyEvaluate(new Qt(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Qt(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Qt(18))};if(n.bucket.textSizeData.kind==="composite"){let{minZoom:S,maxZoom:I}=n.bucket.textSizeData;l.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Qt(S),n.canonical),a["text-size"].possiblyEvaluate(new Qt(I),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){let{minZoom:S,maxZoom:I}=n.bucket.iconSizeData;l.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Qt(S),n.canonical),a["icon-size"].possiblyEvaluate(new Qt(I),n.canonical)]}let d=i.get("text-line-height")*Bi,f=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",v=i.get("text-keep-upright"),b=i.get("text-size");for(let S of n.bucket.features){let I=i.get("text-font").evaluate(S,{},n.canonical).join(","),E=b.evaluate(S,{},n.canonical),L=l.layoutTextSize.evaluate(S,{},n.canonical),z=l.layoutIconSize.evaluate(S,{},n.canonical),R={horizontal:{},vertical:void 0},j=S.text,V,H=[0,0];if(j){let re=j.toString(),fe=i.get("text-letter-spacing").evaluate(S,{},n.canonical)*Bi,we=Lp(re)?fe:0,Ee=i.get("text-anchor").evaluate(S,{},n.canonical),Ne=Zf(t,S,n.canonical);if(!Ne){let Oe=i.get("text-radial-offset").evaluate(S,{},n.canonical);H=Oe?Gf(Ee,[Oe*Bi,cd]):i.get("text-offset").evaluate(S,{},n.canonical).map(Ue=>Ue*Bi)}let Fe=f?"center":i.get("text-justify").evaluate(S,{},n.canonical),je=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(S,{},n.canonical)*Bi:1/0,Ye=()=>{n.bucket.allowVerticalPlacement&&ol(re)&&(R.vertical=xh(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,d,Ee,"left",we,H,_.ao.vertical,!0,L,E))};if(!f&&Ne){let Oe=new Set;if(Fe==="auto")for(let Se=0;Se<Ne.values.length;Se+=2)Oe.add(ud(Ne.values[Se]));else Oe.add(Fe);let Ue=!1;for(let Se of Oe)if(!R.horizontal[Se])if(Ue)R.horizontal[Se]=R.horizontal[0];else{let ot=xh(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,d,"center",Se,we,H,_.ao.horizontal,!1,L,E);ot&&(R.horizontal[Se]=ot,Ue=ot.positionedLines.length===1)}Ye()}else{Fe==="auto"&&(Fe=ud(Ee));let Oe=xh(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,d,Ee,Fe,we,H,_.ao.horizontal,!1,L,E);Oe&&(R.horizontal[Fe]=Oe),Ye(),ol(re)&&f&&v&&(R.vertical=xh(j,n.glyphMap,n.glyphPositions,n.imagePositions,I,je,d,Ee,Fe,we,H,_.ao.vertical,!1,L,E))}}let se=!1;if(S.icon&&S.icon.name){let re=n.imageMap[S.icon.name];re&&(V=j0(n.imagePositions[S.icon.name],i.get("icon-offset").evaluate(S,{},n.canonical),i.get("icon-anchor").evaluate(S,{},n.canonical)),se=!!re.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=se:n.bucket.sdfIcons!==se&&fi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(re.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}let te=Wf(R.horizontal)||R.vertical;n.bucket.iconsInText=!!te&&te.iconsInText,(te||V)&&tv(n.bucket,S,R,V,n.imageMap,l,L,z,H,se,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},_.cI=Xp,_.cJ=qp,_.cK=Hp,_.cL=Xm,_.cM=Yp,_.cN=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},_.cO=function(n,t,i,a,l){return o(this,void 0,void 0,function*(){if(De())try{return yield Yo(n,t,i,a,l)}catch{}return(function(d,f,v,b,S){let I=d.width,E=d.height;$r&&Gr||($r=new OffscreenCanvas(I,E),Gr=$r.getContext("2d",{willReadFrequently:!0})),$r.width=I,$r.height=E,Gr.drawImage(d,0,0,I,E);let L=Gr.getImageData(f,v,b,S);return Gr.clearRect(0,0,I,E),L.data})(n,t,i,a,l)})},_.cP=Bm,_.cQ=B,_.cR=Hm,_.cS=vl,_.cT=ts,_.cU=function(n,t){let i=new Map;if(n!=null)if(n.type==="Feature")i.set(ru(n,t),n);else for(let a of n.features)i.set(ru(a,t),a);return i},_.cV=function(n,t){if(n==null)return!0;if(n.type==="Feature")return ru(n,t)!=null;if(n.type==="FeatureCollection"){let i=new Set;for(let a of n.features){let l=ru(a,t);if(l==null||i.has(l))return!1;i.add(l)}return!0}return!1},_.cW=function(n,t,i){var a,l,d,f;if(t.removeAll&&n.clear(),t.remove)for(let v of t.remove)n.delete(v);if(t.add)for(let v of t.add){let b=ru(v,i);b!=null&&n.set(b,v)}if(t.update)for(let v of t.update){let b=n.get(v.id);if(b==null)continue;let S=!v.removeAllProperties&&(((a=v.removeProperties)===null||a===void 0?void 0:a.length)>0||((l=v.addOrUpdateProperties)===null||l===void 0?void 0:l.length)>0);if((v.newGeometry||v.removeAllProperties||S)&&(b=Object.assign({},b),n.set(v.id,b),S&&(b.properties=Object.assign({},b.properties))),v.newGeometry&&(b.geometry=v.newGeometry),v.removeAllProperties)b.properties={};else if(((d=v.removeProperties)===null||d===void 0?void 0:d.length)>0)for(let I of v.removeProperties)Object.prototype.hasOwnProperty.call(b.properties,I)&&delete b.properties[I];if(((f=v.addOrUpdateProperties)===null||f===void 0?void 0:f.length)>0)for(let{key:I,value:E}of v.addOrUpdateProperties)b.properties[I]=E}},_.cX=Jn,_.ca=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},_.cb=n=>n.type==="symbol",_.cc=n=>n.type==="circle",_.cd=n=>n.type==="heatmap",_.ce=n=>n.type==="line",_.cf=n=>n.type==="fill",_.cg=n=>n.type==="fill-extrusion",_.ch=n=>n.type==="hillshade",_.ci=n=>n.type==="color-relief",_.cj=n=>n.type==="raster",_.ck=n=>n.type==="background",_.cl=n=>n.type==="custom",_.cm=Vr,_.cn=function(n,t,i){let a=Oa(t.x-i.x,t.y-i.y),l=Oa(n.x-i.x,n.y-i.y);var d,f;return qr(Math.atan2(a[0]*l[1]-a[1]*l[0],(d=a)[0]*(f=l)[0]+d[1]*f[1]))},_.co=go,_.cp=function(n,t){return Hr[t]&&(n instanceof MouseEvent||n instanceof WheelEvent)},_.cq=function(n,t){return Wr[t]&&"touches"in n},_.cr=function(n){return Wr[n]||Hr[n]},_.cs=function(n,t,i){var a=t[0],l=t[1];return n[0]=i[0]*a+i[4]*l+i[12],n[1]=i[1]*a+i[5]*l+i[13],n},_.ct=function(n,t){let{x:i,y:a}=nu.fromLngLat(t);return!(n<0||n>25||a<0||a>=1||i<0||i>=1)},_.cu=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},_.cv=class extends va{},_.cw=nv,_.cy=function(n){return n.message===Jo},_.cz=Q,_.d=_e,_.e=Dn,_.f=n=>o(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));let t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),_.g=U,_.h=n=>new Promise((t,i)=>{let a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=pr})},a.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let l=new Blob([new Uint8Array(n)],{type:"image/png"});a.src=n.byteLength?URL.createObjectURL(l):pr}),_.i=ur,_.j=(n,t)=>ce(Dn(n,{type:"json"}),t),_.k=Pe,_.l=ke,_.m=ce,_.n=(n,t)=>ce(Dn(n,{type:"arrayBuffer"}),t),_.o=function(n){return new Yp(n).readFields(M0,[])},_.p=cf,_.q=qc,_.r=an,_.s=Zr,_.t=ch,_.u=Ct,_.v=pe,_.w=fi,_.x=Ep,_.y=ls,_.z=fa}),u("worker",["./shared"],function(_){"use strict";class o{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,U){for(let Q of O){this._layerConfigs[Q.id]=Q;let ae=this._layers[Q.id]=_.bJ(Q);ae._featureFilter=_.aa(ae.filter),this.keyCache[Q.id]&&delete this.keyCache[Q.id]}for(let Q of U)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};let N=_.cC(Object.values(this._layerConfigs),this.keyCache);for(let Q of N){let ae=Q.map(Pe=>this._layers[Pe.id]),ce=ae[0];if(ce.visibility==="none")continue;let _e=ce.source||"",he=this.familiesBySource[_e];he||(he=this.familiesBySource[_e]={});let Te=ce.sourceLayer||"_geojsonTileLayer",ke=he[Te];ke||(ke=he[Te]=[]),ke.push(ae)}}}class C{constructor(O){let U={},N=[];for(let _e in O){let he=O[_e],Te=U[_e]={};for(let ke in he){let Pe=he[+ke];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;let Xe={x:0,y:0,w:Pe.bitmap.width+2,h:Pe.bitmap.height+2};N.push(Xe),Te[ke]={rect:Xe,metrics:Pe.metrics}}}let{w:Q,h:ae}=_.p(N),ce=new _.q({width:Q||1,height:ae||1});for(let _e in O){let he=O[_e];for(let Te in he){let ke=he[+Te];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;let Pe=U[_e][Te].rect;_.q.copy(ke.bitmap,ce,{x:0,y:0},{x:Pe.x+1,y:Pe.y+1},ke.bitmap)}}this.image=ce,this.positions=U}}_.cD("GlyphAtlas",C);class B{constructor(O){this.tileID=new _.Z(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[],this.globalState=O.globalState}parse(O,U,N,Q,ae){return _._(this,void 0,void 0,function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new _.a8;let ce=new _.cE(Object.keys(O.layers).sort()),_e=new _.cF(this.tileID,this.promoteId);_e.bucketLayerIDs=[];let he={},Te={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N,subdivisionGranularity:ae},ke=U.familiesBySource[this.source];for(let It in ke){let kt=O.layers[It];if(!kt)continue;kt.version===1&&_.w(`Vector tile source "${this.source}" layer "${It}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let vi=ce.encode(It),Re=[];for(let Ki=0;Ki<kt.length;Ki++){let si=kt.feature(Ki),Xr=_e.getId(si,It);Re.push({feature:si,id:Xr,index:Ki,sourceLayerIndex:vi})}for(let Ki of ke[It]){let si=Ki[0];si.source!==this.source&&_.w(`layer.source = ${si.source} does not equal this.source = ${this.source}`),si.minzoom&&this.zoom<Math.floor(si.minzoom)||si.maxzoom&&this.zoom>=si.maxzoom||si.visibility!=="none"&&($(Ki,this.zoom,N,this.globalState),(he[si.id]=si.createBucket({index:_e.bucketLayerIDs.length,layers:Ki,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vi,sourceID:this.source,globalState:this.globalState})).populate(Re,Te,this.tileID.canonical),_e.bucketLayerIDs.push(Ki.map(Xr=>Xr.id)))}}let Pe=_.bN(Te.glyphDependencies,It=>Object.keys(It).map(Number));this.inFlightDependencies.forEach(It=>It?.abort()),this.inFlightDependencies=[];let Xe=Promise.resolve({});if(Object.keys(Pe).length){let It=new AbortController;this.inFlightDependencies.push(It),Xe=Q.sendAsync({type:"GG",data:{stacks:Pe,source:this.source,tileID:this.tileID,type:"glyphs"}},It)}let pe=Object.keys(Te.iconDependencies),lt=Promise.resolve({});if(pe.length){let It=new AbortController;this.inFlightDependencies.push(It),lt=Q.sendAsync({type:"GI",data:{icons:pe,source:this.source,tileID:this.tileID,type:"icons"}},It)}let xt=Object.keys(Te.patternDependencies),Je=Promise.resolve({});if(xt.length){let It=new AbortController;this.inFlightDependencies.push(It),Je=Q.sendAsync({type:"GI",data:{icons:xt,source:this.source,tileID:this.tileID,type:"patterns"}},It)}let[pt,Jt,Pi]=yield Promise.all([Xe,lt,Je]),Ci=new C(pt),gi=new _.cG(Jt,Pi);for(let It in he){let kt=he[It];kt instanceof _.a9?($(kt.layers,this.zoom,N,this.globalState),_.cH({bucket:kt,glyphMap:pt,glyphPositions:Ci.positions,imageMap:Jt,imagePositions:gi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Te.subdivisionGranularity})):kt.hasPattern&&(kt instanceof _.cI||kt instanceof _.cJ||kt instanceof _.cK)&&($(kt.layers,this.zoom,N,this.globalState),kt.addFeatures(Te,this.tileID.canonical,gi.patternPositions))}return this.status="done",{buckets:Object.values(he).filter(It=>!It.isEmpty()),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:gi,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?Jt:null,glyphPositions:this.returnDependencies?Ci.positions:null}})}}function $(le,O,U,N){let Q=new _.F(O,{globalState:N});for(let ae of le)ae.recalculate(Q,U)}class Y{constructor(O,U,N){this.actor=O,this.layerIndex=U,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,U){return _._(this,void 0,void 0,function*(){let N=yield _.n(O.request,U);try{return{vectorTile:new _.cL(new _.cM(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(Q){let ae=new Uint8Array(N.data),ce=`Unable to parse the tile at ${O.request.url}, `;throw ce+=ae[0]===31&&ae[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Q.message}`,new Error(ce)}})}loadTile(O){return _._(this,void 0,void 0,function*(){let U=O.uid,N=!!(O&&O.request&&O.request.collectResourceTiming)&&new _.cN(O.request),Q=new B(O);this.loading[U]=Q;let ae=new AbortController;Q.abort=ae;try{let ce=yield this.loadVectorTile(O,ae);if(delete this.loading[U],!ce)return null;let _e=ce.rawData,he={};ce.expires&&(he.expires=ce.expires),ce.cacheControl&&(he.cacheControl=ce.cacheControl);let Te={};if(N){let Pe=N.finish();Pe&&(Te.resourceTiming=JSON.parse(JSON.stringify(Pe)))}Q.vectorTile=ce.vectorTile;let ke=Q.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity);this.loaded[U]=Q,this.fetching[U]={rawTileData:_e,cacheControl:he,resourceTiming:Te};try{let Pe=yield ke;return _.e({rawTileData:_e.slice(0)},Pe,he,Te)}finally{delete this.fetching[U]}}catch(ce){throw delete this.loading[U],Q.status="done",this.loaded[U]=Q,ce}})}reloadTile(O){return _._(this,void 0,void 0,function*(){let U=O.uid;if(!this.loaded||!this.loaded[U])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let N=this.loaded[U];if(N.showCollisionBoxes=O.showCollisionBoxes,N.globalState=O.globalState,N.status==="parsing"){let Q=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity),ae;if(this.fetching[U]){let{rawTileData:ce,cacheControl:_e,resourceTiming:he}=this.fetching[U];delete this.fetching[U],ae=_.e({rawTileData:ce.slice(0)},Q,_e,he)}else ae=Q;return ae}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,O.subdivisionGranularity)})}abortTile(O){return _._(this,void 0,void 0,function*(){let U=this.loading,N=O.uid;U&&U[N]&&U[N].abort&&(U[N].abort.abort(),delete U[N])})}removeTile(O){return _._(this,void 0,void 0,function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]})}}class ne{constructor(){this.loaded={}}loadTile(O){return _._(this,void 0,void 0,function*(){let{uid:U,encoding:N,rawImageData:Q,redFactor:ae,greenFactor:ce,blueFactor:_e,baseShift:he}=O,Te=Q.width+2,ke=Q.height+2,Pe=_.b(Q)?new _.R({width:Te,height:ke},yield _.cO(Q,-1,-1,Te,ke)):Q,Xe=new _.cP(U,Pe,N,ae,ce,_e,he);return this.loaded=this.loaded||{},this.loaded[U]=Xe,Xe})}removeTile(O){let U=this.loaded,N=O.uid;U&&U[N]&&delete U[N]}}var q,Ce,Ie=(function(){if(Ce)return q;function le(U,N){if(U.length!==0){O(U[0],N);for(var Q=1;Q<U.length;Q++)O(U[Q],!N)}}function O(U,N){for(var Q=0,ae=0,ce=0,_e=U.length,he=_e-1;ce<_e;he=ce++){var Te=(U[ce][0]-U[he][0])*(U[he][1]+U[ce][1]),ke=Q+Te;ae+=Math.abs(Q)>=Math.abs(Te)?Q-ke+Te:Te-ke+Q,Q=ke}Q+ae>=0!=!!N&&U.reverse()}return Ce=1,q=function U(N,Q){var ae,ce=N&&N.type;if(ce==="FeatureCollection")for(ae=0;ae<N.features.length;ae++)U(N.features[ae],Q);else if(ce==="GeometryCollection")for(ae=0;ae<N.geometries.length;ae++)U(N.geometries[ae],Q);else if(ce==="Feature")U(N.geometry,Q);else if(ce==="Polygon")le(N.coordinates,Q);else if(ce==="MultiPolygon")for(ae=0;ae<N.coordinates.length;ae++)le(N.coordinates[ae],Q);return N}})(),Ae=_.cQ(Ie);class De extends _.cS{constructor(O,U){super(new _.cM,0,U,[],[]),this.feature=O,this.type=O.type,this.properties=O.tags?O.tags:{},"id"in O&&(typeof O.id=="string"?this.id=parseInt(O.id,10):typeof O.id!="number"||isNaN(O.id)||(this.id=O.id))}loadGeometry(){let O=[],U=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let N of U){let Q=[];for(let ae of N)Q.push(new _.P(ae[0],ae[1]));O.push(Q)}return O}}class qe extends _.cR{constructor(O,U){super(new _.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=U?U.version:1,this.extent=U?U.extent:4096,this.length=O.length,this.features=O}feature(O){return new De(this.features[O],this.extent)}}function Qe(le,O){O.writeVarintField(15,le.version||1),O.writeStringField(1,le.name||""),O.writeVarintField(5,le.extent||4096);let U={keys:[],values:[],keycache:{},valuecache:{}};for(let ae=0;ae<le.length;ae++)U.feature=le.feature(ae),O.writeMessage(2,nt,U);let N=U.keys;for(let ae of N)O.writeStringField(3,ae);let Q=U.values;for(let ae of Q)O.writeMessage(4,pn,ae)}function nt(le,O){if(!le.feature)return;let U=le.feature;U.id!==void 0&&O.writeVarintField(1,U.id),O.writeMessage(2,vt,le),O.writeVarintField(3,U.type),O.writeMessage(4,Yt,U)}function vt(le,O){for(let U in le.feature?.properties){let N=le.feature.properties[U],Q=le.keycache[U];if(N===null)continue;Q===void 0&&(le.keys.push(U),Q=le.keys.length-1,le.keycache[U]=Q),O.writeVarint(Q),typeof N!="string"&&typeof N!="boolean"&&typeof N!="number"&&(N=JSON.stringify(N));let ae=typeof N+":"+N,ce=le.valuecache[ae];ce===void 0&&(le.values.push(N),ce=le.values.length-1,le.valuecache[ae]=ce),O.writeVarint(ce)}}function tt(le,O){return(O<<3)+(7&le)}function At(le){return le<<1^le>>31}function Yt(le,O){let U=le.loadGeometry(),N=le.type,Q=0,ae=0;for(let ce of U){let _e=1;N===1&&(_e=ce.length),O.writeVarint(tt(1,_e));let he=N===3?ce.length-1:ce.length;for(let Te=0;Te<he;Te++){Te===1&&N!==1&&O.writeVarint(tt(2,he-1));let ke=ce[Te].x-Q,Pe=ce[Te].y-ae;O.writeVarint(At(ke)),O.writeVarint(At(Pe)),Q+=ke,ae+=Pe}le.type===3&&O.writeVarint(tt(7,1))}}function pn(le,O){let U=typeof le;U==="string"?O.writeStringField(1,le):U==="boolean"?O.writeBooleanField(7,le):U==="number"&&(le%1!=0?O.writeDoubleField(3,le):le<0?O.writeSVarintField(6,le):O.writeVarintField(5,le))}let Ii={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:le=>le},On=Math.fround||(wn=new Float32Array(1),le=>(wn[0]=+le,wn[0]));var wn;class Vn{constructor(O){this.options=Object.assign(Object.create(Ii),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){let{log:U,minZoom:N,maxZoom:Q}=this.options;U&&console.time("total time");let ae=`prepare ${O.length} points`;U&&console.time(ae),this.points=O;let ce=[];for(let he=0;he<O.length;he++){let Te=O[he];if(!Te.geometry)continue;let[ke,Pe]=Te.geometry.coordinates,Xe=On(Pr(ke)),pe=On(Cr(Pe));ce.push(Xe,pe,1/0,he,-1,1),this.options.reduce&&ce.push(0)}let _e=this.trees[Q+1]=this._createTree(ce);U&&console.timeEnd(ae);for(let he=Q;he>=N;he--){let Te=+Date.now();_e=this.trees[he]=this._createTree(this._cluster(_e,he)),U&&console.log("z%d: %d clusters in %dms",he,_e.numItems,+Date.now()-Te)}return U&&console.timeEnd("total time"),this}getClusters(O,U){let N=((O[0]+180)%360+360)%360-180,Q=Math.max(-90,Math.min(90,O[1])),ae=O[2]===180?180:((O[2]+180)%360+360)%360-180,ce=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)N=-180,ae=180;else if(N>ae){let Pe=this.getClusters([N,Q,180,ce],U),Xe=this.getClusters([-180,Q,ae,ce],U);return Pe.concat(Xe)}let _e=this.trees[this._limitZoom(U)],he=_e.range(Pr(N),Cr(ce),Pr(ae),Cr(Q)),Te=_e.data,ke=[];for(let Pe of he){let Xe=this.stride*Pe;ke.push(Te[Xe+5]>1?mo(Te,Xe,this.clusterProps):this.points[Te[Xe+3]])}return ke}getChildren(O){let U=this._getOriginId(O),N=this._getOriginZoom(O),Q="No cluster with the specified id.",ae=this.trees[N];if(!ae)throw new Error(Q);let ce=ae.data;if(U*this.stride>=ce.length)throw new Error(Q);let _e=this.options.radius/(this.options.extent*Math.pow(2,N-1)),he=ae.within(ce[U*this.stride],ce[U*this.stride+1],_e),Te=[];for(let ke of he){let Pe=ke*this.stride;ce[Pe+4]===O&&Te.push(ce[Pe+5]>1?mo(ce,Pe,this.clusterProps):this.points[ce[Pe+3]])}if(Te.length===0)throw new Error(Q);return Te}getLeaves(O,U,N){let Q=[];return this._appendLeaves(Q,O,U=U||10,N=N||0,0),Q}getTile(O,U,N){let Q=this.trees[this._limitZoom(O)],ae=Math.pow(2,O),{extent:ce,radius:_e}=this.options,he=_e/ce,Te=(N-he)/ae,ke=(N+1+he)/ae,Pe={features:[]};return this._addTileFeatures(Q.range((U-he)/ae,Te,(U+1+he)/ae,ke),Q.data,U,N,ae,Pe),U===0&&this._addTileFeatures(Q.range(1-he/ae,Te,1,ke),Q.data,ae,N,ae,Pe),U===ae-1&&this._addTileFeatures(Q.range(0,Te,he/ae,ke),Q.data,-1,N,ae,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(O){let U=this._getOriginZoom(O)-1;for(;U<=this.options.maxZoom;){let N=this.getChildren(O);if(U++,N.length!==1)break;O=N[0].properties.cluster_id}return U}_appendLeaves(O,U,N,Q,ae){let ce=this.getChildren(U);for(let _e of ce){let he=_e.properties;if(he&&he.cluster?ae+he.point_count<=Q?ae+=he.point_count:ae=this._appendLeaves(O,he.cluster_id,N,Q,ae):ae<Q?ae++:O.push(_e),O.length===N)break}return ae}_createTree(O){let U=new _.aI(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<O.length;N+=this.stride)U.add(O[N],O[N+1]);return U.finish(),U.data=O,U}_addTileFeatures(O,U,N,Q,ae,ce){for(let _e of O){let he=_e*this.stride,Te=U[he+5]>1,ke,Pe,Xe;if(Te)ke=Ir(U,he,this.clusterProps),Pe=U[he],Xe=U[he+1];else{let xt=this.points[U[he+3]];ke=xt.properties;let[Je,pt]=xt.geometry.coordinates;Pe=Pr(Je),Xe=Cr(pt)}let pe={type:1,geometry:[[Math.round(this.options.extent*(Pe*ae-N)),Math.round(this.options.extent*(Xe*ae-Q))]],tags:ke},lt;lt=Te||this.options.generateId?U[he+3]:this.points[U[he+3]].id,lt!==void 0&&(pe.id=lt),ce.features.push(pe)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,U){let{radius:N,extent:Q,reduce:ae,minPoints:ce}=this.options,_e=N/(Q*Math.pow(2,U)),he=O.data,Te=[],ke=this.stride;for(let Pe=0;Pe<he.length;Pe+=ke){if(he[Pe+2]<=U)continue;he[Pe+2]=U;let Xe=he[Pe],pe=he[Pe+1],lt=O.within(he[Pe],he[Pe+1],_e),xt=he[Pe+5],Je=xt;for(let pt of lt){let Jt=pt*ke;he[Jt+2]>U&&(Je+=he[Jt+5])}if(Je>xt&&Je>=ce){let pt,Jt=Xe*xt,Pi=pe*xt,Ci=-1,gi=(Pe/ke<<5)+(U+1)+this.points.length;for(let It of lt){let kt=It*ke;if(he[kt+2]<=U)continue;he[kt+2]=U;let vi=he[kt+5];Jt+=he[kt]*vi,Pi+=he[kt+1]*vi,he[kt+4]=gi,ae&&(pt||(pt=this._map(he,Pe,!0),Ci=this.clusterProps.length,this.clusterProps.push(pt)),ae(pt,this._map(he,kt)))}he[Pe+4]=gi,Te.push(Jt/Je,Pi/Je,1/0,gi,-1,Je),ae&&Te.push(Ci)}else{for(let pt=0;pt<ke;pt++)Te.push(he[Pe+pt]);if(Je>1)for(let pt of lt){let Jt=pt*ke;if(!(he[Jt+2]<=U)){he[Jt+2]=U;for(let Pi=0;Pi<ke;Pi++)Te.push(he[Jt+Pi])}}}}return Te}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,U,N){if(O[U+5]>1){let ce=this.clusterProps[O[U+6]];return N?Object.assign({},ce):ce}let Q=this.points[O[U+3]].properties,ae=this.options.map(Q);return N&&ae===Q?Object.assign({},ae):ae}}function mo(le,O,U){return{type:"Feature",id:le[O+3],properties:Ir(le,O,U),geometry:{type:"Point",coordinates:[(N=le[O],360*(N-.5)),Oa(le[O+1])]}};var N}function Ir(le,O,U){let N=le[O+5],Q=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,ae=le[O+6],ce=ae===-1?{}:Object.assign({},U[ae]);return Object.assign(ce,{cluster:!0,cluster_id:le[O+3],point_count:N,point_count_abbreviated:Q})}function Pr(le){return le/360+.5}function Cr(le){let O=Math.sin(le*Math.PI/180),U=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return U<0?0:U>1?1:U}function Oa(le){let O=(180-360*le)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function Ot(le,O,U,N){let Q=N,ae=O+(U-O>>1),ce,_e=U-O,he=le[O],Te=le[O+1],ke=le[U],Pe=le[U+1];for(let Xe=O+3;Xe<U;Xe+=3){let pe=Nr(le[Xe],le[Xe+1],he,Te,ke,Pe);if(pe>Q)ce=Xe,Q=pe;else if(pe===Q){let lt=Math.abs(Xe-ae);lt<_e&&(ce=Xe,_e=lt)}}Q>N&&(ce-O>3&&Ot(le,O,ce,N),le[ce+2]=Q,U-ce>3&&Ot(le,ce,U,N))}function Nr(le,O,U,N,Q,ae){let ce=Q-U,_e=ae-N;if(ce!==0||_e!==0){let he=((le-U)*ce+(O-N)*_e)/(ce*ce+_e*_e);he>1?(U=Q,N=ae):he>0&&(U+=ce*he,N+=_e*he)}return ce=le-U,_e=O-N,ce*ce+_e*_e}function Xi(le,O,U,N){let Q={id:le??null,type:O,geometry:U,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(O==="Point"||O==="MultiPoint"||O==="LineString")fo(Q,U);else if(O==="Polygon")fo(Q,U[0]);else if(O==="MultiLineString")for(let ae of U)fo(Q,ae);else if(O==="MultiPolygon")for(let ae of U)fo(Q,ae[0]);return Q}function fo(le,O){for(let U=0;U<O.length;U+=3)le.minX=Math.min(le.minX,O[U]),le.minY=Math.min(le.minY,O[U+1]),le.maxX=Math.max(le.maxX,O[U]),le.maxY=Math.max(le.maxY,O[U+1])}function cr(le,O,U,N){if(!O.geometry)return;let Q=O.geometry.coordinates;if(Q&&Q.length===0)return;let ae=O.geometry.type,ce=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),_e=[],he=O.id;if(U.promoteId?he=O.properties[U.promoteId]:U.generateId&&(he=N||0),ae==="Point")Vr(Q,_e);else if(ae==="MultiPoint")for(let Te of Q)Vr(Te,_e);else if(ae==="LineString")go(Q,_e,ce,!1);else if(ae==="MultiLineString"){if(U.lineMetrics){for(let Te of Q)_e=[],go(Te,_e,ce,!1),le.push(Xi(he,"LineString",_e,O.properties));return}fn(Q,_e,ce,!1)}else if(ae==="Polygon")fn(Q,_e,ce,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(let Te of O.geometry.geometries)cr(le,{id:he,geometry:Te,properties:O.properties},U,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Te of Q){let ke=[];fn(Te,ke,ce,!0),_e.push(ke)}}le.push(Xi(he,ae,_e,O.properties))}function Vr(le,O){O.push(Ho(le[0]),Dn(le[1]),0)}function go(le,O,U,N){let Q,ae,ce=0;for(let he=0;he<le.length;he++){let Te=Ho(le[he][0]),ke=Dn(le[he][1]);O.push(Te,ke,0),he>0&&(ce+=N?(Q*ke-Te*ae)/2:Math.sqrt(Math.pow(Te-Q,2)+Math.pow(ke-ae,2))),Q=Te,ae=ke}let _e=O.length-3;O[2]=1,Ot(O,0,_e,U),O[_e+2]=1,O.size=Math.abs(ce),O.start=0,O.end=O.size}function fn(le,O,U,N){for(let Q=0;Q<le.length;Q++){let ae=[];go(le[Q],ae,U,N),O.push(ae)}}function Ho(le){return le/360+.5}function Dn(le){let O=Math.sin(le*Math.PI/180),U=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return U<0?0:U>1?1:U}function $n(le,O,U,N,Q,ae,ce,_e){if(N/=O,ae>=(U/=O)&&ce<N)return le;if(ce<U||ae>=N)return null;let he=[];for(let Te of le){let ke=Te.geometry,Pe=Te.type,Xe=Q===0?Te.minX:Te.minY,pe=Q===0?Te.maxX:Te.maxY;if(Xe>=U&&pe<N){he.push(Te);continue}if(pe<U||Xe>=N)continue;let lt=[];if(Pe==="Point"||Pe==="MultiPoint")Xo(ke,lt,U,N,Q);else if(Pe==="LineString")Ko(ke,lt,U,N,Q,!1,_e.lineMetrics);else if(Pe==="MultiLineString")hi(ke,lt,U,N,Q,!1);else if(Pe==="Polygon")hi(ke,lt,U,N,Q,!0);else if(Pe==="MultiPolygon")for(let xt of ke){let Je=[];hi(xt,Je,U,N,Q,!0),Je.length&&lt.push(Je)}if(lt.length){if(_e.lineMetrics&&Pe==="LineString"){for(let xt of lt)he.push(Xi(Te.id,Pe,xt,Te.tags));continue}Pe!=="LineString"&&Pe!=="MultiLineString"||(lt.length===1?(Pe="LineString",lt=lt[0]):Pe="MultiLineString"),Pe!=="Point"&&Pe!=="MultiPoint"||(Pe=lt.length===3?"Point":"MultiPoint"),he.push(Xi(Te.id,Pe,lt,Te.tags))}}return he.length?he:null}function Xo(le,O,U,N,Q){for(let ae=0;ae<le.length;ae+=3){let ce=le[ae+Q];ce>=U&&ce<=N&&fi(O,le[ae],le[ae+1],le[ae+2])}}function Ko(le,O,U,N,Q,ae,ce){let _e=Tn(le),he=Q===0?Gn:ur,Te,ke,Pe=le.start;for(let Je=0;Je<le.length-3;Je+=3){let pt=le[Je],Jt=le[Je+1],Pi=le[Je+2],Ci=le[Je+3],gi=le[Je+4],It=Q===0?pt:Jt,kt=Q===0?Ci:gi,vi=!1;ce&&(Te=Math.sqrt(Math.pow(pt-Ci,2)+Math.pow(Jt-gi,2))),It<U?kt>U&&(ke=he(_e,pt,Jt,Ci,gi,U),ce&&(_e.start=Pe+Te*ke)):It>N?kt<N&&(ke=he(_e,pt,Jt,Ci,gi,N),ce&&(_e.start=Pe+Te*ke)):fi(_e,pt,Jt,Pi),kt<U&&It>=U&&(ke=he(_e,pt,Jt,Ci,gi,U),vi=!0),kt>N&&It<=N&&(ke=he(_e,pt,Jt,Ci,gi,N),vi=!0),!ae&&vi&&(ce&&(_e.end=Pe+Te*ke),O.push(_e),_e=Tn(le)),ce&&(Pe+=Te)}let Xe=le.length-3,pe=le[Xe],lt=le[Xe+1],xt=Q===0?pe:lt;xt>=U&&xt<=N&&fi(_e,pe,lt,le[Xe+2]),Xe=_e.length-3,ae&&Xe>=3&&(_e[Xe]!==_e[0]||_e[Xe+1]!==_e[1])&&fi(_e,_e[0],_e[1],_e[2]),_e.length&&O.push(_e)}function Tn(le){let O=[];return O.size=le.size,O.start=le.start,O.end=le.end,O}function hi(le,O,U,N,Q,ae){for(let ce of le)Ko(ce,O,U,N,Q,ae,!1)}function fi(le,O,U,N){le.push(O,U,N)}function Gn(le,O,U,N,Q,ae){let ce=(ae-O)/(N-O);return fi(le,ae,U+(Q-U)*ce,1),ce}function ur(le,O,U,N,Q,ae){let ce=(ae-U)/(Q-U);return fi(le,O+(N-O)*ce,ae,1),ce}function _o(le,O){let U=[];for(let N=0;N<le.length;N++){let Q=le[N],ae=Q.type,ce;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")ce=hr(Q.geometry,O);else if(ae==="MultiLineString"||ae==="Polygon"){ce=[];for(let _e of Q.geometry)ce.push(hr(_e,O))}else if(ae==="MultiPolygon"){ce=[];for(let _e of Q.geometry){let he=[];for(let Te of _e)he.push(hr(Te,O));ce.push(he)}}U.push(Xi(Q.id,ae,ce,Q.tags))}return U}function hr(le,O){let U=[];U.size=le.size,le.start!==void 0&&(U.start=le.start,U.end=le.end);for(let N=0;N<le.length;N+=3)U.push(le[N]+O,le[N+1],le[N+2]);return U}function pr(le,O){if(le.transformed)return le;let U=1<<le.z,N=le.x,Q=le.y;for(let ae of le.features){let ce=ae.geometry,_e=ae.type;if(ae.geometry=[],_e===1)for(let he=0;he<ce.length;he+=2)ae.geometry.push(Yo(ce[he],ce[he+1],O,U,N,Q));else for(let he=0;he<ce.length;he++){let Te=[];for(let ke=0;ke<ce[he].length;ke+=2)Te.push(Yo(ce[he][ke],ce[he][ke+1],O,U,N,Q));ae.geometry.push(Te)}}return le.transformed=!0,le}function Yo(le,O,U,N,Q,ae){return[Math.round(U*(le*N-Q)),Math.round(U*(O*N-ae))]}function $r(le,O,U,N,Q){let ae=O===Q.maxZoom?0:Q.tolerance/((1<<O)*Q.extent),ce={features:[],numPoints:0,numSimplified:0,numFeatures:le.length,source:null,x:U,y:N,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let _e of le)Gr(ce,_e,ae,Q);return ce}function Gr(le,O,U,N){let Q=O.geometry,ae=O.type,ce=[];if(le.minX=Math.min(le.minX,O.minX),le.minY=Math.min(le.minY,O.minY),le.maxX=Math.max(le.maxX,O.maxX),le.maxY=Math.max(le.maxY,O.maxY),ae==="Point"||ae==="MultiPoint")for(let _e=0;_e<Q.length;_e+=3)ce.push(Q[_e],Q[_e+1]),le.numPoints++,le.numSimplified++;else if(ae==="LineString")Zr(ce,Q,le,U,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(let _e=0;_e<Q.length;_e++)Zr(ce,Q[_e],le,U,ae==="Polygon",_e===0);else if(ae==="MultiPolygon")for(let _e=0;_e<Q.length;_e++){let he=Q[_e];for(let Te=0;Te<he.length;Te++)Zr(ce,he[Te],le,U,!0,Te===0)}if(ce.length){let _e=O.tags||null;if(ae==="LineString"&&N.lineMetrics){_e={};for(let Te in O.tags)_e[Te]=O.tags[Te];_e.mapbox_clip_start=Q.start/Q.size,_e.mapbox_clip_end=Q.end/Q.size}let he={geometry:ce,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:_e};O.id!==null&&(he.id=O.id),le.features.push(he)}}function Zr(le,O,U,N,Q,ae){let ce=N*N;if(N>0&&O.size<(Q?ce:N))return void(U.numPoints+=O.length/3);let _e=[];for(let he=0;he<O.length;he+=3)(N===0||O[he+2]>ce)&&(U.numSimplified++,_e.push(O[he],O[he+1])),U.numPoints++;Q&&(function(he,Te){let ke=0;for(let Pe=0,Xe=he.length,pe=Xe-2;Pe<Xe;pe=Pe,Pe+=2)ke+=(he[Pe]-he[pe])*(he[Pe+1]+he[pe+1]);if(ke>0===Te)for(let Pe=0,Xe=he.length;Pe<Xe/2;Pe+=2){let pe=he[Pe],lt=he[Pe+1];he[Pe]=he[Xe-2-Pe],he[Pe+1]=he[Xe-1-Pe],he[Xe-2-Pe]=pe,he[Xe-1-Pe]=lt}})(_e,ae),le.push(_e)}let yo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class qr{constructor(O,U){let N=(U=this.options=(function(ae,ce){for(let _e in ce)ae[_e]=ce[_e];return ae})(Object.create(yo),U)).debug;if(N&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");let Q=(function(ae,ce){let _e=[];if(ae.type==="FeatureCollection")for(let he=0;he<ae.features.length;he++)cr(_e,ae.features[he],ce,he);else cr(_e,ae.type==="Feature"?ae:{geometry:ae},ce);return _e})(O,U);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Q=(function(ae,ce){let _e=ce.buffer/ce.extent,he=ae,Te=$n(ae,1,-1-_e,_e,0,-1,2,ce),ke=$n(ae,1,1-_e,2+_e,0,-1,2,ce);return(Te||ke)&&(he=$n(ae,1,-_e,1+_e,0,-1,2,ce)||[],Te&&(he=_o(Te,1).concat(he)),ke&&(he=he.concat(_o(ke,-1)))),he})(Q,U),Q.length&&this.splitTile(Q,0,0,0),N&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(O,U,N,Q,ae,ce,_e){let he=[O,U,N,Q],Te=this.options,ke=Te.debug;for(;he.length;){Q=he.pop(),N=he.pop(),U=he.pop(),O=he.pop();let Pe=1<<U,Xe=Wr(U,N,Q),pe=this.tiles[Xe];if(!pe&&(ke>1&&console.time("creation"),pe=this.tiles[Xe]=$r(O,U,N,Q,Te),this.tileCoords.push({z:U,x:N,y:Q}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,N,Q,pe.numFeatures,pe.numPoints,pe.numSimplified),console.timeEnd("creation"));let vi=`z${U}`;this.stats[vi]=(this.stats[vi]||0)+1,this.total++}if(pe.source=O,ae==null){if(U===Te.indexMaxZoom||pe.numPoints<=Te.indexMaxPoints)continue}else{if(U===Te.maxZoom||U===ae)continue;if(ae!=null){let vi=ae-U;if(N!==ce>>vi||Q!==_e>>vi)continue}}if(pe.source=null,O.length===0)continue;ke>1&&console.time("clipping");let lt=.5*Te.buffer/Te.extent,xt=.5-lt,Je=.5+lt,pt=1+lt,Jt=null,Pi=null,Ci=null,gi=null,It=$n(O,Pe,N-lt,N+Je,0,pe.minX,pe.maxX,Te),kt=$n(O,Pe,N+xt,N+pt,0,pe.minX,pe.maxX,Te);O=null,It&&(Jt=$n(It,Pe,Q-lt,Q+Je,1,pe.minY,pe.maxY,Te),Pi=$n(It,Pe,Q+xt,Q+pt,1,pe.minY,pe.maxY,Te),It=null),kt&&(Ci=$n(kt,Pe,Q-lt,Q+Je,1,pe.minY,pe.maxY,Te),gi=$n(kt,Pe,Q+xt,Q+pt,1,pe.minY,pe.maxY,Te),kt=null),ke>1&&console.timeEnd("clipping"),he.push(Jt||[],U+1,2*N,2*Q),he.push(Pi||[],U+1,2*N,2*Q+1),he.push(Ci||[],U+1,2*N+1,2*Q),he.push(gi||[],U+1,2*N+1,2*Q+1)}}getTile(O,U,N){O=+O,U=+U,N=+N;let Q=this.options,{extent:ae,debug:ce}=Q;if(O<0||O>24)return null;let _e=1<<O,he=Wr(O,U=U+_e&_e-1,N);if(this.tiles[he])return pr(this.tiles[he],ae);ce>1&&console.log("drilling down to z%d-%d-%d",O,U,N);let Te,ke=O,Pe=U,Xe=N;for(;!Te&&ke>0;)ke--,Pe>>=1,Xe>>=1,Te=this.tiles[Wr(ke,Pe,Xe)];return Te&&Te.source?(ce>1&&(console.log("found parent tile z%d-%d-%d",ke,Pe,Xe),console.time("drilling down")),this.splitTile(Te.source,ke,Pe,Xe,O,U,N),ce>1&&console.timeEnd("drilling down"),this.tiles[he]?pr(this.tiles[he],ae):null):null}}function Wr(le,O,U){return 32*((1<<le)*U+O)+le}class Hr extends Y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(O,U){return _._(this,void 0,void 0,function*(){let N=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let Q=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!Q)return null;let ae=new qe(Q.features,{version:2,extent:_.$}),ce=(function(_e){let he=new _.cM;return(function(Te,ke){for(let Pe in Te.layers)ke.writeMessage(3,Qe,Te.layers[Pe])})(_e,he),he.finish()})(ae);return ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),{vectorTile:ae,rawData:ce.buffer}})}loadData(O){return _._(this,void 0,void 0,function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();let N=!!(O&&O.request&&O.request.collectResourceTiming)&&new _.cN(O.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(O,this._pendingRequest);let Q=yield this._pendingData;this._geoJSONIndex=O.cluster?new Vn((function({superclusterOptions:ce,clusterProperties:_e}){if(!_e||!ce)return ce;let he={},Te={},ke={accumulated:null,zoom:0},Pe={properties:null},Xe=Object.keys(_e);for(let pe of Xe){let[lt,xt]=_e[pe],Je=_.cT(xt),pt=_.cT(typeof lt=="string"?[lt,["accumulated"],["get",pe]]:lt);he[pe]=Je.value,Te[pe]=pt.value}return ce.map=pe=>{Pe.properties=pe;let lt={};for(let xt of Xe)lt[xt]=he[xt].evaluate(ke,Pe);return lt},ce.reduce=(pe,lt)=>{Pe.properties=lt;for(let xt of Xe)ke.accumulated=pe[xt],pe[xt]=Te[xt].evaluate(ke,Pe)},ce})(O)).load(Q.features):(function(ce,_e){return new qr(ce,_e)})(Q,O.geojsonVtOptions),this.loaded={};let ae={data:Q};if(N){let ce=N.finish();ce&&(ae.resourceTiming={},ae.resourceTiming[O.source]=JSON.parse(JSON.stringify(ce)))}return ae}catch(Q){if(delete this._pendingRequest,_.cy(Q))return{abandoned:!0};throw Q}})}getData(){return _._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(O){let U=this.loaded;return U&&U[O.uid]?super.reloadTile(O):this.loadTile(O)}loadAndProcessGeoJSON(O,U){return _._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(O,U);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(Ae(N,!0),O.filter){let Q=_.cT(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(ce=>`${ce.key}: ${ce.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(ce=>Q.value.evaluate({zoom:0},ce))}}return N})}loadGeoJSON(O,U){return _._(this,void 0,void 0,function*(){let{promoteId:N}=O;if(O.request){let Q=yield _.j(O.request,U);return this._dataUpdateable=_.cV(Q.data,N)?_.cU(Q.data,N):void 0,Q.data}if(typeof O.data=="string")try{let Q=JSON.parse(O.data);return this._dataUpdateable=_.cV(Q,N)?_.cU(Q,N):void 0,Q}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return _.cW(this._dataUpdateable,O.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(O){return _._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}class Jo{constructor(O){this.self=O,this.actor=new _.J(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(U,N)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=N},this.self.addProtocol=_.cA,this.self.removeProtocol=_.cB,this.self.registerRTLTextPlugin=U=>{_.cX.setMethods(U)},this.actor.registerMessageHandler("LDT",(U,N)=>this._getDEMWorkerSource(U,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(U,N)=>_._(this,void 0,void 0,function*(){this._getDEMWorkerSource(U,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(U,N)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(U,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(U,N)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(U,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(U,N)=>_._(this,void 0,void 0,function*(){return this._getWorkerSource(U,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(U,N)=>this._getWorkerSource(U,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(U,N)=>this._getWorkerSource(U,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(U,N)=>this._getWorkerSource(U,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(U,N)=>this._getWorkerSource(U,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(U,N)=>this._getWorkerSource(U,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(U,N)=>this._getWorkerSource(U,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(U,N)=>_._(this,void 0,void 0,function*(){if(!this.workerSources[U]||!this.workerSources[U][N.type]||!this.workerSources[U][N.type][N.source])return;let Q=this.workerSources[U][N.type][N.source];delete this.workerSources[U][N.type][N.source],Q.removeSource!==void 0&&Q.removeSource(N)})),this.actor.registerMessageHandler("RM",U=>_._(this,void 0,void 0,function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U]})),this.actor.registerMessageHandler("SR",(U,N)=>_._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(U,N)=>this._syncRTLPluginState(U,N)),this.actor.registerMessageHandler("IS",(U,N)=>_._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(U,N)=>this._setImages(U,N)),this.actor.registerMessageHandler("UL",(U,N)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(U).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(U,N)=>_._(this,void 0,void 0,function*(){this._getLayerIndex(U).replace(N)}))}_setImages(O,U){return _._(this,void 0,void 0,function*(){this.availableImages[O]=U;for(let N in this.workerSources[O]){let Q=this.workerSources[O][N];for(let ae in Q)Q[ae].availableImages=U}})}_syncRTLPluginState(O,U){return _._(this,void 0,void 0,function*(){return yield _.cX.syncState(U,this.self.importScripts)})}_getAvailableImages(O){let U=this.availableImages[O];return U||(U=[]),U}_getLayerIndex(O){let U=this.layerIndexes[O];return U||(U=this.layerIndexes[O]=new o),U}_getWorkerSource(O,U,N){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][U]||(this.workerSources[O][U]={}),!this.workerSources[O][U][N]){let Q={sendAsync:(ae,ce)=>(ae.targetMapId=O,this.actor.sendAsync(ae,ce))};switch(U){case"vector":this.workerSources[O][U][N]=new Y(Q,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][U][N]=new Hr(Q,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][U][N]=new this.externalWorkerSourceTypes[U](Q,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][U][N]}_getDEMWorkerSource(O,U){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][U]||(this.demWorkerSources[O][U]=new ne),this.demWorkerSources[O][U]}}return _.i(self)&&(self.worker=new Jo(self)),Jo}),u("index",["exports","./shared"],function(_,o){"use strict";var C="5.7.0";function B(){var h=new o.A(4);return o.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}let $,Y,ne={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h,e,r){let s=requestAnimationFrame(p=>{c(),e(p)}),{unsubscribe:c}=o.s(h.signal,"abort",()=>{c(),cancelAnimationFrame(s),r(o.c())},!1)},frameAsync(h){return new Promise((e,r)=>{this.frame(h,e,r)})},getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){let e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,r.drawImage(h,0,0,h.width,h.height),r},resolveURL:h=>($||($=document.createElement("a")),$.href=h,$.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Y==null&&(Y=matchMedia("(prefers-reduced-motion: reduce)")),Y.matches)}};class q{static testProp(e){if(!q.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in q.docStyle)return e[r];return e[0]}static create(e,r,s){let c=window.document.createElement(e);return r!==void 0&&(c.className=r),s&&s.appendChild(c),c}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(e,r){e.style[q.transformProp]=r}static addEventListener(e,r,s,c={}){e.addEventListener(r,s,"passive"in c?c:c.capture)}static removeEventListener(e,r,s,c={}){e.removeEventListener(r,s,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",q.suppressClickInternal,!0)},0)}static getScale(e){let r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,s){let c=r.boundingClientRect;return new o.P((s.clientX-c.left)/r.x-e.clientLeft,(s.clientY-c.top)/r.y-e.clientTop)}static mousePos(e,r){let s=q.getScale(e);return q.getPoint(e,s,r)}static touchPos(e,r){let s=[],c=q.getScale(e);for(let p=0;p<r.length;p++)s.push(q.getPoint(e,c,r[p]));return s}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),s=r.querySelectorAll("script");for(let c of s)c.remove();return q.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){let s=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!s.includes("javascript:")&&!s.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let r=e.children;for(let s of r)q.removeAttributes(s),q.clean(s)}static removeAttributes(e){for(let{name:r,value:s}of e.attributes)q.isPossiblyDangerous(r,s)&&e.removeAttribute(r)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);let Ce={supported:!1,testSupport:function(h){!De&&Ae&&(qe?Qe(h):Ie=h)}},Ie,Ae,De=!1,qe=!1;function Qe(h){let e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Ae),h.isContextLost())return;Ce.supported=!0}catch{}h.deleteTexture(e),De=!0}var nt;typeof document<"u"&&(Ae=document.createElement("img"),Ae.onload=()=>{Ie&&Qe(Ie),Ie=null,qe=!0},Ae.onerror=()=>{De=!0,Ie=null},Ae.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(h){let e,r,s,c;h.resetRequestQueue=()=>{e=[],r=0,s=0,c={}},h.addThrottleControl=T=>{let P=s++;return c[P]=T,P},h.removeThrottleControl=T=>{delete c[T],y()},h.getImage=(T,P,M=!0)=>new Promise((k,A)=>{Ce.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),o.e(T,{type:"image"}),e.push({abortController:P,requestParameters:T,supportImageRefresh:M,state:"queued",onError:D=>{A(D)},onSuccess:D=>{k(D)}}),y()});let p=T=>o._(this,void 0,void 0,function*(){T.state="running";let{requestParameters:P,supportImageRefresh:M,onError:k,onSuccess:A,abortController:D}=T,F=M===!1&&!o.i(self)&&!o.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((W,X)=>W&&X==="accept",!0));r++;let Z=F?w(P,D):o.m(P,D);try{let W=yield Z;delete T.abortController,T.state="completed",W.data instanceof HTMLImageElement||o.b(W.data)?A(W):W.data&&A({data:yield(G=W.data,typeof createImageBitmap=="function"?o.f(G):o.h(G)),cacheControl:W.cacheControl,expires:W.expires})}catch(W){delete T.abortController,k(W)}finally{r--,y()}var G}),y=()=>{let T=(()=>{for(let P of Object.keys(c))if(c[P]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=r;P<T&&e.length>0;P++){let M=e.shift();M.abortController.signal.aborted?P--:p(M)}},w=(T,P)=>new Promise((M,k)=>{let A=new Image,D=T.url,F=T.credentials;F&&F==="include"?A.crossOrigin="use-credentials":(F&&F==="same-origin"||!o.d(D))&&(A.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{A.src="",k(o.c())}),A.fetchPriority="high",A.onload=()=>{A.onerror=A.onload=null,M({data:A})},A.onerror=()=>{A.onerror=A.onload=null,P.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},A.src=D})})(nt||(nt={})),nt.resetRequestQueue();class vt{constructor(e){this._transformRequestFn=e??null}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function tt(h){let e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){let r=[];for(let{id:s,url:c}of h){let p=`${s}${c}`;r.indexOf(p)===-1&&(r.push(p),e.push({id:s,url:c}))}}return e}function At(h,e,r){try{let s=new URL(h);return s.pathname+=`${e}${r}`,s.toString()}catch{throw new Error(`Invalid sprite URL "${h}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Yt(h){let{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class pn extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:r,promiseResolve:s}of this.requestors)s(this._getImagesForIds(r));this.requestors=[]}}getImage(e){let r=this.images[e];if(r&&!r.data&&r.spriteData){let s=r.spriteData;r.data=new o.R({width:s.width,height:s.height},s.context.getImageData(s.x,s.y,s.width,s.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let s=!0,c=r.data||r.spriteData;return this._validateStretch(r.stretchX,c&&c.width)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchX" value`))),s=!1),this._validateStretch(r.stretchY,c&&c.height)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchY" value`))),s=!1),this._validateContent(r.content,r)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "content" value`))),s=!1),s}_validateStretch(e,r){if(!e)return!0;let s=0;for(let c of e){if(c[0]<s||c[1]<c[0]||r<c[1])return!1;s=c[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;let s=r.spriteData,c=s&&s.width||r.data.width,p=s&&s.height||r.data.height;return!(e[0]<0||c<e[0]||e[1]<0||p<e[1]||e[2]<0||c<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,s=!0){let c=this.getImage(e);if(s&&(c.data.width!==r.data.width||c.data.height!==r.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=c.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){let r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,s)=>{let c=!0;if(!this.isLoaded())for(let p of e)this.images[p]||(c=!1);this.isLoaded()||c?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){let r={};for(let s of e){let c=this.getImage(s);c||(this.fire(new o.l("styleimagemissing",{id:s})),c=this.getImage(s)),c?r[s]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:o.w(`Image "${s}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){let{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){let r=this.patterns[e],s=this.getImage(e);if(!s)return null;if(r&&r.position.version===s.version)return r.position;if(r)r.position.version=s.version;else{let c={w:s.data.width+2,h:s.data.height+2,x:0,y:0},p=new o.I(c,s);this.patterns[e]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let p in this.patterns)e.push(this.patterns[p].bin);let{w:r,h:s}=o.p(e),c=this.atlasImage;c.resize({width:r||1,height:s||1});for(let p in this.patterns){let{bin:y}=this.patterns[p],w=y.x+1,T=y.y+1,P=this.getImage(p).data,M=P.width,k=P.height;o.R.copy(P,c,{x:0,y:0},{x:w,y:T},{width:M,height:k}),o.R.copy(P,c,{x:0,y:k-1},{x:w,y:T-1},{width:M,height:1}),o.R.copy(P,c,{x:0,y:0},{x:w,y:T+k},{width:M,height:1}),o.R.copy(P,c,{x:M-1,y:0},{x:w-1,y:T},{width:1,height:k}),o.R.copy(P,c,{x:0,y:0},{x:w+M,y:T},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;let s=this.getImage(r);s||o.w(`Image with ID: "${r}" was not found`),Yt(s)&&this.updateImage(r,s)}}}let Ii=1e20;function On(h,e,r,s,c,p,y,w,T){for(let P=e;P<e+s;P++)wn(h,r*p+P,p,c,y,w,T);for(let P=r;P<r+c;P++)wn(h,P*p+e,1,s,y,w,T)}function wn(h,e,r,s,c,p,y){p[0]=0,y[0]=-Ii,y[1]=Ii,c[0]=h[e];for(let w=1,T=0,P=0;w<s;w++){c[w]=h[e+w*r];let M=w*w;do{let k=p[T];P=(c[w]-c[k]+M-k*k)/(w-k)/2}while(P<=y[T]&&--T>-1);T++,p[T]=w,y[T]=P,y[T+1]=Ii}for(let w=0,T=0;w<s;w++){for(;y[T+1]<w;)T++;let P=p[T],M=w-P;h[e+w*r]=c[P]+M*M}}class Vn{constructor(e,r,s){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={},this.lang=s}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,function*(){let r=[];for(let p in e)for(let y of e[p])r.push(this._getAndCacheGlyphsPromise(p,y));let s=yield Promise.all(r),c={};for(let{stack:p,id:y,glyph:w}of s)c[p]||(c[p]={}),c[p][y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return c})}_getAndCacheGlyphsPromise(e,r){return o._(this,void 0,void 0,function*(){let s=this.entries[e];s||(s=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=s.glyphs[r];if(c!==void 0)return{stack:e,id:r,glyph:c};if(c=this._tinySDF(s,e,r),c)return s.glyphs[r]=c,{stack:e,id:r,glyph:c};let p=Math.floor(r/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(s.ranges[p])return{stack:e,id:r,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!s.requests[p]){let w=Vn.loadGlyphRange(e,p,this.url,this.requestManager);s.requests[p]=w}let y=yield s.requests[p];for(let w in y)this._doesCharSupportLocalGlyph(+w)||(s.glyphs[+w]=y[+w]);return s.ranges[p]=!0,{stack:e,id:r,glyph:y[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||o.u["CJK Unified Ideographs"](e)||o.u["Hangul Syllables"](e)||o.u.Hiragana(e)||o.u.Katakana(e)||o.u["CJK Symbols and Punctuation"](e)||o.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,r,s){let c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),p=e.tinySDF=new Vn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:c,fontWeight:w})}let y=p.draw(String.fromCharCode(s));return{id:s,bitmap:new o.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}Vn.loadGlyphRange=function(h,e,r,s){return o._(this,void 0,void 0,function*(){let c=256*e,p=c+255,y=s.transformRequest(r.replace("{fontstack}",h).replace("{range}",`${c}-${p}`),"Glyphs"),w=yield o.n(y,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${p}`);let T={};for(let P of o.o(w.data))T[P.id]=P;return T})},Vn.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:y="normal",lang:w=null}={}){this.buffer=e,this.cutoff=s,this.radius=r,this.lang=w;let T=this.size=h+4*e,P=this._createCanvas(T),M=this.ctx=P.getContext("2d",{willReadFrequently:!0});M.font=`${y} ${p} ${h}px ${c}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(h){let e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(h),y=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),T=Math.min(this.size-this.buffer,y+Math.ceil(s)),P=w+2*this.buffer,M=T+2*this.buffer,k=Math.max(P*M,0),A=new Uint8ClampedArray(k),D={data:A,width:P,height:M,glyphWidth:w,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return D;let{ctx:F,buffer:Z,gridInner:G,gridOuter:W}=this;this.lang&&(F.lang=this.lang),F.clearRect(Z,Z,w,T),F.fillText(h,Z,Z+y);let X=F.getImageData(Z,Z,w,T);W.fill(Ii,0,k),G.fill(0,0,k);for(let ee=0;ee<T;ee++)for(let K=0;K<w;K++){let ie=X.data[4*(ee*w+K)+3]/255;if(ie===0)continue;let oe=(ee+Z)*P+K+Z;if(ie===1)W[oe]=0,G[oe]=Ii;else{let J=.5-ie;W[oe]=J>0?J*J:0,G[oe]=J<0?J*J:0}}On(W,0,0,P,M,P,this.f,this.v,this.z),On(G,Z,Z,w,T,P,this.f,this.v,this.z);for(let ee=0;ee<k;ee++){let K=Math.sqrt(W[ee])-Math.sqrt(G[ee]);A[ee]=Math.round(255-255*(K/this.radius+this.cutoff))}return D}};class mo{constructor(){this.specification=o.v.light.position}possiblyEvaluate(e,r){return o.B(e.expression.evaluate(r))}interpolate(e,r,s){return{x:o.C.number(e.x,r.x,s),y:o.C.number(e.y,r.y,s),z:o.C.number(e.z,r.z,s)}}}let Ir;class Pr extends o.E{constructor(e){super(),Ir=Ir||new o.r({anchor:new o.D(o.v.light.anchor),position:new mo,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(Ir),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(o.x,e,r))for(let s in e){let c=e[s];s.endsWith("-transition")?this._transitionable.setTransition(s.slice(0,-11),c):this._transitionable.setValue(s,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,s){return(!s||s.validate!==!1)&&o.y(this,e.call(o.z,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}let Cr=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class Oa extends o.E{constructor(e){super(),this._transitionable=new o.t(Cr),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(e,r={}){if(!this._validate(o.G,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let s in e){let c=e[s];s.endsWith("-transition")?this._transitionable.setTransition(s.slice(0,-11),c):this._transitionable.setValue(s,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,s={}){return s?.validate!==!1&&o.y(this,e.call(o.z,o.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ot{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){let s=e.join(",")+String(r);return this.dashEntry[s]||(this.dashEntry[s]=this.addDash(e,r)),this.dashEntry[s]}getDashRanges(e,r,s){let c=[],p=e.length%2==1?-e[e.length-1]*s:0,y=e[0]*s,w=!0;c.push({left:p,right:y,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let P=1;P<e.length;P++){w=!w;let M=e[P];p=T*s,T+=M,y=T*s,c.push({left:p,right:y,isDash:w,zeroLength:M===0})}return c}addRoundDash(e,r,s){let c=r/2;for(let p=-s;p<=s;p++){let y=this.width*(this.nextRow+s+p),w=0,T=e[w];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++w]);let M=Math.abs(P-T.left),k=Math.abs(P-T.right),A=Math.min(M,k),D,F=p/s*(c+1);if(T.isDash){let Z=c-Math.abs(F);D=Math.sqrt(A*A+Z*Z)}else D=c-Math.sqrt(A*A+F*F);this.data[y+P]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){let T=e[w],P=e[w+1];T.zeroLength?e.splice(w,1):P&&P.isDash===T.isDash&&(P.left=T.left,e.splice(w,1))}let r=e[0],s=e[e.length-1];r.isDash===s.isDash&&(r.left=s.left-this.width,s.right=r.right+this.width);let c=this.width*this.nextRow,p=0,y=e[p];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++p]);let T=Math.abs(w-y.left),P=Math.abs(w-y.right),M=Math.min(T,P);this.data[c+w]=Math.max(0,Math.min(255,(y.isDash?M:-M)+128))}}addDash(e,r){let s=r?7:0,c=2*s+1;if(this.nextRow+c>this.height)return o.w("LineAtlas out of space"),null;let p=0;for(let w=0;w<e.length;w++)p+=e[w];if(p!==0){let w=this.width/p,T=this.getDashRanges(e,this.width,w);r?this.addRoundDash(T,w,s):this.addRegularDash(T)}let y={y:(this.nextRow+s+.5)/this.height,height:2*s/this.height,width:p};return this.nextRow+=c,this.dirty=!0,y}bind(e){let r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}let Nr="maplibre_preloaded_worker_pool";class Xi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Xi.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Nr]}numActive(){return Object.keys(this.active).length}}let fo=Math.floor(ne.hardwareConcurrency/2),cr,Vr;function go(){return cr||(cr=new Xi),cr}Xi.workerCount=o.H(globalThis)?Math.max(Math.min(fo,3),1):1;class fn{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;let s=this.workerPool.acquire(r);for(let c=0;c<s.length;c++){let p=new o.J(s[c],r);p.name=`Worker ${c}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){let s=[];for(let c of this.actors)s.push(c.sendAsync({type:e,data:r}));return Promise.all(s)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(let s of this.actors)s.registerMessageHandler(e,r)}}function Ho(){return Vr||(Vr=new fn(go(),o.K),Vr.registerMessageHandler("GR",(h,e,r)=>o.m(e,r))),Vr}function Dn(h,e){let r=o.L();return o.M(r,r,[1,1,0]),o.N(r,r,[.5*h.width,.5*h.height,1]),h.calculatePosMatrix?o.O(r,r,h.calculatePosMatrix(e.toUnwrapped())):r}function $n(h,e,r,s,c,p,y){var w;let T=(function(A,D,F){if(A)for(let Z of A){let G=D[Z];if(G&&G.source===F&&G.type==="fill-extrusion")return!0}else for(let Z in D){let G=D[Z];if(G.source===F&&G.type==="fill-extrusion")return!0}return!1})((w=c?.layers)!==null&&w!==void 0?w:null,e,h.id),P=p.maxPitchScaleFactor(),M=h.tilesIn(s,P,T);M.sort(Xo);let k=[];for(let A of M)k.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(e,r,h._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,c,p,P,Dn(h.transform,A.tileID),y?(D,F)=>y(A.tileID,D,F):void 0)});return(function(A,D){for(let F in A)for(let Z of A[F])Ko(Z,D);return A})((function(A){let D={},F={};for(let Z of A){let G=Z.queryResults,W=Z.wrappedTileID,X=F[W]=F[W]||{};for(let ee in G){let K=G[ee],ie=X[ee]=X[ee]||{},oe=D[ee]=D[ee]||[];for(let J of K)ie[J.featureIndex]||(ie[J.featureIndex]=!0,oe.push(J))}}return D})(k),h)}function Xo(h,e){let r=h.tileID,s=e.tileID;return r.overscaledZ-s.overscaledZ||r.canonical.y-s.canonical.y||r.wrap-s.wrap||r.canonical.x-s.canonical.x}function Ko(h,e){let r=h.feature,s=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=s}function Tn(h,e,r){return o._(this,void 0,void 0,function*(){let s=h;if(h.url?s=(yield o.j(e.transformRequest(h.url,"Source"),r)).data:yield ne.frameAsync(r),!s)return null;let c=o.Q(o.e(s,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in s&&s.vector_layers&&(c.vectorLayerIds=s.vector_layers.map(p=>p.id)),c})}class hi{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}extend(e){let r=this._sw,s=this._ne,c,p;if(e instanceof o.S)c=e,p=e;else{if(!(e instanceof hi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(hi.convert(e)):this.extend(o.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.S.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return r||s?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new o.S(c.lng,c.lat),this._ne=new o.S(p.lng,p.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:s}=o.S.convert(e),c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return e instanceof hi?e:e&&new hi(e)}static fromLngLat(e,r=0){let s=360*r/40075017,c=s/Math.cos(Math.PI/180*e.lat);return new hi(new o.S(e.lng-c,e.lat-s),new o.S(e.lng+c,e.lat+s))}adjustAntiMeridian(){let e=new o.S(this._sw.lng,this._sw.lat),r=new o.S(this._ne.lng,this._ne.lat);return new hi(e,e.lng>r.lng?new o.S(r.lng+360,r.lat):r)}}class fi{constructor(e,r,s){this.bounds=hi.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=s||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let r=Math.pow(2,e.z),s=Math.floor(o.V(this.bounds.getWest())*r),c=Math.floor(o.U(this.bounds.getNorth())*r),p=Math.ceil(o.V(this.bounds.getEast())*r),y=Math.ceil(o.U(this.bounds.getSouth())*r);return e.x>=s&&e.x<p&&e.y>=c&&e.y<y}}class Gn extends o.E{constructor(e,r,s,c){if(super(),this.id=e,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(r,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Tn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new fi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,function*(){let r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};s.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,y)=>{e.reloadPromise={resolve:p,reject:y}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{let p=yield e.actor.sendAsync({type:c,data:s},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){let s=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(s.resolve).catch(s.reject)}}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ur extends o.E{constructor(e,r,s,c){super(),this.id=e,this.dispatcher=s,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},r),o.e(this,o.Q(r,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let r=yield Tn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(o.e(this,r),r.bounds&&(this.tileBounds=new fi(r.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this.fire(new o.k(r))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,function*(){let r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let s=yield nt.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(s&&s.data){this.map._refreshExpiredTiles&&(s.cacheControl||s.expires)&&e.setExpiryData({cacheControl:s.cacheControl,expires:s.expires});let c=this.map.painter.context,p=c.gl,y=s.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new o.T(c,y,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(s){if(delete e.abortController,e.aborted)e.state="unloaded";else if(s)throw e.state="errored",s}})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class _o extends ur{constructor(e,r,s,c){super(e,r,s,c),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return o._(this,void 0,void 0,function*(){let r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),s=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let c=yield nt.getImage(s,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){let p=c.data;this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});let y=o.b(p)&&o.W()?p:yield this.readImageNow(p),w={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.X()){let r=e.width+2,s=e.height+2;try{return new o.R({width:r,height:s},yield o.Y(e,-1,-1,r,s))}catch{}}return ne.getImageData(e,1)})}_getNeighboringTiles(e){let r=e.canonical,s=Math.pow(2,r.z),c=(r.x-1+s)%s,p=r.x===0?e.wrap-1:e.wrap,y=(r.x+1+s)%s,w=r.x+1===s?e.wrap+1:e.wrap,T={};return T[new o.Z(e.overscaledZ,p,r.z,c,r.y).key]={backfilled:!1},T[new o.Z(e.overscaledZ,w,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(T[new o.Z(e.overscaledZ,p,r.z,c,r.y-1).key]={backfilled:!1},T[new o.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new o.Z(e.overscaledZ,w,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<s&&(T[new o.Z(e.overscaledZ,p,r.z,c,r.y+1).key]={backfilled:!1},T[new o.Z(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new o.Z(e.overscaledZ,w,r.z,y,r.y+1).key]={backfilled:!1}),T}unloadTile(e){return o._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class hr extends o.E{constructor(e,r,s,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=s.getActor(),this.setEventedParent(c),this._data=r.data,this._options=o.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(o.$/this.tileSize)}_getClusterMaxZoom(e){let r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=o.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return o._(this,void 0,void 0,function*(){let e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(r=>r.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,function*(){let e=new hi,r=yield this.getData(),s;switch(r.type){case"FeatureCollection":s=r.features.map(c=>this.getCoordinatesFromGeometry(c.geometry)).flat(1/0);break;case"Feature":s=this.getCoordinatesFromGeometry(r.geometry);break;default:s=this.getCoordinatesFromGeometry(r)}if(s.length==0)return e;for(let c=0;c<s.length-1;c+=2)e.extend([s[c],s[c+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,s){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:s}})}_updateWorkerData(){return o._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;let{data:e,diff:r}=this._pendingWorkerUpdate;if(!e&&!r)return void o.w(`No data or diff provided to GeoJSONSource ${this.id}.`);let s=o.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(s.request=this.map._requestManager.transformRequest(ne.resolveURL(e),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):r&&(s.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{let c=yield this.actor.sendAsync({type:"LD",data:s});if(this._isUpdatingWorker=!1,this._removed||c.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));this._data=c.data;let p=null;c.resourceTiming&&c.resourceTiming[this.id]&&(p=c.resourceTiming[this.id].slice(0));let y={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&o.e(y,{resourceTiming:p}),this.fire(new o.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(c){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(c))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return o._(this,void 0,void 0,function*(){let r=e.actor?"RT":"LT";e.actor=this.actor;let s={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;let c=yield this.actor.sendAsync({type:r,data:s},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,r==="RT")})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class pr extends o.E{constructor(e,r,s,c){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=s,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=r}load(e){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let r=yield nt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new o.k(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let r=e.map(o.a1.fromLngLat);var s;return this.tileID=(function(c){let p=o.a2.fromPoints(c),y=p.width(),w=p.height(),T=Math.max(y,w),P=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),M=Math.pow(2,P);return new o.a4(P,Math.floor((p.minX+p.maxX)/2*M),Math.floor((p.minY+p.maxY)/2*M))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(c=>this.tileID.getTilePoint(c)._round()),this.flippedWindingOrder=((s=this.tileCoords)[1].x-s[0].x)*(s[2].y-s[0].y)-(s[1].y-s[0].y)*(s[2].x-s[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new o.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let s=!1;for(let c in this.tiles){let p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,s=!0)}s&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let{minX:r,minY:s,maxX:c,maxY:p}=o.a2.fromPoints(e),y={};for(let w=0;w<=o.a3;w++){let T=Math.pow(2,w),P=Math.floor(r*T),M=Math.floor(s*T),k=Math.floor(c*T),A=Math.floor(p*T);y[w]={minTileX:P,minTileY:M,maxTileX:k,maxTileY:A}}return y}}class Yo extends pr{constructor(e,r,s,c){super(e,r,s,c),this.roundZoom=!0,this.type="video",this.options=r}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{let r=yield o.a5(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new o.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new o.k(new o.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let s=!1;for(let c in this.tiles){let p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,s=!0)}s&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class $r extends pr{constructor(e,r,s,c){super(e,r,s,c),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(y=>typeof y!="number"))||this.fire(new o.k(new o.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a6(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.k(new o.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let r=this.map.painter.context,s=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,s.RGBA,{premultiply:!0});let c=!1;for(let p in this.tiles){let y=this.tiles[p];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let Gr={},Zr=h=>{switch(h){case"geojson":return hr;case"image":return pr;case"raster":return ur;case"raster-dem":return _o;case"vector":return Gn;case"video":return Yo;case"canvas":return $r}return Gr[h]},yo="RTLPluginLoaded";class qr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ho()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,function*(r,s=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ne.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!s)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(yo))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Wr=null;function Hr(){return Wr||(Wr=new qr),Wr}class Jo{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=o.a7(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(c,p){let y={};if(!p)return y;for(let w of c){let T=w.layerIds.map(P=>p.getLayer(P)).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(P=>T.filter(M=>M.id===P)[0]));for(let P of T)y[P.id]=w}}return y})(e.buckets,r?.style),this.hasSymbolBuckets=!1;for(let c in this.buckets){let p=this.buckets[c];if(p instanceof o.a9){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let c in this.buckets){let p=this.buckets[c];if(p instanceof o.a9&&p.hasRTLText){this.hasRTLText=!0,Hr().lazyLoad();break}}this.queryPadding=0;for(let c in this.buckets){let p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o.a8}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let s in this.buckets){let c=this.buckets[s];c.uploadPending()&&c.upload(e)}let r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,c,p,y,w,T,P,M,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:y,tileSize:this.tileSize,pixelPosMatrix:M,transform:T,params:w,queryPadding:this.queryPadding*P,getElevation:k},e,r,s):{}}querySourceFeatures(e,r){let s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;let c=s.loadVTLayers(),p=r&&r.sourceLayer?r.sourceLayer:"",y=c._geojsonTileLayer||c[p];if(!y)return;let w=o.aa(r&&r.filter),{z:T,x:P,y:M}=this.tileID.canonical,k={z:T,x:P,y:M};for(let A=0;A<y.length;A++){let D=y.feature(A);if(w.needGeometry){let G=o.ab(D,!0);if(!w.filter(new o.F(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!w.filter(new o.F(this.tileID.overscaledZ),D))continue;let F=s.getId(D,p),Z=new o.ac(D,T,P,M,F);Z.tile=k,e.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let r=this.expirationTime;if(e.cacheControl){let s=o.ad(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let s=Date.now(),c=!1;if(this.expirationTime>s)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{let p=this.expirationTime-r;p?this.expirationTime=s+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let s=this.latestFeatureIndex.loadVTLayers();for(let c in this.buckets){if(!r.style.hasLayer(c))continue;let p=this.buckets[c],y=p.layers[0].sourceLayer||"_geojsonTileLayer",w=s[y],T=e[y];if(!w||!T||Object.keys(T).length===0)continue;p.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});let P=r&&r.style&&r.style.getLayer(c);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ne.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ne.now()+e}setDependencies(e,r){let s={};for(let c of r)s[c]=!0;this.dependencies[e]=s}hasDependency(e,r){for(let s of e){let c=this.dependencies[s];if(c){for(let p of r)if(c[p])return!0}}return!1}}class le{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(let e in this.data)for(let r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){let c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);let p={value:r,timeout:void 0};if(s!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},s)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){let y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){let r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;let s=e.wrapped().key,c=r===void 0?0:this.data[s].indexOf(r),p=this.data[s][c];return this.data[s].splice(c,1),p.timeout&&clearTimeout(p.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){let r=[];for(let s in this.data)for(let c of this.data[s])e(c.value)||r.push(c);for(let s of r)this.remove(s.value.tileID,s)}}class O{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){let c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},o.e(this.stateChanges[e][c],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(let p in this.state[e])p!==c&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(let p in this.state[e][c])s[p]||(this.deletedStates[e][c][p]=null)}else for(let p in s)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][p]===null&&delete this.deletedStates[e][c][p]}removeFeatureState(e,r,s){if(this.deletedStates[e]===null)return;let c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&r!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){let s=String(r),c=o.e({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let p=this.deletedStates[e][r];if(p===null)return{};for(let y in p)delete c[y]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){let s={};for(let c in this.stateChanges){this.state[c]=this.state[c]||{};let p={};for(let y in this.stateChanges[c])this.state[c][y]||(this.state[c][y]={}),o.e(this.state[c][y],this.stateChanges[c][y]),p[y]=this.state[c][y];s[c]=p}for(let c in this.deletedStates){this.state[c]=this.state[c]||{};let p={};if(this.deletedStates[c]===null)for(let y in this.state[c])p[y]={},this.state[c][y]={};else for(let y in this.deletedStates[c]){if(this.deletedStates[c][y]===null)this.state[c][y]={};else for(let w of Object.keys(this.deletedStates[c][y]))delete this.state[c][y][w];p[y]=this.state[c][y]}s[c]=s[c]||{},o.e(s[c],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(let c in e)e[c].setFeatureState(s,r)}}let U=89.25;function N(h,e){let r=o.ah(e.lat,-o.ai,o.ai);return new o.P(o.V(e.lng)*h,o.U(r)*h)}function Q(h,e){return new o.a1(e.x/h,e.y/h).toLngLat()}function ae(h){return h.cameraToCenterDistance*Math.min(.85*Math.tan(o.ae(90-h.pitch)),Math.tan(o.ae(U-h.pitch)))}function ce(h,e){let r=h.canonical,s=e/o.af(r.z),c=r.x+Math.pow(2,r.z)*h.wrap,p=o.ag(new Float64Array(16));return o.M(p,p,[c*s,r.y*s,0]),o.N(p,p,[s/o.$,s/o.$,1]),p}function _e(h,e,r,s,c){let p=o.a1.fromLngLat(h,e),y=c*o.aj(1,h.lat),w=y*Math.cos(o.ae(r)),T=Math.sqrt(y*y-w*w),P=T*Math.sin(o.ae(-s)),M=T*Math.cos(o.ae(-s));return new o.a1(p.x+P,p.y+M,p.z+w)}function he(h,e,r){let s=e.intersectsFrustum(h);if(!r||s===0)return s;let c=e.intersectsPlane(r);return c===0?0:s===2&&c===2?2:1}function Te(h,e,r){let s=0,c=(r-e)/10;for(let p=0;p<10;p++)s+=c*Math.pow(Math.cos(e+(p+.5)/10*(r-e)),h);return s}function ke(h,e){return function(r,s,c,p,y){let w=2*((h-1)/o.ak(Math.cos(o.ae(U-y))/Math.cos(o.ae(U)))-1),T=Math.acos(c/p),P=2*Te(w-1,0,o.ae(y/2)),M=Math.min(o.ae(U),T+o.ae(y/2)),k=Te(w-1,Math.min(M,T-o.ae(y/2)),M),A=Math.atan(s/c),D=Math.hypot(s,c),F=r;return F+=o.ak(p/D/Math.max(.5,Math.cos(o.ae(y/2)))),F+=w*o.ak(Math.cos(A))/2,F-=o.ak(Math.max(1,k/P/e))/2,F}}let Pe=ke(9.314,3);function Xe(h,e){let r=(e.roundZoom?Math.round:Math.floor)(h.zoom+o.ak(h.tileSize/e.tileSize));return Math.max(0,r)}function pe(h,e){let r=h.getCameraFrustum(),s=h.getClippingPlane(),c=h.screenPointToMercatorCoordinate(h.getCameraPoint()),p=o.a1.fromLngLat(h.center,h.elevation);c.z=p.z+Math.cos(h.pitchInRadians)*h.cameraToCenterDistance/h.worldSize;let y=h.getCoveringTilesDetailsProvider(),w=y.allowVariableZoom(h,e),T=Xe(h,e),P=e.minzoom||0,M=e.maxzoom!==void 0?e.maxzoom:h.maxZoom,k=Math.min(Math.max(0,T),M),A=Math.pow(2,k),D=[A*c.x,A*c.y,0],F=[A*p.x,A*p.y,0],Z=Math.hypot(p.x-c.x,p.y-c.y),G=Math.abs(p.z-c.z),W=Math.hypot(Z,G),X=ie=>({zoom:0,x:0,y:0,wrap:ie,fullyVisible:!1}),ee=[],K=[];if(h.renderWorldCopies&&y.allowWorldCopies())for(let ie=1;ie<=3;ie++)ee.push(X(-ie)),ee.push(X(ie));for(ee.push(X(0));ee.length>0;){let ie=ee.pop(),oe=ie.x,J=ie.y,ue=ie.fullyVisible,xe={x:oe,y:J,z:ie.zoom},de=y.getTileBoundingVolume(xe,ie.wrap,h.elevation,e);if(!ue){let Be=he(r,de,s);if(Be===0)continue;ue=Be===2}let me=y.distanceToTile2d(c.x,c.y,xe,de),ye=T;w&&(ye=(e.calculateTileZoom||Pe)(h.zoom+o.ak(h.tileSize/e.tileSize),me,G,W,h.fov)),ye=(e.roundZoom?Math.round:Math.floor)(ye),ye=Math.max(0,ye);let ze=Math.min(ye,M);if(ie.wrap=y.getWrap(p,xe,ie.wrap),ie.zoom>=ze){if(ie.zoom<P)continue;let Be=k-ie.zoom,Me=D[0]-.5-(oe<<Be),We=D[1]-.5-(J<<Be),gt=e.reparseOverscaled?Math.max(ie.zoom,ye):ie.zoom;K.push({tileID:new o.Z(ie.zoom===M?gt:ie.zoom,ie.wrap,ie.zoom,oe,J),distanceSq:o.al([F[0]-.5-oe,F[1]-.5-J]),tileDistanceToCamera:Math.sqrt(Me*Me+We*We)})}else for(let Be=0;Be<4;Be++)ee.push({zoom:ie.zoom+1,x:(oe<<1)+Be%2,y:(J<<1)+(Be>>1),wrap:ie.wrap,fullyVisible:ue})}return K.sort((ie,oe)=>ie.distanceSq-oe.distanceSq).map(ie=>ie.tileID)}let lt=o.a2.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class xt extends o.E{constructor(e,r,s){super(),this.id=e,this.dispatcher=s,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,p,y,w)=>{let T=new(Zr(p.type))(c,p,y,w);if(T.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${T.id}`);return T})(e,r,s,this),this._tiles={},this._cache=new le(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new O,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,s){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,s)}catch(c){e.state="errored",c.status!==404?this._source.fire(new o.k(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let r in this._tiles){let s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Je).map(e=>e.key)}getRenderableIds(e){let r=[];for(let s in this._tiles)this._isIdRenderable(s,e)&&r.push(this._tiles[s]);return e?r.sort((s,c)=>{let p=s.tileID,y=c.tileID,w=new o.P(p.canonical.x,p.canonical.y)._rotate(-this.transform.bearingInRadians),T=new o.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return p.overscaledZ-y.overscaledZ||T.y-w.y||T.x-w.x}).map(s=>s.tileID.key):r.map(s=>s.tileID).sort(Je).map(s=>s.key)}hasRenderableParent(e){let r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let r in this._tiles)e?this._reloadTile(r,"expired"):this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(e,r){return o._(this,void 0,void 0,function*(){let s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=r),yield this._loadTile(s,e,r))})}_tileLoaded(e,r,s){e.timeAdded=ne.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let r=this.getRenderableIds();for(let c=0;c<r.length;c++){let p=r[c];if(e.neighboringTiles&&e.neighboringTiles[p]){let y=this.getTileByID(p);s(e,y),s(y,e)}}function s(c,p){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let y=p.tileID.canonical.x-c.tileID.canonical.x,w=p.tileID.canonical.y-c.tileID.canonical.y,T=Math.pow(2,c.tileID.canonical.z),P=p.tileID.key;y===0&&w===0||Math.abs(w)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,y,w),c.neighboringTiles&&c.neighboringTiles[P]&&(c.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,c){for(let p in this._tiles){let y=this._tiles[p];if(c[p]||!y.hasData()||y.tileID.overscaledZ<=r||y.tileID.overscaledZ>s)continue;let w=y.tileID;for(;y&&y.tileID.overscaledZ>r+1;){let P=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[P.key],y&&y.hasData()&&(w=P)}let T=w;for(;T.overscaledZ>r;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]||e[T.canonical.key]){c[w.key]=w;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){let s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){let c=e.scaledTo(s),p=this._getLoadedTile(c);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let r=Math.ceil(e.width/this._source.tileSize)+1,s=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(r*s*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(e){let r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){let s={};for(let c in this._tiles){let p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),s[p.tileID.key]=p}this._tiles=s;for(let c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(let c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,r,s,c,p,y){let w={},T={},P=Object.keys(e),M=ne.now();for(let k of P){let A=e[k],D=this._tiles[k];if(!D||D.fadeEndTime!==0&&D.fadeEndTime<=M)continue;let F=this.findLoadedParent(A,r),Z=this.findLoadedSibling(A),G=F||Z||null;G&&(this._addTile(G.tileID),w[G.tileID.key]=G.tileID),T[k]=A}this._retainLoadedChildren(T,c,s,e);for(let k in w)e[k]||(this._coveredTiles[k]=!0,e[k]=w[k]);if(y){let k={},A={};for(let D of p)this._tiles[D.key].hasData()?k[D.key]=D:A[D.key]=D;for(let D in A){let F=A[D].children(this._source.maxzoom);this._tiles[F[0].key]&&this._tiles[F[1].key]&&this._tiles[F[2].key]&&this._tiles[F[3].key]&&(k[F[0].key]=e[F[0].key]=F[0],k[F[1].key]=e[F[1].key]=F[1],k[F[2].key]=e[F[2].key]=F[2],k[F[3].key]=e[F[3].key]=F[3],delete A[D])}for(let D in A){let F=A[D],Z=this.findLoadedParent(F,this._source.minzoom),G=this.findLoadedSibling(F),W=Z||G||null;if(W){k[W.tileID.key]=e[W.tileID.key]=W.tileID;for(let X in k)k[X].isChildOf(W.tileID)&&delete k[X]}}for(let D in this._tiles)k[D]||(this._coveredTiles[D]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let s;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new o.Z(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(s=pe(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(s=s.filter(M=>this._source.hasTile(M)))):s=[];let c=Xe(e,this._source),p=Math.max(c-xt.maxOverzooming,this._source.minzoom),y=Math.max(c+xt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let M={};for(let k of s)if(k.canonical.z>this._source.minzoom){let A=k.scaledTo(k.canonical.z-1);M[A.key]=A;let D=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));M[D.key]=D}s=s.concat(Object.values(M))}let w=s.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let T=this._updateRetainedTiles(s,c);pt(this._source.type)&&this._updateCoveredAndRetainedTiles(T,p,y,c,s,r);for(let M in T)this._tiles[M].clearFadeHold();let P=o.am(this._tiles,T);for(let M of P){let k=this._tiles[M];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var s;let c={},p={},y=Math.max(r-xt.maxOverzooming,this._source.minzoom),w=Math.max(r+xt.maxUnderzooming,this._source.minzoom),T={};for(let P of e){let M=this._addTile(P);c[P.key]=P,M.hasData()||r<this._source.maxzoom&&(T[P.key]=P)}this._retainLoadedChildren(T,r,w,c);for(let P of e){let M=this._tiles[P.key];if(M.hasData())continue;if(r+1>this._source.maxzoom){let A=P.children(this._source.maxzoom)[0],D=this.getTile(A);if(D&&D.hasData()){c[A.key]=A;continue}}else{let A=P.children(this._source.maxzoom);if(c[A[0].key]&&c[A[1].key]&&c[A[2].key]&&c[A[3].key])continue}let k=M.wasRequested();for(let A=P.overscaledZ-1;A>=y;--A){let D=P.scaledTo(A);if(p[D.key])break;if(p[D.key]=!0,M=this.getTile(D),!M&&k&&(M=this._addTile(D)),M){let F=M.hasData();if((F||!(!((s=this.map)===null||s===void 0)&&s.cancelPendingTileRequestsWhileZooming)||k)&&(c[D.key]=D),k=M.wasRequested(),F)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let r=[],s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}r.push(c.key);let p=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(p),s)break;c=p}for(let p of r)this._loadedParentTiles[p]=s}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let r=this._tiles[e].tileID,s=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));let s=r;return r||(r=new Jo(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,s||this._source.fire(new o.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}refreshTiles(e){for(let r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some(s=>s.equals(this._tiles[r].tileID.canonical))&&this._reloadTile(r,"expired")}_removeTile(e){let r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){let r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,s){let c=[],p=this.transform;if(!p)return c;let y=p.getCoveringTilesDetailsProvider().allowWorldCopies(),w=s?p.getCameraQueryGeometry(e):e,T=D=>p.screenPointToMercatorCoordinate(D,this.terrain),P=this.transformBbox(e,T,!y),M=this.transformBbox(w,T,!y),k=this.getIds(),A=o.a2.fromPoints(M);for(let D=0;D<k.length;D++){let F=this._tiles[k[D]];if(F.holdingForFade())continue;let Z=y?[F.tileID]:[F.tileID.unwrapTo(-1),F.tileID.unwrapTo(0)],G=Math.pow(2,p.zoom-F.tileID.overscaledZ),W=r*F.queryPadding*o.$/F.tileSize/G;for(let X of Z){let ee=A.map(K=>X.getTilePoint(new o.a1(K.x,K.y)));if(ee.expandBy(W),ee.intersects(lt)){let K=P.map(oe=>X.getTilePoint(oe)),ie=M.map(oe=>X.getTilePoint(oe));c.push({tile:F,tileID:y?X:X.unwrapTo(0),queryGeometry:K,cameraQueryGeometry:ie,scale:G})}}}return c}transformBbox(e,r,s){let c=e.map(r);if(s){let p=o.a2.fromPoints(e);p.shrinkBy(.001*Math.min(p.width(),p.height()));let y=p.map(r);o.a2.fromPoints(c).covers(y)||(c=c.map(w=>w.x>.5?new o.a1(w.x-1,w.y,w.z):w))}return c}getVisibleCoordinates(e){let r=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(pt(this._source.type)){let e=ne.now();for(let r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){let c=this._tiles[e];c&&c.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(let s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}}function Je(h,e){let r=Math.abs(2*h.wrap)-+(h.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||s-r||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function pt(h){return h==="raster"||h==="image"||h==="video"}xt.maxOverzooming=10,xt.maxUnderzooming=3;class Jt{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let s=1;s<this.points.length;s++)this._distances[s]=this._distances[s-1]+this.points[s].dist(this.points[s-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.ah(e,0,1);let r=1,s=this._distances[r],c=e*this.paddedLength+this.padding;for(;s<c&&r<this._distances.length;)s=this._distances[++r];let p=r-1,y=this._distances[p],w=s-y,T=w>0?(c-y)/w:0;return this.points[p].mult(1-T).add(this.points[r].mult(T))}}function Pi(h,e){let r=!0;return h==="always"||h!=="never"&&e!=="never"||(r=!1),r}class Ci{constructor(e,r,s){let c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/s),this.yCellCount=Math.ceil(r/s);for(let y=0;y<this.xCellCount*this.yCellCount;y++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,s,c,p){this._forEachCell(r,s,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(e,r,s,c){this._forEachCell(r-c,s-c,r+c,s+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(s),this.circles.push(c)}_insertBoxCell(e,r,s,c,p,y){this.boxCells[p].push(y)}_insertCircleCell(e,r,s,c,p,y){this.circleCells[p].push(y)}_query(e,r,s,c,p,y,w){if(s<0||e>this.width||c<0||r>this.height)return[];let T=[];if(e<=0&&r<=0&&this.width<=s&&this.height<=c){if(p)return[{key:null,x1:e,y1:r,x2:s,y2:c}];for(let P=0;P<this.boxKeys.length;P++)T.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){let M=this.circles[3*P],k=this.circles[3*P+1],A=this.circles[3*P+2];T.push({key:this.circleKeys[P],x1:M-A,y1:k-A,x2:M+A,y2:k+A})}}else this._forEachCell(e,r,s,c,this._queryCell,T,{hitTest:p,overlapMode:y,seenUids:{box:{},circle:{}}},w);return T}query(e,r,s,c){return this._query(e,r,s,c,!1,null)}hitTest(e,r,s,c,p,y){return this._query(e,r,s,c,!0,p,y).length>0}hitTestCircle(e,r,s,c,p){let y=e-s,w=e+s,T=r-s,P=r+s;if(w<0||y>this.width||P<0||T>this.height)return!1;let M=[];return this._forEachCell(y,T,w,P,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:e,y:r,radius:s},seenUids:{box:{},circle:{}}},p),M.length>0}_queryCell(e,r,s,c,p,y,w,T){let{seenUids:P,hitTest:M,overlapMode:k}=w,A=this.boxCells[p];if(A!==null){let F=this.bboxes;for(let Z of A)if(!P.box[Z]){P.box[Z]=!0;let G=4*Z,W=this.boxKeys[Z];if(e<=F[G+2]&&r<=F[G+3]&&s>=F[G+0]&&c>=F[G+1]&&(!T||T(W))&&(!M||!Pi(k,W.overlapMode))&&(y.push({key:W,x1:F[G],y1:F[G+1],x2:F[G+2],y2:F[G+3]}),M))return!0}}let D=this.circleCells[p];if(D!==null){let F=this.circles;for(let Z of D)if(!P.circle[Z]){P.circle[Z]=!0;let G=3*Z,W=this.circleKeys[Z];if(this._circleAndRectCollide(F[G],F[G+1],F[G+2],e,r,s,c)&&(!T||T(W))&&(!M||!Pi(k,W.overlapMode))){let X=F[G],ee=F[G+1],K=F[G+2];if(y.push({key:W,x1:X-K,y1:ee-K,x2:X+K,y2:ee+K}),M)return!0}}}return!1}_queryCellCircle(e,r,s,c,p,y,w,T){let{circle:P,seenUids:M,overlapMode:k}=w,A=this.boxCells[p];if(A!==null){let F=this.bboxes;for(let Z of A)if(!M.box[Z]){M.box[Z]=!0;let G=4*Z,W=this.boxKeys[Z];if(this._circleAndRectCollide(P.x,P.y,P.radius,F[G+0],F[G+1],F[G+2],F[G+3])&&(!T||T(W))&&!Pi(k,W.overlapMode))return y.push(!0),!0}}let D=this.circleCells[p];if(D!==null){let F=this.circles;for(let Z of D)if(!M.circle[Z]){M.circle[Z]=!0;let G=3*Z,W=this.circleKeys[Z];if(this._circlesCollide(F[G],F[G+1],F[G+2],P.x,P.y,P.radius)&&(!T||T(W))&&!Pi(k,W.overlapMode))return y.push(!0),!0}}}_forEachCell(e,r,s,c,p,y,w,T){let P=this._convertToXCellCoord(e),M=this._convertToYCellCoord(r),k=this._convertToXCellCoord(s),A=this._convertToYCellCoord(c);for(let D=P;D<=k;D++)for(let F=M;F<=A;F++)if(p.call(this,e,r,s,c,this.xCellCount*F+D,y,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,s,c,p,y){let w=c-e,T=p-r,P=s+y;return P*P>w*w+T*T}_circleAndRectCollide(e,r,s,c,p,y,w){let T=(y-c)/2,P=Math.abs(e-(c+T));if(P>T+s)return!1;let M=(w-p)/2,k=Math.abs(r-(p+M));if(k>M+s)return!1;if(P<=T||k<=M)return!0;let A=P-T,D=k-M;return A*A+D*D<=s*s}}function gi(h,e,r){let s=o.L();if(!h){let{vecSouth:k,vecEast:A}=kt(e),D=B();D[0]=A[0],D[1]=A[1],D[2]=k[0],D[3]=k[1],c=D,(M=(y=(p=D)[0])*(P=p[3])-(T=p[2])*(w=p[1]))&&(c[0]=P*(M=1/M),c[1]=-w*M,c[2]=-T*M,c[3]=y*M),s[0]=D[0],s[1]=D[1],s[4]=D[2],s[5]=D[3]}var c,p,y,w,T,P,M;return o.N(s,s,[1/r,1/r,1]),s}function It(h,e,r,s){if(h){let c=o.L();if(!e){let{vecSouth:p,vecEast:y}=kt(r);c[0]=y[0],c[1]=y[1],c[4]=p[0],c[5]=p[1]}return o.N(c,c,[s,s,1]),c}return r.pixelsToClipSpaceMatrix}function kt(h){let e=Math.cos(h.rollInRadians),r=Math.sin(h.rollInRadians),s=Math.cos(h.pitchInRadians),c=Math.cos(h.bearingInRadians),p=Math.sin(h.bearingInRadians),y=o.ar();y[0]=-c*s*r-p*e,y[1]=-p*s*r+c*e;let w=o.as(y);w<1e-9?o.at(y):o.au(y,y,1/w);let T=o.ar();T[0]=c*s*e-p*r,T[1]=p*s*e+c*r;let P=o.as(T);return P<1e-9?o.at(T):o.au(T,T,1/P),{vecEast:T,vecSouth:y}}function vi(h,e,r,s){let c;s?(c=[h,e,s(h,e),1],o.aw(c,c,r)):(c=[h,e,0,1],ea(c,c,r));let p=c[3];return{point:new o.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function Re(h,e){return .5+h/e*.5}function Ki(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function si(h,e,r,s,c,p,y,w,T,P,M,k,A){let D=r?h.textSizeData:h.iconSizeData,F=o.an(D,e.transform.zoom),Z=[256/e.width*2+1,256/e.height*2+1],G=r?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();let W=h.lineVertexArray,X=r?h.text.placedSymbolArray:h.icon.placedSymbolArray,ee=e.transform.width/e.transform.height,K=!1;for(let ie=0;ie<X.length;ie++){let oe=X.get(ie);if(oe.hidden||oe.writingMode===o.ao.vertical&&!K){dr(oe.numGlyphs,G);continue}K=!1;let J=new o.P(oe.anchorX,oe.anchorY),ue={getElevation:A,pitchedLabelPlaneMatrix:s,lineVertexArray:W,pitchWithMap:p,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:J,unwrappedTileID:T,width:P,height:M,translation:k},xe=Kr(oe.anchorX,oe.anchorY,ue);if(!Ki(xe.point,Z)){dr(oe.numGlyphs,G);continue}let de=Re(e.transform.cameraToCenterDistance,xe.signedDistanceFromCamera),me=o.ap(D,F,oe),ye=p?me*e.transform.getPitchedTextCorrection(oe.anchorX,oe.anchorY,T)/de:me*de,ze=$e({projectionContext:ue,pitchedLabelPlaneMatrixInverse:c,symbol:oe,fontSize:ye,flip:!1,keepUpright:y,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:G,aspectRatio:ee,rotateToLine:w});K=ze.useVertical,(ze.notEnoughRoom||K||ze.needsFlipping&&$e({projectionContext:ue,pitchedLabelPlaneMatrixInverse:c,symbol:oe,fontSize:ye,flip:!0,keepUpright:y,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:G,aspectRatio:ee,rotateToLine:w}).notEnoughRoom)&&dr(oe.numGlyphs,G)}r?h.text.dynamicLayoutVertexBuffer.updateData(G):h.icon.dynamicLayoutVertexBuffer.updateData(G)}function Xr(h,e,r,s,c,p,y,w){let T=p.glyphStartIndex+p.numGlyphs,P=p.lineStartIndex,M=p.lineStartIndex+p.lineLength,k=e.getoffsetX(p.glyphStartIndex),A=e.getoffsetX(T-1),D=Yr(h*k,r,s,c,p.segment,P,M,w,y);if(!D)return null;let F=Yr(h*A,r,s,c,p.segment,P,M,w,y);return F?w.projectionCache.anyProjectionOccluded?null:{first:D,last:F}:null}function Qo(h,e,r,s){return h===o.ao.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*s?{useVertical:!0}:(h===o.ao.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function $e(h){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:s,fontSize:c,flip:p,keepUpright:y,glyphOffsetArray:w,dynamicLayoutVertexArray:T,aspectRatio:P,rotateToLine:M}=h,k=c/24,A=s.lineOffsetX*k,D=s.lineOffsetY*k,F;if(s.numGlyphs>1){let Z=s.glyphStartIndex+s.numGlyphs,G=s.lineStartIndex,W=s.lineStartIndex+s.lineLength,X=Xr(k,w,A,D,p,s,M,e);if(!X)return{notEnoughRoom:!0};let ee=vo(X.first.point.x,X.first.point.y,e,r),K=vo(X.last.point.x,X.last.point.y,e,r);if(y&&!p){let ie=Qo(s.writingMode,ee,K,P);if(ie)return ie}F=[X.first];for(let ie=s.glyphStartIndex+1;ie<Z-1;ie++){let oe=Yr(k*w.getoffsetX(ie),A,D,p,s.segment,G,W,e,M);if(!oe)return{notEnoughRoom:!0};F.push(oe)}F.push(X.last)}else{if(y&&!p){let G=Gi(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,W=s.lineStartIndex+s.segment+1,X=new o.P(e.lineVertexArray.getx(W),e.lineVertexArray.gety(W)),ee=Gi(X.x,X.y,e),K=ee.signedDistanceFromCamera>0?ee.point:bt(e.tileAnchorPoint,X,G,1,e),ie=vo(G.x,G.y,e,r),oe=vo(K.x,K.y,e,r),J=Qo(s.writingMode,ie,oe,P);if(J)return J}let Z=Yr(k*w.getoffsetX(s.glyphStartIndex),A,D,p,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,e,M);if(!Z||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};F=[Z]}for(let Z of F)o.av(T,Z.point,Z.angle);return{}}function bt(h,e,r,s,c){let p=h.add(h.sub(e)._unit()),y=Gi(p.x,p.y,c).point,w=r.sub(y);return r.add(w._mult(s/w.mag()))}function _t(h,e,r){let s=e.projectionCache;if(s.projections[h])return s.projections[h];let c=new o.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),p=Gi(c.x,c.y,e);if(p.signedDistanceFromCamera>0)return s.projections[h]=p.point,s.anyProjectionOccluded=s.anyProjectionOccluded||p.isOccluded,p.point;let y=h-r.direction;return bt(r.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),c,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Gi(h,e,r){let s=h+r.translation[0],c=e+r.translation[1],p;return r.pitchWithMap?(p=vi(s,c,r.pitchedLabelPlaneMatrix,r.getElevation),p.isOccluded=!1):(p=r.transform.projectTileCoordinates(s,c,r.unwrappedTileID,r.getElevation),p.point.x=(.5*p.point.x+.5)*r.width,p.point.y=(.5*-p.point.y+.5)*r.height),p}function vo(h,e,r,s){if(r.pitchWithMap){let c=[h,e,0,1];return o.aw(c,c,s),r.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],r.unwrappedTileID,r.getElevation).point}return{x:h/r.width*2-1,y:1-e/r.height*2}}function Kr(h,e,r){return r.transform.projectTileCoordinates(h,e,r.unwrappedTileID,r.getElevation)}function ft(h,e,r){return h._unit()._perp()._mult(e*r)}function Es(h,e,r,s,c,p,y,w,T){if(w.projectionCache.offsets[h])return w.projectionCache.offsets[h];let P=r.add(e);if(h+T.direction<s||h+T.direction>=c)return w.projectionCache.offsets[h]=P,P;let M=_t(h+T.direction,w,T),k=ft(M.sub(r),y,T.direction),A=r.add(k),D=M.add(k);return w.projectionCache.offsets[h]=o.ax(p,P,A,D)||P,w.projectionCache.offsets[h]}function Yr(h,e,r,s,c,p,y,w,T){let P=s?h-e:h+e,M=P>0?1:-1,k=0;s&&(M*=-1,k=Math.PI),M<0&&(k+=Math.PI);let A,D=M>0?p+c:p+c+1;w.projectionCache.cachedAnchorPoint?A=w.projectionCache.cachedAnchorPoint:(A=Gi(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=A);let F,Z,G=A,W=A,X=0,ee=0,K=Math.abs(P),ie=[],oe;for(;X+ee<=K;){if(D+=M,D<p||D>=y)return null;X+=ee,W=G,Z=F;let xe={absOffsetX:K,direction:M,distanceFromAnchor:X,previousVertex:W};if(G=_t(D,w,xe),r===0)ie.push(W),oe=G.sub(W);else{let de,me=G.sub(W);de=me.mag()===0?ft(_t(D+M,w,xe).sub(G),r,M):ft(me,r,M),Z||(Z=W.add(de)),F=Es(D,de,G,p,y,Z,r,w,xe),ie.push(Z),oe=F.sub(Z)}ee=oe.mag()}let J=oe._mult((K-X)/ee)._add(Z||W),ue=k+Math.atan2(G.y-W.y,G.x-W.x);return ie.push(J),{point:J,angle:T?ue:0,path:ie}}let As=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dr(h,e){for(let r=0;r<h;r++){let s=e.length;e.resize(s+4),e.float32.set(As,3*s)}}function ea(h,e,r){let s=e[0],c=e[1];return h[0]=r[0]*s+r[4]*c+r[12],h[1]=r[1]*s+r[5]*c+r[13],h[3]=r[3]*s+r[7]*c+r[15],h}let pi=100;class ks{constructor(e,r=new Ci(e.width+200,e.height+200,25),s=new Ci(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=s,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+pi,this.screenBottomBoundary=e.height+pi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,s,c,p,y,w,T,P,M,k,A){let D=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],p,M,A),F=s*D.perspectiveRatio,Z;if(y||w)Z=this._projectCollisionBox(e,F,c,p,y,w,T,D,M,k,A);else{let oe=D.x+(k?k.x*F:0),J=D.y+(k?k.y*F:0);Z={allPointsOccluded:!1,box:[oe+e.x1*F,J+e.y1*F,oe+e.x2*F,J+e.y2*F]}}let[G,W,X,ee]=Z.box,K=y?Z.allPointsOccluded:D.isOccluded,ie=K;return ie||(ie=D.perspectiveRatio<this.perspectiveRatioCutoff),ie||(ie=!this.isInsideGrid(G,W,X,ee)),ie||r!=="always"&&this.grid.hitTest(G,W,X,ee,r,P)?{box:[G,W,X,ee],placeable:!1,offscreen:!1,occluded:K}:{box:[G,W,X,ee],placeable:!0,offscreen:this.isOffscreen(G,W,X,ee),occluded:K}}placeCollisionCircles(e,r,s,c,p,y,w,T,P,M,k,A,D,F){let Z=[],G=new o.P(r.anchorX,r.anchorY),W=this.getPerspectiveRatio(G.x,G.y,y,F),X=(P?p*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,y)/W:p*W)/o.aB,ee={getElevation:F,pitchedLabelPlaneMatrix:w,lineVertexArray:s,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:G,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:D},K=Xr(X,c,r.lineOffsetX*X,r.lineOffsetY*X,!1,r,!1,ee),ie=!1,oe=!1,J=!0;if(K){let ue=.5*k*W+A,xe=new o.P(-100,-100),de=new o.P(this.screenRightBoundary,this.screenBottomBoundary),me=new Jt,ye=K.first,ze=K.last,Be=[];for(let gt=ye.path.length-1;gt>=1;gt--)Be.push(ye.path[gt]);for(let gt=1;gt<ze.path.length;gt++)Be.push(ze.path[gt]);let Me=2.5*ue;if(P){let gt=this.projectPathToScreenSpace(Be,ee);Be=gt.some(Bt=>Bt.signedDistanceFromCamera<=0)?[]:gt.map(Bt=>Bt.point)}let We=[];if(Be.length>0){let gt=Be[0].clone(),Bt=Be[0].clone();for(let Vt=1;Vt<Be.length;Vt++)gt.x=Math.min(gt.x,Be[Vt].x),gt.y=Math.min(gt.y,Be[Vt].y),Bt.x=Math.max(Bt.x,Be[Vt].x),Bt.y=Math.max(Bt.y,Be[Vt].y);We=gt.x>=xe.x&&Bt.x<=de.x&&gt.y>=xe.y&&Bt.y<=de.y?[Be]:Bt.x<xe.x||gt.x>de.x||Bt.y<xe.y||gt.y>de.y?[]:o.ay([Be],xe.x,xe.y,de.x,de.y)}for(let gt of We){me.reset(gt,.25*ue);let Bt=0;Bt=me.length<=.5*ue?1:Math.ceil(me.paddedLength/Me)+1;for(let Vt=0;Vt<Bt;Vt++){let jt=Vt/Math.max(Bt-1,1),ni=me.lerp(jt),ci=ni.x+pi,dt=ni.y+pi;Z.push(ci,dt,ue,0);let $t=ci-ue,bi=dt-ue,Mi=ci+ue,Fi=dt+ue;if(J=J&&this.isOffscreen($t,bi,Mi,Fi),oe=oe||this.isInsideGrid($t,bi,Mi,Fi),e!=="always"&&this.grid.hitTestCircle(ci,dt,ue,e,M)&&(ie=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ie}}}}return{circles:!T&&ie||!oe||W<this.perspectiveRatioCutoff?[]:Z,offscreen:J,collisionDetected:ie}}projectPathToScreenSpace(e,r){let s=(function(c,p){let y=o.L();return o.aq(y,p.pitchedLabelPlaneMatrix),c.map(w=>{let T=vi(w.x,w.y,y,p.getElevation),P=p.transform.projectTileCoordinates(T.point.x,T.point.y,p.unwrappedTileID,p.getElevation);return P.point.x=(.5*P.point.x+.5)*p.width,P.point.y=(.5*-P.point.y+.5)*p.height,P})})(e,r);return(function(c){let p=0,y=0,w=0,T=0;for(let P=0;P<c.length;P++)c[P].isOccluded?(w=P+1,T=0):(T++,T>y&&(y=T,p=w));return c.slice(p,p+y)})(s)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let r=[],s=new o.a2;for(let k of e){let A=new o.P(k.x+pi,k.y+pi);s.extend(A),r.push(A)}let{minX:c,minY:p,maxX:y,maxY:w}=s,T=this.grid.query(c,p,y,w).concat(this.ignoredGrid.query(c,p,y,w)),P={},M={};for(let k of T){let A=k.key;if(P[A.bucketInstanceId]===void 0&&(P[A.bucketInstanceId]={}),P[A.bucketInstanceId][A.featureIndex])continue;let D=[new o.P(k.x1,k.y1),new o.P(k.x2,k.y1),new o.P(k.x2,k.y2),new o.P(k.x1,k.y2)];o.az(r,D)&&(P[A.bucketInstanceId][A.featureIndex]=!0,M[A.bucketInstanceId]===void 0&&(M[A.bucketInstanceId]=[]),M[A.bucketInstanceId].push(A.featureIndex))}return M}insertCollisionBox(e,r,s,c,p,y){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:y,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,s,c,p,y){let w=s?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:p,collisionGroupID:y,overlapMode:r};for(let P=0;P<e.length;P+=4)w.insertCircle(T,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,r,s,c,p){if(p){let y;c?(y=[e,r,c(e,r),1],o.aw(y,y,p)):(y=[e,r,0,1],ea(y,y,p));let w=y[3];return{x:(y[0]/w+1)/2*this.transform.width+pi,y:(-y[1]/w+1)/2*this.transform.height+pi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{let y=this.transform.projectTileCoordinates(e,r,s,c);return{x:(y.point.x+1)/2*this.transform.width+pi,y:(1-y.point.y)/2*this.transform.height+pi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,s,c){let p=this.transform.projectTileCoordinates(e,r,s,c);return .5+this.transform.cameraToCenterDistance/p.signedDistanceFromCamera*.5}isOffscreen(e,r,s,c){return s<pi||e>=this.screenRightBoundary||c<pi||r>this.screenBottomBoundary}isInsideGrid(e,r,s,c){return s>=0&&e<this.gridRightBoundary&&c>=0&&r<this.gridBottomBoundary}getViewportMatrix(){let e=o.ag([]);return o.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,s,c,p,y,w,T,P,M,k){let A=1,D=0,F=0,Z=1,G=e.anchorPointX+w[0],W=e.anchorPointY+w[1];if(y&&!p){let Be=this.projectAndGetPerspectiveRatio(G+1,W,c,P,k),Me=Be.x-T.x,We=Math.atan((Be.y-T.y)/Me)+(Me<0?Math.PI:0),gt=Math.sin(We),Bt=Math.cos(We);A=Bt,D=gt,F=-gt,Z=Bt}else if(!y&&p){let Be=kt(this.transform);A=Be.vecEast[0],D=Be.vecEast[1],F=Be.vecSouth[0],Z=Be.vecSouth[1]}let X=T.x,ee=T.y,K=r;p&&(X=G,ee=W,K=Math.pow(2,-(this.transform.zoom-s.overscaledZ)),K*=this.transform.getPitchedTextCorrection(G,W,c),M||(K*=o.ah(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),M&&(X+=A*M.x*K+F*M.y*K,ee+=D*M.x*K+Z*M.y*K);let ie=e.x1*K,oe=e.x2*K,J=(ie+oe)/2,ue=e.y1*K,xe=e.y2*K,de=(ue+xe)/2,me=[{offsetX:ie,offsetY:ue},{offsetX:J,offsetY:ue},{offsetX:oe,offsetY:ue},{offsetX:oe,offsetY:de},{offsetX:oe,offsetY:xe},{offsetX:J,offsetY:xe},{offsetX:ie,offsetY:xe},{offsetX:ie,offsetY:de}],ye=[];for(let{offsetX:Be,offsetY:Me}of me)ye.push(new o.P(X+A*Be+F*Me,ee+D*Be+Z*Me));let ze=!1;if(p){let Be=ye.map(Me=>this.projectAndGetPerspectiveRatio(Me.x,Me.y,c,P,k));ze=Be.some(Me=>!Me.isOccluded),ye=Be.map(Me=>new o.P(Me.x,Me.y))}else ze=!0;return{box:o.aA(ye),allPointsOccluded:!ze}}}class gn{constructor(e,r,s,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):c&&s?1:0,this.placed=s}isHidden(){return this.opacity===0&&!this.placed}}class qt{constructor(e,r,s,c,p){this.text=new gn(e?e.text:null,r,s,p),this.icon=new gn(e?e.icon:null,r,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xu{constructor(e,r,s){this.text=e,this.icon=r,this.skipFade=s}}class ja{constructor(e,r,s,c,p){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=s,this.bucketIndex=c,this.tileID=p}}class Yl{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:s=>s.collisionGroupID===r}}return this.collisionGroups[e]}}function Jr(h,e,r,s,c){let{horizontalAlign:p,verticalAlign:y}=o.aH(h);return new o.P(-(p-.5)*e+s[0]*c,-(y-.5)*r+s[1]*c)}class Qr{constructor(e,r,s,c,p){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new ks(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Yl(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let r=this.terrain;return r?(s,c)=>r.getElevation(e,s,c):null}getBucketParts(e,r,s,c){let p=s.getBucket(r),y=s.latestFeatureIndex;if(!p||!y||r.id!==p.layerIds[0])return;let w=s.collisionBoxArray,T=p.layers[0].layout,P=p.layers[0].paint,M=Math.pow(2,this.transform.zoom-s.tileID.overscaledZ),k=s.tileSize/o.$,A=s.tileID.toUnwrapped(),D=T.get("text-rotation-alignment")==="map",F=o.aC(s,1,this.transform.zoom),Z=o.aD(this.collisionIndex.transform,s,P.get("text-translate"),P.get("text-translate-anchor")),G=o.aD(this.collisionIndex.transform,s,P.get("icon-translate"),P.get("icon-translate-anchor")),W=gi(D,this.transform,F);this.retainedQueryData[p.bucketInstanceId]=new ja(p.bucketInstanceId,y,p.sourceLayerIndex,p.index,s.tileID);let X={bucket:p,layout:T,translationText:Z,translationIcon:G,unwrappedTileID:A,pitchedLabelPlaneMatrix:W,scale:M,textPixelRatio:k,holdingForFade:s.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:o.an(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(let ee of p.sortKeyRanges){let{sortKey:K,symbolInstanceStart:ie,symbolInstanceEnd:oe}=ee;e.push({sortKey:K,symbolInstanceStart:ie,symbolInstanceEnd:oe,parameters:X})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:X})}attemptAnchorPlacement(e,r,s,c,p,y,w,T,P,M,k,A,D,F,Z,G,W,X,ee,K){let ie=o.aE[e.textAnchor],oe=[e.textOffset0,e.textOffset1],J=Jr(ie,s,c,oe,p),ue=this.collisionIndex.placeCollisionBox(r,A,T,P,M,w,y,G,k.predicate,ee,J,K);if((!X||this.collisionIndex.placeCollisionBox(X,A,T,P,M,w,y,W,k.predicate,ee,J,K).placeable)&&ue.placeable){let xe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[D.crossTileID]&&this.prevPlacement.placements[D.crossTileID]&&this.prevPlacement.placements[D.crossTileID].text&&(xe=this.prevPlacement.variableOffsets[D.crossTileID].anchor),D.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[D.crossTileID]={textOffset:oe,width:s,height:c,anchor:ie,textBoxScale:p,prevAnchor:xe},this.markUsedJustification(F,ie,D,Z),F.allowVerticalPlacement&&(this.markUsedOrientation(F,Z,D),this.placedOrientations[D.crossTileID]=Z),{shift:J,placedGlyphBoxes:ue}}}placeLayerBucketPart(e,r,s){let{bucket:c,layout:p,translationText:y,translationIcon:w,unwrappedTileID:T,pitchedLabelPlaneMatrix:P,textPixelRatio:M,holdingForFade:k,collisionBoxArray:A,partiallyEvaluatedTextSize:D,collisionGroup:F}=e.parameters,Z=p.get("text-optional"),G=p.get("icon-optional"),W=o.aF(p,"text-overlap","text-allow-overlap"),X=W==="always",ee=o.aF(p,"icon-overlap","icon-allow-overlap"),K=ee==="always",ie=p.get("text-rotation-alignment")==="map",oe=p.get("text-pitch-alignment")==="map",J=p.get("icon-text-fit")!=="none",ue=p.get("symbol-z-order")==="viewport-y",xe=X&&(K||!c.hasIconData()||G),de=K&&(X||!c.hasTextData()||Z);!c.collisionArrays&&A&&c.deserializeCollisionBoxes(A);let me=this.retainedQueryData[c.bucketInstanceId].tileID,ye=this._getTerrainElevationFunc(me),ze=this.transform.getFastPathSimpleProjectionMatrix(me),Be=(Me,We,gt)=>{var Bt,Vt;if(r[Me.crossTileID])return;if(k)return void(this.placements[Me.crossTileID]=new xu(!1,!1,!1));let jt=!1,ni=!1,ci=!0,dt=null,$t={box:null,placeable:!1,offscreen:null,occluded:!1},bi={placeable:!1},Mi=null,Fi=null,sn=null,Qn=0,ro=0,oo=0;We.textFeatureIndex?Qn=We.textFeatureIndex:Me.useRuntimeCollisionCircles&&(Qn=Me.featureIndex),We.verticalTextFeatureIndex&&(ro=We.verticalTextFeatureIndex);let ba=We.textBox;if(ba){let vn=wi=>{let Ei=o.ao.horizontal;if(c.allowVerticalPlacement&&!wi&&this.prevPlacement){let Bn=this.prevPlacement.placedOrientations[Me.crossTileID];Bn&&(this.placedOrientations[Me.crossTileID]=Bn,Ei=Bn,this.markUsedOrientation(c,Ei,Me))}return Ei},er=(wi,Ei)=>{if(c.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&We.verticalTextBox){for(let Bn of c.writingModes)if(Bn===o.ao.vertical?($t=Ei(),bi=$t):$t=wi(),$t&&$t.placeable)break}else $t=wi()},ln=Me.textAnchorOffsetStartIndex,ao=Me.textAnchorOffsetEndIndex;if(ao===ln){let wi=(Ei,Bn)=>{let Ti=this.collisionIndex.placeCollisionBox(Ei,W,M,me,T,oe,ie,y,F.predicate,ye,void 0,ze);return Ti&&Ti.placeable&&(this.markUsedOrientation(c,Bn,Me),this.placedOrientations[Me.crossTileID]=Bn),Ti};er(()=>wi(ba,o.ao.horizontal),()=>{let Ei=We.verticalTextBox;return c.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&Ei?wi(Ei,o.ao.vertical):{box:null,offscreen:null}}),vn($t&&$t.placeable)}else{let wi=o.aE[(Vt=(Bt=this.prevPlacement)===null||Bt===void 0?void 0:Bt.variableOffsets[Me.crossTileID])===null||Vt===void 0?void 0:Vt.anchor],Ei=(Ti,ps,Ta)=>{let Lr=Ti.x2-Ti.x1,tr=Ti.y2-Ti.y1,so=Me.textBoxScale,ph=J&&ee==="never"?ps:null,Pn=null,dh=W==="never"?1:2,Gc="never";wi&&dh++;for(let dl=0;dl<dh;dl++){for(let ml=ln;ml<ao;ml++){let lo=c.textAnchorOffsets.get(ml);if(wi&&lo.textAnchor!==wi)continue;let Dr=this.attemptAnchorPlacement(lo,Ti,Lr,tr,so,ie,oe,M,me,T,F,Gc,Me,c,Ta,y,w,ph,ye);if(Dr&&(Pn=Dr.placedGlyphBoxes,Pn&&Pn.placeable))return jt=!0,dt=Dr.shift,Pn}wi?wi=null:Gc=W}return s&&!Pn&&(Pn={box:this.collisionIndex.placeCollisionBox(ba,"always",M,me,T,oe,ie,y,F.predicate,ye,void 0,ze).box,offscreen:!1,placeable:!1,occluded:!1}),Pn};er(()=>Ei(ba,We.iconBox,o.ao.horizontal),()=>{let Ti=We.verticalTextBox;return c.allowVerticalPlacement&&(!$t||!$t.placeable)&&Me.numVerticalGlyphVertices>0&&Ti?Ei(Ti,We.verticalIconBox,o.ao.vertical):{box:null,occluded:!0,offscreen:null}}),$t&&(jt=$t.placeable,ci=$t.offscreen);let Bn=vn($t&&$t.placeable);if(!jt&&this.prevPlacement){let Ti=this.prevPlacement.variableOffsets[Me.crossTileID];Ti&&(this.variableOffsets[Me.crossTileID]=Ti,this.markUsedJustification(c,Ti.anchor,Me,Bn))}}}if(Mi=$t,jt=Mi&&Mi.placeable,ci=Mi&&Mi.offscreen,Me.useRuntimeCollisionCircles){let vn=c.text.placedSymbolArray.get(Me.centerJustifiedTextSymbolIndex),er=o.ap(c.textSizeData,D,vn),ln=p.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(W,vn,c.lineVertexArray,c.glyphOffsetArray,er,T,P,s,oe,F.predicate,Me.collisionCircleDiameter,ln,y,ye),Fi.circles.length&&Fi.collisionDetected&&!s&&o.w("Collisions detected, but collision boxes are not shown"),jt=X||Fi.circles.length>0&&!Fi.collisionDetected,ci=ci&&Fi.offscreen}if(We.iconFeatureIndex&&(oo=We.iconFeatureIndex),We.iconBox){let vn=er=>this.collisionIndex.placeCollisionBox(er,ee,M,me,T,oe,ie,w,F.predicate,ye,J&&dt?dt:void 0,ze);bi&&bi.placeable&&We.verticalIconBox?(sn=vn(We.verticalIconBox),ni=sn.placeable):(sn=vn(We.iconBox),ni=sn.placeable),ci=ci&&sn.offscreen}let wa=Z||Me.numHorizontalGlyphVertices===0&&Me.numVerticalGlyphVertices===0,Bo=G||Me.numIconVertices===0;wa||Bo?Bo?wa||(ni=ni&&jt):jt=ni&&jt:ni=jt=ni&&jt;let Oo=ni&&sn.placeable;if(jt&&Mi.placeable&&this.collisionIndex.insertCollisionBox(Mi.box,W,p.get("text-ignore-placement"),c.bucketInstanceId,bi&&bi.placeable&&ro?ro:Qn,F.ID),Oo&&this.collisionIndex.insertCollisionBox(sn.box,ee,p.get("icon-ignore-placement"),c.bucketInstanceId,oo,F.ID),Fi&&jt&&this.collisionIndex.insertCollisionCircles(Fi.circles,W,p.get("text-ignore-placement"),c.bucketInstanceId,Qn,F.ID),s&&this.storeCollisionData(c.bucketInstanceId,gt,We,Mi,sn,Fi),Me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Me.crossTileID]=new xu((jt||xe)&&!Mi?.occluded,(ni||de)&&!sn?.occluded,ci||c.justReloaded),r[Me.crossTileID]=!0};if(ue){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Me=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let We=Me.length-1;We>=0;--We){let gt=Me[We];Be(c.symbolInstances.get(gt),c.collisionArrays[gt],gt)}}else for(let Me=e.symbolInstanceStart;Me<e.symbolInstanceEnd;Me++)Be(c.symbolInstances.get(Me),c.collisionArrays[Me],Me);c.justReloaded=!1}storeCollisionData(e,r,s,c,p,y){if(s.textBox||s.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(r)?T=w.get(r):(T={text:null,icon:null},w.set(r,T)),s.textBox&&(T.text=c.box),s.iconBox&&(T.icon=p.box)}if(y){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)w.push(y.circles[T+0]-pi),w.push(y.circles[T+1]-pi),w.push(y.circles[T+2]),w.push(y.collisionDetected?1:0)}}markUsedJustification(e,r,s,c){let p;p=c===o.ao.vertical?s.verticalPlacedTextSymbolIndex:{left:s.leftJustifiedTextSymbolIndex,center:s.centerJustifiedTextSymbolIndex,right:s.rightJustifiedTextSymbolIndex}[o.aG(r)];let y=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex,s.verticalPlacedTextSymbolIndex];for(let w of y)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=p>=0&&w!==p?0:s.crossTileID)}markUsedOrientation(e,r,s){let c=r===o.ao.horizontal||r===o.ao.horizontalOnly?r:0,p=r===o.ao.vertical?r:0,y=[s.leftJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.rightJustifiedTextSymbolIndex];for(let w of y)e.text.placedSymbolArray.get(w).placedOrientation=c;s.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(s.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let r=this.prevPlacement,s=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;let c=r?r.symbolFadeChange(e):1,p=r?r.opacities:{},y=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(let T in this.placements){let P=this.placements[T],M=p[T];M?(this.opacities[T]=new qt(M,c,P.text,P.icon),s=s||P.text!==M.text.placed||P.icon!==M.icon.placed):(this.opacities[T]=new qt(null,c,P.text,P.icon,P.skipFade),s=s||P.text||P.icon)}for(let T in p){let P=p[T];if(!this.opacities[T]){let M=new qt(P,c,!1,!1);M.isHidden()||(this.opacities[T]=M,s=s||P.text.placed||P.icon.placed)}}for(let T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(let T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");s?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){let s={};for(let c of r){let p=c.getBucket(e);p&&c.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,c.tileID,s,c.collisionBoxArray)}}updateBucketOpacities(e,r,s,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let p=e.layers[0],y=p.layout,w=new qt(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),M=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=y.get("text-rotation-alignment")==="map",A=y.get("text-pitch-alignment")==="map",D=y.get("icon-text-fit")!=="none",F=new qt(null,0,T&&(P||!e.hasIconData()||y.get("icon-optional")),P&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);let Z=(W,X,ee)=>{for(let K=0;K<X/4;K++)W.opacityVertexArray.emplaceBack(ee);W.hasVisibleVertices=W.hasVisibleVertices||ee!==ia},G=this.collisionBoxArrays.get(e.bucketInstanceId);for(let W=0;W<e.symbolInstances.length;W++){let X=e.symbolInstances.get(W),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:K,crossTileID:ie}=X,oe=this.opacities[ie];s[ie]?oe=w:oe||(oe=F,this.opacities[ie]=oe),s[ie]=!0;let J=X.numIconVertices>0,ue=this.placedOrientations[X.crossTileID],xe=ue===o.ao.vertical,de=ue===o.ao.horizontal||ue===o.ao.horizontalOnly;if(ee>0||K>0){let ye=Ql(oe.text);Z(e.text,ee,xe?ia:ye),Z(e.text,K,de?ia:ye);let ze=oe.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(We=>{We>=0&&(e.text.placedSymbolArray.get(We).hidden=ze||xe?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=ze||de?1:0);let Be=this.variableOffsets[X.crossTileID];Be&&this.markUsedJustification(e,Be.anchor,X,ue);let Me=this.placedOrientations[X.crossTileID];Me&&(this.markUsedJustification(e,"left",X,Me),this.markUsedOrientation(e,Me,X))}if(J){let ye=Ql(oe.icon),ze=!(D&&X.verticalPlacedIconSymbolIndex&&xe);X.placedIconSymbolIndex>=0&&(Z(e.icon,X.numIconVertices,ze?ye:ia),e.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=oe.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(Z(e.icon,X.numVerticalIconVertices,ze?ia:ye),e.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=oe.icon.isHidden())}let me=G&&G.has(W)?G.get(W):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let ye=e.collisionArrays[W];if(ye){let ze=new o.P(0,0);if(ye.textBox||ye.verticalTextBox){let Be=!0;if(M){let Me=this.variableOffsets[ie];Me?(ze=Jr(Me.anchor,Me.width,Me.height,Me.textOffset,Me.textBoxScale),k&&ze._rotate(A?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Be=!1}if(ye.textBox||ye.verticalTextBox){let Me;ye.textBox&&(Me=xe),ye.verticalTextBox&&(Me=de),Jl(e.textCollisionBox.collisionVertexArray,oe.text.placed,!Be||Me,me.text,ze.x,ze.y)}}if(ye.iconBox||ye.verticalIconBox){let Be=!!(!de&&ye.verticalIconBox),Me;ye.iconBox&&(Me=Be),ye.verticalIconBox&&(Me=!Be),Jl(e.iconCollisionBox.collisionVertexArray,oe.icon.placed,Me,me.icon,D?ze.x:0,D?ze.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){let s=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*s>e}setStale(){this.stale=!0}}function Jl(h,e,r,s,c,p){s&&s.length!==0||(s=[0,0,0,0]);let y=s[0]-pi,w=s[1]-pi,T=s[2]-pi,P=s[3]-pi;h.emplaceBack(e?1:0,r?1:0,c||0,p||0,y,w),h.emplaceBack(e?1:0,r?1:0,c||0,p||0,T,w),h.emplaceBack(e?1:0,r?1:0,c||0,p||0,T,P),h.emplaceBack(e?1:0,r?1:0,c||0,p||0,y,P)}let bu=Math.pow(2,25),wu=Math.pow(2,24),ta=Math.pow(2,17),Tu=Math.pow(2,16),ap=Math.pow(2,9),sp=Math.pow(2,8),lp=Math.pow(2,1);function Ql(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;let e=h.placed?1:0,r=Math.floor(127*h.opacity);return r*bu+e*wu+r*ta+e*Tu+r*ap+e*sp+r*lp+e}let ia=0;class ec{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,s,c,p){let y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(y,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<y.length;)if(r.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,s),this._currentPartIndex++,p())return!0;return!1}}class tc{constructor(e,r,s,c,p,y,w,T){this.placement=new Qr(e,r,y,w,T),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,r,s){let c=ne.now(),p=()=>!this._forceFullPlacement&&ne.now()-c>2;for(;this._currentPlacementIndex>=0;){let y=r[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=w)&&(!y.maxzoom||y.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new ec(y)),this._inProgressLayer.continuePlacement(s[y.source],this.placement,this._showCollisionBoxes,y,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let na=512/o.$/2;class ic{constructor(e,r,s){this.tileID=e,this.bucketInstanceId=s,this._symbolsByKey={};let c=new Map;for(let p=0;p<r.length;p++){let y=r.get(p),w=y.key,T=c.get(w);T?T.push(y):c.set(w,[y])}for(let[p,y]of c){let w={positions:y.map(T=>({x:Math.floor(T.anchorX*na),y:Math.floor(T.anchorY*na)})),crossTileIDs:y.map(T=>T.crossTileID)};if(w.positions.length>128){let T=new o.aI(w.positions.length,16,Uint16Array);for(let{x:P,y:M}of w.positions)T.add(P,M);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[p]=w}}getScaledCoordinates(e,r){let{x:s,y:c,z:p}=this.tileID.canonical,{x:y,y:w,z:T}=r.canonical,P=na/Math.pow(2,T-p),M=(w*o.$+e.anchorY)*P,k=c*o.$*na;return{x:Math.floor((y*o.$+e.anchorX)*P-s*o.$*na),y:Math.floor(M-k)}}findMatches(e,r,s){let c=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let p=0;p<e.length;p++){let y=e.get(p);if(y.crossTileID)continue;let w=this._symbolsByKey[y.key];if(!w)continue;let T=this.getScaledCoordinates(y,r);if(w.index){let P=w.index.range(T.x-c,T.y-c,T.x+c,T.y+c).sort();for(let M of P){let k=w.crossTileIDs[M];if(!s[k]){s[k]=!0,y.crossTileID=k;break}}}else if(w.positions)for(let P=0;P<w.positions.length;P++){let M=w.positions[P],k=w.crossTileIDs[P];if(Math.abs(M.x-T.x)<=c&&Math.abs(M.y-T.y)<=c&&!s[k]){s[k]=!0,y.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class nc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let r=Math.round((e-this.lng)/360);if(r!==0)for(let s in this.indexes){let c=this.indexes[s],p={};for(let y in c){let w=c[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),p[w.tileID.key]=w}this.indexes[s]=p}this.lng=e}addBucket(e,r,s){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<r.symbolInstances.length;p++)r.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let c=this.usedCrossTileIDs[e.overscaledZ];for(let p in this.indexes){let y=this.indexes[p];if(Number(p)>e.overscaledZ)for(let w in y){let T=y[w];T.tileID.isChildOf(e)&&T.findMatches(r.symbolInstances,e,c)}else{let w=y[e.scaledTo(Number(p)).key];w&&w.findMatches(r.symbolInstances,e,c)}}for(let p=0;p<r.symbolInstances.length;p++){let y=r.symbolInstances.get(p);y.crossTileID||(y.crossTileID=s.generate(),c[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ic(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(let s of r.getCrossTileIDsLists())for(let c of s)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let r=!1;for(let s in this.indexes){let c=this.indexes[s];for(let p in c)e[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(s,c[p]),delete c[p],r=!0)}return r}}class ra{constructor(){this.layerIndexes={},this.crossTileIDs=new nc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,s){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new cp);let p=!1,y={};c.handleWrapJump(s);for(let w of r){let T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(w.tileID,T,this.crossTileIDs)&&(p=!0),y[T.bucketInstanceId]=!0)}return c.removeStaleBuckets(y)&&(p=!0),p}pruneUnusedLayers(e){let r={};e.forEach(s=>{r[s]=!0});for(let s in this.layerIndexes)r[s]||delete this.layerIndexes[s]}}var Ua="void main() {fragColor=vec4(1.0);}";let Zn={prelude:wt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:wt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:wt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:wt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:wt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wt(Ua,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:wt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:wt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:wt(Ua,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:wt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:wt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:wt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:wt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:wt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:wt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:wt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:wt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:wt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:wt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:wt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function wt(h,e){let r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,s=e.match(/in ([\w]+) ([\w]+)/g),c=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=p?p.concat(c):c,w={};return{fragmentSource:h=h.replace(r,(T,P,M,k,A)=>(w[A]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
in ${M} ${k} ${A};
#else
uniform ${M} ${k} u_${A};
#endif
`:`
#ifdef HAS_UNIFORM_u_${A}
    ${M} ${k} ${A} = u_${A};
#endif
`)),vertexSource:e=e.replace(r,(T,P,M,k,A)=>{let D=k==="float"?"vec2":"vec4",F=A.match(/color/)?"color":D;return w[A]?P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${M} ${D} a_${A};
out ${M} ${k} ${A};
#else
uniform ${M} ${k} u_${A};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${M} ${k} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = unpack_mix_${F}(a_${A}, u_${A}_t);
#else
    ${M} ${k} ${A} = u_${A};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${M} ${D} a_${A};
#else
uniform ${M} ${k} u_${A};
#endif
`:F==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${M} ${k} ${A} = a_${A};
#else
    ${M} ${k} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${M} ${k} ${A} = unpack_mix_${F}(a_${A}, u_${A}_t);
#else
    ${M} ${k} ${A} = u_${A};
#endif
`}),staticAttributes:s,staticUniforms:y}}class xo{constructor(e,r,s){this.vertexBuffer=e,this.indexBuffer=r,this.segments=s}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var eo=o.aJ([{name:"a_pos",type:"Int16",components:2}]);let Mr="#define PROJECTION_MERCATOR",bo="mercator";class Tt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return bo}get shaderDefine(){return Mr}get shaderPreludeCode(){return Zn.projectionMercator}get vertexShaderPreludeCode(){return Zn.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,s,c,p){if(this._cachedMesh)return this._cachedMesh;let y=new o.aL;y.emplaceBack(0,0),y.emplaceBack(o.$,0),y.emplaceBack(0,o.$),y.emplaceBack(o.$,o.$);let w=e.createVertexBuffer(y,eo.members),T=o.aM.simpleSegment(0,0,4,2),P=new o.aN;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3);let M=e.createIndexBuffer(P);return this._cachedMesh=new xo(w,M,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class wo{constructor(e=0,r=0,s=0,c=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(s)||s<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=s,this.right=c}interpolate(e,r,s){return r.top!=null&&e.top!=null&&(this.top=o.C.number(e.top,r.top,s)),r.bottom!=null&&e.bottom!=null&&(this.bottom=o.C.number(e.bottom,r.bottom,s)),r.left!=null&&e.left!=null&&(this.left=o.C.number(e.left,r.left,s)),r.right!=null&&e.right!=null&&(this.right=o.C.number(e.right,r.right,s)),this}getCenter(e,r){let s=o.ah((this.left+e-this.right)/2,0,e),c=o.ah((this.top+r-this.bottom)/2,0,r);return new o.P(s,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new wo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ls(h,e){if(!h.renderWorldCopies||h.lngRange)return;let r=e.lng-h.center.lng;e.lng+=r>180?-360:r<-180?360:0}function Ds(h){return Math.max(0,Math.floor(h))}class nn{constructor(e,r,s,c,p,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ds(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new wo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,s){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Ds(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new wo(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!s&&e.autoCalculateNearFarZ,r&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let r=o.aO(e,-180,180)*Math.PI/180;var s,c,p,y,w,T,P,M,k;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=B(),s=this._rotationMatrix,p=-this._bearingInRadians,y=(c=this._rotationMatrix)[0],w=c[1],T=c[2],P=c[3],M=Math.sin(p),k=Math.cos(p),s[0]=y*k+T*M,s[1]=w*k+P*M,s[2]=y*-M+T*k,s[3]=w*-M+P*k)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let r=o.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aP(this._fovInRadians)}setFov(e){e=o.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let r=this.getConstrained(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=o.af(r),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,s){this._unmodified=!1,this._edgeInsets.interpolate(e,r,s),this._constrain(),this._calcMatrices()}resize(e,r,s=!0){this._width=e,this._height=r,s&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new hi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-o.ai,o.ai])}getConstrained(e,r){return this._callbacks.getConstrained(e,r)}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{let{minX:s,minY:c,maxX:p,maxY:y}=o.a2.fromPoints(r).extend(e);return[new o.P(s,c),new o.P(p,c),new o.P(p,y),new o.P(s,y),new o.P(s,c)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:r,zoom:s}=this.getConstrained(this.center,this.zoom);this.setCenter(r),this.setZoom(s),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.ag(new Float64Array(16));o.N(e,e,[this._width/2,-this._height/2,1]),o.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.ag(new Float64Array(16)),o.N(e,e,[1,-1,1]),o.M(e,e,[-1,-1,0]),o.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,s,c){let p=s!==void 0?s:this.bearing,y=c=c!==void 0?c:this.pitch,w=o.a1.fromLngLat(e,r),T=-Math.cos(o.ae(y)),P=Math.sin(o.ae(y)),M=P*Math.sin(o.ae(p)),k=-P*Math.cos(o.ae(p)),A=this.elevation,D=r-A,F;T*D>=0||Math.abs(T)<.1?(F=1e4,A=r+F*T):F=-D/T;let Z,G,W=o.aQ(1,w.y),X=0;do{if(X+=1,X>10)break;G=F/W,Z=new o.a1(w.x+M*G,w.y+k*G),W=1/Z.meterInMercatorCoordinateUnits()}while(Math.abs(F-G*W)>1e-12);return{center:Z.toLngLat(),elevation:A,zoom:o.ak(this.height/2/Math.tan(this.fovInRadians/2)/G/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let r=o.aj(1,this.center.lat)*this.worldSize,s=this.cameraToCenterDistance/r,c=o.a1.fromLngLat(this.center,this.elevation),p=_e(this.center,this.elevation,this.pitch,this.bearing,s);this._elevation=e;let y=this.calculateCenterFromCameraLngLatAlt(p.toLngLat(),o.aQ(p.z,c.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=o.aj(1,this.center.lat)*this.worldSize;return _e(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/o.$,1/r/o.$]}}class zi{constructor(e,r){this.min=e,this.max=r,this.center=o.aR([],o.aS([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],s=o.aT(this.min),c=o.aT(this.max);for(let p=0;p<r.length;p++)s[p]=r[p]?this.min[p]:this.center[p],c[p]=r[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new zi(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let s=0;s<e.planes.length;s++){let c=this.intersectsPlane(e.planes[s]);if(c===0)return 0;c===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],s=e[3];for(let c=0;c<3;c++)e[c]>0?(r+=e[c]*this.min[c],s+=e[c]*this.max[c]):(s+=e[c]*this.min[c],r+=e[c]*this.max[c]);return r>=0?2:s<0?0:1}}class rn{distanceToTile2d(e,r,s,c){let p=c.distanceX([e,r]),y=c.distanceY([e,r]);return Math.hypot(p,y)}getWrap(e,r,s){return s}getTileBoundingVolume(e,r,s,c){var p,y;let w=0,T=0;if(c?.terrain){let M=new o.Z(e.z,r,e.z,e.x,e.y),k=c.terrain.getMinMaxElevation(M);w=(p=k.minElevation)!==null&&p!==void 0?p:Math.min(0,s),T=(y=k.maxElevation)!==null&&y!==void 0?y:Math.max(0,s)}let P=1<<e.z;return new zi([r+e.x/P,e.y/P,w],[r+(e.x+1)/P,(e.y+1)/P,T])}allowVariableZoom(e,r){let s=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,c=o.ah(78.5-s/2,0,60);return!!r.terrain||e.pitch>c}allowWorldCopies(){return!0}prepareNextFrame(){}}class xi{constructor(e,r,s){this.points=e,this.planes=r,this.aabb=s}static fromInvProjectionMatrix(e,r=1,s=0,c,p){let y=p?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,s),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>(function(D,F,Z,G){let W=o.aw([],D,F),X=1/W[3]/Z*G;return o.aY(W,W,[X,X,1/W[3],X])})(A,e,r,w));c&&(function(A,D,F,Z){let G=Z?4:0,W=Z?0:4,X=0,ee=[],K=[];for(let J=0;J<4;J++){let ue=o.aU([],A[J+W],A[J+G]),xe=o.aZ(ue);o.aR(ue,ue,1/xe),ee.push(xe),K.push(ue)}for(let J=0;J<4;J++){let ue=o.a_(A[J+G],K[J],F);X=ue!==null&&ue>=0?Math.max(X,ue):Math.max(X,ee[J])}let ie=(function(J,ue){let xe=o.aU([],J[ue[0]],J[ue[1]]),de=o.aU([],J[ue[2]],J[ue[1]]),me=[0,0,0,0];return o.aV(me,o.aW([],xe,de)),me[3]=-o.aX(me,J[ue[0]]),me})(A,D),oe=(function(J,ue){let xe=o.a$(J),de=o.b0([],J,1/xe),me=o.aU([],ue,o.aR([],de,o.aX(ue,de))),ye=o.a$(me);if(ye>0){let ze=Math.sqrt(1-de[3]*de[3]),Be=o.aR([],de,-de[3]),Me=o.aS([],Be,o.aR([],me,ze/ye));return o.b1(ue,Me)}return null})(F,ie);if(oe!==null){let J=oe/o.aX(K[0],ie);X=Math.min(X,J)}for(let J=0;J<4;J++){let ue=Math.min(X,ee[J]);A[J+W]=[A[J+G][0]+K[J][0]*ue,A[J+G][1]+K[J][1]*ue,A[J+G][2]+K[J][2]*ue,1]}})(T,y[0],c,p);let P=y.map(A=>{let D=o.aU([],T[A[0]],T[A[1]]),F=o.aU([],T[A[2]],T[A[1]]),Z=o.aV([],o.aW([],D,F)),G=-o.aX(Z,T[A[1]]);return Z.concat(G)}),M=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],k=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let A of T)for(let D=0;D<3;D++)M[D]=Math.min(M[D],A[D]),k[D]=Math.max(k[D],A[D]);return new xi(T,P,new zi(M,k))}}class Wt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,s){return this._helper.interpolatePadding(e,r,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,s=!0){this._helper.resize(e,r,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e,r,s,c,p){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new nn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,w)=>this.getConstrained(y,w)},e,r,s,c,p),this._coveringTilesDetailsProvider=new rn}clone(){let e=new Wt;return e.apply(this),e}apply(e,r,s){this._helper.apply(e,r,s)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let r=[new o.b2(0,e)];if(this._helper._renderWorldCopies){let s=this.screenPointToMercatorCoordinate(new o.P(0,0)),c=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),p=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),w=Math.floor(Math.min(s.x,c.x,p.x,y.x)),T=Math.floor(Math.max(s.x,c.x,p.x,y.x)),P=1;for(let M=w-P;M<=T+P;M++)M!==0&&r.push(new o.b2(M,e))}return r}getCameraFrustum(){return xi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let r=this.screenPointToLocation(this.centerPoint,e),s=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(s)}setLocationAtPoint(e,r){let s=o.aj(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(r,s),p=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,s),y=o.a1.fromLngLat(e),w=new o.a1(y.x-(c.x-p.x),y.y-(c.y-p.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(o.a1.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a1.fromLngLat(e))}screenPointToLocation(e,r){var s;return(s=this.screenPointToMercatorCoordinate(e,r))===null||s===void 0?void 0:s.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){let s=r.pointCoordinate(e);if(s!=null)return s}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){let s=r||0,c=[e.x,e.y,0,1],p=[e.x,e.y,1,1];o.aw(c,c,this._pixelMatrixInverse),o.aw(p,p,this._pixelMatrixInverse);let y=c[3],w=p[3],T=c[1]/y,P=p[1]/w,M=c[2]/y,k=p[2]/w,A=M===k?0:(s-M)/(k-M);return new o.a1(o.C.number(c[0]/y,p[0]/w,A)/this.worldSize,o.C.number(T,P,A)/this.worldSize,s)}coordinatePoint(e,r=0,s=this._pixelMatrix){let c=[e.x*this.worldSize,e.y*this.worldSize,r,1];return o.aw(c,c,s),new o.P(c[0]/c[3],c[1]/c[3])}getBounds(){let e=Math.max(0,this._helper._height/2-ae(this));return new hi().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-ae(this)}calculatePosMatrix(e,r=!1,s){var c;let p=(c=e.key)!==null&&c!==void 0?c:o.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=r?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(p)){let P=y.get(p);return s?P.f32:P.f64}let w=ce(e,this.worldSize);o.O(w,r?this._alignedProjMatrix:this._viewProjMatrix,w);let T={f64:w,f32:new Float32Array(w)};return y.set(p,T),s?T.f32:T.f64}calculateFogMatrix(e){let r=e.key,s=this._fogMatrixCacheF32;if(s.has(r))return s.get(r);let c=ce(e,this.worldSize);return o.O(c,this._fogMatrix,c),s.set(r,new Float32Array(c)),s.get(r)}getConstrained(e,r){r=o.ah(+r,this.minZoom,this.maxZoom);let s={center:new o.S(e.lng,e.lat),zoom:r},c=this._helper._lngRange;if(!this._helper._renderWorldCopies&&c===null){let ee=179.9999999999;c=[-ee,ee]}let p=this.tileSize*o.af(s.zoom),y=0,w=p,T=0,P=p,M=0,k=0,{x:A,y:D}=this.size;if(this._helper._latRange){let ee=this._helper._latRange;y=o.U(ee[1])*p,w=o.U(ee[0])*p,w-y<D&&(M=D/(w-y))}c&&(T=o.aO(o.V(c[0])*p,0,p),P=o.aO(o.V(c[1])*p,0,p),P<T&&(P+=p),P-T<A&&(k=A/(P-T)));let{x:F,y:Z}=N(p,e),G,W,X=Math.max(k||0,M||0);if(X){let ee=new o.P(k?(P+T)/2:F,M?(w+y)/2:Z);return s.center=Q(p,ee).wrap(),s.zoom+=o.ak(X),s}if(this._helper._latRange){let ee=D/2;Z-ee<y&&(W=y+ee),Z+ee>w&&(W=w-ee)}if(c){let ee=(T+P)/2,K=F;this._helper._renderWorldCopies&&(K=o.aO(F,ee-p/2,ee+p/2));let ie=A/2;K-ie<T&&(G=T+ie),K+ie>P&&(G=P-ie)}if(G!==void 0||W!==void 0){let ee=new o.P(G??F,W??Z);s.center=Q(p,ee).wrap()}return s}calculateCenterFromCameraLngLatAlt(e,r,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,s,c)}_calculateNearFarZIfNeeded(e,r,s){if(!this._helper.autoCalculateNearFarZ)return;let c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),p=e-c*this._helper._pixelPerMeter/Math.cos(r),y=c<0?p:e,w=Math.PI/2+this.pitchInRadians,T=o.ae(this.fov)*(Math.abs(Math.cos(o.ae(this.roll)))*this.height+Math.abs(Math.sin(o.ae(this.roll)))*this.width)/this.height*(.5+s.y/this.height),P=Math.sin(T)*y/Math.sin(o.ah(Math.PI-w-T,.01,Math.PI-.01)),M=ae(this),k=Math.atan(M/this._helper.cameraToCenterDistance),A=o.ae(.75),D=k>A?2*k*(.5+s.y/(2*M)):A,F=Math.sin(D)*y/Math.sin(o.ah(Math.PI-w-D,.01,Math.PI-.01)),Z=Math.min(P,F);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*Z+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,r=N(this.worldSize,this.center),s=r.x,c=r.y;this._helper._pixelPerMeter=o.aj(1,this.center.lat)*this.worldSize;let p=o.ae(Math.min(this.pitch,U)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(p)),w;this._calculateNearFarZIfNeeded(y,p,e),w=new Float64Array(16),o.b4(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aq(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=o.b5(w),o.N(w,w,[1,-1,1]),o.M(w,w,[0,0,-this._helper.cameraToCenterDistance]),o.b6(w,w,-this.rollInRadians),o.b7(w,w,this.pitchInRadians),o.b6(w,w,-this.bearingInRadians),o.M(w,w,[-s,-c,0]),this._mercatorMatrix=o.N([],w,[this.worldSize,this.worldSize,this.worldSize]),o.N(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),o.M(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=o.aq([],w);let T=[0,0,-1,1];o.aw(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),o.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-s,-c,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);let P=this._helper._width%2/2,M=this._helper._height%2/2,k=Math.cos(this.bearingInRadians),A=Math.sin(-this.bearingInRadians),D=s-Math.round(s)+k*P+A*M,F=c-Math.round(c)+k*M+A*P,Z=new Float64Array(w);if(o.M(Z,Z,[D>.5?D-1:D,F>.5?F-1:F,0]),this._alignedProjMatrix=Z,w=o.aq(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new o.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.aw(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=o.aj(1,this.center.lat)*this.worldSize;return _e(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){let s=o.a1.fromLngLat(e),c=[s.x*this.worldSize,s.y*this.worldSize,r,1];return o.aw(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(e){let{overscaledTileID:r,aligned:s,applyTerrainMatrix:c}=e,p=this._helper.getMercatorTileCoordinates(r),y=r?this.calculatePosMatrix(r,s,!0):null,w;return w=r&&r.terrainRttPosMatrix32f&&c?r.terrainRttPosMatrix32f:y||o.b8(),{mainMatrix:w,tileMercatorCoords:p,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,s){return 1}transformLightDirection(e){return o.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,s,c){let p=this.calculatePosMatrix(s),y;c?(y=[e,r,c(e,r),1],o.aw(y,y,p)):(y=[e,r,0,1],ea(y,y,p));let w=y[3];return{point:new o.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(let r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){let s=o.a1.fromLngLat(e,r),c=s.meterInMercatorCoordinateUnits(),p=o.b9();return o.M(p,p,[s.x,s.y,s.z]),o.b6(p,p,Math.PI),o.b7(p,p,Math.PI/2),o.N(p,p,[-c,c,c]),p}getProjectionDataForCustomLayer(e=!0){let r=new o.Z(0,0,0,0,0),s=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),c=ce(r,this.worldSize);o.O(c,this._viewProjMatrix,c),s.tileMercatorCoords=[0,0,1,1];let p=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],y=o.ba();return o.N(y,c,p),s.fallbackMatrix=y,s.mainMatrix=y,s}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Su(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function on(h){if(h.useSlerp)if(h.k<1){let e=o.bb(h.startEulerAngles.roll,h.startEulerAngles.pitch,h.startEulerAngles.bearing),r=o.bb(h.endEulerAngles.roll,h.endEulerAngles.pitch,h.endEulerAngles.bearing),s=new Float64Array(4);o.bc(s,e,r,h.k);let c=o.bd(s);h.tr.setRoll(c.roll),h.tr.setPitch(c.pitch),h.tr.setBearing(c.bearing)}else h.tr.setRoll(h.endEulerAngles.roll),h.tr.setPitch(h.endEulerAngles.pitch),h.tr.setBearing(h.endEulerAngles.bearing);else h.tr.setRoll(o.C.number(h.startEulerAngles.roll,h.endEulerAngles.roll,h.k)),h.tr.setPitch(o.C.number(h.startEulerAngles.pitch,h.endEulerAngles.pitch,h.k)),h.tr.setBearing(o.C.number(h.startEulerAngles.bearing,h.endEulerAngles.bearing,h.k))}function Sn(h,e,r,s,c){let p=c.padding,y=N(c.worldSize,r.getNorthWest()),w=N(c.worldSize,r.getNorthEast()),T=N(c.worldSize,r.getSouthEast()),P=N(c.worldSize,r.getSouthWest()),M=o.ae(-s),k=y.rotate(M),A=w.rotate(M),D=T.rotate(M),F=P.rotate(M),Z=new o.P(Math.max(k.x,A.x,F.x,D.x),Math.max(k.y,A.y,F.y,D.y)),G=new o.P(Math.min(k.x,A.x,F.x,D.x),Math.min(k.y,A.y,F.y,D.y)),W=Z.sub(G),X=(c.width-(p.left+p.right+e.left+e.right))/W.x,ee=(c.height-(p.top+p.bottom+e.top+e.bottom))/W.y;if(ee<0||X<0)return void Su();let K=Math.min(o.ak(c.scale*Math.min(X,ee)),h.maxZoom),ie=o.P.convert(h.offset),oe=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.ae(s)),J=ie.add(oe).mult(c.scale/o.af(K));return{center:Q(c.worldSize,y.add(T).div(2).sub(J)),zoom:K,bearing:s}}class Yi{get useGlobeControls(){return!1}handlePanInertia(e,r){return{easingOffset:e,easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,s){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(s,e.around)}cameraForBoxAndBearing(e,r,s,c,p){return Sn(e,r,s,c,p)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(o.S.convert(r.center))}handleEaseTo(e,r){let s=e.zoom,c=e.padding,p={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},w=r.zoom!==void 0,T=!e.isPaddingEqual(r.padding),P=!1,M=w?+r.zoom:e.zoom,k=e.centerPoint.add(r.offsetAsPoint),A=e.screenPointToLocation(k),{center:D,zoom:F}=e.getConstrained(o.S.convert(r.center||A),M??s);Ls(e,D);let Z=N(e.worldSize,A),G=N(e.worldSize,D).sub(Z),W=o.af(F-s);return P=F!==s,{easeFunc:X=>{if(P&&e.setZoom(o.C.number(s,F,X)),o.be(p,y)||on({startEulerAngles:p,endEulerAngles:y,tr:e,k:X,useSlerp:p.roll!=y.roll}),T&&(e.interpolatePadding(c,r.padding,X),k=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{let ee=o.af(e.zoom-s),K=F>s?Math.min(2,W):Math.max(.5,W),ie=Math.pow(K,1-X),oe=Q(e.worldSize,Z.add(G.mult(X*ie)).mult(ee));e.setLocationAtPoint(e.renderWorldCopies?oe.wrap():oe,k)}},isZooming:P,elevationCenter:D}}handleFlyTo(e,r){let s=r.zoom!==void 0,c=e.zoom,p=e.getConstrained(o.S.convert(r.center||r.locationAtOffset),s?+r.zoom:c),y=p.center,w=p.zoom;Ls(e,y);let T=N(e.worldSize,r.locationAtOffset),P=N(e.worldSize,y).sub(T),M=P.mag(),k=o.af(w-c),A;if(r.minZoom!==void 0){let D=Math.min(+r.minZoom,c,w),F=e.getConstrained(y,D).zoom;A=o.af(F-c)}return{easeFunc:(D,F,Z,G)=>{e.setZoom(D===1?w:c+o.ak(F));let W=D===1?y:Q(e.worldSize,T.add(P.mult(Z)).mult(F));e.setLocationAtPoint(e.renderWorldCopies?W.wrap():W,G)},scaleOfZoom:k,targetCenter:y,scaleOfMinZoom:A,pixelPathLength:M}}}class ei{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}ei.Replace=[1,0],ei.disabled=new ei(ei.Replace,o.bf.transparent,[!1,!1,!1,!1]),ei.unblended=new ei(ei.Replace,o.bf.transparent,[!0,!0,!0,!0]),ei.alphaBlended=new ei([1,771],o.bf.transparent,[!0,!0,!0,!0]);let To=2305;class rt{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}rt.disabled=new rt(!1,1029,To),rt.backCCW=new rt(!0,1029,To),rt.frontCCW=new rt(!0,1028,To);class ht{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}ht.ReadOnly=!1,ht.ReadWrite=!0,ht.disabled=new ht(519,ht.ReadOnly,[0,1]);let Er=7680;class Lt{constructor(e,r,s,c,p,y){this.test=e,this.ref=r,this.mask=s,this.fail=c,this.depthFail=p,this.pass=y}}Lt.disabled=new Lt({func:519,mask:0},0,0,Er,Er,Er);let In=new WeakMap;function mr(h){var e;if(In.has(h))return In.get(h);{let r=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return In.set(h,r),r}}class fr{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let r=e.context,s=r.gl;this._texFormat=s.RGBA,this._texType=s.UNSIGNED_BYTE;let c=new o.aL;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);let p=new o.aN;p.emplaceBack(0,1,2),this._fullscreenTriangle=new xo(r.createVertexBuffer(c,eo.members),r.createIndexBuffer(p),o.aM.simpleSegment(0,0,c.length,p.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(s.TEXTURE1);let y=s.createTexture();s.bindTexture(s.TEXTURE_2D,y),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),mr(s)&&(this._pbo=s.createBuffer(),s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.bufferData(s.PIXEL_PACK_BUFFER,4,s.STREAM_READ),s.bindBuffer(s.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){let s=this._updateCount;return this._readbackQueue?s>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():s>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){let s=this._cachedRenderContext.context,c=s.gl;if(this._bindFramebuffer(),s.viewport.set([0,0,this._texWidth,this._texHeight]),s.clear({color:o.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(s,c.TRIANGLES,ht.disabled,Lt.disabled,ei.unblended,rt.disabled,((p,y)=>({u_input:p,u_output_expected:y}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&mr(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);let p=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:p}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&mr(e)){let r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=fr._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}let zs=o.$/128;function rc(h,e){let r=h.granularity!==void 0?Math.max(h.granularity,1):1,s=r+(h.generateBorders?2:0),c=r+(h.extendToNorthPole||h.generateBorders?1:0)+(h.extendToSouthPole||h.generateBorders?1:0),p=s+1,y=c+1,w=h.generateBorders?-1:0,T=h.generateBorders||h.extendToNorthPole?-1:0,P=r+(h.generateBorders?1:0),M=r+(h.generateBorders||h.extendToSouthPole?1:0),k=p*y,A=s*c*6,D=p*y>65536;if(D&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let F=D||e==="32bit",Z=new Int16Array(2*k),G=0;for(let ee=T;ee<=M;ee++)for(let K=w;K<=P;K++){let ie=K/r*o.$;K===-1&&(ie=-zs),K===r+1&&(ie=o.$+zs);let oe=ee/r*o.$;ee===-1&&(oe=h.extendToNorthPole?o.bh:-zs),ee===r+1&&(oe=h.extendToSouthPole?o.bi:o.$+zs),Z[G++]=ie,Z[G++]=oe}let W=F?new Uint32Array(A):new Uint16Array(A),X=0;for(let ee=0;ee<c;ee++)for(let K=0;K<s;K++){let ie=K+1+ee*p,oe=K+(ee+1)*p,J=K+1+(ee+1)*p;W[X++]=K+ee*p,W[X++]=oe,W[X++]=ie,W[X++]=ie,W[X++]=oe,W[X++]=J}return{vertices:Z.buffer.slice(0),indices:W.buffer.slice(0),uses32bitIndices:F}}let oa=new o.aK({fill:new o.bj(128,2),line:new o.bj(512,0),tile:new o.bj(128,32),stencil:new o.bj(128,1),circle:3});class Na{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Zn.projectionGlobe}get vertexShaderPreludeCode(){return Zn.projectionMercator.vertexSource}get subdivisionGranularity(){return oa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new fr(e));let r=o.U(this._errorQueryLatitudeDegrees),s=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(r,s),p=ne.now();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=p);let y=Math.min(Math.max((p-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bl(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,s,c,p){let y=(p==="stencil"?oa.stencil:oa.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:y,generateBorders:s,extendToNorthPole:r.y===0&&c,extendToSouthPole:r.y===(1<<r.z)-1&&c})}_getMesh(e,r){let s=this._getMeshKey(r);if(s in this._tileMeshCache)return this._tileMeshCache[s];let c=(function(p,y){let w=rc(y,"16bit"),T=o.aL.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),P=o.aN.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new xo(p.createVertexBuffer(T,eo.members),p.createIndexBuffer(P),o.aM.simpleSegment(0,0,T.length,P.length))})(e,r);return this._tileMeshCache[s]=c,c}recalculate(e){}hasTransition(){let e=ne.now(),r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let Rs=new o.r({type:new o.D(o.v.projection.type)});class Fs extends o.E{constructor(e){super(),this._transitionable=new o.t(Rs),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new Tt,this._verticalPerspectiveProjection=new Na}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,s,c,p){return this.currentProjection.getMeshFromTileID(e,r,s,c,p)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Bs(h){let e=aa(h.worldSize,h.center.lat);return 2*Math.PI*e}function qn(h,e,r,s,c){let p=1/(1<<c),y=e/o.$*p+s*p,w=o.bo((h/o.$*p+r*p)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,P=Math.cos(T),M=new Float64Array(3);return M[0]=Math.sin(w)*P,M[1]=Math.sin(T),M[2]=Math.cos(w)*P,M}function Ri(h){return(function(e,r){let s=Math.cos(r),c=new Float64Array(3);return c[0]=Math.sin(e)*s,c[1]=Math.sin(r),c[2]=Math.cos(e)*s,c})(h.lng*Math.PI/180,h.lat*Math.PI/180)}function aa(h,e){return h/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Va(h){let e=Math.asin(h[1])/Math.PI*180,r=Math.sqrt(h[0]*h[0]+h[2]*h[2]);if(r>1e-6){let s=h[0]/r,c=Math.acos(h[2]/r),p=(s>0?c:-c)/Math.PI*180;return new o.S(o.aO(p,-180,180),e)}return new o.S(0,e)}function So(h){return Math.cos(h*Math.PI/180)}function di(h,e){let r=So(h),s=So(e);return o.ak(s/r)}function Iu(h,e){let r=h.rotate(e.bearingInRadians),s=e.zoom+di(e.center.lat,0),c=o.bk(1/So(e.center.lat),1/So(Math.min(Math.abs(e.center.lat),60)),o.bn(s,7,3,0,1)),p=360/Bs({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.S(e.center.lng-r.x*p*c,o.ah(e.center.lat+r.y*p,-o.ai,o.ai))}function $a(h){let e=.5*h,r=Math.sin(e),s=Math.cos(e);return Math.log(r+s)-Math.log(s-r)}function oc(h,e,r,s){let c=h.lat+r*s;if(Math.abs(r)>1){let p=(Math.sign(h.lat+r)!==Math.sign(h.lat)?-Math.abs(h.lat):Math.abs(h.lat))*Math.PI/180,y=Math.abs(h.lat+r)*Math.PI/180,w=$a(p+s*(y-p)),T=$a(p),P=$a(y);return new o.S(h.lng+e*((w-T)/(P-T)),c)}return new o.S(h.lng+e*s,c)}class up{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,s,c){let p=`${e.z}_${e.x}_${e.y}_${c?.terrain?"t":""}`,y=this._cache.get(p);if(y)return y;let w=this._cachePrevious.get(p);if(w)return this._cache.set(p,w),w;let T=this._boundingVolumeFactory(e,r,s,c);return this._cache.set(p,T),this._hadAnyChanges=!0,T}}class sa{constructor(e,r,s,c){this.min=s,this.max=c,this.points=e,this.planes=r}static fromAabb(e,r){let s=[];for(let c=0;c<8;c++)s.push([1&~c?e[0]:r[0],(c>>1&1)==1?r[1]:e[1],(c>>2&1)==1?r[2]:e[2]]);return new sa(s,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,s){let c=o.br([],s[0],s[1],s[2]),p=o.bs([],[r[0],0,0],c),y=o.bs([],[0,r[1],0],c),w=o.bs([],[0,0,r[2]],c),T=[...e],P=[...e];for(let k=0;k<8;k++)for(let A=0;A<3;A++){let D=e[A]+p[A]*(1&~k?-1:1)+y[A]*((k>>1&1)==1?1:-1)+w[A]*((k>>2&1)==1?1:-1);T[A]=Math.min(T[A],D),P[A]=Math.max(P[A],D)}let M=[];for(let k=0;k<8;k++){let A=[...e];o.aS(A,A,o.aR([],p,1&~k?-1:1)),o.aS(A,A,o.aR([],y,(k>>1&1)==1?1:-1)),o.aS(A,A,o.aR([],w,(k>>2&1)==1?1:-1)),M.push(A)}return new sa(M,[[...p,-o.aX(p,M[0])],[...y,-o.aX(y,M[0])],[...w,-o.aX(w,M[0])],[-p[0],-p[1],-p[2],-o.aX(p,M[7])],[-y[0],-y[1],-y[2],-o.aX(y,M[7])],[-w[0],-w[1],-w[2],-o.aX(w,M[7])]],T,P)}intersectsFrustum(e){let r=!0,s=this.points.length,c=this.planes.length,p=e.planes.length,y=e.points.length;for(let w=0;w<p;w++){let T=e.planes[w],P=0;for(let M=0;M<s;M++){let k=this.points[M];T[0]*k[0]+T[1]*k[1]+T[2]*k[2]+T[3]>=0&&P++}if(P===0)return 0;P<s&&(r=!1)}if(r)return 2;for(let w=0;w<c;w++){let T=this.planes[w],P=0;for(let M=0;M<y;M++){let k=e.points[M];T[0]*k[0]+T[1]*k[1]+T[2]*k[2]+T[3]>=0&&P++}if(P===0)return 0}return 1}intersectsPlane(e){let r=this.points.length,s=0;for(let c=0;c<r;c++){let p=this.points[c];e[0]*p[0]+e[1]*p[1]+e[2]*p[2]+e[3]>=0&&s++}return s===r?2:s===0?0:1}}function Zi(h,e,r){let s=h-e;return s<0?-s:Math.max(0,s-r)}function Ga(h,e,r,s,c){let p=h-r,y;return y=p<0?Math.min(-p,1+p-c):p>1?Math.min(Math.max(p-c,0),1-p):0,Math.max(y,Zi(e,s,c))}class gr{constructor(){this._boundingVolumeCache=new up(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,s,c){let p=1<<s.z,y=1/p,w=s.x/p,T=s.y/p,P=2;return P=Math.min(P,Ga(e,r,w,T,y)),P=Math.min(P,Ga(e,r,w+.5,-T-y,y)),P=Math.min(P,Ga(e,r,w+.5,2-T-y,y)),P}getWrap(e,r,s){let c=1<<r.z,p=1/c,y=r.x/c,w=Zi(e.x,y,p),T=Zi(e.x,y-1,p),P=Zi(e.x,y+1,p),M=Math.min(w,T,P);return M===P?1:M===T?-1:0}allowVariableZoom(e,r){return Xe(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,s,c){return this._boundingVolumeCache.getTileBoundingVolume(e,r,s,c)}_computeTileBoundingVolume(e,r,s,c){var p,y;let w=0,T=0;if(c?.terrain){let P=new o.Z(e.z,r,e.z,e.x,e.y),M=c.terrain.getMinMaxElevation(P);w=(p=M.minElevation)!==null&&p!==void 0?p:Math.min(0,s),T=(y=M.maxElevation)!==null&&y!==void 0?y:Math.max(0,s)}if(w/=o.bu,T/=o.bu,w+=1,T+=1,e.z<=0)return sa.fromAabb([-T,-T,-T],[T,T,T]);if(e.z===1)return sa.fromAabb([e.x===0?-T:0,e.y===0?0:-T,-T],[e.x===0?0:T,e.y===0?T:0,T]);{let P=[qn(0,0,e.x,e.y,e.z),qn(o.$,0,e.x,e.y,e.z),qn(o.$,o.$,e.x,e.y,e.z),qn(0,o.$,e.x,e.y,e.z)],M=[];for(let me of P)M.push(o.aR([],me,T));if(T!==w)for(let me of P)M.push(o.aR([],me,w));e.y===0&&M.push([0,1,0]),e.y===(1<<e.z)-1&&M.push([0,-1,0]);let k=[1,1,1],A=[-1,-1,-1];for(let me of M)for(let ye=0;ye<3;ye++)k[ye]=Math.min(k[ye],me[ye]),A[ye]=Math.max(A[ye],me[ye]);let D=qn(o.$/2,o.$/2,e.x,e.y,e.z),F=o.aW([],[0,1,0],D);o.aV(F,F);let Z=o.aW([],D,F);o.aV(Z,Z);let G=o.aW([],P[2],P[1]);o.aV(G,G);let W=o.aW([],P[0],P[3]);o.aV(W,W),M.push(o.aR([],D,T)),e.y>=(1<<e.z)/2&&M.push(o.aR([],qn(o.$/2,0,e.x,e.y,e.z),T)),e.y<(1<<e.z)/2&&M.push(o.aR([],qn(o.$/2,o.$,e.x,e.y,e.z),T));let X=Za(D,M),ee=Za(Z,M),K=[-D[0],-D[1],-D[2],X.max],ie=[D[0],D[1],D[2],-X.min],oe=[-Z[0],-Z[1],-Z[2],ee.max],J=[Z[0],Z[1],Z[2],-ee.min],ue=[...G,0],xe=[...W,0],de=[];return e.y===0?de.push(o.bt(xe,ue,K),o.bt(xe,ue,ie)):de.push(o.bt(oe,ue,K),o.bt(oe,ue,ie),o.bt(oe,xe,K),o.bt(oe,xe,ie)),e.y===(1<<e.z)-1?de.push(o.bt(xe,ue,K),o.bt(xe,ue,ie)):de.push(o.bt(J,ue,K),o.bt(J,ue,ie),o.bt(J,xe,K),o.bt(J,xe,ie)),new sa(de,[K,ie,oe,J,ue,xe],k,A)}}}function Za(h,e){let r=1/0,s=-1/0;for(let c of e){let p=o.aX(h,c);r=Math.min(r,p),s=Math.max(s,p)}return{min:r,max:s}}class qa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,s){return this._helper.interpolatePadding(e,r,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=o.bv(),this._projectionMatrix=o.b9(),this._globeViewProjMatrix32f=o.b8(),this._globeViewProjMatrixNoCorrection=o.b9(),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),this._globeProjMatrixInverted=o.b9(),this._cameraPosition=o.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new nn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._coveringTilesDetailsProvider=new gr}clone(){let e=new qa;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=o.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:r,applyGlobeMatrix:s}=e,c=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:s?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let r=this.pitchInRadians,s=this.cameraToCenterDistance/e,c=Math.sin(r)*s,p=Math.cos(r)*s+1,y=1/Math.sqrt(c*c+p*p)*1,w=-c,T=p,P=Math.sqrt(w*w+T*T);w/=P,T/=P;let M=[0,w,T];o.bw(M,M,[0,0,0],-this.bearingInRadians),o.bx(M,M,[0,0,0],-1*this.center.lat*Math.PI/180),o.by(M,M,[0,0,0],this.center.lng*Math.PI/180);let k=1/o.aZ(M);return o.aR(M,M,k),[...M,-y*k]}isLocationOccluded(e){return!this.isSurfacePointVisible(Ri(e))}transformLightDirection(e){let r=this._helper._center.lng*Math.PI/180,s=this._helper._center.lat*Math.PI/180,c=Math.cos(s),p=[Math.sin(r)*c,Math.sin(s),Math.cos(r)*c],y=[p[2],0,-p[0]],w=[0,0,0];o.aW(w,y,p),o.aV(y,y),o.aV(w,w);let T=[0,0,0];return o.aV(T,[y[0]*e[0]+w[0]*e[1]+p[0]*e[2],y[1]*e[0]+w[1]*e[1]+p[1]*e[2],y[2]*e[0]+w[2]*e[1]+p[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,s){let c=(function(w,T,P){let M=1/(1<<P.z);return new o.a1(w/o.$*M+P.x*M,T/o.$*M+P.y*M)})(e,r,s.canonical),p=(y=c.y,[o.bo(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(p[1])}projectTileCoordinates(e,r,s,c){let p=s.canonical,y=qn(e,r,p.x,p.y,p.z),w=1+(c?c(e,r):0)/o.bu,T=[y[0]*w,y[1]*w,y[2]*w,1];o.aw(T,T,this._globeViewProjMatrixNoCorrection);let P=this._cachedClippingPlane,M=P[0]*y[0]+P[1]*y[1]+P[2]*y[2]+P[3]<0;return{point:new o.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:M}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=aa(this.worldSize,this.center.lat),r=o.ba(),s=o.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.b4(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let c=this.centerOffset;r[8]=2*-c.x/this._helper._width,r[9]=2*c.y/this._helper._height,this._projectionMatrix=o.b5(r),this._globeProjMatrixInverted=o.ba(),o.aq(this._globeProjMatrixInverted,r),o.M(r,r,[0,0,-this.cameraToCenterDistance]),o.b6(r,r,this.rollInRadians),o.b7(r,r,-this.pitchInRadians),o.b6(r,r,this.bearingInRadians),o.M(r,r,[0,0,-e]);let p=o.bp();p[0]=e,p[1]=e,p[2]=e,o.b7(s,r,this.center.lat*Math.PI/180),o.bz(s,s,-this.center.lng*Math.PI/180),o.N(s,s,p),this._globeViewProjMatrixNoCorrection=s,o.b7(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bz(r,r,-this.center.lng*Math.PI/180),o.N(r,r,p),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=o.ba(),o.aq(this._globeViewProjMatrixNoCorrectionInverted,s);let y=o.bp();this._cameraPosition=o.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bw(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),o.bx(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),o.bw(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),o.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bx(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),o.by(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let w=o.b5(this._globeViewProjMatrixNoCorrectionInverted);o.N(w,w,[1,1,-1]),this._cachedFrustum=xi.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");let r=o.ba();return o.ag(r),r}getVisibleUnwrappedCoordinates(e){return[new o.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;let s=Ri(e);o.aR(s,s,1+r/o.bu);let c=o.bv();return o.aw(c,[s[0],s[1],s[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(e){}getBounds(){let e=.5*this.width,r=.5*this.height,s=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,r),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,r)],c=[];for(let k of s)c.push(this.unprojectScreenPoint(k));let p=0,y=0,w=0,T=0,P=this.center;for(let k of c){let A=o.bA(P.lng,k.lng),D=o.bA(P.lat,k.lat);A<y&&(y=A),A>p&&(p=A),D<T&&(T=D),D>w&&(w=D)}let M=[P.lng+y,P.lat+T,P.lng+p,P.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(M[3]=90,M[0]=-180,M[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(M[1]=-90,M[0]=-180,M[2]=180),new hi(M)}getConstrained(e,r){let s=o.ah(e.lat,-o.ai,o.ai),c=o.ah(+r,this.minZoom+di(0,s),this.maxZoom);return{center:new o.S(e.lng,s),zoom:c}}calculateCenterFromCameraLngLatAlt(e,r,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,s,c)}setLocationAtPoint(e,r){let s=Ri(this.unprojectScreenPoint(r)),c=Ri(e),p=o.bp();o.bB(p);let y=o.bp();o.by(y,s,p,-this.center.lng*Math.PI/180),o.bx(y,y,p,this.center.lat*Math.PI/180);let w=c[0]*c[0]+c[2]*c[2],T=y[0]*y[0];if(w<T)return;let P=Math.sqrt(w-T),M=-P,k=o.bC(c[0],c[2],y[0],P),A=o.bC(c[0],c[2],y[0],M),D=o.bp();o.by(D,c,p,-k);let F=o.bC(D[1],D[2],y[1],y[2]),Z=o.bp();o.by(Z,c,p,-A);let G=o.bC(Z[1],Z[2],y[1],y[2]),W=.5*Math.PI,X=F>=-W&&F<=W,ee=G>=-W&&G<=W,K,ie;if(X&&ee){let xe=this.center.lng*Math.PI/180,de=this.center.lat*Math.PI/180;o.bD(k,xe)+o.bD(F,de)<o.bD(A,xe)+o.bD(G,de)?(K=k,ie=F):(K=A,ie=G)}else if(X)K=k,ie=F;else{if(!ee)return;K=A,ie=G}let oe=K/Math.PI*180,J=ie/Math.PI*180,ue=this.center.lat;this.setCenter(new o.S(oe,o.ah(J,-90,90))),this.setZoom(this.zoom+di(ue,this.center.lat))}locationToScreenPoint(e,r){let s=Ri(e);if(r){let c=r.getElevationForLngLatZoom(e,this._helper._tileZoom);o.aR(s,s,1+c/o.bu)}return this._projectSurfacePointToScreen(s)}_projectSurfacePointToScreen(e){let r=o.bv();return o.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new o.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){let s=r.pointCoordinate(e);if(s)return s}return o.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var s;return(s=this.screenPointToMercatorCoordinate(e,r))===null||s===void 0?void 0:s.toLngLat()}isPointOnMapSurface(e,r){let s=this._cameraPosition,c=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(s,c)}getRayDirectionFromPixel(e){let r=o.bv();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,o.aw(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];let s=o.bp();s[0]=r[0]-this._cameraPosition[0],s[1]=r[1]-this._cameraPosition[1],s[2]=r[2]-this._cameraPosition[2];let c=o.bp();return o.aV(c,s),c}isSurfacePointVisible(e){let r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let r=o.bv();return o.aw(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){let s=o.aX(e,r),c=o.bp(),p=o.bp();o.aR(p,r,s),o.aU(c,e,p);let y=1-o.aX(c,c);if(y<0)return null;let w=o.aX(e,e)-1,T=-s+(s<0?1:-1)*Math.sqrt(y),P=w/T,M=T;return{tMin:Math.min(P,M),tMax:Math.max(P,M)}}unprojectScreenPoint(e){let r=this._cameraPosition,s=this.getRayDirectionFromPixel(e),c=this.rayPlanetIntersection(r,s);if(c){let M=o.bp();o.aS(M,r,[s[0]*c.tMin,s[1]*c.tMin,s[2]*c.tMin]);let k=o.bp();return o.aV(k,M),Va(k)}let p=this._cachedClippingPlane,y=p[0]*s[0]+p[1]*s[1]+p[2]*s[2],w=-o.b1(p,r)/y,T=o.bp();if(w>0)o.aS(T,r,[s[0]*w,s[1]*w,s[2]*w]);else{let M=o.bp();o.aS(M,r,[2*s[0],2*s[1],2*s[2]]);let k=o.b1(this._cachedClippingPlane,M);o.aU(T,M,[this._cachedClippingPlane[0]*k,this._cachedClippingPlane[1]*k,this._cachedClippingPlane[2]*k])}let P=(function(M){let k=o.bp();return k[0]=M[0]*-M[3],k[1]=M[1]*-M[3],k[2]=M[2]*-M[3],{center:k,radius:Math.sqrt(1-M[3]*M[3])}})(p);return Va((function(M,k,A){let D=o.bp();o.aU(D,A,M);let F=o.bp();return o.bq(F,M,D,k/o.a$(D)),F})(P.center,P.radius,T))}getMatrixForModel(e,r){let s=o.S.convert(e),c=1/o.bu,p=o.b9();return o.bz(p,p,s.lng/180*Math.PI),o.b7(p,p,-s.lat/180*Math.PI),o.M(p,p,[0,0,1+r/o.bu]),o.b7(p,p,.5*Math.PI),o.N(p,p,[c,c,c]),p}getProjectionDataForCustomLayer(e=!0){let r=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Wa{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,s){return this._helper.interpolatePadding(e,r,s)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,s=!0){this._helper.resize(e,r,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new nn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,r)=>this.getConstrained(e,r)}),this._globeness=1,this._mercatorTransform=new Wt,this._verticalPerspectiveTransform=new qa}clone(){let e=new Wa;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let r=this._mercatorTransform.getProjectionData(e),s=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?s.mainMatrix:r.mainMatrix,clippingPlane:s.clippingPlane,tileMercatorCoords:s.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,s){let c=this._mercatorTransform.getPitchedTextCorrection(e,r,s),p=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,s);return o.bk(c,p,this._globeness)}projectTileCoordinates(e,r,s,c){return this.currentTransform.projectTileCoordinates(e,r,s,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,r){return this.currentTransform.getConstrained(e,r)}calculateCenterFromCameraLngLatAlt(e,r,s,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,s,c)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){let r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;let s=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return s.fallbackMatrix=r.mainMatrix,s}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Ji{get useGlobeControls(){return!0}handlePanInertia(e,r){let s=Iu(e,r);return Math.abs(s.lng-r.center.lng)>180&&(s.lng=r.center.lng+179.5*Math.sign(s.lng-r.center.lng)),{easingCenter:s,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){let s=e.around,c=r.screenPointToLocation(s);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);let p=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);let y=r.zoom-p;if(y===0)return;let w=o.bA(r.center.lng,c.lng),T=w/(Math.abs(w/180)+1),P=o.bA(r.center.lat,c.lat),M=r.getRayDirectionFromPixel(s),k=r.cameraPosition,A=-1*o.aX(k,M),D=o.bp();o.aS(D,k,[M[0]*A,M[1]*A,M[2]*A]);let F=o.aZ(D)-1,Z=Math.exp(.5*-Math.max(F-.3,0)),G=aa(r.worldSize,r.center.lat)/Math.min(r.width,r.height),W=o.bn(G,.9,.5,1,.25),X=(1-o.af(-y))*Math.min(Z,W),ee=r.center.lat,K=r.zoom,ie=new o.S(r.center.lng+T*X,o.ah(r.center.lat+P*X,-o.ai,o.ai));r.setLocationAtPoint(c,s);let oe=r.center,J=o.bn(Math.abs(w),45,85,0,1),ue=o.bn(G,.75,.35,0,1),xe=Math.pow(Math.max(J,ue),.25),de=o.bA(oe.lng,ie.lng),me=o.bA(oe.lat,ie.lat);r.setCenter(new o.S(oe.lng+de*xe,oe.lat+me*xe).wrap()),r.setZoom(K+di(ee,r.center.lat))}handleMapControlsPan(e,r,s){if(!e.panDelta)return;let c=r.center.lat,p=r.zoom;r.setCenter(Iu(e.panDelta,r).wrap()),r.setZoom(p+di(c,r.center.lat))}cameraForBoxAndBearing(e,r,s,c,p){let y=Sn(e,r,s,c,p),w=r.left/p.width*2-1,T=(p.width-r.right)/p.width*2-1,P=r.top/p.height*-2+1,M=(p.height-r.bottom)/p.height*-2+1,k=o.bA(s.getWest(),s.getEast())<0,A=k?s.getEast():s.getWest(),D=k?s.getWest():s.getEast(),F=Math.max(s.getNorth(),s.getSouth()),Z=Math.min(s.getNorth(),s.getSouth()),G=A+.5*o.bA(A,D),W=F+.5*o.bA(F,Z),X=p.clone();X.setCenter(y.center),X.setBearing(y.bearing),X.setPitch(0),X.setRoll(0),X.setZoom(y.zoom);let ee=X.modelViewProjectionMatrix,K=[Ri(s.getNorthWest()),Ri(s.getNorthEast()),Ri(s.getSouthWest()),Ri(s.getSouthEast()),Ri(new o.S(D,W)),Ri(new o.S(A,W)),Ri(new o.S(G,F)),Ri(new o.S(G,Z))],ie=Ri(y.center),oe=Number.POSITIVE_INFINITY;for(let J of K)w<0&&(oe=Ji.getLesserNonNegativeNonNull(oe,Ji.solveVectorScale(J,ie,ee,"x",w))),T>0&&(oe=Ji.getLesserNonNegativeNonNull(oe,Ji.solveVectorScale(J,ie,ee,"x",T))),P>0&&(oe=Ji.getLesserNonNegativeNonNull(oe,Ji.solveVectorScale(J,ie,ee,"y",P))),M<0&&(oe=Ji.getLesserNonNegativeNonNull(oe,Ji.solveVectorScale(J,ie,ee,"y",M)));if(Number.isFinite(oe)&&oe!==0)return y.zoom=X.zoom+o.ak(oe),y;Su()}handleJumpToCenterZoom(e,r){let s=e.center.lat,c=e.getConstrained(r.center?o.S.convert(r.center):e.center,e.zoom).center;e.setCenter(c.wrap());let p=r.zoom!==void 0?+r.zoom:e.zoom+di(s,c.lat);e.zoom!==p&&e.setZoom(p)}handleEaseTo(e,r){let s=e.zoom,c=e.center,p=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},T=r.zoom!==void 0,P=!e.isPaddingEqual(r.padding),M=!1,k=r.center?o.S.convert(r.center):c,A=e.getConstrained(k,s).center;Ls(e,A);let D=e.clone();D.setCenter(A),D.setZoom(T?+r.zoom:s+di(c.lat,k.lat)),D.setBearing(r.bearing);let F=new o.P(o.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),o.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));D.setLocationAtPoint(A,F);let Z=(r.offset&&r.offsetAsPoint.mag())>0?D.center:A,G=T?+r.zoom:s+di(c.lat,Z.lat),W=s+di(c.lat,0),X=G+di(Z.lat,0),ee=o.bA(c.lng,Z.lng),K=o.bA(c.lat,Z.lat),ie=o.af(X-W);return M=G!==s,{easeFunc:oe=>{if(o.be(y,w)||on({startEulerAngles:y,endEulerAngles:w,tr:e,k:oe,useSlerp:y.roll!=w.roll}),P&&e.interpolatePadding(p,r.padding,oe),r.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{let J=X>W?Math.min(2,ie):Math.max(.5,ie),ue=Math.pow(J,1-oe),xe=oc(c,ee,K,oe*ue);e.setCenter(xe.wrap())}if(M){let J=o.C.number(W,X,oe)+di(0,e.center.lat);e.setZoom(J)}},isZooming:M,elevationCenter:Z}}handleFlyTo(e,r){let s=r.zoom!==void 0,c=e.center,p=e.zoom,y=e.padding,w=!e.isPaddingEqual(r.padding),T=e.getConstrained(o.S.convert(r.center||r.locationAtOffset),p).center,P=s?+r.zoom:e.zoom+di(e.center.lat,T.lat),M=e.clone();M.setCenter(T),M.setZoom(P),M.setBearing(r.bearing);let k=new o.P(o.ah(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),o.ah(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));M.setLocationAtPoint(T,k);let A=M.center;Ls(e,A);let D=(function(K,ie,oe){let J=Ri(ie),ue=Ri(oe),xe=o.aX(J,ue),de=Math.acos(xe),me=Bs(K);return de/(2*Math.PI)*me})(e,c,A),F=p+di(c.lat,0),Z=P+di(A.lat,0),G=o.af(Z-F),W;if(typeof r.minZoom=="number"){let K=+r.minZoom+di(A.lat,0),ie=Math.min(K,F,Z)+di(0,A.lat),oe=e.getConstrained(A,ie).zoom+di(A.lat,0);W=o.af(oe-F)}let X=o.bA(c.lng,A.lng),ee=o.bA(c.lat,A.lat);return{easeFunc:(K,ie,oe,J)=>{let ue=oc(c,X,ee,oe);w&&e.interpolatePadding(y,r.padding,K);let xe=K===1?A:ue;e.setCenter(xe.wrap());let de=F+o.ak(ie);e.setZoom(K===1?P:de+di(0,xe.lat))},scaleOfZoom:G,targetCenter:A,scaleOfMinZoom:W,pixelPathLength:D}}static solveVectorScale(e,r,s,c,p){let y=c==="x"?[s[0],s[4],s[8],s[12]]:[s[1],s[5],s[9],s[13]],w=[s[3],s[7],s[11],s[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],P=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],M=r[0]*y[0]+r[1]*y[1]+r[2]*y[2],k=r[0]*w[0]+r[1]*w[1]+r[2]*w[2];return M+p*P===T+p*k||w[3]*(T-M)+y[3]*(k-P)+T*k==M*P?null:(M+y[3]-p*k-p*w[3])/(M-T-p*k+p*P)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class Pu{constructor(e){this._globe=e,this._mercatorCameraHelper=new Yi,this._verticalPerspectiveCameraHelper=new Ji}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,s){this.currentHelper.handleMapControlsPan(e,r,s)}cameraForBoxAndBearing(e,r,s,c,p){return this.currentHelper.cameraForBoxAndBearing(e,r,s,c,p)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}let Os=(h,e)=>o.y(h,e&&e.filter(r=>r.identifier!=="source.canvas")),hp=o.bE();class ac extends o.E{constructor(e,r={}){var s,c;super(),this._rtlPluginLoaded=()=>{for(let y in this.sourceCaches){let w=this.sourceCaches[y].getSource().type;w!=="vector"&&w!=="geojson"||this.sourceCaches[y].reload()}},this.map=e,this.dispatcher=new fn(go(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,w)=>this.getGlyphs(y,w)),this.dispatcher.registerMessageHandler("GI",(y,w)=>this.getImages(y,w)),this.imageManager=new pn,this.imageManager.setEventedParent(this);let p=((s=e._container)===null||s===void 0?void 0:s.lang)||typeof document<"u"&&((c=document.documentElement)===null||c===void 0?void 0:c.lang)||void 0;this.glyphManager=new Vn(e._requestManager,r.localIdeographFontFamily,p),this.lineAtlas=new Ot(256,512),this.crossTileSymbolIndex=new ra,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bG()),Hr().on(yo,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;let w=this.sourceCaches[y.sourceId];if(!w)return;let T=w.getSource();if(T&&T.vectorLayerIds)for(let P in this._layers){let M=this._layers[P];M.source===T.id&&this._validateLayer(M)}})}setGlobalStateProperty(e,r){var s,c,p;this._checkLoaded();let y=r===null?(p=(c=(s=this.stylesheet.state)===null||s===void 0?void 0:s[e])===null||c===void 0?void 0:c.default)!==null&&p!==void 0?p:null:r;if(o.bH(y,this._globalState[e]))return this;this._globalState[e]=y,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();let r=[];for(let s in e)!o.bH(this._globalState[s],e[s].default)&&(r.push(s),this._globalState[s]=e[s].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(e){if(e.length===0)return;let r=new Set;for(let s in this._layers){let c=this._layers[s],p=c.getLayoutAffectingGlobalStateRefs(),y=c.getPaintAffectingGlobalStateRefs();for(let w of e)if(p.has(w)&&r.add(c.source),y.has(w))for(let{name:T,value:P}of y.get(w))this._updatePaintProperty(c,T,P)}for(let s in this.sourceCaches)r.has(s)&&(this._reloadSource(s),this._changed=!0)}loadURL(e,r={},s){this.fire(new o.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;let c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let p=this._loadStyleRequest;o.j(c,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,r,s)}).catch(y=>{this._loadStyleRequest=null,y&&!p.signal.aborted&&this.fire(new o.k(y))})}loadJSON(e,r={},s){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ne.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,s)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(hp,{validate:!1})}_load(e,r,s){var c,p,y;let w=r.transformStyle?r.transformStyle(s,e):e;if(!r.validate||!Os(this,o.z(w))){w=Object.assign({},w),this._loaded=!0,this.stylesheet=w;for(let T in w.sources)this.addSource(T,w.sources[T],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Pr(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new Oa(this.stylesheet.sky),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.setGlobalState((y=this.stylesheet.state)!==null&&y!==void 0?y:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){let e=o.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(let r of e){let s=o.bJ(r);s.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=s}}_loadSprite(e,r=!1,s=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(p,y,w,T){return o._(this,void 0,void 0,function*(){let P=tt(p),M=w>1?"@2x":"",k={},A={};for(let{id:D,url:F}of P){let Z=y.transformRequest(At(F,M,".json"),"SpriteJSON");k[D]=o.j(Z,T);let G=y.transformRequest(At(F,M,".png"),"SpriteImage");A[D]=nt.getImage(G,T)}return yield Promise.all([...Object.values(k),...Object.values(A)]),(function(D,F){return o._(this,void 0,void 0,function*(){let Z={};for(let G in D){Z[G]={};let W=ne.getImageCanvasContext((yield F[G]).data),X=(yield D[G]).data;for(let ee in X){let{width:K,height:ie,x:oe,y:J,sdf:ue,pixelRatio:xe,stretchX:de,stretchY:me,content:ye,textFitWidth:ze,textFitHeight:Be}=X[ee];Z[G][ee]={data:null,pixelRatio:xe,sdf:ue,stretchX:de,stretchY:me,content:ye,textFitWidth:ze,textFitHeight:Be,spriteData:{width:K,height:ie,x:oe,y:J,context:W}}}}return Z})})(k,A)})})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(let y in p){this._spritesImagesIds[y]=[];let w=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(T=>!(T in p)):[];for(let T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(let T in p[y]){let P=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,p[y][T],!1):this.imageManager.addImage(P,p[y][T]),r&&(this._changedImages[P]=!0)}}}).catch(p=>{this._spriteRequest=null,c=p,this.fire(new o.k(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),s&&s(c)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(e){let r=this.sourceCaches[e.source];if(!r)return;let s=e.sourceLayer;if(!s)return;let c=r.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(s)===-1)&&this.fire(new o.k(new Error(`Source layer "${s}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){let s=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?o.bK(s):s);let c=[];for(let p of e)if(s[p]){let y=r?o.bK(s[p]):s[p];c.push(y)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let r=Object.keys(this._layers);for(let s of r){let c=this._layers[s];c.type!=="custom"&&(e[s]=c.serialize())}return e}hasTransitions(){var e,r,s;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((s=this.projection)===null||s===void 0)&&s.hasTransition())return!0;for(let c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(let c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let r=this._changed;if(r){let c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(let y in this._updatedSources){let w=this._updatedSources[y];if(w==="reload")this._reloadSource(y);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let s={};for(let c in this.sourceCaches){let p=this.sourceCaches[c];s[c]=p.used,p.used=!1}for(let c of this._order){let p=this._layers[c];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(let c in s){let p=this.sourceCaches[c];!!s[c]!=!!p.used&&p.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var s;this._checkLoaded();let c=this.serialize();if(e=r.transformStyle?r.transformStyle(c,e):e,((s=r.validate)===null||s===void 0||s)&&Os(this,o.z(e)))return!1;(e=o.bK(e)).layers=o.bI(e.layers);let p=o.bL(c,e),y=this._getOperationsToPerform(p);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(let w of y.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let r=[],s=[];for(let c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":r.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":r.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,c.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setSky":r.push(()=>this.setSky.apply(this,c.args));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setGlobalState":r.push(()=>this.setGlobalState.apply(this,c.args));break;case"setTransition":r.push(()=>{});break;default:s.push(c.command)}return{operations:r,unimplemented:s}}addImage(e,r){if(this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,s={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(o.z.source,`sources.${e}`,r,null,s))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);let c=this.sourceCaches[e]=new xt(e,r,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let s in this._layers)if(this._layers[s].source===e)return this.fire(new o.k(new Error(`Source "${e}" cannot be removed while layer "${s}" is using it.`)));let r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let s=this.sourceCaches[e].getSource();if(s.type!=="geojson")throw new Error(`geojsonSource.type is ${s.type}, which is !== 'geojson`);s.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,s={}){this._checkLoaded();let c=e.id;if(this.getLayer(c))return void this.fire(new o.k(new Error(`Layer "${c}" already exists on this map.`)));let p;if(e.type==="custom"){if(Os(this,o.bM(e)))return;p=o.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=o.bK(e),e=o.e(e,{source:c})),this._validate(o.z.layer,`layers.${c}`,e,{arrayIndex:-1},s))return;p=o.bJ(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}let y=r?this._order.indexOf(r):this._order.length;if(r&&y===-1)this.fire(new o.k(new Error(`Cannot add layer "${c}" before non-existing layer "${r}".`)));else{if(this._order.splice(y,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){let w=this._removedLayers[c];delete this._removedLayers[c],w.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;let s=this._order.indexOf(e);this._order.splice(s,1);let c=r?this._order.indexOf(r):this._order.length;r&&c===-1?this.fire(new o.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let r=this._layers[e];if(!r)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);let s=this._order.indexOf(e);this._order.splice(s,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,s){this._checkLoaded();let c=this.getLayer(e);c?c.minzoom===r&&c.maxzoom===s||(r!=null&&(c.minzoom=r),s!=null&&(c.maxzoom=s),this._updateLayer(c)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,s={}){this._checkLoaded();let c=this.getLayer(e);if(c){if(!o.bH(c.filter,r))return r==null?(c.setFilter(void 0),void this._updateLayer(c)):void(this._validate(o.z.filter,`layers.${c.id}.filter`,r,null,s)||(c.setFilter(o.bK(r)),this._updateLayer(c)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bK(this.getLayer(e).filter)}setLayoutProperty(e,r,s,c={}){this._checkLoaded();let p=this.getLayer(e);p?o.bH(p.getLayoutProperty(r),s)||(p.setLayoutProperty(r,s,c),this._updateLayer(p)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){let s=this.getLayer(e);if(s)return s.getLayoutProperty(r);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,s,c={}){this._checkLoaded();let p=this.getLayer(e);p?o.bH(p.getPaintProperty(r),s)||this._updatePaintProperty(p,r,s,c):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,r,s,c={}){e.setPaintProperty(r,s,c)&&this._updateLayer(e),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();let s=e.source,c=e.sourceLayer,p=this.sourceCaches[s];if(p===void 0)return void this.fire(new o.k(new Error(`The source '${s}' does not exist in the map's style.`)));let y=p.getSource().type;y==="geojson"&&c?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||c?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,e.id,r)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();let s=e.source,c=this.sourceCaches[s];if(c===void 0)return void this.fire(new o.k(new Error(`The source '${s}' does not exist in the map's style.`)));let p=c.getSource().type,y=p==="vector"?e.sourceLayer:void 0;p!=="vector"||y?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(y,e.id,r):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let r=e.source,s=e.sourceLayer,c=this.sourceCaches[r];if(c!==void 0)return c.getSource().type!=="vector"||s?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),c.getFeatureState(s,e.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=o.bN(this.sourceCaches,p=>p.serialize()),r=this._serializeByIds(this._order,!0),s=this.map.getTerrain()||void 0,c=this.stylesheet;return o.bO({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:e,layers:r,terrain:s},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let r=y=>this._layers[y].type==="fill-extrusion",s={},c=[];for(let y=this._order.length-1;y>=0;y--){let w=this._order[y];if(r(w)){s[w]=y;for(let T of e){let P=T[w];if(P)for(let M of P)c.push(M)}}}c.sort((y,w)=>w.intersectionZ-y.intersectionZ);let p=[];for(let y=this._order.length-1;y>=0;y--){let w=this._order[y];if(r(w))for(let T=c.length-1;T>=0;T--){let P=c[T].feature;if(s[P.layer.id]<y)break;p.push(P),c.pop()}else for(let T of e){let P=T[w];if(P)for(let M of P)p.push(M.feature)}}return p}queryRenderedFeatures(e,r,s){r&&r.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",r.filter,null,r);let c={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let P of r.layers){let M=this._layers[P];if(!M)return this.fire(new o.k(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];c[M.source]=!0}}let p=[];r.availableImages=this._availableImages;let y=this._serializedAllLayers(),w=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,T=Object.assign(Object.assign({},r),{layers:w});for(let P in this.sourceCaches)r.layers&&!c[P]||p.push($n(this.sourceCaches[P],this._layers,y,e,T,s,this.map.terrain?(M,k,A)=>this.map.terrain.getElevation(M,k,A):void 0));return this.placement&&p.push((function(P,M,k,A,D,F,Z){let G={},W=F.queryRenderedSymbols(A),X=[];for(let ee of Object.keys(W).map(Number))X.push(Z[ee]);X.sort(Xo);for(let ee of X){let K=ee.featureIndex.lookupSymbolFeatures(W[ee.bucketInstanceId],M,ee.bucketIndex,ee.sourceLayerIndex,D.filter,D.layers,D.availableImages,P);for(let ie in K){let oe=G[ie]=G[ie]||[],J=K[ie];J.sort((ue,xe)=>{let de=ee.featureSortOrder;if(de){let me=de.indexOf(ue.featureIndex);return de.indexOf(xe.featureIndex)-me}return xe.featureIndex-ue.featureIndex});for(let ue of J)oe.push(ue)}}return(function(ee,K,ie){for(let oe in ee)for(let J of ee[oe])Ko(J,ie[K[oe].source]);return ee})(G,P,k)})(this._layers,y,this.sourceCaches,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,r){r&&r.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",r.filter,null,r);let s=this.sourceCaches[e];return s?(function(c,p){let y=c.getRenderableIds().map(P=>c.getTileByID(P)),w=[],T={};for(let P=0;P<y.length;P++){let M=y[P],k=M.tileID.canonical.key;T[k]||(T[k]=!0,M.querySourceFeatures(w,p))}return w})(s,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();let s=this.light.getLight(),c=!1;for(let y in e)if(!o.bH(e[y],s[y])){c=!0;break}if(!c)return;let p={now:ne.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(p)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();let s=this.getSky(),c=!1;if(!e&&!s)return;if(e&&!s)c=!0;else if(!e&&s)c=!0;else for(let y in e)if(!o.bH(e[y],s[y])){c=!0;break}if(!c)return;let p={now:ne.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(p)}_setProjectionInternal(e){let r=(function(s){if(Array.isArray(s)){let c=new Fs({type:s});return{projection:c,transform:new Wa,cameraHelper:new Pu(c)}}switch(s){case"mercator":return{projection:new Tt,transform:new Wt,cameraHelper:new Yi};case"globe":{let c=new Fs({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:c,transform:new Wa,cameraHelper:new Pu(c)}}case"vertical-perspective":return{projection:new Na,transform:new qa,cameraHelper:new Ji};default:return o.w(`Unknown projection name: ${s}. Falling back to mercator projection.`),{projection:new Tt,transform:new Wt,cameraHelper:new Yi}}})(e);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(let s in this.sourceCaches)this.sourceCaches[s].reload()}_validate(e,r,s,c,p={}){return(!p||p.validate!==!1)&&Os(this,e.call(o.z,o.e({key:r,style:this.serialize(),value:s,styleSpec:o.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Hr().off(yo,this._rtlPluginLoaded);for(let r in this._layers)this._layers[r].setEventedParent(null);for(let r in this.sourceCaches){let s=this.sourceCaches[r];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,s,c,p=!1){let y=!1,w=!1,T={};for(let P of this._order){let M=this._layers[P];if(M.type!=="symbol")continue;if(!T[M.source]){let A=this.sourceCaches[M.source];T[M.source]=A.getRenderableIds(!0).map(D=>A.getTileByID(D)).sort((D,F)=>F.tileID.overscaledZ-D.tileID.overscaledZ||(D.tileID.isLessThan(F.tileID)?-1:1))}let k=this.crossTileSymbolIndex.addLayer(M,T[M.source],e.center.lng);y=y||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||s===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ne.now(),e.zoom))&&(this.pauseablePlacement=new tc(e,this.map.terrain,this._order,p,r,s,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ne.now()),w=!0),y&&this.pauseablePlacement.placement.setStale()),w||y)for(let P of this._order){let M=this._layers[P];M.type==="symbol"&&this.placement.updateLayerOpacities(M,T[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ne.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return o._(this,void 0,void 0,function*(){let s=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();let c=this.sourceCaches[r.source];return c&&c.setDependencies(r.tileID.key,r.type,r.icons),s})}getGlyphs(e,r){return o._(this,void 0,void 0,function*(){let s=yield this.glyphManager.getGlyphs(r.stacks),c=this.sourceCaches[r.source];return c&&c.setDependencies(r.tileID.key,r.type,[""]),s})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(o.z.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,s={},c){this._checkLoaded();let p=[{id:e,url:r}],y=[...tt(this.stylesheet.sprite),...p];this._validate(o.z.sprite,"sprite",y,null,s)||(this.stylesheet.sprite=y,this._loadSprite(p,!0,c))}removeSprite(e){this._checkLoaded();let r=tt(this.stylesheet.sprite);if(r.find(s=>s.id===e)){if(this._spritesImagesIds[e])for(let s of this._spritesImagesIds[e])this.imageManager.removeImage(s),this._changedImages[s]=!0;r.splice(r.findIndex(s=>s.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return tt(this.stylesheet.sprite)}setSprite(e,r={},s){this._checkLoaded(),e&&this._validate(o.z.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,s):(this._unloadSprite(),s&&s(null)))}}var pp=o.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class dp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,s,c,p,y,w,T,P){this.context=e;let M=this.boundPaintVertexBuffers.length!==c.length;for(let k=0;!M&&k<c.length;k++)this.boundPaintVertexBuffers[k]!==c[k]&&(M=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==s||M||this.boundIndexBuffer!==p||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==P?this.freshBind(r,s,c,p,y,w,T,P):(e.bindVertexArray.set(this.vao),w&&w.bind(),p&&p.dynamicDraw&&p.bind(),T&&T.bind(),P&&P.bind())}freshBind(e,r,s,c,p,y,w,T){let P=e.numAttributes,M=this.context,k=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=s,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,r.enableAttributes(k,e);for(let A of s)A.enableAttributes(k,e);y&&y.enableAttributes(k,e),w&&w.enableAttributes(k,e),T&&T.enableAttributes(k,e),r.bind(),r.setVertexAttribPointers(k,e,p);for(let A of s)A.bind(),A.setVertexAttribPointers(k,e,p);y&&(y.bind(),y.setVertexAttribPointers(k,e,p)),c&&c.bind(),w&&(w.bind(),w.setVertexAttribPointers(k,e,p)),T&&(T.bind(),T.setVertexAttribPointers(k,e,p)),M.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let js=(h,e,r,s,c)=>({u_texture:0,u_ele_delta:h,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):o.bf.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:r?r.calculateFogBlendOpacity(s):0,u_horizon_color:r?r.properties.get("horizon-color"):o.bf.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),sc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Io(h){let e=[];for(let r=0;r<h.length;r++){if(h[r]===null)continue;let s=h[r].split(" ");e.push(s.pop())}return e}class lc{constructor(e,r,s,c,p,y,w,T,P=[]){let M=e.gl;this.program=M.createProgram();let k=Io(r.staticAttributes),A=s?s.getBinderAttributes():[],D=k.concat(A),F=Zn.prelude.staticUniforms?Io(Zn.prelude.staticUniforms):[],Z=w.staticUniforms?Io(w.staticUniforms):[],G=r.staticUniforms?Io(r.staticUniforms):[],W=s?s.getBinderUniforms():[],X=F.concat(Z).concat(G).concat(W),ee=[];for(let de of X)ee.indexOf(de)<0&&ee.push(de);let K=s?s.defines():[];mr(M)&&K.unshift("#version 300 es"),p&&K.push("#define OVERDRAW_INSPECTOR;"),y&&K.push("#define TERRAIN3D;"),T&&K.push(T),P&&K.push(...P);let ie=K.concat(Zn.prelude.fragmentSource,w.fragmentSource,r.fragmentSource).join(`
`),oe=K.concat(Zn.prelude.vertexSource,w.vertexSource,r.vertexSource).join(`
`);mr(M)||(ie=(function(de){return de.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ie),oe=(function(de){return de.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(oe));let J=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(J,ie),M.compileShader(J),!M.getShaderParameter(J,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(J)}`);M.attachShader(this.program,J);let ue=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(ue,oe),M.compileShader(ue),!M.getShaderParameter(ue,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(ue)}`);M.attachShader(this.program,ue),this.attributes={};let xe={};this.numAttributes=D.length;for(let de=0;de<this.numAttributes;de++)D[de]&&(M.bindAttribLocation(this.program,de,D[de]),this.attributes[D[de]]=de);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(ue),M.deleteShader(J);for(let de=0;de<ee.length;de++){let me=ee[de];if(me&&!xe[me]){let ye=M.getUniformLocation(this.program,me);ye&&(xe[me]=ye)}}this.fixedUniforms=c(e,xe),this.terrainUniforms=((de,me)=>({u_depth:new o.bP(de,me.u_depth),u_terrain:new o.bP(de,me.u_terrain),u_terrain_dim:new o.bg(de,me.u_terrain_dim),u_terrain_matrix:new o.bR(de,me.u_terrain_matrix),u_terrain_unpack:new o.bS(de,me.u_terrain_unpack),u_terrain_exaggeration:new o.bg(de,me.u_terrain_exaggeration)}))(e,xe),this.projectionUniforms=((de,me)=>({u_projection_matrix:new o.bR(de,me.u_projection_matrix),u_projection_tile_mercator_coords:new o.bS(de,me.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bS(de,me.u_projection_clipping_plane),u_projection_transition:new o.bg(de,me.u_projection_transition),u_projection_fallback_matrix:new o.bR(de,me.u_projection_fallback_matrix)}))(e,xe),this.binderUniforms=s?s.getUniforms(e,xe):[]}draw(e,r,s,c,p,y,w,T,P,M,k,A,D,F,Z,G,W,X,ee){let K=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(s),e.setStencilMode(c),e.setColorMode(p),e.setCullFace(y),T){e.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,T.depthTexture),e.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,T.texture);for(let oe in this.terrainUniforms)this.terrainUniforms[oe].set(T[oe])}if(P)for(let oe in P)this.projectionUniforms[sc[oe]].set(P[oe]);if(w)for(let oe in this.fixedUniforms)this.fixedUniforms[oe].set(w[oe]);G&&G.setUniforms(e,this.binderUniforms,F,{zoom:Z});let ie=0;switch(r){case K.LINES:ie=2;break;case K.TRIANGLES:ie=3;break;case K.LINE_STRIP:ie=1}for(let oe of D.get()){let J=oe.vaos||(oe.vaos={});(J[M]||(J[M]=new dp)).bind(e,this,k,G?G.getPaintVertexBuffers():[],A,oe.vertexOffset,W,X,ee),K.drawElements(r,oe.primitiveLength*ie,K.UNSIGNED_SHORT,oe.primitiveOffset*ie*2)}}}function Us(h,e,r){let s=1/o.aC(r,1,e.transform.tileZoom),c=Math.pow(2,r.tileID.overscaledZ),p=r.tileSize*Math.pow(2,e.transform.tileZoom)/c,y=p*(r.tileID.canonical.x+r.tileID.wrap*c),w=p*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[s,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w]}}let Wn=(h,e,r,s)=>{let c=h.style.light,p=c.properties.get("position"),y=[p.x,p.y,p.z],w=o.bV();c.properties.get("anchor")==="viewport"&&o.bW(w,h.transform.bearingInRadians),o.bX(y,y,w);let T=h.transform.transformLightDirection(y),P=c.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:s}},mp=(h,e,r,s,c,p,y)=>o.e(Wn(h,e,r,s),Us(p,h,y),{u_height_factor:-Math.pow(2,c.overscaledZ)/y.tileSize/8}),Ns=(h,e,r,s)=>o.e(Us(e,h,r),{u_fill_translate:s}),Ha=(h,e)=>({u_world:h,u_fill_translate:e}),Xa=(h,e,r,s,c)=>o.e(Ns(h,e,r,c),{u_world:s}),fp=(h,e,r,s,c)=>{let p=h.transform,y,w,T=0;if(r.paint.get("circle-pitch-alignment")==="map"){let P=o.aC(e,1,p.zoom);y=!0,w=[P,P],T=P/(o.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*c}else y=!1,w=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:T,u_translate:s}},Vs=h=>({u_pixel_extrude_scale:[1/h.width,1/h.height]}),gp=h=>({u_viewport_size:[h.width,h.height]}),Po=(h,e=1)=>({u_color:h,u_overlay:0,u_overlay_scale:e}),Cu=(h,e,r,s)=>{let c=o.aC(h,1,e)/(o.$*Math.pow(2,h.tileID.overscaledZ))*2*Math.PI*s;return{u_extrude_scale:o.aC(h,1,e),u_intensity:r,u_globe_extrude_scale:c}},cc=(h,e,r,s)=>{let c=o.L();o.bY(c,0,h.width,h.height,0,0,1);let p=h.context.gl;return{u_matrix:c,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:r,u_color_ramp:s,u_opacity:e.paint.get("heatmap-opacity")}},_p=(h,e,r)=>{let s=r.paint.get("hillshade-accent-color"),c;switch(r.paint.get("hillshade-method")){case"basic":c=4;break;case"combined":c=1;break;case"igor":c=2;break;case"multidirectional":c=3;break;default:c=0}let p=r.getIlluminationProperties();for(let y=0;y<p.directionRadians.length;y++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(p.directionRadians[y]+=h.transform.bearingInRadians);return{u_image:0,u_latrange:uc(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:p.altitudeRadians,u_azimuths:p.directionRadians,u_accent:s,u_method:c,u_highlights:p.highlightColor,u_shadows:p.shadowColor}},Mu=(h,e)=>{let r=e.stride,s=o.L();return o.bY(s,0,o.$,-o.$,0,0,1),o.M(s,s,[0,-o.$,0]),{u_matrix:s,u_image:1,u_dimension:[r,r],u_zoom:h.overscaledZ,u_unpack:e.getUnpackVector()}};function uc(h,e){let r=Math.pow(2,e.canonical.z),s=e.canonical.y;return[new o.a1(0,s/r).toLngLat().lat,new o.a1(0,(s+1)/r).toLngLat().lat]}let Eu=(h,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:h.paint.get("color-relief-opacity")}),$s=(h,e,r,s)=>{let c=h.transform;return{u_translation:pc(h,e,r),u_ratio:s/o.aC(e,1,c.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Au=(h,e,r,s,c)=>o.e($s(h,e,r,s),{u_image:0,u_image_height:c}),ku=(h,e,r,s,c)=>{let p=h.transform,y=hc(e,p);return{u_translation:pc(h,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:s/o.aC(e,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[y,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Co=(h,e,r,s,c,p)=>{let y=h.lineAtlas,w=hc(e,h.transform),T=r.layout.get("line-cap")==="round",P=y.getDash(c.from,T),M=y.getDash(c.to,T),k=P.width*p.fromScale,A=M.width*p.toScale;return o.e($s(h,e,r,s),{u_patternscale_a:[w/k,-P.height/2],u_patternscale_b:[w/A,-M.height/2],u_sdfgamma:y.width/(256*Math.min(k,A)*h.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:M.y,u_mix:p.t})};function hc(h,e){return 1/o.aC(h,1,e.tileZoom)}function pc(h,e,r){return o.aD(h.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}let Ka=(h,e,r,s,c)=>{return{u_tl_parent:h,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*s.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:s.paint.get("raster-brightness-min"),u_brightness_high:s.paint.get("raster-brightness-max"),u_saturation_factor:(y=s.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(p=s.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:yp(s.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var p,y};function yp(h){h*=Math.PI/180;let e=Math.sin(h),r=Math.cos(h);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}let Ya=(h,e,r,s,c,p,y,w,T,P,M,k,A)=>{let D=y.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:D.cameraToCenterDistance,u_pitch:D.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:D.width/D.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+M,u_pitch_with_map:+s,u_is_along_line:c,u_is_variable_anchor:p,u_texsize:k,u_texture:0,u_translation:P,u_pitched_scale:A}},Lu=(h,e,r,s,c,p,y,w,T,P,M,k,A,D)=>{let F=y.transform;return o.e(Ya(h,e,r,s,c,p,y,w,T,P,M,k,D),{u_gamma_scale:s?Math.cos(F.pitch*Math.PI/180)*F.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},vp=(h,e,r,s,c,p,y,w,T,P,M,k,A)=>o.e(Lu(h,e,r,s,c,p,y,w,T,P,!0,M,0,A),{u_texsize_icon:k,u_texture_icon:1}),Du=(h,e)=>({u_opacity:h,u_color:e}),zu=(h,e,r,s,c)=>o.e((function(p,y,w,T){let P=w.imageManager.getPattern(p.from.toString()),M=w.imageManager.getPattern(p.to.toString()),{width:k,height:A}=w.imageManager.getPixelSize(),D=Math.pow(2,T.tileID.overscaledZ),F=T.tileSize*Math.pow(2,w.transform.tileZoom)/D,Z=F*(T.tileID.canonical.x+T.tileID.wrap*D),G=F*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[k,A],u_mix:y.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/o.aC(T,1,w.transform.tileZoom),u_pixel_coord_upper:[Z>>16,G>>16],u_pixel_coord_lower:[65535&Z,65535&G]}})(r,c,e,s),{u_opacity:h}),dc=(h,e)=>{},mc={fillExtrusion:(h,e)=>({u_lightpos:new o.bT(h,e.u_lightpos),u_lightpos_globe:new o.bT(h,e.u_lightpos_globe),u_lightintensity:new o.bg(h,e.u_lightintensity),u_lightcolor:new o.bT(h,e.u_lightcolor),u_vertical_gradient:new o.bg(h,e.u_vertical_gradient),u_opacity:new o.bg(h,e.u_opacity),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillExtrusionPattern:(h,e)=>({u_lightpos:new o.bT(h,e.u_lightpos),u_lightpos_globe:new o.bT(h,e.u_lightpos_globe),u_lightintensity:new o.bg(h,e.u_lightintensity),u_lightcolor:new o.bT(h,e.u_lightcolor),u_vertical_gradient:new o.bg(h,e.u_vertical_gradient),u_height_factor:new o.bg(h,e.u_height_factor),u_opacity:new o.bg(h,e.u_opacity),u_fill_translate:new o.bU(h,e.u_fill_translate),u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade)}),fill:(h,e)=>({u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillPattern:(h,e)=>({u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillOutline:(h,e)=>({u_world:new o.bU(h,e.u_world),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillOutlinePattern:(h,e)=>({u_world:new o.bU(h,e.u_world),u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade),u_fill_translate:new o.bU(h,e.u_fill_translate)}),circle:(h,e)=>({u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_scale_with_map:new o.bP(h,e.u_scale_with_map),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_extrude_scale:new o.bU(h,e.u_extrude_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.bg(h,e.u_globe_extrude_scale),u_translate:new o.bU(h,e.u_translate)}),collisionBox:(h,e)=>({u_pixel_extrude_scale:new o.bU(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_viewport_size:new o.bU(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new o.bQ(h,e.u_color),u_overlay:new o.bP(h,e.u_overlay),u_overlay_scale:new o.bg(h,e.u_overlay_scale)}),depth:dc,clippingMask:dc,heatmap:(h,e)=>({u_extrude_scale:new o.bg(h,e.u_extrude_scale),u_intensity:new o.bg(h,e.u_intensity),u_globe_extrude_scale:new o.bg(h,e.u_globe_extrude_scale)}),heatmapTexture:(h,e)=>({u_matrix:new o.bR(h,e.u_matrix),u_world:new o.bU(h,e.u_world),u_image:new o.bP(h,e.u_image),u_color_ramp:new o.bP(h,e.u_color_ramp),u_opacity:new o.bg(h,e.u_opacity)}),hillshade:(h,e)=>({u_image:new o.bP(h,e.u_image),u_latrange:new o.bU(h,e.u_latrange),u_exaggeration:new o.bg(h,e.u_exaggeration),u_altitudes:new o.b_(h,e.u_altitudes),u_azimuths:new o.b_(h,e.u_azimuths),u_accent:new o.bQ(h,e.u_accent),u_method:new o.bP(h,e.u_method),u_shadows:new o.bZ(h,e.u_shadows),u_highlights:new o.bZ(h,e.u_highlights)}),hillshadePrepare:(h,e)=>({u_matrix:new o.bR(h,e.u_matrix),u_image:new o.bP(h,e.u_image),u_dimension:new o.bU(h,e.u_dimension),u_zoom:new o.bg(h,e.u_zoom),u_unpack:new o.bS(h,e.u_unpack)}),colorRelief:(h,e)=>({u_image:new o.bP(h,e.u_image),u_unpack:new o.bS(h,e.u_unpack),u_dimension:new o.bU(h,e.u_dimension),u_elevation_stops:new o.bP(h,e.u_elevation_stops),u_color_stops:new o.bP(h,e.u_color_stops),u_color_ramp_size:new o.bP(h,e.u_color_ramp_size),u_opacity:new o.bg(h,e.u_opacity)}),line:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_image:new o.bP(h,e.u_image),u_image_height:new o.bg(h,e.u_image_height)}),linePattern:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_texsize:new o.bU(h,e.u_texsize),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_image:new o.bP(h,e.u_image),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade)}),lineSDF:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_patternscale_a:new o.bU(h,e.u_patternscale_a),u_patternscale_b:new o.bU(h,e.u_patternscale_b),u_sdfgamma:new o.bg(h,e.u_sdfgamma),u_image:new o.bP(h,e.u_image),u_tex_y_a:new o.bg(h,e.u_tex_y_a),u_tex_y_b:new o.bg(h,e.u_tex_y_b),u_mix:new o.bg(h,e.u_mix)}),raster:(h,e)=>({u_tl_parent:new o.bU(h,e.u_tl_parent),u_scale_parent:new o.bg(h,e.u_scale_parent),u_buffer_scale:new o.bg(h,e.u_buffer_scale),u_fade_t:new o.bg(h,e.u_fade_t),u_opacity:new o.bg(h,e.u_opacity),u_image0:new o.bP(h,e.u_image0),u_image1:new o.bP(h,e.u_image1),u_brightness_low:new o.bg(h,e.u_brightness_low),u_brightness_high:new o.bg(h,e.u_brightness_high),u_saturation_factor:new o.bg(h,e.u_saturation_factor),u_contrast_factor:new o.bg(h,e.u_contrast_factor),u_spin_weights:new o.bT(h,e.u_spin_weights),u_coords_top:new o.bS(h,e.u_coords_top),u_coords_bottom:new o.bS(h,e.u_coords_bottom)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texture:new o.bP(h,e.u_texture),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texture:new o.bP(h,e.u_texture),u_gamma_scale:new o.bg(h,e.u_gamma_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_is_halo:new o.bP(h,e.u_is_halo),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texsize_icon:new o.bU(h,e.u_texsize_icon),u_texture:new o.bP(h,e.u_texture),u_texture_icon:new o.bP(h,e.u_texture_icon),u_gamma_scale:new o.bg(h,e.u_gamma_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_is_halo:new o.bP(h,e.u_is_halo),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),background:(h,e)=>({u_opacity:new o.bg(h,e.u_opacity),u_color:new o.bQ(h,e.u_color)}),backgroundPattern:(h,e)=>({u_opacity:new o.bg(h,e.u_opacity),u_image:new o.bP(h,e.u_image),u_pattern_tl_a:new o.bU(h,e.u_pattern_tl_a),u_pattern_br_a:new o.bU(h,e.u_pattern_br_a),u_pattern_tl_b:new o.bU(h,e.u_pattern_tl_b),u_pattern_br_b:new o.bU(h,e.u_pattern_br_b),u_texsize:new o.bU(h,e.u_texsize),u_mix:new o.bg(h,e.u_mix),u_pattern_size_a:new o.bU(h,e.u_pattern_size_a),u_pattern_size_b:new o.bU(h,e.u_pattern_size_b),u_scale_a:new o.bg(h,e.u_scale_a),u_scale_b:new o.bg(h,e.u_scale_b),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bg(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_texture:new o.bP(h,e.u_texture),u_ele_delta:new o.bg(h,e.u_ele_delta),u_fog_matrix:new o.bR(h,e.u_fog_matrix),u_fog_color:new o.bQ(h,e.u_fog_color),u_fog_ground_blend:new o.bg(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bg(h,e.u_fog_ground_blend_opacity),u_horizon_color:new o.bQ(h,e.u_horizon_color),u_horizon_fog_blend:new o.bg(h,e.u_horizon_fog_blend),u_is_globe_mode:new o.bg(h,e.u_is_globe_mode)}),terrainDepth:(h,e)=>({u_ele_delta:new o.bg(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_texture:new o.bP(h,e.u_texture),u_terrain_coords_id:new o.bg(h,e.u_terrain_coords_id),u_ele_delta:new o.bg(h,e.u_ele_delta)}),projectionErrorMeasurement:(h,e)=>({u_input:new o.bg(h,e.u_input),u_output_expected:new o.bg(h,e.u_output_expected)}),atmosphere:(h,e)=>({u_sun_pos:new o.bT(h,e.u_sun_pos),u_atmosphere_blend:new o.bg(h,e.u_atmosphere_blend),u_globe_position:new o.bT(h,e.u_globe_position),u_globe_radius:new o.bg(h,e.u_globe_radius),u_inv_proj_matrix:new o.bR(h,e.u_inv_proj_matrix)}),sky:(h,e)=>({u_sky_color:new o.bQ(h,e.u_sky_color),u_horizon_color:new o.bQ(h,e.u_horizon_color),u_horizon:new o.bU(h,e.u_horizon),u_horizon_normal:new o.bU(h,e.u_horizon_normal),u_sky_horizon_blend:new o.bg(h,e.u_sky_horizon_blend),u_sky_blend:new o.bg(h,e.u_sky_blend)})};class Ru{constructor(e,r,s){this.context=e;let c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Gs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ar{constructor(e,r,s,c){this.length=r.length,this.attributes=s,this.itemSize=r.bytesPerElement,this.dynamicDraw=c,this.context=e;let p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let s=0;s<this.attributes.length;s++){let c=r.attributes[this.attributes[s].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,r,s){for(let c=0;c<this.attributes.length;c++){let p=this.attributes[c],y=r.attributes[p.name];y!==void 0&&e.vertexAttribPointer(y,p.components,e[Gs[p.type]],!1,this.itemSize,p.offset+this.itemSize*(s||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fc extends zt{getDefault(){return o.bf.transparent}set(e){let r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class gc extends zt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Fu extends zt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class _c extends zt{getDefault(){return[!0,!0,!0,!0]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Mo extends zt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class yc extends zt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class xp extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class bp extends zt{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class wp extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class Tp extends zt{getDefault(){return[0,1]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Bu extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class Sp extends zt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ou extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Zs extends zt{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class qs extends zt{getDefault(){return o.bf.transparent}set(e){let r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ws extends zt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class vc extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Eo extends zt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ja extends zt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class la extends zt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class zn extends zt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ju extends zt{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Uu extends zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class xc extends zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ao extends zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Hs extends zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Xs extends zt{getDefault(){return null}set(e){let r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Qa extends zt{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;let s=this.gl;mr(s)?s.bindVertexArray(e):(r=s.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Ks extends zt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Nu extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ca extends zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class to extends zt{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class Vu extends to{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class bc extends to{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Pt extends to{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let es="Framebuffer is not complete";class Ip{constructor(e,r,s,c,p){this.context=e,this.width=r,this.height=s;let y=e.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Vu(e,w),c)this.depthAttachment=p?new Pt(e,w):new bc(e,w);else if(p)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(es)}destroy(){let e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){let s=this.depthAttachment.get();s&&e.deleteRenderbuffer(s)}e.deleteFramebuffer(this.framebuffer)}}class $u{constructor(e){var r,s;if(this.gl=e,this.clearColor=new fc(this),this.clearDepth=new gc(this),this.clearStencil=new Fu(this),this.colorMask=new _c(this),this.depthMask=new Mo(this),this.stencilMask=new yc(this),this.stencilFunc=new xp(this),this.stencilOp=new bp(this),this.stencilTest=new wp(this),this.depthRange=new Tp(this),this.depthTest=new Bu(this),this.depthFunc=new Sp(this),this.blend=new Ou(this),this.blendFunc=new Zs(this),this.blendColor=new qs(this),this.blendEquation=new Ws(this),this.cullFace=new vc(this),this.cullFaceSide=new Eo(this),this.frontFace=new Ja(this),this.program=new la(this),this.activeTexture=new zn(this),this.viewport=new ju(this),this.bindFramebuffer=new Uu(this),this.bindRenderbuffer=new xc(this),this.bindTexture=new Ao(this),this.bindVertexBuffer=new Hs(this),this.bindElementBuffer=new Xs(this),this.bindVertexArray=new Qa(this),this.pixelStoreUnpack=new Ks(this),this.pixelStoreUnpackPremultiplyAlpha=new Nu(this),this.pixelStoreUnpackFlipY=new ca(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),mr(e)){this.HALF_FLOAT=e.HALF_FLOAT;let c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:c?.RGBA16F_EXT,this.RGB16F=(s=e.RGB16F)!==null&&s!==void 0?s:c?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Ru(this,e,r)}createVertexBuffer(e,r,s){return new Ar(this,e,r,s)}createRenderbuffer(e,r,s){let c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,e,r,s),this.bindRenderbuffer.set(null),p}createFramebuffer(e,r,s,c){return new Ip(this,e,r,s,c)}clear({color:e,depth:r,stencil:s}){let c=this.gl,p=0;e&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),s!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(s),this.stencilMask.set(255)),c.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bH(e.blendFunction,ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return mr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return mr(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let io;function Gu(h,e,r,s,c){let p=h.context,y=h.transform,w=p.gl,T=h.useProgram("collisionBox"),P=[],M=0,k=0;for(let W=0;W<s.length;W++){let X=s[W],ee=e.getTile(X).getBucket(r);if(!ee)continue;let K=c?ee.textCollisionBox:ee.iconCollisionBox,ie=ee.collisionCircleArray;ie.length>0&&(P.push({circleArray:ie,circleOffset:k,coord:X}),M+=ie.length/4,k=M),K&&T.draw(p,w.LINES,ht.disabled,Lt.disabled,h.colorModeForRenderPass(),rt.disabled,Vs(h.transform),h.style.map.terrain&&h.style.map.terrain.getTerrainData(X),y.getProjectionData({overscaledTileID:X,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,null,h.transform.zoom,null,null,K.collisionVertexBuffer)}if(!c||!P.length)return;let A=h.useProgram("collisionCircle"),D=new o.b$;D.resize(4*M),D._trim();let F=0;for(let W of P)for(let X=0;X<W.circleArray.length/4;X++){let ee=4*X,K=W.circleArray[ee+0],ie=W.circleArray[ee+1],oe=W.circleArray[ee+2],J=W.circleArray[ee+3];D.emplace(F++,K,ie,oe,J,0),D.emplace(F++,K,ie,oe,J,1),D.emplace(F++,K,ie,oe,J,2),D.emplace(F++,K,ie,oe,J,3)}(!io||io.length<2*M)&&(io=(function(W){let X=2*W,ee=new o.c1;ee.resize(X),ee._trim();for(let K=0;K<X;K++){let ie=6*K;ee.uint16[ie+0]=4*K+0,ee.uint16[ie+1]=4*K+1,ee.uint16[ie+2]=4*K+2,ee.uint16[ie+3]=4*K+2,ee.uint16[ie+4]=4*K+3,ee.uint16[ie+5]=4*K+0}return ee})(M));let Z=p.createIndexBuffer(io,!0),G=p.createVertexBuffer(D,o.c0.members,!0);for(let W of P){let X=gp(h.transform);A.draw(p,w.TRIANGLES,ht.disabled,Lt.disabled,h.colorModeForRenderPass(),rt.disabled,X,h.style.map.terrain&&h.style.map.terrain.getTerrainData(W.coord),null,r.id,G,Z,o.aM.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,h.transform.zoom,null,null,null)}G.destroy(),Z.destroy()}let Pp=o.ag(new Float32Array(16));function Zu(h,e,r,s,c,p){let{horizontalAlign:y,verticalAlign:w}=o.aH(h);return new o.P((-(y-.5)*e/c+s[0])*p,(-(w-.5)*r/c+s[1])*p)}function Cp(h,e,r,s,c,p){let y=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=s.mult(p);r||(w=w.rotate(-c));let T=y.add(w);return vi(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){let w=Gi(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return h.add(s.rotate(T))}return h.add(s)}function wc(h,e,r,s,c,p,y,w,T,P,M,k){let A=h.text.placedSymbolArray,D=h.text.dynamicLayoutVertexArray,F=h.icon.dynamicLayoutVertexArray,Z={};D.clear();for(let G=0;G<A.length;G++){let W=A.get(G),X=W.hidden||!W.crossTileID||h.allowVerticalPlacement&&!W.placedOrientation?null:s[W.crossTileID];if(X){let ee=new o.P(W.anchorX,W.anchorY),K={getElevation:k,width:c.width,height:c.height,pitchedLabelPlaneMatrix:p,pitchWithMap:r,transform:c,tileAnchorPoint:ee,translation:P,unwrappedTileID:M},ie=r?Kr(ee.x,ee.y,K):Gi(ee.x,ee.y,K),oe=Re(c.cameraToCenterDistance,ie.signedDistanceFromCamera),J=o.ap(h.textSizeData,w,W)*oe/o.aB;r&&(J*=h.tilePixelRatio/y);let{width:ue,height:xe,anchor:de,textOffset:me,textBoxScale:ye}=X,ze=Zu(de,ue,xe,me,ye,J),Be=c.getPitchedTextCorrection(ee.x+P[0],ee.y+P[1],M),Me=Cp(ie.point,K,e,ze,-c.bearingInRadians,Be),We=h.allowVerticalPlacement&&W.placedOrientation===o.ao.vertical?Math.PI/2:0;for(let gt=0;gt<W.numGlyphs;gt++)o.av(D,Me,We);T&&W.associatedIconIndex>=0&&(Z[W.associatedIconIndex]={shiftedAnchor:Me,angle:We})}else dr(W.numGlyphs,D)}if(T){F.clear();let G=h.icon.placedSymbolArray;for(let W=0;W<G.length;W++){let X=G.get(W);if(X.hidden)dr(X.numGlyphs,F);else{let ee=Z[W];if(ee)for(let K=0;K<X.numGlyphs;K++)o.av(F,ee.shiftedAnchor,ee.angle);else dr(X.numGlyphs,F)}}h.icon.dynamicLayoutVertexBuffer.updateData(F)}h.text.dynamicLayoutVertexBuffer.updateData(D)}function Ys(h,e,r){return r.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function ts(h,e,r,s,c,p,y,w,T,P,M,k,A){let D=h.context,F=D.gl,Z=h.transform,G=w==="map",W=T==="map",X=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",ee=G&&!W&&!X,K=!r.layout.get("symbol-sort-key").isConstant(),ie=!1,oe=h.getDepthModeForSublayer(0,ht.ReadOnly),J=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ue=[],xe=Z.getCircleRadiusCorrection();for(let de of s){let me=e.getTile(de),ye=me.getBucket(r);if(!ye)continue;let ze=c?ye.text:ye.icon;if(!ze||!ze.segments.get().length||!ze.hasVisibleVertices)continue;let Be=ze.programConfigurations.get(r.id),Me=c||ye.sdfIcons,We=c?ye.textSizeData:ye.iconSizeData,gt=W||Z.pitch!==0,Bt=h.useProgram(Ys(Me,c,ye),Be),Vt=o.an(We,Z.zoom),jt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(de),ni,ci,dt,$t,bi=[0,0],Mi=null;if(c)ci=me.glyphAtlasTexture,dt=F.LINEAR,ni=me.glyphAtlasTexture.size,ye.iconsInText&&(bi=me.imageAtlasTexture.size,Mi=me.imageAtlasTexture,$t=gt||h.options.rotating||h.options.zooming||We.kind==="composite"||We.kind==="camera"?F.LINEAR:F.NEAREST);else{let wi=r.layout.get("icon-size").constantOr(0)!==1||ye.iconsNeedLinear;ci=me.imageAtlasTexture,dt=Me||h.options.rotating||h.options.zooming||wi||gt?F.LINEAR:F.NEAREST,ni=me.imageAtlasTexture.size}let Fi=o.aC(me,1,h.transform.zoom),sn=gi(G,h.transform,Fi),Qn=o.L();o.aq(Qn,sn);let ro=It(W,G,h.transform,Fi),oo=o.aD(Z,me,p,y),ba=Z.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),wa=J&&ye.hasTextData(),Bo=r.layout.get("icon-text-fit")!=="none"&&wa&&ye.hasIconData();if(X){let wi=h.style.map.terrain?(Bn,Ti)=>h.style.map.terrain.getElevation(de,Bn,Ti):null,Ei=r.layout.get("text-rotation-alignment")==="map";si(ye,h,c,sn,Qn,W,P,Ei,de.toUnwrapped(),Z.width,Z.height,oo,wi)}let Oo=c&&J||Bo,vn=X||Oo?Pp:W?sn:h.transform.clipSpaceToPixelsMatrix,er=Me&&r.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ln;ln=Me?ye.iconsInText?vp(We.kind,Vt,ee,W,X,Oo,h,vn,ro,oo,ni,bi,xe):Lu(We.kind,Vt,ee,W,X,Oo,h,vn,ro,oo,c,ni,0,xe):Ya(We.kind,Vt,ee,W,X,Oo,h,vn,ro,oo,c,ni,xe);let ao={program:Bt,buffers:ze,uniformValues:ln,projectionData:ba,atlasTexture:ci,atlasTextureIcon:Mi,atlasInterpolation:dt,atlasInterpolationIcon:$t,isSDF:Me,hasHalo:er};if(K&&ye.canOverlap){ie=!0;let wi=ze.segments.get();for(let Ei of wi)ue.push({segments:new o.aM([Ei]),sortKey:Ei.sortKey,state:ao,terrainData:jt})}else ue.push({segments:ze.segments,sortKey:0,state:ao,terrainData:jt})}ie&&ue.sort((de,me)=>de.sortKey-me.sortKey);for(let de of ue){let me=de.state;if(D.activeTexture.set(F.TEXTURE0),me.atlasTexture.bind(me.atlasInterpolation,F.CLAMP_TO_EDGE),me.atlasTextureIcon&&(D.activeTexture.set(F.TEXTURE1),me.atlasTextureIcon&&me.atlasTextureIcon.bind(me.atlasInterpolationIcon,F.CLAMP_TO_EDGE)),me.isSDF){let ye=me.uniformValues;me.hasHalo&&(ye.u_is_halo=1,is(me.buffers,de.segments,r,h,me.program,oe,M,k,ye,me.projectionData,de.terrainData)),ye.u_is_halo=0}is(me.buffers,de.segments,r,h,me.program,oe,M,k,me.uniformValues,me.projectionData,de.terrainData)}}function is(h,e,r,s,c,p,y,w,T,P,M){let k=s.context;c.draw(k,k.gl.TRIANGLES,p,y,w,rt.backCCW,T,M,P,r.id,h.layoutVertexBuffer,h.indexBuffer,e,r.paint,s.transform.zoom,h.programConfigurations.get(r.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Tc(h,e,r,s,c){let p=h.context,y=p.gl,w=Lt.disabled,T=new ei([y.ONE,y.ONE],o.bf.transparent,[!0,!0,!0,!0]),P=e.getBucket(r);if(!P)return;let M=s.key,k=r.heatmapFbos.get(M);k||(k=ns(p,e.tileSize,e.tileSize),r.heatmapFbos.set(M,k)),p.bindFramebuffer.set(k.framebuffer),p.viewport.set([0,0,e.tileSize,e.tileSize]),p.clear({color:o.bf.transparent});let A=P.programConfigurations.get(r.id),D=h.useProgram("heatmap",A,!c),F=h.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Z=h.style.map.terrain.getTerrainData(s);D.draw(p,y.TRIANGLES,ht.disabled,w,T,rt.disabled,Cu(e,h.transform.zoom,r.paint.get("heatmap-intensity"),1),Z,F,r.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,r.paint,h.transform.zoom,A)}function qu(h,e,r,s,c){let p=h.context,y=p.gl,w=h.transform;p.setColorMode(h.colorModeForRenderPass());let T=rs(p,e),P=r.key,M=e.heatmapFbos.get(P);if(!M)return;p.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,M.colorAttachment.get()),p.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);let k=w.getProjectionData({overscaledTileID:r,applyTerrainMatrix:c,applyGlobeMatrix:!s});h.useProgram("heatmapTexture").draw(p,y.TRIANGLES,ht.disabled,Lt.disabled,h.colorModeForRenderPass(),rt.disabled,cc(h,e,0,1),null,k,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,w.zoom),M.destroy(),e.heatmapFbos.delete(P)}function ns(h,e,r){var s,c;let p=h.gl,y=p.createTexture();p.bindTexture(p.TEXTURE_2D,y),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);let w=(s=h.HALF_FLOAT)!==null&&s!==void 0?s:p.UNSIGNED_BYTE,T=(c=h.RGBA16F)!==null&&c!==void 0?c:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,T,e,r,0,p.RGBA,w,null);let P=h.createFramebuffer(e,r,!1,!1);return P.colorAttachment.set(y),P}function rs(h,e){return e.colorRampTexture||(e.colorRampTexture=new o.T(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function os(h,e,r,s,c){if(!r||!s||!s.imageAtlas)return;let p=s.imageAtlas.patternPositions,y=p[r.to.toString()],w=p[r.from.toString()];if(!y&&w&&(y=w),!w&&y&&(w=y),!y||!w){let T=c.getPaintProperty(e);y=p[T],w=p[T]}y&&w&&h.setConstantPatternPositions(y,w)}function Js(h,e,r,s,c,p,y,w){let T=h.context.gl,P="fill-pattern",M=r.paint.get(P),k=M&&M.constantOr(1),A=r.getCrossfadeParameters(),D,F,Z,G,W,X=h.transform,ee=r.paint.get("fill-translate"),K=r.paint.get("fill-translate-anchor");y?(F=k&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=T.LINES):(F=k?"fillPattern":"fill",D=T.TRIANGLES);let ie=M.constantOr(null);for(let oe of s){let J=e.getTile(oe);if(k&&!J.patternsLoaded())continue;let ue=J.getBucket(r);if(!ue)continue;let xe=ue.programConfigurations.get(r.id),de=h.useProgram(F,xe),me=h.style.map.terrain&&h.style.map.terrain.getTerrainData(oe);k&&(h.context.activeTexture.set(T.TEXTURE0),J.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),xe.updatePaintBuffers(A)),os(xe,P,ie,J,r);let ye=X.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),ze=o.aD(X,J,ee,K);if(y){G=ue.indexBuffer2,W=ue.segments2;let Me=[T.drawingBufferWidth,T.drawingBufferHeight];Z=F==="fillOutlinePattern"&&k?Xa(h,A,J,Me,ze):Ha(Me,ze)}else G=ue.indexBuffer,W=ue.segments,Z=k?Ns(h,A,J,ze):{u_fill_translate:ze};let Be=h.stencilModeForClipping(oe);de.draw(h.context,D,c,Be,p,rt.backCCW,Z,me,ye,r.id,ue.layoutVertexBuffer,G,W,r.paint,h.transform.zoom,xe)}}function Sc(h,e,r,s,c,p,y,w){let T=h.context,P=T.gl,M="fill-extrusion-pattern",k=r.paint.get(M),A=k.constantOr(1),D=r.getCrossfadeParameters(),F=r.paint.get("fill-extrusion-opacity"),Z=k.constantOr(null),G=h.transform;for(let W of s){let X=e.getTile(W),ee=X.getBucket(r);if(!ee)continue;let K=h.style.map.terrain&&h.style.map.terrain.getTerrainData(W),ie=ee.programConfigurations.get(r.id),oe=h.useProgram(A?"fillExtrusionPattern":"fillExtrusion",ie);A&&(h.context.activeTexture.set(P.TEXTURE0),X.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ie.updatePaintBuffers(D));let J=G.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!w,applyTerrainMatrix:!0});os(ie,M,Z,X,r);let ue=o.aD(G,X,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),xe=r.paint.get("fill-extrusion-vertical-gradient"),de=A?mp(h,xe,F,ue,W,D,X):Wn(h,xe,F,ue);oe.draw(T,T.gl.TRIANGLES,c,p,y,rt.backCCW,de,K,J,r.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,r.paint,h.transform.zoom,ie,h.style.map.terrain&&ee.centroidVertexBuffer)}}function ko(h,e,r,s,c,p,y,w,T){var P;let M=h.style.projection,k=h.context,A=h.transform,D=k.gl,F=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],Z=h.useProgram("hillshade",null,!1,F),G=!h.options.moving;for(let W of s){let X=e.getTile(W),ee=X.fbo;if(!ee)continue;let K=M.getMeshFromTileID(k,W.canonical,w,!0,"raster"),ie=(P=h.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(W);k.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,ee.colorAttachment.get());let oe=A.getProjectionData({overscaledTileID:W,aligned:G,applyGlobeMatrix:!T,applyTerrainMatrix:!0});Z.draw(k,D.TRIANGLES,p,c[W.overscaledZ],y,rt.backCCW,_p(h,X,r),ie,oe,r.id,K.vertexBuffer,K.indexBuffer,K.segments)}}function Ic(h,e,r,s,c,p,y,w,T){var P;let M=h.style.projection,k=h.context,A=h.transform,D=k.gl,F=h.useProgram("colorRelief"),Z=!h.options.moving,G=!0,W=0;for(let X of s){let ee=e.getTile(X),K=ee.dem;if(G){let de=D.getParameter(D.MAX_TEXTURE_SIZE),{elevationTexture:me,colorTexture:ye}=r.getColorRampTextures(k,de,K.getUnpackVector());k.activeTexture.set(D.TEXTURE1),me.bind(D.NEAREST,D.CLAMP_TO_EDGE),k.activeTexture.set(D.TEXTURE4),ye.bind(D.LINEAR,D.CLAMP_TO_EDGE),G=!1,W=me.size[0]}if(!K||!K.data)continue;let ie=K.stride,oe=K.getPixels();if(k.activeTexture.set(D.TEXTURE0),k.pixelStoreUnpackPremultiplyAlpha.set(!1),ee.demTexture=ee.demTexture||h.getTileTexture(ie),ee.demTexture){let de=ee.demTexture;de.update(oe,{premultiply:!1}),de.bind(D.LINEAR,D.CLAMP_TO_EDGE)}else ee.demTexture=new o.T(k,oe,D.RGBA,{premultiply:!1}),ee.demTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);let J=M.getMeshFromTileID(k,X.canonical,w,!0,"raster"),ue=(P=h.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(X),xe=A.getProjectionData({overscaledTileID:X,aligned:Z,applyGlobeMatrix:!T,applyTerrainMatrix:!0});F.draw(k,D.TRIANGLES,p,c[X.overscaledZ],y,rt.backCCW,Eu(r,ee.dem,W),ue,xe,r.id,J.vertexBuffer,J.indexBuffer,J.segments)}}let Qs=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function Lo(h,e,r,s,c,p,y,w,T=!1,P=!1){let M=s[s.length-1].overscaledZ,k=h.context,A=k.gl,D=h.useProgram("raster"),F=h.transform,Z=h.style.projection,G=h.colorModeForRenderPass(),W=!h.options.moving;for(let X of s){let ee=h.getDepthModeForSublayer(X.overscaledZ-M,r.paint.get("raster-opacity")===1?ht.ReadWrite:ht.ReadOnly,A.LESS),K=e.getTile(X);K.registerFadeDuration(r.paint.get("raster-fade-duration"));let ie=e.findLoadedParent(X,0),oe=e.findLoadedSibling(X),J=Pc(K,ie||oe||null,e,r,h.transform,h.style.map.terrain),ue,xe,de=r.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;k.activeTexture.set(A.TEXTURE0),K.texture.bind(de,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(A.TEXTURE1),ie?(ie.texture.bind(de,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ue=Math.pow(2,ie.tileID.overscaledZ-K.tileID.overscaledZ),xe=[K.tileID.canonical.x*ue%1,K.tileID.canonical.y*ue%1]):K.texture.bind(de,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),K.texture.useMipmap&&k.extTextureFilterAnisotropic&&h.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);let me=h.style.map.terrain&&h.style.map.terrain.getTerrainData(X),ye=F.getProjectionData({overscaledTileID:X,aligned:W,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),ze=Ka(xe||[0,0],ue||1,J,r,w),Be=Z.getMeshFromTileID(k,X.canonical,p,y,"raster");D.draw(k,A.TRIANGLES,ee,c?c[X.overscaledZ]:Lt.disabled,G,T?rt.frontCCW:rt.backCCW,ze,me,ye,r.id,Be.vertexBuffer,Be.indexBuffer,Be.segments)}}function Pc(h,e,r,s,c,p){let y=s.paint.get("raster-fade-duration");if(!p&&y>0){let w=ne.now(),T=(w-h.timeAdded)/y,P=e?(w-e.timeAdded)/y:-1,M=r.getSource(),k=Xe(c,{tileSize:M.tileSize,roundZoom:M.roundZoom}),A=!e||Math.abs(e.tileID.overscaledZ-k)>Math.abs(h.tileID.overscaledZ-k),D=A&&h.refreshedUponExpiration?1:o.ah(A?T:1-P,0,1);return h.refreshedUponExpiration&&T>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-D}:{opacity:D,mix:0}}return{opacity:1,mix:0}}let Wu=new o.bf(1,0,0,1),Hu=new o.bf(0,1,0,1),el=new o.bf(0,0,1,1),Cc=new o.bf(1,0,1,1),Mp=new o.bf(0,1,1,1);function Mc(h,e,r,s){_r(h,0,e+r/2,h.transform.width,r,s)}function li(h,e,r,s){_r(h,e-r/2,0,r,h.transform.height,s)}function _r(h,e,r,s,c,p){let y=h.context,w=y.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*h.pixelRatio,r*h.pixelRatio,s*h.pixelRatio,c*h.pixelRatio),y.clear({color:p}),w.disable(w.SCISSOR_TEST)}function Rn(h,e,r){let s=h.context,c=s.gl,p=h.useProgram("debug"),y=ht.disabled,w=Lt.disabled,T=h.colorModeForRenderPass(),P="$debug",M=h.style.map.terrain&&h.style.map.terrain.getTerrainData(r);s.activeTexture.set(c.TEXTURE0);let k=e.getTileByID(r.key).latestRawTileData,A=Math.floor((k&&k.byteLength||0)/1024),D=e.getTile(r).tileSize,F=512/Math.min(D,512)*(r.overscaledZ/h.transform.zoom)*.5,Z=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(Z+=` => ${r.overscaledZ}`),(function(W,X){W.initDebugOverlayCanvas();let ee=W.debugOverlayCanvas,K=W.context.gl,ie=W.debugOverlayCanvas.getContext("2d");ie.clearRect(0,0,ee.width,ee.height),ie.shadowColor="white",ie.shadowBlur=2,ie.lineWidth=1.5,ie.strokeStyle="white",ie.textBaseline="top",ie.font="bold 36px Open Sans, sans-serif",ie.fillText(X,5,5),ie.strokeText(X,5,5),W.debugOverlayTexture.update(ee),W.debugOverlayTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE)})(h,`${Z} ${A}kB`);let G=h.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(s,c.TRIANGLES,y,w,ei.alphaBlended,rt.disabled,Po(o.bf.transparent,F),null,G,P,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),p.draw(s,c.LINE_STRIP,y,w,T,rt.disabled,Po(o.bf.red),M,G,P,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function tl(h,e,r,s){let{isRenderingGlobe:c}=s,p=h.context,y=p.gl,w=h.transform,T=h.colorModeForRenderPass(),P=h.getDepthModeFor3D(),M=h.useProgram("terrain");p.bindFramebuffer.set(null),p.viewport.set([0,0,h.width,h.height]);for(let k of r){let A=e.getTerrainMesh(k.tileID),D=h.renderToTexture.getTexture(k),F=e.getTerrainData(k.tileID);p.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,D.texture);let Z=e.getMeshFrameDelta(w.zoom),G=w.calculateFogMatrix(k.tileID.toUnwrapped()),W=js(Z,G,h.style.sky,w.pitch,c),X=w.getProjectionData({overscaledTileID:k.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});M.draw(p,y.TRIANGLES,P,Lt.disabled,T,rt.backCCW,W,F,X,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}function as(h,e){if(!e.mesh){let r=new o.aL;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);let s=new o.aN;s.emplaceBack(0,1,2),s.emplaceBack(0,2,3),e.mesh=new xo(h.createVertexBuffer(r,eo.members),h.createIndexBuffer(s),o.aM.simpleSegment(0,0,r.length,s.length))}return e.mesh}class Xu{constructor(e,r){this.context=new $u(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=xt.maxUnderzooming+xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ra}resize(e,r,s){if(this.width=Math.floor(e*s),this.height=Math.floor(r*s),this.pixelRatio=s,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let c of this.style._order)this.style._layers[c].resize()}setup(){let e=this.context,r=new o.aL;r.emplaceBack(0,0),r.emplaceBack(o.$,0),r.emplaceBack(0,o.$),r.emplaceBack(o.$,o.$),this.tileExtentBuffer=e.createVertexBuffer(r,eo.members),this.tileExtentSegments=o.aM.simpleSegment(0,0,4,2);let s=new o.aL;s.emplaceBack(0,0),s.emplaceBack(o.$,0),s.emplaceBack(0,o.$),s.emplaceBack(o.$,o.$),this.debugBuffer=e.createVertexBuffer(s,eo.members),this.debugSegments=o.aM.simpleSegment(0,0,4,5);let c=new o.c6;c.emplaceBack(0,0,0,0),c.emplaceBack(o.$,0,o.$,0),c.emplaceBack(0,o.$,0,o.$),c.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=e.createVertexBuffer(c,pp.members),this.rasterBoundsSegments=o.aM.simpleSegment(0,0,4,2);let p=new o.aL;p.emplaceBack(0,0),p.emplaceBack(o.$,0),p.emplaceBack(0,o.$),p.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(p,eo.members),this.rasterBoundsSegmentsPosOnly=o.aM.simpleSegment(0,0,4,5);let y=new o.aL;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,eo.members),this.viewportSegments=o.aM.simpleSegment(0,0,4,2);let w=new o.c7;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);let T=new o.aN;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);let P=this.context.gl;this.stencilClearMode=new Lt({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.tileExtentMesh=new xo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let s=o.L();o.bY(s,0,this.width,this.height,0,0,1),o.N(s,s,[r.drawingBufferWidth,r.drawingBufferHeight,0]);let c={mainMatrix:s,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:s};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,ht.disabled,this.stencilClearMode,ei.disabled,rt.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();let c=this.context;c.setColorMode(ei.disabled),c.setDepthMode(ht.disabled);let p={};for(let y of r)p[y.key]=this.nextStencilID++;this._renderTileMasks(p,r,s,!0),this._renderTileMasks(p,r,s,!1),this._tileClippingMaskIDs=p}_renderTileMasks(e,r,s,c){let p=this.context,y=p.gl,w=this.style.projection,T=this.transform,P=this.useProgram("clippingMask");for(let M of r){let k=e[M.key],A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M),D=w.getMeshFromTileID(this.context,M.canonical,c,!0,"stencil"),F=T.getProjectionData({overscaledTileID:M,applyGlobeMatrix:!s,applyTerrainMatrix:!0});P.draw(p,y.TRIANGLES,ht.disabled,new Lt({func:y.ALWAYS,mask:0},k,255,y.KEEP,y.KEEP,y.REPLACE),ei.disabled,s?rt.disabled:rt.backCCW,null,A,F,"$clipping",D.vertexBuffer,D.indexBuffer,D.segments)}}_renderTilesDepthBuffer(){let e=this.context,r=e.gl,s=this.style.projection,c=this.transform,p=this.useProgram("depth"),y=this.getDepthModeFor3D(),w=pe(c,{tileSize:c.tileSize});for(let T of w){let P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),M=s.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),k=c.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(e,r.TRIANGLES,y,Lt.disabled,ei.disabled,rt.backCCW,null,P,k,"$clipping",M.vertexBuffer,M.indexBuffer,M.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,r=this.context.gl;return new Lt({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){let r=this.context.gl;return new Lt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let r=this.context.gl,s=e.sort((y,w)=>w.overscaledZ-y.overscaledZ),c=s[s.length-1].overscaledZ,p=s[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();let y={};for(let w=0;w<p;w++)y[w+c]=new Lt({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=p,[y,s]}return[{[c]:Lt.disabled},s]}stencilConfigForOverlapTwoPass(e){let r=this.context.gl,s=e.sort((y,w)=>w.overscaledZ-y.overscaledZ),c=s[s.length-1].overscaledZ,p=s[0].overscaledZ-c+1;if(this.clearStencil(),p>1){let y={},w={};for(let T=0;T<p;T++)y[T+c]=new Lt({func:r.GREATER,mask:255},p+1+T,255,r.KEEP,r.KEEP,r.REPLACE),w[T+c]=new Lt({func:r.GREATER,mask:255},1+T,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*p+1,[y,w,s]}return this.nextStencilID=3,[{[c]:new Lt({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[c]:new Lt({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},s]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new ei([e.CONSTANT_COLOR,e.ONE],new o.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ei.unblended:ei.alphaBlended}getDepthModeForSublayer(e,r,s){if(!this.opaquePassEnabledForLayer())return ht.disabled;let c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ht(s||this.context.gl.LEQUAL,r,[c,c])}getDepthModeFor3D(){return new ht(this.context.gl.LEQUAL,ht.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var s,c;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ne.now()),this.imageManager.beginFrame();let p=this.style._order,y=this.style.sourceCaches,w={},T={},P={},M={isRenderingToTexture:!1,isRenderingGlobe:((s=e.projection)===null||s===void 0?void 0:s.transitionState)>0};for(let A in y){let D=y[A];D.used&&D.prepare(this.context),w[A]=D.getVisibleCoordinates(!1),T[A]=w[A].slice().reverse(),P[A]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let A of p){let D=this.style._layers[A];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;let F=T[D.source];(D.type==="custom"||F.length)&&this.renderLayer(this,y[D.source],D,F,M)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:A=>this.useProgram(A)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?o.bf.black:o.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(A,D){let F=A.context,Z=F.gl,G=((oe,J,ue)=>{let xe=Math.cos(J.rollInRadians),de=Math.sin(J.rollInRadians),me=ae(J),ye=J.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:oe.properties.get("sky-color"),u_horizon_color:oe.properties.get("horizon-color"),u_horizon:[(J.width/2-me*de)*ue,(J.height/2+me*xe)*ue],u_horizon_normal:[-de,xe],u_sky_horizon_blend:oe.properties.get("sky-horizon-blend")*J.height/2*ue,u_sky_blend:ye}})(D,A.style.map.transform,A.pixelRatio),W=new ht(Z.LEQUAL,ht.ReadWrite,[0,1]),X=Lt.disabled,ee=A.colorModeForRenderPass(),K=A.useProgram("sky"),ie=as(F,D);K.draw(F,Z.TRIANGLES,W,X,ee,rt.disabled,G,null,void 0,"sky",ie.vertexBuffer,ie.indexBuffer,ie.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){let A=this.style._layers[p[this.currentLayer]],D=y[A.source],F=w[A.source];this._renderTileClippingMasks(A,F,!1),this.renderLayer(this,D,A,F,M)}this.renderPass="translucent";let k=!1;for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){let A=this.style._layers[p[this.currentLayer]],D=y[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A,M))continue;this.opaquePassEnabledForLayer()||k||(k=!0,M.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let F=(A.type==="symbol"?P:T)[A.source];this._renderTileClippingMasks(A,w[A.source],!!this.renderToTexture),this.renderLayer(this,D,A,F,M)}if(M.isRenderingGlobe&&(function(A,D,F){let Z=A.context,G=Z.gl,W=A.useProgram("atmosphere"),X=new ht(G.LEQUAL,ht.ReadOnly,[0,1]),ee=A.transform,K=(function(ye,ze){let Be=ye.properties.get("position"),Me=[-Be.x,-Be.y,-Be.z],We=o.ag(new Float64Array(16));return ye.properties.get("anchor")==="map"&&(o.b6(We,We,ze.rollInRadians),o.b7(We,We,-ze.pitchInRadians),o.b6(We,We,ze.bearingInRadians),o.b7(We,We,ze.center.lat*Math.PI/180),o.bz(We,We,-ze.center.lng*Math.PI/180)),o.c5(Me,Me,We),Me})(F,A.transform),ie=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),oe=D.properties.get("atmosphere-blend")*ie.projectionTransition;if(oe===0)return;let J=aa(ee.worldSize,ee.center.lat),ue=ee.inverseProjectionMatrix,xe=new Float64Array(4);xe[3]=1,o.aw(xe,xe,ee.modelViewProjectionMatrix),xe[0]/=xe[3],xe[1]/=xe[3],xe[2]/=xe[3],xe[3]=1,o.aw(xe,xe,ue),xe[0]/=xe[3],xe[1]/=xe[3],xe[2]/=xe[3],xe[3]=1;let de=((ye,ze,Be,Me,We)=>({u_sun_pos:ye,u_atmosphere_blend:ze,u_globe_position:Be,u_globe_radius:Me,u_inv_proj_matrix:We}))(K,oe,[xe[0],xe[1],xe[2]],J,ue),me=as(Z,D);W.draw(Z,G.TRIANGLES,X,Lt.disabled,ei.alphaBlended,rt.disabled,de,null,null,"atmosphere",me.vertexBuffer,me.indexBuffer,me.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let A=(function(D,F){let Z=null,G=Object.values(D._layers).flatMap(K=>K.source&&!K.isHidden(F)?[D.sourceCaches[K.source]]:[]),W=G.filter(K=>K.getSource().type==="vector"),X=G.filter(K=>K.getSource().type!=="vector"),ee=K=>{(!Z||Z.getSource().maxzoom<K.getSource().maxzoom)&&(Z=K)};return W.forEach(K=>ee(K)),Z||X.forEach(K=>ee(K)),Z})(this.style,this.transform.zoom);A&&(function(D,F,Z){for(let G=0;G<Z.length;G++)Rn(D,F,Z[G])})(this,A,A.getVisibleCoordinates())}this.options.showPadding&&(function(A){let D=A.transform.padding;Mc(A,A.transform.height-(D.top||0),3,Wu),Mc(A,D.bottom||0,3,Hu),li(A,D.left||0,3,el),li(A,A.transform.width-(D.right||0),3,Cc);let F=A.transform.centerPoint;(function(Z,G,W,X){_r(Z,G-1,W-10,2,20,X),_r(Z,G-10,W-1,20,2,X)})(A,F.x,A.transform.height-F.y,Mp)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let r=this.terrainFacilitator.matrix,s=this.transform.modelViewProjectionMatrix,c=this.terrainFacilitator.dirty;c||(c=e?!o.c8(r,s):!o.c9(r,s)),c||(c=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(o.ca(r,s),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(p,y){let w=p.context,T=w.gl,P=p.transform,M=ei.unblended,k=new ht(T.LEQUAL,ht.ReadWrite,[0,1]),A=y.sourceCache.getRenderableTiles(),D=p.useProgram("terrainDepth");w.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:o.bf.transparent,depth:1});for(let F of A){let Z=y.getTerrainMesh(F.tileID),G=y.getTerrainData(F.tileID),W=P.getProjectionData({overscaledTileID:F.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),X={u_ele_delta:y.getMeshFrameDelta(P.zoom)};D.draw(w,T.TRIANGLES,k,Lt.disabled,M,rt.backCCW,X,G,W,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain),(function(p,y){let w=p.context,T=w.gl,P=p.transform,M=ei.unblended,k=new ht(T.LEQUAL,ht.ReadWrite,[0,1]),A=y.getCoordsTexture(),D=y.sourceCache.getRenderableTiles(),F=p.useProgram("terrainCoords");w.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:o.bf.transparent,depth:1}),y.coordsIndex=[];for(let Z of D){let G=y.getTerrainMesh(Z.tileID),W=y.getTerrainData(Z.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,A.texture);let X={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(P.zoom)},ee=P.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});F.draw(w,T.TRIANGLES,k,Lt.disabled,M,rt.backCCW,X,W,ee,"terrain",G.vertexBuffer,G.indexBuffer,G.segments),y.coordsIndex.push(Z.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain))}renderLayer(e,r,s,c,p){s.isHidden(this.transform.zoom)||(s.type==="background"||s.type==="custom"||(c||[]).length)&&(this.id=s.id,o.cb(s)?(function(y,w,T,P,M,k){if(y.renderPass!=="translucent")return;let{isRenderingToTexture:A}=k,D=Lt.disabled,F=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Z,G,W,X,ee,K,ie,oe,J){let ue=G.transform,xe=G.style.map.terrain,de=ee==="map",me=K==="map";for(let ye of Z){let ze=X.getTile(ye),Be=ze.getBucket(W);if(!Be||!Be.text||!Be.text.segments.get().length)continue;let Me=o.an(Be.textSizeData,ue.zoom),We=o.aC(ze,1,G.transform.zoom),gt=gi(de,G.transform,We),Bt=W.layout.get("icon-text-fit")!=="none"&&Be.hasIconData();if(Me){let Vt=Math.pow(2,ue.zoom-ze.tileID.overscaledZ),jt=xe?(ni,ci)=>xe.getElevation(ye,ni,ci):null;wc(Be,de,me,J,ue,gt,Vt,Me,Bt,o.aD(ue,ze,ie,oe),ye.toUnwrapped(),jt)}}})(P,y,T,w,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),M),T.paint.get("icon-opacity").constantOr(1)!==0&&ts(y,w,T,P,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),D,F,A),T.paint.get("text-opacity").constantOr(1)!==0&&ts(y,w,T,P,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),D,F,A),w.map.showCollisionBoxes&&(Gu(y,w,T,P,!0),Gu(y,w,T,P,!1))})(e,r,s,c,this.style.placement.variableOffsets,p):o.cc(s)?(function(y,w,T,P,M){if(y.renderPass!=="translucent")return;let{isRenderingToTexture:k}=M,A=T.paint.get("circle-opacity"),D=T.paint.get("circle-stroke-width"),F=T.paint.get("circle-stroke-opacity"),Z=!T.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(D.constantOr(1)===0||F.constantOr(1)===0))return;let G=y.context,W=G.gl,X=y.transform,ee=y.getDepthModeForSublayer(0,ht.ReadOnly),K=Lt.disabled,ie=y.colorModeForRenderPass(),oe=[],J=X.getCircleRadiusCorrection();for(let ue=0;ue<P.length;ue++){let xe=P[ue],de=w.getTile(xe),me=de.getBucket(T);if(!me)continue;let ye=T.paint.get("circle-translate"),ze=T.paint.get("circle-translate-anchor"),Be=o.aD(X,de,ye,ze),Me=me.programConfigurations.get(T.id),We=y.useProgram("circle",Me),gt=me.layoutVertexBuffer,Bt=me.indexBuffer,Vt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(xe),jt={programConfiguration:Me,program:We,layoutVertexBuffer:gt,indexBuffer:Bt,uniformValues:fp(y,de,T,Be,J),terrainData:Vt,projectionData:X.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!k,applyTerrainMatrix:!0})};if(Z){let ni=me.segments.get();for(let ci of ni)oe.push({segments:new o.aM([ci]),sortKey:ci.sortKey,state:jt})}else oe.push({segments:me.segments,sortKey:0,state:jt})}Z&&oe.sort((ue,xe)=>ue.sortKey-xe.sortKey);for(let ue of oe){let{programConfiguration:xe,program:de,layoutVertexBuffer:me,indexBuffer:ye,uniformValues:ze,terrainData:Be,projectionData:Me}=ue.state;de.draw(G,W.TRIANGLES,ee,K,ie,rt.backCCW,ze,Be,Me,T.id,me,ye,ue.segments,T.paint,y.transform.zoom,xe)}})(e,r,s,c,p):o.cd(s)?(function(y,w,T,P,M){if(T.paint.get("heatmap-opacity")===0)return;let k=y.context,{isRenderingToTexture:A,isRenderingGlobe:D}=M;if(y.style.map.terrain){for(let F of P){let Z=w.getTile(F);w.hasRenderableParent(F)||(y.renderPass==="offscreen"?Tc(y,Z,T,F,D):y.renderPass==="translucent"&&qu(y,T,F,A,D))}k.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?(function(F,Z,G,W){let X=F.context,ee=X.gl,K=F.transform,ie=Lt.disabled,oe=new ei([ee.ONE,ee.ONE],o.bf.transparent,[!0,!0,!0,!0]);(function(J,ue,xe){let de=J.gl;J.activeTexture.set(de.TEXTURE1),J.viewport.set([0,0,ue.width/4,ue.height/4]);let me=xe.heatmapFbos.get(o.c2);me?(de.bindTexture(de.TEXTURE_2D,me.colorAttachment.get()),J.bindFramebuffer.set(me.framebuffer)):(me=ns(J,ue.width/4,ue.height/4),xe.heatmapFbos.set(o.c2,me))})(X,F,G),X.clear({color:o.bf.transparent});for(let J=0;J<W.length;J++){let ue=W[J];if(Z.hasRenderableParent(ue))continue;let xe=Z.getTile(ue),de=xe.getBucket(G);if(!de)continue;let me=de.programConfigurations.get(G.id),ye=F.useProgram("heatmap",me),ze=K.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Be=K.getCircleRadiusCorrection();ye.draw(X,ee.TRIANGLES,ht.disabled,ie,oe,rt.backCCW,Cu(xe,K.zoom,G.paint.get("heatmap-intensity"),Be),null,ze,G.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,G.paint,K.zoom,me)}X.viewport.set([0,0,F.width,F.height])})(y,w,T,P):y.renderPass==="translucent"&&(function(F,Z){let G=F.context,W=G.gl;G.setColorMode(F.colorModeForRenderPass());let X=Z.heatmapFbos.get(o.c2);X&&(G.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,X.colorAttachment.get()),G.activeTexture.set(W.TEXTURE1),rs(G,Z).bind(W.LINEAR,W.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(G,W.TRIANGLES,ht.disabled,Lt.disabled,F.colorModeForRenderPass(),rt.disabled,cc(F,Z,0,1),null,null,Z.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,Z.paint,F.transform.zoom))})(y,T)})(e,r,s,c,p):o.ce(s)?(function(y,w,T,P,M){if(y.renderPass!=="translucent")return;let{isRenderingToTexture:k}=M,A=T.paint.get("line-opacity"),D=T.paint.get("line-width");if(A.constantOr(1)===0||D.constantOr(1)===0)return;let F=y.getDepthModeForSublayer(0,ht.ReadOnly),Z=y.colorModeForRenderPass(),G=T.paint.get("line-dasharray"),W=T.paint.get("line-pattern"),X=W.constantOr(1),ee=T.paint.get("line-gradient"),K=T.getCrossfadeParameters(),ie=X?"linePattern":G?"lineSDF":ee?"lineGradient":"line",oe=y.context,J=oe.gl,ue=y.transform,xe=!0;for(let de of P){let me=w.getTile(de);if(X&&!me.patternsLoaded())continue;let ye=me.getBucket(T);if(!ye)continue;let ze=ye.programConfigurations.get(T.id),Be=y.context.program.get(),Me=y.useProgram(ie,ze),We=xe||Me.program!==Be,gt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(de),Bt=W.constantOr(null);if(Bt&&me.imageAtlas){let dt=me.imageAtlas,$t=dt.patternPositions[Bt.to.toString()],bi=dt.patternPositions[Bt.from.toString()];$t&&bi&&ze.setConstantPatternPositions($t,bi)}let Vt=ue.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),jt=ue.getPixelScale(),ni=X?ku(y,me,T,jt,K):G?Co(y,me,T,jt,G,K):ee?Au(y,me,T,jt,ye.lineClipsArray.length):$s(y,me,T,jt);if(X)oe.activeTexture.set(J.TEXTURE0),me.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),ze.updatePaintBuffers(K);else if(G&&(We||y.lineAtlas.dirty))oe.activeTexture.set(J.TEXTURE0),y.lineAtlas.bind(oe);else if(ee){let dt=ye.gradients[T.id],$t=dt.texture;if(T.gradientVersion!==dt.version){let bi=256;if(T.stepInterpolant){let Mi=w.getSource().maxzoom,Fi=de.canonical.z===Mi?Math.ceil(1<<y.transform.maxZoom-de.canonical.z):1;bi=o.ah(o.c3(ye.maxLineLength/o.$*1024*Fi),256,oe.maxTextureSize)}dt.gradient=o.c4({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:bi,image:dt.gradient||void 0,clips:ye.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new o.T(oe,dt.gradient,J.RGBA),dt.version=T.gradientVersion,$t=dt.texture}oe.activeTexture.set(J.TEXTURE0),$t.bind(T.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}let ci=y.stencilModeForClipping(de);Me.draw(oe,J.TRIANGLES,F,ci,Z,rt.disabled,ni,gt,Vt,T.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,T.paint,y.transform.zoom,ze,ye.layoutVertexBuffer2),xe=!1}})(e,r,s,c,p):o.cf(s)?(function(y,w,T,P,M){let k=T.paint.get("fill-color"),A=T.paint.get("fill-opacity");if(A.constantOr(1)===0)return;let{isRenderingToTexture:D}=M,F=y.colorModeForRenderPass(),Z=T.paint.get("fill-pattern"),G=y.opaquePassEnabledForLayer()&&!Z.constantOr(1)&&k.constantOr(o.bf.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===G){let W=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?ht.ReadWrite:ht.ReadOnly);Js(y,w,T,P,W,F,!1,D)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){let W=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,ht.ReadOnly);Js(y,w,T,P,W,F,!0,D)}})(e,r,s,c,p):o.cg(s)?(function(y,w,T,P,M){let k=T.paint.get("fill-extrusion-opacity");if(k===0)return;let{isRenderingToTexture:A}=M;if(y.renderPass==="translucent"){let D=new ht(y.context.gl.LEQUAL,ht.ReadWrite,y.depthRangeFor3D);if(k!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))Sc(y,w,T,P,D,Lt.disabled,ei.disabled,A),Sc(y,w,T,P,D,y.stencilModeFor3D(),y.colorModeForRenderPass(),A);else{let F=y.colorModeForRenderPass();Sc(y,w,T,P,D,Lt.disabled,F,A)}}})(e,r,s,c,p):o.ch(s)?(function(y,w,T,P,M){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;let{isRenderingToTexture:k}=M,A=y.context,D=y.style.projection.useSubdivision,F=y.getDepthModeForSublayer(0,ht.ReadOnly),Z=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(G,W,X,ee,K,ie,oe){let J=G.context,ue=J.gl;for(let xe of X){let de=W.getTile(xe),me=de.dem;if(!me||!me.data||!de.needsHillshadePrepare)continue;let ye=me.dim,ze=me.stride,Be=me.getPixels();if(J.activeTexture.set(ue.TEXTURE1),J.pixelStoreUnpackPremultiplyAlpha.set(!1),de.demTexture=de.demTexture||G.getTileTexture(ze),de.demTexture){let We=de.demTexture;We.update(Be,{premultiply:!1}),We.bind(ue.NEAREST,ue.CLAMP_TO_EDGE)}else de.demTexture=new o.T(J,Be,ue.RGBA,{premultiply:!1}),de.demTexture.bind(ue.NEAREST,ue.CLAMP_TO_EDGE);J.activeTexture.set(ue.TEXTURE0);let Me=de.fbo;if(!Me){let We=new o.T(J,{width:ye,height:ye,data:null},ue.RGBA);We.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),Me=de.fbo=J.createFramebuffer(ye,ye,!0,!1),Me.colorAttachment.set(We.texture)}J.bindFramebuffer.set(Me.framebuffer),J.viewport.set([0,0,ye,ye]),G.useProgram("hillshadePrepare").draw(J,ue.TRIANGLES,K,ie,oe,rt.disabled,Mu(de.tileID,me),null,null,ee.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments),de.needsHillshadePrepare=!1}})(y,w,P,T,F,Lt.disabled,Z),A.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(D){let[G,W,X]=y.stencilConfigForOverlapTwoPass(P);ko(y,w,T,X,G,F,Z,!1,k),ko(y,w,T,X,W,F,Z,!0,k)}else{let[G,W]=y.getStencilConfigForOverlapAndUpdateStencilID(P);ko(y,w,T,W,G,F,Z,!1,k)}})(e,r,s,c,p):o.ci(s)?(function(y,w,T,P,M){if(y.renderPass!=="translucent"||!P.length)return;let{isRenderingToTexture:k}=M,A=y.style.projection.useSubdivision,D=y.getDepthModeForSublayer(0,ht.ReadOnly),F=y.colorModeForRenderPass();if(A){let[Z,G,W]=y.stencilConfigForOverlapTwoPass(P);Ic(y,w,T,W,Z,D,F,!1,k),Ic(y,w,T,W,G,D,F,!0,k)}else{let[Z,G]=y.getStencilConfigForOverlapAndUpdateStencilID(P);Ic(y,w,T,G,Z,D,F,!1,k)}})(e,r,s,c,p):o.cj(s)?(function(y,w,T,P,M){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!P.length)return;let{isRenderingToTexture:k}=M,A=w.getSource(),D=y.style.projection.useSubdivision;if(A instanceof pr)Lo(y,w,T,P,null,!1,!1,A.tileCoords,A.flippedWindingOrder,k);else if(D){let[F,Z,G]=y.stencilConfigForOverlapTwoPass(P);Lo(y,w,T,G,F,!1,!0,Qs,!1,k),Lo(y,w,T,G,Z,!0,!0,Qs,!1,k)}else{let[F,Z]=y.getStencilConfigForOverlapAndUpdateStencilID(P);Lo(y,w,T,Z,F,!1,!0,Qs,!1,k)}})(e,r,s,c,p):o.ck(s)?(function(y,w,T,P,M){let k=T.paint.get("background-color"),A=T.paint.get("background-opacity");if(A===0)return;let{isRenderingToTexture:D}=M,F=y.context,Z=F.gl,G=y.style.projection,W=y.transform,X=W.tileSize,ee=T.paint.get("background-pattern");if(y.isPatternMissing(ee))return;let K=!ee&&k.a===1&&A===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==K)return;let ie=Lt.disabled,oe=y.getDepthModeForSublayer(0,K==="opaque"?ht.ReadWrite:ht.ReadOnly),J=y.colorModeForRenderPass(),ue=y.useProgram(ee?"backgroundPattern":"background"),xe=P||pe(W,{tileSize:X,terrain:y.style.map.terrain});ee&&(F.activeTexture.set(Z.TEXTURE0),y.imageManager.bind(y.context));let de=T.getCrossfadeParameters();for(let me of xe){let ye=W.getProjectionData({overscaledTileID:me,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),ze=ee?zu(A,y,ee,{tileID:me,tileSize:X},de):Du(A,k),Be=y.style.map.terrain&&y.style.map.terrain.getTerrainData(me),Me=G.getMeshFromTileID(F,me.canonical,!1,!0,"raster");ue.draw(F,Z.TRIANGLES,oe,ie,J,rt.backCCW,ze,Be,ye,T.id,Me.vertexBuffer,Me.indexBuffer,Me.segments)}})(e,0,s,c,p):o.cl(s)&&(function(y,w,T,P){let{isRenderingGlobe:M}=P,k=y.context,A=T.implementation,D=y.style.projection,F=y.transform,Z=F.getProjectionDataForCustomLayer(M),G={farZ:F.farZ,nearZ:F.nearZ,fov:F.fov*Math.PI/180,modelViewProjectionMatrix:F.modelViewProjectionMatrix,projectionMatrix:F.projectionMatrix,shaderData:{variantName:D.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${D.shaderPreludeCode.vertexSource}`,define:D.shaderDefine},defaultProjectionData:Z},W=A.renderingMode?A.renderingMode:"2d";if(y.renderPass==="offscreen"){let X=A.prerender;X&&(y.setCustomLayerDefaults(),k.setColorMode(y.colorModeForRenderPass()),X.call(A,k.gl,G),k.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),k.setColorMode(y.colorModeForRenderPass()),k.setStencilMode(Lt.disabled);let X=W==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,ht.ReadOnly);k.setDepthMode(X),A.render(k.gl,G),k.setDirty(),y.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,s,p))}saveTileTexture(e){let r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let r=this.imageManager.getPattern(e.from.toString()),s=this.imageManager.getPattern(e.to.toString());return!r||!s}useProgram(e,r,s=!1,c=[]){this.cache=this.cache||{};let p=!!this.style.map.terrain,y=this.style.projection,w=s?Zn.projectionMercator:y.shaderPreludeCode,T=s?Mr:y.shaderDefine,P=e+(r?r.cacheKey:"")+`/${s?bo:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(p?"/terrain":"")+(c?`/${c.join("/")}`:"");return this.cache[P]||(this.cache[P]=new lc(this.context,Zn[e],r,mc[e],this._showOverdrawInspector,p,w,T,c)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function Do(h,e){let r,s=!1,c=null,p=null,y=()=>{c=null,s&&(h.apply(p,r),c=setTimeout(y,e),s=!1)};return(...w)=>(s=!0,p=this,r=w,c||y(),c)}class il{constructor(e){this._getCurrentHash=()=>{let r=window.location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(s=c)}),(s&&s[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{let r=this._getCurrentHash();if(!this._isValidHash(r))return!1;let s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:s,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{let r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{let r=this._getCurrentHash();if(r.length===0)return;let s=r.join("/"),c=s;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${s}`);let p=window.location.hash.replace(c,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let y=window.location.href.replace(/(#.+)?$/,p);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Do(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let r=this._map.getCenter(),s=Math.round(100*this._map.getZoom())/100,c=Math.ceil((s*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),y=Math.round(r.lng*p)/p,w=Math.round(r.lat*p)/p,T=this._map.getBearing(),P=this._map.getPitch(),M="";if(M+=e?`/${y}/${w}/${s}`:`${s}/${w}/${y}`,(T||P)&&(M+="/"+Math.round(10*T)/10),P&&(M+=`/${Math.round(P)}`),this._hashName){let k=this._hashName,A=!1,D=window.location.hash.slice(1).split("&").map(F=>{let Z=F.split("=")[0];return Z===k?(A=!0,`${Z}=${M}`):F}).filter(F=>F);return A||D.push(`${k}=${M}`),`#${D.join("&")}`}return`#${M}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.S(+e[2],+e[1])}catch{return!1}let r=+e[0],s=+(e[3]||0),c=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&s>=-180&&s<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}let kr={linearity:.3,easing:o.cm(0,0,.3,1)},Ec=o.e({deceleration:2500,maxSpeed:1400},kr),Ku=o.e({deceleration:20,maxSpeed:1400},kr),Yu=o.e({deceleration:1e3,maxSpeed:360},kr),Ju=o.e({deceleration:1e3,maxSpeed:90},kr),Qu=o.e({deceleration:1e3,maxSpeed:360},kr);class eh{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ne.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,r=ne.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let r={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:p}of this._inertiaBuffer)r.zoom+=p.zoomDelta||0,r.bearing+=p.bearingDelta||0,r.pitch+=p.pitchDelta||0,r.roll+=p.rollDelta||0,p.panDelta&&r.pan._add(p.panDelta),p.around&&(r.around=p.around),p.pinchAround&&(r.pinchAround=p.pinchAround);let s=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(r.pan.mag()){let p=ua(r.pan.mag(),s,o.e({},Ec,e||{})),y=r.pan.mult(p.amount/r.pan.mag()),w=this._map.cameraHelper.handlePanInertia(y,this._map.transform);c.center=w.easingCenter,c.offset=w.easingOffset,Hn(c,p)}if(r.zoom){let p=ua(r.zoom,s,Ku);c.zoom=this._map.transform.zoom+p.amount,Hn(c,p)}if(r.bearing){let p=ua(r.bearing,s,Yu);c.bearing=this._map.transform.bearing+o.ah(p.amount,-179,179),Hn(c,p)}if(r.pitch){let p=ua(r.pitch,s,Ju);c.pitch=this._map.transform.pitch+p.amount,Hn(c,p)}if(r.roll){let p=ua(r.roll,s,Qu);c.roll=this._map.transform.roll+o.ah(p.amount,-179,179),Hn(c,p)}if(c.zoom||c.bearing){let p=r.pinchAround===void 0?r.around:r.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),o.e(c,{noMoveStart:!0})}}function Hn(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function ua(h,e,r){let{maxSpeed:s,linearity:c,deceleration:p}=r,y=o.ah(h*c/(e/1e3),-s,s),w=Math.abs(y)/(p*c);return{easing:r.easing,duration:1e3*w,amount:y*(w/2)}}class _n extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,s,c={}){s=s instanceof MouseEvent?s:new MouseEvent(e,s);let p=q.mousePos(r.getCanvas(),s),y=r.unproject(p);super(e,o.e({point:p,lngLat:y,originalEvent:s},c)),this._defaultPrevented=!1,this.target=r}}class ha extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,s){let c=e==="touchend"?s.changedTouches:s.touches,p=q.touchPos(r.getCanvasContainer(),c),y=p.map(T=>r.unproject(T)),w=p.reduce((T,P,M,k)=>T.add(P.div(k.length)),new o.P(0,0));super(e,{points:p,point:w,lngLats:y,lngLat:r.unproject(w),originalEvent:s}),this._defaultPrevented=!1}}class Ac extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,s){super(e,{originalEvent:s}),this._defaultPrevented=!1}}class th{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ac(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new _n(e.type,this._map,e))}mouseup(e){this._map.fire(new _n(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new _n(e.type,this._map,e))}dblclick(e){return this._firePreventable(new _n(e.type,this._map,e))}mouseover(e){this._map.fire(new _n(e.type,this._map,e))}mouseout(e){this._map.fire(new _n(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ha(e.type,this._map,e))}touchmove(e){this._map.fire(new ha(e.type,this._map,e))}touchend(e){this._map.fire(new ha(e.type,this._map,e))}touchcancel(e){this._map.fire(new ha(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ih{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new _n(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _n("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new _n(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pa{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class kc{constructor(e,r){this._map=e,this._tr=new pa(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(q.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;let s=r;if(this._lastPos.equals(s)||!this._box&&s.dist(this._startPos)<this._clickTolerance)return;let c=this._startPos;this._lastPos=s,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let p=Math.min(c.x,s.x),y=Math.max(c.x,s.x),w=Math.min(c.y,s.y),T=Math.max(c.y,s.y);q.setTransform(this._box,`translate(${p}px,${w}px)`),this._box.style.width=y-p+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;let s=this._startPos,c=r;if(this.reset(),q.suppressClick(),s.x!==c.x||s.y!==c.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(s,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new o.l(e,{originalEvent:r}))}}function da(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);let r={};for(let s=0;s<h.length;s++)r[h[s].identifier]=e[s];return r}class nh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,s){(this.centroid||s.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),s.length===this.numTouches&&(this.centroid=(function(c){let p=new o.P(0,0);for(let y of c)p._add(y);return p.div(c.length)})(r),this.touches=da(s,r)))}touchmove(e,r,s){if(this.aborted||!this.centroid)return;let c=da(s,r);for(let p in this.touches){let y=c[p];(!y||y.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,r,s){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),s.length===0){let c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class yn{constructor(e){this.singleTap=new nh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,s){this.singleTap.touchstart(e,r,s)}touchmove(e,r,s){this.singleTap.touchmove(e,r,s)}touchend(e,r,s){let c=this.singleTap.touchend(e,r,s);if(c){let p=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(c)<30;if(p&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class Xn{constructor(e){this._tr=new pa(e),this._zoomIn=new yn({numTouches:1,numTaps:2}),this._zoomOut=new yn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,s){this._zoomIn.touchstart(e,r,s),this._zoomOut.touchstart(e,r,s)}touchmove(e,r,s){this._zoomIn.touchmove(e,r,s),this._zoomOut.touchmove(e,r,s)}touchend(e,r,s){let c=this._zoomIn.touchend(e,r,s),p=this._zoomOut.touchend(e,r,s),y=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(c)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ma{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;let s=this._lastPoint;if(!s)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let c=Array.isArray(r)?r[0]:r;return!this._moved&&c.dist(s)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(s,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Kn=0,fa=2,Ep={[Kn]:1,[fa]:2};class ss{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let r=q.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(r,s){let c=Ep[s];return r.buttons===void 0||(r.buttons&c)!==c})(e,this._eventButton)}isValidEndEvent(e){return q.mouseButton(e)===this._eventButton}}class Ap{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class kp{constructor(e=new ss({checkCorrectEvent:()=>!0}),r=new Ap){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,s){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?s(e):void 0}startMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}let ls=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}};class cs{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,s){return this._calculateTransform(e,r,s)}touchmove(e,r,s){if(this._active){if(!this._shouldBePrevented(s.length))return e.preventDefault(),this._calculateTransform(e,r,s);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,s){this._calculateTransform(e,r,s),this._active&&this._shouldBePrevented(s.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,s){s.length>0&&(this._active=!0);let c=da(s,r),p=new o.P(0,0),y=new o.P(0,0),w=0;for(let P in c){let M=c[P],k=this._touches[P];k&&(p._add(M),y._add(M.sub(k)),w++,c[P]=M)}if(this._touches=c,this._shouldBePrevented(w)||!y.mag())return;let T=y.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,s){this._firstTwoTouches||s.length<2||(this._firstTwoTouches=[s[0].identifier,s[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,s){if(!this._firstTwoTouches)return;e.preventDefault();let[c,p]=this._firstTwoTouches,y=Ge(s,r,c),w=Ge(s,r,p);if(!y||!w)return;let T=this._aroundCenter?null:y.add(w).div(2);return this._move([y,w],T,e)}touchend(e,r,s){if(!this._firstTwoTouches)return;let[c,p]=this._firstTwoTouches,y=Ge(s,r,c),w=Ge(s,r,p);y&&w||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ge(h,e,r){for(let s=0;s<h.length;s++)if(h[s].identifier===r)return e[s]}function Lc(h,e){return Math.log(h/e)/Math.LN2}class nl extends Yn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){let s=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Lc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lc(this._distance,s),pinchAround:r}}}function Dc(h,e){return 180*h.angleWith(e)/Math.PI}class ga extends Yn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,s){let c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Dc(this._vector,c),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let r=25/(Math.PI*this._minDiameter)*360,s=Dc(e,this._startVector);return Math.abs(s)<r}}function zo(h){return Math.abs(h.y)>Math.abs(h.x)}class rl extends Yn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,s){super.touchstart(e,r,s),this._currentTouchCount=s.length}_start(e){this._lastPoints=e,zo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,s){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let c=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,s.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,s){if(this._valid!==void 0)return this._valid;let c=e.mag()>=2,p=r.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=s),s-this._firstMove<100&&void 0;let y=e.y>0==r.y>0;return zo(e)&&zo(r)&&y}}let Ct={panStep:100,bearingStep:15,pitchStep:10};class ol{constructor(e){this._tr=new pa(e);let r=Ct;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,s=0,c=0,p=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?s=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?s=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(s=0,c=0),{cameraAnimation:w=>{let T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Lp,zoom:r?Math.round(T.zoom)+r*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+s*this._bearingStep,pitch:T.pitch+c*this._pitchStep,offset:[-p*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Lp(h){return h*(2-h)}let al=4.000244140625,Dp=1/450;class rh{constructor(e,r){this._onTimeout=s=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)},this._map=e,this._tr=new pa(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Dp}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,s=ne.now(),c=s-(this._lastWheelEventTime||0);this._lastWheelEventTime=s,r!==0&&r%al==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let r=q.mousePos(this._map.getCanvas(),e),s=this._tr;this._aroundPoint=this._aroundCenter?s.transform.locationToScreenPoint(o.S.convert(s.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){let w=this._type==="wheel"&&Math.abs(this._delta)>al?this._wheelZoomRate:this._defaultZoomRate,T=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&T!==0&&(T=1/T);let P=typeof this._targetZoom!="number"?e.scale:o.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),o.ak(P*T)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,s=this._startZoom,c=this._easing,p,y=!1;if(this._type==="wheel"&&s&&c){let w=ne.now()-this._lastWheelEventTime,T=Math.min((w+5)/200,1),P=c(T);p=o.C.number(s,r,P),T<1?this._frameId||(this._frameId=!0):y=!0}else p=r,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=p,{noInertia:!0,needsRenderFrame:!y,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=o.co;if(this._prevEase){let s=this._prevEase,c=(ne.now()-s.start)/s.duration,p=s.easing(c+.01)-s.easing(c),y=.27/Math.sqrt(p*p+1e-4)*.01,w=Math.sqrt(.0729-y*y);r=o.cm(y,w,.25,1)}return this._prevEase={start:ne.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zc{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rc{constructor(e){this._tr=new pa(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:s=>{s.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oh{constructor(){this._tap=new yn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,s){if(!this._swipePoint)if(this._tapTime){let c=r[0],p=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(c)<30;p&&y?s.length>0&&(this._swipePoint=c,this._swipeTouch=s[0].identifier):this.reset()}else this._tap.touchstart(e,r,s)}touchmove(e,r,s){if(this._tapTime){if(this._swipePoint){if(s[0].identifier!==this._swipeTouch)return;let c=r[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,r,s)}touchend(e,r,s){if(this._tapTime)this._swipePoint&&s.length===0&&this.reset();else{let c=this._tap.touchend(e,r,s);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ah{constructor(e,r,s){this._el=e,this._mousePan=r,this._touchPan=s}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fc{constructor(e,r,s,c){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=s,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class sh{constructor(e,r,s,c){this._el=e,this._touchZoom=r,this._touchRotate=s,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class lh{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=q.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let s=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=r,this._container.appendChild(c);let p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=s,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let Jn=h=>h.zoom||h.drag||h.roll||h.pitch||h.rotate;class Qt extends o.l{}function _a(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta||h.rollDelta}class Bc{constructor(e,r){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let y=c.type==="renderFrame"?void 0:c,w={needsRenderFrame:!1},T={},P={};for(let{handlerName:A,handler:D,allowed:F}of this._handlers){if(!D.isEnabled())continue;let Z;if(this._blockedByActive(P,F,A))D.reset();else if(D[p||c.type]){if(o.cp(c,p||c.type)){let G=q.mousePos(this._map.getCanvas(),c);Z=D[p||c.type](c,G)}else if(o.cq(c,p||c.type)){let G=this._getMapTouches(c.touches),W=q.touchPos(this._map.getCanvas(),G);Z=D[p||c.type](c,W,G)}else o.cr(p||c.type)||(Z=D[p||c.type](c));this.mergeHandlerResult(w,T,Z,A,y),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()}(Z||D.isActive())&&(P[A]=D)}let M={};for(let A in this._previousActiveHandlers)P[A]||(M[A]=y);this._previousActiveHandlers=P,(Object.keys(M).length||_a(w))&&(this._changes.push([w,T,M]),this._triggerRenderFrame()),(Object.keys(P).length||_a(w))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:k}=w;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new eh(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);let s=this._el;this._listeners=[[s,"touchstart",{passive:!0}],[s,"touchmove",{passive:!1}],[s,"touchend",void 0],[s,"touchcancel",void 0],[s,"mousedown",void 0],[s,"mousemove",void 0],[s,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[s,"mouseover",void 0],[s,"mouseout",void 0],[s,"dblclick",void 0],[s,"click",void 0],[s,"keydown",{capture:!1}],[s,"keyup",void 0],[s,"wheel",{passive:!1}],[s,"contextmenu",void 0],[window,"blur",void 0]];for(let[c,p,y]of this._listeners)q.addEventListener(c,p,c===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(let[e,r,s]of this._listeners)q.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,s)}_addDefaultHandlers(e){let r=this._map,s=r.getCanvasContainer();this._add("mapEvent",new th(r,e));let c=r.boxZoom=new kc(r,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();let p=r.cooperativeGestures=new lh(r,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();let y=new Xn(r),w=new Rc(r);r.doubleClickZoom=new zc(w,y),this._add("tapZoom",y),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();let T=new oh;this._add("tapDragZoom",T);let P=r.touchPitch=new rl(r);this._add("touchPitch",P),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);let M=()=>r.project(r.getCenter()),k=(function({enable:K,clickTolerance:ie,aroundCenter:oe=!0,minPixelCenterThreshold:J=100,rotateDegreesPerPixelMoved:ue=.8},xe){let de=new ss({checkCorrectEvent:me=>q.mouseButton(me)===0&&me.ctrlKey||q.mouseButton(me)===2&&!me.ctrlKey});return new ma({clickTolerance:ie,move:(me,ye)=>{let ze=xe();if(oe&&Math.abs(ze.y-me.y)>J)return{bearingDelta:o.cn(new o.P(me.x,ye.y),ye,ze)};let Be=(ye.x-me.x)*ue;return oe&&ye.y<ze.y&&(Be=-Be),{bearingDelta:Be}},moveStateManager:de,enable:K,assignEvents:ls})})(e,M),A=(function({enable:K,clickTolerance:ie,pitchDegreesPerPixelMoved:oe=-.5}){let J=new ss({checkCorrectEvent:ue=>q.mouseButton(ue)===0&&ue.ctrlKey||q.mouseButton(ue)===2});return new ma({clickTolerance:ie,move:(ue,xe)=>({pitchDelta:(xe.y-ue.y)*oe}),moveStateManager:J,enable:K,assignEvents:ls})})(e),D=(function({enable:K,clickTolerance:ie,rollDegreesPerPixelMoved:oe=.3},J){let ue=new ss({checkCorrectEvent:xe=>q.mouseButton(xe)===2&&xe.ctrlKey});return new ma({clickTolerance:ie,move:(xe,de)=>{let me=J(),ye=(de.x-xe.x)*oe;return de.y<me.y&&(ye=-ye),{rollDelta:ye}},moveStateManager:ue,enable:K,assignEvents:ls})})(e,M);r.dragRotate=new Fc(e,k,A,D),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",A,["mouseRotate","mouseRoll"]),this._add("mouseRoll",D,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();let F=(function({enable:K,clickTolerance:ie}){let oe=new ss({checkCorrectEvent:J=>q.mouseButton(J)===0&&!J.ctrlKey});return new ma({clickTolerance:ie,move:(J,ue)=>({around:ue,panDelta:ue.sub(J)}),activateOnStart:!0,moveStateManager:oe,enable:K,assignEvents:ls})})(e),Z=new cs(e,r);r.dragPan=new ah(s,F,Z),this._add("mousePan",F),this._add("touchPan",Z,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);let G=new ga,W=new nl;r.touchZoomRotate=new sh(s,W,G,T),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);let X=r.scrollZoom=new rh(r,()=>this._triggerRenderFrame());this._add("scrollZoom",X,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);let ee=r.keyboard=new ol(r);this._add("keyboard",ee),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new ih(r))}_add(e,r,s){this._handlers.push({handlerName:e,handler:r,allowed:s}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(let{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Jn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,s){for(let c in e)if(c!==s&&(!r||r.indexOf(c)<0))return!0;return!1}_getMapTouches(e){let r=[];for(let s of e)this._el.contains(s.target)&&r.push(s);return r}mergeHandlerResult(e,r,s,c,p){if(!s)return;o.e(e,s);let y={handlerName:c,originalEvent:s.originalEvent||p};s.zoomDelta!==void 0&&(r.zoom=y),s.panDelta!==void 0&&(r.drag=y),s.rollDelta!==void 0&&(r.roll=y),s.pitchDelta!==void 0&&(r.pitch=y),s.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){let e={},r={},s={};for(let[c,p,y]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(e.rollDelta=(e.rollDelta||0)+c.rollDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),o.e(r,p),o.e(s,y);this._updateMapTransform(e,r,s),this._changes=[]}_updateMapTransform(e,r,s){let c=this._map,p=c._getTransformForUpdate(),y=c.terrain;if(!(_a(e)||y&&this._terrainMovement))return this._fireEvents(r,s,!0);c._stop(!0);let{panDelta:w,zoomDelta:T,bearingDelta:P,pitchDelta:M,rollDelta:k,around:A,pinchAround:D}=e;D!==void 0&&(A=D),A=A||c.transform.centerPoint,y&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);let F={panDelta:w,zoomDelta:T,rollDelta:k,pitchDelta:M,bearingDelta:P,around:A};this._map.cameraHelper.useGlobeControls&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);let Z=A.distSqr(p.centerPoint)<.01?p.center:p.screenPointToLocation(w?A.sub(w):A);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(F,p),this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?p.setCenter(p.screenPointToLocation(p.centerPoint.sub(w))):this._map.cameraHelper.handleMapControlsPan(F,p,Z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(F,p,Z))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(F,p),this._map.cameraHelper.handleMapControlsPan(F,p,Z)),c._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,s,!0)}_fireEvents(e,r,s){let c=Jn(this._eventsInProgress),p=Jn(e),y={};for(let k in e){let{originalEvent:A}=e[k];this._eventsInProgress[k]||(y[`${k}start`]=A),this._eventsInProgress[k]=e[k]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(let k in y)this._fireEvent(k,y[k]);p&&this._fireEvent("move",p.originalEvent);for(let k in e){let{originalEvent:A}=e[k];this._fireEvent(k,A)}let w={},T;for(let k in this._eventsInProgress){let{handlerName:A,originalEvent:D}=this._eventsInProgress[k];this._handlersById[A].isActive()||(delete this._eventsInProgress[k],T=r[A]||D,w[`${k}end`]=T)}for(let k in w)this._fireEvent(k,w[k]);let P=Jn(this._eventsInProgress),M=(c||p)&&!P;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let k=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&k.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(k)}if(s&&M){this._updatingCamera=!0;let k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;!k||!k.essential&&ne.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:T})),A(this._map.getBearing())&&this._map.resetNorth()):(A(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new o.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Qt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ch extends o.E{constructor(e,r,s){super(),this._renderFrameCallback=()=>{let c=Math.min((ne.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,s){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},r),s)}panTo(e,r,s){return this.easeTo(o.e({center:e},r),s)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,s){return this.easeTo(o.e({zoom:e},r),s)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)).fire(new o.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,s){return this.easeTo(o.e({bearing:e},r),s)}resetNorth(e,r){return this.rotateTo(0,o.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=hi.convert(e).adjustAntiMeridian();let s=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),s,r)}_cameraForBoxAndBearing(e,r,s,c){let p={top:0,bottom:0,right:0,left:0};if(typeof(c=o.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){let P=c.padding;c.padding={top:P,bottom:P,right:P,left:P}}let y=o.e(p,c.padding);c.padding=y;let w=this.transform,T=new hi(e,r);return this.cameraHelper.cameraForBoxAndBearing(c,y,T,s,w)}fitBounds(e,r,s){return this._fitInternal(this.cameraForBounds(e,r),r,s)}fitScreenCoordinates(e,r,s,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(r)),s,c),c,p)}_fitInternal(e,r,s){return e?(delete(r=o.e(e,r)).padding,r.linear?this.easeTo(r,s):this.flyTo(r,s)):this}jumpTo(e,r){this.stop();let s=this._getTransformForUpdate(),c=!1,p=!1,y=!1,w=s.zoom;this.cameraHelper.handleJumpToCenterZoom(s,e);let T=s.zoom!==w;return"elevation"in e&&s.elevation!==+e.elevation&&s.setElevation(+e.elevation),"bearing"in e&&s.bearing!==+e.bearing&&(c=!0,s.setBearing(+e.bearing)),"pitch"in e&&s.pitch!==+e.pitch&&(p=!0,s.setPitch(+e.pitch)),"roll"in e&&s.roll!==+e.roll&&(y=!0,s.setRoll(+e.roll)),e.padding==null||s.isPaddingEqual(e.padding)||s.setPadding(e.padding),this._applyUpdatedTransform(s),this.fire(new o.l("movestart",r)).fire(new o.l("move",r)),T&&this.fire(new o.l("zoomstart",r)).fire(new o.l("zoom",r)).fire(new o.l("zoomend",r)),c&&this.fire(new o.l("rotatestart",r)).fire(new o.l("rotate",r)).fire(new o.l("rotateend",r)),p&&this.fire(new o.l("pitchstart",r)).fire(new o.l("pitch",r)).fire(new o.l("pitchend",r)),y&&this.fire(new o.l("rollstart",r)).fire(new o.l("roll",r)).fire(new o.l("rollend",r)),this.fire(new o.l("moveend",r))}calculateCameraOptionsFromTo(e,r,s,c=0){let p=o.a1.fromLngLat(e,r),y=o.a1.fromLngLat(s,c),w=y.x-p.x,T=y.y-p.y,P=y.z-p.z,M=Math.hypot(w,T,P);if(M===0)throw new Error("Can't calculate camera options with same From and To");let k=Math.hypot(w,T),A=o.ak(this.transform.cameraToCenterDistance/M/this.transform.tileSize),D=180*Math.atan2(w,-T)/Math.PI,F=180*Math.acos(k/M)/Math.PI;return F=P<0?90-F:90+F,{center:y.toLngLat(),elevation:c,zoom:A,pitch:F,bearing:D}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,s,c,p){let y=this.transform.calculateCenterFromCameraLngLatAlt(e,r,s,c);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:s,pitch:c,roll:p}}easeTo(e,r){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.co},e)).animate===!1||!e.essential&&ne.prefersReducedMotion)&&(e.duration=0);let s=this._getTransformForUpdate(),c=this.getBearing(),p=s.pitch,y=s.roll,w="bearing"in e?this._normalizeBearing(e.bearing,c):c,T="pitch"in e?+e.pitch:p,P="roll"in e?this._normalizeBearing(e.roll,y):y,M="padding"in e?e.padding:s.padding,k=o.P.convert(e.offset),A,D;e.around&&(A=o.S.convert(e.around),D=s.locationToScreenPoint(A));let F={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Z=this.cameraHelper.handleEaseTo(s,{bearing:w,pitch:T,roll:P,padding:M,around:A,aroundPoint:D,offsetAsPoint:k,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||c!==w,this._pitching=this._pitching||T!==p,this._rolling=this._rolling||P!==y,this._padding=!s.isPaddingEqual(M),this._zooming=this._zooming||Z.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,F),this.terrain&&this._prepareElevation(Z.elevationCenter),this._ease(G=>{Z.easeFunc(G),this.terrain&&!e.freezeElevation&&this._updateElevation(G),this._applyUpdatedTransform(s),this._fireMoveEvents(r)},G=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,G)},e),this}_prepareEase(e,r,s={}){this._moving=!0,r||s.moving||this.fire(new o.l("movestart",e)),this._zooming&&!s.zooming&&this.fire(new o.l("zoomstart",e)),this._rotating&&!s.rotating&&this.fire(new o.l("rotatestart",e)),this._pitching&&!s.pitching&&this.fire(new o.l("pitchstart",e)),this._rolling&&!s.rolling&&this.fire(new o.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){let s=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(s-(r-(s*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let r=e.getCameraLngLat(),s=e.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(s<c){let p=this.calculateCameraOptionsFromTo(r,c,e.center,e.elevation);return{pitch:p.pitch,zoom:p.zoom}}return{}}_applyUpdatedTransform(e){let r=[];if(r.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&r.push(c=>this.transformCameraUpdate(c)),!r.length)return;let s=e.clone();for(let c of r){let p=s.clone(),{center:y,zoom:w,roll:T,pitch:P,bearing:M,elevation:k}=c(p);y&&p.setCenter(y),k!==void 0&&p.setElevation(k),w!==void 0&&p.setZoom(w),T!==void 0&&p.setRoll(T),P!==void 0&&p.setPitch(P),M!==void 0&&p.setBearing(M),s.apply(p)}this.transform.apply(s)}_fireMoveEvents(e){this.fire(new o.l("move",e)),this._zooming&&this.fire(new o.l("zoom",e)),this._rotating&&this.fire(new o.l("rotate",e)),this._pitching&&this.fire(new o.l("pitch",e)),this._rolling&&this.fire(new o.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;let s=this._zooming,c=this._rotating,p=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,s&&this.fire(new o.l("zoomend",e)),c&&this.fire(new o.l("rotateend",e)),p&&this.fire(new o.l("pitchend",e)),y&&this.fire(new o.l("rollend",e)),this.fire(new o.l("moveend",e))}flyTo(e,r){if(!e.essential&&ne.prefersReducedMotion){let ye=o.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(ye,r)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.co},e);let s=this._getTransformForUpdate(),c=s.bearing,p=s.pitch,y=s.roll,w=s.padding,T="bearing"in e?this._normalizeBearing(e.bearing,c):c,P="pitch"in e?+e.pitch:p,M="roll"in e?this._normalizeBearing(e.roll,y):y,k="padding"in e?e.padding:s.padding,A=o.P.convert(e.offset),D=s.centerPoint.add(A),F=s.screenPointToLocation(D),Z=this.cameraHelper.handleFlyTo(s,{bearing:T,pitch:P,roll:M,padding:k,locationAtOffset:F,offsetAsPoint:A,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),G=e.curve,W=Math.max(s.width,s.height),X=W/Z.scaleOfZoom,ee=Z.pixelPathLength;typeof Z.scaleOfMinZoom=="number"&&(G=Math.sqrt(W/Z.scaleOfMinZoom/ee*2));let K=G*G;function ie(ye){let ze=(X*X-W*W+(ye?-1:1)*K*K*ee*ee)/(2*(ye?X:W)*K*ee);return Math.log(Math.sqrt(ze*ze+1)-ze)}function oe(ye){return(Math.exp(ye)-Math.exp(-ye))/2}function J(ye){return(Math.exp(ye)+Math.exp(-ye))/2}let ue=ie(!1),xe=function(ye){return J(ue)/J(ue+G*ye)},de=function(ye){return W*((J(ue)*(oe(ze=ue+G*ye)/J(ze))-oe(ue))/K)/ee;var ze},me=(ie(!0)-ue)/G;if(Math.abs(ee)<2e-6||!isFinite(me)){if(Math.abs(W-X)<1e-6)return this.easeTo(e,r);let ye=X<W?-1:1;me=Math.abs(Math.log(X/W))/G,de=()=>0,xe=ze=>Math.exp(ye*G*ze)}return e.duration="duration"in e?+e.duration:1e3*me/("screenSpeed"in e?+e.screenSpeed/G:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=c!==T,this._pitching=P!==p,this._rolling=M!==y,this._padding=!s.isPaddingEqual(k),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(Z.targetCenter),this._ease(ye=>{let ze=ye*me,Be=1/xe(ze),Me=de(ze);this._rotating&&s.setBearing(o.C.number(c,T,ye)),this._pitching&&s.setPitch(o.C.number(p,P,ye)),this._rolling&&s.setRoll(o.C.number(y,M,ye)),this._padding&&(s.interpolatePadding(w,k,ye),D=s.centerPoint.add(A)),Z.easeFunc(ye,Be,Me,D),this.terrain&&!e.freezeElevation&&this._updateElevation(ye),this._applyUpdatedTransform(s),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var s;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,r)}return e||(s=this.handlers)===null||s===void 0||s.stop(!1),this}_ease(e,r,s){s.animate===!1||s.duration===0?(e(1),r()):(this._easeStart=ne.now(),this._easeOptions=s,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=o.aO(e,-180,180);let s=Math.abs(e-r);return Math.abs(e-360-r)<s&&(e-=360),Math.abs(e+360-r)<s&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(e),this.transform.tileZoom):null}}let Oc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class jc{constructor(e=Oc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){let s=this._map._getUIString(`AttributionControl.${r}`);e.title=s,e.setAttribute("aria-label",s)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}let r=this._map.style.sourceCaches;for(let c in r){let p=r[c];if(p.used||p.usedForTerrain){let y=p.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,p)=>c.length-p.length),e=e.filter((c,p)=>{for(let y=p+1;y<e.length;y++)if(e[y].indexOf(c)>=0)return!1;return!0});let s=e.join(" | ");s!==this._attribHTML&&(this._attribHTML=s,e.length?(this._innerContainer.innerHTML=q.sanitize(s),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class uh{constructor(e={}){this._updateCompact=()=>{let r=this._container.children;if(r.length){let s=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact"):s.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");let r=q.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class yr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){let r=this._currentlyRunning,s=r?this._queue.concat(r):this._queue;for(let c of s)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let r=this._currentlyRunning=this._queue;this._queue=[];for(let s of r)if(!s.cancelled&&(s.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var sl=o.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ke extends o.E{constructor(e){super(),this._lastTilesetChange=ne.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];let s={};for(let c of pe(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))s[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),o.bY(c.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[c.key]=new Jo(c,this.tileSize),this._lastTilesetChange=ne.now());for(let c in this._tiles)s[c]||delete this._tiles[c]}freeRtt(e){for(let r in this._tiles){let s=this._tiles[r];(!e||s.tileID.equals(e)||s.tileID.isChildOf(e)||e.isChildOf(s.tileID))&&(s.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){let r={};for(let s of this._renderableTilesKeys){let c=this._tiles[s].tileID,p=e.clone(),y=o.ba();if(c.canonical.equals(e.canonical))o.bY(y,0,o.$,o.$,0,0,1);else if(c.canonical.isChildOf(e.canonical)){let w=c.canonical.z-e.canonical.z,T=c.canonical.x-(c.canonical.x>>w<<w),P=c.canonical.y-(c.canonical.y>>w<<w),M=o.$>>w;o.bY(y,0,M,M,0,0,1),o.M(y,y,[-T*M,-P*M,0])}else{if(!e.canonical.isChildOf(c.canonical))continue;{let w=e.canonical.z-c.canonical.z,T=e.canonical.x-(e.canonical.x>>w<<w),P=e.canonical.y-(e.canonical.y>>w<<w),M=o.$>>w;o.bY(y,0,o.$,o.$,0,0,1),o.M(y,y,[T*M,P*M,0]),o.N(y,y,[1/2**w,1/2**w,0])}}p.terrainRttPosMatrix32f=new Float32Array(y),r[s]=p}return r}_getTerrainCoordsForTileRanges(e,r){let s={};for(let c of this._renderableTilesKeys){let p=this._tiles[c].tileID;if(!this._isWithinTileRanges(p,r))continue;let y=e.clone(),w=o.ba();if(p.canonical.z===e.canonical.z){let T=e.canonical.x-p.canonical.x,P=e.canonical.y-p.canonical.y;o.bY(w,0,o.$,o.$,0,0,1),o.M(w,w,[T*o.$,P*o.$,0])}else if(p.canonical.z>e.canonical.z){let T=p.canonical.z-e.canonical.z,P=p.canonical.x-(p.canonical.x>>T<<T),M=p.canonical.y-(p.canonical.y>>T<<T),k=e.canonical.x-(p.canonical.x>>T),A=e.canonical.y-(p.canonical.y>>T),D=o.$>>T;o.bY(w,0,D,D,0,0,1),o.M(w,w,[-P*D+k*o.$,-M*D+A*o.$,0])}else{let T=e.canonical.z-p.canonical.z,P=e.canonical.x-(e.canonical.x>>T<<T),M=e.canonical.y-(e.canonical.y>>T<<T),k=(e.canonical.x>>T)-p.canonical.x,A=(e.canonical.y>>T)-p.canonical.y,D=o.$<<T;o.bY(w,0,D,D,0,0,1),o.M(w,w,[P*o.$+k*D,M*o.$+A*D,0])}y.terrainRttPosMatrix32f=new Float32Array(w),s[c]=y}return s}getSourceTile(e,r){let s=this.sourceCache._source,c=e.overscaledZ-this.deltaZoom;if(c>s.maxzoom&&(c=s.maxzoom),c<s.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&r)for(;c>=s.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(c--).key);return p}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class it{constructor(e,r,s){this._meshCache={},this.painter=e,this.sourceCache=new Ke(r),this.options=s,this.exaggeration=typeof s.exaggeration=="number"?s.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,s,c=o.$){var p;if(!(r>=0&&r<c&&s>=0&&s<c))return 0;let y=this.getTerrainData(e),w=(p=y.tile)===null||p===void 0?void 0:p.dem;if(!w)return 0;let T=o.cs([],[r/c*o.$,s/c*o.$],y.u_terrain_matrix),P=[T[0]*w.dim,T[1]*w.dim],M=Math.floor(P[0]),k=Math.floor(P[1]),A=P[0]-M,D=P[1]-k;return w.get(M,k)*(1-A)*(1-D)+w.get(M+1,k)*A*(1-D)+w.get(M,k+1)*(1-A)*D+w.get(M+1,k+1)*A*D}getElevationForLngLatZoom(e,r){if(!o.ct(r,e.wrap()))return 0;let{tileID:s,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(s,c%o.$,p%o.$,o.$)}getElevation(e,r,s,c=o.$){return this.getDEMElevation(e,r,s,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let c=this.painter.context,p=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(c,new o.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ag([])}let r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){let c=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new o.T(c,r.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),r.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}let s=r&&r+r.tileID.key+e.key;if(s&&!this._demMatrixCache[s]){let c=this.sourceCache.sourceCache._source.maxzoom,p=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?p=e.canonical.z-c:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let y=e.canonical.x-(e.canonical.x>>p<<p),w=e.canonical.y-(e.canonical.y>>p<<p),T=o.cu(new Float64Array(16),[1/(o.$<<p),1/(o.$<<p),0]);o.M(T,T,[y*o.$,w*o.$,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:s?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){let r=this.painter,s=r.width/devicePixelRatio,c=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===s&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(r.context,{width:s,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(r.context,{width:s,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(s,c,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,s,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,y=0;p<this._coordsTextureSize;p++)for(let w=0;w<this._coordsTextureSize;w++,y+=4)r[y+0]=255&w,r[y+1]=255&p,r[y+2]=w>>8<<4|p>>8,r[y+3]=0;let s=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),c=new o.T(e,s,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let r=new Uint8Array(4),s=this.painter.context,c=s.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);s.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(p,w-y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),s.bindFramebuffer.set(null);let T=r[0]+(r[2]>>4<<8),P=r[1]+((15&r[2])<<8),M=this.coordsIndex[255-r[3]],k=M&&this.sourceCache.getTileByID(M);if(!k)return null;let A=this._coordsTextureSize,D=(1<<k.tileID.canonical.z)*A;return new o.a1((k.tileID.canonical.x*A+T)/D+k.tileID.wrap,(k.tileID.canonical.y*A+P)/D,this.getElevation(k.tileID,T,P,A))}depthAtPoint(e){let r=new Uint8Array(4),s=this.painter.context,c=s.gl;return s.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),s.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;let s=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,c=s&&e.canonical.y===0,p=s&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${c?"n":""}_${p?"s":""}`;if(this._meshCache[y])return this._meshCache[y];let w=this.painter.context,T=new o.cv,P=new o.aN,M=this.meshSize,k=o.$/M,A=M*M;for(let J=0;J<=M;J++)for(let ue=0;ue<=M;ue++)T.emplaceBack(ue*k,J*k,0);for(let J=0;J<A;J+=M+1)for(let ue=0;ue<M;ue++)P.emplaceBack(ue+J,M+ue+J+1,M+ue+J+2),P.emplaceBack(ue+J,M+ue+J+2,ue+J+1);let D=T.length,F=D+(M+1),Z=(M+1)*M,G=c?o.bh:0,W=c?0:1,X=p?o.bi:o.$,ee=p?0:1;for(let J=0;J<=M;J++)T.emplaceBack(J*k,G,W);for(let J=0;J<=M;J++)T.emplaceBack(J*k,X,ee);for(let J=0;J<M;J++)P.emplaceBack(Z+J,F+J,F+J+1),P.emplaceBack(Z+J,F+J+1,Z+J+1),P.emplaceBack(0+J,D+J+1,D+J),P.emplaceBack(0+J,0+J+1,D+J+1);let K=T.length,ie=K+2*(M+1);for(let J of[0,1])for(let ue=0;ue<=M;ue++)for(let xe of[0,1])T.emplaceBack(J*o.$,ue*k,xe);for(let J=0;J<2*M;J+=2)P.emplaceBack(K+J,K+J+1,K+J+3),P.emplaceBack(K+J,K+J+3,K+J+2),P.emplaceBack(ie+J,ie+J+3,ie+J+1),P.emplaceBack(ie+J,ie+J+2,ie+J+3);let oe=new xo(w.createVertexBuffer(T,sl.members),w.createIndexBuffer(P),o.aM.simpleSegment(0,0,T.length,P.length));return this._meshCache[y]=oe,oe}getMeshFrameDelta(e){return 2*Math.PI*o.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var s;let{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(s=this.getMinMaxElevation(c).minElevation)!==null&&s!==void 0?s:0}getMinMaxElevation(e){let r=this.getTerrainData(e).tile,s={minElevation:null,maxElevation:null};return r&&r.dem&&(s.minElevation=r.dem.min*this.exaggeration,s.maxElevation=r.dem.max*this.exaggeration),s}_getOverscaledTileIDFromLngLatZoom(e,r){let s=o.a1.fromLngLat(e.wrap()),c=(1<<r)*o.$,p=s.x*c,y=s.y*c,w=Math.floor(p/o.$),T=Math.floor(y/o.$);return{tileID:new o.Z(r,0,r,w,T),mercatorX:p,mercatorY:y}}}class ll{constructor(e,r,s){this._context=e,this._size=r,this._tileSize=s,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),s=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return s.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(s.texture),{id:e,fbo:r,texture:s,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let no={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class cl{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new ll(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(s=>!e._layers[s].isHidden(r)),this._coordsAscending={};for(let s in e.sourceCaches){this._coordsAscending[s]={};let c=e.sourceCaches[s].getVisibleCoordinates(),p=e.sourceCaches[s].getSource(),y=p instanceof pr?p.terrainTileRanges:null;for(let w of c){let T=this.terrain.sourceCache.getTerrainCoords(w,y);for(let P in T)this._coordsAscending[s][P]||(this._coordsAscending[s][P]=[]),this._coordsAscending[s][P].push(T[P])}}this._coordsAscendingStr={};for(let s of e._order){let c=e._layers[s],p=c.source;if(no[c.type]&&!this._coordsAscendingStr[p]){this._coordsAscendingStr[p]={};for(let y in this._coordsAscending[p])this._coordsAscendingStr[p][y]=this._coordsAscending[p][y].map(w=>w.key).sort().join()}}for(let s of this._renderableTiles)for(let c in this._coordsAscendingStr){let p=this._coordsAscendingStr[c][s.tileID.key];p&&p!==s.rttCoords[c]&&(s.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;let s=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),c=e.type,p=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(no[c]&&(this._prevType&&no[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(no[this._prevType]||no[c]&&y){this._prevType=c;let w=this._stacks.length-1,T=this._stacks[w]||[];for(let P of this._renderableTiles){if(this.pool.isFull()&&(tl(this.painter,this.terrain,this._rttTiles,s),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[w]){let k=this.pool.getObjectForId(P.rtt[w].id);if(k.stamp===P.rtt[w].stamp){this.pool.useObject(k);continue}}let M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),P.rtt[w]={id:M.id,stamp:M.stamp},p.context.bindFramebuffer.set(M.fbo.framebuffer),p.context.clear({color:o.bf.transparent,stencil:0}),p.currentStencilSource=void 0;for(let k=0;k<T.length;k++){let A=p.style._layers[T[k]],D=A.source?this._coordsAscending[A.source][P.tileID.key]:[P.tileID];p.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),p._renderTileClippingMasks(A,D,!0),p.renderLayer(p,p.style.sourceCaches[A.source],A,D,s),A.source&&(P.rttCoords[A.source]=this._coordsAscendingStr[A.source][P.tileID.key])}}return tl(this.painter,this.terrain,this._rttTiles,s),this._rttTiles=[],this.pool.freeAllObjects(),no[c]}return!1}}let an={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},hh=C,Fn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Oc,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},zp={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class us{constructor(e,r,s=!1){this.mousedown=p=>{this.startMove(p,q.mousePos(this.element,p)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=p=>{this.move(p,q.mousePos(this.element,p))},this.mouseup=p=>{this._rotatePitchHandler.dragEnd(p),this.offTemp()},this.touchstart=p=>{p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,p.targetTouches)[0],this.startMove(p,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=p=>{p.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,p.targetTouches)[0],this.move(p,this._lastPos))},this.touchend=p=>{p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;let c=new kp;this._rotatePitchHandler=new ma({clickTolerance:3,move:(p,y)=>{let w=r.getBoundingClientRect(),T=new o.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:o.cn(new o.P(p.x,y.y),y,T),pitchDelta:s?-.5*(y.y-p.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=e,q.addEventListener(r,"mousedown",this.mousedown),q.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHandler.dragStart(e,r),q.disableDrag()}move(e,r){let s=this.map,{bearingDelta:c,pitchDelta:p}=this._rotatePitchHandler.dragMove(e,r)||{};c&&s.setBearing(s.getBearing()+c),p&&s.setPitch(s.getPitch()+p)}off(){let e=this.element;q.removeEventListener(e,"mousedown",this.mousedown),q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let Nt;function mi(h,e,r,s=!1){if(s||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return h?.wrap();let c=new o.S(h.lng,h.lat);if(h=new o.S(h.lng,h.lat),e){let p=new o.S(h.lng-360,h.lat),y=new o.S(h.lng+360,h.lat),w=r.locationToScreenPoint(h).distSqr(e);r.locationToScreenPoint(p).distSqr(e)<w?h=p:r.locationToScreenPoint(y).distSqr(e)<w&&(h=y)}for(;Math.abs(h.lng-r.center.lng)>180;){let p=r.locationToScreenPoint(h);if(p.x>=0&&p.y>=0&&p.x<=r.width&&p.y<=r.height)break;h.lng>r.center.lng?h.lng-=360:h.lng+=360}return h.lng!==c.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(h))?h:c}let ul={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ya(h,e,r){let s=h.classList;for(let c in ul)s.remove(`maplibregl-${r}-anchor-${c}`);s.add(`maplibregl-${r}-anchor-${e}`)}class va extends o.E{constructor(e){if(super(),this._onKeyPress=r=>{let s=r.code,c=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=r=>{let s=r.originalEvent.target,c=this._element;this._popup&&(s===c||c.contains(s))&&this.togglePopup()},this._update=r=>{if(!this._map)return;let s=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!s)&&this._map.once("render",this._update),this._lngLat=mi(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${ul[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`),ne.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){let s=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div");let r=q.createNS("http://www.w3.org/2000/svg","svg"),s=41,c=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${s}px`),r.setAttributeNS(null,"width",`${c}px`),r.setAttributeNS(null,"viewBox",`0 0 ${c} ${s}`);let p=q.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");let y=q.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");let w=q.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");let T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let W of T){let X=q.createNS("http://www.w3.org/2000/svg","ellipse");X.setAttributeNS(null,"opacity","0.04"),X.setAttributeNS(null,"cx","10.5"),X.setAttributeNS(null,"cy","5.80029008"),X.setAttributeNS(null,"rx",W.rx),X.setAttributeNS(null,"ry",W.ry),w.appendChild(X)}let P=q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);let M=q.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(M);let k=q.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");let A=q.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(A);let D=q.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(6.0, 7.0)"),D.setAttributeNS(null,"fill","#FFFFFF");let F=q.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(8.0, 8.0)");let Z=q.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");let G=q.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),F.appendChild(Z),F.appendChild(G),y.appendChild(w),y.appendChild(P),y.appendChild(k),y.appendChild(D),y.appendChild(F),r.appendChild(y),r.setAttributeNS(null,"height",s*this._scale+"px"),r.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(r),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),ya(this._element,this._anchor,"marker"),e&&e.className)for(let r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,s;let c=(r=this._map)===null||r===void 0?void 0:r.terrain,p=this._map.transform.isLocationOccluded(this._lngLat);if(!c||p){let D=p?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==D&&(this._element.style.opacity=D))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let y=this._map,w=y.terrain.depthAtPoint(this._pos),T=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,T)-w<.006)return void(this._element.style.opacity=this._opacity);let P=-this._offset.y/y.transform.pixelsPerMeter,M=Math.sin(y.getPitch()*Math.PI/180)*P,k=y.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),A=y.transform.lngLatToCameraDepth(this._lngLat,T+M)-k>.006;!((s=this._popup)===null||s===void 0)&&s.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}let Uc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},xa=0,Ro=!1,hs={maxWidth:100,unit:"metric"};function hl(h,e,r){let s=r&&r.maxWidth||100,c=h._container.clientHeight/2,p=h._container.clientWidth/2,y=h.unproject([p-s/2,c]),w=h.unproject([p+s/2,c]),T=Math.round(h.project(w).x-h.project(y).x),P=Math.min(s,T,h._container.clientWidth),M=y.distanceTo(w);if(r&&r.unit==="imperial"){let k=3.2808*M;k>5280?Fo(e,P,k/5280,h._getUIString("ScaleControl.Miles")):Fo(e,P,k,h._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Fo(e,P,M/1852,h._getUIString("ScaleControl.NauticalMiles")):M>=1e3?Fo(e,P,M/1e3,h._getUIString("ScaleControl.Kilometers")):Fo(e,P,M,h._getUIString("ScaleControl.Meters"))}function Fo(h,e,r,s){let c=(function(p){let y=Math.pow(10,`${Math.floor(p)}`.length-1),w=p/y;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(T){let P=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*P)/P})(w),y*w})(r);h.style.width=e*(c/r)+"px",h.innerHTML=`${c}&nbsp;${s}`}let Nc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pl(h){if(h){if(typeof h=="number"){let e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,h),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-h),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(h,0),right:new o.P(-h,0)}}if(h instanceof o.P||Array.isArray(h)){let e=o.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(h.center||[0,0]),top:o.P.convert(h.top||[0,0]),"top-left":o.P.convert(h["top-left"]||[0,0]),"top-right":o.P.convert(h["top-right"]||[0,0]),bottom:o.P.convert(h.bottom||[0,0]),"bottom-left":o.P.convert(h["bottom-left"]||[0,0]),"bottom-right":o.P.convert(h["bottom-right"]||[0,0]),left:o.P.convert(h.left||[0,0]),right:o.P.convert(h.right||[0,0])}}return pl(new o.P(0,0))}let $c=C;_.AJAXError=o.cz,_.Event=o.l,_.Evented=o.E,_.LngLat=o.S,_.MercatorCoordinate=o.a1,_.Point=o.P,_.addProtocol=o.cA,_.config=o.a,_.removeProtocol=o.cB,_.AttributionControl=jc,_.BoxZoomHandler=kc,_.CanvasSource=$r,_.CooperativeGesturesHandler=lh,_.DoubleClickZoomHandler=zc,_.DragPanHandler=ah,_.DragRotateHandler=Fc,_.EdgeInsets=wo,_.FullscreenControl=class extends o.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let h=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},_.GeoJSONSource=hr,_.GeolocateControl=class extends o.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{let r=new o.S(e.coords.longitude,e.coords.latitude),s=e.coords.accuracy,c=this._map.getBearing(),p=o.e({bearing:c},this.options.fitBoundsOptions),y=hi.fromLngLat(r,s);this._map.fitBounds(y,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let r=new o.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ro)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{let r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new va({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new va({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{let s=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},Uc,h)}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,function*(e=!1){if(Nt!==void 0&&!e)return Nt;if(window.navigator.permissions===void 0)return Nt=!!window.navigator.geolocation,Nt;try{Nt=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Nt=!!window.navigator.geolocation}return Nt})})().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xa=0,Ro=!1}_isOutOfMapMaxBounds(h){let e=this._map.getMaxBounds(),r=h.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let h=this._map.getBounds(),e=h.getSouthEast(),r=h.getNorthEast(),s=e.distanceTo(r),c=Math.ceil(this._accuracy/(s/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xa--,Ro=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xa++,xa>1?(h={maximumAge:6e5,timeout:0},Ro=!0):(h=this.options.positionOptions,Ro=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},_.GlobeControl=class{constructor(){this._toggleProjection=()=>{var h;let e=(h=this._map.getProjection())===null||h===void 0?void 0:h.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var h;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((h=this._map.getProjection())===null||h===void 0?void 0:h.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=q.create("button","maplibregl-ctrl-globe",this._container),q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},_.Hash=il,_.ImageSource=pr,_.KeyboardHandler=ol,_.LngLatBounds=hi,_.LogoControl=uh,_.Map=class extends ch{constructor(h){var e,r;o.cw.mark(o.cx.create);let s=Object.assign(Object.assign(Object.assign({},Fn),h),{canvasContextAttributes:Object.assign(Object.assign({},Fn.canvasContextAttributes),h.canvasContextAttributes)});if(s.minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let c=new Wt,p=new Yi;if(s.minZoom!==void 0&&c.setMinZoom(s.minZoom),s.maxZoom!==void 0&&c.setMaxZoom(s.maxZoom),s.minPitch!==void 0&&c.setMinPitch(s.minPitch),s.maxPitch!==void 0&&c.setMaxPitch(s.maxPitch),s.renderWorldCopies!==void 0&&c.setRenderWorldCopies(s.renderWorldCopies),super(c,p,{bearingSnap:s.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new yr,this._controls=[],this._mapId=o.a7(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._maxTileCacheZoomLevels=s.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},s.canvasContextAttributes),this._trackResize=s.trackResize===!0,this._bearingSnap=s.bearingSnap,this._centerClampedToGround=s.centerClampedToGround,this._refreshExpiredTiles=s.refreshExpiredTiles===!0,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions===!0,this._collectResourceTiming=s.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},an),s.locale),this._clickTolerance=s.clickTolerance,this._overridePixelRatio=s.pixelRatio,this._maxCanvasSize=s.maxCanvasSize,this.transformCameraUpdate=s.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=s.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=nt.addThrottleControl(()=>this.isMoving()),this._requestManager=new vt(s.transformRequest),typeof s.container=="string"){if(this._container=document.getElementById(s.container),!this._container)throw new Error(`Container '${s.container}' not found.`)}else{if(!(s.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1,T=Do(P=>{this._trackResize&&!this._removed&&(this.resize(P),this.redraw())},50);this._resizeObserver=new ResizeObserver(P=>{w?T(P):w=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Bc(this,s),this._hash=s.hash&&new il(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,elevation:s.elevation,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch,roll:s.roll}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,o.e({},s.fitBoundsOptions,{duration:0}))));let y=typeof s.style=="string"||((r=(e=s.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=s.localIdeographFontFamily,this._validateStyle=s.validateStyle,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new jc(typeof s.attributionControl=="boolean"?void 0:s.attributionControl)),s.maplibreLogo&&this.addControl(new uh,s.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){let w=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}}),this.on("data",w=>{this._update(w.dataType==="style"),this.fire(new o.l(`${w.dataType}data`,w))}),this.on("dataloading",w=>{this.fire(new o.l(`${w.dataType}dataloading`,w))}),this.on("dataabort",w=>{this.fire(new o.l("sourcedataabort",w))})}_getMapId(){return this._mapId}setGlobalStateProperty(h,e){return this.style.setGlobalStateProperty(h,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let r=h.onAdd(this);this._controls.push(h);let s=this._controlPositions[e];return e.indexOf("bottom")!==-1?s.insertBefore(r,s.firstChild):s.appendChild(r),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}coveringTiles(h){return pe(this.transform,h)}calculateCameraOptionsFromTo(h,e,r,s){return s==null&&this.terrain&&(s=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,r,s)}resize(h,e=!0){let[r,s]=this._containerDimensions(),c=this._getClampedPixelRatio(r,s);if(this._resizeCanvas(r,s,c),this.painter.resize(r,s,c),this.painter.overLimit()){let y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];let w=this._getClampedPixelRatio(r,s);this._resizeCanvas(r,s,w),this.painter.resize(r,s,w)}this._resizeTransform(e);let p=!this._moving;return p&&(this.stop(),this.fire(new o.l("movestart",h)).fire(new o.l("move",h))),this.fire(new o.l("resize",h)),p&&this.fire(new o.l("moveend",h)),this}_resizeTransform(h=!0){var e;let[r,s]=this._containerDimensions();this.transform.resize(r,s,h),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,s,h)}_getClampedPixelRatio(h,e){let{0:r,1:s}=this._maxCanvasSize,c=this.getPixelRatio(),p=h*c,y=e*c;return Math.min(p>r?r/p:1,y>s?s/y:1)*c}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(hi.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.setMinZoom(h),this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.setMaxZoom(h),this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.setMinPitch(h),this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(h>=this.transform.minPitch)return this.transform.setMaxPitch(h),this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.setRenderWorldCopies(h),this._update()}project(h){return this.transform.locationToScreenPoint(o.S.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.screenPointToLocation(o.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,r){if(h==="mouseenter"||h==="mouseover"){let s=!1;return{layers:e,listener:r,delegates:{mousemove:p=>{let y=e.filter(T=>this.getLayer(T)),w=y.length!==0?this.queryRenderedFeatures(p.point,{layers:y}):[];w.length?s||(s=!0,r.call(this,new _n(h,this,p.originalEvent,{features:w}))):s=!1},mouseout:()=>{s=!1}}}}if(h==="mouseleave"||h==="mouseout"){let s=!1;return{layers:e,listener:r,delegates:{mousemove:y=>{let w=e.filter(T=>this.getLayer(T));(w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[]).length?s=!0:s&&(s=!1,r.call(this,new _n(h,this,y.originalEvent)))},mouseout:y=>{s&&(s=!1,r.call(this,new _n(h,this,y.originalEvent)))}}}}{let s=c=>{let p=e.filter(w=>this.getLayer(w)),y=p.length!==0?this.queryRenderedFeatures(c.point,{layers:p}):[];y.length&&(c.features=y,r.call(this,c),delete c.features)};return{layers:e,listener:r,delegates:{[h]:s}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,r){if(!this._delegatedListeners||!this._delegatedListeners[h])return;let s=this._delegatedListeners[h];for(let c=0;c<s.length;c++){let p=s[c];if(p.listener===r&&p.layers.length===e.length&&p.layers.every(y=>e.includes(y))){for(let y in p.delegates)this.off(y,p.delegates[y]);return void s.splice(c,1)}}}on(h,e,r){if(r===void 0)return super.on(h,e);let s=typeof e=="string"?[e]:e,c=this._createDelegatedListener(h,s,r);this._saveDelegatedListener(h,c);for(let p in c.delegates)this.on(p,c.delegates[p]);return{unsubscribe:()=>{this._removeDelegatedListener(h,s,r)}}}once(h,e,r){if(r===void 0)return super.once(h,e);let s=typeof e=="string"?[e]:e,c=this._createDelegatedListener(h,s,r);for(let p in c.delegates){let y=c.delegates[p];c.delegates[p]=(...w)=>{this._removeDelegatedListener(h,s,r),y(...w)}}this._saveDelegatedListener(h,c);for(let p in c.delegates)this.once(p,c.delegates[p]);return this}off(h,e,r){return r===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let r,s=h instanceof o.P||Array.isArray(h),c=s?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(s?{}:h)||{},c instanceof o.P||typeof c[0]=="number")r=[o.P.convert(c)];else{let p=o.P.convert(c[0]),y=o.P.convert(c[1]);r=[p,new o.P(y.x,p.y),y,new o.P(p.x,y.y),p]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){let e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){var r,s;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(h,e));let c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new ac(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,c):this.style.loadJSON(h,e,c),this):((s=(r=this.style)===null||r===void 0?void 0:r.projection)===null||s===void 0||s.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ac(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){let r=this._requestManager.transformRequest(h,"Style");o.j(r,new AbortController).then(s=>{this._updateDiff(s.data,e)}).catch(s=>{s&&this.fire(new o.k(s))})}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(r){o.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){let e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new o.k(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){let e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(let r in this.style._layers){let s=this.style._layers[r];s.type==="hillshade"&&s.source===h.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),s.type==="color-relief"&&s.source===h.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new it(this.painter,e,h),this.painter.renderToTexture=new cl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var s;r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==h.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((s=r.source)===null||s===void 0?void 0:s.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let h=this.style&&this.style.sourceCaches;for(let e in h){let r=h[e]._tiles;for(let s in r){let c=r[s];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}setSourceTileLodParams(h,e,r){if(r){let s=this.getSource(r);if(!s)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);s.calculateTileZoom=ke(Math.max(1,h),Math.max(1,e))}else for(let s in this.style.sourceCaches)this.style.sourceCaches[s].getSource().calculateTileZoom=ke(Math.max(1,h),Math.max(1,e));return this._update(!0),this}refreshTiles(h,e){let r=this.style.sourceCaches[h];if(!r)throw new Error(`There is no source cache with ID "${h}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map(s=>new o.a4(s.z,s.x,s.y)))}addImage(h,e,r={}){let{pixelRatio:s=1,sdf:c=!1,stretchX:p,stretchY:y,content:w,textFitWidth:T,textFitHeight:P}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:M,height:k,data:A}=e,D=e;return this.style.addImage(h,{data:new o.R({width:M,height:k},new Uint8Array(A)),pixelRatio:s,stretchX:p,stretchY:y,content:w,textFitWidth:T,textFitHeight:P,sdf:c,version:0,userImage:D}),D.onAdd&&D.onAdd(this,h),this}}{let{width:M,height:k,data:A}=ne.getImageData(e);this.style.addImage(h,{data:new o.R({width:M,height:k},A),pixelRatio:s,stretchX:p,stretchY:y,content:w,textFitWidth:T,textFitHeight:P,sdf:c,version:0})}}updateImage(h,e){let r=this.style.getImage(h);if(!r)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let s=e instanceof HTMLImageElement||o.b(e)?ne.getImageData(e):e,{width:c,height:p,data:y}=s;if(c===void 0||p===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==r.data.width||p!==r.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let w=!(e instanceof HTMLImageElement||o.b(e));return r.data.replace(y,w),this.style.updateImage(h,r),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return nt.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,r){return this.style.setLayerZoomRange(h,e,r),this._update(!0)}setFilter(h,e,r={}){return this.style.setFilter(h,e,r),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,r,s={}){return this.style.setPaintProperty(h,e,r,s),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,r,s={}){return this.style.setLayoutProperty(h,e,r,s),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,r,s=>{s||this._update(!0)}),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,r=>{r||this._update(!0)}),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(h,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){let h=this._container;h.classList.add("maplibregl-map");let e=this._canvasContainer=q.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let r=this._containerDimensions(),s=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],s);let c=this._controlContainer=q.create("div","maplibregl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{p[y]=q.create("div",`maplibregl-ctrl-${y} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,r){this._canvas.width=Math.floor(r*h),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let h=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",s=>{e={requestedAttributes:h},s&&(e.statusMessage=s.statusMessage,e.type=s.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,h):this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h),!r){let s="Failed to initialize WebGL";throw e?(e.message=s,new Error(JSON.stringify(e))):new Error(s)}this.painter=new Xu(r,this.transform),Ce.testSupport(r)}migrateProjection(h,e){super.migrateProjection(h,e),this.painter.transform=h,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){var e,r,s,c,p;let y=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let k=this.transform.zoom,A=ne.now();this.style.zoomHistory.update(k,A);let D=new o.F(k,{now:A,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),F=D.crossFadingFactor();F===1&&F===this._crossFadingFactor||(T=!0,this._crossFadingFactor=F),this.style.update(D)}let P=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==w;(s=this.style.projection)===null||s===void 0||s.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(p=this.style.projection)===null||p===void 0?void 0:p.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||P)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,P),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cw.mark(o.cx.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let M=this._sourcesDirty||this._styleDirty||this._placementDirty;return M||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,o.cw.mark(o.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(let r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),nt.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cw.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ne.frame(this._frameRequest,h=>{o.cw.frame(h),this._frameRequest=null;try{this._render(h)}catch(e){if(!o.cy(e)&&!(function(r){return r.message===es})(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return hh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),this.style.setProjection(h),this._update(!0)}},_.MapMouseEvent=_n,_.MapTouchEvent=ha,_.MapWheelEvent=Ac,_.Marker=va,_.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{let e=this._map.getZoom(),r=e===this._map.getMaxZoom(),s=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{let s=this._map._getUIString(`NavigationControl.${r}`);e.title=s,e.setAttribute("aria-label",s)},this.options=o.e({},zp,h),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new us(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){let r=q.create("button",h,this._container);return r.type="button",r.addEventListener("click",e),r}},_.Popup=class extends o.E{constructor(h){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=mi(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;let r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let s=this.options.anchor,c=pl(this.options.offset);if(!s){let y=this._container.offsetWidth,w=this._container.offsetHeight,T;T=r.y+c.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<y/2?T.push("left"):r.x>this._map.transform.width-y/2&&T.push("right"),s=T.length===0?"bottom":T.join("-")}let p=r.add(c[s]);this.options.subpixelPositioning||(p=p.round()),q.setTransform(this._container,`${ul[s]} translate(${p.x}px,${p.y}px)`),ya(this._container,s,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Nc),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=o.S.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){let e=document.createDocumentFragment(),r=document.createElement("body"),s;for(r.innerHTML=h;s=r.firstChild,s;)e.appendChild(s);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let h=this._container.querySelector(Vc);h&&h.focus()}},_.RasterDEMTileSource=_o,_.RasterTileSource=ur,_.ScaleControl=class{constructor(h){this._onMove=()=>{hl(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,hl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},hs),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},_.ScrollZoomHandler=rh,_.Style=ac,_.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},_.TwoFingersTouchPitchHandler=rl,_.TwoFingersTouchRotateHandler=ga,_.TwoFingersTouchZoomHandler=nl,_.TwoFingersTouchZoomRotateHandler=sh,_.VectorTileSource=Gn,_.VideoSource=Yo,_.addSourceType=(h,e)=>o._(void 0,void 0,void 0,function*(){if(Zr(h))throw new Error(`A source type called "${h}" already exists.`);((r,s)=>{Gr[r]=s})(h,e)}),_.clearPrewarmedResources=function(){let h=cr;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Nr),cr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},_.createTileMesh=rc,_.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},_.getRTLTextPluginStatus=function(){return Hr().getRTLTextPluginStatus()},_.getVersion=function(){return $c},_.getWorkerCount=function(){return Xi.workerCount},_.getWorkerUrl=function(){return o.a.WORKER_URL},_.importScriptInWorkers=function(h){return Ho().broadcast("IS",h)},_.prewarm=function(){go().acquire(Nr)},_.setMaxParallelImageRequests=function(h){o.a.MAX_PARALLEL_IMAGE_REQUESTS=h},_.setRTLTextPlugin=function(h,e){return Hr().setRTLTextPlugin(h,e)},_.setWorkerCount=function(h){Xi.workerCount=h},_.setWorkerUrl=function(h){o.a.WORKER_URL=h}});var x=g;return x})});var ar=(function(g){return g[g.VERBOSE=0]="VERBOSE",g[g.INFO=1]="INFO",g[g.WARNING=2]="WARNING",g[g.ERROR=3]="ERROR",g})(ar||{}),bn=(()=>{class g{logLevel;constructor(){this.logLevel=ar.VERBOSE,Ea.production&&(this.logLevel=ar.INFO)}log(u,x=ar.VERBOSE){console&&console.log&&x>=this.logLevel&&console.log("["+ar[x]+"] {"+new Date().toLocaleTimeString()+"} "+u)}static \u0275fac=function(x){return new(x||g)};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var Gh=(()=>{class g{http;logging;referenceData;filteredReferenceData;constructor(u,x){this.http=u,this.logging=x,this.loadCachedRefData()}refreshReferenceData(u){return st(this,null,function*(){try{let x=yield u.fetchCoreReferenceData(null).toPromise();return this.setCoreReferenceData(x),this.setFilteredReferenceData(x),this.logging.log("Got refreshed core ref data.",ar.VERBOSE),this.sortCoreReferenceData(),this.cacheCurrentRefData(),!0}catch(x){return this.logging.log("Error fetching core ref data:"+x),!1}})}refreshFilteredReferenceData(u,x){u.fetchCoreReferenceData(x).subscribe(_=>{this.setFilteredReferenceData(_),this.sortCoreReferenceData(),this.logging.log("Got refreshed filtered reference data.",ar.VERBOSE)},_=>{this.logging.log("Error fetching filtered reference data:"+_)})}setCoreReferenceData(u){this.referenceData=u}setFilteredReferenceData(u){this.filteredReferenceData=u}referenceDataLoaded(){return this.referenceData!=null}getCountries(u=!1){return u==!0?this.filteredReferenceData.Countries:this.referenceData.Countries}getCountryByID(u){return this.getRefDataByID(this.referenceData.Countries,u)}getConnectionTypes(u=!1){return u==!0?this.filteredReferenceData.ConnectionTypes:this.referenceData.ConnectionTypes}getConnectionTypeByID(u){return this.getRefDataByID(this.referenceData.ConnectionTypes,u)}getUsageTypes(u=!1){return u==!0?this.filteredReferenceData.UsageTypes:this.referenceData.UsageTypes.filter(x=>x.ID>0)}getUsageTypeByID(u){return this.getRefDataByID(this.referenceData.UsageTypes,u)}getStatusTypes(u=!1){return u==!0?this.filteredReferenceData.StatusTypes:this.referenceData.StatusTypes.filter(x=>x.ID>0)}getStatusTypeByID(u){return this.getRefDataByID(this.referenceData.StatusTypes,u)}getNetworkOperators(u=!1){return u==!0?this.filteredReferenceData.Operators:this.referenceData.Operators}getNetworkOperatorByID(u){return this.getRefDataByID(this.referenceData.Operators,u)}getDataProviders(u=!1){return u==!0?this.filteredReferenceData.DataProviders:this.referenceData.DataProviders}getDataProviderByID(u){return this.getRefDataByID(this.referenceData.DataProviders,u)}getCheckinStatusTypes(u=!1,x=!0){let _=null;return u==!0?_=this.filteredReferenceData.CheckinStatusTypes:_=this.referenceData.CheckinStatusTypes,x&&(_=_.filter(o=>o.IsAutomatedCheckin===!1)),_}getCheckinStatusTypeByID(u){return this.getRefDataByID(this.referenceData.CheckinStatusTypes,u)}getCommentTypes(u=!1,x=!0){let _;return u==!0?_=this.filteredReferenceData.UserCommentTypes:_=this.referenceData.UserCommentTypes,x&&(_=_.filter(o=>o.ID!==100&&o.ID!==110)),_}getCommentTypeByID(u){return this.getRefDataByID(this.referenceData.UserCommentTypes,u)}getSubmissionStatusTypes(u=!1){return u==!0?this.filteredReferenceData.SubmissionStatusTypes:this.referenceData.SubmissionStatusTypes}getSubmissionStatusTypesByID(u){return this.getRefDataByID(this.referenceData.SubmissionStatusTypes,u)}getChargingLevelTypes(u=!1){return u==!0?this.filteredReferenceData.ChargerTypes:this.referenceData.ChargerTypes}getChargingLevelTypeByID(u){return this.getRefDataByID(this.referenceData.ChargerTypes,u)}getOutputCurrentTypes(u=!1){return u?this.referenceData.CurrentTypes:this.filteredReferenceData.CurrentTypes}getOutputCurrentTypeByID(u){return this.getRefDataByID(this.referenceData.CurrentTypes,u)}loadCachedRefData(){let u=localStorage.getItem("referenceData");if(u==null)this.http.get("./assets/data/CoreReferenceData.json").subscribe(x=>{this.logging.log("Using bundled reference data as cached ref data."),this.setCoreReferenceData(x),this.setFilteredReferenceData(x)});else{let x=JSON.parse(u);this.setCoreReferenceData(x)}this.setFilteredReferenceData(this.referenceData)}cacheCurrentRefData(){this.referenceData!=null&&(this.referenceData.CacheDate=new Date,localStorage.setItem("referenceData",JSON.stringify(this.referenceData)))}getRefDataByID(u,x){if(x!==""&&(x=parseInt(x,10)),u!=null){for(let _=0;_<u.length;_++)if(u[_].ID===x)return u[_]}return null}sortCoreReferenceData(){this.sortReferenceData(this.referenceData.ConnectionTypes),this.sortReferenceData(this.referenceData.Countries),this.sortReferenceData(this.referenceData.Operators),this.sortReferenceData(this.referenceData.DataProviders),this.sortReferenceData(this.referenceData.UsageTypes),this.sortReferenceData(this.referenceData.StatusTypes),this.sortReferenceData(this.referenceData.CheckinStatusTypes),this.sortReferenceData(this.referenceData.SubmissionStatusTypes),this.filteredReferenceData&&(this.sortReferenceData(this.filteredReferenceData.ConnectionTypes),this.sortReferenceData(this.filteredReferenceData.Operators))}sortReferenceData(u){u.sort(this.sortListByTitle)}sortListByTitle(u,x){return u.Title<x.Title?-1:u.Title>x.Title?1:0}getMetadataValueByMetadataFieldID(u,x){if(x!==""&&(x=parseInt(x,10)),u!=null){for(let _=0;_<u.length;_++)if(u[_].ID===x)return u[_]}return null}hydrateCompactPOI(u,x=!1){let _=this;if(u.DataProviderID!=null&&(x||u.DataProvider==null)&&(u.DataProvider=_.getDataProviderByID(u.DataProviderID)),u.OperatorID!=null&&(x||u.OperatorInfo==null)&&(u.OperatorInfo=_.getNetworkOperatorByID(u.OperatorID)),u.UsageTypeID!=null&&(x||u.UsageType==null)&&(u.UsageType=_.getUsageTypeByID(u.UsageTypeID)),u.AddressInfo.CountryID!=null&&(x||u.AddressInfo.Country==null)&&(u.AddressInfo.Country=_.getCountryByID(u.AddressInfo.CountryID)),u.StatusTypeID!=null&&(x||u.StatusType==null)&&(u.StatusType=_.getStatusTypeByID(u.StatusTypeID)),u.SubmissionStatusTypeID!=null&&(x||u.SubmissionStatusType==null)&&(u.SubmissionStatusType=_.getSubmissionStatusTypesByID(u.SubmissionStatusTypeID)),u.Connections!=null)for(let o=0;o<u.Connections.length;o++){let C=u.Connections[o];C.ConnectionTypeID!=null&&(x||C.ConnectionType==null)&&(C.ConnectionType=_.getConnectionTypeByID(C.ConnectionTypeID)),C.LevelID!=null&&(x||C.Level==null)&&(C.Level=_.getChargingLevelTypeByID(C.LevelID)),C.CurrentTypeID!=null&&(x||C.CurrentType==null)&&(C.CurrentType=_.getOutputCurrentTypeByID(C.CurrentTypeID)),C.StatusTypeID!=null&&(x||C.StatusType==null)&&(C.StatusType=_.getStatusTypeByID(C.StatusTypeID)),u.Connections[o]=C}if(u.UserComments!=null)for(let o=0;o<u.UserComments.length;o++){let C=u.UserComments[o];C.CommentTypeID!=null&&(x||C.CommentType==null)&&(C.CommentType=_.getCommentTypeByID(C.CommentTypeID)),C.CheckinStatusTypeID!=null&&(x||C.CheckinStatusType==null)&&(C.CheckinStatusType=_.getCheckinStatusTypeByID(C.CheckinStatusTypeID)),u.UserComments[o]=C}return u}hydrateCompactPOIList(u){for(let x=0;x<u.length;x++)u[x]=this.hydrateCompactPOI(u[x]);return u}static \u0275fac=function(x){return new(x||g)(ii($o),ii(bn))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var rg=class{ID;SubmissionType;Data;Attempts;DateQueued;IsSubmitted;IsInProgress;IsCancelled;IsFailure;FailureReason;constructor(m,u){this.SubmissionType=m,this.Data=u,this.DateQueued=new Date,this.IsSubmitted=!1,this.IsInProgress=!1,this.IsCancelled=!1,this.IsFailure=!1,this.Attempts=0,this.ID=new Date+"_"+Math.random()*100}};var Al=(function(g){return g[g.POI=0]="POI",g[g.Comment=1]="Comment",g[g.Media=2]="Media",g})(Al||{});var og=class g{itemType;itemId;version;schemaVersion;syncTimeStamp;constructor(m,u){this.itemType=m,this.itemId=g.getNewItemId(),this.version=1,this.schemaVersion=u,this.syncTimeStamp=g.getNewSyncTimeStamp()}static getNewSyncTimeStamp(){return Date.now().toString()}static getNewItemId(){return"_syncitem_"+Date.now().toString()}};var im=class{Title;Notes;_sync;constructor(m,u){this._sync=new og(m,u)}},Id=class extends im{PoiID;Type;Poi;Photos},Ah=class extends im{Stage;Position;PoiIDs;PoiList;constructor(){super("waypoint",1)}},Pd=class extends im{WayPoints;constructor(){super("journey_stage",1),this.WayPoints=[]}},Zh=class extends im{ID;Stages;constructor(){super("journey",1),this.ID=""+Date.now(),this.Stages=[]}},ag=class{Title;DistanceKM;DurationMinutes;StartElevation;EndElevation;EnergyConsumptionkWh},sg=class{Title;JourneyRouteLegs;TotalDistanceKM;TotalDurationMinutes;TotalEnergykWh};var su=class{Location;Title;Address;Type;ReferenceID;Attribution;AddressInfo};var Un=class{altitudeAccuracy;longitude;latitude;speed;heading;altitude;accuracy;constructor(m=null,u=null){this.latitude=m,this.longitude=u}toJSON(){JSON.stringify({latitude:this.latitude,longitude:this.longitude,altitude:this.altitude,accuracy:this.accuracy,altitudeAccuracy:this.altitudeAccuracy,speed:this.speed,heading:this.heading})}},Nl=class g{coords;timestamp;attribution;constructor(m=null,u=null){this.coords=new Un,this.coords.latitude=m,this.coords.longitude=u}static fromPosition(m){return new g(m.coords.latitude,m.coords.longitude)}},lg=class{northEast;southWest;constructor(m,u){this.northEast=m,this.southWest=u}};var nm=class{OperatorList;ConnectionTypeList;CountryList;UsageTypeList;StatusTypeList;MinPowerKW;MaxPowerKW;UseDistanceInKM;HasActiveFilters;LastSearchPosition;StartSearchPosition;StartViewPoiId;Language;FilterOptionsByCountryId;MapType;EnableAdvancedEditorFeatures;EnablePOIPendingApproval;MaxResults;constructor(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MaxPowerKW=null,this.MinPowerKW=null,this.HasActiveFilters=!1,this.FilterOptionsByCountryId=null,this.UseDistanceInKM=!0,this.MapType="ROADMAP",this.EnableAdvancedEditorFeatures=!1,this.EnablePOIPendingApproval=!1,this.MaxResults=500}LoadSettings(){}SaveSettings(){}ClearActiveFilters(){this.OperatorList=[],this.ConnectionTypeList=[],this.CountryList=[],this.UsageTypeList=[],this.StatusTypeList=[],this.MinPowerKW=null,this.MaxPowerKW=null}CheckForActiveFilters(){return this.OperatorList.length>0||this.ConnectionTypeList.length>0||this.CountryList.length>0||this.UsageTypeList.length>0||this.StatusTypeList.length>0||this.MinPowerKW>0||this.MaxPowerKW>0||this.MaxPowerKW!=null&&this.MaxPowerKW<1e3?this.HasActiveFilters=!0:this.HasActiveFilters=!1,this.HasActiveFilters}};var qh=class{poiIdList=null;countryCode=null;latitude=null;longitude=null;locationTitle=null;distance=null;distanceUnit=null;connectionTypeIdList=null;operatorIdList=null;levelIdList=null;countryIdList=null;usageTypeIdList=null;statusTypeIdList=null;minPowerKW=null;maxPowerKW=null;submissionStatusTypeIdList=null;maxResults=500;additionalParams=null;includeComments=!1;compact=!0;enableCaching=!0;levelOfDetail=1;polyline=null;boundingbox=null};var rm=(()=>{class g{http;refData;logging;serviceBase="https://api.openchargemap.io";serviceBaseURL=this.serviceBase+"/v4";hasAuthorizationError=!1;ATTRIBUTION_METADATAFIELDID=4;authResponse;clientName="ocm.api.default";authorizationErrorCallback;generalErrorCallback;allowMirror=!1;lastPOIApiCallURL="";constructor(u,x,_){this.http=u,this.refData=x,this.logging=_,this.serviceBaseURL=Ea.apiBase+"/v3"}getNumberListString(u){let x="";for(let _=0;_<u.length;_++)x+=u[_],_<u.length&&(x+=",");return x}fetchPOIListByParam(u){return st(this,null,function*(){let x=this.serviceBaseURL+"/poi/?client="+this.clientName+(this.allowMirror?" &allowmirror=true":"")+"&verbose=false&output=json";u.compact=!0;let _="";u.countryCode!=null&&(_+="&countrycode="+u.countryCode),u.latitude!=null&&(_+="&latitude="+u.latitude),u.longitude!=null&&(_+="&longitude="+u.longitude),u.distance!=null&&(_+="&distance="+u.distance),u.distanceUnit!=null&&(_+="&distanceunit="+u.distanceUnit),u.includeComments!=null&&(_+="&includecomments="+u.includeComments),u.maxResults!=null&&(_+="&maxresults="+u.maxResults),u.countryIdList!=null&&(_+="&countryid="+this.getNumberListString(u.countryIdList)),u.levelIdList!=null&&(_+="&levelid="+this.getNumberListString(u.levelIdList)),u.connectionTypeIdList!=null&&u.connectionTypeIdList.length>0&&(_+="&connectiontypeid="+this.getNumberListString(u.connectionTypeIdList)),u.operatorIdList!=null&&u.operatorIdList.length>0&&(_+="&operatorid="+this.getNumberListString(u.operatorIdList)),u.usageTypeIdList!=null&&u.usageTypeIdList.length>0&&(_+="&usagetypeid="+this.getNumberListString(u.usageTypeIdList)),u.statusTypeIdList!=null&&u.statusTypeIdList.length>0&&(_+="&statustypeid="+this.getNumberListString(u.statusTypeIdList)),u.locationTitle!=null&&(_+="&locationtitle="+u.locationTitle),u.minPowerKW!=null&&u.minPowerKW>0&&(_+="&minpowerkw="+u.minPowerKW),u.maxPowerKW!=null&&u.maxPowerKW>0&&(_+="&maxpowerkw="+u.maxPowerKW),u.submissionStatusTypeIdList!=null&&(_+="&submissionstatustypeid="+this.getNumberListString(u.submissionStatusTypeIdList)),u.poiIdList!=null&&u.poiIdList.length>0&&(_+="&chargepointid="+this.getNumberListString(u.poiIdList)),u.enableCaching==!1&&(_+="&enablecaching=false"),u.compact!=null&&(_+="&compact="+u.compact),u.levelOfDetail>1&&(_+="&levelofdetail="+u.levelOfDetail),u.polyline!=null&&(_+="&polyline="+u.polyline),u.boundingbox!=null&&(_+="&boundingbox="+u.boundingbox),u.additionalParams!=null&&(_+="&"+u.additionalParams);let o=x+_;if(this.lastPOIApiCallURL!==o||u.enableCaching==!1){this.lastPOIApiCallURL=o,this.logging.log("API Call:"+o,ar.VERBOSE);try{let C=yield this.http.get(o,this.getHttpRequestOptions()).toPromise();return this.refData.hydrateCompactPOIList(C)}catch(C){let B=C.message||"Could not fetch POI list from server.";throw this.logging.log("API Client: "+JSON.stringify(C),ar.ERROR),B}}else return this.logging.log("Skipped API call due to same query being repeated."),[]})}getHttpRequestOptions(u=!0){let x=new $1;return u&&(x=x.append("Content-Type","application/json")),this.authResponse&&this.authResponse.Data&&this.authResponse.Data.access_token&&(x=x.append("Authorization","Bearer "+this.authResponse.Data.access_token)),x=x.append("X-API-Key",Ea.apiKey),{headers:x}}fetchCoreReferenceData(u){let x=this.serviceBaseURL+"/referencedata/?client="+this.clientName+"&output=json"+(this.allowMirror?"&allowmirror=true":"")+"&verbose=false&compact=true";return u!=null&&u.CountryIds!=null&&(x+="&countryid="+this.getNumberListString(u.CountryIds)),this.logging.log("API Call:"+x,ar.VERBOSE),this.http.get(x,this.getHttpRequestOptions())}performSignIn(u,x){let _=this.serviceBaseURL+"/profile/authenticate/",o={emailaddress:u,password:x};return this.http.post(_,JSON.stringify(o),this.getHttpRequestOptions()).toPromise().then(C=>(this.authResponse=C,this.authResponse))}performRegister(u,x,_){let o=this.serviceBaseURL+"/profile/register/",C={username:u,emailaddress:x,password:_};return this.http.post(o,JSON.stringify(C),this.getHttpRequestOptions()).toPromise().then(B=>(this.authResponse=B,this.authResponse))}performSubmission(u,x){if(u===Al.POI)return this.submitPOI(x);if(u===Al.Comment)return this.submitUserComment(x);if(u===Al.Media)return this.submitMediaItem(x)}submitUserComment(u){let x=JSON.stringify(u);return this.logging.log("[api] Submitting user comment"),this.http.post(this.serviceBaseURL+"/comment/",x,this.getHttpRequestOptions()).toPromise()}submitMediaItem(u){let x=JSON.stringify(u);return this.http.post(this.serviceBaseURL+"/mediaitem/",x,this.getHttpRequestOptions()).toPromise()}submitPOI(u){let x=JSON.stringify(u);return this.http.post(this.serviceBaseURL+"/poi/",x,this.getHttpRequestOptions()).toPromise()}getPanoramioLocationPhotos(u){return new Promise(x=>{let o="https://www.panoramio.com/map/get_panoramas.php?set=public&from=0&to=2&minx="+(u.longitude-.001)+"&miny="+(u.latitude-.001)+"&maxx="+(u.longitude+.001)+"maxy="+(u.latitude+.001)+"&size=medium&mapfilter=true&callback=?";return console.log(o),this.http.get(o).toPromise()})}fetchReverseGeocodeResult(u,x){let _=this.serviceBaseURL+"/geocode/?client="+this.clientName+"&output=json&camelcase=false&latitude="+u+"&longitude="+x;return this.http.get(_,this.getHttpRequestOptions()).toPromise()}isLocalStorageAvailable(){return typeof window.localStorage<"u"}setCachedDataObject(u,x){this.isLocalStorageAvailable()&&(typeof x>"u"&&(x=null),x===null?localStorage.removeItem(u):localStorage.setItem(u,JSON.stringify(x)))}getCachedDataObject(u){if(this.isLocalStorageAvailable()){let x=localStorage.getItem(u);if(x!=null&&x.length>0)return JSON.parse(x)}return null}static \u0275fac=function(x){return new(x||g)(ii($o),ii(Gh),ii(bn))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var Ba=(()=>{class g{c=new Map;constructor(){}subscribe(u,...x){let _=this.c.get(u);_||this.c.set(u,_=[]),_.push(...x)}unsubscribe(u,x){if(!x)return this.c.delete(u);let _=this.c.get(u);if(!_)return!1;let o=_.indexOf(x);return o<0?!1:(_.splice(o,1),_.length===0&&this.c.delete(u),!0)}publish(u,...x){let _=this.c.get(u);return _?_.map(o=>{try{return o(...x)}catch(C){return console.error(C),null}}):null}static \u0275fac=function(x){return new(x||g)};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var t_=(()=>{class g{logger;platform;isCordova=!1;ga=null;constructor(u,x){this.logger=u,this.platform=x,x.is("cordova")||x.is("capacitor")?this.isCordova=!0:this.isCordova=!1}init(u){return st(this,null,function*(){this.isCordova&&this.ga?yield this.ga.startTrackerWithId(u):this.logger.log("Could not initialise analytics")})}setAppVersion(u){return st(this,null,function*(){if(this.isCordova&&this.ga)return this.ga.setAppVersion(u);this.logger.log(u)})}appEvent(u,x){return st(this,null,function*(){if(this.isCordova&&this.ga)return this.ga.trackEvent(u,x);this.logger.log(x)})}viewEvent(u){return st(this,null,function*(){if(this.isCordova&&this.ga)return this.ga.trackView(u);this.logger.log(u)})}static \u0275fac=function(x){return new(x||g)(ii(bn),ii(Zd))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var om=(()=>{class g{api;events;logging;analytics;poiList;isRequestInProgress=!1;constructor(u,x,_,o){this.api=u,this.events=x,this.logging=_,this.analytics=o}refreshPOIList(u){return st(this,null,function*(){try{return this.poiList=yield this.fetchPOIList(u),this.events.publish("ocm:poiList:updated"),this.analytics.appEvent("Search","Fetched Results"),this.poiList.length}catch{return 0}})}fetchPOIList(u){return st(this,null,function*(){this.isRequestInProgress=!0;try{let x=yield this.api.fetchPOIListByParam(u);return this.isRequestInProgress=!1,x&&x.length&&this.logging.log("fetched POI list ["+x.length+"]"),x}catch{return this.isRequestInProgress=!1,[]}})}clearResults(){this.poiList=[],this.events.publish("ocm:poiList:cleared"),this.logging.log("clearing results after settings change",ar.VERBOSE)}getPOIById(u,x=!1,_=!1){return st(this,null,function*(){if(!_&&this.poiList!=null){let B=this.poiList.find($=>$.ID==u);if(B)return B}let o={poiIdList:[u],enableCaching:!_,includeComments:!0},C=yield this.api.fetchPOIListByParam(o);return C&&C.length>0?(this.poiList&&C[0].ID==u&&(this.poiList=this.poiList.filter(B=>B.ID!=u),this.poiList.push(C[0]),this.logging.log("POI refreshed in cache "+u)),C[0]):null})}static \u0275fac=function(x){return new(x||g)(ii(rm),ii(Ba),ii(bn),ii(t_))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var Hh=(()=>{class g{api;poiManager;logging;journeys;favourites;routePolyline;constructor(u,x,_){this.api=u,this.poiManager=x,this.logging=_,this.journeys=[],this.favourites=[]}loadJourneys(){let u=localStorage.getItem("journeys");if(u!=null&&(this.journeys=JSON.parse(u)),this.journeys!=null)for(let x of this.journeys)this.fetchAllJourneyPOIDetails(x)}fetchAllJourneyPOIDetails(u){this.logging.log("Journeys - fetching poi details for Journey "+u.Title);let x=new qh;x.poiIdList=[];for(let _ of u.Stages)for(let o of _.WayPoints)for(let C of o.PoiIDs)x.poiIdList.push(C);this.api.fetchPOIListByParam(x).then(_=>{for(let o of _)this.updateStoredPOI(o)})}updateStoredPOI(u){if(this.journeys.forEach(x=>{x.Stages.forEach(_=>{_.WayPoints.forEach(o=>{o.PoiIDs.forEach(C=>{if(C==u.ID)if(o.PoiList==null){o.PoiList=[];let B=new Id("charging",1);B.Poi=u,B.PoiID=u.ID,o.PoiList.push(B)}else for(let B of o.PoiList)B.PoiID==u.ID&&(B.Poi=u)})})})}),this.favourites!=null)for(let x of this.favourites)x.Type=="charging"&&x.PoiID==u.ID&&(x.Poi=u)}saveJourneys(){let u=JSON.parse(JSON.stringify(this.journeys));for(let _ of u)for(let o of _.Stages)for(let C of o.WayPoints)for(let B of C.PoiList)B.Poi=null,B.Photos=null;let x=JSON.stringify(u);localStorage.setItem("journeys",x)}addJourney(u,x){let _=new Pd;_.Title="Stage 1",x!=null&&_.WayPoints.push(x),u.Stages.push(_),this.journeys.push(u)}deleteJourney(u){this.journeys=this.journeys.filter(x=>x.ID!=u),this.saveJourneys()}getJourney(u){let x=this.journeys.filter(_=>_.ID==u);return x.length>0?x[0]:null}getJourneyStages(u){return this.getJourney(u).Stages}addJourneyWaypoint(u,x,_){let o=this.getJourney(u);if(x==null){let C=new Pd;C.Title="Stage "+(o.Stages.length+1),C.WayPoints.push(_),o.Stages.push(C)}else{let C=o.Stages[x];C.WayPoints==null&&(C.WayPoints=[]),C.WayPoints.push(_)}}addJourneyStage(u,x){return this.getJourney(u).Stages.push(x)-1}setupTestJourneys(){this.journeys=[];let u=new Zh;u.Title="New York to Brooklyn",u.Notes="A little jaunt to Brooklyn",u.Stages=[];let x=new Pd,_=new Ah;_.Notes="Starting point",_.Position=new Un(40,1.2),_.Title="Start",x.WayPoints.push(_);let o=new Ah;o.Notes="Middle point",o.Position=new Un(40,1.33),o.Title="Middle",x.WayPoints.push(o);let C=new Ah;C.Notes="End point",C.Position=new Un(40,1.33),C.Title="End",x.WayPoints.push(C),u.Stages.push(x),this.journeys.push(u);let B=new Zh;B.Title="Aberdeen to London",B.Notes="Roadtrip",B.Stages=[],this.journeys.push(B)}calculateEnergyConsumptionkWh(u,x,_=0,o){return u*o}setRoutePolyline(u){this.routePolyline=u}getRoutePolyline(){return this.routePolyline}static \u0275fac=function(x){return new(x||g)(ii(rm),ii(om),ii(bn))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var cb=(()=>{class g{events;isQueueProcessing;appManager;constructor(u){this.events=u,this.isQueueProcessing=!1}setAppManager(u){this.appManager=u}add(u,x){let _=this.getQueueItems();_.push(new rg(u,x)),this.saveQueueItems(_)}update(u){let x=this.getQueueItems(),_=new Array;return x.forEach(o=>{o.ID==u.ID?_.push(u):_.push(o)}),_}processNextQueueItem(){let u=this.getNextQueueItem();u!=null&&this.appManager!=null&&this.appManager.api.performSubmission(u.SubmissionType,u.Data).then(()=>{u.IsSubmitted=!0,u.Attempts++,this.update(u),this.clear()})}getNextQueueItem(){let u=this.getQueueItems(),x=null;return u.forEach(_=>{x==null&&!_.IsCancelled&&!_.IsInProgress&&!_.IsSubmitted&&(x=_)}),x}hasPendingItems(){let u=!1;return this.getQueueItems().forEach(_=>{!_.IsFailure&&!_.IsCancelled&&!_.IsSubmitted&&(u=!0)}),u}isCompleted(){let u=this.getQueueItems(),x=!0;return u.forEach(_=>{(_.IsInProgress||_.IsFailure)&&(x=!1)}),x}clear(u=!1){let x=this.getQueueItems(),_=new Array;u||x.forEach(o=>{(o.IsInProgress||o.IsFailure)&&_.push(o)}),this.saveQueueItems(_)}saveQueueItems(u){localStorage.setItem("submissionQueue",JSON.stringify(u))}getQueueItems(){let u=localStorage.getItem("submissionQueue");return u!=null?JSON.parse(u):new Array}static \u0275fac=function(x){return new(x||g)(ii(Ba))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();var bv=new A1("JWT_OPTIONS"),n_=(()=>{class g{constructor(u=null){this.tokenGetter=u&&u.tokenGetter||function(){}}urlBase64Decode(u){let x=u.replace(/-/g,"+").replace(/_/g,"/");switch(x.length%4){case 0:break;case 2:{x+="==";break}case 3:{x+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(x)}b64decode(u){let x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_="";if(u=String(u).replace(/=+$/,""),u.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let o=0,C,B,$=0;B=u.charAt($++);~B&&(C=o%4?C*64+B:B,o++%4)?_+=String.fromCharCode(255&C>>(-2*o&6)):0)B=x.indexOf(B);return _}b64DecodeUnicode(u){return decodeURIComponent(Array.prototype.map.call(this.b64decode(u),x=>"%"+("00"+x.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(u=this.tokenGetter()){return u instanceof Promise?u.then(x=>this._decodeToken(x)):this._decodeToken(u)}_decodeToken(u){if(!u||u==="")return null;let x=u.split(".");if(x.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let _=this.urlBase64Decode(x[1]);if(!_)throw new Error("Cannot decode the token.");return JSON.parse(_)}getTokenExpirationDate(u=this.tokenGetter()){return u instanceof Promise?u.then(x=>this._getTokenExpirationDate(x)):this._getTokenExpirationDate(u)}_getTokenExpirationDate(u){let x;if(x=this.decodeToken(u),!x||!x.hasOwnProperty("exp"))return null;let _=new Date(0);return _.setUTCSeconds(x.exp),_}isTokenExpired(u=this.tokenGetter(),x){return u instanceof Promise?u.then(_=>this._isTokenExpired(_,x)):this._isTokenExpired(u,x)}_isTokenExpired(u,x){if(!u||u==="")return!0;let _=this.getTokenExpirationDate(u);return x=x||0,_===null?!1:!(_.valueOf()>new Date().valueOf()+x*1e3)}getAuthScheme(u,x){return typeof u=="function"?u(x):u}}return g.\u0275fac=function(u){return new(u||g)(ii(bv))},g.\u0275prov=An({token:g,factory:g.\u0275fac}),g})(),ub=g=>g instanceof Promise?E1(()=>g):Ng(g),bT=(()=>{class g{constructor(u,x,_){this.jwtHelper=x,this.document=_,this.standardPorts=["80","443"],this.tokenGetter=u.tokenGetter,this.headerName=u.headerName||"Authorization",this.authScheme=u.authScheme||u.authScheme===""?u.authScheme:"Bearer ",this.allowedDomains=u.allowedDomains||[],this.disallowedRoutes=u.disallowedRoutes||[],this.throwNoTokenError=u.throwNoTokenError||!1,this.skipWhenExpired=u.skipWhenExpired}isAllowedDomain(u){let x=new URL(u.url,this.document.location.origin);if(x.host===this.document.location.host)return!0;let _=`${x.hostname}${x.port&&!this.standardPorts.includes(x.port)?":"+x.port:""}`;return this.allowedDomains.findIndex(o=>typeof o=="string"?o===_:o instanceof RegExp?o.test(_):!1)>-1}isDisallowedRoute(u){let x=new URL(u.url,this.document.location.origin);return this.disallowedRoutes.findIndex(_=>{if(typeof _=="string"){let o=new URL(_,this.document.location.origin);return o.hostname===x.hostname&&o.pathname===x.pathname}return _ instanceof RegExp?_.test(u.url):!1})>-1}handleInterception(u,x,_){let o=this.jwtHelper.getAuthScheme(this.authScheme,x);if(!u&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let C=Ng(!1);return this.skipWhenExpired&&(C=u?ub(this.jwtHelper.isTokenExpired(u)):Ng(!0)),u?C.pipe(M1(B=>B&&this.skipWhenExpired?x.clone():x.clone({setHeaders:{[this.headerName]:`${o}${u}`}})),yv(B=>_.handle(B))):_.handle(x)}intercept(u,x){if(!this.isAllowedDomain(u)||this.isDisallowedRoute(u))return x.handle(u);let _=this.tokenGetter(u);return ub(_).pipe(yv(o=>this.handleInterception(o,u,x)))}}return g.\u0275fac=function(u){return new(u||g)(ii(bv),ii(n_),ii(k1))},g.\u0275prov=An({token:g,factory:g.\u0275fac}),g})(),YL=(()=>{class g{constructor(u){if(u)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(u){return{ngModule:g,providers:[{provide:G1,useClass:bT,multi:!0},u.jwtOptionsProvider||{provide:bv,useValue:u.config},n_]}}}return g.\u0275fac=function(u){return new(u||g)(ii(g,12))},g.\u0275mod=Gg({type:g}),g.\u0275inj=Vg({}),g})();var Ps=(()=>{class g{http;events;api;submissionQueue;platform;referenceDataManager;journeyManager;translateService;toastController;loadingController;jwtHelper;logging;analytics;enableSubmissionQueue;searchSettings;platformMode;journeys;isDebugMode;clientWidth;clientHeight;isRequestInProgress=!1;title="Open Charge Map";_isUserAuthenticated=null;isEmbeddedMode=!1;isOffline=!1;constructor(u,x,_,o,C,B,$,Y,ne,q,Ce,Ie,Ae){this.http=u,this.events=x,this.api=_,this.submissionQueue=o,this.platform=C,this.referenceDataManager=B,this.journeyManager=$,this.translateService=Y,this.toastController=ne,this.loadingController=q,this.jwtHelper=Ce,this.logging=Ie,this.analytics=Ae,this.api.clientName="ocm.app.ionic."+Ea.version,this.isDebugMode=!1,this.enableSubmissionQueue=!1,this.submissionQueue.setAppManager(this),C.is("cordova")?this.platformMode="cordova":this.platformMode="web",this.initAppManager(),this.searchSettings=new nm,this.loadSearchSettings(),this.applyURLQueryStringOptions(),this.searchSettings.CheckForActiveFilters(),this.journeyManager.loadJourneys()}loadSearchSettings(){if(localStorage.getItem("searchSettings")!=null){this.searchSettings=new nm;try{let u=JSON.parse(localStorage.getItem("searchSettings"));Object.assign(this.searchSettings,u)}catch{}}}savePushRegistration(u){localStorage.setItem("_pushToken",u.toString())}getPushRegistration(){localStorage.getItem("_pushToken")}getQueryVariable(u){let _=window.location.search.substring(1).split("&");for(let o=0;o<_.length;o++){let C=_[o].split("=");if(decodeURIComponent(C[0])==u)return C[1].split(",").map(Y=>decodeURIComponent(Y))}return null}applyURLQueryStringOptions(){if(this.getQueryVariable("mode")&&this.getQueryVariable("mode")[0]=="embedded"&&(this.isEmbeddedMode=!0),this.getQueryVariable("operatorid")){let u=this.getQueryVariable("operatorid");for(let x of u)this.searchSettings.OperatorList.unshift(parseInt(x,10))}if(this.getQueryVariable("latitude")&&this.getQueryVariable("longitude")){let u=this.getQueryVariable("latitude")[0],x=this.getQueryVariable("longitude")[0];this.searchSettings.StartSearchPosition=new Un(parseFloat(u),parseFloat(x))}this.getQueryVariable("title")&&(this.title=this.getQueryVariable("title")[0]),this.getQueryVariable("languagecode")&&this.setLanguage(this.getQueryVariable("languagecode")[0]),this.getQueryVariable("id")&&(this.searchSettings.StartViewPoiId=this.getQueryVariable("id")[0])}saveSearchSettings(){this.searchSettings.CheckForActiveFilters(),localStorage.setItem("searchSettings",JSON.stringify(this.searchSettings))}getLanguages(){return[{code:"ar",title:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629 / Arabic"},{code:"bg",title:"Bulgarian / \u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438"},{code:"cs",title:"Czech / \u010Ce\u0161tina"},{code:"de",title:"German / Deutsch"},{code:"el",title:"Greek / \u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AE"},{code:"en",title:"English"},{code:"es",title:"Spanish / Espa\xF1ol"},{code:"et",title:"Estonian / Eesti"},{code:"fi",title:"Finnish / Suomi"},{code:"fr",title:"French / Fran\xE7ais"},{code:"fy",title:"West Frisian / Frysk"},{code:"hu",title:"Hungarian / Magyar"},{code:"it",title:"Italian / Italiano"},{code:"ja",title:"Japanese / \u65E5\u672C\u8A9E"},{code:"lt",title:"Lithuanian / Lietuvi\u0173"},{code:"nl",title:"Dutch / Nederlands"},{code:"pt",title:"Portuguese / portugu\xEAs"},{code:"ro",title:"Romanian / Rom\xE2n\u0103"},{code:"ru",title:"Russian / P\u0443\u0441\u0441\u043A\u0438\u0439"},{code:"sk",title:"Slovak / Sloven\u010Dina"},{code:"tr",title:"Turkish / T\xFCrk\xE7e"},{code:"zh",title:"Chinese / \u4E2D\u56FD\u7684"}]}setLanguage(u){(u==null||u=="")&&(u="en"),this.logging.log("Changing language: "+u),this.translateService.use(u)}initAppManager(){this.initAuthFromStorage(),this.isUserAuthenticated(!0)&&this.enableSubmissionQueue&&this.submissionQueue!=null&&this.submissionQueue.hasPendingItems()&&this.submissionQueue.processNextQueueItem()}initAuthFromStorage(){let u=localStorage.getItem("authResponse");if(u!=null){let x=JSON.parse(u);if(x?.Data!=null&&x?.Data?.access_token!=null){let _=this.jwtHelper.decodeToken(x.Data.access_token);this.jwtHelper.isTokenExpired(x.Data.access_token)?localStorage.removeItem("authResponse"):(this.api.authResponse=x,this.logging.log("User has valid auth token in local storage",ar.VERBOSE))}else this.logging.log("User has invalid auth token in local storage",ar.VERBOSE),localStorage.removeItem("authResponse")}}isUserAuthenticated(u=!1){if(u===!1&&this._isUserAuthenticated!=null)return this._isUserAuthenticated;if(this._isUserAuthenticated=!1,this.api.authResponse!=null){let x=this.api.authResponse;this.jwtHelper.isTokenExpired(x.Data.access_token)||(this._isUserAuthenticated=!0)}return this._isUserAuthenticated}getCurrentAuthToken(){return this.api.authResponse!=null?this.api.authResponse.Data.access_token:null}getUserProfile(){return this.api.authResponse!=null?this.api.authResponse.Data.UserProfile:null}signOutCurrentUser(){localStorage.removeItem("authResponse"),this.api.authResponse=null,this._isUserAuthenticated=!1}submitComment(u){if(this.enableSubmissionQueue)this.submissionQueue.add(Al.Comment,u),this.submissionQueue.processNextQueueItem();else return this.api.performSubmission(Al.Comment,u)}submitMediaItem(u){if(this.enableSubmissionQueue)this.submissionQueue.add(Al.Media,u),this.submissionQueue.processNextQueueItem();else return this.api.performSubmission(Al.Media,u)}submitPOI(u){if(this.enableSubmissionQueue)this.submissionQueue.add(Al.POI,u),this.submissionQueue.processNextQueueItem();else return this.api.performSubmission(Al.POI,u)}showToastNotification(u){return st(this,null,function*(){yield(yield this.toastController.create({message:u,duration:3e3})).present()})}showLoadingProgress(u){return st(this,null,function*(){yield(yield this.loadingController.create({message:u})).present()})}dismissLoadingProgress(){return st(this,null,function*(){return this.loadingController.dismiss()})}launchOCMWebPage(u){this.isUserAuthenticated(!0)&&(u.indexOf("?")===-1&&(u+="?"),u+="&auth="+this.getCurrentAuthToken()),u="https://openchargemap.org/site"+u,window.open(u,"_system")}launchWebPage(u){window.open(u,"_system")}isPlatform(u){return this.platform.is(u)}static \u0275fac=function(x){return new(x||g)(ii($o),ii(Ba),ii(rm),ii(cb),ii(Zd),ii(Gh),ii(Hh),ii(Vh),ii(ob),ii(Nh),ii(n_),ii(bn),ii(t_))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();function TT(g,m){if(g&1&&(ge(0,"ion-select-option",13),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}function ST(g,m){if(g&1&&(ge(0,"ion-select-option",16),Le(1),ve()),g&2){let u=m.$implicit,x=m.index;Ze("value",x),be(),Ht(u.Title)}}function IT(g,m){if(g&1){let u=oi();ge(0,"ion-item")(1,"ion-label",2),Le(2,"Journey Stage"),ve(),ge(3,"ion-select",3),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.selectedStageIndex,_)||(o.selectedStageIndex=_),ut(_)}),ge(4,"ion-select-option",14),Le(5,"Create a Journey Stage"),ve(),Et(6,ST,2,2,"ion-select-option",15),ve()()}if(g&2){let u=Ve();be(3),Xt("ngModel",u.selectedStageIndex),be(3),Ze("ngForOf",u.journeyManager.getJourneyStages(u.selectedJourneyID))}}function PT(g,m){if(g&1){let u=oi();ge(0,"ion-item")(1,"ion-label",2),Le(2,"New Journey Name"),ve(),ge(3,"ion-input",7),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.newJourneyName,_)||(o.newJourneyName=_),ut(_)}),ve()()}if(g&2){let u=Ve();be(3),Xt("ngModel",u.newJourneyName)}}var hb=(()=>{class g{appManager;navParams;journeyManager;modalController;selectedJourneyID;selectedStageIndex;newJourneyName;waypoint;poi;constructor(u,x,_,o){this.appManager=u,this.navParams=x,this.journeyManager=_,this.modalController=o,this.poi=this.navParams.get("poi"),this.waypoint=new Ah,this.waypoint.Title=this.poi.AddressInfo.Title,this.waypoint.PoiIDs=[this.poi.ID],this.waypoint.PoiList=[];let C=new Id("charging",1);C.Poi=this.poi,C.PoiID=this.poi.ID,this.waypoint.PoiList.push(C),this.newJourneyName="Trip to "+this.poi.AddressInfo.Title}cancel(){this.modalController.dismiss()}add(){if(this.selectedJourneyID!=null&&this.selectedJourneyID!=="")this.journeyManager.addJourneyWaypoint(this.selectedJourneyID,this.selectedStageIndex,this.waypoint);else{let u=new Zh;u.ID=Date.now().toString(),this.newJourneyName===""&&(this.newJourneyName="New Journey"),u.Title=this.newJourneyName,this.journeyManager.addJourney(u,this.waypoint)}this.journeyManager.saveJourneys(),this.modalController.dismiss()}static \u0275fac=function(x){return new(x||g)(Rt(Ps),Rt(Wd),Rt(Hh),Rt(Ss))};static \u0275cmp=lr({type:g,selectors:[["ng-component"]],standalone:!1,decls:39,vars:8,consts:[[1,"journeys-page","ion-padding"],[1,"banner"],["position","stacked"],[3,"ngModelChange","ngModel"],["value","","checked",""],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text",3,"ngModelChange","ngModel"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","add","slot","end"],[3,"value"],["value",""],["checked","",3,"value",4,"ngFor","ngForOf"],["checked","",3,"value"]],template:function(x,_){x&1&&(ge(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),Le(3," Edit Favourite "),ve()()(),ge(4,"ion-content",0)(5,"div",1)(6,"h1"),Le(7),ve(),ge(8,"p"),Le(9),ve()(),ge(10,"p"),Le(11," Add Charging Location as a Journey Waypoint "),ve(),ge(12,"ion-item")(13,"ion-label",2),Le(14,"Add to a Journey"),ve(),ge(15,"ion-select",3),Kt("ngModelChange",function(C){return Zt(_.selectedJourneyID,C)||(_.selectedJourneyID=C),C}),ge(16,"ion-select-option",4),Le(17,"Create a New Journey"),ve(),Et(18,TT,2,2,"ion-select-option",5),ve()(),Et(19,IT,7,2,"ion-item",6)(20,PT,4,1,"ion-item",6),ge(21,"ion-item")(22,"ion-label",2),Le(23,"Name for this step of your journey"),ve(),ge(24,"ion-input",7),Kt("ngModelChange",function(C){return Zt(_.waypoint.Title,C)||(_.waypoint.Title=C),C}),ve()(),ge(25,"ion-item")(26,"ion-label",2),Le(27,"Other Notes"),ve(),ge(28,"ion-textarea",3),Kt("ngModelChange",function(C){return Zt(_.waypoint.Notes,C)||(_.waypoint.Notes=C),C}),ve()()(),ge(29,"ion-footer")(30,"ion-toolbar")(31,"ion-buttons",8)(32,"ion-button",9),Dt("click",function(){return _.cancel()}),yt(33,"ion-icon",10),Le(34," Cancel "),ve()(),ge(35,"ion-buttons",11)(36,"ion-button",9),Dt("click",function(){return _.add()}),Le(37," Add "),yt(38,"ion-icon",12),ve()()()()),x&2&&(be(7),Ht(_.poi.AddressInfo.Title),be(2),Ht(_.poi.AddressInfo.AddressLine1),be(6),Xt("ngModel",_.selectedJourneyID),be(3),Ze("ngForOf",_.journeyManager.journeys),be(),Ze("ngIf",_.selectedJourneyID),be(),Ze("ngIf",!_.selectedJourneyID),be(4),Xt("ngModel",_.waypoint.Title),be(4),Xt("ngModel",_.waypoint.Notes))},dependencies:[Vo,Or,Go,Zo,wr,Da,Bl,Ol,jl,Tr,Ts,jr,qo,mu,fu,ib,Ul,Ra,ws,La],encapsulation:2})}return g})();function CT(g,m){if(g&1){let u=oi();dn(0),ge(1,"p",13),Le(2," Sign in using your Open Charge Map account. "),ve(),ge(3,"ion-list")(4,"ion-item")(5,"ion-input",14),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.email,_)||(o.email=_),ut(_)}),ve()(),ge(6,"ion-item")(7,"ion-input",15),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.password,_)||(o.password=_),ut(_)}),ve()()(),ge(8,"p")(9,"a",8),Dt("click",function(){ct(u);let _=Ve();return ut(_.appManager.launchWebPage("https://openchargemap.org/site/loginprovider/passwordreset"))}),Le(10,"Reset your password"),ve()(),mn()}if(g&2){let u=Ve();be(5),Xt("ngModel",u.email),be(2),Xt("ngModel",u.password)}}function MT(g,m){if(g&1){let u=oi();dn(0),ge(1,"p",13),Le(2," Create a new Open Charge Map account. "),ve(),ge(3,"ion-list")(4,"ion-item")(5,"ion-label",16),Le(6,"Email"),ve(),ge(7,"ion-input",17),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.email,_)||(o.email=_),ut(_)}),ve()(),ge(8,"ion-item")(9,"ion-label",16),Le(10,"Display Name or Nickname"),ve(),ge(11,"ion-input",17),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.username,_)||(o.username=_),ut(_)}),ve()(),ge(12,"ion-item")(13,"ion-label",16),Le(14,"Password"),ve(),ge(15,"ion-input",18),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.password,_)||(o.password=_),ut(_)}),ve()(),ge(16,"ion-item")(17,"ion-label",16),Le(18,"Confirm Password"),ve(),ge(19,"ion-input",18),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.confirmpassword,_)||(o.confirmpassword=_),ut(_)}),ve()()(),mn()}if(g&2){let u=Ve();be(7),Xt("ngModel",u.email),be(4),Xt("ngModel",u.username),be(4),Xt("ngModel",u.password),be(4),Xt("ngModel",u.confirmpassword)}}var r_=(()=>{class g{appManager;modalController;translate;alertController;loadingController;logging;router;location;email;password;username;confirmpassword;mode="signin";constructor(u,x,_,o,C,B,$,Y){this.appManager=u,this.modalController=x,this.translate=_,this.alertController=o,this.loadingController=C,this.logging=B,this.router=$,this.location=Y,this.email=""}cancelSignIn(){this.modalController.dismiss()}performRegister(){return st(this,null,function*(){if(this.password!=this.confirmpassword){alert("Your password and the confirmed password do not match, please try again.");return}if(this.password.length<6){alert("Your password should be at least 6 characters.");return}let u=yield this.loadingController.create({message:"Registering .."});yield u.present();let x=!1;try{let _=yield this.appManager.api.performRegister(this.username,this.email,this.password);u.dismiss(),localStorage.setItem("authResponse",JSON.stringify(this.appManager.api.authResponse)),this.appManager.isUserAuthenticated(!0),this.modalController.dismiss(),this.appManager.analytics.appEvent("Profile","SignedIn")}catch(_){x=!0,u.dismiss(),yield(yield this.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),this.logging.log("Error logging in:"+_)}})}performSignIn(){return st(this,null,function*(){if(this.mode=="register")return this.performRegister();let u=yield this.loadingController.create({message:"Signing In.."});yield u.present();let x=!1;try{let _=yield this.appManager.api.performSignIn(this.email,this.password);u.dismiss(),localStorage.setItem("authResponse",JSON.stringify(this.appManager.api.authResponse)),this.appManager.isUserAuthenticated(!0),this.modalController.dismiss(),this.appManager.analytics.appEvent("Profile","SignedIn")}catch(_){x=!0,u.dismiss(),yield(yield this.alertController.create({header:"Open Charge Map",subHeader:"Email or Password not recognised",buttons:["Ok"]})).present(),this.logging.log("Error logging in:"+_)}})}static \u0275fac=function(x){return new(x||g)(Rt(Ps),Rt(Ss),Rt(Vh),Rt(Qg),Rt(Nh),Rt(bn),Rt(Gd),Rt(U1))};static \u0275cmp=lr({type:g,selectors:[["ng-component"]],standalone:!1,decls:28,vars:9,consts:[[1,"signin-page","ion-padding"],["item-left",""],["src","assets/images/icons/branding/AppIcon_128x128.png"],[3,"ngModelChange","ngModel"],["value","signin"],["value","register"],[4,"ngIf"],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["type","submit","color","primary",3,"click"],["name","log-in","slot","start"],[1,"ion-padding"],["label","Email","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","Password","label-placement","floating","type","password",3,"ngModelChange","ngModel"],["position","floating"],["type","text",3,"ngModelChange","ngModel"],["type","password",3,"ngModelChange","ngModel"]],template:function(x,_){x&1&&(ge(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),Le(3),vr(4,"translate"),ve()()(),ge(5,"ion-content",0)(6,"ion-avatar",1),yt(7,"img",2),ve(),ge(8,"ion-segment",3),Kt("ngModelChange",function(C){return Zt(_.mode,C)||(_.mode=C),C}),ge(9,"ion-segment-button",4)(10,"ion-label"),Le(11,"Sign In"),ve()(),ge(12,"ion-segment-button",5)(13,"ion-label"),Le(14,"Create Account"),ve()()(),Et(15,CT,11,2,"ng-container",6)(16,MT,20,4,"ng-container",6),ve(),ge(17,"ion-footer")(18,"ion-toolbar")(19,"ion-buttons",7)(20,"ion-button",8),Dt("click",function(){return _.cancelSignIn()}),yt(21,"ion-icon",9),Le(22," Cancel"),ve()(),ge(23,"ion-buttons",10)(24,"ion-button",11),Dt("click",function(){return _.performSignIn()}),yt(25,"ion-icon",12),Le(26),vr(27,"translate"),ve()()()()),x&2&&(be(3),Ut(" ",No(4,5,"ocm.general.signIn")," "),be(5),Xt("ngModel",_.mode),be(7),Ze("ngIf",_.mode=="signin"),be(),Ze("ngIf",_.mode=="register"),be(10),Ut(" ",No(27,7,"ocm.general.signIn")))},dependencies:[Or,Go,Zo,Uh,wr,Da,Bl,Ol,jl,Tr,Ts,jr,qo,za,Qd,em,Ul,Ra,ws,La,tm],encapsulation:2})}return g})();var uo=(()=>{class g{static isFeatureEnabled(u){return!!Ea.enabledFeatures.find(x=>x===u)}static getClientHeight(){let u=document.body,x=document.documentElement;return Math.max(u.scrollHeight,u.offsetHeight,x.clientHeight,x.scrollHeight,x.offsetHeight)}static getClientWidth(){let u=document.body,x=document.documentElement;return Math.max(u.scrollWidth,u.offsetWidth,x.clientWidth,x.scrollWidth,x.offsetWidth)}static getMaxLevelOfPOI(u){let x=0;if(u.StatusTypeID==150)return 0;if(u.Connections!=null)for(let _=0;_<u.Connections.length;_++)u.Connections[_].Level!=null&&u.Connections[_].Level.ID>x&&(x=u.Connections[_].Level.ID);return x===4&&(x=2),x>4&&(x=3),x}static getIconForPOI(u){let _="assets/images/icons/map/level"+g.getMaxLevelOfPOI(u);return u.UsageType!=null&&u.UsageType.Title.indexOf("Private")>-1?_+="_private":u.StatusType!=null&&u.StatusType.IsOperational!==!0?_+="_nonoperational":_+="_operational",_+="_icon.png",_}static getColorForPOI(u){let x=g.getMaxLevelOfPOI(u),_="#c0c0c0";return u.UsageType!=null&&u.UsageType.Title.indexOf("Private")>-1?_="#FF0000":u.StatusType!=null&&u.StatusType.IsOperational!==!0?_="#a0a0a0":x==2?_="#72EB0D":x==3&&(_="#EB800D"),_}static getIconForConnector(u){let x="assets/images/icons/connectors/";return u===1?x+="Type1_J1772.svg":u===2?x+="Chademo_type4.svg":u===25?x+="Type2_socket.svg":u===32?x+="Type1_CCS.svg":u===33?x+="Type2_CCS.svg":u===1036?x+="Type2_tethered.svg":u===26?x+="Type3c.svg":u===28?x+="schuko.svg":x+="Unknown.svg",x}static getFormattedDistance(u){return u&&u.AddressInfo&&u.AddressInfo.Distance?u.AddressInfo.Distance.toFixed(1)+" "+(u.AddressInfo.DistanceUnit===1?"km":"miles"):""}static fixJSONDate(u){if(u==null)return null;if(u.indexOf("/")==0){let _=/Date\(([^)]+)\)/.exec(u);u=new Date(parseFloat(_[1]))}else u=new Date(u);return u}static formatMapLinkFromPosition(u,x,_,o,C){return'<a href="https://maps.google.com/maps?saddr='+x+","+_+"&daddr="+u.AddressInfo.Latitude+","+u.AddressInfo.Longitude+'">Map ('+Math.ceil(o)+" "+C+")</a>"}static formatSystemWebLink(u,x){return`<a href='#' onclick="window.open('`+u+`', '_system');return false;">`+x+"</a>"}static formatMapLink(u,x,_){return _?device&&device.platform=="WinCE"?this.formatSystemWebLink("maps:"+u.AddressInfo.Latitude+","+u.AddressInfo.Longitude,x):device&&device.platform==="iOS"?this.formatSystemWebLink("https://maps.apple.com/?q="+u.AddressInfo.Latitude+","+u.AddressInfo.Longitude,x):this.formatSystemWebLink("https://maps.google.com/maps?q="+u.AddressInfo.Latitude+","+u.AddressInfo.Longitude,x):'<a target="_blank"  href="https://maps.google.com/maps?q='+u.AddressInfo.Latitude+","+u.AddressInfo.Longitude+'">'+x+"</a>"}static formatURL(u,x=null){return u==null||u==""?"":(u.indexOf("http")==-1&&(u="https://"+u),'<a target="_blank" href="'+u+'">'+(x??u)+"</a>")}static formatPOIAddress=function(u,x=!0){let _="";return x?_=""+this.formatTextField(u.AddressInfo.AddressLine1)+this.formatTextField(u.AddressInfo.AddressLine2)+this.formatTextField(u.AddressInfo.Town)+this.formatTextField(u.AddressInfo.StateOrProvince)+this.formatTextField(u.AddressInfo.Postcode)+(u.AddressInfo.Country!=null?this.formatTextField(u.AddressInfo.Country.Title):""):_=this.formatStringArray([u.AddressInfo.AddressLine1,u.AddressInfo.AddressLine2,u.AddressInfo.Town,u.AddressInfo.StateOrProvince,u.AddressInfo.Postcode,u.AddressInfo.Country!=null?u.AddressInfo.Country.Title:""]),_};static formatStringArray=function(u,x=", "){if(u==null)return"";let _="";for(let o=0;o<u.length;o++)u[o]!=null&&u[o].trim()!=""&&(o==u.length-1?_+=u[o]:_+=u[o]+x);return _};static formatString(u){return u==null?"":u.toString()}static formatTextField(u,x=null,_=!1,o=!1,C=null){if(u==null||u==""||u==null)return"";let B=(x!=null?"<strong class='ocm-label' "+(C!=null?"data-localize='"+C+"' ":"")+">"+x+"</strong>: ":"")+(_?"<br/>":"")+u.toString().replace(`
`,"<br/>")+"<br/>";return o==!0&&(B="<p>"+B+"</p>"),B}static formatEmailAddress(u){return u!=null&&u!=null&&u!=""?`<i class='fa fa-envelope fa-fw'></i> <a href="mailto:`+u+'">'+u+"</a><br/>":""}static formatPhone(u,x=null){return u!=null&&u!=null&&u!=""?(x==null?x="<i class='fa fa-phone fa-fw '></i> ":x+=": ",x+'<a href="tel:'+u+'">'+u+"</a><br/>"):""}static formatPOIDetails(u,x){let _=864e5,o=new Date;x==null&&(x=!1);let C=this.formatPOIAddress(u,!1),B="";B+=this.formatPhone(u.AddressInfo.ContactTelephone1),B+=this.formatPhone(u.AddressInfo.ContactTelephone2),B+=this.formatEmailAddress(u.AddressInfo.ContactEmail);let $="";if(u.AddressInfo.Distance!=null){let Ae="https://maps.google.com/maps?saddr=&daddr="+u.AddressInfo.Latitude+","+u.AddressInfo.Longitude;$+="<strong id='addr_distance'><span data-localize='details.approxDistance'>Distance</span>: "+u.AddressInfo.Distance.toFixed(1)+" "+(u.AddressInfo.DistanceUnit==2?"Miles":"KM")+"</strong>",$+="<p>"+this.formatSystemWebLink(Ae,"Get Directions")+"</p>"}if(u.AddressInfo.RelatedURL!=null&&u.AddressInfo.RelatedURL!=""){let Ae=u.AddressInfo.RelatedURL;Ae=Ae.replace(/.*?:\/\//g,""),Ae.length>40&&(Ae=Ae.substr(0,40)+".."),B+="<i class='fa fa-fw fa-external-link'></i>  "+this.formatSystemWebLink(u.AddressInfo.RelatedURL,"<span data-localize='details.addressRelatedURL'>"+Ae+"</span>")}B+="</p>";let Y=this.formatTextField(u.GeneralComments,null,!1,!0)+this.formatTextField(u.AddressInfo.AccessComments,"Access",!0,!0,"details.accessComments"),ne="";u.NumberOfPoints!=null&&(ne+=this.formatTextField(u.NumberOfPoints,"Bays",!1,!0,"details.numberOfPoints")),u.UsageType!=null&&(ne+=this.formatTextField(u.UsageType.Title,"Usage",!1,!0,"details.usageType")),u.UsageCost!=null&&(ne+=this.formatTextField(u.UsageCost,"Usage Cost",!1,!0,"details.usageCost")),u.OperatorInfo!=null&&u.OperatorInfo.ID!=1&&(ne+=this.formatTextField(u.OperatorInfo.Title,"Operator",!1,!0,"details.operatorTitle"),u.OperatorInfo.WebsiteURL!=null&&(ne+=this.formatTextField(this.formatURL(u.OperatorInfo.WebsiteURL),"Operator Website",!0,!0,"details.operatorWebsite")));let q="";if(u.StatusType!=null&&(q+=this.formatTextField(u.StatusType.Title,"Status",!1,!0,"details.operationalStatus"),u.DateLastStatusUpdate!=null&&(q+=this.formatTextField(Math.round((o-this.fixJSONDate(u.DateLastStatusUpdate))/_)+" days ago","Last Updated",!1,!0,"details.lastUpdated"))),u.Connections!=null&&u.Connections.length>0){q+="<table class='table table-striped'>",q+="<tr><th data-localize='details.equipment.connectionType'>Connection</th><th data-localize='details.equipment.powerLevel'>Power Level</th><th data-localize='details.operationalStatus'>Status</th></tr>";for(let Ae=0;Ae<u.Connections.length;Ae++){let De=u.Connections[Ae];De.Amps==""&&(De.Amps=null),De.Voltage==""&&(De.Voltage=null),De.Quantity==""&&(De.Quantity=null),De.PowerKW==""&&(De.PowerKW=null),q+="<tr><td>"+(De.ConnectionType!=null?De.ConnectionType.Title:"")+"</td><td>"+(De.Level!=null?"<strong>"+De.Level.Title+"</strong><br/>":"")+(De.Amps!=null?this.formatString(De.Amps)+"A/ ":"")+(De.Voltage!=null?this.formatString(De.Voltage)+"V/ ":"")+(De.PowerKW!=null?this.formatString(De.PowerKW)+"kW <br/>":"")+(De.CurrentType!=null?De.CurrentType.Title:"")+"<br/>"+(De.Quantity!=null?this.formatString(De.Quantity):"1")+" Present</td><td>"+(De.StatusType!=null?De.StatusType.Title:"-")+"</td></tr>"}q+="</table>"}let Ce="";return Ce+=this.formatTextField("<a target='_blank' href='https://openchargemap.org/site/poi/details/"+u.ID+"'>OCM-"+u.ID+"</a>","OpenChargeMap Ref",!1,!0,"details.refNumber"),u.DataProvider!=null&&(Ce+=this.formatTextField(u.DataProvider.Title,"Data Provider",!1,!0,"details.dataProviderTitle"),u.DataProvider.WebsiteURL!=null&&(Ce+=this.formatTextField(this.formatURL(u.DataProvider.WebsiteURL),"Website",!1,!0,"details.dataProviderWebsite")),Ce+=this.formatTextField(u.AddressInfo.Latitude,"Latitude",!1,!0,null),Ce+=this.formatTextField(u.AddressInfo.Longitude,"Longitude",!1,!0,null)),{address:C,drivingInfo:$,contactInfo:B,additionalInfo:Y+ne+q,advancedInfo:Ce}}static debounce(u,x,_){let o;return function(){let C=this,B=arguments,$=function(){o=null,_||u.apply(C,B)},Y=_&&!o;clearTimeout(o),o=setTimeout($,x),Y&&u.apply(C,B)}}static getRandomInt(u){return Math.floor(Math.random()*Math.floor(u))}}return g})();var yy={};vT(yy,{AJAXError:()=>oE,AttributionControl:()=>bg,AttributionControlMLGL:()=>UM,BoxZoomHandler:()=>wx,BoxZoomHandlerMLGL:()=>ZM,CanvasSource:()=>mx,CanvasSourceMLGL:()=>kM,ColorRamp:()=>ai,ColorRampCollection:()=>b1,CooperativeGesturesHandler:()=>Sx,CooperativeGesturesHandlerMLGL:()=>WM,CubemapFaceNames:()=>Qh,CubemapImagesPresets:()=>H2,CubemapLayer:()=>mm,DOMcreate:()=>vu,DOMremove:()=>dy,DoubleClickZoomHandler:()=>mE,DragPanHandler:()=>pE,DragRotateHandler:()=>hE,EdgeInsets:()=>uE,Evented:()=>rE,FullscreenControl:()=>L_,FullscreenControlMLGL:()=>$M,GeoJSONSource:()=>fx,GeoJSONSourceMLGL:()=>LM,GeolocateControl:()=>E_,GeolocateControlMLGL:()=>jM,GeolocationType:()=>K2,Hash:()=>lE,ImageSource:()=>gx,ImageSourceMLGL:()=>DM,KeyboardHandler:()=>Ix,KeyboardHandlerMLGL:()=>HM,Language:()=>un,LngLat:()=>$d,LngLatBounds:()=>_y,LogoControl:()=>A_,LogoControlMLGL:()=>NM,Map:()=>my,MapMLGL:()=>CM,MapMouseEvent:()=>Ex,MapMouseEventMLGL:()=>JM,MapStyle:()=>$l,MapStyleVariant:()=>Kh,MapTouchEvent:()=>Mx,MapTouchEventMLGL:()=>YM,MapWheelEvent:()=>Cx,MapWheelEventMLGL:()=>KM,MaptilerGeolocateControl:()=>J_,MaptilerLogoControl:()=>wg,MaptilerNavigationControl:()=>Y_,MaptilerProjectionControl:()=>Q_,MaptilerTerrainControl:()=>K_,Marker:()=>ty,MarkerMLGL:()=>MM,MercatorCoordinate:()=>nE,NavigationControMLGL:()=>OM,NavigationControl:()=>gm,Point:()=>cE,Popup:()=>px,PopupMLGL:()=>EM,RadialGradientLayer:()=>fm,RasterDEMTileSource:()=>yx,RasterDEMTileSourceMLGL:()=>RM,RasterTileSource:()=>_x,RasterTileSourceMLGL:()=>zM,ReferenceMapStyle:()=>Yh,ScaleControl:()=>k_,ScaleControlMLGL:()=>VM,ScrollZoomHandler:()=>Tx,ScrollZoomHandlerMLGL:()=>qM,SdkConfig:()=>M_,ServiceError:()=>Cs,Style:()=>dx,StyleMLGL:()=>AM,TerrainControMLGL:()=>GM,TerrainControl:()=>bx,TwoFingersTouchPitchHandler:()=>Px,TwoFingersTouchPitchHandlerMLGL:()=>XM,TwoFingersTouchRotateHandler:()=>gE,TwoFingersTouchZoomHandler:()=>fE,TwoFingersTouchZoomRotateHandler:()=>dE,VectorTileSource:()=>vx,VectorTileSourceMLGL:()=>FM,VideoSource:()=>xx,VideoSourceMLGL:()=>BM,addProtocol:()=>IE,addSourceType:()=>TE,areSameLanguages:()=>yb,bufferToPixelDataBrowser:()=>Ov,canParsePixelData:()=>p_,circumferenceAtLatitude:()=>Rv,clearPrewarmedResources:()=>sE,config:()=>xr,configMLGL:()=>QM,coordinates:()=>Tb,cubemapPresets:()=>ip,data:()=>Sb,displayWebGLContextLostWarning:()=>OS,elevation:()=>zb,expandMapStyle:()=>hg,geocoding:()=>wb,geolocation:()=>ug,getAutoLanguage:()=>s_,getBrowserLanguage:()=>lx,getBufferToPixelDataParser:()=>jv,getLanguageInfoFromCode:()=>kh,getLanguageInfoFromFlag:()=>Md,getLanguageInfoFromKey:()=>Av,getMapLibreVersion:()=>eE,getMaxParallelImageRequests:()=>vE,getRTLTextPluginStatus:()=>iE,getTileCache:()=>Bv,getVersion:()=>PM,getWebGLSupportError:()=>s2,getWorkerCount:()=>_E,getWorkerUrl:()=>bE,gpx:()=>_1,gpxOrKml:()=>nT,hasChildNodeWithName:()=>g1,helpers:()=>IM,importScriptInWorkers:()=>SE,isLanguageInfo:()=>c_,kml:()=>y1,mapStylePresetList:()=>Lh,math:()=>Fv,misc:()=>kv,prewarm:()=>aE,removeProtocol:()=>PE,setMaxParallelImageRequests:()=>xE,setRTLTextPlugin:()=>tE,setWorkerCount:()=>yE,setWorkerUrl:()=>wE,staticMaps:()=>Ib,str2xml:()=>fy,styleToStyle:()=>pg,toLanguageInfo:()=>Ed,xml2str:()=>Kx});var Gt=_v(mb(),1);var o_=class extends Map{#n=0;#e=new Map;#t=new Map;#r;#a;#o;constructor(m={}){if(super(),!(m.maxSize&&m.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof m.maxAge=="number"&&m.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.#r=m.maxSize,this.#a=m.maxAge||Number.POSITIVE_INFINITY,this.#o=m.onEviction}get __oldCache(){return this.#t}#s(m){if(typeof this.#o=="function")for(let[u,x]of m)this.#o(u,x.value)}#i(m,u){return typeof u.expiry=="number"&&u.expiry<=Date.now()?(typeof this.#o=="function"&&this.#o(m,u.value),this.delete(m)):!1}#p(m,u){if(this.#i(m,u)===!1)return u.value}#l(m,u){return u.expiry?this.#p(m,u):u.value}#c(m,u){let x=u.get(m);return this.#l(m,x)}#u(m,u){this.#e.set(m,u),this.#n++,this.#n>=this.#r&&(this.#n=0,this.#s(this.#t),this.#t=this.#e,this.#e=new Map)}#d(m,u){this.#t.delete(m),this.#u(m,u)}*#h(){for(let m of this.#t){let[u,x]=m;this.#e.has(u)||this.#i(u,x)===!1&&(yield m)}for(let m of this.#e){let[u,x]=m;this.#i(u,x)===!1&&(yield m)}}get(m){if(this.#e.has(m)){let u=this.#e.get(m);return this.#l(m,u)}if(this.#t.has(m)){let u=this.#t.get(m);if(this.#i(m,u)===!1)return this.#d(m,u),u.value}}set(m,u,{maxAge:x=this.#a}={}){let _=typeof x=="number"&&x!==Number.POSITIVE_INFINITY?Date.now()+x:void 0;return this.#e.has(m)?this.#e.set(m,{value:u,expiry:_}):this.#u(m,{value:u,expiry:_}),this}has(m){return this.#e.has(m)?!this.#i(m,this.#e.get(m)):this.#t.has(m)?!this.#i(m,this.#t.get(m)):!1}peek(m){if(this.#e.has(m))return this.#c(m,this.#e);if(this.#t.has(m))return this.#c(m,this.#t)}expiresIn(m){let u=this.#e.get(m)??this.#t.get(m);if(u)return u.expiry?u.expiry-Date.now():Number.POSITIVE_INFINITY}delete(m){let u=this.#e.delete(m);return u&&this.#n--,this.#t.delete(m)||u}clear(){this.#e.clear(),this.#t.clear(),this.#n=0}resize(m){if(!(m&&m>0))throw new TypeError("`maxSize` must be a number greater than 0");let u=[...this.#h()],x=u.length-m;x<0?(this.#e=new Map(u),this.#t=new Map,this.#n=u.length):(x>0&&this.#s(u.slice(0,x)),this.#t=new Map(u.slice(x)),this.#e=new Map,this.#n=0),this.#r=m}*keys(){for(let[m]of this)yield m}*values(){for(let[,m]of this)yield m}*[Symbol.iterator](){for(let m of this.#e){let[u,x]=m;this.#i(u,x)===!1&&(yield[u,x.value])}for(let m of this.#t){let[u,x]=m;this.#e.has(u)||this.#i(u,x)===!1&&(yield[u,x.value])}}*entriesDescending(){let m=[...this.#e];for(let u=m.length-1;u>=0;--u){let x=m[u],[_,o]=x;this.#i(_,o)===!1&&(yield[_,o.value])}m=[...this.#t];for(let u=m.length-1;u>=0;--u){let x=m[u],[_,o]=x;this.#e.has(_)||this.#i(_,o)===!1&&(yield[_,o.value])}}*entriesAscending(){for(let[m,u]of this.#h())yield[m,u.value]}get size(){if(!this.#n)return this.#t.size;let m=0;for(let u of this.#t.keys())this.#e.has(u)||m++;return Math.min(this.#n+m,this.#r)}get maxSize(){return this.#r}entries(){return this.entriesAscending()}forEach(m,u=this){for(let[x,_]of this.entriesAscending())m.call(u,_,x,this)}get[Symbol.toStringTag](){return"QuickLRU"}toString(){return`QuickLRU(${this.size}/${this.maxSize})`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}};function ET(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}var Cv=class{constructor(){this._apiKey="",this._fetch=ET(),this.tileCacheSize=200}set apiKey(m){this._apiKey=m}get apiKey(){return this._apiKey}set fetch(m){this._fetch=m}get fetch(){return this._fetch}},ho=new Cv,AT={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},kT={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},lu=Vi(Vi({},AT),kT);function Av(g,m=lu){return g in m?g[g]:null}function kh(g,m=lu){for(let u of Object.values(m))if(u.code===g)return u;return null}function Md(g,m=lu){for(let u of Object.values(m))if(u.flag===g)return u;return null}function s_(){if(typeof navigator>"u"){let m=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return kh(m)??lu.ENGLISH}return Array.from(new Set(navigator.languages.map(m=>m.split("-")[0]))).map(m=>kh(m)).filter(m=>m)[0]??lu.ENGLISH}function c_(g){return g!==null&&typeof g=="object"&&"code"in g&&"flag"in g&&"name"in g&&"latin"in g&&"isMode"in g&&"geocoding"in g&&(typeof g.code=="string"||g.code===null)&&typeof g.flag=="string"&&typeof g.name=="string"&&typeof g.latin=="boolean"&&typeof g.isMode=="boolean"&&typeof g.geocoding=="boolean"}function Ed(g,m=lu){return c_(g)?Md(g.flag,m):typeof g!="string"?null:Av(g,m)||kh(g,m)||Md(g,m)||null}function yb(g,m,u=lu){let x=Ed(g,u),_=Ed(m,u);return x&&_&&x.flag===_.flag}function cu(u){return st(this,arguments,function*(g,m={}){if(ho.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(g).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return ho.fetch(g,m)})}var Ms={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(Ms);var Cs=class extends Error{constructor(m,u=""){super(`Call to enpoint ${m.url} failed with the status code ${m.status}. ${u}`),this.res=m}},u_={400:"Query too long / Invalid parameters",403:"Key is missing, invalid or restricted"};function vb(g,m){let{language:u}=m;if(u===void 0)return;let x=(Array.isArray(u)?u:[u]).map(o=>LT(o)).filter(o=>o),_=Array.from(new Set(x)).join(",");g.set("language",_)}function LT(g){let m=g===lu.AUTO.flag?s_():typeof g=="string"?kh(g):c_(g)?g.flag===lu.AUTO.flag?s_():Md(g.flag):null;return m?.geocoding?m.code:null}function xb(g,m){let{apiKey:u,limit:x,types:_,excludeTypes:o}=m;g.set("key",u??ho.apiKey),x!==void 0&&g.set("limit",String(x)),_!==void 0&&g.set("types",_.join(",")),o!==void 0&&g.set("excludeTypes",String(o)),vb(g,m)}function bb(g,m){xb(g,m);let{bbox:u,proximity:x,country:_,fuzzyMatch:o,autocomplete:C}=m;u!==void 0&&g.set("bbox",u.join(",")),x!==void 0&&g.set("proximity",x==="ip"?x:x.join(",")),_!==void 0&&g.set("country",_.join(",")),o!==void 0&&g.set("fuzzyMatch",o?"true":"false"),C!==void 0&&g.set("autocomplete",C?"true":"false")}function DT(u){return st(this,arguments,function*(g,m={}){if(typeof g!="string"||g.trim().length===0)throw new Error("The query must be a non-empty string");let x=new URL(`geocoding/${encodeURIComponent(g)}.json`,Ms.maptilerApiURL);bb(x.searchParams,m);let _=yield cu(x.toString());if(!_.ok)throw new Cs(_,u_[_.status]??"");return yield _.json()})}function zT(u){return st(this,arguments,function*(g,m={}){if(!Array.isArray(g)||g.length<2)throw new Error("The position must be an array of form [lng, lat].");let x=new URL(`geocoding/${g[0]},${g[1]}.json`,Ms.maptilerApiURL);xb(x.searchParams,m);let _=yield cu(x.toString());if(!_.ok)throw new Cs(_,u_[_.status]??"");return yield _.json()})}function RT(u){return st(this,arguments,function*(g,m={}){let x=new URL(`geocoding/${g}.json`,Ms.maptilerApiURL);x.searchParams.set("key",m.apiKey??ho.apiKey),vb(x.searchParams,m);let _=yield cu(x.toString());if(!_.ok)throw new Cs(_,u_[_.status]??"");return yield _.json()})}function FT(u){return st(this,arguments,function*(g,m={}){if(!g.length)return[];let x=g.map(B=>encodeURIComponent(B)).join(";"),_=new URL(`geocoding/${x}.json`,Ms.maptilerApiURL);bb(_.searchParams,m);let o=yield cu(_.toString());if(!o.ok)throw new Cs(o,u_[o.status]??"");let C=yield o.json();return g.length===1?[C]:C})}var wb={forward:DT,reverse:zT,byId:RT,batch:FT},fb={403:"Key is missing, invalid or restricted"};function BT(){return st(this,arguments,function*(g={}){let m=new URL("geolocation/ip.json",Ms.maptilerApiURL);m.searchParams.set("key",g.apiKey??ho.apiKey),"elevation"in g&&m.searchParams.set("elevation",g.elevation?"true":"false");let u=m.toString(),x=yield cu(u);if(!x.ok)throw new Cs(x,x.status in fb?fb[x.status]:"");return yield x.json()})}var ug={info:BT},l_={403:"Key is missing, invalid or restricted"};function OT(u){return st(this,arguments,function*(g,m={}){if(typeof g!="string"||g.trim().length===0)throw new Error("The query must be a non-empty string");let x=new URL(`coordinates/search/${g}.json`,Ms.maptilerApiURL);x.searchParams.set("key",m.apiKey??ho.apiKey),"limit"in m&&x.searchParams.set("limit",m.limit.toString()),"transformations"in m&&x.searchParams.set("transformations",m.transformations.toString()),"exports"in m&&x.searchParams.set("exports",m.exports.toString());let _=x.toString(),o=yield cu(_);if(!o.ok)throw new Cs(o,o.status in l_?l_[o.status]:"");return yield o.json()})}function jT(u){return st(this,arguments,function*(g,m={}){let x=(Array.isArray(g[0])?g:[g]).map($=>`${$[0]},${$[1]}`).join(";"),_=new URL(`coordinates/transform/${x}.json`,Ms.maptilerApiURL);_.searchParams.set("key",m.apiKey??ho.apiKey),"sourceCrs"in m&&_.searchParams.set("s_srs",m.sourceCrs.toString()),"targetCrs"in m&&_.searchParams.set("t_srs",m.targetCrs.toString()),"operations"in m&&_.searchParams.set("ops",(Array.isArray(m.operations)?m.operations:[m.operations]).join("|"));let o=_.toString(),C=yield cu(o);if(!C.ok)throw new Cs(C,C.status in l_?l_[C.status]:"");return yield C.json()})}var Tb={search:OT,transform:jT},gb={403:"Key is missing, invalid or restricted"};function UT(u){return st(this,arguments,function*(g,m={}){if(typeof g!="string"||g.trim().length===0)throw new Error("The data ID must be a non-empty string");let x=new URL(`data/${encodeURIComponent(g)}/features.json`,Ms.maptilerApiURL);x.searchParams.set("key",m.apiKey??ho.apiKey);let _=x.toString(),o=yield cu(_);if(!o.ok)throw new Cs(o,o.status in gb?gb[o.status]:"");return yield o.json()})}var Sb={get:UT};function hg(g){let m=/^maptiler:\/\/(.*)/,u,x=g.trim(),_;return x.startsWith("http://")||x.startsWith("https://")?_=x:(u=m.exec(x))!==null?_=`https://api.maptiler.com/maps/${u[1]}/style.json`:_=`https://api.maptiler.com/maps/${x}/style.json`,_}var Kh=class{constructor(m,u,x,_,o,C,B=!1){this.name=m,this.variantType=u,this.id=x,this.referenceStyle=_,this.description=o,this.imageURL=C,this.deprecated=B}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(m){return this.referenceStyle.hasVariant(m)}getVariant(m){let u=this.referenceStyle.getVariant(m);return this.warnIfDeprecated(u),u}getVariants(){return this.referenceStyle.getVariants().filter(m=>m!==this).map(m=>(this.warnIfDeprecated(m),m))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return hg(this.getId())}warnIfDeprecated(m=this){if(!m.deprecated)return m;let u=m.getFullName();return console.warn(`Style "${u}" is deprecated and will be removed in a future version.`),m}},Yh=class{constructor(m,u){this.name=m,this.id=u,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(m){this.variants[m.getType()]=m,this.orderedVariants.push(m)}hasVariant(m){return m in this.variants}getVariant(m){return m in this.variants?this.variants[m]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}},Lh=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",deprecated:!0,name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function NT(g){return new Proxy(g,{get(m,u,x){return m.hasVariant(u)?m.getVariant(u):u.toString().toUpperCase()===u?g.getDefaultVariant():Reflect.get(m,u,x)}})}function VT(){let g={};for(let m=0;m<Lh.length;m+=1){let u=Lh[m],x=NT(new Yh(u.name,u.referenceStyleID));for(let _=0;_<u.variants.length;_+=1){let o=u.variants[_],C=new Kh(o.name,o.variantType,o.id,x,o.description,o.imageURL,o.deprecated);x.addVariant(C)}g[u.referenceStyleID]=x}return g}function pg(g){if(!g)return $l[Lh[0].referenceStyleID].getDefaultVariant().getId();if(typeof g=="string"||g instanceof String)return g.trim().toLowerCase();if(g instanceof Kh)return g.getId();if(g instanceof Yh)return g.getDefaultVariant().getId()}var $l=VT();function $T(g){let m=[];function u(o){(o.type==="LineString"||o.type==="MultiLineString")&&m.push(o)}function x(o){o.geometry&&u(o.geometry)}function _(o){for(let C of o.features)C.type==="Feature"?x(C):C.type==="FeatureCollection"&&_(C)}return g.type==="Feature"?x(g):g.type==="FeatureCollection"?_(g):u(g),m}function GT(g,m,u){let x=m[0],_=m[1],o=u[0]-x,C=u[1]-_;if(o!==0||C!==0){let B=((g[0]-x)*o+(g[1]-_)*C)/(o*o+C*C);B>1?(x=u[0],_=u[1]):B>0&&(x+=o*B,_+=C*B)}return o=g[0]-x,C=g[1]-_,o*o+C*C}function Mv(g,m,u,x,_){let o=x,C;for(let B=m+1;B<u;B++){let $=GT(g[B],g[m],g[u]);$>o&&(C=B,o=$)}o>x&&(C-m>1&&Mv(g,m,C,x,_),_.push(g[C]),u-C>1&&Mv(g,C,u,x,_))}function ZT(g,m){let u=g.length-1,x=[g[0]];return Mv(g,0,u,m,x),x.push(g[u]),x}function qT(g,m){if(g.length<=2)return g;let u=m!==void 0?m*m:1;return ZT(g,u)}var kv={extractLineStrings:$T,simplify:qT};function Lv(g,m=!0){let u=`${g[0]},${g[1]}`;return g.length===3&&m&&(u+=`,${g[2]}`),u}function Dv(g,m=3e3){let u=g.map(o=>o.join(",")).join("|"),x=5e-6,_=1e-5;for(;u.length>m;)u=kv.simplify(g,x).map(C=>`${C[0]},${C[1]}`).join("|"),x+=_;return u}function WT(g,m,u={}){let x=pg(u.style),_=u.hiDPI?"@2x":"",o=u.format??"png",C=~~(u.width??1024),B=~~(u.height??1024);u.hiDPI&&(C=~~(C/2),B=~~(B/2));let $=new URL(`maps/${encodeURIComponent(x)}/static/${g[0]},${g[1]},${m}/${C}x${B}${_}.${o}`,Ms.maptilerApiURL);if("attribution"in u&&$.searchParams.set("attribution",u.attribution.toString()),"markers"in u){let Y="",ne="markerIcon"in u;ne&&(Y+=`icon:${u.markerIcon}|`),ne&&"markerAnchor"in u&&(Y+=`anchor:${u.markerAnchor}|`),ne&&u.hiDPI&&(Y+="scale:2|");let q=Array.isArray(u.markers[0])?u.markers:[u.markers];Y+=q.map(Ce=>Lv(Ce,!ne)).join("|"),$.searchParams.set("markers",Y)}if("path"in u){let Y="";if(Y+=`fill:${u.pathFillColor??"none"}|`,"pathStrokeColor"in u&&(Y+=`stroke:${u.pathStrokeColor}|`),"pathWidth"in u){let ne=u.pathWidth/(u.hiDPI?2:1);Y+=`width:${ne.toString()}|`}Y+=Dv(u.path),$.searchParams.set("path",Y)}return $.searchParams.set("key",u.apiKey??ho.apiKey),$.toString()}function HT(g,m={}){let u=pg(m.style),x=m.hiDPI?"@2x":"",_=m.format??"png",o=~~(m.width??1024),C=~~(m.height??1024);m.hiDPI&&(o=~~(o/2),C=~~(C/2));let B=new URL(`maps/${encodeURIComponent(u)}/static/${g[0]},${g[1]},${g[2]},${g[3]}/${o}x${C}${x}.${_}`,Ms.maptilerApiURL);if("attribution"in m&&B.searchParams.set("attribution",m.attribution.toString()),"padding"in m&&B.searchParams.set("padding",m.padding.toString()),"markers"in m){let $="",Y="markerIcon"in m;Y&&($+=`icon:${m.markerIcon}|`),Y&&"markerAnchor"in m&&($+=`anchor:${m.markerAnchor}|`),Y&&m.hiDPI&&($+="scale:2|");let ne=Array.isArray(m.markers[0])?m.markers:[m.markers];$+=ne.map(q=>Lv(q,!Y)).join("|"),B.searchParams.set("markers",$)}if("path"in m){let $="";if($+=`fill:${m.pathFillColor??"none"}|`,"pathStrokeColor"in m&&($+=`stroke:${m.pathStrokeColor}|`),"pathWidth"in m){let Y=m.pathWidth/(m.hiDPI?2:1);$+=`width:${Y.toString()}|`}$+=Dv(m.path),B.searchParams.set("path",$)}return B.searchParams.set("key",m.apiKey??ho.apiKey),B.toString()}function XT(g={}){if(!("markers"in g)&&!("path"in g))throw new Error("Automatic static maps require markers and/or path to be created.");let m=pg(g.style),u=g.hiDPI?"@2x":"",x=g.format??"png",_=~~(g.width??1024),o=~~(g.height??1024);g.hiDPI&&(_=~~(_/2),o=~~(o/2));let C=new URL(`maps/${encodeURIComponent(m)}/static/auto/${_}x${o}${u}.${x}`,Ms.maptilerApiURL);if("attribution"in g&&C.searchParams.set("attribution",g.attribution.toString()),"padding"in g&&C.searchParams.set("padding",g.padding.toString()),"markers"in g){let B="",$="markerIcon"in g;$&&(B+=`icon:${g.markerIcon}|`),$&&"markerAnchor"in g&&(B+=`anchor:${g.markerAnchor}|`),$&&g.hiDPI&&(B+="scale:2|");let Y=Array.isArray(g.markers[0])?g.markers:[g.markers];B+=Y.map(ne=>Lv(ne,!$)).join("|"),C.searchParams.set("markers",B)}if("path"in g){let B="";if(B+=`fill:${g.pathFillColor??"none"}|`,"pathStrokeColor"in g&&(B+=`stroke:${g.pathStrokeColor}|`),"pathWidth"in g){let $=g.pathWidth/(g.hiDPI?2:1);B+=`width:${$.toString()}|`}B+=Dv(g.path),C.searchParams.set("path",B)}return C.searchParams.set("key",g.apiKey??ho.apiKey),C.toString()}var Ib={centered:WT,bounded:HT,automatic:XT},h_=63710088e-1,Pb=2*Math.PI*h_;function Cb(g){return(180+g)/360}function Mb(g){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360)))/360}function Eb(g){let m=Lb(g);return[Cb(m[0]),Mb(m[1])]}function Ab(g){return g*360-180}function kb(g){let m=180-g*360;return 360/Math.PI*Math.atan(Math.exp(m*Math.PI/180))-90}function KT(g){return[Ab(g[0]),kb(g[1])]}function zv(g,m){let u=Math.PI/180,x=g[1]*u,_=m[1]*u,o=Math.sin(x)*Math.sin(_)+Math.cos(x)*Math.cos(_)*Math.cos((m[0]-g[0])*u);return h_*Math.acos(Math.min(o,1))}function YT(g){let m=Array(g.length);m[0]=0;let u=m.length;for(let x=1;x<u;x++)m[x]=zv(g[x-1],g[x])+m[x-1];return m}function Lb(g){let m=g[0],u=g[1],x=360,_=((m+180)%x+x)%x-180;return[_===-180?180:_,u]}function Rv(g){return Pb*Math.cos(g*Math.PI/180)}function Db(g,m,u=!0){let x=2**m,_=[g[0]*x,g[1]*x];return u?[~~_[0],~~_[1]]:_}function JT(g,m,u=!0){let x=Eb(g);return Db(x,m,u)}function cg(g){return g*Math.PI/180}function Ev(g){return g*180/Math.PI}function QT(g,m,u){let x=zv(g,m),_=cg(g[0]),o=cg(g[1]),C=cg(m[0]),B=cg(m[1]),$=x/h_,Y=Math.sin((1-u)*$)/Math.sin($),ne=Math.sin(u*$)/Math.sin($),q=Y*Math.cos(o)*Math.cos(_)+ne*Math.cos(B)*Math.cos(C),Ce=Y*Math.cos(o)*Math.sin(_)+ne*Math.cos(B)*Math.sin(C),Ie=Y*Math.sin(o)+ne*Math.sin(B),Ae=Math.atan2(Ie,Math.sqrt(q*q+Ce*Ce)),De=Math.atan2(Ce,q);return[Ev(De),Ev(Ae)]}var Fv={EARTH_RADIUS:h_,EARTH_CIRCUMFERENCE:Pb,longitudeToMercatorX:Cb,latitudeToMercatorY:Mb,wgs84ToMercator:Eb,mercatorXToLongitude:Ab,mercatorYToLatitude:kb,mercatorToWgs84:KT,haversineDistanceWgs84:zv,wrapWgs84:Lb,circumferenceAtLatitude:Rv,mercatorToTileIndex:Db,wgs84ToTileIndex:JT,toRadians:cg,toDegrees:Ev,haversineIntermediateWgs84:QT,haversineCumulatedDistanceWgs84:YT},Iv=null;function Bv(){return Iv||(Iv=new o_({maxSize:ho.tileCacheSize})),Iv}function Ov(g){return st(this,null,function*(){let m=new Blob([g]),u=yield createImageBitmap(m),x=document.createElement("canvas"),_=x.getContext("2d");x.width=u.width,x.height=u.height,_.drawImage(u,0,0);let o=_.getImageData(0,0,x.width,x.height);return{pixels:o.data,width:x.width,height:x.height,components:o.data.length/(x.width*x.height)}})}function jv(){if(ho.bufferToPixelData)return ho.bufferToPixelData;if(typeof window<"u")return Ov;throw new Error("An image file buffer to pixel data parser is necessary. Specify it in `config.bufferToPixelData`")}function p_(){return!!ho.bufferToPixelData||typeof window<"u"}var eS="terrain-rgb-v2",Pv=50,tS=1e3,a_=null,_b={403:"Key is missing, invalid or restricted"};function iS(g,m){return st(this,null,function*(){g.length>tS&&console.warn("Computing elevation for complex geometries is discouraged - simplify the geometry before proceeding");let u=Math.ceil(g.length/Pv),x=Array.from({length:u},()=>null).map((C,B)=>{let $=B*Pv,ne=g.slice($,$+Pv).map(Ce=>Ce.join(",")).join(";"),q=new URL(`elevation/${ne}.json`,Ms.maptilerApiURL);return q.searchParams.set("key",m),cu(q.toString())}),_=yield Promise.allSettled(x);return(yield Promise.all(_.map(C=>st(null,null,function*(){if(C.status==="rejected")throw new Error(`Some segments could not be fetched, error: ${C.reason}`);if(!C.value.ok)throw new Error(`Some segments could not be fetched, response: ${C.value.status} ${yield C.value.text()}, url: ${C.value.url}`);return C.value.json()})))).flat()})}function nS(g,m,u){return st(this,null,function*(){if(!a_){let tt=new URL(`tiles/${eS}/tiles.json`,Ms.maptilerApiURL);tt.searchParams.set("key",m);let At=tt.toString(),Yt=yield cu(At);if(Yt.ok)a_=yield Yt.json();else throw new Cs(Yt,_b[Yt.status]??"")}let x=jv(),_=a_.tiles[0],o=Bv(),C=a_.maxzoom,B=~~(u??C);(B>C||B<0)&&(B=C);let $=g.map(tt=>Fv.wgs84ToTileIndex(tt,B,!1)),ne=$.map(tt=>[~~tt[0],~~tt[1]]).map(tt=>`terrain_${B.toString()}_${tt[0].toString()}_${tt[1].toString()}`),q=Array.from(new Set(ne.filter(tt=>!o.has(tt)))).map(tt=>tt.split("_").slice(1)),Ie=q.map(tt=>_.replace("{x}",tt[1].toString()).replace("{y}",tt[2].toString()).replace("{z}",tt[0].toString())).map(tt=>cu(tt)),De=(yield Promise.allSettled(Ie)).map(tt=>tt.status==="fulfilled"?tt.value:null).filter(tt=>tt),qe=De.filter(tt=>!tt.ok);if(De.length!==Ie.length)throw new Error("Some tiles could not be fetched.");if(qe.length)throw new Cs(qe[0],_b[qe[0].status]??"");let Qe=yield Promise.all(De.map(tt=>tt.arrayBuffer()));if(!Qe.every(tt=>tt.byteLength>0))throw new Error("Some tiles are not available.");return(yield Promise.all(Qe.map(tt=>x(tt)))).forEach((tt,At)=>{let Yt=q[At],pn=`terrain_${Yt[0].toString()}_${Yt[1].toString()}_${Yt[2].toString()}`;o.set(pn,tt)}),g.map((tt,At)=>{let Yt=ne[At],pn=$[At],Ii=o.get(Yt),On=Math.min(Math.round(Ii.width*(pn[0]%1)),Ii.width-1),Vn=(Math.min(Math.round(Ii.height*(pn[1]%1)),Ii.height-1)*Ii.width+On)*Ii.components,mo=Ii.pixels[Vn],Ir=Ii.pixels[Vn+1],Pr=Ii.pixels[Vn+2],Cr=-1e4+(mo*256*256+Ir*256+Pr)*.1;return[tt[0],tt[1],~~(Cr*1e3)/1e3]})})}function rS(u){return st(this,arguments,function*(g,m={}){return(yield d_([g],m))[0]})}function d_(u){return st(this,arguments,function*(g,m={}){if(g.length===0)return[];let x=m.apiKey??ho.apiKey,_=m.computeOn==="client"?yield nS(g,x,m.zoom):yield iS(g,x);if(m.smoothingKernelSize){let o=~~(m.smoothingKernelSize/2)*2+1,C=_.map($=>$[2]),B=~~(o/2);for(let $=B;$<C.length-B-1;$+=1){let Y=0;for(let ne=0;ne<o;ne+=1){let q=C[$-B+ne];Y+=q}Y/=o,_[$][2]=Y}}return _})}function oS(u){return st(this,arguments,function*(g,m={}){if(g.type!=="LineString")throw new Error("The provided object is not a GeoJSON LineString");m.computeOn??(m.computeOn=p_()?"client":"server");let x=structuredClone(g),_=yield d_(x.coordinates,m);return x.coordinates=_,x})}function aS(u){return st(this,arguments,function*(g,m={}){if(g.type!=="MultiLineString")throw new Error("The provided object is not a GeoJSON MultiLineString");m.computeOn??(m.computeOn=p_()?"client":"server");let x=structuredClone(g),_=x.coordinates.map(Y=>Y.length),o=x.coordinates.flat(),C=yield d_(o,m),B=[],$=0;for(let Y of _)B.push(C.slice($,$+Y)),$+=Y;return x.coordinates=B,x})}var zb={at:rS,batch:d_,fromLineString:oS,fromMultiLineString:aS};var r2=_v(Zb(),1);var Aa=[];for(let g=0;g<256;++g)Aa.push((g+256).toString(16).slice(1));function qb(g,m=0){return(Aa[g[m+0]]+Aa[g[m+1]]+Aa[g[m+2]]+Aa[g[m+3]]+"-"+Aa[g[m+4]]+Aa[g[m+5]]+"-"+Aa[g[m+6]]+Aa[g[m+7]]+"-"+Aa[g[m+8]]+Aa[g[m+9]]+"-"+Aa[g[m+10]]+Aa[g[m+11]]+Aa[g[m+12]]+Aa[g[m+13]]+Aa[g[m+14]]+Aa[g[m+15]]).toLowerCase()}var Nv,dS=new Uint8Array(16);function Vv(){if(!Nv){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Nv=crypto.getRandomValues.bind(crypto)}return Nv(dS)}var mS=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$v={randomUUID:mS};function fS(g,m,u){if($v.randomUUID&&!m&&!g)return $v.randomUUID();g=g||{};let x=g.random??g.rng?.()??Vv();if(x.length<16)throw new Error("Random bytes length must be >= 16");if(x[6]=x[6]&15|64,x[8]=x[8]&63|128,m){if(u=u||0,u<0||u+16>m.length)throw new RangeError(`UUID byte range ${u}:${u+15} is out of buffer bounds`);for(let _=0;_<16;++_)m[u+_]=x[_];return m}return qb(x)}var Gv=fS;var Jb="3.7.8",gS=Jb,lm=typeof Buffer=="function",Wb=typeof TextDecoder=="function"?new TextDecoder:void 0,Hb=typeof TextEncoder=="function"?new TextEncoder:void 0,_S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",dg=Array.prototype.slice.call(_S),g_=(g=>{let m={};return g.forEach((u,x)=>m[u]=x),m})(dg),yS=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ka=String.fromCharCode.bind(String),Xb=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):g=>new Uint8Array(Array.prototype.slice.call(g,0)),Qb=g=>g.replace(/=/g,"").replace(/[+\/]/g,m=>m=="+"?"-":"_"),ew=g=>g.replace(/[^A-Za-z0-9\+\/]/g,""),tw=g=>{let m,u,x,_,o="",C=g.length%3;for(let B=0;B<g.length;){if((u=g.charCodeAt(B++))>255||(x=g.charCodeAt(B++))>255||(_=g.charCodeAt(B++))>255)throw new TypeError("invalid character found");m=u<<16|x<<8|_,o+=dg[m>>18&63]+dg[m>>12&63]+dg[m>>6&63]+dg[m&63]}return C?o.slice(0,C-3)+"===".substring(C):o},Wv=typeof btoa=="function"?g=>btoa(g):lm?g=>Buffer.from(g,"binary").toString("base64"):tw,Zv=lm?g=>Buffer.from(g).toString("base64"):g=>{let u=[];for(let x=0,_=g.length;x<_;x+=4096)u.push(ka.apply(null,g.subarray(x,x+4096)));return Wv(u.join(""))},__=(g,m=!1)=>m?Qb(Zv(g)):Zv(g),vS=g=>{if(g.length<2){var m=g.charCodeAt(0);return m<128?g:m<2048?ka(192|m>>>6)+ka(128|m&63):ka(224|m>>>12&15)+ka(128|m>>>6&63)+ka(128|m&63)}else{var m=65536+(g.charCodeAt(0)-55296)*1024+(g.charCodeAt(1)-56320);return ka(240|m>>>18&7)+ka(128|m>>>12&63)+ka(128|m>>>6&63)+ka(128|m&63)}},xS=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,iw=g=>g.replace(xS,vS),Kb=lm?g=>Buffer.from(g,"utf8").toString("base64"):Hb?g=>Zv(Hb.encode(g)):g=>Wv(iw(g)),sm=(g,m=!1)=>m?Qb(Kb(g)):Kb(g),Yb=g=>sm(g,!0),bS=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,wS=g=>{switch(g.length){case 4:var m=(7&g.charCodeAt(0))<<18|(63&g.charCodeAt(1))<<12|(63&g.charCodeAt(2))<<6|63&g.charCodeAt(3),u=m-65536;return ka((u>>>10)+55296)+ka((u&1023)+56320);case 3:return ka((15&g.charCodeAt(0))<<12|(63&g.charCodeAt(1))<<6|63&g.charCodeAt(2));default:return ka((31&g.charCodeAt(0))<<6|63&g.charCodeAt(1))}},nw=g=>g.replace(bS,wS),rw=g=>{if(g=g.replace(/\s+/g,""),!yS.test(g))throw new TypeError("malformed base64.");g+="==".slice(2-(g.length&3));let m,u,x,_=[];for(let o=0;o<g.length;)m=g_[g.charAt(o++)]<<18|g_[g.charAt(o++)]<<12|(u=g_[g.charAt(o++)])<<6|(x=g_[g.charAt(o++)]),u===64?_.push(ka(m>>16&255)):x===64?_.push(ka(m>>16&255,m>>8&255)):_.push(ka(m>>16&255,m>>8&255,m&255));return _.join("")},Hv=typeof atob=="function"?g=>atob(ew(g)):lm?g=>Buffer.from(g,"base64").toString("binary"):rw,ow=lm?g=>Xb(Buffer.from(g,"base64")):g=>Xb(Hv(g).split("").map(m=>m.charCodeAt(0))),aw=g=>ow(sw(g)),TS=lm?g=>Buffer.from(g,"base64").toString("utf8"):Wb?g=>Wb.decode(ow(g)):g=>nw(Hv(g)),sw=g=>ew(g.replace(/[-_]/g,m=>m=="-"?"+":"/")),qv=g=>TS(sw(g)),SS=g=>{if(typeof g!="string")return!1;let m=g.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(m)||!/[^\s0-9a-zA-Z\-_]/.test(m)},lw=g=>({value:g,enumerable:!1,writable:!0,configurable:!0}),cw=function(){let g=(m,u)=>Object.defineProperty(String.prototype,m,lw(u));g("fromBase64",function(){return qv(this)}),g("toBase64",function(m){return sm(this,m)}),g("toBase64URI",function(){return sm(this,!0)}),g("toBase64URL",function(){return sm(this,!0)}),g("toUint8Array",function(){return aw(this)})},uw=function(){let g=(m,u)=>Object.defineProperty(Uint8Array.prototype,m,lw(u));g("toBase64",function(m){return __(this,m)}),g("toBase64URI",function(){return __(this,!0)}),g("toBase64URL",function(){return __(this,!0)})},IS=()=>{cw(),uw()},hw={version:Jb,VERSION:gS,atob:Hv,atobPolyfill:rw,btoa:Wv,btoaPolyfill:tw,fromBase64:qv,toBase64:sm,encode:sm,encodeURI:Yb,encodeURL:Yb,utob:iw,btou:nw,decode:qv,isValid:SS,fromUint8Array:__,toUint8Array:aw,extendString:cw,extendUint8Array:uw,extendBuiltins:IS};var PS=Object.defineProperty,n2=g=>{throw TypeError(g)},CS=(g,m,u)=>m in g?PS(g,m,{enumerable:!0,configurable:!0,writable:!0,value:u}):g[m]=u,Ft=(g,m,u)=>CS(g,typeof m!="symbol"?m+"":m,u),n1=(g,m,u)=>m.has(g)||n2("Cannot "+u),hn=(g,m,u)=>(n1(g,m,"read from private field"),u?u.call(g):m.get(g)),Ad=(g,m,u)=>m.has(g)?n2("Cannot add the same private member more than once"):m instanceof WeakSet?m.add(g):m.set(g,u),um=(g,m,u,x)=>(n1(g,m,"write to private field"),x?x.call(g,u):m.set(g,u),u),kl=(g,m,u)=>(n1(g,m,"access private method"),u),un=Vi({VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1}},lu);function lx(){if(typeof navigator>"u"){let g=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return kh(g)||un.ENGLISH}return Array.from(new Set(navigator.languages.map(g=>g.split("-")[0]))).map(g=>kh(g)).filter(g=>g)[0]??un.LOCAL}var xs={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:un.STYLE,secondaryLanguage:un.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(xs);var r1=Gv(),M_=class extends r2.default{constructor(){super(...arguments),Ft(this,"primaryLanguage",xs.primaryLanguage),Ft(this,"secondaryLanguage"),Ft(this,"session",!0),Ft(this,"caching",!0),Ft(this,"telemetry",!0),Ft(this,"_unit","metric"),Ft(this,"_apiKey","")}set unit(m){this._unit=m,this.emit("unit",m)}get unit(){return this._unit}set apiKey(m){this._apiKey=m,ho.apiKey=m,this.emit("apiKey",m)}get apiKey(){return this._apiKey}set fetch(m){ho.fetch=m}get fetch(){return ho.fetch}},xr=new M_,cx="localcache_source",ux="localcache",MS="maptiler_sdk",ES=1e3,AS=100,hx=typeof caches<"u",{addProtocol:pw}=Gt.default;function kS(g,m){if(hx&&xr.caching&&xr.session&&g.host===xs.maptilerApiHost){if(m==="Source"&&g.href.includes("tiles.json"))return g.href.replace("https://",`${cx}://`);if(m==="Tile"||m==="Glyphs")return g.href.replace("https://",`${ux}://`)}return g.href}var Xv;function o2(){return st(this,null,function*(){return Xv||(Xv=yield caches.open(MS)),Xv})}var dw=0;function LS(){return st(this,null,function*(){let g=yield o2(),m=yield g.keys(),u=m.slice(0,Math.max(m.length-ES,0));for(let x of u)g.delete(x)})}function DS(){pw(cx,(g,m)=>st(null,null,function*(){if(!g.url)throw new Error("");g.url=g.url.replace(`${cx}://`,"https://");let u=g;u.signal=m.signal;let x=yield fetch(g.url,u),_=yield x.json();return _.tiles&&_.tiles.length>0&&(_.tiles[0]+=`&last-modified=${x.headers.get("Last-Modified")}`),{data:_,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})),pw(ux,(g,m)=>st(null,null,function*(){if(!g.url)throw new Error("");g.url=g.url.replace(`${ux}://`,"https://");let u=new URL(g.url),x=new URL(u);x.searchParams.delete("mtsid"),x.searchParams.delete("key");let _=x.toString(),o=new URL(u);o.searchParams.delete("last-modified");let C=o.toString(),B=Ce=>st(null,null,function*(){return{data:yield Ce.arrayBuffer(),cacheControl:Ce.headers.get("Cache-Control"),expires:Ce.headers.get("Expires")}}),$=yield o2(),Y=yield $.match(_);if(Y)return B(Y);let ne=g;ne.signal=m.signal;let q=yield fetch(C,ne);return q.status>=200&&q.status<300&&($.put(_,q.clone()).catch(()=>{}),++dw>AS&&(LS(),dw=0)),B(q)}))}function zS(){if(typeof window>"u")return;let g=Gt.default.getRTLTextPluginStatus();if(g==="unavailable"||g==="requested")try{Gt.default.setRTLTextPlugin(xs.rtlPluginURL,!0)}catch{}}function RS(g,m){for(let u of g)typeof m[u]=="function"&&(m[u]=m[u].bind(m))}function mw(g,m){let u=null;try{u=new URL(g)}catch{return{url:g}}return u.host===xs.maptilerApiHost&&(u.searchParams.has("key")||u.searchParams.append("key",xr.apiKey),xr.session&&u.searchParams.append("mtsid",r1)),{url:kS(u,m)}}function fw(g){return(m,u)=>{if(g!=null){let x=g(m,u),_=mw(x?.url??"",u);return Vi(Vi({},x),_)}return mw(m,u)}}function a2(){return Math.random().toString(36).substring(2)}function ey(g){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(g)}function FS(g){try{return JSON.parse(g)}catch{}return null}function s2(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function BS(g){let m=s2();if(!m)return;let u=null;if(typeof g=="string"?u=document.getElementById(g):g instanceof HTMLElement&&(u=g),!u)throw new Error("The Map container must be provided.");let x=document.createElement("div");throw x.innerHTML=m,x.classList.add("webgl-warning-div"),u.appendChild(x),new Error(m)}function OS(g){let m="The WebGL context was lost.",u=g.getContainer(),x=document.createElement("div");x.innerHTML=m,x.classList.add("webgl-warning-div"),u.appendChild(x)}function gw(g,m){return!(!Array.isArray(g)||g.length!==2||g[0]!=="get"||typeof g[1]!="string"||m&&!g[1].startsWith("name:")||!m&&g[1]!=="name")}function jS(g,m,u){let x=structuredClone(g),_=o=>{if(typeof o!="string")for(let C=0;C<o.length;C+=1)gw(o[C],u)?o[C]=structuredClone(m):_(o[C])};return gw(x,u)?m:(_(x),x)}function US(g,m){let u=m?/\{name:\S+\}/:/\{name\}/;return{contains:u.test(g),exactMatch:new RegExp(`^${u.source}$`).test(g)}}function NS(g,m,u){let x=u?/\{name:\S+\}/:/\{name\}/,_=g.split(x);return["concat",..._.flatMap((o,C)=>C===_.length-1?[o]:[o,m])]}function VS(g){var m;let u=/\{name(?::(?<language>\S+))?\}/g,x=[];for(;;){let _=u.exec(g);if(!_)break;let o=((m=_.groups)==null?void 0:m.language)??null;x.push(o)}return x}function $S(g){return!Array.isArray(g)||g.length!==2||g[0]!=="get"||typeof g[1]!="string"?null:g[1].trim()==="name"?{isLanguage:!0,localization:null}:g[1].trim().startsWith("name:")?{isLanguage:!0,localization:g[1].trim().split(":").pop()}:null}function GS(g){let m=[],u=structuredClone(g),x=_=>{if(typeof _!="string")for(let o=0;o<_.length;o+=1){let C=$S(_[o]);C?m.push(C.localization):x(_[o])}};return x([u]),m}function ZS(g,m){let u=[];for(let o of g){if(o.type!=="symbol")continue;let C=o,{id:B,layout:$}=C;if(!$||!("text-field"in $))continue;let Y=m.getLayoutProperty(B,"text-field");if(Y)if(typeof Y=="string"){let ne=VS(Y);u.push(ne)}else{let ne=GS(Y);u.push(ne)}}let x=u.flat(),_={unlocalized:0,localized:{}};for(let o of x)o===null?_.unlocalized+=1:(o in _.localized||(_.localized[o]=0),_.localized[o]+=1);return _}var ty=class extends Gt.default.Marker{addTo(g){return super.addTo(g)}},px=class extends Gt.default.Popup{addTo(m){return super.addTo(m)}},dx=class extends Gt.default.Style{constructor(m,u={}){super(m,u)}},mx=class extends Gt.default.CanvasSource{onAdd(m){super.onAdd(m)}},fx=class extends Gt.default.GeoJSONSource{onAdd(m){super.onAdd(m)}},gx=class extends Gt.default.ImageSource{onAdd(m){super.onAdd(m)}},_x=class extends Gt.default.RasterTileSource{onAdd(m){super.onAdd(m)}},yx=class extends Gt.default.RasterDEMTileSource{onAdd(m){super.onAdd(m)}},vx=class extends Gt.default.VectorTileSource{onAdd(m){super.onAdd(m)}},xx=class extends Gt.default.VideoSource{onAdd(m){super.onAdd(m)}},gm=class extends Gt.default.NavigationControl{onAdd(m){return super.onAdd(m)}},E_=class extends Gt.default.GeolocateControl{onAdd(m){return super.onAdd(m)}},bg=class extends Gt.default.AttributionControl{onAdd(m){return super.onAdd(m)}},A_=class extends Gt.default.LogoControl{onAdd(m){return super.onAdd(m)}},k_=class extends Gt.default.ScaleControl{onAdd(m){return super.onAdd(m)}},L_=class extends Gt.default.FullscreenControl{onAdd(m){return super.onAdd(m)}},bx=class extends Gt.default.TerrainControl{onAdd(m){return super.onAdd(m)}},wx=class extends Gt.default.BoxZoomHandler{constructor(m,u){super(m,u)}},Tx=class extends Gt.default.ScrollZoomHandler{constructor(m,u){super(m,u)}},Sx=class extends Gt.default.CooperativeGesturesHandler{constructor(m,u){super(m,u)}},Ix=class extends Gt.default.KeyboardHandler{constructor(m){super(m)}},Px=class extends Gt.default.TwoFingersTouchPitchHandler{constructor(m){super(m)}},Cx=class extends Gt.default.MapWheelEvent{constructor(m,u,x){super(m,u,x)}},Mx=class extends Gt.default.MapTouchEvent{constructor(m,u,x){super(m,u,x)}},Ex=class extends Gt.default.MapMouseEvent{constructor(m,u,x,_={}){super(m,u,x,_)}},wg=class extends A_{constructor(m={}){super(m),Ft(this,"logoURL",""),Ft(this,"linkURL",""),this.logoURL=m.logoURL??xs.maptilerLogoURL,this.linkURL=m.linkURL??xs.maptilerURL}onAdd(m){this._map=m,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";let u=window.document.createElement("a");return u.style.backgroundRepeat="no-repeat",u.style.cursor="pointer",u.style.display="block",u.style.height="23px",u.style.margin="0 0 -4px -4px",u.style.overflow="hidden",u.style.width="88px",u.style.backgroundImage=`url(${this.logoURL})`,u.style.backgroundSize="100px 30px",u.style.width="100px",u.style.height="30px",u.target="_blank",u.rel="noopener",u.href=this.linkURL,u.setAttribute("aria-label","MapTiler logo"),u.setAttribute("rel","noopener"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}},qS=8,WS={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},HS={"*":{type:"source"}},XS=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],KS={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},YS={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},JS={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},QS={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},eI={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},tI={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},iI={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},nI=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],rI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},oI={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},aI={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},sI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},lI={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},cI={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},uI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},hI={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},pI={type:"array",value:"*"},dI={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},mI={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},fI={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},gI={type:"array",value:"*",minimum:1},_I={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},yI={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},vI={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},xI={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},bI=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],wI={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},TI={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},SI={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},II={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},PI={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},CI={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},MI={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},EI={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},AI={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},kI={"*":{type:"string"}},LI={$version:qS,$root:WS,sources:HS,source:XS,source_vector:KS,source_raster:YS,source_raster_dem:JS,source_geojson:QS,source_video:eI,source_image:tI,layer:iI,layout:nI,layout_background:rI,layout_fill:oI,layout_circle:aI,layout_heatmap:sI,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:lI,layout_symbol:cI,layout_raster:uI,layout_hillshade:hI,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:pI,filter_operator:dI,geometry_type:mI,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:fI,expression:gI,light:_I,sky:yI,terrain:vI,projection:xI,paint:bI,paint_fill:wI,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:TI,paint_circle:SI,paint_heatmap:II,paint_symbol:PI,paint_raster:CI,paint_hillshade:MI,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:EI,transition:AI,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:kI},mt=class{constructor(m,u,x,_){this.message=(m?`${m}: `:"")+x,_&&(this.identifier=_),u!=null&&u.__line__&&(this.line=u.__line__)}};function D_(g,...m){for(let u of m)for(let x in u)g[x]=u[x];return g}var ql=class extends Error{constructor(m,u){super(u),this.message=u,this.key=m}},Ax=class g{constructor(m,u=[]){this.parent=m,this.bindings={};for(let[x,_]of u)this.bindings[x]=_}concat(m){return new g(this,m)}get(m){if(this.bindings[m])return this.bindings[m];if(this.parent)return this.parent.get(m);throw new Error(`${m} not found in scope.`)}has(m){return this.bindings[m]?!0:this.parent?this.parent.has(m):!1}},iy={kind:"null"},St={kind:"number"},$i={kind:"string"},Di={kind:"boolean"},_u={kind:"color"},ny={kind:"projectionDefinition"},Rd={kind:"object"},Li={kind:"value"},DI={kind:"error"},ry={kind:"collator"},oy={kind:"formatted"},ay={kind:"padding"},Tg={kind:"colorArray"},sy={kind:"numberArray"},Bg={kind:"resolvedImage"},ly={kind:"variableAnchorOffsetCollection"};function Dl(g,m){return{kind:"array",itemType:g,N:m}}function Sr(g){if(g.kind==="array"){let m=Sr(g.itemType);return typeof g.N=="number"?`array<${m}, ${g.N}>`:g.itemType.kind==="value"?"array":`array<${m}>`}else return g.kind}var zI=[iy,St,$i,Di,_u,ny,oy,Rd,Dl(Li),ay,sy,Tg,Bg,ly];function Sg(g,m){if(m.kind==="error")return null;if(g.kind==="array"){if(m.kind==="array"&&(m.N===0&&m.itemType.kind==="value"||!Sg(g.itemType,m.itemType))&&(typeof g.N!="number"||g.N===m.N))return null}else{if(g.kind===m.kind)return null;if(g.kind==="value"){for(let u of zI)if(!Sg(u,m))return null}}return`Expected ${Sr(g)} but found ${Sr(m)} instead.`}function o1(g,m){return m.some(u=>u.kind===g.kind)}function Fd(g,m){return m.some(u=>u==="null"?g===null:u==="array"?Array.isArray(g):u==="object"?g&&!Array.isArray(g)&&typeof g=="object":u===typeof g)}function Jh(g,m){return g.kind==="array"&&m.kind==="array"?g.itemType.kind===m.itemType.kind&&typeof g.N=="number":g.kind===m.kind}var l2=.96422,c2=1,u2=.82521,h2=4/29,dm=6/29,p2=3*dm*dm,RI=dm*dm*dm,FI=Math.PI/180,BI=180/Math.PI;function d2(g){return g=g%360,g<0&&(g+=360),g}function m2([g,m,u,x]){g=Kv(g),m=Kv(m),u=Kv(u);let _,o,C=Yv((.2225045*g+.7168786*m+.0606169*u)/c2);g===m&&m===u?_=o=C:(_=Yv((.4360747*g+.3850649*m+.1430804*u)/l2),o=Yv((.0139322*g+.0971045*m+.7141733*u)/u2));let B=116*C-16;return[B<0?0:B,500*(_-C),200*(C-o),x]}function Kv(g){return g<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4)}function Yv(g){return g>RI?Math.pow(g,1/3):g/p2+h2}function f2([g,m,u,x]){let _=(g+16)/116,o=isNaN(m)?_:_+m/500,C=isNaN(u)?_:_-u/200;return _=c2*Qv(_),o=l2*Qv(o),C=u2*Qv(C),[Jv(3.1338561*o-1.6168667*_-.4906146*C),Jv(-.9787684*o+1.9161415*_+.033454*C),Jv(.0719453*o-.2289914*_+1.4052427*C),x]}function Jv(g){return g=g<=.00304?12.92*g:1.055*Math.pow(g,1/2.4)-.055,g<0?0:g>1?1:g}function Qv(g){return g>dm?g*g*g:p2*(g-h2)}function OI(g){let[m,u,x,_]=m2(g),o=Math.sqrt(u*u+x*x);return[Math.round(o*1e4)?d2(Math.atan2(x,u)*BI):NaN,o,m,_]}function jI([g,m,u,x]){return g=isNaN(g)?0:g*FI,f2([u,Math.cos(g)*m,Math.sin(g)*m,x])}function UI([g,m,u,x]){g=d2(g),m/=100,u/=100;function _(o){let C=(o+g/30)%12,B=m*Math.min(u,1-u);return u-B*Math.max(-1,Math.min(C-3,9-C,1))}return[_(0),_(8),_(4),x]}var NI=Object.hasOwn||function(g,m){return Object.prototype.hasOwnProperty.call(g,m)};function _g(g,m){return NI(g,m)?g[m]:void 0}function VI(g){if(g=g.toLowerCase().trim(),g==="transparent")return[0,0,0,0];let m=_g($I,g);if(m){let[_,o,C]=m;return[_/255,o/255,C/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){let _=g.length<6?1:2,o=1;return[y_(g.slice(o,o+=_)),y_(g.slice(o,o+=_)),y_(g.slice(o,o+=_)),y_(g.slice(o,o+_)||"ff")]}if(g.startsWith("rgb")){let _=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,o=g.match(_);if(o){let[C,B,$,Y,ne,q,Ce,Ie,Ae,De,qe,Qe]=o,nt=[Y||" ",Ce||" ",De].join("");if(nt==="  "||nt==="  /"||nt===",,"||nt===",,,"){let vt=[$,q,Ae].join(""),tt=vt==="%%%"?100:vt===""?255:0;if(tt){let At=[hm(+B/tt,0,1),hm(+ne/tt,0,1),hm(+Ie/tt,0,1),qe?_w(+qe,Qe):1];if(yw(At))return At}}return}}let u=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,x=g.match(u);if(x){let[_,o,C,B,$,Y,ne,q,Ce]=x,Ie=[C||" ",$||" ",ne].join("");if(Ie==="  "||Ie==="  /"||Ie===",,"||Ie===",,,"){let Ae=[+o,hm(+B,0,100),hm(+Y,0,100),q?_w(+q,Ce):1];if(yw(Ae))return UI(Ae)}}}function y_(g){return parseInt(g.padEnd(2,g),16)/255}function _w(g,m){return hm(m?g/100:g,0,1)}function hm(g,m,u){return Math.min(Math.max(m,g),u)}function yw(g){return!g.some(Number.isNaN)}var $I={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Bd(g,m,u){return g+u*(m-g)}function Ig(g,m,u){return g.map((x,_)=>Bd(x,m[_],u))}var sr=class g{constructor(m,u,x,_=1,o=!0){this.r=m,this.g=u,this.b=x,this.a=_,o||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[m,u,x,_]))}static parse(m){if(m instanceof g)return m;if(typeof m!="string")return;let u=VI(m);if(u)return new g(...u,!1)}get rgb(){let{r:m,g:u,b:x,a:_}=this,o=_||1/0;return this.overwriteGetter("rgb",[m/o,u/o,x/o,_])}get hcl(){return this.overwriteGetter("hcl",OI(this.rgb))}get lab(){return this.overwriteGetter("lab",m2(this.rgb))}overwriteGetter(m,u){return Object.defineProperty(this,m,{value:u}),u}toString(){let[m,u,x,_]=this.rgb;return`rgba(${[m,u,x].map(o=>Math.round(o*255)).join(",")},${_})`}static interpolate(m,u,x,_="rgb"){switch(_){case"rgb":{let[o,C,B,$]=Ig(m.rgb,u.rgb,x);return new g(o,C,B,$,!1)}case"hcl":{let[o,C,B,$]=m.hcl,[Y,ne,q,Ce]=u.hcl,Ie,Ae;if(!isNaN(o)&&!isNaN(Y)){let vt=Y-o;Y>o&&vt>180?vt-=360:Y<o&&o-Y>180&&(vt+=360),Ie=o+x*vt}else isNaN(o)?isNaN(Y)?Ie=NaN:(Ie=Y,(B===1||B===0)&&(Ae=ne)):(Ie=o,(q===1||q===0)&&(Ae=C));let[De,qe,Qe,nt]=jI([Ie,Ae??Bd(C,ne,x),Bd(B,q,x),Bd($,Ce,x)]);return new g(De,qe,Qe,nt,!1)}case"lab":{let[o,C,B,$]=f2(Ig(m.lab,u.lab,x));return new g(o,C,B,$,!1)}}}};sr.black=new sr(0,0,0,1);sr.white=new sr(1,1,1,1);sr.transparent=new sr(0,0,0,0);sr.red=new sr(1,0,0,1);var Pg=class{constructor(m,u,x){m?this.sensitivity=u?"variant":"case":this.sensitivity=u?"accent":"base",this.locale=x,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(m,u){return this.collator.compare(m,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}},GI=["bottom","center","top"],Cg=class{constructor(m,u,x,_,o,C){this.text=m,this.image=u,this.scale=x,this.fontStack=_,this.textColor=o,this.verticalAlign=C}},jd=class g{constructor(m){this.sections=m}static fromString(m){return new g([new Cg(m,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(m=>m.text.length!==0||m.image&&m.image.name.length!==0)}static factory(m){return m instanceof g?m:g.fromString(m)}toString(){return this.sections.length===0?"":this.sections.map(m=>m.text).join("")}},zh=class g{constructor(m){this.values=m.slice()}static parse(m){if(m instanceof g)return m;if(typeof m=="number")return new g([m,m,m,m]);if(Array.isArray(m)&&!(m.length<1||m.length>4)){for(let u of m)if(typeof u!="number")return;switch(m.length){case 1:m=[m[0],m[0],m[0],m[0]];break;case 2:m=[m[0],m[1],m[0],m[1]];break;case 3:m=[m[0],m[1],m[2],m[1]];break}return new g(m)}}toString(){return JSON.stringify(this.values)}static interpolate(m,u,x){return new g(Ig(m.values,u.values,x))}},Rh=class g{constructor(m){this.values=m.slice()}static parse(m){if(m instanceof g)return m;if(typeof m=="number")return new g([m]);if(Array.isArray(m)){for(let u of m)if(typeof u!="number")return;return new g(m)}}toString(){return JSON.stringify(this.values)}static interpolate(m,u,x){return new g(Ig(m.values,u.values,x))}},hu=class g{constructor(m){this.values=m.slice()}static parse(m){if(m instanceof g)return m;if(typeof m=="string"){let x=sr.parse(m);return x?new g([x]):void 0}if(!Array.isArray(m))return;let u=[];for(let x of m){if(typeof x!="string")return;let _=sr.parse(x);if(!_)return;u.push(_)}return new g(u)}toString(){return JSON.stringify(this.values)}static interpolate(m,u,x,_="rgb"){let o=[];if(m.values.length!=u.values.length)throw new Error(`colorArray: Arrays have mismatched length (${m.values.length} vs. ${u.values.length}), cannot interpolate.`);for(let C=0;C<m.values.length;C++)o.push(sr.interpolate(m.values[C],u.values[C],x,_));return new g(o)}},br=class extends Error{constructor(m){super(m),this.name="RuntimeError"}toJSON(){return this.message}},ZI=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]),Fh=class g{constructor(m){this.values=m.slice()}static parse(m){if(m instanceof g)return m;if(!(!Array.isArray(m)||m.length<1||m.length%2!==0)){for(let u=0;u<m.length;u+=2){let x=m[u],_=m[u+1];if(typeof x!="string"||!ZI.has(x)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new g(m)}}toString(){return JSON.stringify(this.values)}static interpolate(m,u,x){let _=m.values,o=u.values;if(_.length!==o.length)throw new br(`Cannot interpolate values of different length. from: ${m.toString()}, to: ${u.toString()}`);let C=[];for(let B=0;B<_.length;B+=2){if(_[B]!==o[B])throw new br(`Cannot interpolate values containing mismatched anchors. from[${B}]: ${_[B]}, to[${B}]: ${o[B]}`);C.push(_[B]);let[$,Y]=_[B+1],[ne,q]=o[B+1];C.push([Bd($,ne,x),Bd(Y,q,x)])}return new g(C)}},rp=class g{constructor(m){this.name=m.name,this.available=m.available}toString(){return this.name}static fromString(m){return m?new g({name:m,available:!1}):null}},Ud=class g{constructor(m,u,x){this.from=m,this.to=u,this.transition=x}static interpolate(m,u,x){return new g(m,u,x)}static parse(m){if(m instanceof g)return m;if(Array.isArray(m)&&m.length===3&&typeof m[0]=="string"&&typeof m[1]=="string"&&typeof m[2]=="number")return new g(m[0],m[1],m[2]);if(typeof m=="object"&&typeof m.from=="string"&&typeof m.to=="string"&&typeof m.transition=="number")return new g(m.from,m.to,m.transition);if(typeof m=="string")return new g(m,m,1)}};function g2(g,m,u,x){return typeof g=="number"&&g>=0&&g<=255&&typeof m=="number"&&m>=0&&m<=255&&typeof u=="number"&&u>=0&&u<=255?typeof x>"u"||typeof x=="number"&&x>=0&&x<=1?null:`Invalid rgba value [${[g,m,u,x].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof x=="number"?[g,m,u,x]:[g,m,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mg(g){if(g===null||typeof g=="string"||typeof g=="boolean"||typeof g=="number"||g instanceof Ud||g instanceof sr||g instanceof Pg||g instanceof jd||g instanceof zh||g instanceof Rh||g instanceof hu||g instanceof Fh||g instanceof rp)return!0;if(Array.isArray(g)){for(let m of g)if(!Mg(m))return!1;return!0}else if(typeof g=="object"){for(let m in g)if(!Mg(g[m]))return!1;return!0}else return!1}function po(g){if(g===null)return iy;if(typeof g=="string")return $i;if(typeof g=="boolean")return Di;if(typeof g=="number")return St;if(g instanceof sr)return _u;if(g instanceof Ud)return ny;if(g instanceof Pg)return ry;if(g instanceof jd)return oy;if(g instanceof zh)return ay;if(g instanceof Rh)return sy;if(g instanceof hu)return Tg;if(g instanceof Fh)return ly;if(g instanceof rp)return Bg;if(Array.isArray(g)){let m=g.length,u;for(let x of g){let _=po(x);if(!u)u=_;else{if(u===_)continue;u=Li;break}}return Dl(u||Li,m)}else return Rd}function yg(g){let m=typeof g;return g===null?"":m==="string"||m==="number"||m==="boolean"?String(g):g instanceof sr||g instanceof Ud||g instanceof jd||g instanceof zh||g instanceof Rh||g instanceof hu||g instanceof Fh||g instanceof rp?g.toString():JSON.stringify(g)}var _m=class g{constructor(m,u){this.type=m,this.value=u}static parse(m,u){if(m.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${m.length-1} instead.`);if(!Mg(m[1]))return u.error("invalid value");let x=m[1],_=po(x),o=u.expectedType;return _.kind==="array"&&_.N===0&&o&&o.kind==="array"&&(typeof o.N!="number"||o.N===0)&&(_=o),new g(_,x)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}},v_={string:$i,number:St,boolean:Di,object:Rd},uu=class g{constructor(m,u){this.type=m,this.args=u}static parse(m,u){if(m.length<2)return u.error("Expected at least one argument.");let x=1,_,o=m[0];if(o==="array"){let B;if(m.length>2){let Y=m[1];if(typeof Y!="string"||!(Y in v_)||Y==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);B=v_[Y],x++}else B=Li;let $;if(m.length>3){if(m[2]!==null&&(typeof m[2]!="number"||m[2]<0||m[2]!==Math.floor(m[2])))return u.error('The length argument to "array" must be a positive integer literal',2);$=m[2],x++}_=Dl(B,$)}else{if(!v_[o])throw new Error(`Types doesn't contain name = ${o}`);_=v_[o]}let C=[];for(;x<m.length;x++){let B=u.parse(m[x],x,Li);if(!B)return null;C.push(B)}return new g(_,C)}evaluate(m){for(let u=0;u<this.args.length;u++){let x=this.args[u].evaluate(m);if(Sg(this.type,po(x))){if(u===this.args.length-1)throw new br(`Expected value to be of type ${Sr(this.type)}, but found ${Sr(po(x))} instead.`)}else return x}throw new Error}eachChild(m){this.args.forEach(m)}outputDefined(){return this.args.every(m=>m.outputDefined())}},vw={"to-boolean":Di,"to-color":_u,"to-number":St,"to-string":$i},ep=class g{constructor(m,u){this.type=m,this.args=u}static parse(m,u){if(m.length<2)return u.error("Expected at least one argument.");let x=m[0];if(!vw[x])throw new Error(`Can't parse ${x} as it is not part of the known types`);if((x==="to-boolean"||x==="to-string")&&m.length!==2)return u.error("Expected one argument.");let _=vw[x],o=[];for(let C=1;C<m.length;C++){let B=u.parse(m[C],C,Li);if(!B)return null;o.push(B)}return new g(_,o)}evaluate(m){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(m);case"color":{let u,x;for(let _ of this.args){if(u=_.evaluate(m),x=null,u instanceof sr)return u;if(typeof u=="string"){let o=m.parseColor(u);if(o)return o}else if(Array.isArray(u)&&(u.length<3||u.length>4?x=`Invalid rgba value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:x=g2(u[0],u[1],u[2],u[3]),!x))return new sr(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new br(x||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(let x of this.args){u=x.evaluate(m);let _=zh.parse(u);if(_)return _}throw new br(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"numberArray":{let u;for(let x of this.args){u=x.evaluate(m);let _=Rh.parse(u);if(_)return _}throw new br(`Could not parse numberArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"colorArray":{let u;for(let x of this.args){u=x.evaluate(m);let _=hu.parse(u);if(_)return _}throw new br(`Could not parse colorArray from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(let x of this.args){u=x.evaluate(m);let _=Fh.parse(u);if(_)return _}throw new br(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(let x of this.args){if(u=x.evaluate(m),u===null)return 0;let _=Number(u);if(!isNaN(_))return _}throw new br(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return jd.fromString(yg(this.args[0].evaluate(m)));case"resolvedImage":return rp.fromString(yg(this.args[0].evaluate(m)));case"projectionDefinition":return this.args[0].evaluate(m);default:return yg(this.args[0].evaluate(m))}}eachChild(m){this.args.forEach(m)}outputDefined(){return this.args.every(m=>m.outputDefined())}},qI=["Unknown","Point","LineString","Polygon"],z_=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qI[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(m){let u=this._parseColorCache.get(m);return u||(u=sr.parse(m),this._parseColorCache.set(m,u)),u}},R_=class g{constructor(m,u,x=[],_,o=new Ax,C=[]){this.registry=m,this.path=x,this.key=x.map(B=>`[${B}]`).join(""),this.scope=o,this.errors=C,this.expectedType=_,this._isConstant=u}parse(m,u,x,_,o={}){return u?this.concat(u,x,_)._parse(m,o):this._parse(m,o)}_parse(m,u){(m===null||typeof m=="string"||typeof m=="boolean"||typeof m=="number")&&(m=["literal",m]);function x(_,o,C){return C==="assert"?new uu(o,[_]):C==="coerce"?new ep(o,[_]):_}if(Array.isArray(m)){if(m.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let _=m[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let o=this.registry[_];if(o){let C=o.parse(m,this);if(!C)return null;if(this.expectedType){let B=this.expectedType,$=C.type;if((B.kind==="string"||B.kind==="number"||B.kind==="boolean"||B.kind==="object"||B.kind==="array")&&$.kind==="value")C=x(C,B,u.typeAnnotation||"assert");else if(B.kind==="projectionDefinition"&&["string","array"].includes($.kind)||["color","formatted","resolvedImage"].includes(B.kind)&&["value","string"].includes($.kind)||["padding","numberArray"].includes(B.kind)&&["value","number","array"].includes($.kind)||B.kind==="colorArray"&&["value","string","array"].includes($.kind)||B.kind==="variableAnchorOffsetCollection"&&["value","array"].includes($.kind))C=x(C,B,u.typeAnnotation||"coerce");else if(this.checkSubtype(B,$))return null}if(!(C instanceof _m)&&C.type.kind!=="resolvedImage"&&this._isConstant(C)){let B=new z_;try{C=new _m(C.type,C.evaluate(B))}catch($){return this.error($.message),null}}return C}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof m>"u"?this.error("'undefined' value invalid. Use null instead."):typeof m=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof m} instead.`)}concat(m,u,x){let _=typeof m=="number"?this.path.concat(m):this.path,o=x?this.scope.concat(x):this.scope;return new g(this.registry,this._isConstant,_,u||null,o,this.errors)}error(m,...u){let x=`${this.key}${u.map(_=>`[${_}]`).join("")}`;this.errors.push(new ql(x,m))}checkSubtype(m,u){let x=Sg(m,u);return x&&this.error(x),x}},F_=class g{constructor(m,u){this.type=u.type,this.bindings=[].concat(m),this.result=u}evaluate(m){return this.result.evaluate(m)}eachChild(m){for(let u of this.bindings)m(u[1]);m(this.result)}static parse(m,u){if(m.length<4)return u.error(`Expected at least 3 arguments, but found ${m.length-1} instead.`);let x=[];for(let o=1;o<m.length-1;o+=2){let C=m[o];if(typeof C!="string")return u.error(`Expected string, but found ${typeof C} instead.`,o);if(/[^a-zA-Z0-9_]/.test(C))return u.error("Variable names must contain only alphanumeric characters or '_'.",o);let B=u.parse(m[o+1],o+1);if(!B)return null;x.push([C,B])}let _=u.parse(m[m.length-1],m.length-1,u.expectedType,x);return _?new g(x,_):null}outputDefined(){return this.result.outputDefined()}},B_=class g{constructor(m,u){this.type=u.type,this.name=m,this.boundExpression=u}static parse(m,u){if(m.length!==2||typeof m[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");let x=m[1];return u.scope.has(x)?new g(x,u.scope.get(x)):u.error(`Unknown variable "${x}". Make sure "${x}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(m){return this.boundExpression.evaluate(m)}eachChild(){}outputDefined(){return!1}},kx=class g{constructor(m,u,x){this.type=m,this.index=u,this.input=x}static parse(m,u){if(m.length!==3)return u.error(`Expected 2 arguments, but found ${m.length-1} instead.`);let x=u.parse(m[1],1,St),_=u.parse(m[2],2,Dl(u.expectedType||Li));if(!x||!_)return null;let o=_.type;return new g(o.itemType,x,_)}evaluate(m){let u=this.index.evaluate(m),x=this.input.evaluate(m);if(u<0)throw new br(`Array index out of bounds: ${u} < 0.`);if(u>=x.length)throw new br(`Array index out of bounds: ${u} > ${x.length-1}.`);if(u!==Math.floor(u))throw new br(`Array index must be an integer, but found ${u} instead.`);return x[u]}eachChild(m){m(this.index),m(this.input)}outputDefined(){return!1}},Lx=class g{constructor(m,u){this.type=Di,this.needle=m,this.haystack=u}static parse(m,u){if(m.length!==3)return u.error(`Expected 2 arguments, but found ${m.length-1} instead.`);let x=u.parse(m[1],1,Li),_=u.parse(m[2],2,Li);return!x||!_?null:o1(x.type,[Di,$i,St,iy,Li])?new g(x,_):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(x.type)} instead`)}evaluate(m){let u=this.needle.evaluate(m),x=this.haystack.evaluate(m);if(!x)return!1;if(!Fd(u,["boolean","string","number","null"]))throw new br(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(po(u))} instead.`);if(!Fd(x,["string","array"]))throw new br(`Expected second argument to be of type array or string, but found ${Sr(po(x))} instead.`);return x.indexOf(u)>=0}eachChild(m){m(this.needle),m(this.haystack)}outputDefined(){return!0}},Dx=class g{constructor(m,u,x){this.type=St,this.needle=m,this.haystack=u,this.fromIndex=x}static parse(m,u){if(m.length<=2||m.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${m.length-1} instead.`);let x=u.parse(m[1],1,Li),_=u.parse(m[2],2,Li);if(!x||!_)return null;if(!o1(x.type,[Di,$i,St,iy,Li]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(x.type)} instead`);if(m.length===4){let o=u.parse(m[3],3,St);return o?new g(x,_,o):null}else return new g(x,_)}evaluate(m){let u=this.needle.evaluate(m),x=this.haystack.evaluate(m);if(!Fd(u,["boolean","string","number","null"]))throw new br(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(po(u))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(m)),Fd(x,["string"])){let o=x.indexOf(u,_);return o===-1?-1:[...x.slice(0,o)].length}else{if(Fd(x,["array"]))return x.indexOf(u,_);throw new br(`Expected second argument to be of type array or string, but found ${Sr(po(x))} instead.`)}}eachChild(m){m(this.needle),m(this.haystack),this.fromIndex&&m(this.fromIndex)}outputDefined(){return!1}},zx=class g{constructor(m,u,x,_,o,C){this.inputType=m,this.type=u,this.input=x,this.cases=_,this.outputs=o,this.otherwise=C}static parse(m,u){if(m.length<5)return u.error(`Expected at least 4 arguments, but found only ${m.length-1}.`);if(m.length%2!==1)return u.error("Expected an even number of arguments.");let x,_;u.expectedType&&u.expectedType.kind!=="value"&&(_=u.expectedType);let o={},C=[];for(let Y=2;Y<m.length-1;Y+=2){let ne=m[Y],q=m[Y+1];Array.isArray(ne)||(ne=[ne]);let Ce=u.concat(Y);if(ne.length===0)return Ce.error("Expected at least one branch label.");for(let Ae of ne){if(typeof Ae!="number"&&typeof Ae!="string")return Ce.error("Branch labels must be numbers or strings.");if(typeof Ae=="number"&&Math.abs(Ae)>Number.MAX_SAFE_INTEGER)return Ce.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ae=="number"&&Math.floor(Ae)!==Ae)return Ce.error("Numeric branch labels must be integer values.");if(!x)x=po(Ae);else if(Ce.checkSubtype(x,po(Ae)))return null;if(typeof o[String(Ae)]<"u")return Ce.error("Branch labels must be unique.");o[String(Ae)]=C.length}let Ie=u.parse(q,Y,_);if(!Ie)return null;_=_||Ie.type,C.push(Ie)}let B=u.parse(m[1],1,Li);if(!B)return null;let $=u.parse(m[m.length-1],m.length-1,_);return!$||B.type.kind!=="value"&&u.concat(1).checkSubtype(x,B.type)?null:new g(x,_,B,o,C,$)}evaluate(m){let u=this.input.evaluate(m);return(po(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(m)}eachChild(m){m(this.input),this.outputs.forEach(m),m(this.otherwise)}outputDefined(){return this.outputs.every(m=>m.outputDefined())&&this.otherwise.outputDefined()}},Rx=class g{constructor(m,u,x){this.type=m,this.branches=u,this.otherwise=x}static parse(m,u){if(m.length<4)return u.error(`Expected at least 3 arguments, but found only ${m.length-1}.`);if(m.length%2!==0)return u.error("Expected an odd number of arguments.");let x;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);let _=[];for(let C=1;C<m.length-1;C+=2){let B=u.parse(m[C],C,Di);if(!B)return null;let $=u.parse(m[C+1],C+1,x);if(!$)return null;_.push([B,$]),x=x||$.type}let o=u.parse(m[m.length-1],m.length-1,x);if(!o)return null;if(!x)throw new Error("Can't infer output type");return new g(x,_,o)}evaluate(m){for(let[u,x]of this.branches)if(u.evaluate(m))return x.evaluate(m);return this.otherwise.evaluate(m)}eachChild(m){for(let[u,x]of this.branches)m(u),m(x);m(this.otherwise)}outputDefined(){return this.branches.every(([m,u])=>u.outputDefined())&&this.otherwise.outputDefined()}},Fx=class g{constructor(m,u,x,_){this.type=m,this.input=u,this.beginIndex=x,this.endIndex=_}static parse(m,u){if(m.length<=2||m.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${m.length-1} instead.`);let x=u.parse(m[1],1,Li),_=u.parse(m[2],2,St);if(!x||!_)return null;if(!o1(x.type,[Dl(Li),$i,Li]))return u.error(`Expected first argument to be of type array or string, but found ${Sr(x.type)} instead`);if(m.length===4){let o=u.parse(m[3],3,St);return o?new g(x.type,x,_,o):null}else return new g(x.type,x,_)}evaluate(m){let u=this.input.evaluate(m),x=this.beginIndex.evaluate(m),_;if(this.endIndex&&(_=this.endIndex.evaluate(m)),Fd(u,["string"]))return[...u].slice(x,_).join("");if(Fd(u,["array"]))return u.slice(x,_);throw new br(`Expected first argument to be of type array or string, but found ${Sr(po(u))} instead.`)}eachChild(m){m(this.input),m(this.beginIndex),this.endIndex&&m(this.endIndex)}outputDefined(){return!1}};function _2(g,m){let u=g.length-1,x=0,_=u,o=0,C,B;for(;x<=_;)if(o=Math.floor((x+_)/2),C=g[o],B=g[o+1],C<=m){if(o===u||m<B)return o;x=o+1}else if(C>m)_=o-1;else throw new br("Input is not a number.");return 0}var O_=class g{constructor(m,u,x){this.type=m,this.input=u,this.labels=[],this.outputs=[];for(let[_,o]of x)this.labels.push(_),this.outputs.push(o)}static parse(m,u){if(m.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${m.length-1}.`);if((m.length-1)%2!==0)return u.error("Expected an even number of arguments.");let x=u.parse(m[1],1,St);if(!x)return null;let _=[],o=null;u.expectedType&&u.expectedType.kind!=="value"&&(o=u.expectedType);for(let C=1;C<m.length;C+=2){let B=C===1?-1/0:m[C],$=m[C+1],Y=C,ne=C+1;if(typeof B!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(_.length&&_[_.length-1][0]>=B)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',Y);let q=u.parse($,ne,o);if(!q)return null;o=o||q.type,_.push([B,q])}return new g(o,x,_)}evaluate(m){let u=this.labels,x=this.outputs;if(u.length===1)return x[0].evaluate(m);let _=this.input.evaluate(m);if(_<=u[0])return x[0].evaluate(m);let o=u.length;if(_>=u[o-1])return x[o-1].evaluate(m);let C=_2(u,_);return x[C].evaluate(m)}eachChild(m){m(this.input);for(let u of this.outputs)m(u)}outputDefined(){return this.outputs.every(m=>m.outputDefined())}};function WI(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var ex,xw;function HI(){if(xw)return ex;xw=1,ex=g;function g(m,u,x,_){this.cx=3*m,this.bx=3*(x-m)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(_-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=m,this.p1y=u,this.p2x=x,this.p2y=_}return g.prototype={sampleCurveX:function(m){return((this.ax*m+this.bx)*m+this.cx)*m},sampleCurveY:function(m){return((this.ay*m+this.by)*m+this.cy)*m},sampleCurveDerivativeX:function(m){return(3*this.ax*m+2*this.bx)*m+this.cx},solveCurveX:function(m,u){if(u===void 0&&(u=1e-6),m<0)return 0;if(m>1)return 1;for(var x=m,_=0;_<8;_++){var o=this.sampleCurveX(x)-m;if(Math.abs(o)<u)return x;var C=this.sampleCurveDerivativeX(x);if(Math.abs(C)<1e-6)break;x=x-o/C}var B=0,$=1;for(x=m,_=0;_<20&&(o=this.sampleCurveX(x),!(Math.abs(o-m)<u));_++)m>o?B=x:$=x,x=($-B)*.5+B;return x},solve:function(m,u){return this.sampleCurveY(this.solveCurveX(m,u))}},ex}var XI=HI(),KI=WI(XI),Dh=class g{constructor(m,u,x,_,o){this.type=m,this.operator=u,this.interpolation=x,this.input=_,this.labels=[],this.outputs=[];for(let[C,B]of o)this.labels.push(C),this.outputs.push(B)}static interpolationFactor(m,u,x,_){let o=0;if(m.name==="exponential")o=tx(u,m.base,x,_);else if(m.name==="linear")o=tx(u,1,x,_);else if(m.name==="cubic-bezier"){let C=m.controlPoints;o=new KI(C[0],C[1],C[2],C[3]).solve(tx(u,1,x,_))}return o}static parse(m,u){let[x,_,o,...C]=m;if(!Array.isArray(_)||_.length===0)return u.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){let Y=_[1];if(typeof Y!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:Y}}else if(_[0]==="cubic-bezier"){let Y=_.slice(1);if(Y.length!==4||Y.some(ne=>typeof ne!="number"||ne<0||ne>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:Y}}else return u.error(`Unknown interpolation type ${String(_[0])}`,1,0);if(m.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${m.length-1}.`);if((m.length-1)%2!==0)return u.error("Expected an even number of arguments.");if(o=u.parse(o,2,St),!o)return null;let B=[],$=null;(x==="interpolate-hcl"||x==="interpolate-lab")&&u.expectedType!=Tg?$=_u:u.expectedType&&u.expectedType.kind!=="value"&&($=u.expectedType);for(let Y=0;Y<C.length;Y+=2){let ne=C[Y],q=C[Y+1],Ce=Y+3,Ie=Y+4;if(typeof ne!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ce);if(B.length&&B[B.length-1][0]>=ne)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ce);let Ae=u.parse(q,Ie,$);if(!Ae)return null;$=$||Ae.type,B.push([ne,Ae])}return!Jh($,St)&&!Jh($,ny)&&!Jh($,_u)&&!Jh($,ay)&&!Jh($,sy)&&!Jh($,Tg)&&!Jh($,ly)&&!Jh($,Dl(St))?u.error(`Type ${Sr($)} is not interpolatable.`):new g($,x,_,o,B)}evaluate(m){let u=this.labels,x=this.outputs;if(u.length===1)return x[0].evaluate(m);let _=this.input.evaluate(m);if(_<=u[0])return x[0].evaluate(m);let o=u.length;if(_>=u[o-1])return x[o-1].evaluate(m);let C=_2(u,_),B=u[C],$=u[C+1],Y=g.interpolationFactor(this.interpolation,_,B,$),ne=x[C].evaluate(m),q=x[C+1].evaluate(m);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Bd(ne,q,Y);case"color":return sr.interpolate(ne,q,Y);case"padding":return zh.interpolate(ne,q,Y);case"colorArray":return hu.interpolate(ne,q,Y);case"numberArray":return Rh.interpolate(ne,q,Y);case"variableAnchorOffsetCollection":return Fh.interpolate(ne,q,Y);case"array":return Ig(ne,q,Y);case"projectionDefinition":return Ud.interpolate(ne,q,Y)}case"interpolate-hcl":switch(this.type.kind){case"color":return sr.interpolate(ne,q,Y,"hcl");case"colorArray":return hu.interpolate(ne,q,Y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return sr.interpolate(ne,q,Y,"lab");case"colorArray":return hu.interpolate(ne,q,Y,"lab")}}}eachChild(m){m(this.input);for(let u of this.outputs)m(u)}outputDefined(){return this.outputs.every(m=>m.outputDefined())}};function tx(g,m,u,x){let _=x-u,o=g-u;return _===0?0:m===1?o/_:(Math.pow(m,o)-1)/(Math.pow(m,_)-1)}sr.interpolate,zh.interpolate,Rh.interpolate,hu.interpolate,Fh.interpolate;var j_=class g{constructor(m,u){this.type=m,this.args=u}static parse(m,u){if(m.length<2)return u.error("Expected at least one argument.");let x=null,_=u.expectedType;_&&_.kind!=="value"&&(x=_);let o=[];for(let C of m.slice(1)){let B=u.parse(C,1+o.length,x,void 0,{typeAnnotation:"omit"});if(!B)return null;x=x||B.type,o.push(B)}if(!x)throw new Error("No output type");return _&&o.some(C=>Sg(_,C.type))?new g(Li,o):new g(x,o)}evaluate(m){let u=null,x=0,_;for(let o of this.args)if(x++,u=o.evaluate(m),u&&u instanceof rp&&!u.available&&(_||(_=u.name),u=null,x===this.args.length&&(u=_)),u!==null)break;return u}eachChild(m){this.args.forEach(m)}outputDefined(){return this.args.every(m=>m.outputDefined())}};function bw(g,m){return g==="=="||g==="!="?m.kind==="boolean"||m.kind==="string"||m.kind==="number"||m.kind==="null"||m.kind==="value":m.kind==="string"||m.kind==="number"||m.kind==="value"}function YI(g,m,u){return m===u}function JI(g,m,u){return m!==u}function QI(g,m,u){return m<u}function eP(g,m,u){return m>u}function tP(g,m,u){return m<=u}function iP(g,m,u){return m>=u}function y2(g,m,u,x){return x.compare(m,u)===0}function nP(g,m,u,x){return!y2(g,m,u,x)}function rP(g,m,u,x){return x.compare(m,u)<0}function oP(g,m,u,x){return x.compare(m,u)>0}function aP(g,m,u,x){return x.compare(m,u)<=0}function sP(g,m,u,x){return x.compare(m,u)>=0}function vm(g,m,u){let x=g!=="=="&&g!=="!=";return class v2{constructor(o,C,B){this.type=Di,this.lhs=o,this.rhs=C,this.collator=B,this.hasUntypedArgument=o.type.kind==="value"||C.type.kind==="value"}static parse(o,C){if(o.length!==3&&o.length!==4)return C.error("Expected two or three arguments.");let B=o[0],$=C.parse(o[1],1,Li);if(!$)return null;if(!bw(B,$.type))return C.concat(1).error(`"${B}" comparisons are not supported for type '${Sr($.type)}'.`);let Y=C.parse(o[2],2,Li);if(!Y)return null;if(!bw(B,Y.type))return C.concat(2).error(`"${B}" comparisons are not supported for type '${Sr(Y.type)}'.`);if($.type.kind!==Y.type.kind&&$.type.kind!=="value"&&Y.type.kind!=="value")return C.error(`Cannot compare types '${Sr($.type)}' and '${Sr(Y.type)}'.`);x&&($.type.kind==="value"&&Y.type.kind!=="value"?$=new uu(Y.type,[$]):$.type.kind!=="value"&&Y.type.kind==="value"&&(Y=new uu($.type,[Y])));let ne=null;if(o.length===4){if($.type.kind!=="string"&&Y.type.kind!=="string"&&$.type.kind!=="value"&&Y.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(ne=C.parse(o[3],3,ry),!ne)return null}return new v2($,Y,ne)}evaluate(o){let C=this.lhs.evaluate(o),B=this.rhs.evaluate(o);if(x&&this.hasUntypedArgument){let $=po(C),Y=po(B);if($.kind!==Y.kind||!($.kind==="string"||$.kind==="number"))throw new br(`Expected arguments for "${g}" to be (string, string) or (number, number), but found (${$.kind}, ${Y.kind}) instead.`)}if(this.collator&&!x&&this.hasUntypedArgument){let $=po(C),Y=po(B);if($.kind!=="string"||Y.kind!=="string")return m(o,C,B)}return this.collator?u(o,C,B,this.collator.evaluate(o)):m(o,C,B)}eachChild(o){o(this.lhs),o(this.rhs),this.collator&&o(this.collator)}outputDefined(){return!0}}}var lP=vm("==",YI,y2),cP=vm("!=",JI,nP),uP=vm("<",QI,rP),hP=vm(">",eP,oP),pP=vm("<=",tP,aP),dP=vm(">=",iP,sP),U_=class g{constructor(m,u,x){this.type=ry,this.locale=x,this.caseSensitive=m,this.diacriticSensitive=u}static parse(m,u){if(m.length!==2)return u.error("Expected one argument.");let x=m[1];if(typeof x!="object"||Array.isArray(x))return u.error("Collator options argument must be an object.");let _=u.parse(x["case-sensitive"]===void 0?!1:x["case-sensitive"],1,Di);if(!_)return null;let o=u.parse(x["diacritic-sensitive"]===void 0?!1:x["diacritic-sensitive"],1,Di);if(!o)return null;let C=null;return x.locale&&(C=u.parse(x.locale,1,$i),!C)?null:new g(_,o,C)}evaluate(m){return new Pg(this.caseSensitive.evaluate(m),this.diacriticSensitive.evaluate(m),this.locale?this.locale.evaluate(m):null)}eachChild(m){m(this.caseSensitive),m(this.diacriticSensitive),this.locale&&m(this.locale)}outputDefined(){return!1}},Bx=class g{constructor(m,u,x,_,o){this.type=$i,this.number=m,this.locale=u,this.currency=x,this.minFractionDigits=_,this.maxFractionDigits=o}static parse(m,u){if(m.length!==3)return u.error("Expected two arguments.");let x=u.parse(m[1],1,St);if(!x)return null;let _=m[2];if(typeof _!="object"||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");let o=null;if(_.locale&&(o=u.parse(_.locale,1,$i),!o))return null;let C=null;if(_.currency&&(C=u.parse(_.currency,1,$i),!C))return null;let B=null;if(_["min-fraction-digits"]&&(B=u.parse(_["min-fraction-digits"],1,St),!B))return null;let $=null;return _["max-fraction-digits"]&&($=u.parse(_["max-fraction-digits"],1,St),!$)?null:new g(x,o,C,B,$)}evaluate(m){return new Intl.NumberFormat(this.locale?this.locale.evaluate(m):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(m):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(m):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(m):void 0}).format(this.number.evaluate(m))}eachChild(m){m(this.number),this.locale&&m(this.locale),this.currency&&m(this.currency),this.minFractionDigits&&m(this.minFractionDigits),this.maxFractionDigits&&m(this.maxFractionDigits)}outputDefined(){return!1}},Ox=class g{constructor(m){this.type=oy,this.sections=m}static parse(m,u){if(m.length<2)return u.error("Expected at least one argument.");let x=m[1];if(!Array.isArray(x)&&typeof x=="object")return u.error("First argument must be an image or text section.");let _=[],o=!1;for(let C=1;C<=m.length-1;++C){let B=m[C];if(o&&typeof B=="object"&&!Array.isArray(B)){o=!1;let $=null;if(B["font-scale"]&&($=u.parse(B["font-scale"],1,St),!$))return null;let Y=null;if(B["text-font"]&&(Y=u.parse(B["text-font"],1,Dl($i)),!Y))return null;let ne=null;if(B["text-color"]&&(ne=u.parse(B["text-color"],1,_u),!ne))return null;let q=null;if(B["vertical-align"]){if(typeof B["vertical-align"]=="string"&&!GI.includes(B["vertical-align"]))return u.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${B["vertical-align"]}' instead.`);if(q=u.parse(B["vertical-align"],1,$i),!q)return null}let Ce=_[_.length-1];Ce.scale=$,Ce.font=Y,Ce.textColor=ne,Ce.verticalAlign=q}else{let $=u.parse(m[C],1,Li);if(!$)return null;let Y=$.type.kind;if(Y!=="string"&&Y!=="value"&&Y!=="null"&&Y!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,_.push({content:$,scale:null,font:null,textColor:null,verticalAlign:null})}}return new g(_)}evaluate(m){let u=x=>{let _=x.content.evaluate(m);return po(_)===Bg?new Cg("",_,null,null,null,x.verticalAlign?x.verticalAlign.evaluate(m):null):new Cg(yg(_),null,x.scale?x.scale.evaluate(m):null,x.font?x.font.evaluate(m).join(","):null,x.textColor?x.textColor.evaluate(m):null,x.verticalAlign?x.verticalAlign.evaluate(m):null)};return new jd(this.sections.map(u))}eachChild(m){for(let u of this.sections)m(u.content),u.scale&&m(u.scale),u.font&&m(u.font),u.textColor&&m(u.textColor),u.verticalAlign&&m(u.verticalAlign)}outputDefined(){return!1}},jx=class g{constructor(m){this.type=Bg,this.input=m}static parse(m,u){if(m.length!==2)return u.error("Expected two arguments.");let x=u.parse(m[1],1,$i);return x?new g(x):u.error("No image name provided.")}evaluate(m){let u=this.input.evaluate(m),x=rp.fromString(u);return x&&m.availableImages&&(x.available=m.availableImages.indexOf(u)>-1),x}eachChild(m){m(this.input)}outputDefined(){return!1}},Ux=class g{constructor(m){this.type=St,this.input=m}static parse(m,u){if(m.length!==2)return u.error(`Expected 1 argument, but found ${m.length-1} instead.`);let x=u.parse(m[1],1);return x?x.type.kind!=="array"&&x.type.kind!=="string"&&x.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${Sr(x.type)} instead.`):new g(x):null}evaluate(m){let u=this.input.evaluate(m);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new br(`Expected value to be of type string or array, but found ${Sr(po(u))} instead.`)}eachChild(m){m(this.input)}outputDefined(){return!1}},yu=8192;function mP(g,m){let u=fP(g[0]),x=_P(g[1]),_=Math.pow(2,m.z);return[Math.round(u*_*yu),Math.round(x*_*yu)]}function a1(g,m){let u=Math.pow(2,m.z),x=(g[0]/yu+m.x)/u,_=(g[1]/yu+m.y)/u;return[gP(x),yP(_)]}function fP(g){return(180+g)/360}function gP(g){return g*360-180}function _P(g){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360)))/360}function yP(g){return 360/Math.PI*Math.atan(Math.exp((180-g*360)*Math.PI/180))-90}function Og(g,m){g[0]=Math.min(g[0],m[0]),g[1]=Math.min(g[1],m[1]),g[2]=Math.max(g[2],m[0]),g[3]=Math.max(g[3],m[1])}function Eg(g,m){return!(g[0]<=m[0]||g[2]>=m[2]||g[1]<=m[1]||g[3]>=m[3])}function vP(g,m,u){return m[1]>g[1]!=u[1]>g[1]&&g[0]<(u[0]-m[0])*(g[1]-m[1])/(u[1]-m[1])+m[0]}function xP(g,m,u){let x=g[0]-m[0],_=g[1]-m[1],o=g[0]-u[0],C=g[1]-u[1];return x*C-o*_===0&&x*o<=0&&_*C<=0}function cy(g,m,u,x){let _=[m[0]-g[0],m[1]-g[1]],o=[x[0]-u[0],x[1]-u[1]];return SP(o,_)===0?!1:!!(ww(g,m,u,x)&&ww(u,x,g,m))}function bP(g,m,u){for(let x of u)for(let _=0;_<x.length-1;++_)if(cy(g,m,x[_],x[_+1]))return!0;return!1}function xm(g,m,u=!1){let x=!1;for(let _ of m)for(let o=0;o<_.length-1;o++){if(xP(g,_[o],_[o+1]))return u;vP(g,_[o],_[o+1])&&(x=!x)}return x}function wP(g,m){for(let u of m)if(xm(g,u))return!0;return!1}function x2(g,m){for(let u of g)if(!xm(u,m))return!1;for(let u=0;u<g.length-1;++u)if(bP(g[u],g[u+1],m))return!1;return!0}function TP(g,m){for(let u of m)if(x2(g,u))return!0;return!1}function SP(g,m){return g[0]*m[1]-g[1]*m[0]}function ww(g,m,u,x){let _=g[0]-u[0],o=g[1]-u[1],C=m[0]-u[0],B=m[1]-u[1],$=x[0]-u[0],Y=x[1]-u[1],ne=_*Y-$*o,q=C*Y-$*B;return ne>0&&q<0||ne<0&&q>0}function s1(g,m,u){let x=[];for(let _=0;_<g.length;_++){let o=[];for(let C=0;C<g[_].length;C++){let B=mP(g[_][C],u);Og(m,B),o.push(B)}x.push(o)}return x}function b2(g,m,u){let x=[];for(let _=0;_<g.length;_++){let o=s1(g[_],m,u);x.push(o)}return x}function w2(g,m,u,x){if(g[0]<u[0]||g[0]>u[2]){let _=x*.5,o=g[0]-u[0]>_?-x:u[0]-g[0]>_?x:0;o===0&&(o=g[0]-u[2]>_?-x:u[2]-g[0]>_?x:0),g[0]+=o}Og(m,g)}function IP(g){g[0]=g[1]=1/0,g[2]=g[3]=-1/0}function Tw(g,m,u,x){let _=Math.pow(2,x.z)*yu,o=[x.x*yu,x.y*yu],C=[];for(let B of g)for(let $ of B){let Y=[$.x+o[0],$.y+o[1]];w2(Y,m,u,_),C.push(Y)}return C}function Sw(g,m,u,x){let _=Math.pow(2,x.z)*yu,o=[x.x*yu,x.y*yu],C=[];for(let B of g){let $=[];for(let Y of B){let ne=[Y.x+o[0],Y.y+o[1]];Og(m,ne),$.push(ne)}C.push($)}if(m[2]-m[0]<=_/2){IP(m);for(let B of C)for(let $ of B)w2($,m,u,_)}return C}function PP(g,m){let u=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],_=g.canonicalID();if(m.type==="Polygon"){let o=s1(m.coordinates,x,_),C=Tw(g.geometry(),u,x,_);if(!Eg(u,x))return!1;for(let B of C)if(!xm(B,o))return!1}if(m.type==="MultiPolygon"){let o=b2(m.coordinates,x,_),C=Tw(g.geometry(),u,x,_);if(!Eg(u,x))return!1;for(let B of C)if(!wP(B,o))return!1}return!0}function CP(g,m){let u=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],_=g.canonicalID();if(m.type==="Polygon"){let o=s1(m.coordinates,x,_),C=Sw(g.geometry(),u,x,_);if(!Eg(u,x))return!1;for(let B of C)if(!x2(B,o))return!1}if(m.type==="MultiPolygon"){let o=b2(m.coordinates,x,_),C=Sw(g.geometry(),u,x,_);if(!Eg(u,x))return!1;for(let B of C)if(!TP(B,o))return!1}return!0}var Ag=class g{constructor(m,u){this.type=Di,this.geojson=m,this.geometries=u}static parse(m,u){if(m.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${m.length-1} instead.`);if(Mg(m[1])){let x=m[1];if(x.type==="FeatureCollection"){let _=[];for(let o of x.features){let{type:C,coordinates:B}=o.geometry;C==="Polygon"&&_.push(B),C==="MultiPolygon"&&_.push(...B)}if(_.length){let o={type:"MultiPolygon",coordinates:_};return new g(x,o)}}else if(x.type==="Feature"){let _=x.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new g(x,x.geometry)}else if(x.type==="Polygon"||x.type==="MultiPolygon")return new g(x,x)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(m){if(m.geometry()!=null&&m.canonicalID()!=null){if(m.geometryType()==="Point")return PP(m,this.geometries);if(m.geometryType()==="LineString")return CP(m,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}},N_=class{constructor(m=[],u=(x,_)=>x<_?-1:x>_?1:0){if(this.data=m,this.length=this.data.length,this.compare=u,this.length>0)for(let x=(this.length>>1)-1;x>=0;x--)this._down(x)}push(m){this.data.push(m),this._up(this.length++)}pop(){if(this.length===0)return;let m=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),m}peek(){return this.data[0]}_up(m){let{data:u,compare:x}=this,_=u[m];for(;m>0;){let o=m-1>>1,C=u[o];if(x(_,C)>=0)break;u[m]=C,m=o}u[m]=_}_down(m){let{data:u,compare:x}=this,_=this.length>>1,o=u[m];for(;m<_;){let C=(m<<1)+1,B=C+1;if(B<this.length&&x(u[B],u[C])<0&&(C=B),x(u[C],o)>=0)break;u[m]=u[C],m=C}u[m]=o}};function MP(g,m){if(g.length<=1)return[g];let u=[],x,_;for(let o of g){let C=EP(o);C!==0&&(o.area=Math.abs(C),_===void 0&&(_=C<0),_===C<0?(x&&u.push(x),x=[o]):x.push(o))}return x&&u.push(x),u}function EP(g){let m=0;for(let u=0,x=g.length,_=x-1,o,C;u<x;_=u++)o=g[u],C=g[_],m+=(C.x-o.x)*(o.y+C.y);return m}var AP=6378.137,Iw=1/298.257223563,Pw=Iw*(2-Iw),Cw=Math.PI/180,kg=class{constructor(m){let u=Cw*AP*1e3,x=Math.cos(m*Cw),_=1/(1-Pw*(1-x*x)),o=Math.sqrt(_);this.kx=u*o*x,this.ky=u*o*_*(1-Pw)}distance(m,u){let x=this.wrap(m[0]-u[0])*this.kx,_=(m[1]-u[1])*this.ky;return Math.sqrt(x*x+_*_)}pointOnLine(m,u){let x=1/0,_,o,C,B;for(let $=0;$<m.length-1;$++){let Y=m[$][0],ne=m[$][1],q=this.wrap(m[$+1][0]-Y)*this.kx,Ce=(m[$+1][1]-ne)*this.ky,Ie=0;(q!==0||Ce!==0)&&(Ie=(this.wrap(u[0]-Y)*this.kx*q+(u[1]-ne)*this.ky*Ce)/(q*q+Ce*Ce),Ie>1?(Y=m[$+1][0],ne=m[$+1][1]):Ie>0&&(Y+=q/this.kx*Ie,ne+=Ce/this.ky*Ie)),q=this.wrap(u[0]-Y)*this.kx,Ce=(u[1]-ne)*this.ky;let Ae=q*q+Ce*Ce;Ae<x&&(x=Ae,_=Y,o=ne,C=$,B=Ie)}return{point:[_,o],index:C,t:Math.max(0,Math.min(1,B))}}wrap(m){for(;m<-180;)m+=360;for(;m>180;)m-=360;return m}},Nx=100,Vx=50;function T2(g,m){return m[0]-g[0]}function V_(g){return g[1]-g[0]+1}function Bh(g,m){return g[1]>=g[0]&&g[1]<m}function $x(g,m){if(g[0]>g[1])return[null,null];let u=V_(g);if(m){if(u===2)return[g,null];let _=Math.floor(u/2);return[[g[0],g[0]+_],[g[0]+_,g[1]]]}if(u===1)return[g,null];let x=Math.floor(u/2)-1;return[[g[0],g[0]+x],[g[0]+x+1,g[1]]]}function Gx(g,m){if(!Bh(m,g.length))return[1/0,1/0,-1/0,-1/0];let u=[1/0,1/0,-1/0,-1/0];for(let x=m[0];x<=m[1];++x)Og(u,g[x]);return u}function Zx(g){let m=[1/0,1/0,-1/0,-1/0];for(let u of g)for(let x of u)Og(m,x);return m}function Mw(g){return g[0]!==-1/0&&g[1]!==-1/0&&g[2]!==1/0&&g[3]!==1/0}function l1(g,m,u){if(!Mw(g)||!Mw(m))return NaN;let x=0,_=0;return g[2]<m[0]&&(x=m[0]-g[2]),g[0]>m[2]&&(x=g[0]-m[2]),g[1]>m[3]&&(_=g[1]-m[3]),g[3]<m[1]&&(_=m[1]-g[3]),u.distance([0,0],[x,_])}function zd(g,m,u){let x=u.pointOnLine(m,g);return u.distance(g,x.point)}function c1(g,m,u,x,_){let o=Math.min(zd(g,[u,x],_),zd(m,[u,x],_)),C=Math.min(zd(u,[g,m],_),zd(x,[g,m],_));return Math.min(o,C)}function kP(g,m,u,x,_){if(!(Bh(m,g.length)&&Bh(x,u.length)))return 1/0;let o=1/0;for(let C=m[0];C<m[1];++C){let B=g[C],$=g[C+1];for(let Y=x[0];Y<x[1];++Y){let ne=u[Y],q=u[Y+1];if(cy(B,$,ne,q))return 0;o=Math.min(o,c1(B,$,ne,q,_))}}return o}function LP(g,m,u,x,_){if(!(Bh(m,g.length)&&Bh(x,u.length)))return NaN;let o=1/0;for(let C=m[0];C<=m[1];++C)for(let B=x[0];B<=x[1];++B)if(o=Math.min(o,_.distance(g[C],u[B])),o===0)return o;return o}function DP(g,m,u){if(xm(g,m,!0))return 0;let x=1/0;for(let _ of m){let o=_[0],C=_[_.length-1];if(o!==C&&(x=Math.min(x,zd(g,[C,o],u)),x===0))return x;let B=u.pointOnLine(_,g);if(x=Math.min(x,u.distance(g,B.point)),x===0)return x}return x}function zP(g,m,u,x){if(!Bh(m,g.length))return NaN;for(let o=m[0];o<=m[1];++o)if(xm(g[o],u,!0))return 0;let _=1/0;for(let o=m[0];o<m[1];++o){let C=g[o],B=g[o+1];for(let $ of u)for(let Y=0,ne=$.length,q=ne-1;Y<ne;q=Y++){let Ce=$[q],Ie=$[Y];if(cy(C,B,Ce,Ie))return 0;_=Math.min(_,c1(C,B,Ce,Ie,x))}}return _}function Ew(g,m){for(let u of g)for(let x of u)if(xm(x,m,!0))return!0;return!1}function RP(g,m,u,x=1/0){let _=Zx(g),o=Zx(m);if(x!==1/0&&l1(_,o,u)>=x)return x;if(Eg(_,o)){if(Ew(g,m))return 0}else if(Ew(m,g))return 0;let C=1/0;for(let B of g)for(let $=0,Y=B.length,ne=Y-1;$<Y;ne=$++){let q=B[ne],Ce=B[$];for(let Ie of m)for(let Ae=0,De=Ie.length,qe=De-1;Ae<De;qe=Ae++){let Qe=Ie[qe],nt=Ie[Ae];if(cy(q,Ce,Qe,nt))return 0;C=Math.min(C,c1(q,Ce,Qe,nt,u))}}return C}function Aw(g,m,u,x,_,o){if(!o)return;let C=l1(Gx(x,o),_,u);C<m&&g.push([C,o,[0,0]])}function x_(g,m,u,x,_,o,C){if(!o||!C)return;let B=l1(Gx(x,o),Gx(_,C),u);B<m&&g.push([B,o,C])}function $_(g,m,u,x,_=1/0){let o=Math.min(x.distance(g[0],u[0][0]),_);if(o===0)return o;let C=new N_([[0,[0,g.length-1],[0,0]]],T2),B=Zx(u);for(;C.length>0;){let $=C.pop();if($[0]>=o)continue;let Y=$[1],ne=m?Vx:Nx;if(V_(Y)<=ne){if(!Bh(Y,g.length))return NaN;if(m){let q=zP(g,Y,u,x);if(isNaN(q)||q===0)return q;o=Math.min(o,q)}else for(let q=Y[0];q<=Y[1];++q){let Ce=DP(g[q],u,x);if(o=Math.min(o,Ce),o===0)return 0}}else{let q=$x(Y,m);Aw(C,o,x,g,B,q[0]),Aw(C,o,x,g,B,q[1])}}return o}function G_(g,m,u,x,_,o=1/0){let C=Math.min(o,_.distance(g[0],u[0]));if(C===0)return C;let B=new N_([[0,[0,g.length-1],[0,u.length-1]]],T2);for(;B.length>0;){let $=B.pop();if($[0]>=C)continue;let Y=$[1],ne=$[2],q=m?Vx:Nx,Ce=x?Vx:Nx;if(V_(Y)<=q&&V_(ne)<=Ce){if(!Bh(Y,g.length)&&Bh(ne,u.length))return NaN;let Ie;if(m&&x)Ie=kP(g,Y,u,ne,_),C=Math.min(C,Ie);else if(m&&!x){let Ae=g.slice(Y[0],Y[1]+1);for(let De=ne[0];De<=ne[1];++De)if(Ie=zd(u[De],Ae,_),C=Math.min(C,Ie),C===0)return C}else if(!m&&x){let Ae=u.slice(ne[0],ne[1]+1);for(let De=Y[0];De<=Y[1];++De)if(Ie=zd(g[De],Ae,_),C=Math.min(C,Ie),C===0)return C}else Ie=LP(g,Y,u,ne,_),C=Math.min(C,Ie)}else{let Ie=$x(Y,m),Ae=$x(ne,x);x_(B,C,_,g,u,Ie[0],Ae[0]),x_(B,C,_,g,u,Ie[0],Ae[1]),x_(B,C,_,g,u,Ie[1],Ae[0]),x_(B,C,_,g,u,Ie[1],Ae[1])}}return C}function FP(g,m){let u=g.geometry(),x=u.flat().map(C=>a1([C.x,C.y],g.canonical));if(u.length===0)return NaN;let _=new kg(x[0][1]),o=1/0;for(let C of m){switch(C.type){case"Point":o=Math.min(o,G_(x,!1,[C.coordinates],!1,_,o));break;case"LineString":o=Math.min(o,G_(x,!1,C.coordinates,!0,_,o));break;case"Polygon":o=Math.min(o,$_(x,!1,C.coordinates,_,o));break}if(o===0)return o}return o}function BP(g,m){let u=g.geometry(),x=u.flat().map(C=>a1([C.x,C.y],g.canonical));if(u.length===0)return NaN;let _=new kg(x[0][1]),o=1/0;for(let C of m){switch(C.type){case"Point":o=Math.min(o,G_(x,!0,[C.coordinates],!1,_,o));break;case"LineString":o=Math.min(o,G_(x,!0,C.coordinates,!0,_,o));break;case"Polygon":o=Math.min(o,$_(x,!0,C.coordinates,_,o));break}if(o===0)return o}return o}function OP(g,m){let u=g.geometry();if(u.length===0||u[0].length===0)return NaN;let x=MP(u).map(C=>C.map(B=>B.map($=>a1([$.x,$.y],g.canonical)))),_=new kg(x[0][0][0][1]),o=1/0;for(let C of m)for(let B of x){switch(C.type){case"Point":o=Math.min(o,$_([C.coordinates],!1,B,_,o));break;case"LineString":o=Math.min(o,$_(C.coordinates,!0,B,_,o));break;case"Polygon":o=Math.min(o,RP(B,C.coordinates,_,o));break}if(o===0)return o}return o}function ix(g){return g.type==="MultiPolygon"?g.coordinates.map(m=>({type:"Polygon",coordinates:m})):g.type==="MultiLineString"?g.coordinates.map(m=>({type:"LineString",coordinates:m})):g.type==="MultiPoint"?g.coordinates.map(m=>({type:"Point",coordinates:m})):[g]}var Lg=class g{constructor(m,u){this.type=St,this.geojson=m,this.geometries=u}static parse(m,u){if(m.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${m.length-1} instead.`);if(Mg(m[1])){let x=m[1];if(x.type==="FeatureCollection")return new g(x,x.features.map(_=>ix(_.geometry)).flat());if(x.type==="Feature")return new g(x,ix(x.geometry));if("type"in x&&"coordinates"in x)return new g(x,ix(x))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(m){if(m.geometry()!=null&&m.canonicalID()!=null){if(m.geometryType()==="Point")return FP(m,this.geometries);if(m.geometryType()==="LineString")return BP(m,this.geometries);if(m.geometryType()==="Polygon")return OP(m,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}},Dg=class g{constructor(m){this.type=Li,this.key=m}static parse(m,u){if(m.length!==2)return u.error(`Expected 1 argument, but found ${m.length-1} instead.`);let x=m[1];return x==null?u.error("Global state property must be defined."):typeof x!="string"?u.error(`Global state property must be string, but found ${typeof m[1]} instead.`):new g(x)}evaluate(m){var u;let x=(u=m.globals)===null||u===void 0?void 0:u.globalState;return!x||Object.keys(x).length===0?null:_g(x,this.key)}eachChild(){}outputDefined(){return!1}},u1={"==":lP,"!=":cP,">":hP,"<":uP,">=":dP,"<=":pP,array:uu,at:kx,boolean:uu,case:Rx,coalesce:j_,collator:U_,format:Ox,image:jx,in:Lx,"index-of":Dx,interpolate:Dh,"interpolate-hcl":Dh,"interpolate-lab":Dh,length:Ux,let:F_,literal:_m,match:zx,number:uu,"number-format":Bx,object:uu,slice:Fx,step:O_,string:uu,"to-boolean":ep,"to-color":ep,"to-number":ep,"to-string":ep,var:B_,within:Ag,distance:Lg,"global-state":Dg},op=class g{constructor(m,u,x,_){this.name=m,this.type=u,this._evaluate=x,this.args=_}evaluate(m){return this._evaluate(m,this.args)}eachChild(m){this.args.forEach(m)}outputDefined(){return!1}static parse(m,u){let x=m[0],_=g.definitions[x];if(!_)return u.error(`Unknown expression "${x}". If you wanted a literal array, use ["literal", [...]].`,0);let o=Array.isArray(_)?_[0]:_.type,C=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,B=C.filter(([Y])=>!Array.isArray(Y)||Y.length===m.length-1),$=null;for(let[Y,ne]of B){$=new R_(u.registry,Z_,u.path,null,u.scope);let q=[],Ce=!1;for(let Ie=1;Ie<m.length;Ie++){let Ae=m[Ie],De=Array.isArray(Y)?Y[Ie-1]:Y.type,qe=$.parse(Ae,1+q.length,De);if(!qe){Ce=!0;break}q.push(qe)}if(!Ce){if(Array.isArray(Y)&&Y.length!==q.length){$.error(`Expected ${Y.length} arguments, but found ${q.length} instead.`);continue}for(let Ie=0;Ie<q.length;Ie++){let Ae=Array.isArray(Y)?Y[Ie]:Y.type,De=q[Ie];$.concat(Ie+1).checkSubtype(Ae,De.type)}if($.errors.length===0)return new g(x,o,ne,q)}}if(B.length===1)u.errors.push(...$.errors);else{let Y=(B.length?B:C).map(([q])=>UP(q)).join(" | "),ne=[];for(let q=1;q<m.length;q++){let Ce=u.parse(m[q],1+ne.length);if(!Ce)return null;ne.push(Sr(Ce.type))}u.error(`Expected arguments of type ${Y}, but found (${ne.join(", ")}) instead.`)}return null}static register(m,u){g.definitions=u;for(let x in u)m[x]=g}};function kw(g,[m,u,x,_]){m=m.evaluate(g),u=u.evaluate(g),x=x.evaluate(g);let o=_?_.evaluate(g):1,C=g2(m,u,x,o);if(C)throw new br(C);return new sr(m/255,u/255,x/255,o,!1)}function Lw(g,m){return g in m}function nx(g,m){let u=m[g];return typeof u>"u"?null:u}function jP(g,m,u,x){for(;u<=x;){let _=u+x>>1;if(m[_]===g)return!0;m[_]>g?x=_-1:u=_+1}return!1}function kd(g){return{type:g}}op.register(u1,{error:[DI,[$i],(g,[m])=>{throw new br(m.evaluate(g))}],typeof:[$i,[Li],(g,[m])=>Sr(po(m.evaluate(g)))],"to-rgba":[Dl(St,4),[_u],(g,[m])=>{let[u,x,_,o]=m.evaluate(g).rgb;return[u*255,x*255,_*255,o]}],rgb:[_u,[St,St,St],kw],rgba:[_u,[St,St,St,St],kw],has:{type:Di,overloads:[[[$i],(g,[m])=>Lw(m.evaluate(g),g.properties())],[[$i,Rd],(g,[m,u])=>Lw(m.evaluate(g),u.evaluate(g))]]},get:{type:Li,overloads:[[[$i],(g,[m])=>nx(m.evaluate(g),g.properties())],[[$i,Rd],(g,[m,u])=>nx(m.evaluate(g),u.evaluate(g))]]},"feature-state":[Li,[$i],(g,[m])=>nx(m.evaluate(g),g.featureState||{})],properties:[Rd,[],g=>g.properties()],"geometry-type":[$i,[],g=>g.geometryType()],id:[Li,[],g=>g.id()],zoom:[St,[],g=>g.globals.zoom],"heatmap-density":[St,[],g=>g.globals.heatmapDensity||0],elevation:[St,[],g=>g.globals.elevation||0],"line-progress":[St,[],g=>g.globals.lineProgress||0],accumulated:[Li,[],g=>g.globals.accumulated===void 0?null:g.globals.accumulated],"+":[St,kd(St),(g,m)=>{let u=0;for(let x of m)u+=x.evaluate(g);return u}],"*":[St,kd(St),(g,m)=>{let u=1;for(let x of m)u*=x.evaluate(g);return u}],"-":{type:St,overloads:[[[St,St],(g,[m,u])=>m.evaluate(g)-u.evaluate(g)],[[St],(g,[m])=>-m.evaluate(g)]]},"/":[St,[St,St],(g,[m,u])=>m.evaluate(g)/u.evaluate(g)],"%":[St,[St,St],(g,[m,u])=>m.evaluate(g)%u.evaluate(g)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(g,[m,u])=>Math.pow(m.evaluate(g),u.evaluate(g))],sqrt:[St,[St],(g,[m])=>Math.sqrt(m.evaluate(g))],log10:[St,[St],(g,[m])=>Math.log(m.evaluate(g))/Math.LN10],ln:[St,[St],(g,[m])=>Math.log(m.evaluate(g))],log2:[St,[St],(g,[m])=>Math.log(m.evaluate(g))/Math.LN2],sin:[St,[St],(g,[m])=>Math.sin(m.evaluate(g))],cos:[St,[St],(g,[m])=>Math.cos(m.evaluate(g))],tan:[St,[St],(g,[m])=>Math.tan(m.evaluate(g))],asin:[St,[St],(g,[m])=>Math.asin(m.evaluate(g))],acos:[St,[St],(g,[m])=>Math.acos(m.evaluate(g))],atan:[St,[St],(g,[m])=>Math.atan(m.evaluate(g))],min:[St,kd(St),(g,m)=>Math.min(...m.map(u=>u.evaluate(g)))],max:[St,kd(St),(g,m)=>Math.max(...m.map(u=>u.evaluate(g)))],abs:[St,[St],(g,[m])=>Math.abs(m.evaluate(g))],round:[St,[St],(g,[m])=>{let u=m.evaluate(g);return u<0?-Math.round(-u):Math.round(u)}],floor:[St,[St],(g,[m])=>Math.floor(m.evaluate(g))],ceil:[St,[St],(g,[m])=>Math.ceil(m.evaluate(g))],"filter-==":[Di,[$i,Li],(g,[m,u])=>g.properties()[m.value]===u.value],"filter-id-==":[Di,[Li],(g,[m])=>g.id()===m.value],"filter-type-==":[Di,[$i],(g,[m])=>g.geometryType()===m.value],"filter-<":[Di,[$i,Li],(g,[m,u])=>{let x=g.properties()[m.value],_=u.value;return typeof x==typeof _&&x<_}],"filter-id-<":[Di,[Li],(g,[m])=>{let u=g.id(),x=m.value;return typeof u==typeof x&&u<x}],"filter->":[Di,[$i,Li],(g,[m,u])=>{let x=g.properties()[m.value],_=u.value;return typeof x==typeof _&&x>_}],"filter-id->":[Di,[Li],(g,[m])=>{let u=g.id(),x=m.value;return typeof u==typeof x&&u>x}],"filter-<=":[Di,[$i,Li],(g,[m,u])=>{let x=g.properties()[m.value],_=u.value;return typeof x==typeof _&&x<=_}],"filter-id-<=":[Di,[Li],(g,[m])=>{let u=g.id(),x=m.value;return typeof u==typeof x&&u<=x}],"filter->=":[Di,[$i,Li],(g,[m,u])=>{let x=g.properties()[m.value],_=u.value;return typeof x==typeof _&&x>=_}],"filter-id->=":[Di,[Li],(g,[m])=>{let u=g.id(),x=m.value;return typeof u==typeof x&&u>=x}],"filter-has":[Di,[Li],(g,[m])=>m.value in g.properties()],"filter-has-id":[Di,[],g=>g.id()!==null&&g.id()!==void 0],"filter-type-in":[Di,[Dl($i)],(g,[m])=>m.value.indexOf(g.geometryType())>=0],"filter-id-in":[Di,[Dl(Li)],(g,[m])=>m.value.indexOf(g.id())>=0],"filter-in-small":[Di,[$i,Dl(Li)],(g,[m,u])=>u.value.indexOf(g.properties()[m.value])>=0],"filter-in-large":[Di,[$i,Dl(Li)],(g,[m,u])=>jP(g.properties()[m.value],u.value,0,u.value.length-1)],all:{type:Di,overloads:[[[Di,Di],(g,[m,u])=>m.evaluate(g)&&u.evaluate(g)],[kd(Di),(g,m)=>{for(let u of m)if(!u.evaluate(g))return!1;return!0}]]},any:{type:Di,overloads:[[[Di,Di],(g,[m,u])=>m.evaluate(g)||u.evaluate(g)],[kd(Di),(g,m)=>{for(let u of m)if(u.evaluate(g))return!0;return!1}]]},"!":[Di,[Di],(g,[m])=>!m.evaluate(g)],"is-supported-script":[Di,[$i],(g,[m])=>{let u=g.globals&&g.globals.isSupportedScript;return u?u(m.evaluate(g)):!0}],upcase:[$i,[$i],(g,[m])=>m.evaluate(g).toUpperCase()],downcase:[$i,[$i],(g,[m])=>m.evaluate(g).toLowerCase()],concat:[$i,kd(Li),(g,m)=>m.map(u=>yg(u.evaluate(g))).join("")],"resolved-locale":[$i,[ry],(g,[m])=>m.evaluate(g).resolvedLocale()]});function UP(g){return Array.isArray(g)?`(${g.map(Sr).join(", ")})`:`(${Sr(g.type)}...)`}function Z_(g){if(g instanceof B_)return Z_(g.boundExpression);if(g instanceof op&&g.name==="error"||g instanceof U_||g instanceof Ag||g instanceof Lg||g instanceof Dg)return!1;let m=g instanceof ep||g instanceof uu,u=!0;return g.eachChild(x=>{m?u=u&&Z_(x):u=u&&x instanceof _m}),u?uy(g)&&hy(g,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function uy(g){if(g instanceof op&&(g.name==="get"&&g.args.length===1||g.name==="feature-state"||g.name==="has"&&g.args.length===1||g.name==="properties"||g.name==="geometry-type"||g.name==="id"||/^filter-/.test(g.name))||g instanceof Ag||g instanceof Lg)return!1;let m=!0;return g.eachChild(u=>{m&&!uy(u)&&(m=!1)}),m}function zg(g){if(g instanceof op&&g.name==="feature-state")return!1;let m=!0;return g.eachChild(u=>{m&&!zg(u)&&(m=!1)}),m}function hy(g,m){if(g instanceof op&&m.indexOf(g.name)>=0)return!1;let u=!0;return g.eachChild(x=>{u&&!hy(x,m)&&(u=!1)}),u}function qx(g){return{result:"success",value:g}}function pm(g){return{result:"error",value:g}}function q_(g){return g["property-type"]==="data-driven"||g["property-type"]==="cross-faded-data-driven"}function S2(g){return!!g.expression&&g.expression.parameters.indexOf("zoom")>-1}function I2(g){return!!g.expression&&g.expression.interpolated}function tn(g){return g instanceof Number?"number":g instanceof String?"string":g instanceof Boolean?"boolean":Array.isArray(g)?"array":g===null?"null":typeof g}function h1(g){return typeof g=="object"&&g!==null&&!Array.isArray(g)&&po(g)===Rd}var Wx=class{constructor(m,u){this.expression=m,this._warningHistory={},this._evaluator=new z_,this._defaultValue=u?$P(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(m,u,x,_,o,C){return this._evaluator.globals=m,this._evaluator.feature=u,this._evaluator.featureState=x,this._evaluator.canonical=_,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(m,u,x,_,o,C){this._evaluator.globals=m,this._evaluator.feature=u||null,this._evaluator.featureState=x||null,this._evaluator.canonical=_,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=C||null;try{let B=this.expression.evaluate(this._evaluator);if(B==null||typeof B=="number"&&B!==B)return this._defaultValue;if(this._enumValues&&!(B in this._enumValues))throw new br(`Expected value to be one of ${Object.keys(this._enumValues).map($=>JSON.stringify($)).join(", ")}, but found ${JSON.stringify(B)} instead.`);return B}catch(B){return this._warningHistory[B.message]||(this._warningHistory[B.message]=!0,typeof console<"u"&&console.warn(B.message)),this._defaultValue}}};function P2(g){return Array.isArray(g)&&g.length>0&&typeof g[0]=="string"&&g[0]in u1}function C2(g,m){let u=new R_(u1,Z_,[],m?VP(m):void 0),x=u.parse(g,void 0,void 0,void 0,m&&m.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?qx(new Wx(x,m)):pm(u.errors)}var W_=class{constructor(m,u){this.kind=m,this._styleExpression=u,this.isStateDependent=m!=="constant"&&!zg(u.expression),this.globalStateRefs=p1(u.expression)}evaluateWithoutErrorHandling(m,u,x,_,o,C){return this._styleExpression.evaluateWithoutErrorHandling(m,u,x,_,o,C)}evaluate(m,u,x,_,o,C){return this._styleExpression.evaluate(m,u,x,_,o,C)}},H_=class{constructor(m,u,x,_){this.kind=m,this.zoomStops=x,this._styleExpression=u,this.isStateDependent=m!=="camera"&&!zg(u.expression),this.globalStateRefs=p1(u.expression),this.interpolationType=_}evaluateWithoutErrorHandling(m,u,x,_,o,C){return this._styleExpression.evaluateWithoutErrorHandling(m,u,x,_,o,C)}evaluate(m,u,x,_,o,C){return this._styleExpression.evaluate(m,u,x,_,o,C)}interpolationFactor(m,u,x){return this.interpolationType?Dh.interpolationFactor(this.interpolationType,m,u,x):0}};function NP(g,m){let u=C2(g,m);if(u.result==="error")return u;let x=u.value.expression,_=uy(x);if(!_&&!q_(m))return pm([new ql("","data expressions not supported")]);let o=hy(x,["zoom"]);if(!o&&!S2(m))return pm([new ql("","zoom expressions not supported")]);let C=T_(x);if(!C&&!o)return pm([new ql("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(C instanceof ql)return pm([C]);if(C instanceof Dh&&!I2(m))return pm([new ql("",'"interpolate" expressions cannot be used with this property')]);if(!C)return qx(_?new W_("constant",u.value):new W_("source",u.value));let B=C instanceof Dh?C.interpolation:void 0;return qx(_?new H_("camera",u.value,C.labels,B):new H_("composite",u.value,C.labels,B))}function T_(g){let m=null;if(g instanceof F_)m=T_(g.result);else if(g instanceof j_){for(let u of g.args)if(m=T_(u),m)break}else(g instanceof O_||g instanceof Dh)&&g.input instanceof op&&g.input.name==="zoom"&&(m=g);return m instanceof ql||g.eachChild(u=>{let x=T_(u);x instanceof ql?m=x:!m&&x?m=new ql("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):m&&x&&m!==x&&(m=new ql("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),m}function p1(g,m=new Set){return g instanceof Dg&&m.add(g.key),g.eachChild(u=>{p1(u,m)}),m}function VP(g){let m={color:_u,string:$i,number:St,enum:$i,boolean:Di,formatted:oy,padding:ay,numberArray:sy,colorArray:Tg,projectionDefinition:ny,resolvedImage:Bg,variableAnchorOffsetCollection:ly};return g.type==="array"?Dl(m[g.value]||Li,g.length):m[g.type]}function $P(g){if(g.type==="color"&&h1(g.default))return new sr(0,0,0,0);switch(g.type){case"color":return sr.parse(g.default)||null;case"padding":return zh.parse(g.default)||null;case"numberArray":return Rh.parse(g.default)||null;case"colorArray":return hu.parse(g.default)||null;case"variableAnchorOffsetCollection":return Fh.parse(g.default)||null;case"projectionDefinition":return Ud.parse(g.default)||null;default:return g.default===void 0?null:g.default}}function M2(g){if(g===!0||g===!1)return!0;if(!Array.isArray(g)||g.length===0)return!1;switch(g[0]){case"has":return g.length>=2&&g[1]!=="$id"&&g[1]!=="$type";case"in":return g.length>=3&&(typeof g[1]!="string"||Array.isArray(g[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return g.length!==3||Array.isArray(g[1])||Array.isArray(g[2]);case"any":case"all":for(let m of g.slice(1))if(!M2(m)&&typeof m!="boolean")return!1;return!0;default:return!0}}function E2(g){let m=g.key,u=g.value;return u?[new mt(m,u,"constants have been deprecated as of v8")]:[]}function Ur(g){return g instanceof Number||g instanceof String||g instanceof Boolean?g.valueOf():g}function Nd(g){if(Array.isArray(g))return g.map(Nd);if(g instanceof Object&&!(g instanceof Number||g instanceof String||g instanceof Boolean)){let m={};for(let u in g)m[u]=Nd(g[u]);return m}return Ur(g)}function Wl(g){let m=g.key,u=g.value,x=g.valueSpec||{},_=g.objectElementValidators||{},o=g.style,C=g.styleSpec,B=g.validateSpec,$=[],Y=tn(u);if(Y!=="object")return[new mt(m,u,`object expected, ${Y} found`)];for(let ne in u){let q=ne.split(".")[0],Ce=_g(x,q)||x["*"],Ie;if(_g(_,q))Ie=_[q];else if(_g(x,q))Ie=B;else if(_["*"])Ie=_["*"];else if(x["*"])Ie=B;else{$.push(new mt(m,u[ne],`unknown property "${ne}"`));continue}$=$.concat(Ie({key:(m&&`${m}.`)+ne,value:u[ne],valueSpec:Ce,style:o,styleSpec:C,object:u,objectKey:ne,validateSpec:B},u))}for(let ne in x)_[ne]||x[ne].required&&x[ne].default===void 0&&u[ne]===void 0&&$.push(new mt(m,u,`missing required property "${ne}"`));return $}function d1(g){let m=g.value,u=g.valueSpec,x=g.validateSpec,_=g.style,o=g.styleSpec,C=g.key,B=g.arrayElementValidator||x;if(tn(m)!=="array")return[new mt(C,m,`array expected, ${tn(m)} found`)];if(u.length&&m.length!==u.length)return[new mt(C,m,`array length ${u.length} expected, length ${m.length} found`)];if(u["min-length"]&&m.length<u["min-length"])return[new mt(C,m,`array length at least ${u["min-length"]} expected, length ${m.length} found`)];let $={type:u.value,values:u.values};o.$version<7&&($.function=u.function),tn(u.value)==="object"&&($=u.value);let Y=[];for(let ne=0;ne<m.length;ne++)Y=Y.concat(B({array:m,arrayIndex:ne,value:m[ne],valueSpec:$,validateSpec:g.validateSpec,style:_,styleSpec:o,key:`${C}[${ne}]`}));return Y}function py(g){let m=g.key,u=g.value,x=g.valueSpec,_=tn(u);return _==="number"&&u!==u&&(_="NaN"),_!=="number"?[new mt(m,u,`number expected, ${_} found`)]:"minimum"in x&&u<x.minimum?[new mt(m,u,`${u} is less than the minimum value ${x.minimum}`)]:"maximum"in x&&u>x.maximum?[new mt(m,u,`${u} is greater than the maximum value ${x.maximum}`)]:[]}function A2(g){let m=g.valueSpec,u=Ur(g.value.type),x,_={},o,C,B=u!=="categorical"&&g.value.property===void 0,$=!B,Y=tn(g.value.stops)==="array"&&tn(g.value.stops[0])==="array"&&tn(g.value.stops[0][0])==="object",ne=Wl({key:g.key,value:g.value,valueSpec:g.styleSpec.function,validateSpec:g.validateSpec,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:q,default:Ae}});return u==="identity"&&B&&ne.push(new mt(g.key,g.value,'missing required property "property"')),u!=="identity"&&!g.value.stops&&ne.push(new mt(g.key,g.value,'missing required property "stops"')),u==="exponential"&&g.valueSpec.expression&&!I2(g.valueSpec)&&ne.push(new mt(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&($&&!q_(g.valueSpec)?ne.push(new mt(g.key,g.value,"property functions not supported")):B&&!S2(g.valueSpec)&&ne.push(new mt(g.key,g.value,"zoom functions not supported"))),(u==="categorical"||Y)&&g.value.property===void 0&&ne.push(new mt(g.key,g.value,'"property" property is required')),ne;function q(De){if(u==="identity")return[new mt(De.key,De.value,'identity function may not have a "stops" property')];let qe=[],Qe=De.value;return qe=qe.concat(d1({key:De.key,value:Qe,valueSpec:De.valueSpec,validateSpec:De.validateSpec,style:De.style,styleSpec:De.styleSpec,arrayElementValidator:Ce})),tn(Qe)==="array"&&Qe.length===0&&qe.push(new mt(De.key,Qe,"array must have at least one stop")),qe}function Ce(De){let qe=[],Qe=De.value,nt=De.key;if(tn(Qe)!=="array")return[new mt(nt,Qe,`array expected, ${tn(Qe)} found`)];if(Qe.length!==2)return[new mt(nt,Qe,`array length 2 expected, length ${Qe.length} found`)];if(Y){if(tn(Qe[0])!=="object")return[new mt(nt,Qe,`object expected, ${tn(Qe[0])} found`)];if(Qe[0].zoom===void 0)return[new mt(nt,Qe,"object stop key must have zoom")];if(Qe[0].value===void 0)return[new mt(nt,Qe,"object stop key must have value")];if(C&&C>Ur(Qe[0].zoom))return[new mt(nt,Qe[0].zoom,"stop zoom values must appear in ascending order")];Ur(Qe[0].zoom)!==C&&(C=Ur(Qe[0].zoom),o=void 0,_={}),qe=qe.concat(Wl({key:`${nt}[0]`,value:Qe[0],valueSpec:{zoom:{}},validateSpec:De.validateSpec,style:De.style,styleSpec:De.styleSpec,objectElementValidators:{zoom:py,value:Ie}}))}else qe=qe.concat(Ie({key:`${nt}[0]`,value:Qe[0],validateSpec:De.validateSpec,style:De.style,styleSpec:De.styleSpec},Qe));return P2(Nd(Qe[1]))?qe.concat([new mt(`${nt}[1]`,Qe[1],"expressions are not allowed in function stops.")]):qe.concat(De.validateSpec({key:`${nt}[1]`,value:Qe[1],valueSpec:m,validateSpec:De.validateSpec,style:De.style,styleSpec:De.styleSpec}))}function Ie(De,qe){let Qe=tn(De.value),nt=Ur(De.value),vt=De.value!==null?De.value:qe;if(!x)x=Qe;else if(Qe!==x)return[new mt(De.key,vt,`${Qe} stop domain type must match previous stop domain type ${x}`)];if(Qe!=="number"&&Qe!=="string"&&Qe!=="boolean")return[new mt(De.key,vt,"stop domain value must be a number, string, or boolean")];if(Qe!=="number"&&u!=="categorical"){let tt=`number expected, ${Qe} found`;return q_(m)&&u===void 0&&(tt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new mt(De.key,vt,tt)]}return u==="categorical"&&Qe==="number"&&(!isFinite(nt)||Math.floor(nt)!==nt)?[new mt(De.key,vt,`integer expected, found ${nt}`)]:u!=="categorical"&&Qe==="number"&&o!==void 0&&nt<o?[new mt(De.key,vt,"stop domain values must appear in ascending order")]:(o=nt,u==="categorical"&&nt in _?[new mt(De.key,vt,"stop domain values must be unique")]:(_[nt]=!0,[]))}function Ae(De){return De.validateSpec({key:De.key,value:De.value,valueSpec:m,validateSpec:De.validateSpec,style:De.style,styleSpec:De.styleSpec})}}function ym(g){let m=(g.expressionContext==="property"?NP:C2)(Nd(g.value),g.valueSpec);if(m.result==="error")return m.value.map(x=>new mt(`${g.key}${x.key}`,g.value,x.message));let u=m.value.expression||m.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!u.outputDefined())return[new mt(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!zg(u))return[new mt(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter"&&!zg(u))return[new mt(g.key,g.value,'"feature-state" data expressions are not supported with filters.')];if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!hy(u,["zoom","feature-state"]))return[new mt(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!uy(u))return[new mt(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function GP(g){let m=g.value,u=g.key,x=tn(m);return x!=="boolean"?[new mt(u,m,`boolean expected, ${x} found`)]:[]}function Hx(g){let m=g.key,u=g.value,x=tn(u);return x!=="string"?[new mt(m,u,`color expected, ${x} found`)]:sr.parse(String(u))?[]:[new mt(m,u,`color expected, "${u}" found`)]}function Rg(g){let m=g.key,u=g.value,x=g.valueSpec,_=[];return Array.isArray(x.values)?x.values.indexOf(Ur(u))===-1&&_.push(new mt(m,u,`expected one of [${x.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(x.values).indexOf(Ur(u))===-1&&_.push(new mt(m,u,`expected one of [${Object.keys(x.values).join(", ")}], ${JSON.stringify(u)} found`)),_}function m1(g){return M2(Nd(g.value))?ym(D_({},g,{expressionContext:"filter",valueSpec:{value:"boolean"}})):k2(g)}function k2(g){let m=g.value,u=g.key;if(tn(m)!=="array")return[new mt(u,m,`array expected, ${tn(m)} found`)];let x=g.styleSpec,_,o=[];if(m.length<1)return[new mt(u,m,"filter array must have at least 1 element")];switch(o=o.concat(Rg({key:`${u}[0]`,value:m[0],valueSpec:x.filter_operator,style:g.style,styleSpec:g.styleSpec})),Ur(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&Ur(m[1])==="$type"&&o.push(new mt(u,m,`"$type" cannot be use with operator "${m[0]}"`));case"==":case"!=":m.length!==3&&o.push(new mt(u,m,`filter array for operator "${m[0]}" must have 3 elements`));case"in":case"!in":m.length>=2&&(_=tn(m[1]),_!=="string"&&o.push(new mt(`${u}[1]`,m[1],`string expected, ${_} found`)));for(let C=2;C<m.length;C++)_=tn(m[C]),Ur(m[1])==="$type"?o=o.concat(Rg({key:`${u}[${C}]`,value:m[C],valueSpec:x.geometry_type,style:g.style,styleSpec:g.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&o.push(new mt(`${u}[${C}]`,m[C],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let C=1;C<m.length;C++)o=o.concat(k2({key:`${u}[${C}]`,value:m[C],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":_=tn(m[1]),m.length!==2?o.push(new mt(u,m,`filter array for "${m[0]}" operator must have 2 elements`)):_!=="string"&&o.push(new mt(`${u}[1]`,m[1],`string expected, ${_} found`));break}return o}function L2(g,m){let u=g.key,x=g.validateSpec,_=g.style,o=g.styleSpec,C=g.value,B=g.objectKey,$=o[`${m}_${g.layerType}`];if(!$)return[];let Y=B.match(/^(.*)-transition$/);if(m==="paint"&&Y&&$[Y[1]]&&$[Y[1]].transition)return x({key:u,value:C,valueSpec:o.transition,style:_,styleSpec:o});let ne=g.valueSpec||$[B];if(!ne)return[new mt(u,C,`unknown property "${B}"`)];let q;if(tn(C)==="string"&&q_(ne)&&!ne.tokens&&(q=/^{([^}]+)}$/.exec(C)))return[new mt(u,C,`"${B}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(q[1])} }\`.`)];let Ce=[];return g.layerType==="symbol"&&(B==="text-field"&&_&&!_.glyphs&&Ce.push(new mt(u,C,'use of "text-field" requires a style "glyphs" property')),B==="text-font"&&h1(Nd(C))&&Ur(C.type)==="identity"&&Ce.push(new mt(u,C,'"text-font" does not support identity functions'))),Ce.concat(x({key:g.key,value:C,valueSpec:ne,style:_,styleSpec:o,expressionContext:"property",propertyType:m,propertyKey:B}))}function D2(g){return L2(g,"paint")}function z2(g){return L2(g,"layout")}function R2(g){let m=[],u=g.value,x=g.key,_=g.style,o=g.styleSpec;if(tn(u)!=="object")return[new mt(x,u,`object expected, ${tn(u)} found`)];!u.type&&!u.ref&&m.push(new mt(x,u,'either "type" or "ref" is required'));let C=Ur(u.type),B=Ur(u.ref);if(u.id){let $=Ur(u.id);for(let Y=0;Y<g.arrayIndex;Y++){let ne=_.layers[Y];Ur(ne.id)===$&&m.push(new mt(x,u.id,`duplicate layer id "${u.id}", previously used at line ${ne.id.__line__}`))}}if("ref"in u){["type","source","source-layer","filter","layout"].forEach(Y=>{Y in u&&m.push(new mt(x,u[Y],`"${Y}" is prohibited for ref layers`))});let $;_.layers.forEach(Y=>{Ur(Y.id)===B&&($=Y)}),$?$.ref?m.push(new mt(x,u.ref,"ref cannot reference another ref layer")):C=Ur($.type):m.push(new mt(x,u.ref,`ref layer "${B}" not found`))}else if(C!=="background")if(!u.source)m.push(new mt(x,u,'missing required property "source"'));else{let $=_.sources&&_.sources[u.source],Y=$&&Ur($.type);$?Y==="vector"&&C==="raster"?m.push(new mt(x,u.source,`layer "${u.id}" requires a raster source`)):Y!=="raster-dem"&&C==="hillshade"?m.push(new mt(x,u.source,`layer "${u.id}" requires a raster-dem source`)):Y!=="raster-dem"&&C==="color-relief"?m.push(new mt(x,u.source,`layer "${u.id}" requires a raster-dem source`)):Y==="raster"&&C!=="raster"?m.push(new mt(x,u.source,`layer "${u.id}" requires a vector source`)):Y==="vector"&&!u["source-layer"]?m.push(new mt(x,u,`layer "${u.id}" must specify a "source-layer"`)):Y==="raster-dem"&&C!=="hillshade"&&C!=="color-relief"?m.push(new mt(x,u.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):C==="line"&&u.paint&&u.paint["line-gradient"]&&(Y!=="geojson"||!$.lineMetrics)&&m.push(new mt(x,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):m.push(new mt(x,u.source,`source "${u.source}" not found`))}return m=m.concat(Wl({key:x,value:u,valueSpec:o.layer,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*"(){return[]},type(){return g.validateSpec({key:`${x}.type`,value:u.type,valueSpec:o.layer.type,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,object:u,objectKey:"type"})},filter:m1,layout($){return Wl({layer:u,key:$.key,value:$.value,style:$.style,styleSpec:$.styleSpec,validateSpec:$.validateSpec,objectElementValidators:{"*"(Y){return z2(D_({layerType:C},Y))}}})},paint($){return Wl({layer:u,key:$.key,value:$.value,style:$.style,styleSpec:$.styleSpec,validateSpec:$.validateSpec,objectElementValidators:{"*"(Y){return D2(D_({layerType:C},Y))}}})}}})),m}function Vd(g){let m=g.value,u=g.key,x=tn(m);return x!=="string"?[new mt(u,m,`string expected, ${x} found`)]:[]}function ZP(g){var m;let u=(m=g.sourceName)!==null&&m!==void 0?m:"",x=g.value,_=g.styleSpec,o=_.source_raster_dem,C=g.style,B=[],$=tn(x);if(x===void 0)return B;if($!=="object")return B.push(new mt("source_raster_dem",x,`object expected, ${$} found`)),B;let Y=Ur(x.encoding)==="custom",ne=["redFactor","greenFactor","blueFactor","baseShift"],q=g.value.encoding?`"${g.value.encoding}"`:"Default";for(let Ce in x)!Y&&ne.includes(Ce)?B.push(new mt(Ce,x[Ce],`In "${u}": "${Ce}" is only valid when "encoding" is set to "custom". ${q} encoding found`)):o[Ce]?B=B.concat(g.validateSpec({key:Ce,value:x[Ce],valueSpec:o[Ce],validateSpec:g.validateSpec,style:C,styleSpec:_})):B.push(new mt(Ce,x[Ce],`unknown property "${Ce}"`));return B}var Dw={promoteId:qP};function F2(g){let m=g.value,u=g.key,x=g.styleSpec,_=g.style,o=g.validateSpec;if(!m.type)return[new mt(u,m,'"type" is required')];let C=Ur(m.type),B;switch(C){case"vector":case"raster":return B=Wl({key:u,value:m,valueSpec:x[`source_${C.replace("-","_")}`],style:g.style,styleSpec:x,objectElementValidators:Dw,validateSpec:o}),B;case"raster-dem":return B=ZP({sourceName:u,value:m,style:g.style,styleSpec:x,validateSpec:o}),B;case"geojson":if(B=Wl({key:u,value:m,valueSpec:x.source_geojson,style:_,styleSpec:x,validateSpec:o,objectElementValidators:Dw}),m.cluster)for(let $ in m.clusterProperties){let[Y,ne]=m.clusterProperties[$],q=typeof Y=="string"?[Y,["accumulated"],["get",$]]:Y;B.push(...ym({key:`${u}.${$}.map`,value:ne,expressionContext:"cluster-map"})),B.push(...ym({key:`${u}.${$}.reduce`,value:q,expressionContext:"cluster-reduce"}))}return B;case"video":return Wl({key:u,value:m,valueSpec:x.source_video,style:_,validateSpec:o,styleSpec:x});case"image":return Wl({key:u,value:m,valueSpec:x.source_image,style:_,validateSpec:o,styleSpec:x});case"canvas":return[new mt(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rg({key:`${u}.type`,value:m.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function qP({key:g,value:m}){if(tn(m)==="string")return Vd({key:g,value:m});{let u=[];for(let x in m)u.push(...Vd({key:`${g}.${x}`,value:m[x]}));return u}}function B2(g){let m=g.value,u=g.styleSpec,x=u.light,_=g.style,o=[],C=tn(m);if(m===void 0)return o;if(C!=="object")return o=o.concat([new mt("light",m,`object expected, ${C} found`)]),o;for(let B in m){let $=B.match(/^(.*)-transition$/);$&&x[$[1]]&&x[$[1]].transition?o=o.concat(g.validateSpec({key:B,value:m[B],valueSpec:u.transition,validateSpec:g.validateSpec,style:_,styleSpec:u})):x[B]?o=o.concat(g.validateSpec({key:B,value:m[B],valueSpec:x[B],validateSpec:g.validateSpec,style:_,styleSpec:u})):o=o.concat([new mt(B,m[B],`unknown property "${B}"`)])}return o}function O2(g){let m=g.value,u=g.styleSpec,x=u.sky,_=g.style,o=tn(m);if(m===void 0)return[];if(o!=="object")return[new mt("sky",m,`object expected, ${o} found`)];let C=[];for(let B in m)x[B]?C=C.concat(g.validateSpec({key:B,value:m[B],valueSpec:x[B],style:_,styleSpec:u})):C=C.concat([new mt(B,m[B],`unknown property "${B}"`)]);return C}function j2(g){let m=g.value,u=g.styleSpec,x=u.terrain,_=g.style,o=[],C=tn(m);if(m===void 0)return o;if(C!=="object")return o=o.concat([new mt("terrain",m,`object expected, ${C} found`)]),o;for(let B in m)x[B]?o=o.concat(g.validateSpec({key:B,value:m[B],valueSpec:x[B],validateSpec:g.validateSpec,style:_,styleSpec:u})):o=o.concat([new mt(B,m[B],`unknown property "${B}"`)]);return o}function WP(g){return Vd(g).length===0?[]:ym(g)}function HP(g){return Vd(g).length===0?[]:ym(g)}function XP(g){let m=g.key,u=g.value;if(tn(u)==="array"){if(u.length<1||u.length>4)return[new mt(m,u,`padding requires 1 to 4 values; ${u.length} values found`)];let x={type:"number"},_=[];for(let o=0;o<u.length;o++)_=_.concat(g.validateSpec({key:`${m}[${o}]`,value:u[o],validateSpec:g.validateSpec,valueSpec:x}));return _}else return py({key:m,value:u,valueSpec:{}})}function KP(g){let m=g.key,u=g.value;if(tn(u)==="array"){let x={type:"number"};if(u.length<1)return[new mt(m,u,"array length at least 1 expected, length 0 found")];let _=[];for(let o=0;o<u.length;o++)_=_.concat(g.validateSpec({key:`${m}[${o}]`,value:u[o],validateSpec:g.validateSpec,valueSpec:x}));return _}else return py({key:m,value:u,valueSpec:{}})}function YP(g){let m=g.key,u=g.value;if(tn(u)==="array"){if(u.length<1)return[new mt(m,u,"array length at least 1 expected, length 0 found")];let x=[];for(let _=0;_<u.length;_++)x=x.concat(Hx({key:`${m}[${_}]`,value:u[_]}));return x}else return Hx({key:m,value:u})}function JP(g){let m=g.key,u=g.value,x=tn(u),_=g.styleSpec;if(x!=="array"||u.length<1||u.length%2!==0)return[new mt(m,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let C=0;C<u.length;C+=2)o=o.concat(Rg({key:`${m}[${C}]`,value:u[C],valueSpec:_.layout_symbol["text-anchor"]})),o=o.concat(d1({key:`${m}[${C+1}]`,value:u[C+1],valueSpec:{length:2,value:"number"},validateSpec:g.validateSpec,style:g.style,styleSpec:_}));return o}function U2(g){let m=[],u=g.value,x=g.key;if(Array.isArray(u)){let _=[],o=[];for(let C in u){u[C].id&&_.includes(u[C].id)&&m.push(new mt(x,u,`all the sprites' ids must be unique, but ${u[C].id} is duplicated`)),_.push(u[C].id),u[C].url&&o.includes(u[C].url)&&m.push(new mt(x,u,`all the sprites' URLs must be unique, but ${u[C].url} is duplicated`)),o.push(u[C].url);let B={id:{type:"string",required:!0},url:{type:"string",required:!0}};m=m.concat(Wl({key:`${x}[${C}]`,value:u[C],valueSpec:B,validateSpec:g.validateSpec}))}return m}else return Vd({key:x,value:u})}function QP(g){let m=g.value,u=g.styleSpec,x=u.projection,_=g.style,o=tn(m);if(m===void 0)return[];if(o!=="object")return[new mt("projection",m,`object expected, ${o} found`)];let C=[];for(let B in m)x[B]?C=C.concat(g.validateSpec({key:B,value:m[B],valueSpec:x[B],style:_,styleSpec:u})):C=C.concat([new mt(B,m[B],`unknown property "${B}"`)]);return C}function eC(g){let m=g.key,u=g.value;u=u instanceof String?u.valueOf():u;let x=tn(u);return x==="array"&&!iC(u)&&!tC(u)?[new mt(m,u,`projection expected, invalid array ${JSON.stringify(u)} found`)]:["array","string"].includes(x)?[]:[new mt(m,u,`projection expected, invalid type "${x}" found`)]}function tC(g){return!!["interpolate","step","literal"].includes(g[0])}function iC(g){return Array.isArray(g)&&g.length===3&&typeof g[0]=="string"&&typeof g[1]=="string"&&typeof g[2]=="number"}function nC(g){return!!g&&g.constructor===Object}function N2(g){return nC(g.value)?[]:[new mt(g.key,g.value,`object expected, ${tn(g.value)} found`)]}var zw={"*"(){return[]},array:d1,boolean:GP,number:py,color:Hx,constants:E2,enum:Rg,filter:m1,function:A2,layer:R2,object:Wl,source:F2,light:B2,sky:O2,terrain:j2,projection:QP,projectionDefinition:eC,string:Vd,formatted:WP,resolvedImage:HP,padding:XP,numberArray:KP,colorArray:YP,variableAnchorOffsetCollection:JP,sprite:U2,state:N2};function X_(g){let m=g.value,u=g.valueSpec,x=g.styleSpec;return g.validateSpec=X_,u.expression&&h1(Ur(m))?A2(g):u.expression&&P2(Nd(m))?ym(g):u.type&&zw[u.type]?zw[u.type](g):Wl(D_({},g,{valueSpec:u.type?x[u.type]:u}))}function V2(g){let m=g.value,u=g.key,x=Vd(g);return x.length||(m.indexOf("{fontstack}")===-1&&x.push(new mt(u,m,'"glyphs" url must include a "{fontstack}" token')),m.indexOf("{range}")===-1&&x.push(new mt(u,m,'"glyphs" url must include a "{range}" token'))),x}function zl(g,m=LI){let u=[];return u=u.concat(X_({key:"",value:g,valueSpec:m.$root,styleSpec:m,style:g,validateSpec:X_,objectElementValidators:{glyphs:V2,"*"(){return[]}}})),g.constants&&(u=u.concat(E2({key:"constants",value:g.constants}))),$2(u)}zl.source=du(pu(F2));zl.sprite=du(pu(U2));zl.glyphs=du(pu(V2));zl.light=du(pu(B2));zl.sky=du(pu(O2));zl.terrain=du(pu(j2));zl.state=du(pu(N2));zl.layer=du(pu(R2));zl.filter=du(pu(m1));zl.paintProperty=du(pu(D2));zl.layoutProperty=du(pu(z2));function pu(g){return function(m){return g(Rl(Vi({},m),{validateSpec:X_}))}}function $2(g){return[].concat(g).sort((m,u)=>m.line-u.line)}function du(g){return function(...m){return $2(g.apply(this,m))}}function Rw(g){if(!g)return{style:$l[Lh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof g=="string"){let m=oC(g);return m.isValidStyle?{style:m.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:m.isValidJSON?{style:$l[Lh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:g.startsWith("http")?{style:g,requiresUrlMonitoring:!0,isFallback:!1}:g.toLowerCase().includes(".json")?{style:rC(g),requiresUrlMonitoring:!0,isFallback:!1}:{style:hg(g),requiresUrlMonitoring:!0,isFallback:!1}}return g instanceof Kh?{style:g.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:g instanceof Yh?{style:g.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:zl(g).length===0?{style:g,requiresUrlMonitoring:!1,isFallback:!1}:{style:$l[Lh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function rC(g){try{return new URL(g).href}catch{}return new URL(g,location.origin).href}function oC(g){try{let m=JSON.parse(g),u=zl(m);return{isValidJSON:!0,isValidStyle:u.length===0,styleObject:u.length===0?m:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function vu(g,m,u){let x=window.document.createElement(g);return m!==void 0&&(x.className=m),u&&u.appendChild(x),x}function dy(g){g.parentNode&&g.parentNode.removeChild(g)}var K_=class{constructor(){Ft(this,"_map"),Ft(this,"_container"),Ft(this,"_terrainButton"),RS(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=vu("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=vu("button","maplibregl-ctrl-terrain",this._container),vu("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){dy(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}},Y_=class extends gm{constructor(m={}){super({showCompass:m.showCompass??!0,showZoom:m.showZoom??!0,visualizePitch:m.visualizePitch??!0}),Ft(this,"_rotateCompassArrow",()=>{let u=this._map.getBearing(),x=this._map.getPitch(),_=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(x*(Math.PI/180))**.5)}) rotateX(${Math.min(70,x)}deg) rotateZ(${-u}deg)`:`rotate(${-u}deg)`;this._compassIcon.style.transform=_}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",u=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:u}):this._map.resetNorth({},{originalEvent:u})}))}_createButton(m,u){let x=super._createButton(m,u);return x.clickFunction=u,x}},Fw=Gt.default.Marker,Bw=Gt.default.LngLat,aC=Gt.default.LngLatBounds,J_=class extends E_{constructor(){super(...arguments),Ft(this,"lastUpdatedCenter",new Bw(0,0)),Ft(this,"_updateCamera",m=>{var u;let x=new Bw(m.coords.longitude,m.coords.latitude),_=m.coords.accuracy,o=Rl(Vi({bearing:this._map.getBearing()},this.options.fitBoundsOptions),{linear:!0}),C=this._map.getZoom();C>(((u=this.options.fitBoundsOptions)==null?void 0:u.maxZoom)??30)&&(o.zoom=C),this._map.fitBounds(aC.fromLngLat(x,_),o,{geolocateSource:!0});let B=!1,$=()=>{B=!0};this._map.once("click",$),this._map.once("dblclick",$),this._map.once("dragstart",$),this._map.once("mousedown",$),this._map.once("touchstart",$),this._map.once("wheel",$),this._map.once("moveend",()=>{this._map.off("click",$),this._map.off("dblclick",$),this._map.off("dragstart",$),this._map.off("mousedown",$),this._map.off("touchstart",$),this._map.off("wheel",$),!B&&(this.lastUpdatedCenter=this._map.getCenter())})}),Ft(this,"_finishSetupUI",m=>{if(this._map){if(m===!1){let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{let u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=vu("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Fw({element:this._dotElement}),this._circleElement=vu("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fw({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",u=>{let x=u.originalEvent&&u.originalEvent.type==="resize",_=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!u.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!x&&_>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),Ft(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;let m=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],u=this._map.project(m),x=this._map.unproject([u.x,u.y]),_=this._map.unproject([u.x+20,u.y]),o=x.distanceTo(_)/20,C=Math.ceil(2*this._accuracy/o);this._circleElement.style.width=`${C}px`,this._circleElement.style.height=`${C}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}},Ll,gu,Ld,Dd,Gl,S_,vs,G2,Zl,Z2,vg=class{constructor(m,u){Ad(this,vs),Ad(this,Ll),Ft(this,"map"),Ad(this,gu),Ad(this,Ld),Ad(this,Dd),Ad(this,Gl,!1),Ad(this,S_),m.style!==void 0&&um(this,Gl,!0),um(this,Ll,Rl(Vi(Rl(Vi({zoomAdjust:-4,position:"top-right"},u),{forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1}),m),{containerStyle:Vi({border:"1px solid #000",width:"400px",height:"300px"},m.containerStyle??{})})),m.lockZoom!==void 0&&(hn(this,Ll).minZoom=m.lockZoom,hn(this,Ll).maxZoom=m.lockZoom)}setStyle(m,u){hn(this,Gl)||this.map.setStyle(m,u),kl(this,vs,Zl).call(this)}addLayer(m,u){return hn(this,Gl)||this.map.addLayer(m,u),kl(this,vs,Zl).call(this),this.map}moveLayer(m,u){return hn(this,Gl)||this.map.moveLayer(m,u),kl(this,vs,Zl).call(this),this.map}removeLayer(m){return hn(this,Gl)||this.map.removeLayer(m),kl(this,vs,Zl).call(this),this}setLayerZoomRange(m,u,x){return hn(this,Gl)||this.map.setLayerZoomRange(m,u,x),kl(this,vs,Zl).call(this),this}setFilter(m,u,x){return hn(this,Gl)||this.map.setFilter(m,u,x),kl(this,vs,Zl).call(this),this}setPaintProperty(m,u,x,_){return hn(this,Gl)||this.map.setPaintProperty(m,u,x,_),kl(this,vs,Zl).call(this),this}setLayoutProperty(m,u,x,_){return hn(this,Gl)||this.map.setLayoutProperty(m,u,x,_),kl(this,vs,Zl).call(this),this}setGlyphs(m,u){return hn(this,Gl)||this.map.setGlyphs(m,u),kl(this,vs,Zl).call(this),this}onAdd(m){um(this,gu,m),um(this,Ld,vu("div","maplibregl-ctrl maplibregl-ctrl-group"));for(let[u,x]of Object.entries(hn(this,Ll).containerStyle))hn(this,Ld).style.setProperty(u,x);return hn(this,Ll).container=hn(this,Ld),hn(this,Ll).zoom=m.getZoom()+hn(this,Ll).zoomAdjust,this.map=new my(hn(this,Ll)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{kl(this,vs,G2).call(this,hn(this,Ll).parentRect),um(this,S_,kl(this,vs,Z2).call(this))}),hn(this,Ld)}onRemove(){var m;(m=hn(this,S_))==null||m.call(this),dy(hn(this,Ld))}};Ll=new WeakMap,gu=new WeakMap,Ld=new WeakMap,Dd=new WeakMap,Gl=new WeakMap,S_=new WeakMap,vs=new WeakSet,G2=function(g){g===void 0||g.linePaint===void 0&&g.fillPaint===void 0||(um(this,Dd,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:hn(this,Dd)}),(g.lineLayout!==void 0||g.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:Vi({},g.lineLayout),paint:Vi({"line-color":"#FFF","line-width":1,"line-opacity":.85},g.linePaint)}),g.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:Vi({"fill-color":"#08F","fill-opacity":.135},g.fillPaint)}),kl(this,vs,Zl).call(this))},Zl=function(){if(hn(this,Dd)===void 0)return;let{devicePixelRatio:g}=window,m=hn(this,gu).getCanvas(),u=m.width/g,x=m.height/g,_=hn(this,gu).unproject.bind(hn(this,gu)),o=_([0,0]),C=_([u,0]),B=_([0,x]),$=_([u,x]);hn(this,Dd).geometry.coordinates=[[B.toArray(),$.toArray(),C.toArray(),o.toArray(),B.toArray()]];let Y=this.map.getSource("parentRect");Y!==void 0&&Y.setData(hn(this,Dd))},Z2=function(){let{pitchAdjust:g}=hn(this,Ll),m=()=>{o("parent")},u=()=>{o("minimap")},x=()=>{hn(this,gu).on("move",m),this.map.on("move",u)},_=()=>{hn(this,gu).off("move",m),this.map.off("move",u)},o=C=>{_();let B=C==="parent"?hn(this,gu):this.map,$=C==="parent"?this.map:hn(this,gu),Y=B.getCenter(),ne=B.getZoom()+hn(this,Ll).zoomAdjust*(C==="parent"?1:-1),q=B.getBearing(),Ce=B.getPitch();$.jumpTo({center:Y,zoom:ne,bearing:q,pitch:g?Ce:0}),kl(this,vs,Zl).call(this),x()};return x(),()=>{_()}};var Q_=class{constructor(){Ft(this,"map"),Ft(this,"container"),Ft(this,"projectionButton")}onAdd(m){return this.map=m,this.container=vu("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=vu("button","maplibregl-ctrl-projection",this.container),vu("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),m.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){dy(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){this.map.getProjection()===void 0&&this.map.setProjection({type:"mercator"}),this.map.isGlobeProjection()?this.map.enableMercatorProjection():this.map.enableGlobeProjection(),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}},sC="@maptiler/sdk",lC="3.7.0",cC="The Javascript & TypeScript map SDK tailored for MapTiler Cloud",uC="MapTiler",hC="dist/maptiler-sdk.mjs",pC="dist/maptiler-sdk.d.ts",dC="dist/maptiler-sdk.css",mC="module",fC="dist/maptiler-sdk.mjs",gC={".":{import:"./dist/maptiler-sdk.mjs",types:"./dist/maptiler-sdk.d.ts"},"./dist/maptiler-sdk.css":{import:"./dist/maptiler-sdk.css"},"./style.css":{import:"./dist/maptiler-sdk.css"}},_C=["maptiler","map","sdk","webmap","cloud","webGL","maplibre"],yC="https://docs.maptiler.com/sdk-js/",vC="BSD-3-Clause",xC={type:"git",url:"https://github.com/maptiler/maptiler-sdk-js.git"},bC={prepare:"husky",doc:"rm -rf docs/* && typedoc --out docs && cp -r images docs/",ncu:"npx npm-check-updates",lint:"tsc --noEmit && eslint src","lint:fix":"tsc --noEmit && eslint src --fix","test:watch":"vitest watch -c vite.config-test.ts --dom",test:"vitest run -c vite.config-test.ts --dom","install:clean":"rm -rf build/ dist/ node_modules/ && npm ci",dev:"npm run build-css && vite -c vite.config-dev.ts","dev-umd":"npm run build-css && tsc && NODE_ENV=development vite build -w -c vite.config-umd.ts","build-css":"mkdir -p dist build && node scripts/replace-path-with-content.js src/style/style_template.css dist/tmp_maptiler-sdk.css && cat node_modules/maplibre-gl/dist/maplibre-gl.css dist/tmp_maptiler-sdk.css > dist/maptiler-sdk.css && rm dist/tmp_maptiler-sdk.css && cp dist/maptiler-sdk.css build/maptiler-sdk.css","build-umd":"tsc && NODE_ENV=production vite build -c vite.config-umd.ts","build-es":"tsc && NODE_ENV=production vite build -c vite.config-es.ts",build:"npm run build-es; npm run build-umd; npm run build-css",make:"npm run install:clean && npm run build"},wC={"@canvas/image-data":"^1.0.0","@eslint/js":"^9.21.0","@types/color-convert":"^2.0.4","@types/color-name":"^2.0.0","@types/stats.js":"^0.17.4","@types/uuid":"^10.0.0","@types/xmldom":"^0.1.31","@vitest/web-worker":"^3.0.9","@xmldom/xmldom":"^0.8.10",concurrently:"^9.1.2",eslint:"^9.21.0","eslint-config-prettier":"^10.0.2","eslint-plugin-prettier":"^5.2.3","happy-dom":"^17.4.4",husky:"^8.0.0",jiti:"^2.4.2","lint-staged":"^15.4.3",prettier:"3.5.2","stats.js":"^0.17.0",typedoc:"^0.27.6",typescript:"^5.7.3","typescript-eslint":"^8.25.0",vite:"^6.0.7","vite-plugin-dts":"^4.5.0",vitest:"^3.0.9"},TC={"@maplibre/maplibre-gl-style-spec":"~23.3.0","@maptiler/client":"~2.5.0",events:"^3.3.0","gl-matrix":"^3.4.3","js-base64":"^3.7.7","maplibre-gl":"~5.6.0",uuid:"^11.0.5"},SC={name:sC,version:lC,description:cC,author:uC,module:hC,types:pC,style:dC,type:mC,main:fC,exports:gC,keywords:_C,homepage:yC,license:vC,repository:xC,scripts:bC,"lint-staged":{"*.ts":"npm run lint:fix"},"ts-typecheck":{"*.ts":"npm tsc --noEmit"},devDependencies:wC,dependencies:TC},Xx=class{constructor(m,u=2e3){Ft(this,"map"),Ft(this,"registeredModules",new Set),this.map=m,setTimeout(()=>st(this,null,function*(){if(!xr.telemetry)return;let x=this.preparePayload();try{(yield fetch(x,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(_){console.warn("The metrics could not be sent to MapTiler Cloud",_)}}),Math.max(1e3,u))}registerModule(m,u){this.registeredModules.add(`${m}:${u}`)}preparePayload(){let m=new URL(xs.telemetryURL);return m.searchParams.append("sdk",SC.version),m.searchParams.append("key",xr.apiKey),m.searchParams.append("mtsid",r1),m.searchParams.append("session",xr.session?"1":"0"),m.searchParams.append("caching",xr.caching?"1":"0"),m.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),m.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),m.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),this.registeredModules.size>0&&m.searchParams.append("modules",Array.from(this.registeredModules).join("|")),m.href}},Fg=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var g=0,m=arguments.length;m--;)g+=arguments[m]*arguments[m];return Math.sqrt(g)});function xg(){var g=new Fg(16);return Fg!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0),g[0]=1,g[5]=1,g[10]=1,g[15]=1,g}function IC(g,m,u,x,_,o,C,B,$,Y,ne,q,Ce,Ie,Ae,De,qe){return g[0]=m,g[1]=u,g[2]=x,g[3]=_,g[4]=o,g[5]=C,g[6]=B,g[7]=$,g[8]=Y,g[9]=ne,g[10]=q,g[11]=Ce,g[12]=Ie,g[13]=Ae,g[14]=De,g[15]=qe,g}function PC(g,m,u){var x=m[0],_=m[1],o=m[2],C=m[3],B=m[4],$=m[5],Y=m[6],ne=m[7],q=m[8],Ce=m[9],Ie=m[10],Ae=m[11],De=m[12],qe=m[13],Qe=m[14],nt=m[15],vt=u[0],tt=u[1],At=u[2],Yt=u[3];return g[0]=vt*x+tt*B+At*q+Yt*De,g[1]=vt*_+tt*$+At*Ce+Yt*qe,g[2]=vt*o+tt*Y+At*Ie+Yt*Qe,g[3]=vt*C+tt*ne+At*Ae+Yt*nt,vt=u[4],tt=u[5],At=u[6],Yt=u[7],g[4]=vt*x+tt*B+At*q+Yt*De,g[5]=vt*_+tt*$+At*Ce+Yt*qe,g[6]=vt*o+tt*Y+At*Ie+Yt*Qe,g[7]=vt*C+tt*ne+At*Ae+Yt*nt,vt=u[8],tt=u[9],At=u[10],Yt=u[11],g[8]=vt*x+tt*B+At*q+Yt*De,g[9]=vt*_+tt*$+At*Ce+Yt*qe,g[10]=vt*o+tt*Y+At*Ie+Yt*Qe,g[11]=vt*C+tt*ne+At*Ae+Yt*nt,vt=u[12],tt=u[13],At=u[14],Yt=u[15],g[12]=vt*x+tt*B+At*q+Yt*De,g[13]=vt*_+tt*$+At*Ce+Yt*qe,g[14]=vt*o+tt*Y+At*Ie+Yt*Qe,g[15]=vt*C+tt*ne+At*Ae+Yt*nt,g}function CC(g,m,u){var x=u[0],_=u[1],o=u[2];return g[0]=m[0]*x,g[1]=m[1]*x,g[2]=m[2]*x,g[3]=m[3]*x,g[4]=m[4]*_,g[5]=m[5]*_,g[6]=m[6]*_,g[7]=m[7]*_,g[8]=m[8]*o,g[9]=m[9]*o,g[10]=m[10]*o,g[11]=m[11]*o,g[12]=m[12],g[13]=m[13],g[14]=m[14],g[15]=m[15],g}function Ow(g,m,u){var x=Math.sin(u),_=Math.cos(u),o=m[4],C=m[5],B=m[6],$=m[7],Y=m[8],ne=m[9],q=m[10],Ce=m[11];return m!==g&&(g[0]=m[0],g[1]=m[1],g[2]=m[2],g[3]=m[3],g[12]=m[12],g[13]=m[13],g[14]=m[14],g[15]=m[15]),g[4]=o*_+Y*x,g[5]=C*_+ne*x,g[6]=B*_+q*x,g[7]=$*_+Ce*x,g[8]=Y*_-o*x,g[9]=ne*_-C*x,g[10]=q*_-B*x,g[11]=Ce*_-$*x,g}function MC(g,m,u){var x=Math.sin(u),_=Math.cos(u),o=m[0],C=m[1],B=m[2],$=m[3],Y=m[8],ne=m[9],q=m[10],Ce=m[11];return m!==g&&(g[4]=m[4],g[5]=m[5],g[6]=m[6],g[7]=m[7],g[12]=m[12],g[13]=m[13],g[14]=m[14],g[15]=m[15]),g[0]=o*_-Y*x,g[1]=C*_-ne*x,g[2]=B*_-q*x,g[3]=$*_-Ce*x,g[8]=o*x+Y*_,g[9]=C*x+ne*_,g[10]=B*x+q*_,g[11]=$*x+Ce*_,g}function jw(g,m,u){var x=Math.sin(u),_=Math.cos(u),o=m[0],C=m[1],B=m[2],$=m[3],Y=m[4],ne=m[5],q=m[6],Ce=m[7];return m!==g&&(g[8]=m[8],g[9]=m[9],g[10]=m[10],g[11]=m[11],g[12]=m[12],g[13]=m[13],g[14]=m[14],g[15]=m[15]),g[0]=o*_+Y*x,g[1]=C*_+ne*x,g[2]=B*_+q*x,g[3]=$*_+Ce*x,g[4]=Y*_-o*x,g[5]=ne*_-C*x,g[6]=q*_-B*x,g[7]=Ce*_-$*x,g}function EC(g,m,u,x,_){var o=1/Math.tan(m/2),C;return g[0]=o/u,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=o,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=-1,g[12]=0,g[13]=0,g[15]=0,_!=null&&_!==1/0?(C=1/(x-_),g[10]=(_+x)*C,g[14]=2*_*x*C):(g[10]=-1,g[14]=-2*x),g}var AC=EC;function I_(){var g=new Fg(3);return Fg!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0),g}function kC(g,m,u){var x=new Fg(3);return x[0]=g,x[1]=m,x[2]=u,x}function rx(g,m){var u=m[0],x=m[1],_=m[2],o=u*u+x*x+_*_;return o>0&&(o=1/Math.sqrt(o)),g[0]=m[0]*o,g[1]=m[1]*o,g[2]=m[2]*o,g}function Uw(g,m,u){var x=m[0],_=m[1],o=m[2],C=u[0],B=u[1],$=u[2];return g[0]=_*$-o*B,g[1]=o*C-x*$,g[2]=x*B-_*C,g}(function(){var g=I_();return function(m,u,x,_,o,C){var B,$;for(u||(u=3),x||(x=0),_?$=Math.min(_*u+x,m.length):$=m.length,B=x;B<$;B+=u)g[0]=m[B],g[1]=m[B+1],g[2]=m[B+2],o(g,g,C),m[B]=g[0],m[B+1]=g[1],m[B+2]=g[2];return m}})();function LC(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var Nw,Vw;function DC(){return Vw||(Vw=1,Nw={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),Nw}var ox,$w;function q2(){if($w)return ox;$w=1;let g=DC(),m={};for(let _ of Object.keys(g))m[g[_]]=_;let u={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};ox=u;for(let _ of Object.keys(u)){if(!("channels"in u[_]))throw new Error("missing channels property: "+_);if(!("labels"in u[_]))throw new Error("missing channel labels property: "+_);if(u[_].labels.length!==u[_].channels)throw new Error("channel and label counts mismatch: "+_);let{channels:o,labels:C}=u[_];delete u[_].channels,delete u[_].labels,Object.defineProperty(u[_],"channels",{value:o}),Object.defineProperty(u[_],"labels",{value:C})}u.rgb.hsl=function(_){let o=_[0]/255,C=_[1]/255,B=_[2]/255,$=Math.min(o,C,B),Y=Math.max(o,C,B),ne=Y-$,q,Ce;Y===$?q=0:o===Y?q=(C-B)/ne:C===Y?q=2+(B-o)/ne:B===Y&&(q=4+(o-C)/ne),q=Math.min(q*60,360),q<0&&(q+=360);let Ie=($+Y)/2;return Y===$?Ce=0:Ie<=.5?Ce=ne/(Y+$):Ce=ne/(2-Y-$),[q,Ce*100,Ie*100]},u.rgb.hsv=function(_){let o,C,B,$,Y,ne=_[0]/255,q=_[1]/255,Ce=_[2]/255,Ie=Math.max(ne,q,Ce),Ae=Ie-Math.min(ne,q,Ce),De=function(qe){return(Ie-qe)/6/Ae+1/2};return Ae===0?($=0,Y=0):(Y=Ae/Ie,o=De(ne),C=De(q),B=De(Ce),ne===Ie?$=B-C:q===Ie?$=1/3+o-B:Ce===Ie&&($=2/3+C-o),$<0?$+=1:$>1&&($-=1)),[$*360,Y*100,Ie*100]},u.rgb.hwb=function(_){let o=_[0],C=_[1],B=_[2],$=u.rgb.hsl(_)[0],Y=1/255*Math.min(o,Math.min(C,B));return B=1-1/255*Math.max(o,Math.max(C,B)),[$,Y*100,B*100]},u.rgb.cmyk=function(_){let o=_[0]/255,C=_[1]/255,B=_[2]/255,$=Math.min(1-o,1-C,1-B),Y=(1-o-$)/(1-$)||0,ne=(1-C-$)/(1-$)||0,q=(1-B-$)/(1-$)||0;return[Y*100,ne*100,q*100,$*100]};function x(_,o){return(_[0]-o[0])**2+(_[1]-o[1])**2+(_[2]-o[2])**2}return u.rgb.keyword=function(_){let o=m[_];if(o)return o;let C=1/0,B;for(let $ of Object.keys(g)){let Y=g[$],ne=x(_,Y);ne<C&&(C=ne,B=$)}return B},u.keyword.rgb=function(_){return g[_]},u.rgb.xyz=function(_){let o=_[0]/255,C=_[1]/255,B=_[2]/255;o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92,B=B>.04045?((B+.055)/1.055)**2.4:B/12.92;let $=o*.4124+C*.3576+B*.1805,Y=o*.2126+C*.7152+B*.0722,ne=o*.0193+C*.1192+B*.9505;return[$*100,Y*100,ne*100]},u.rgb.lab=function(_){let o=u.rgb.xyz(_),C=o[0],B=o[1],$=o[2];C/=95.047,B/=100,$/=108.883,C=C>.008856?C**(1/3):7.787*C+16/116,B=B>.008856?B**(1/3):7.787*B+16/116,$=$>.008856?$**(1/3):7.787*$+16/116;let Y=116*B-16,ne=500*(C-B),q=200*(B-$);return[Y,ne,q]},u.hsl.rgb=function(_){let o=_[0]/360,C=_[1]/100,B=_[2]/100,$,Y,ne;if(C===0)return ne=B*255,[ne,ne,ne];B<.5?$=B*(1+C):$=B+C-B*C;let q=2*B-$,Ce=[0,0,0];for(let Ie=0;Ie<3;Ie++)Y=o+1/3*-(Ie-1),Y<0&&Y++,Y>1&&Y--,6*Y<1?ne=q+($-q)*6*Y:2*Y<1?ne=$:3*Y<2?ne=q+($-q)*(2/3-Y)*6:ne=q,Ce[Ie]=ne*255;return Ce},u.hsl.hsv=function(_){let o=_[0],C=_[1]/100,B=_[2]/100,$=C,Y=Math.max(B,.01);B*=2,C*=B<=1?B:2-B,$*=Y<=1?Y:2-Y;let ne=(B+C)/2,q=B===0?2*$/(Y+$):2*C/(B+C);return[o,q*100,ne*100]},u.hsv.rgb=function(_){let o=_[0]/60,C=_[1]/100,B=_[2]/100,$=Math.floor(o)%6,Y=o-Math.floor(o),ne=255*B*(1-C),q=255*B*(1-C*Y),Ce=255*B*(1-C*(1-Y));switch(B*=255,$){case 0:return[B,Ce,ne];case 1:return[q,B,ne];case 2:return[ne,B,Ce];case 3:return[ne,q,B];case 4:return[Ce,ne,B];case 5:return[B,ne,q]}},u.hsv.hsl=function(_){let o=_[0],C=_[1]/100,B=_[2]/100,$=Math.max(B,.01),Y,ne;ne=(2-C)*B;let q=(2-C)*$;return Y=C*$,Y/=q<=1?q:2-q,Y=Y||0,ne/=2,[o,Y*100,ne*100]},u.hwb.rgb=function(_){let o=_[0]/360,C=_[1]/100,B=_[2]/100,$=C+B,Y;$>1&&(C/=$,B/=$);let ne=Math.floor(6*o),q=1-B;Y=6*o-ne,ne&1&&(Y=1-Y);let Ce=C+Y*(q-C),Ie,Ae,De;switch(ne){default:case 6:case 0:Ie=q,Ae=Ce,De=C;break;case 1:Ie=Ce,Ae=q,De=C;break;case 2:Ie=C,Ae=q,De=Ce;break;case 3:Ie=C,Ae=Ce,De=q;break;case 4:Ie=Ce,Ae=C,De=q;break;case 5:Ie=q,Ae=C,De=Ce;break}return[Ie*255,Ae*255,De*255]},u.cmyk.rgb=function(_){let o=_[0]/100,C=_[1]/100,B=_[2]/100,$=_[3]/100,Y=1-Math.min(1,o*(1-$)+$),ne=1-Math.min(1,C*(1-$)+$),q=1-Math.min(1,B*(1-$)+$);return[Y*255,ne*255,q*255]},u.xyz.rgb=function(_){let o=_[0]/100,C=_[1]/100,B=_[2]/100,$,Y,ne;return $=o*3.2406+C*-1.5372+B*-.4986,Y=o*-.9689+C*1.8758+B*.0415,ne=o*.0557+C*-.204+B*1.057,$=$>.0031308?1.055*$**(1/2.4)-.055:$*12.92,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:Y*12.92,ne=ne>.0031308?1.055*ne**(1/2.4)-.055:ne*12.92,$=Math.min(Math.max(0,$),1),Y=Math.min(Math.max(0,Y),1),ne=Math.min(Math.max(0,ne),1),[$*255,Y*255,ne*255]},u.xyz.lab=function(_){let o=_[0],C=_[1],B=_[2];o/=95.047,C/=100,B/=108.883,o=o>.008856?o**(1/3):7.787*o+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,B=B>.008856?B**(1/3):7.787*B+16/116;let $=116*C-16,Y=500*(o-C),ne=200*(C-B);return[$,Y,ne]},u.lab.xyz=function(_){let o=_[0],C=_[1],B=_[2],$,Y,ne;Y=(o+16)/116,$=C/500+Y,ne=Y-B/200;let q=Y**3,Ce=$**3,Ie=ne**3;return Y=q>.008856?q:(Y-16/116)/7.787,$=Ce>.008856?Ce:($-16/116)/7.787,ne=Ie>.008856?Ie:(ne-16/116)/7.787,$*=95.047,Y*=100,ne*=108.883,[$,Y,ne]},u.lab.lch=function(_){let o=_[0],C=_[1],B=_[2],$;$=Math.atan2(B,C)*360/2/Math.PI,$<0&&($+=360);let Y=Math.sqrt(C*C+B*B);return[o,Y,$]},u.lch.lab=function(_){let o=_[0],C=_[1],B=_[2]/360*2*Math.PI,$=C*Math.cos(B),Y=C*Math.sin(B);return[o,$,Y]},u.rgb.ansi16=function(_,o=null){let[C,B,$]=_,Y=o===null?u.rgb.hsv(_)[2]:o;if(Y=Math.round(Y/50),Y===0)return 30;let ne=30+(Math.round($/255)<<2|Math.round(B/255)<<1|Math.round(C/255));return Y===2&&(ne+=60),ne},u.hsv.ansi16=function(_){return u.rgb.ansi16(u.hsv.rgb(_),_[2])},u.rgb.ansi256=function(_){let o=_[0],C=_[1],B=_[2];return o===C&&C===B?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(C/255*5)+Math.round(B/255*5)},u.ansi16.rgb=function(_){let o=_%10;if(o===0||o===7)return _>50&&(o+=3.5),o=o/10.5*255,[o,o,o];let C=(~~(_>50)+1)*.5,B=(o&1)*C*255,$=(o>>1&1)*C*255,Y=(o>>2&1)*C*255;return[B,$,Y]},u.ansi256.rgb=function(_){if(_>=232){let Y=(_-232)*10+8;return[Y,Y,Y]}_-=16;let o,C=Math.floor(_/36)/5*255,B=Math.floor((o=_%36)/6)/5*255,$=o%6/5*255;return[C,B,$]},u.rgb.hex=function(_){let o=(((Math.round(_[0])&255)<<16)+((Math.round(_[1])&255)<<8)+(Math.round(_[2])&255)).toString(16).toUpperCase();return"000000".substring(o.length)+o},u.hex.rgb=function(_){let o=_.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!o)return[0,0,0];let C=o[0];o[0].length===3&&(C=C.split("").map(q=>q+q).join(""));let B=parseInt(C,16),$=B>>16&255,Y=B>>8&255,ne=B&255;return[$,Y,ne]},u.rgb.hcg=function(_){let o=_[0]/255,C=_[1]/255,B=_[2]/255,$=Math.max(Math.max(o,C),B),Y=Math.min(Math.min(o,C),B),ne=$-Y,q,Ce;return ne<1?q=Y/(1-ne):q=0,ne<=0?Ce=0:$===o?Ce=(C-B)/ne%6:$===C?Ce=2+(B-o)/ne:Ce=4+(o-C)/ne,Ce/=6,Ce%=1,[Ce*360,ne*100,q*100]},u.hsl.hcg=function(_){let o=_[1]/100,C=_[2]/100,B=C<.5?2*o*C:2*o*(1-C),$=0;return B<1&&($=(C-.5*B)/(1-B)),[_[0],B*100,$*100]},u.hsv.hcg=function(_){let o=_[1]/100,C=_[2]/100,B=o*C,$=0;return B<1&&($=(C-B)/(1-B)),[_[0],B*100,$*100]},u.hcg.rgb=function(_){let o=_[0]/360,C=_[1]/100,B=_[2]/100;if(C===0)return[B*255,B*255,B*255];let $=[0,0,0],Y=o%1*6,ne=Y%1,q=1-ne,Ce=0;switch(Math.floor(Y)){case 0:$[0]=1,$[1]=ne,$[2]=0;break;case 1:$[0]=q,$[1]=1,$[2]=0;break;case 2:$[0]=0,$[1]=1,$[2]=ne;break;case 3:$[0]=0,$[1]=q,$[2]=1;break;case 4:$[0]=ne,$[1]=0,$[2]=1;break;default:$[0]=1,$[1]=0,$[2]=q}return Ce=(1-C)*B,[(C*$[0]+Ce)*255,(C*$[1]+Ce)*255,(C*$[2]+Ce)*255]},u.hcg.hsv=function(_){let o=_[1]/100,C=_[2]/100,B=o+C*(1-o),$=0;return B>0&&($=o/B),[_[0],$*100,B*100]},u.hcg.hsl=function(_){let o=_[1]/100,C=_[2]/100*(1-o)+.5*o,B=0;return C>0&&C<.5?B=o/(2*C):C>=.5&&C<1&&(B=o/(2*(1-C))),[_[0],B*100,C*100]},u.hcg.hwb=function(_){let o=_[1]/100,C=_[2]/100,B=o+C*(1-o);return[_[0],(B-o)*100,(1-B)*100]},u.hwb.hcg=function(_){let o=_[1]/100,C=1-_[2]/100,B=C-o,$=0;return B<1&&($=(C-B)/(1-B)),[_[0],B*100,$*100]},u.apple.rgb=function(_){return[_[0]/65535*255,_[1]/65535*255,_[2]/65535*255]},u.rgb.apple=function(_){return[_[0]/255*65535,_[1]/255*65535,_[2]/255*65535]},u.gray.rgb=function(_){return[_[0]/100*255,_[0]/100*255,_[0]/100*255]},u.gray.hsl=function(_){return[0,0,_[0]]},u.gray.hsv=u.gray.hsl,u.gray.hwb=function(_){return[0,100,_[0]]},u.gray.cmyk=function(_){return[0,0,0,_[0]]},u.gray.lab=function(_){return[_[0],0,0]},u.gray.hex=function(_){let o=Math.round(_[0]/100*255)&255,C=((o<<16)+(o<<8)+o).toString(16).toUpperCase();return"000000".substring(C.length)+C},u.rgb.gray=function(_){return[(_[0]+_[1]+_[2])/3/255*100]},ox}var ax,Gw;function zC(){if(Gw)return ax;Gw=1;let g=q2();function m(){let o={},C=Object.keys(g);for(let B=C.length,$=0;$<B;$++)o[C[$]]={distance:-1,parent:null};return o}function u(o){let C=m(),B=[o];for(C[o].distance=0;B.length;){let $=B.pop(),Y=Object.keys(g[$]);for(let ne=Y.length,q=0;q<ne;q++){let Ce=Y[q],Ie=C[Ce];Ie.distance===-1&&(Ie.distance=C[$].distance+1,Ie.parent=$,B.unshift(Ce))}}return C}function x(o,C){return function(B){return C(o(B))}}function _(o,C){let B=[C[o].parent,o],$=g[C[o].parent][o],Y=C[o].parent;for(;C[Y].parent;)B.unshift(C[Y].parent),$=x(g[C[Y].parent][Y],$),Y=C[Y].parent;return $.conversion=B,$}return ax=function(o){let C=u(o),B={},$=Object.keys(C);for(let Y=$.length,ne=0;ne<Y;ne++){let q=$[ne];C[q].parent!==null&&(B[q]=_(q,C))}return B},ax}var sx,Zw;function RC(){if(Zw)return sx;Zw=1;let g=q2(),m=zC(),u={},x=Object.keys(g);function _(C){let B=function(...$){let Y=$[0];return Y==null?Y:(Y.length>1&&($=Y),C($))};return"conversion"in C&&(B.conversion=C.conversion),B}function o(C){let B=function(...$){let Y=$[0];if(Y==null)return Y;Y.length>1&&($=Y);let ne=C($);if(typeof ne=="object")for(let q=ne.length,Ce=0;Ce<q;Ce++)ne[Ce]=Math.round(ne[Ce]);return ne};return"conversion"in C&&(B.conversion=C.conversion),B}return x.forEach(C=>{u[C]={},Object.defineProperty(u[C],"channels",{value:g[C].channels}),Object.defineProperty(u[C],"labels",{value:g[C].labels});let B=m(C);Object.keys(B).forEach($=>{let Y=B[$];u[C][$]=o(Y),u[C][$].raw=_(Y)})}),sx=u,sx}var FC=RC(),BC=LC(FC);function qw({gl:g,type:m,source:u}){let x=g.createShader(m);if(x===null)throw new Error("Cannot create shader");if(g.shaderSource(x,u),g.compileShader(x),!g.getShaderParameter(x,g.COMPILE_STATUS))throw console.error("Shader compilation error:",g.getShaderInfoLog(x)),g.deleteShader(x),new Error("Cannot compile shader");return x}function OC({gl:g,vertexShaderSource:m,fragmentShaderSource:u}){let x=qw({gl:g,type:g.VERTEX_SHADER,source:m}),_=qw({gl:g,type:g.FRAGMENT_SHADER,source:u}),o=g.createProgram();if(g.attachShader(o,x),g.attachShader(o,_),g.linkProgram(o),!g.getProgramParameter(o,g.LINK_STATUS))throw console.error("Error: ",g.getProgramInfoLog(o)),new Error("Cannot link shader program");return o}function jC(g,m,u){let x=g.getUniformLocation(m,u);if(x===null)throw new Error(`Cannot get uniform location for ${u}`);return x}function W2({gl:g,vertexShaderSource:m,fragmentShaderSource:u,attributesKeys:x,uniformsKeys:_,vertices:o,indices:C}){let B=OC({gl:g,vertexShaderSource:m,fragmentShaderSource:u}),$=x.reduce((Ie,Ae)=>(Ie[Ae]=g.getAttribLocation(B,`a_${Ae}`),Ie),{}),Y=_.reduce((Ie,Ae)=>(Ie[Ae]=jC(g,B,`u_${Ae}`),Ie),{}),ne=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,ne),g.bufferData(g.ARRAY_BUFFER,new Float32Array(o),g.STATIC_DRAW);let q,Ce;return C!==void 0&&(q=g.createBuffer(),Ce=C.length,g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,q),g.bufferData(g.ELEMENT_ARRAY_BUFFER,new Uint16Array(C),g.STATIC_DRAW)),{shaderProgram:B,programInfo:{attributesLocations:$,uniformsLocations:Y},positionBuffer:ne,indexBuffer:q,indexBufferLength:Ce}}function P_(g){if(!g)return[1,1,1,0];if(g==="transparent")return[1,1,1,0];try{let m=UC(g),u=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(m);if(u!=null&&u.length){let _=!!u[4];return[...BC.hex.rgb(m).map(o=>o/255),_?parseInt(u[4],16)/255:1]}let x=m.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(m.includes("rgb")){let _=m.includes("rgba"),o=[...x.map(C=>parseFloat(C)).map((C,B)=>B<3?C/255:C)];return _||o.push(1),o}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${g} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}var mg;function UC(g){return mg=mg??document.createElement("canvas").getContext("2d"),mg?(mg.fillStyle=g,mg.fillStyle):"#000000"}var f1=1,Hl=f1/2,Xl=f1/2,Kl=f1/2,NC=[-.5,-.5,Kl,Hl,-.5,Kl,Hl,Xl,Kl,-.5,Xl,Kl],VC=[-.5,-.5,-.5,-.5,Xl,-.5,Hl,Xl,-.5,Hl,-.5,-.5],$C=[-.5,Xl,-.5,-.5,Xl,Kl,Hl,Xl,Kl,Hl,Xl,-.5],GC=[-.5,-.5,-.5,Hl,-.5,-.5,Hl,-.5,Kl,-.5,-.5,Kl],ZC=[Hl,-.5,-.5,Hl,Xl,-.5,Hl,Xl,Kl,Hl,-.5,Kl],qC=[-.5,-.5,-.5,-.5,-.5,Kl,-.5,Xl,Kl,-.5,Xl,-.5],WC=[...NC,...VC,...$C,...GC,...ZC,...qC],HC=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],XC=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,Ww=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,H2=(g=>(g.UNIVERSE_DARK="universe-dark",g))(H2||{}),ip={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}},Qh=(g=>(g.POSITIVE_X="pX",g.NEGATIVE_X="nX",g.POSITIVE_Y="pY",g.NEGATIVE_Y="nY",g.POSITIVE_Z="pZ",g.NEGATIVE_Z="nZ",g))(Qh||{}),b_,Hw,Xw;function KC({gl:g,faces:m,onReady:u,forceRefresh:x}){b_&&!x&&Xw===JSON.stringify(m)&&u(b_,Hw),Xw=JSON.stringify(m);let _=b_??g.createTexture();if(g.bindTexture(g.TEXTURE_CUBE_MAP,_),!m){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}let o=Object.keys(m).length;if(o!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${o}`);return}let C=Object.entries(m).map(([B,$])=>new Promise((Y,ne)=>{let q=B;if($===void 0){ne(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${B} is undefined`));return}let Ce=new Image;Ce.crossOrigin="anonymous";let Ie=()=>{Y({image:Ce,key:q})};Ce.src=$,Ce.complete&&Ce.naturalWidth>0?Ie():Ce.onload=Ie,Ce.onerror=()=>{ne(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${$}`))}}));Promise.all(C).then(B=>{for(let Y=0;Y<B.length;Y++){let ne=g.RGBA,q=g.RGBA,Ce=g.UNSIGNED_BYTE,{image:Ie,key:Ae}=B[Y]??{};if(!Ie||!Ae){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}let De=YC(g,Ae);g.bindTexture(g.TEXTURE_CUBE_MAP,_),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_MAG_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texImage2D(De,0,ne,q,Ce,Ie)}g.bindTexture(g.TEXTURE_CUBE_MAP,_),g.generateMipmap(g.TEXTURE_CUBE_MAP),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_MIN_FILTER,g.LINEAR_MIPMAP_LINEAR),g.texParameteri(g.TEXTURE_CUBE_MAP,g.TEXTURE_MAG_FILTER,g.LINEAR);let $=B.map(Y=>Y.image);u(_,$),Hw=$,b_=_}).catch(B=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",B)})}function YC(g,m){if(m===Qh.POSITIVE_X)return g.TEXTURE_CUBE_MAP_POSITIVE_X;if(m===Qh.NEGATIVE_X)return g.TEXTURE_CUBE_MAP_NEGATIVE_X;if(m===Qh.POSITIVE_Y)return g.TEXTURE_CUBE_MAP_POSITIVE_Y;if(m===Qh.NEGATIVE_Y)return g.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(m===Qh.POSITIVE_Z)return g.TEXTURE_CUBE_MAP_POSITIVE_Z;if(m===Qh.NEGATIVE_Z)return g.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${m}`)}function JC(g,m,u){return[tp(g[0],m[0],u),tp(g[1],m[1],u),tp(g[2],m[2],u),tp(g[3],m[3],u)]}function tp(g,m,u){return g+(m-g)*u}var cm="https://api.maptiler.com/resources/space",QC=["vertexPosition"],eM=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],Kw="%USE_TEXTURE_MACRO_MARKER%",tM="#define USE_TEXTURE",iM=ip.stars;function nM(g,m){if(!X2(g))return{color:"transparent"};if(g===!0)return m;let u=Vi({},g);if(g.faces||g.path)return delete u.preset,u;let x=g.preset;if(x!==void 0&&!(x in ip))throw new Error(`[CubemapLayer]: Invalid preset "${x}". Available presets: ${Object.keys(ip).join(", ")}`);return Rl(Vi({},u),{color:u.color??ip[x].color??"hsl(233,100%,92%)"})}var mm=class{constructor(m){Ft(this,"id","Cubemap Layer"),Ft(this,"type","custom"),Ft(this,"renderingMode","3d"),Ft(this,"map"),Ft(this,"faces"),Ft(this,"useCubemapTexture",!0),Ft(this,"currentFadeOpacity",0),Ft(this,"cubeMapNeedsUpdate",!1),Ft(this,"bgColor"),Ft(this,"previousBgColor",[0,0,0,0]),Ft(this,"targetBgColor",[0,0,0,0]),Ft(this,"transitionDelta",0),Ft(this,"gl"),Ft(this,"cubemap"),Ft(this,"texture"),Ft(this,"currentFacesDefinitionKey",""),Ft(this,"options"),Ft(this,"imageIsAnimating",!1),Ft(this,"imageFadeInDelta",0);let u=nM(m,iM);this.options=u,this.currentFacesDefinitionKey=JSON.stringify(u.faces??u.preset??u.path),this.bgColor=[0,0,0,0],this.targetBgColor=P_(u.color),this.faces=Yw(u),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:m}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;let u=eM.filter(x=>x==="cubeSampler"||x==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=W2({gl:this.gl,vertexShaderSource:XC,fragmentShaderSource:this.useCubemapTexture?Ww.replace(Kw,tM):Ww.replace(Kw,""),attributesKeys:QC,uniformsKeys:u,vertices:WC,indices:HC}),this.cubeMapNeedsUpdate=m,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(m,u){this.map=m,this.gl=u,this.updateCubemap()}onRemove(m,u){this.cubemap&&(u.deleteProgram(this.cubemap.shaderProgram),u.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(m,u){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;KC({gl:m,faces:u,onReady:x=>{this.texture=x,this.animateIn()}})}}prerender(m,u){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){let m=()=>{this.transitionDelta<1&&(requestAnimationFrame(m),this.bgColor=JC(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(m)}animateIn(){if(this.imageIsAnimating)return;this.imageIsAnimating=!0;let m=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=tp(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(m);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0};requestAnimationFrame(m)}animateOut(){return this.imageIsAnimating?Promise.resolve():new Promise(m=>{let u=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=tp(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,m();return}requestAnimationFrame(u)};requestAnimationFrame(u)})}render(m,u){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,m.disable(m.DEPTH_TEST),m.enable(m.BLEND),m.blendFunc(m.SRC_ALPHA,m.DST_ALPHA),m.useProgram(this.cubemap.shaderProgram),m.bindBuffer(m.ARRAY_BUFFER,this.cubemap.positionBuffer),m.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,m.FLOAT,!1,0,0),m.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);let x=.1,_=1e4,o=m.canvas,C=o.clientWidth/o.clientHeight,B=this.map.transform,$=B.fov*(Math.PI/180),Y=xg();AC(Y,$,C,x,_),jw(Y,Y,B.rollInRadians),Ow(Y,Y,-B.pitchInRadians),jw(Y,Y,B.bearingInRadians);let ne=B.center.lat*Math.PI/180,q=B.center.lng*Math.PI/180;Ow(Y,Y,ne),MC(Y,Y,-q),m.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,Y);let Ce=xg();if(m.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,Ce),m.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),m.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_CUBE_MAP,this.texture),m.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),m.drawElements(m.TRIANGLES,this.cubemap.indexBufferLength,m.UNSIGNED_SHORT,0)}setBgColor(m){this.targetBgColor=m,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}setCubemapFaces(m){return st(this,null,function*(){if(yield this.animateOut(),!m.faces&&!m.preset&&!m.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",this.animateIn();return}this.faces=Yw(m),this.currentFacesDefinitionKey=JSON.stringify(m.faces??m.preset??m.path)})}setCubemap(m){return st(this,null,function*(){this.options=m;let u=JSON.stringify(m.faces??m.preset??m.path),x=this.currentFacesDefinitionKey!==u;x&&(yield this.setCubemapFaces(m),this.cubeMapNeedsUpdate=!0);let _=P_(m.color);if(m.color&&this.targetBgColor.toString()!==_.toString())this.setBgColor(_);else if(!m.color&&m.preset&&m.preset in ip){let o=ip[m.preset];this.setBgColor(P_(o.color))}this.updateCubemap({facesNeedUpdate:x})})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function X2(g){return typeof g=="boolean"?!0:!(!g.path&&!g.preset&&!g.faces&&!g.color||g.preset&&!(g.preset in ip)||g.faces&&(!g.faces.pX||!g.faces.nX||!g.faces.pY||!g.faces.nY||!g.faces.pZ||!g.faces.nZ))}function Yw(g){if(g.faces)return g.faces;if(g.preset)return{pX:`${cm}/${g.preset}/px.webp`,nX:`${cm}/${g.preset}/nx.webp`,pY:`${cm}/${g.preset}/py.webp`,nY:`${cm}/${g.preset}/ny.webp`,pZ:`${cm}/${g.preset}/pz.webp`,nZ:`${cm}/${g.preset}/nz.webp`};if(g.path){let m=g.path.baseUrl,u=g.path.format??"png";return{pX:`${m}/px.${u}`,nX:`${m}/nx.${u}`,pY:`${m}/py.${u}`,nY:`${m}/ny.${u}`,pZ:`${m}/pz.${u}`,nZ:`${m}/nz.${u}`}}return null}var rM=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,oM=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

vec2 center = vec2(0.0, 0.0);
// TODO: We could look at implementing a color ramp instead.
// Render the color ramp to a canvas and then to a texture
// then select the color based on the distance from the center.
void main() {

  // QUASI SUCCESS
  // float distanceFromGlobeEdge = (distance(center, v_pos) - 2.0) / (sqrt(v_scale) * 1.05) + 1.0;
  // ORIGINAL
  // float distanceFromGlobeEdge = distance(center, v_pos) - 1.0; 
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastScaledStopPosition = u_stops[i - 1] * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,gg=2,aM=["position"],sM=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],lM=[-2,-2,0,gg,-2,0,-2,gg,0,gg,gg,0],fg={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},Jw=.06,fm=class{constructor(m){if(Ft(this,"id","Halo Layer"),Ft(this,"type","custom"),Ft(this,"renderingMode","3d"),Ft(this,"gradient"),Ft(this,"scale",0),Ft(this,"animationDelta",0),Ft(this,"map"),Ft(this,"plane"),typeof m=="boolean"){this.gradient=fg;return}this.gradient=Vi(Vi({},fg),m)}onAdd(m,u){this.map=m,this.plane=W2({gl:u,vertexShaderSource:rM,fragmentShaderSource:oM,attributesKeys:aM,uniformsKeys:sM,vertices:lM}),this.animateIn()}getConfig(){return this.gradient}animateIn(){return st(this,null,function*(){return new Promise(m=>{this.animationDelta=0;let u=()=>{if(this.animationDelta<1){this.scale=tp(0,this.gradient.scale,this.animationDelta),this.animationDelta+=Jw,this.map.triggerRepaint(),requestAnimationFrame(u);return}m()};u()})})}animateOut(){return st(this,null,function*(){return this.animationDelta=0,new Promise(m=>{let u=()=>{if(this.animationDelta<1){this.scale=tp(this.gradient.scale,0,this.animationDelta),this.animationDelta+=Jw,this.map.triggerRepaint(),requestAnimationFrame(u);return}m()};u()})})}onRemove(m,u){this.plane!==void 0&&(u.deleteProgram(this.plane.shaderProgram),u.deleteBuffer(this.plane.positionBuffer))}prerender(m,u){}render(m,u){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");m.disable(m.DEPTH_TEST),m.enable(m.BLEND),m.useProgram(this.plane.shaderProgram),m.bindBuffer(m.ARRAY_BUFFER,this.plane.positionBuffer);let x=this.plane.programInfo.attributesLocations.position;m.enableVertexAttribArray(x),m.vertexAttribPointer(x,3,m.FLOAT,!1,0,0);let _=xg(),o=this.scale;CC(_,_,[o,o,o]);let C=xg();PC(C,u.defaultProjectionData.mainMatrix,_);let B=this.plane.programInfo.uniformsLocations.matrix;m.uniformMatrix4fv(B,!1,C);let $=xg(),Y=this.map.transform.cameraPosition,ne=rx(I_(),Y),q=kC(0,1,0),Ce=I_();Uw(Ce,q,ne),rx(Ce,Ce);let Ie=I_();Uw(Ie,ne,Ce),rx(Ie,Ie),IC($,Ce[0],Ce[1],Ce[2],0,Ie[0],Ie[1],Ie[2],0,ne[0],ne[1],ne[2],0,0,0,0,1);let Ae=this.plane.programInfo.uniformsLocations.rotationMatrix;m.uniformMatrix4fv(Ae,!1,$);let De=this.gradient.stops.length,qe=[],Qe=[];for(let nt=0;nt<=De;nt++)if(nt<De){qe[nt]=this.gradient.stops[nt][0];let vt=P_(this.gradient.stops[nt][1]);Qe.push(...vt)}m.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,De),m.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(qe)),m.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(Qe)),m.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,gg),m.uniform1f(this.plane.programInfo.uniformsLocations.scale,o),m.drawArrays(m.TRIANGLE_STRIP,0,4)}setGradient(m){return st(this,null,function*(){if(yield this.animateOut(),!cM(m)){this.gradient.scale=fg.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}this.gradient.scale=m.scale??fg.scale,this.gradient.stops=m.stops??fg.stops,yield this.animateIn()})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function cM(g){return typeof g=="boolean"?!0:!(typeof g.scale!="number"||!g.stops||g.stops.length===0||g.stops.some(m=>typeof m[0]!="number"||typeof m[1]!="string"))}var K2={POINT:"POINT",COUNTRY:"COUNTRY"},my=class Y2 extends Gt.default.Map{constructor(m){BS(m.container),m.apiKey&&(xr.apiKey=m.apiKey);let{style:u,requiresUrlMonitoring:x,isFallback:_}=Rw(m.style);_&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),xr.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");let o=location.hash,C={compact:!1};m.customAttribution?C.customAttribution=m.customAttribution:m.attributionControl&&typeof m.attributionControl=="object"&&(C=Vi(Vi({},C),m.attributionControl));let B=Rl(Vi({},m),{style:u,maplibreLogo:!1,transformRequest:fw(m.transformRequest),attributionControl:m.forceNoAttributionControl===!0?!1:C});delete B.style,super(B),Ft(this,"telemetry"),Ft(this,"space"),Ft(this,"halo"),Ft(this,"options"),Ft(this,"isTerrainEnabled",!1),Ft(this,"terrainExaggeration",1),Ft(this,"primaryLanguage"),Ft(this,"terrainGrowing",!1),Ft(this,"terrainFlattening",!1),Ft(this,"minimap"),Ft(this,"forceLanguageUpdate"),Ft(this,"languageAlwaysBeenStyle"),Ft(this,"isReady",!1),Ft(this,"terrainAnimationDuration",1e3),Ft(this,"monitoredStyleUrls"),Ft(this,"styleInProcess",!1),Ft(this,"curentProjection"),Ft(this,"originalLabelStyle",new window.Map),Ft(this,"isStyleLocalized",!1),Ft(this,"languageIsUpdated",!1),Ft(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=m,this.setStyle(u),x&&this.monitorStyleUrl(u);let $=()=>{let Ie="The distant style could not be loaded.";this.getStyle()?Ie+="Leaving the style as is.":(this.setStyle($l.STREETS),Ie+=`Loading default MapTiler Cloud style "${$l.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(Ie)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",Ie=>{if(Ie.error instanceof Gt.default.AJAXError){let Ae=Ie.error.url,De=new URL(Ae);De.search="";let qe=De.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(qe)&&(this.monitoredStyleUrls.delete(qe),$());return}if(this.styleInProcess){$();return}}),xr.caching&&!hx&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),xr.caching&&hx&&DS(),typeof m.language>"u")this.primaryLanguage=xr.primaryLanguage;else{let Ie=Ed(m.language,un);this.primaryLanguage=Ie??xr.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===un.STYLE||this.primaryLanguage===un.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===un.STYLE,this.terrainExaggeration=m.terrainExaggeration??this.terrainExaggeration,this.curentProjection=m.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",()=>st(this,null,function*(){if(!m.geolocate||m.center||m.hash&&o)return;try{if(m.geolocate===K2.COUNTRY){yield this.fitToIpBounds();return}}catch(Ae){console.warn(Ae.message)}let Ie;try{yield this.centerOnIpPoint(m.zoom),Ie=this.getCameraHash()}catch(Ae){console.warn(Ae.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(Ae=>{Ie===this.getCameraHash()&&(this.terrain?this.easeTo({center:[Ae.coords.longitude,Ae.coords.latitude],zoom:m.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[Ae.coords.longitude,Ae.coords.latitude],zoom:m.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>st(this,null,function*(){let Ie={logo:null};try{let Ae=Object.keys(this.style.sourceCaches).map(qe=>this.getSource(qe)).filter(qe=>qe&&"url"in qe&&typeof qe.url=="string"&&qe.url.includes("tiles.json")),De=new URL(Ae[0].url);De.searchParams.has("key")||De.searchParams.append("key",xr.apiKey),Ie=yield(yield fetch(De.href)).json()}catch{}if(m.forceNoAttributionControl!==!0)if("logo"in Ie&&Ie.logo){let Ae=Ie.logo;this.addControl(new wg({logoURL:Ae}),m.logoPosition)}else m.maptilerLogo&&this.addControl(new wg,m.logoPosition);if(m.scaleControl){let Ae=m.scaleControl===!0||m.scaleControl===void 0?"bottom-right":m.scaleControl,De=new k_({unit:xr.unit});this.addControl(De,Ae),xr.on("unit",qe=>{De.setUnit(qe)})}if(m.navigationControl!==!1){let Ae=m.navigationControl===!0||m.navigationControl===void 0?"top-right":m.navigationControl;this.addControl(new Y_,Ae)}if(m.geolocateControl!==!1){let Ae=m.geolocateControl===!0||m.geolocateControl===void 0?"top-right":m.geolocateControl;this.addControl(new J_({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),Ae)}if(m.terrainControl){let Ae=m.terrainControl===!0||m.terrainControl===void 0?"top-right":m.terrainControl;this.addControl(new K_,Ae)}if(m.projectionControl){let Ae=m.projectionControl===!0||m.projectionControl===void 0?"top-right":m.projectionControl;this.addControl(new Q_,Ae)}if(m.fullscreenControl){let Ae=m.fullscreenControl===!0||m.fullscreenControl===void 0?"top-right":m.fullscreenControl;this.addControl(new L_({}),Ae)}this.isReady=!0,this.fire("ready",{target:this})}));let Y=!1,ne=!1,q;this.once("ready",()=>{Y=!0,ne&&this.fire("loadWithTerrain",q)}),this.once("style.load",()=>{let{minimap:Ie}=m;if(typeof Ie=="object"){let{zoom:Ae,center:De,style:qe,language:Qe,apiKey:nt,maptilerLogo:vt,canvasContextAttributes:tt,refreshExpiredTiles:At,maxBounds:Yt,scrollZoom:pn,minZoom:Ii,maxZoom:On,boxZoom:wn,locale:Vn,fadeDuration:mo,crossSourceCollisions:Ir,clickTolerance:Pr,bounds:Cr,fitBoundsOptions:Oa,pixelRatio:Ot,validateStyle:Nr}=m;this.minimap=new vg(Ie,{zoom:Ae,center:De,style:qe,language:Qe,apiKey:nt,container:"null",maptilerLogo:vt,canvasContextAttributes:tt,refreshExpiredTiles:At,maxBounds:Yt,scrollZoom:pn,minZoom:Ii,maxZoom:On,boxZoom:wn,locale:Vn,fadeDuration:mo,crossSourceCollisions:Ir,clickTolerance:Pr,bounds:Cr,fitBoundsOptions:Oa,pixelRatio:Ot,validateStyle:Nr}),this.addControl(this.minimap,Ie.position??"bottom-left")}else Ie===!0?(this.minimap=new vg({},m),this.addControl(this.minimap,"bottom-left")):Ie!==void 0&&Ie!==!1&&(this.minimap=new vg({},m),this.addControl(this.minimap,Ie))});let Ce=Ie=>{Ie.terrain&&(ne=!0,q={type:"loadWithTerrain",target:this,terrain:Ie.terrain},this.off("terrain",Ce),Y&&this.fire("loadWithTerrain",q))};this.on("terrain",Ce),m.terrain&&this.enableTerrain(m.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",Ae=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",Ae)});let Ie=this.getLayersOrder()[0];m.space&&this.initSpace({options:m,before:Ie}),m.halo&&this.initHalo({options:m,before:Ie})}),this.telemetry=new Xx(this)}getSpace(){return this.space}setSpace(m){if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(m);return}this.space=new mm(m),this.once("load",()=>{let u=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,u)})}}setSpaceFromStyle({style:m}){var u,x,_;let o=(x=(u=m.metadata)==null?void 0:u.maptiler)==null?void 0:x.space;if(!o){this.setSpace({color:"transparent"});return}if(!X2(o)){this.setSpace({color:"transparent"});return}if(JSON.stringify((_=this.space)==null?void 0:_.getConfig())===JSON.stringify(o)){if(this.space&&!this.getLayer(this.space.id)){let C=this.getLayersOrder()[0];this.addLayer(this.space,C)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){let C=this.getLayersOrder()[0];this.addLayer(this.space,C)}this.space.setCubemap(o)}})()}setHaloFromStyle({style:m}){var u,x,_;let o=(u=m.metadata)==null?void 0:u.maptiler;if(JSON.stringify((x=this.halo)==null?void 0:x.getConfig())===JSON.stringify(o?.halo)){if(this.halo&&!this.getLayer(this.halo.id)){let C=this.getLayersOrder().indexOf(((_=this.space)==null?void 0:_.id)??"")+1,B=this.getLayersOrder()[C];this.addLayer(this.halo,B)}return}if(!(o!=null&&o.halo)){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var C;if(this.halo){if(!this.getLayer(this.halo.id)){let B=this.getLayersOrder().indexOf(((C=this.space)==null?void 0:C.id)??"")+1,$=this.getLayersOrder()[B];this.addLayer(this.halo,$)}this.halo.setGradient(o.halo)}})()}initSpace({options:m=this.options,before:u,spec:x}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,u);return}if(m.space===!1)return;let _=x;if(m.space){this.space=new mm(m.space),this.addLayer(this.space,u);return}_&&(this.space=new mm(_),this.addLayer(this.space,u))}initHalo({options:m=this.options,before:u,spec:x}){if(this.halo&&this.getLayer(this.halo.id)||m.halo===!1)return;let _=x;if(m.halo){this.halo=new fm(m.halo),this.addLayer(this.halo,u);return}_&&(this.halo=new fm(_),this.addLayer(this.halo,u))}getHalo(){return this.halo}setHalo(m){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(m);return}this.halo=new fm(m),this.once("load",()=>{var u;let x=this.getLayersOrder(),_=x[0],o=x.indexOf(((u=this.space)==null?void 0:u.id)??"")+2,C=x[o];this.halo&&this.addLayer(this.halo,this.space?C:_)})}}recreate(){let m={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new Y2(Vi({},this.options))),this.once("load",()=>{this.jumpTo(m)})}setTerrainAnimationDuration(m){this.terrainAnimationDuration=Math.max(m,0)}onLoadAsync(){return st(this,null,function*(){return new Promise(m=>{if(this.loaded()){m(this);return}this.once("load",()=>{m(this)})})})}onReadyAsync(){return st(this,null,function*(){return new Promise(m=>{if(this.isReady){m(this);return}this.once("ready",()=>{m(this)})})})}onLoadWithTerrainAsync(){return st(this,null,function*(){return new Promise(m=>{if(this.isReady&&this.terrain){m(this);return}this.once("loadWithTerrain",()=>{m(this)})})})}monitorStyleUrl(m){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);let u=new URL(m);u.search="",this.monitoredStyleUrls.add(u.href)}setStyle(m,u){var x,_,o,C,B;this.originalLabelStyle.clear(),(x=this.minimap)==null||x.setStyle(m),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});let $=Rw(m);if($.requiresUrlMonitoring&&this.monitorStyleUrl($.style),$.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}let Y=this.getStyle(),ne=$.style;try{super.setStyle($.style,u),this.styleInProcess=!0}catch(Ie){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",Ie)}if(typeof $.style=="string"||$.requiresUrlMonitoring)return this;let q=()=>{let Ie=$.style;if(!Ie.projection||Ie.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:$.style}),this.setHaloFromStyle({style:$.style})},Ce=Ie=>{var Ae,De,qe,Qe;let nt=Ie?.target.getStyle()??$.style,vt=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:nt}):this.initSpace({before:vt,spec:(De=(Ae=nt.metadata)==null?void 0:Ae.maptiler)==null?void 0:De.space}),this.halo?this.setHaloFromStyle({style:nt}):this.initHalo({before:vt,spec:(Qe=(qe=nt.metadata)==null?void 0:qe.maptiler)==null?void 0:Qe.halo})};if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",Ce),this.once("styledata",Ce),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((_=Y?.terrain)==null?void 0:_.source)!==((o=ne?.terrain)==null?void 0:o.source)||((C=Y?.terrain)==null?void 0:C.exaggeration)!==((B=ne?.terrain)==null?void 0:B.exaggeration))return this.once("terrain",q),this;try{Ce()}catch{}return this}addLayer(m,u){var x;return(x=this.minimap)==null||x.addLayer(m,u),super.addLayer(m,u)}moveLayer(m,u){var x;return(x=this.minimap)==null||x.moveLayer(m,u),super.moveLayer(m,u)}removeLayer(m){var u;return(u=this.minimap)==null||u.removeLayer(m),super.removeLayer(m)}setLayerZoomRange(m,u,x){var _;return(_=this.minimap)==null||_.setLayerZoomRange(m,u,x),super.setLayerZoomRange(m,u,x)}setFilter(m,u,x){var _;return(_=this.minimap)==null||_.setFilter(m,u,x),super.setFilter(m,u,x)}setPaintProperty(m,u,x,_){var o;return(o=this.minimap)==null||o.setPaintProperty(m,u,x,_),super.setPaintProperty(m,u,x,_)}setLayoutProperty(m,u,x,_){var o;return(o=this.minimap)==null||o.setLayoutProperty(m,u,x,_),super.setLayoutProperty(m,u,x,_)}setGlyphs(m,u){var x;return(x=this.minimap)==null||x.setGlyphs(m,u),super.setGlyphs(m,u)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?Md(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(m){var u;(u=this.minimap)==null||u.map.setLanguage(m),this.onStyleReady(()=>{this.setPrimaryLanguage(m)})}setPrimaryLanguage(m){let u=this.getStyleLanguage(),x=Ed(m,un);if(!x){console.warn(`The language "${x}" is not supported.`);return}if(!(x.flag===un.STYLE.flag&&u&&(u.flag===un.AUTO.flag||u.flag===un.VISITOR.flag))&&(x.flag!==un.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===x&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===un.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=x;let _=x;if(x.flag===un.STYLE.flag){if(!u){console.warn("The style has no default languages or has an invalid one.");return}_=u}let o=un.LOCAL.flag,C=["get",o];_.flag===un.VISITOR.flag?(o=lx().flag,C=["case",["all",["has",o],["has",un.LOCAL.flag]],["case",["==",["get",o],["get",un.LOCAL.flag]],["get",un.LOCAL.flag],["format",["get",o],{"font-scale":.8},`
`,["get",un.LOCAL.flag],{"font-scale":1.1}]],["get",un.LOCAL.flag]]):_.flag===un.VISITOR_ENGLISH.flag?(o=un.ENGLISH.flag,C=["case",["all",["has",o],["has",un.LOCAL.flag]],["case",["==",["get",o],["get",un.LOCAL.flag]],["get",un.LOCAL.flag],["format",["get",o],{"font-scale":.8},`
`,["get",un.LOCAL.flag],{"font-scale":1.1}]],["get",un.LOCAL.flag]]):_.flag===un.AUTO.flag?(o=lx().flag,C=["coalesce",["get",o],["get",un.LOCAL.flag]]):_===un.LOCAL?(o=un.LOCAL.flag,C=["get",o]):(o=_.flag,C=["coalesce",["get",o],["get",un.LOCAL.flag]]);let{layers:B}=this.getStyle(),$=this.originalLabelStyle.size===0;if($){let Y=ZS(B,this);this.isStyleLocalized=Object.keys(Y.localized).length>0}for(let Y of B){if(Y.type!=="symbol")continue;let ne=Y,q=this.getSource(ne.source);if(!q||!("url"in q&&typeof q.url=="string")||new URL(q.url).host!==xs.maptilerApiHost)continue;let{id:Ce,layout:Ie}=ne;if(!Ie||!("text-field"in Ie))continue;let Ae;if($?(Ae=this.getLayoutProperty(Ce,"text-field"),this.originalLabelStyle.set(Ce,Ae)):Ae=this.originalLabelStyle.get(Ce),typeof Ae=="string"){let{contains:De,exactMatch:qe}=US(Ae,this.isStyleLocalized);if(!De)continue;if(qe)this.setLayoutProperty(Ce,"text-field",C);else{let Qe=NS(Ae,C,this.isStyleLocalized);this.setLayoutProperty(Ce,"text-field",Qe)}}else{let De=jS(Ae,C,this.isStyleLocalized);this.setLayoutProperty(Ce,"text-field",De)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(m){if(!this.terrain)return;let u=performance.now(),x=this.terrain.exaggeration,_=m-x,o=()=>{if(!this.terrain||this.terrainFlattening)return;let C=(performance.now()-u)/this.terrainAnimationDuration;if(C<.99){let B=1-(1-C)**4,$=x+B*_;this.terrain.exaggeration=$,requestAnimationFrame(o)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=m,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(o)}enableTerrain(m=this.terrainExaggeration){if(m<0){console.warn("Terrain exaggeration cannot be negative.");return}let u=_=>{!this.terrain||_.type!=="data"||_.dataType!=="source"||!("source"in _)||_.sourceId!=="maptiler-terrain"||_.source.type!=="raster-dem"||_.isSourceLoaded&&(this.off("data",u),this.growTerrain(m))},x=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=m,this.on("data",u),this.addSource(xs.terrainSourceId,{type:"raster-dem",url:xs.terrainSourceURL}),this.setTerrain({source:xs.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(m);return}if(this.loaded()||this.isTerrainEnabled)x();else{let _=()=>{this.getTerrain()&&this.getSource(xs.terrainSourceId)||x()};this.once("load",()=>{_()}),this.once("moveend",()=>{_()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;let m=performance.now(),u=this.terrain.exaggeration,x=()=>{if(!this.terrain||this.terrainGrowing)return;let _=(performance.now()-m)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,_<.99){let o=(1-_)**4,C=u*o;this.terrain.exaggeration=C,requestAnimationFrame(x)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(xs.terrainSourceId)&&this.removeSource(xs.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(x)}setTerrainExaggeration(m,u=!0){!u&&this.terrain?(this.terrainExaggeration=m,this.terrain.exaggeration=m,this.triggerRepaint()):this.enableTerrain(m)}onStyleReady(m){this.isStyleLoaded()?m():this.once("styledata",()=>{m()})}fitToIpBounds(){return st(this,null,function*(){let m=yield ug.info();this.fitBounds(m.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(m){return st(this,null,function*(){let u=yield ug.info();this.jumpTo({center:[u.longitude??0,u.latitude??0],zoom:m||11})})}getCameraHash(){let m=new Float32Array(5),u=this.getCenter();return m[0]=u.lng,m[1]=u.lat,m[2]=this.getZoom(),m[3]=this.getPitch(),m[4]=this.getBearing(),hw.fromUint8Array(new Uint8Array(m.buffer))}getSdkConfig(){return xr}getMaptilerSessionId(){return r1}setTransformRequest(m){return super.setTransformRequest(fw(m)),this}isGlobeProjection(){let m=this.getProjection();return m?m.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};function fy(g){if(typeof DOMParser<"u"){let m=new DOMParser().parseFromString(g,"application/xml");if(m.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return m}throw new Error("No XML parser found")}function g1(g,m){if(!g.hasChildNodes())return!1;for(let u of Array.from(g.childNodes)){let x=u.nodeName;if(typeof x=="string"&&x.trim().toLowerCase()===m.toLowerCase())return!0}return!1}function Kx(g){if(typeof XMLSerializer<"u")return new XMLSerializer().serializeToString(g);throw new Error("No XML serializer found")}function _1(g){let m=typeof g=="string"?fy(g):g;if(!g1(m,"gpx"))throw new Error("The XML document is not valid GPX");let u=Wo(m,"trk"),x=Wo(m,"rte"),_=Wo(m,"wpt"),o={type:"FeatureCollection",features:[]};for(let C of Array.from(u)){let B=dM(C);B&&o.features.push(B)}for(let C of Array.from(x)){let B=mM(C);B&&o.features.push(B)}for(let C of Array.from(_))o.features.push(fM(C));return o}function y1(g,m){let u=g;if(typeof u=="string"&&(u=fy(u)),!g1(u,"kml"))throw new Error("The XML document is not valid KML");let x={type:"FeatureCollection",features:[]},_={},o={},C={},B=Wo(u,"Placemark"),$=Wo(u,"Style"),Y=Wo(u,"StyleMap");for(let ne of Array.from($)){let q=e2(m!==void 0?m(ne):Kx(ne)).toString(16);_[`#${Od(ne,"id")}`]=q,o[q]=ne}for(let ne of Array.from(Y)){_[`#${Od(ne,"id")}`]=e2(m!==void 0?m(ne):Kx(ne)).toString(16);let q=Wo(ne,"Pair"),Ce={};for(let Ie of Array.from(q))Ce[Ln(yi(Ie,"key"))??""]=Ln(yi(Ie,"styleUrl"));C[`#${Od(ne,"id")}`]=Ce}for(let ne of Array.from(B))x.features=x.features.concat(pM(ne,_,o,C));return x}function Qw(g){if(g===null)return["#000000",1];let m="",u=1,x=g;return x.startsWith("#")&&(x=x.substring(1)),(x.length===6||x.length===3)&&(m=x),x.length===8&&(u=Number.parseInt(x.substring(0,2),16)/255,m=`#${x.substring(6,8)}${x.substring(4,6)}${x.substring(2,4)}`),[m??"#000000",u??1]}function uM(g){return eT(g.split(" "))}function hM(g){let m=Wo(g,"coord"),u=[],x=[];m.length===0&&(m=Wo(g,"gx:coord"));for(let o of Array.from(m))u.push(uM(Ln(o)??""));let _=Wo(g,"when");for(let o of Array.from(_))x.push(Ln(o));return{coords:u,times:x}}function C_(g){let m=["Polygon","LineString","Point","Track","gx:Track"],u,x,_,o,C,B=[],$=[];if(yi(g,"MultiGeometry")!==null)return C_(yi(g,"MultiGeometry"));if(yi(g,"MultiTrack")!==null)return C_(yi(g,"MultiTrack"));if(yi(g,"gx:MultiTrack")!==null)return C_(yi(g,"gx:MultiTrack"));for(_=0;_<m.length;_++)if(x=Wo(g,m[_]),x){for(o=0;o<x.length;o++)if(u=x[o],m[_]==="Point")B.push({type:"Point",coordinates:tT(Ln(yi(u,"coordinates"))??"")});else if(m[_]==="LineString")B.push({type:"LineString",coordinates:i2(Ln(yi(u,"coordinates"))??"")});else if(m[_]==="Polygon"){let Y=Wo(u,"LinearRing"),ne=[];for(C=0;C<Y.length;C++)ne.push(i2(Ln(yi(Y[C],"coordinates"))??""));B.push({type:"Polygon",coordinates:ne})}else if(m[_]==="Track"||m[_]==="gx:Track"){let Y=hM(u);B.push({type:"LineString",coordinates:Y.coords}),Y.times.length&&$.push(Y.times)}}return{geoms:B,coordTimes:$}}function pM(g,m,u,x){let _=C_(g),o={},C=Ln(yi(g,"name")),B=Ln(yi(g,"address")),$=Ln(yi(g,"description")),Y=yi(g,"TimeSpan"),ne=yi(g,"TimeStamp"),q=yi(g,"ExtendedData"),Ce=yi(g,"visibility"),Ie,Ae=Ln(yi(g,"styleUrl")),De=yi(g,"LineStyle"),qe=yi(g,"PolyStyle");if(!_.geoms.length)return[];if(C&&(o.name=C),B&&(o.address=B),Ae){Ae.startsWith("#")||(Ae=`#${Ae}`),o.styleUrl=Ae,m[Ae]&&(o.styleHash=m[Ae]),x[Ae]&&(o.styleMapHash=x[Ae],o.styleHash=m[x[Ae].normal??""]);let nt=u[o.styleHash??""];if(nt){De||(De=yi(nt,"LineStyle")),qe||(qe=yi(nt,"PolyStyle"));let vt=yi(nt,"IconStyle");if(vt){let tt=yi(vt,"Icon");if(tt){let At=Ln(yi(tt,"href"));At&&(o.icon=At)}}}}if($&&(o.description=$),Y){let nt=Ln(yi(Y,"begin")),vt=Ln(yi(Y,"end"));nt&&vt&&(o.timespan={begin:nt,end:vt})}if(ne!==null&&(o.timestamp=Ln(yi(ne,"when"))??new Date().toISOString()),De!==null){let nt=Qw(Ln(yi(De,"color"))),vt=nt[0],tt=nt[1],At=Number.parseFloat(Ln(yi(De,"width"))??"");vt&&(o.stroke=vt),Number.isNaN(tt)||(o["stroke-opacity"]=tt),Number.isNaN(At)||(o["stroke-width"]=At)}if(qe){let nt=Qw(Ln(yi(qe,"color"))),vt=nt[0],tt=nt[1],At=Ln(yi(qe,"fill")),Yt=Ln(yi(qe,"outline"));vt&&(o.fill=vt),Number.isNaN(tt)||(o["fill-opacity"]=tt),At&&(o["fill-opacity"]=At==="1"?o["fill-opacity"]||1:0),Yt&&(o["stroke-opacity"]=Yt==="1"?o["stroke-opacity"]||1:0)}if(q){let nt=Wo(q,"Data"),vt=Wo(q,"SimpleData");for(Ie=0;Ie<nt.length;Ie++)o[nt[Ie].getAttribute("name")??""]=Ln(yi(nt[Ie],"value"))??"";for(Ie=0;Ie<vt.length;Ie++)o[vt[Ie].getAttribute("name")??""]=Ln(vt[Ie])??""}Ce!==null&&(o.visibility=Ln(Ce)??""),_.coordTimes.length!==0&&(o.coordTimes=_.coordTimes.length===1?_.coordTimes[0]:_.coordTimes);let Qe={type:"Feature",geometry:_.geoms.length===1?_.geoms[0]:{type:"GeometryCollection",geometries:_.geoms},properties:o};return Od(g,"id")&&(Qe.id=Od(g,"id")??void 0),[Qe]}function J2(g,m){let u=Wo(g,m),x=[],_=[],o=[],C=u.length;if(!(C<2)){for(let B=0;B<C;B++){let $=iT(u[B]);x.push($.coordinates),$.time&&_.push($.time),($.heartRate||o.length)&&(o.length===0&&(o=new Array(B).fill(null)),o.push($.heartRate))}return{line:x,times:_,heartRates:o}}}function dM(g){let m=Wo(g,"trkseg"),u=[],x=[],_=[],o;for(let B=0;B<m.length;B++)if(o=J2(m[B],"trkpt"),o!==void 0&&(o.line&&u.push(o.line),o.times&&o.times.length&&x.push(o.times),_.length||o.heartRates&&o.heartRates.length)){if(!_.length)for(let $=0;$<B;$++)_.push(new Array(u[$].length).fill(null));o.heartRates&&o.heartRates.length?_.push(o.heartRates):_.push(new Array(o.line.length).fill(null))}if(u.length===0)return;let C=Vi(Vi({},v1(g)),Q2(yi(g,"extensions")));return x.length!==0&&(C.coordTimes=u.length===1?x[0]:x),_.length!==0&&(C.heartRates=u.length===1?_[0]:_),u.length===1?{type:"Feature",properties:C,geometry:{type:"LineString",coordinates:u[0]}}:{type:"Feature",properties:C,geometry:{type:"MultiLineString",coordinates:u}}}function mM(g){let m=J2(g,"rtept");return m===void 0?void 0:{type:"Feature",properties:Vi(Vi({},v1(g)),Q2(yi(g,"extensions"))),geometry:{type:"LineString",coordinates:m.line}}}function fM(g){return{type:"Feature",properties:Vi(Vi({},v1(g)),Yx(g,["sym"])),geometry:{type:"Point",coordinates:iT(g).coordinates}}}function Q2(g){let m={};if(g){let u=yi(g,"line");if(u){let x=Ln(yi(u,"color")),_=Number.parseFloat(Ln(yi(u,"opacity"))??"0"),o=Number.parseFloat(Ln(yi(u,"width"))??"0");x&&(m.stroke=x),Number.isNaN(_)||(m["stroke-opacity"]=_),Number.isNaN(o)||(m["stroke-width"]=o*96/25.4)}}return m}function v1(g){let m=Yx(g,["name","cmt","desc","type","time","keywords"]),u=Wo(g,"link");if(u.length!==0){m.links=[];for(let x of Array.from(u)){let _=Vi({href:Od(x,"href")},Yx(x,["text","type"]));m.links.push(_)}}return m}function e2(g){let m=0;if(!g||!g.length)return m;for(let u=0;u<g.length;u++)m=(m<<5)-m+g.charCodeAt(u)|0;return m}function Wo(g,m){return g.getElementsByTagName(m)}function Od(g,m){return g.getAttribute(m)}function t2(g,m){return Number.parseFloat(Od(g,m)??"0")}function yi(g,m){let u=Wo(g,m);return u.length?u[0]:null}function gM(g){return g.normalize&&g.normalize(),g}function eT(g){return g.map(Number.parseFloat).map(m=>Number.isNaN(m)?null:m)}function Ln(g){return g&&gM(g),g&&g.textContent}function Yx(g,m){let u={},x,_;for(_=0;_<m.length;_++)x=yi(g,m[_]),x&&(u[m[_]]=Ln(x)??"");return u}function tT(g){return eT(g.replace(/\s*/g,"").split(","))}function i2(g){let m=g.replace(/^\s*|\s*$/g,"").split(/\s+/),u=[];for(let x of m)u.push(tT(x));return u}function iT(g){let m=[t2(g,"lon"),t2(g,"lat")],u=yi(g,"ele"),x=yi(g,"gpxtpx:hr")||yi(g,"hr"),_=yi(g,"time"),o;return u&&(o=Number.parseFloat(Ln(u)??"0"),Number.isNaN(o)||m.push(o)),{coordinates:m,time:_?Ln(_):null,heartRate:x!==null?Number.parseFloat(Ln(x)??"0"):null}}function nT(g){let m=g;try{typeof m=="string"&&(m=fy(m))}catch{return null}try{return _1(m)}catch{}try{return y1(m)}catch{}return null}function _M(u){return st(this,arguments,function*(g,m={}){let x=m.download??!1,_=yield yM(g);if(x){let o=m.filename??"maptiler_screenshot.png",C=document.createElement("a");C.style.display="none",document.body.appendChild(C),C.href=URL.createObjectURL(_),C.download=o,C.click(),setTimeout(()=>{document.body.removeChild(C),URL.revokeObjectURL(C.href)},0)}return _})}function yM(g){return new Promise((m,u)=>{g.redraw(),g.once("idle",()=>{g.getCanvas().toBlob(x=>{if(!x){u(Error("Screenshot could not be created."));return}m(x)},"image/png")})})}var Jx=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function gy(){return Jx[~~(Math.random()*Jx.length)][~~(Math.random()*4)]}function jg(){return`maptiler_source_${a2()}`}function Ug(){return`maptiler_layer_${a2()}`}function Qx(g,m){if(m<=g[0].zoom)return g[0].value;if(m>=g[g.length-1].zoom)return g[g.length-1].value;for(let u=0;u<g.length-1;u+=1)if(m>=g[u].zoom&&m<g[u+1].zoom){let x=g[u+1].zoom-g[u].zoom,_=(m-g[u].zoom)/x;return _*g[u+1].value+(1-_)*g[u].value}return 0}function np(g){return["interpolate",["linear"],["zoom"],...g.flatMap(m=>[m.zoom,m.value])]}function kn(g){return["interpolate",["linear"],["zoom"],...g.flatMap(m=>[m.zoom,m.value])]}function rT(g,m){if(typeof m=="number"&&typeof g=="number")return 2*m+g;if(typeof m=="number"&&Array.isArray(g))return["interpolate",["linear"],["zoom"],...g.flatMap(u=>[u.zoom,2*m+u.value])];if(typeof g=="number"&&Array.isArray(m))return["interpolate",["linear"],["zoom"],...m.flatMap(u=>[u.zoom,2*u.value+g])];if(Array.isArray(g)&&Array.isArray(m)){let u=Array.from(new Set([...g.map(x=>x.zoom),...m.map(x=>x.zoom)])).sort((x,_)=>x<_?-1:1);return["interpolate",["linear"],["zoom"],...u.flatMap(x=>[x,2*Qx(m,x)+Qx(g,x)])]}return 0}function oT(g,m){return["interpolate",["linear"],["get",m],...g.flatMap(u=>[u.propertyValue,u.value])]}function x1(g){let m=g.trimStart(),u=`${m}${" ".repeat(g.length-m.length)}`,x=Array.from(u);if(!x.every(o=>o===" "||o==="_"))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!(x.some(o=>o==="_")&&x.some(o=>o===" ")))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");let _=[1];for(let o=1;o<x.length;o+=1){let C=x[o-1],B=x[o];C===B?_[_.length-1]+=1:_.push(1)}return _}function e1(g,m){return["interpolate",["linear"],["get",m],...g.flatMap(u=>[u.value,u.color])]}function t1(g,m,u=!0){return u?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.value,x.pointRadius*.025])],2,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.value,x.pointRadius*.05])],4,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.value,x.pointRadius*.1])],8,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.value,x.pointRadius*.25])],16,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.value,x.pointRadius])]]:["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.value,x.pointRadius])]}function aT(g,m,u=!0){return u?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.propertyValue,x.value*.025])],2,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.propertyValue,x.value*.05])],4,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.propertyValue,x.value*.1])],8,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.propertyValue,x.value*.25])],16,["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.propertyValue,x.value])]]:["interpolate",["linear"],["get",m],...g.flatMap(x=>[x.propertyValue,x.value])]}function i1(g,m){return g.every(u=>u.color[3]===g[0].color[3])?g[0].color[3]?g[0].color[3]/255:1:["interpolate",["linear"],["get",m],...g.getRawColorStops().flatMap(u=>{let x=u.value,_=u.color;return[x,_.length===4?_[3]/255:1]})]}function sT(g,m=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:m+1},(u,x)=>{let _=x/m;return[_,g.getColorHex(_)]}).flat()]}function w_(g){let m=g.toString(16);return m.length===1?`0${m}`:m}function vM(g){return`#${w_(g[0])}${w_(g[1])}${w_(g[2])}${g.length===4?w_(g[3]):""}`}var ai=class g extends Array{constructor(m={}){super(),Ft(this,"min",0),Ft(this,"max",1),"min"in m&&(this.min=m.min),"max"in m&&(this.max=m.max),"stops"in m&&this.setStops(m.stops,{clone:!1})}static fromArrayDefinition(m){return new g({stops:m.map(u=>({value:u[0],color:u[1]}))})}setStops(m,u={clone:!0}){let x=u.clone?this.clone():this;x.length=0;let _=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let C=0;C<m.length;C+=1)_=Math.min(_,m[C].value),o=Math.max(o,m[C].value),x.push({value:m[C].value,color:m[C].color.slice()});return x.sort((C,B)=>C.value<B.value?-1:1),this.min=_,this.max=o,x}scale(m,u,x={clone:!0}){let _=x.clone,o=this[0].value,C=this.at(-1).value-o,B=u-m,$=[];for(let Y=0;Y<this.length;Y+=1){let ne=(this[Y].value-o)/C*B+m;_?$.push({value:ne,color:this[Y].color.slice()}):this[Y].value=ne}return _?new g({stops:$}):this}at(m){return m<0?this[this.length+m]:this[m]}clone(){return new g({stops:this.getRawColorStops()})}getRawColorStops(){let m=[];for(let u=0;u<this.length;u+=1)m.push({value:this[u].value,color:this[u].color});return m}reverse(m={clone:!0}){let u=m.clone?this.clone():this;for(let x=0;x<~~(u.length/2);x+=1){let _=u[x].color;u[x].color=u.at(-(x+1)).color,u.at(-(x+1)).color=_}return u}getBounds(){return{min:this.min,max:this.max}}getColor(m,u={smooth:!0}){if(m<=this[0].value)return this[0].color;if(m>=this.at(-1).value)return this.at(-1).color;for(let x=0;x<this.length-1;x+=1){if(m>this[x+1].value)continue;let _=this[x].color;if(!u.smooth)return _.slice();let o=this[x].value,C=this[x+1].value,B=this[x+1].color,$=(C-m)/(C-o);return _.map((Y,ne)=>Math.round(Y*$+B[ne]*(1-$)))}return[0,0,0]}getColorHex(m,u={smooth:!0,withAlpha:!1}){return vM(this.getColor(m,u))}getColorRelative(m,u={smooth:!0}){let x=this.getBounds();return this.getColor(x.min+m*(x.max-x.min),u)}getCanvasStrip(m={horizontal:!0,size:512,smooth:!0}){let u=document.createElement("canvas");u.width=m.horizontal?m.size:1,u.height=m.horizontal?1:m.size;let x=u.getContext("2d");if(!x)throw new Error("Canvs context is missing");let _=x.getImageData(0,0,u.width,u.height),o=_.data,C=m.size,B=this[0].value,$=(this.at(-1).value-B)/C;for(let Y=0;Y<C;Y+=1){let ne=this.getColor(B+Y*$,{smooth:m.smooth});o[Y*4]=ne[0],o[Y*4+1]=ne[1],o[Y*4+2]=ne[2],o[Y*4+3]=ne.length>3?ne[3]:255}return x.putImageData(_,0,0),u}resample(m,u=15){let x=this.getBounds(),_=this.scale(0,1),o=1/(u-1),C;if(m==="ease-in-square")C=Array.from({length:u},(B,$)=>{let Y=$*o,ne=Y**2,q=_.getColor(ne);return{value:Y,color:q}});else if(m==="ease-out-square")C=Array.from({length:u},(B,$)=>{let Y=$*o,ne=1-(1-Y)**2,q=_.getColor(ne);return{value:Y,color:q}});else if(m==="ease-out-sqrt")C=Array.from({length:u},(B,$)=>{let Y=$*o,ne=Y**.5,q=_.getColor(ne);return{value:Y,color:q}});else if(m==="ease-in-sqrt")C=Array.from({length:u},(B,$)=>{let Y=$*o,ne=1-(1-Y)**.5,q=_.getColor(ne);return{value:Y,color:q}});else if(m==="ease-out-exp")C=Array.from({length:u},(B,$)=>{let Y=$*o,ne=1-2**(-10*Y),q=_.getColor(ne);return{value:Y,color:q}});else if(m==="ease-in-exp")C=Array.from({length:u},(B,$)=>{let Y=$*o,ne=2**(10*Y-10),q=_.getColor(ne);return{value:Y,color:q}});else throw new Error("Invalid ressampling method.");return new g({stops:C}).scale(x.min,x.max)}transparentStart(){let m=this.getRawColorStops();m.unshift({value:m[0].value,color:m[0].color.slice()}),m[1].value+=.001;for(let u of m)u.color.length===3&&u.color.push(255);return m[0].color[3]=0,new g({stops:m})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}},b1={NULL:new ai({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new ai({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new ai({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new ai({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new ai({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new ai({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new ai({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new ai({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new ai({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new ai({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new ai({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new ai({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new ai({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new ai({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new ai({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new ai({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new ai({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new ai({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new ai({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new ai({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new ai({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new ai({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new ai({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new ai({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new ai({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new ai({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new ai({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new ai({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new ai({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new ai({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new ai({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new ai({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new ai({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new ai({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new ai({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new ai({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new ai({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new ai({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new ai({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new ai({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new ai({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new ai({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new ai({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new ai({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new ai({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new ai({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new ai({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new ai({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new ai({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})};function xM(x,_){return st(this,arguments,function*(g,m,u={}){var o,C;if(!m.sourceId&&!m.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let B=m.data;if(typeof B=="string"){if(ey(B))B=`https://api.maptiler.com/data/${m.data}/features.json?key=${xr.apiKey}`;else if(((o=B.split(".").pop())==null?void 0:o.toLowerCase().trim())==="gpx"){let $=yield(yield fetch(B,u)).text();B=_1($)}else if(((C=B.split(".").pop())==null?void 0:C.toLowerCase().trim())==="kml"){let $=yield(yield fetch(B,u)).text();B=y1($)}else{let $=FS(B)??nT(B);$&&(B=$)}if(!B)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return bM(g,Rl(Vi({},m),{data:B}))})}function bM(g,m){if(m.layerId&&g.getLayer(m.layerId))throw new Error(`A layer already exists with the layer id: ${m.layerId}`);let u=m.sourceId??jg(),x=m.layerId??Ug(),_={polylineLayerId:x,polylineOutlineLayerId:"",polylineSourceId:u};m.data&&!g.getSource(u)&&g.addSource(u,{type:"geojson",data:m.data});let o=m.lineWidth??3,C=m.lineColor??gy(),B=m.lineOpacity??1,$=m.lineBlur??0,Y=m.lineGapWidth??0,ne=m.lineDashArray??null,q=m.outlineWidth??1,Ce=m.outlineColor??"#FFFFFF",Ie=m.outlineOpacity??1,Ae=m.outlineBlur??0;if(typeof ne=="string"&&(ne=x1(ne)),m.outline===!0){let De=`${x}_outline`;_.polylineOutlineLayerId=De,g.addLayer({id:De,type:"line",source:u,layout:{"line-join":m.lineJoin??"round","line-cap":m.lineCap??"round"},minzoom:m.minzoom??0,maxzoom:m.maxzoom??23,paint:{"line-opacity":typeof Ie=="number"?Ie:kn(Ie),"line-color":typeof Ce=="string"?Ce:np(Ce),"line-width":rT(o,q),"line-blur":typeof Ae=="number"?Ae:kn(Ae)}},m.beforeId)}return g.addLayer({id:x,type:"line",source:u,layout:{"line-join":m.lineJoin??"round","line-cap":m.lineCap??"round"},minzoom:m.minzoom??0,maxzoom:m.maxzoom??23,paint:Vi({"line-opacity":typeof B=="number"?B:kn(B),"line-color":typeof C=="string"?C:np(C),"line-width":typeof o=="number"?o:kn(o),"line-blur":typeof $=="number"?$:kn($),"line-gap-width":typeof Y=="number"?Y:kn(Y)},ne&&{"line-dasharray":ne})},m.beforeId),_}function wM(g,m){if(m.layerId&&g.getLayer(m.layerId))throw new Error(`A layer already exists with the layer id: ${m.layerId}`);let u=m.sourceId??jg(),x=m.layerId??Ug(),_={polygonLayerId:x,polygonOutlineLayerId:m.outline?`${x}_outline`:"",polygonSourceId:u};if(m.data&&!g.getSource(u)){let De=m.data;typeof De=="string"&&ey(De)&&(De=`https://api.maptiler.com/data/${De}/features.json?key=${xr.apiKey}`),g.addSource(u,{type:"geojson",data:De})}let o=m.outlineDashArray??null,C=m.outlineWidth??1,B=m.outlineColor??"#FFFFFF",$=m.outlineOpacity??1,Y=m.outlineBlur??0,ne=m.fillColor??gy(),q=m.fillOpacity??1,Ce=m.outlinePosition??"center",Ie=m.pattern??null;typeof o=="string"&&(o=x1(o));let Ae=(De=null)=>{if(g.addLayer({id:x,type:"fill",source:u,minzoom:m.minzoom??0,maxzoom:m.maxzoom??23,paint:Vi({"fill-color":typeof ne=="string"?ne:np(ne),"fill-opacity":typeof q=="number"?q:kn(q)},De&&{"fill-pattern":De})},m.beforeId),m.outline===!0){let qe;Ce==="inside"?typeof C=="number"?qe=.5*C:qe=kn(C.map(({zoom:Qe,value:nt})=>({zoom:Qe,value:.5*nt}))):Ce==="outside"?typeof C=="number"?qe=-.5*C:qe=kn(C.map(Qe=>({zoom:Qe.zoom,value:-.5*Qe.value}))):qe=0,g.addLayer({id:_.polygonOutlineLayerId,type:"line",source:u,layout:{"line-join":m.outlineJoin??"round","line-cap":m.outlineCap??"butt"},minzoom:m.minzoom??0,maxzoom:m.maxzoom??23,paint:Vi({"line-opacity":typeof $=="number"?$:kn($),"line-color":typeof B=="string"?B:np(B),"line-width":typeof C=="number"?C:kn(C),"line-blur":typeof Y=="number"?Y:kn(Y),"line-offset":qe},o&&{"line-dasharray":o})},m.beforeId)}};return Ie?g.hasImage(Ie)?Ae(Ie):g.loadImage(Ie).then(De=>{g.addImage(Ie,De.data),Ae(Ie)}).catch(De=>{console.error("Could not load the pattern image.",De.message),Ae()}):Ae(),_}function TM(g,m){if(m.layerId&&g.getLayer(m.layerId))throw new Error(`A layer already exists with the layer id: ${m.layerId}`);let u=m.minPointRadius??10,x=m.maxPointRadius??50,_=m.cluster??!1,o=20,C=Array.isArray(m.pointColor)?m.pointColor:b1.TURBO.scale(10,m.cluster?1e4:1e3).resample("ease-out-square"),B=C.getBounds(),$=m.sourceId??jg(),Y=m.layerId??Ug(),ne=m.showLabel??_,q=m.alignOnViewport??!0,Ce=m.outline??!1,Ie=m.outlineOpacity??1,Ae=m.outlineWidth??1,De=m.outlineColor??"#FFFFFF",qe,Qe=m.zoomCompensation??!0,nt=m.minzoom??0,vt=m.maxzoom??23;typeof m.pointOpacity=="number"?qe=m.pointOpacity:Array.isArray(m.pointOpacity)?qe=kn(m.pointOpacity):m.cluster?qe=i1(C,"point_count"):m.property?qe=i1(C,m.property):qe=kn([{zoom:nt,value:0},{zoom:nt+.25,value:1},{zoom:vt-.25,value:1},{zoom:vt,value:0}]);let tt={pointLayerId:Y,clusterLayerId:"",labelLayerId:"",pointSourceId:$};if(m.data&&!g.getSource($)){let At=m.data;typeof At=="string"&&ey(At)&&(At=`https://api.maptiler.com/data/${At}/features.json?key=${xr.apiKey}`),g.addSource($,{type:"geojson",data:At,cluster:_})}if(_){tt.clusterLayerId=`${Y}_cluster`;let At=Array.from({length:o},(Yt,pn)=>{let Ii=B.min+pn*(B.max-B.min)/(o-1);return{value:Ii,pointRadius:u+(x-u)*(pn/(o-1))**.5,color:C.getColorHex(Ii)}});g.addLayer({id:tt.clusterLayerId,type:"circle",source:$,filter:["has","point_count"],paint:Vi({"circle-color":typeof m.pointColor=="string"?m.pointColor:e1(At,"point_count"),"circle-radius":typeof m.pointRadius=="number"?m.pointRadius:Array.isArray(m.pointRadius)?kn(m.pointRadius):t1(At,"point_count",!1),"circle-pitch-alignment":q?"viewport":"map","circle-pitch-scale":"map","circle-opacity":qe},Ce&&{"circle-stroke-opacity":typeof Ie=="number"?Ie:kn(Ie),"circle-stroke-width":typeof Ae=="number"?Ae:kn(Ae),"circle-stroke-color":typeof De=="string"?De:np(De)}),minzoom:nt,maxzoom:vt},m.beforeId),g.addLayer({id:tt.pointLayerId,type:"circle",source:$,filter:["!",["has","point_count"]],paint:Vi({"circle-pitch-alignment":q?"viewport":"map","circle-pitch-scale":"map","circle-color":typeof m.pointColor=="string"?m.pointColor:C.getColorHex(C.getBounds().min),"circle-radius":typeof m.pointRadius=="number"?m.pointRadius:Array.isArray(m.pointRadius)?kn(m.pointRadius):At[0].pointRadius*.75,"circle-opacity":qe},Ce&&{"circle-stroke-opacity":typeof Ie=="number"?Ie:kn(Ie),"circle-stroke-width":typeof Ae=="number"?Ae:kn(Ae),"circle-stroke-color":typeof De=="string"?De:np(De)}),minzoom:nt,maxzoom:vt},m.beforeId)}else{let At=typeof m.pointColor=="string"?m.pointColor:Array.isArray(m.pointColor)?m.pointColor.getColorHex(m.pointColor.getBounds().min):gy(),Yt=typeof m.pointRadius=="number"?Qe?kn([{zoom:0,value:m.pointRadius*.025},{zoom:2,value:m.pointRadius*.05},{zoom:4,value:m.pointRadius*.1},{zoom:8,value:m.pointRadius*.25},{zoom:16,value:m.pointRadius*1}]):m.pointRadius:Array.isArray(m.pointRadius)?kn(m.pointRadius):Qe?kn([{zoom:0,value:u*.05},{zoom:2,value:u*.1},{zoom:4,value:u*.2},{zoom:8,value:u*.5},{zoom:16,value:u*1}]):u;if(m.property&&Array.isArray(m.pointColor)){let pn=Array.from({length:o},(Ii,On)=>{let wn=B.min+On*(B.max-B.min)/(o-1);return{value:wn,pointRadius:typeof m.pointRadius=="number"?m.pointRadius:u+(x-u)*(On/(o-1))**.5,color:typeof m.pointColor=="string"?m.pointColor:C.getColorHex(wn)}});At=e1(pn,m.property),Yt=t1(pn,m.property,Qe)}g.addLayer({id:tt.pointLayerId,type:"circle",source:$,layout:{"circle-sort-key":m.property?["/",1,["get",m.property]]:0},paint:Vi({"circle-pitch-alignment":q?"viewport":"map","circle-pitch-scale":"map","circle-color":At,"circle-opacity":qe,"circle-radius":Yt},Ce&&{"circle-stroke-opacity":typeof Ie=="number"?Ie:kn(Ie),"circle-stroke-width":typeof Ae=="number"?Ae:kn(Ae),"circle-stroke-color":typeof De=="string"?De:np(De)}),minzoom:nt,maxzoom:vt},m.beforeId)}if(ne!==!1&&(m.cluster||m.property)){tt.labelLayerId=`${Y}_label`;let At=m.labelColor??"#fff",Yt=m.labelSize??12;g.addLayer({id:tt.labelLayerId,type:"symbol",source:$,filter:["has",m.cluster?"point_count":m.property],layout:{"text-field":m.cluster?"{point_count_abbreviated}":`{${m.property}}`,"text-font":["Noto Sans Regular"],"text-size":Yt,"text-pitch-alignment":q?"viewport":"map","symbol-sort-key":["/",1,["get",m.cluster?"point_count":m.property]]},paint:{"text-color":At,"text-opacity":qe},minzoom:nt,maxzoom:vt},m.beforeId)}return tt}function SM(g,m){if(m.layerId&&g.getLayer(m.layerId))throw new Error(`A layer already exists with the layer id: ${m.layerId}`);let u=m.sourceId??jg(),x=m.layerId??Ug(),_=m.minzoom??0,o=m.maxzoom??23,C=m.zoomCompensation??!0,B=m.opacity??[{zoom:_,value:0},{zoom:_+.25,value:1},{zoom:o-.25,value:1},{zoom:o,value:0}],$=Array.isArray(m.colorRamp)?m.colorRamp:b1.TURBO.transparentStart(),Y=$.getBounds();(Y.min!==0||Y.max!==1)&&($=$.scale(0,1)),$.hasTransparentStart()||($=$.transparentStart());let ne=m.intensity??[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],q=m.property??null,Ce=m.weight??1,Ie=1;q?typeof Ce=="number"?(Ie=Ce,typeof m.weight=="number"&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(Ce)?Ie=oT(Ce,q):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):typeof Ce=="number"?Ie=Ce:Array.isArray(Ce)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");let Ae=[{zoom:0,value:50*.025},{zoom:2,value:50*.05},{zoom:4,value:50*.1},{zoom:8,value:50*.25},{zoom:16,value:50}],De=m.radius??(C?Ae:10),qe=1;typeof De=="number"?qe=De:Array.isArray(De)&&"zoom"in De[0]?qe=kn(De):q&&Array.isArray(De)&&"propertyValue"in De[0]?qe=aT(De,q,C):!q&&Array.isArray(De)&&"propertyValue"in De[0]?(qe=kn(Ae),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):qe=kn(Ae);let Qe={heatmapLayerId:x,heatmapSourceId:u};if(m.data&&!g.getSource(u)){let nt=m.data;typeof nt=="string"&&ey(nt)&&(nt=`https://api.maptiler.com/data/${nt}/features.json?key=${xr.apiKey}`),g.addSource(u,{type:"geojson",data:nt})}return g.addLayer({id:x,type:"heatmap",source:u,minzoom:_,maxzoom:o,paint:{"heatmap-weight":Ie,"heatmap-intensity":typeof ne=="number"?ne:kn(ne),"heatmap-color":sT($),"heatmap-radius":qe,"heatmap-opacity":typeof B=="number"?B:kn(B)}},m.beforeId),Qe}var IM=Object.freeze(Object.defineProperty({__proto__:null,addHeatmap:SM,addPoint:TM,addPolygon:wM,addPolyline:xM,colorDrivenByProperty:e1,colorPalettes:Jx,computeRampedOutlineWidth:rT,dashArrayMaker:x1,generateRandomLayerName:Ug,generateRandomSourceName:jg,getRandomColor:gy,heatmapIntensityFromColorRamp:sT,lerpZoomNumberValues:Qx,opacityDrivenByProperty:i1,paintColorOptionsToPaintSpec:np,radiusDrivenByProperty:t1,radiusDrivenByPropertyHeatmap:aT,rampedOptionsToLayerPaintSpec:kn,rampedPropertyValueWeight:oT,takeScreenshot:_M},Symbol.toStringTag,{value:"Module"}));zS();function PM(){return"3.7.0"}var CM=Gt.default.Map,MM=Gt.default.Marker,EM=Gt.default.Popup,AM=Gt.default.Style,kM=Gt.default.CanvasSource,LM=Gt.default.GeoJSONSource,DM=Gt.default.ImageSource,zM=Gt.default.RasterTileSource,RM=Gt.default.RasterDEMTileSource,FM=Gt.default.VectorTileSource,BM=Gt.default.VideoSource,OM=Gt.default.NavigationControl,jM=Gt.default.GeolocateControl,UM=Gt.default.AttributionControl,NM=Gt.default.LogoControl,VM=Gt.default.ScaleControl,$M=Gt.default.FullscreenControl,GM=Gt.default.TerrainControl,ZM=Gt.default.BoxZoomHandler,qM=Gt.default.ScrollZoomHandler,WM=Gt.default.CooperativeGesturesHandler,HM=Gt.default.KeyboardHandler,XM=Gt.default.TwoFingersTouchPitchHandler,KM=Gt.default.MapWheelEvent,YM=Gt.default.MapTouchEvent,JM=Gt.default.MapMouseEvent,QM=Gt.default.config,eE=Gt.default.getVersion,{setRTLTextPlugin:tE,getRTLTextPluginStatus:iE,LngLat:$d,LngLatBounds:_y,MercatorCoordinate:nE,Evented:rE,AJAXError:oE,prewarm:aE,clearPrewarmedResources:sE,Hash:lE,Point:cE,EdgeInsets:uE,DragRotateHandler:hE,DragPanHandler:pE,TwoFingersTouchZoomRotateHandler:dE,DoubleClickZoomHandler:mE,TwoFingersTouchZoomHandler:fE,TwoFingersTouchRotateHandler:gE,getWorkerCount:_E,setWorkerCount:yE,getMaxParallelImageRequests:vE,setMaxParallelImageRequests:xE,getWorkerUrl:bE,setWorkerUrl:wE,addSourceType:TE,importScriptInWorkers:SE,addProtocol:IE,removeProtocol:PE}=Gt.default;var bm=(()=>{class g{events;logging;http;mapAPIType;mapReady;providerError;mapCanvasID;map;markerList;polylinePath;_isMapAnimating=!1;searchMarker;mapTileSet;constructor(u,x,_){this.events=u,this.logging=x,this.http=_,this.events=u,this.mapAPIType=Fl.MAPBOX,this.mapReady=!1,this.markerList=new Map}initAPI(){yy&&(xr.apiKey=Ea.mapTilerToken)}disposeMap(){this.map&&(this.logging.log("Disposing map",ar.INFO),this.map.remove())}getCurrentMapTileSet(u){return u=="SATELLITE"?$l.SATELLITE:$l.STREETS}flyAroundPoint(u){if(this._isMapAnimating){this.map.rotateTo(u/100%360,{duration:0});let x=this;requestAnimationFrame(function(_){x.flyAroundPoint(_)})}}initMap(u,x,_){this.mapCanvasID=u;let o=!0;if(typeof yy>"u"?o=!1:o=!0,o){if(this.map==null){let Y=function(q){return q*(2-q)},C=document.getElementById(u);this.initAPI(),this.map=new my({container:u,zoom:15,attributionControl:!1}),this.map.addControl(new bg({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new gm),this.mapReady=!0,this.map.getCanvas().focus();let B=100,$=25;this.map.getCanvas().addEventListener("keydown",q=>{q.preventDefault(),q.which===38?this.map.panBy([0,-B],{easing:Y}):q.which===40?this.map.panBy([0,B],{easing:Y}):q.which===37?this.map.easeTo({bearing:this.map.getBearing()-$,easing:Y}):q.which===39?this.map.easeTo({bearing:this.map.getBearing()+$,easing:Y}):q.which===32&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let ne=uo.debounce(()=>{this.getMapCenter().subscribe(q=>{this.searchMarker.setLngLat(new $d(q.coords.longitude,q.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&ne()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),x.onMapMoveCompleted&&x.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}else return this.logging.log("Call to initMap before API is ready:"+Fl[this.mapAPIType],ar.ERROR),this.mapReady=!1,!1}clearMarkers(){this.markerList!=null&&this.markerList.forEach((u,x)=>{u.remove()}),this.markerList=new Map}showPOIListOnMap(u,x,_=!0){let o=!1,C=this.map,B=new _y,$=0,Y=this;o&&this.clearMarkers();let ne=C.getZoom();if(u!=null){let Ce=u.length;for(let Ie=0;Ie<u.length;Ie++)if(u[Ie].AddressInfo!=null&&u[Ie].AddressInfo.Latitude!=null&&u[Ie].AddressInfo.Longitude!=null){let Ae=u[Ie],De=!0;if(!o&&this.markerList!=null&&this.markerList.has(Ae.ID)){De=!1;let qe=this.markerList.get(Ae.ID);qe&&qe.poi&&qe.poi.DateLastStatusUpdate!=Ae.DateLastStatusUpdate&&(qe.remove(),De=!0)}if(De){let qe=null,Qe=null;_?(qe=document.createElement("img"),qe.src=uo.getIconForPOI(Ae),qe.width=34,qe.height=50):(qe=null,Qe=uo.getColorForPOI(Ae));let nt={element:qe,color:Qe,anchor:"bottom"},vt=(_?"OCM-":"EXT-")+Ae.ID+": "+Ae.AddressInfo.Title+":";Ae.UsageType!=null&&(vt+=" "+Ae.UsageType.Title),Ae.StatusType!=null&&(vt+=" "+Ae.StatusType.Title);let tt=new ty(nt).setLngLat([Ae.AddressInfo.Longitude,Ae.AddressInfo.Latitude]).addTo(C);tt.poi=Ae;let At=tt.getElement();At.poi=Ae,At.addEventListener("click",Yt=>{let pn=Yt.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:pn.ID,poi:pn})}),B.extend(tt.getLngLat()),this.markerList.set(Ae.ID,tt),$++}}this.logging.log($+" new map markers added out of a total "+this.markerList.size)}let q=this;if(u!=null&&u.length>0)if(x!=null&&!x.appConfig.enableLiveMapQuerying){this.logging.log("Fitting to marker bounds:"+B),C.setCenter(B.getCenter()),this.logging.log("zoom before fit bounds:"+C.getZoom()),C.fitBounds(B);let Ce=C.getZoom();C.setZoom(Ce<6?6:Ce)}else C.getCenter()==null&&C.setCenter(B.getCenter())}refreshMapLayout(){this.map!=null&&setTimeout(()=>{this.logging.log("maptilersdk: refreshMapLayout",ar.VERBOSE),this.map.resize()},200)}setMapCenter(u){this.mapReady&&(this.map.setCenter(new $d(u.coords.longitude,u.coords.latitude)),this.searchMarker||(this.searchMarker=new ty({color:"#99ccff",anchor:"bottom"}).setLngLat(new $d(u.coords.longitude,u.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let x=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new Un(x.lat,x.lng))})))}getMapCenter(){return new Oh(x=>{if(this.map!=null){let _=this.map.getCenter();_!=null&&(x.next(new Nl(_.lat,_.lng)),x.complete())}})}setMapZoom(u){this.map.setZoom(u)}getMapZoom(){return new Oh(x=>{let _=this.map.getZoom();x.next(_),x.complete()})}setMapType(u){this.map.setStyle(this.getCurrentMapTileSet(u))}getMapBounds(){return new Oh(x=>{let _=new Array,o=this.map.getBounds();_.push(new Un(o.getSouthWest().lat,o.getSouthWest().lng)),_.push(new Un(o.getNorthEast().lat,o.getNorthEast().lng)),x.next(_),x.complete()})}moveToMapBounds(u){this.map.fitBounds(new _y(new $d(u.southWest.longitude,u.southWest.latitude),new $d(u.northEast.longitude,u.northEast.latitude)))}renderMap(u,x,_){return document.getElementById(this.mapCanvasID).style.height=x+"px",this.mapReady&&this.showPOIListOnMap(u,_),!0}renderPolyline(u){this.clearPolyline()}clearPolyline(){this.polylinePath!=null&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(u,x,_){return st(this,null,function*(){let o=`https://api.maptiler.com/geocoding/${u||_+","+x}.json?key=${Ea.mapTilerToken}`;return new Promise((C,B)=>st(this,null,function*(){this.http.get(o).toPromise().then($=>{let Y=[];Y=[],$.features&&$.features.map(ne=>{let q=new su;q.Title=ne.place_name,q.Address=ne.place_name,q.Type="place",q.Location=new Un(ne.center[1],ne.center[0]),q.Attribution=$.attribution,Y.push(q)}),C(Y)})}))})}addPOILayer(u){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(u,null,!1)}static \u0275fac=function(x){return new(x||g)(ii(Ba),ii(bn),ii($o))};static \u0275prov=An({token:g,factory:g.\u0275fac})}return g})();var bs=_v(cT());var uT=(()=>{class g{events;logging;http;mapAPIType;mapReady;providerError;mapCanvasID;map;markerList;polylinePath;_isMapAnimating=!1;searchMarker;mapTileSet;constructor(u,x,_){this.events=u,this.logging=x,this.http=_,this.events=u,this.mapAPIType=Fl.MAPLIBRE,this.mapReady=!1,this.markerList=new Map}initAPI(){}disposeMap(){this.map&&(this.logging.log("Disposing map",ar.INFO),this.map.remove())}getCurrentMapTileSet(u){return"https://raw.githubusercontent.com/go2garret/maps/main/src/assets/json/openStreetMap.json"}flyAroundPoint(u){if(this._isMapAnimating){this.map.rotateTo(u/100%360,{duration:0});let x=this;requestAnimationFrame(function(_){x.flyAroundPoint(_)})}}initMap(u,x,_){this.mapCanvasID=u;let o=!0;if(typeof bs.default>"u"?o=!1:o=!0,o){if(this.map==null){let Y=function(q){return q*(2-q)},C=document.getElementById(u);this.initAPI(),this.map=new bs.default.Map({container:u,style:"https://tiles.openfreemap.org/styles/liberty",zoom:15,attributionControl:!1}),this.map.addControl(new bs.default.AttributionControl({compact:!0,customAttribution:["Open Charge Map Contributors"]})),this.map.addControl(new bs.default.NavigationControl),this.mapReady=!0,this.map.getCanvas().focus();let B=100,$=25;this.map.getCanvas().addEventListener("keydown",q=>{q.preventDefault(),q.which===38?this.map.panBy([0,-B],{easing:Y}):q.which===40?this.map.panBy([0,B],{easing:Y}):q.which===37?this.map.easeTo({bearing:this.map.getBearing()-$,easing:Y}):q.which===39?this.map.easeTo({bearing:this.map.getBearing()+$,easing:Y}):q.which===32&&(this._isMapAnimating?this._isMapAnimating=!1:(this._isMapAnimating=!0,this.flyAroundPoint(0)))},!0),this.map.on("load",()=>{this.events.publish("ocm:mapping:ready")});let ne=uo.debounce(()=>{this.getMapCenter().subscribe(q=>{this.searchMarker.setLngLat(new bs.default.LngLat(q.coords.longitude,q.coords.latitude))})},500,!1);this.map.on("move",()=>{this.searchMarker&&ne()}),this.map.on("moveend",()=>{this.events.publish("ocm:mapping:dragend"),x.onMapMoveCompleted&&x.onMapMoveCompleted()}),this.map.on("zoomend",()=>{this.events.publish("ocm:mapping:zoom")})}}else return this.logging.log("Call to initMap before API is ready:"+Fl[this.mapAPIType],ar.ERROR),this.mapReady=!1,!1}clearMarkers(){this.markerList!=null&&this.markerList.forEach((u,x)=>{u.remove()}),this.markerList=new Map}showPOIListOnMap(u,x,_=!0){let o=!1,C=this.map,B=new bs.default.LngLatBounds,$=0,Y=this;o&&this.clearMarkers();let ne=C.getZoom();if(u!=null){let Ce=u.length;for(let Ie=0;Ie<u.length;Ie++)if(u[Ie].AddressInfo!=null&&u[Ie].AddressInfo.Latitude!=null&&u[Ie].AddressInfo.Longitude!=null){let Ae=u[Ie],De=!0;if(!o&&this.markerList!=null&&this.markerList.has(Ae.ID)){De=!1;let qe=this.markerList.get(Ae.ID);qe&&qe.poi&&qe.poi.DateLastStatusUpdate!=Ae.DateLastStatusUpdate&&(qe.remove(),De=!0)}if(De){let qe=null,Qe=null;_?(qe=document.createElement("img"),qe.src=uo.getIconForPOI(Ae),qe.width=34,qe.height=50):(qe=null,Qe=uo.getColorForPOI(Ae));let nt={element:qe,color:Qe,anchor:"bottom"},vt=(_?"OCM-":"EXT-")+Ae.ID+": "+Ae.AddressInfo.Title+":";Ae.UsageType!=null&&(vt+=" "+Ae.UsageType.Title),Ae.StatusType!=null&&(vt+=" "+Ae.StatusType.Title);let tt=new bs.default.Marker(nt).setLngLat([Ae.AddressInfo.Longitude,Ae.AddressInfo.Latitude]).addTo(C);tt.poi=Ae;let At=tt.getElement();At.poi=Ae,At.addEventListener("click",Yt=>{let pn=Yt.currentTarget.poi;this.events.publish("ocm:poi:selected",{poiId:pn.ID,poi:pn})}),B.extend(tt.getLngLat()),this.markerList.set(Ae.ID,tt),$++}}this.logging.log($+" new map markers added out of a total "+this.markerList.size)}let q=this;if(u!=null&&u.length>0)if(x!=null&&!x.appConfig.enableLiveMapQuerying){this.logging.log("Fitting to marker bounds:"+B),C.setCenter(B.getCenter()),this.logging.log("zoom before fit bounds:"+C.getZoom()),C.fitBounds(B);let Ce=C.getZoom();C.setZoom(Ce<6?6:Ce)}else C.getCenter()==null&&C.setCenter(B.getCenter())}refreshMapLayout(){this.map!=null&&setTimeout(()=>{this.logging.log("maplibreGL: refreshMapLayout",ar.VERBOSE),this.map.resize()},200)}setMapCenter(u){this.mapReady&&(this.map.setCenter(new bs.default.LngLat(u.coords.longitude,u.coords.latitude)),this.searchMarker||(this.searchMarker=new bs.default.Marker({color:"#99ccff",anchor:"bottom"}).setLngLat(new bs.default.LngLat(u.coords.longitude,u.coords.latitude)).addTo(this.map),this.searchMarker.getElement().addEventListener("click",()=>{let x=this.searchMarker.getLngLat();this.events.publish("ocm:mapping:addpoi",new Un(x.lat,x.lng))})))}getMapCenter(){return new Oh(x=>{if(this.map!=null){let _=this.map.getCenter();_!=null&&(x.next(new Nl(_.lat,_.lng)),x.complete())}})}setMapZoom(u){this.map.setZoom(u)}getMapZoom(){return new Oh(x=>{let _=this.map.getZoom();x.next(_),x.complete()})}setMapType(u){this.map.setStyle(this.getCurrentMapTileSet(u))}getMapBounds(){return new Oh(x=>{let _=new Array,o=this.map.getBounds();_.push(new Un(o.getSouthWest().lat,o.getSouthWest().lng)),_.push(new Un(o.getNorthEast().lat,o.getNorthEast().lng)),x.next(_),x.complete()})}moveToMapBounds(u){this.map.fitBounds(new bs.default.LngLatBounds(new bs.default.LngLat(u.southWest.longitude,u.southWest.latitude),new bs.default.LngLat(u.northEast.longitude,u.northEast.latitude)))}renderMap(u,x,_){return document.getElementById(this.mapCanvasID).style.height=x+"px",this.mapReady&&this.showPOIListOnMap(u,_),!0}renderPolyline(u){this.clearPolyline()}clearPolyline(){this.polylinePath!=null&&this.polylinePath.setMap(null)}focusMap(){}unfocusMap(){}placeSearch(u,x,_){return st(this,null,function*(){let o=`https://api.maplibre.com/geocoding/v5/maplibre.places/${u||_+","+x}.json?access_token=${Ea.mapBoxToken}`;return new Promise((C,B)=>st(this,null,function*(){this.http.get(o).toPromise().then($=>{let Y=[];Y=[],$.features&&$.features.map(ne=>{let q=new su;q.Title=ne.place_name,q.Address=ne.place_name,q.Type="place",q.Location=new Un(ne.center[1],ne.center[0]),q.Attribution=$.attribution,Y.push(q)}),C(Y)})}))})}addPOILayer(u){this.logging.log("Add POI Layer not implemented in this provider."),this.showPOIListOnMap(u,null,!1)}static \u0275fac=function(x){return new(x||g)(ii(Ba),ii(bn),ii($o))};static \u0275prov=An({token:g,factory:g.\u0275fac})}return g})();var wm=(()=>{class g{logging;http;map;mapCentreMarker;mapsInitialised;mapAPIReady;mapOptions;searchMarker;errorMessage;parentAppContext;mapProvider;debouncedMapPositionUpdate;events;isFocused=!1;constructor(u,x,_){this.logging=x,this.http=_,this.events=u,this.mapOptions=new qg,this.mapAPIReady=!1,this.mapsInitialised=!1,this.setMapAPI(this.mapOptions.mapAPI);let o=this;this.debouncedMapPositionUpdate=uo.debounce(()=>{this.logging.log("signaling map position change:"),o.mapProvider.mapReady&&o.getMapCenter().subscribe(C=>{C!=null?(this.logging.log("Map centre/zoom changed, updating search position:"+C),this.updateMapCentrePos(C.coords.latitude,C.coords.longitude,!1)):this.logging.log("Map centre/zoom changed - map not ready to change centre pos:")})},300,!1)}setParentAppContext(u){this.parentAppContext=u}setMapAPI(u){this.mapOptions.mapAPI=u,this.mapOptions.mapAPI==Fl.MAPTILER&&(this.mapProvider=new bm(this.events,this.logging,this.http)),this.mapOptions.mapAPI==Fl.MAPLIBRE&&(this.mapProvider=new uT(this.events,this.logging,this.http))}isMapReady(){return this.mapProvider!=null?this.mapProvider.mapReady:!1}externalAPILoaded(u){this.mapAPIReady=!0,this.logging.log("Mapping API Loaded: "+Fl[u])}initMap(u){if(!this.isMapReady())if(this.mapProvider!=null)this.mapsInitialised&&this.logging.log("initMap: Map provider already initialised"),this.logging.log("Mapping Manager: Init "+Fl[this.mapProvider.mapAPIType]),this.mapProvider.initMap(u,this.mapOptions,this);else if(this.mapsInitialised){this.logging.log("initMap: map already initialised");return}else this.logging.log("initMap: "+this.mapOptions.mapAPI)}mapManipulationPerformed(u){this.logging.log("map manipulated:"+u);let x=this;(u=="drag"||u=="zoom")&&this.debouncedMapPositionUpdate()}updateMapSize(){this.mapProvider&&this.mapProvider.refreshMapLayout()}updateMapCentrePos(u,x,_,o){_&&this.mapProvider!=null&&this.mapProvider.setMapCenter(new Nl(u,x),o),this.mapOptions.mapCentre=new Nl(u,x)}moveToMapBounds(u){this.mapProvider.moveToMapBounds(u)}refreshMapView(u,x,_){return this.mapProvider!=null?(this.logging.log("Mapping Manager: renderMap "+Fl[this.mapProvider.mapAPIType]),this.isMapReady()?this.mapProvider.renderMap(x,u,this.parentAppContext):this.logging.log("refreshMapView: map provider not initialised..")):this.logging.log("Unsupported Map API: refreshMapView",ar.ERROR),!0}setMapType(u){this.mapOptions.mapType!=u&&(this.mapOptions.mapType=u,this.isMapReady()&&this.mapProvider!=null?(this.logging.log("Changing map type:"+u),this.mapProvider.setMapType(u)):this.logging.log("Map type set, maps not initialised yet."))}unfocusMap(){this.logging.log("[mapping] Unfocus Map."),this.isFocused=!1,this.mapProvider.unfocusMap()}focusMap(){this.logging.log("[mapping] Focus Map."),this.isFocused=!0,this.mapProvider.focusMap()}getMapBounds(){return this.mapProvider.getMapBounds()}getMapZoom(){return this.mapProvider.getMapZoom()}setMapZoom(u){this.mapProvider.setMapZoom(u)}getMapCenter(){return this.mapProvider.getMapCenter()}showPOIOnStaticMap(u,x,_=!1,o=!1,C=200,B=200){let $=document.getElementById(u);if($!=null){let Y=x.AddressInfo.Title,ne=x.AddressInfo.Latitude,q=x.AddressInfo.Longitude;C>640&&(C=640),B>640&&(B=640);let Ce=C,Ie=B,Ae="https://maps.googleapis.com/maps/api/staticmap?center="+ne+","+q+"&zoom=14&size="+Ce+"x"+Ie+"&maptype=roadmap&markers=color:blue%7Clabel:A%7C"+ne+","+q+"&sensor=false",De="";_==!0?De+="<div>"+uo.formatMapLink(x,'<div><img width="'+Ce+'" height="'+Ie+'" src="'+Ae+'" /></div>',o)+"</div>":De+='<div><img width="'+Ce+'" height="'+Ie+'" src="'+Ae+'" /></div>',$.innerHTML=De}}renderPolyline(u){this.mapProvider.renderPolyline(u)}clearPolyline(){this.mapProvider.clearPolyline()}clearMarkers(){this.logging.log("mapping: clearing markers"),this.mapProvider.clearMarkers()}addPOILayer(u){this.mapProvider.addPOILayer(u)}static \u0275fac=function(x){return new(x||g)(ii(Ba),ii(bn),ii($o))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();function CE(g,m){if(g&1){let u=oi();dn(0),ge(1,"ion-note")(2,"p"),Le(3," The closest address to this position is: "),ve(),ge(4,"p")(5,"strong"),Le(6),ve(),yt(7,"br"),Le(8),yt(9,"br"),ge(10,"ion-button",3),Dt("click",function(){ct(u);let _=Ve();return ut(_.useAddressSelection())}),Le(11,"Use this address below "),yt(12,"ion-icon",4),ve()()(),mn()}if(g&2){let u=Ve();be(6),Ht(u.suggestedAddress.AddressLine1),be(2),j1(" ",u.suggestedAddress.AddressLine2," ",u.suggestedAddress.Town," ",u.suggestedAddress.StateOrProvince," ",u.suggestedAddress.Postcode," ")}}var vy=(()=>{class g{mapping;events;logging;http;appManager;latitude;latitudeChange=new Ma;longitude;longitudeChange=new Ma;suggestedAddress=null;suggestedAddressChange=new Ma;onUseSuggestedAddress=new Ma;suggestedAddressAttribution=null;suggestedAddressAttributionChange=new Ma;originalMarkerPos;mapService;mapOptions;debouncedGecode;isMapInitialised=!1;constructor(u,x,_,o,C){this.mapping=u,this.events=x,this.logging=_,this.http=o,this.appManager=C}ngOnInit(){this.mapService=new bm(this.events,this.logging,this.http),this.mapService.initAPI(),this.mapOptions=new qg,this.mapOptions.mapType=this.appManager.searchSettings.MapType,this.mapOptions.onMapMoveCompleted=()=>{let u;u=this.mapService.getMapCenter(),u.subscribe(x=>{x&&(this.latitude=x.coords.latitude,this.longitude=x.coords.longitude,this.latitudeChange.emit(this.latitude),this.longitudeChange.emit(this.longitude),this.getAddressForCurrentLatLng())})}}ngAfterContentInit(){this.focusMap()}ngOnDestroy(){this.mapService.disposeMap()}focusMap(){this.isMapInitialised==!1&&this.mapService&&this.latitude!=0&&this.longitude!=0&&(this.isMapInitialised=!0,this.mapService.initMap("editor-map",this.mapOptions,null),this.mapService.setMapCenter(new Nl(this.latitude,this.longitude)),this.originalMarkerPos=new Un(this.latitude,this.longitude))}ngOnChanges(u){this.focusMap()}getAddressForCurrentLatLng(){return st(this,null,function*(){this.latitude&&this.longitude&&this.appManager.api.fetchReverseGeocodeResult(this.latitude,this.longitude).then(u=>{u.AddressInfo&&(this.suggestedAddress=u.AddressInfo)})})}useAddressSelection(){this.onUseSuggestedAddress.emit({suggestedAddress:this.suggestedAddress,attribution:this.suggestedAddressAttribution}),this.suggestedAddress=null,this.suggestedAddressAttribution=null}static \u0275fac=function(x){return new(x||g)(Rt(wm),Rt(Ba),Rt(bn),Rt($o),Rt(Ps))};static \u0275cmp=lr({type:g,selectors:[["app-poi-location-editor"]],inputs:{latitude:"latitude",longitude:"longitude"},outputs:{latitudeChange:"latitudeChange",longitudeChange:"longitudeChange",suggestedAddressChange:"suggestedAddressChange",onUseSuggestedAddress:"onUseSuggestedAddress",suggestedAddressAttributionChange:"suggestedAddressAttributionChange"},standalone:!1,features:[$g],decls:4,vars:1,consts:[[1,"instruction"],["id","editor-map"],[4,"ngIf"],["size","small",3,"click"],["slot","end","name","copy"]],template:function(x,_){x&1&&(ge(0,"p",0),Le(1,"Drag the map to center the marker on the charging location:"),ve(),yt(2,"div",1),Et(3,CE,13,5,"ng-container",2)),x&2&&(be(3),Ze("ngIf",_.suggestedAddress))},dependencies:[Or,wr,Tr,Yd],styles:["#editor-map[_ngcontent-%COMP%]{border:1px solid gainsboro;background-color:gray;width:100%;height:128px}"]})}return g})();function EE(g,m){if(g&1&&(ge(0,"ion-select-option",18),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}function AE(g,m){if(g&1&&(ge(0,"ion-select-option",18),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}function kE(g,m){if(g&1&&(ge(0,"ion-select-option",18),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}var I1=(()=>{class g{modalController;referenceDataManager;conn;useFilteredConnectionTypes=!0;useFilteredOperators=!0;constructor(u,x){this.modalController=u,this.referenceDataManager=x}get isAddMode(){return!(this.conn!=null&&this.conn.ID>0)}get connectionTypes(){return this.referenceDataManager.getConnectionTypes(this.useFilteredConnectionTypes)}get currentTypes(){return this.referenceDataManager.getOutputCurrentTypes()}get statusTypes(){return this.referenceDataManager.getStatusTypes().filter(u=>u.IsUserSelectable==!0)}ngOnInit(){}save(){var u=!0;this.conn.Quantity!=null&&(this.conn.Quantity<0||this.conn.Quantity>100||!Number.isInteger(this.conn.Quantity))&&(alert("Quantity must be a whole number, or leave it blank."),u=!1),u&&this.modalController.dismiss({item:this.conn})}cancel(){this.modalController.dismiss()}static \u0275fac=function(x){return new(x||g)(Rt(Ss),Rt(Gh))};static \u0275cmp=lr({type:g,selectors:[["app-poi-equipment-editor"]],standalone:!1,decls:42,vars:13,consts:[[1,"ion-padding"],["label","Connection Type","label-placement","floating",3,"ngModelChange","ngModel"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["label","Supply Type","label-placement","floating",3,"ngModelChange","ngModel"],["label","Power (kW)","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Amps","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Voltage","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Status","label-placement","floating",3,"ngModelChange","ngModel"],["label","Quantity Available","label-placement","floating","type","number",3,"ngModelChange","ngModel"],["label","Comment","label-placement","floating","type","text","placeholder","(optional) other comments",3,"ngModelChange","ngModel"],["label","Operators Reference","label-placement","floating","type","text","placeholder","(optional)",3,"ngModelChange","ngModel"],["slot","start"],[3,"click"],["name","close","slot","start"],["slot","end"],["color","success",3,"click"],["name","send","slot","end"],[3,"value"]],template:function(x,_){x&1&&(ge(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),Le(3),ve()()(),ge(4,"ion-content",0)(5,"p"),Le(6,"Please provide as much information as you can about the equipment. If you don't know then leave the field blank. At a minimum you should include the Connection Type and approximate Power kW (max)."),ve(),ge(7,"ion-item")(8,"ion-select",1),Kt("ngModelChange",function(C){return Zt(_.conn.ConnectionTypeID,C)||(_.conn.ConnectionTypeID=C),C}),ge(9,"ion-select-option",2),Le(10,"Unknown"),ve(),Et(11,EE,2,2,"ion-select-option",3),ve()(),ge(12,"ion-item")(13,"ion-select",4),Kt("ngModelChange",function(C){return Zt(_.conn.CurrentTypeID,C)||(_.conn.CurrentTypeID=C),C}),ge(14,"ion-select-option",2),Le(15,"Unknown"),ve(),Et(16,AE,2,2,"ion-select-option",3),ve()(),ge(17,"ion-item")(18,"ion-input",5),Kt("ngModelChange",function(C){return Zt(_.conn.PowerKW,C)||(_.conn.PowerKW=C),C}),ve()(),ge(19,"ion-item")(20,"ion-input",6),Kt("ngModelChange",function(C){return Zt(_.conn.Amps,C)||(_.conn.Amps=C),C}),ve()(),ge(21,"ion-item")(22,"ion-input",7),Kt("ngModelChange",function(C){return Zt(_.conn.Voltage,C)||(_.conn.Voltage=C),C}),ve()(),ge(23,"ion-item")(24,"ion-select",8),Kt("ngModelChange",function(C){return Zt(_.conn.StatusTypeID,C)||(_.conn.StatusTypeID=C),C}),Et(25,kE,2,2,"ion-select-option",3),ve()(),ge(26,"ion-item")(27,"ion-input",9),Kt("ngModelChange",function(C){return Zt(_.conn.Quantity,C)||(_.conn.Quantity=C),C}),ve()(),ge(28,"ion-item")(29,"ion-input",10),Kt("ngModelChange",function(C){return Zt(_.conn.Comments,C)||(_.conn.Comments=C),C}),ve()(),ge(30,"ion-item")(31,"ion-input",11),Kt("ngModelChange",function(C){return Zt(_.conn.Reference,C)||(_.conn.Reference=C),C}),ve()()(),ge(32,"ion-footer")(33,"ion-toolbar")(34,"ion-buttons",12)(35,"ion-button",13),Dt("click",function(){return _.cancel()}),yt(36,"ion-icon",14),Le(37," Cancel "),ve()(),ge(38,"ion-buttons",15)(39,"ion-button",16),Dt("click",function(){return _.save()}),Le(40," OK "),yt(41,"ion-icon",17),ve()()()()),x&2&&(be(3),Ht(_.isAddMode?"Add Equipment":"Edit Equipment"),be(5),Xt("ngModel",_.conn.ConnectionTypeID),be(3),Ze("ngForOf",_.connectionTypes),be(2),Xt("ngModel",_.conn.CurrentTypeID),be(3),Ze("ngForOf",_.currentTypes),be(2),Xt("ngModel",_.conn.PowerKW),be(2),Xt("ngModel",_.conn.Amps),be(2),Xt("ngModel",_.conn.Voltage),be(2),Xt("ngModel",_.conn.StatusTypeID),be(),Ze("ngForOf",_.statusTypes),be(2),Xt("ngModel",_.conn.Quantity),be(2),Xt("ngModel",_.conn.Comments),be(2),Xt("ngModel",_.conn.Reference))},dependencies:[Vo,wr,Da,Bl,Ol,jl,Tr,Ts,jr,mu,fu,Ul,Ra,Hd,ws,La,Go,Zo],encapsulation:2})}return g})();var P1=(function(g){return g[g.Unknown=0]="Unknown",g[g.CurrentlyAvailable=10]="CurrentlyAvailable",g[g.CurrentlyInUse=20]="CurrentlyInUse",g[g.TemporarilyUnavailable=30]="TemporarilyUnavailable",g[g.Operational=50]="Operational",g[g.PartlyOperational=75]="PartlyOperational",g[g.NotOperational=100]="NotOperational",g[g.PlannedForFutureDate=150]="PlannedForFutureDate",g[g.RemovedDecomissioned=200]="RemovedDecomissioned",g})(P1||{}),C1=(function(g){return g[g.UnknownOperator=1]="UnknownOperator",g[g.SiteOwner=45]="SiteOwner",g})(C1||{});function LE(g,m){if(g&1){let u=oi();ge(0,"ion-button",5),Dt("click",function(){ct(u);let _=Ve().$implicit,o=Ve();return ut(o.onCopyCommand(_))}),Le(1,"Copy"),ve()}}function DE(g,m){if(g&1){let u=oi();ge(0,"ion-button",5),Dt("click",function(){ct(u);let _=Ve().$implicit,o=Ve();return ut(o.onEditCommand(_))}),Le(1,"Edit"),ve()}}function zE(g,m){if(g&1&&(ge(0,"ion-item",1)(1,"ion-grid")(2,"ion-row")(3,"ion-col"),Le(4),ve()(),ge(5,"ion-row")(6,"ion-col",2)(7,"p"),yt(8,"img",3),ve(),ge(9,"ion-note"),Le(10),ve(),Et(11,LE,2,0,"ion-button",4)(12,DE,2,0,"ion-button",4),ve(),ge(13,"ion-col")(14,"ion-row")(15,"ion-col")(16,"p"),Le(17),ve(),ge(18,"ion-note"),Le(19),ve()()(),ge(20,"ion-row")(21,"ion-col"),Le(22),ve(),ge(23,"ion-col"),Le(24),ve()()()()()()),g&2){let u=m.$implicit,x=Ve();be(4),Ut(" ",u.AddressInfo.Title," "),be(4),Ze("src",x.getIconForPOI(u),xd),be(2),Ut(" ",x.getFormattedDistance(u)," "),be(),Ze("ngIf",x.enableCopyOption),be(),Ze("ngIf",x.enableEditOption),be(5),Ut(" ",x.getFormattedAddress(u)," "),be(2),Ut(" ",x.getFormattedConnectorList(u)," "),be(3),Ut(" ",u.UsageType==null?null:u.UsageType.Title," "),be(2),Ut(" ",u.OperatorInfo==null?null:u.OperatorInfo.Title," ")}}var hT=(()=>{class g{enableCopyOption=!1;enableEditOption=!1;poiList=[];onCopy=new Ma;onEdit=new Ma;constructor(){}ngOnInit(){}onCopyCommand(u){this.onCopy.emit(u)}onEditCommand(u){this.onEdit.emit(u)}getFormattedAddress(u){let x="";return u.AddressInfo.Title!=u.AddressInfo.AddressLine1?x+=u.AddressInfo.Title:x+=u.AddressInfo.Town,x}getFormattedConnectorList(u){if(!u.Connections)return;let x=[];for(let _ of u.Connections)_.ConnectionType!=null&&(x.find(o=>o==_.ConnectionType.Title)||x.push(_.ConnectionType.Title));return x.join(", ")}getIconForPOI(u){return uo.getIconForPOI(u)}getFormattedDistance(u){return uo.getFormattedDistance(u)}static \u0275fac=function(x){return new(x||g)};static \u0275cmp=lr({type:g,selectors:[["app-poi-list"]],inputs:{enableCopyOption:"enableCopyOption",enableEditOption:"enableEditOption",poiList:"poiList"},outputs:{onCopy:"onCopy",onEdit:"onEdit"},standalone:!1,decls:2,vars:1,consts:[["style","max-width:400px;",4,"ngFor","ngForOf"],[2,"max-width","400px"],["size","3"],[2,"width","24px",3,"src"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"]],template:function(x,_){x&1&&(ge(0,"ion-list"),Et(1,zE,25,9,"ion-item",0),ve()),x&2&&(be(),Ze("ngForOf",_.poiList))},dependencies:[Vo,Or,wr,Xd,Kd,jr,za,Yd,Jd],encapsulation:2})}return g})();function FE(g,m){if(g&1&&(ge(0,"ion-badge",7),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ut("",u.Quantity," x")}}function BE(g,m){if(g&1&&(ge(0,"strong"),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ut("",u.PowerKW," kW ")}}function OE(g,m){if(g&1&&(ge(0,"div"),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ut("",u.CurrentType==null?null:u.CurrentType.Title," ")}}function jE(g,m){if(g&1&&(ge(0,"span"),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ut("",u.Amps,"A ")}}function UE(g,m){if(g&1&&(ge(0,"span"),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ut("",u.Voltage,"V ")}}function NE(g,m){if(g&1){let u=oi();ge(0,"ion-col")(1,"ion-button",8),Dt("click",function(){ct(u);let _=Ve().$implicit,o=Ve();return ut(o.editConnection(_))}),yt(2,"ion-icon",9),ve(),yt(3,"br"),ge(4,"ion-button",10),Dt("click",function(){ct(u);let _=Ve().$implicit,o=Ve();return ut(o.deleteConnection(_))}),yt(5,"ion-icon",11),ve()()}}function VE(g,m){if(g&1&&(ge(0,"ion-row")(1,"ion-col")(2,"ion-row")(3,"ion-col",1),yt(4,"div",2),Et(5,FE,2,1,"ion-badge",3),ge(6,"div",4),Le(7),ve()(),ge(8,"ion-col")(9,"ion-row")(10,"ion-col")(11,"ion-note")(12,"div")(13,"strong",5),Le(14),ve()(),Et(15,BE,2,1,"strong",6)(16,OE,2,1,"div",6),ve(),ge(17,"ion-note"),Et(18,jE,2,1,"span",6)(19,UE,2,1,"span",6),ve()()(),ge(20,"ion-row")(21,"ion-col",4),Le(22),ve(),ge(23,"ion-col",4),Le(24),ve()()(),Et(25,NE,6,0,"ion-col",6),ve()()()),g&2){let u=m.$implicit,x=Ve();be(4),Zg("mask-image","url("+x.getConnectorTypeIcon(u.ConnectionTypeID)+")"),be(),Ze("ngIf",u.Quantity),be(2),Ht(u.StatusType==null?null:u.StatusType.Title),be(6),Ze("title",wd(u.ConnectionType==null?null:u.ConnectionType.FormalName)),be(),Ut("",u.ConnectionType==null?null:u.ConnectionType.Title," "),be(),Ze("ngIf",u.PowerKW),be(),Ze("ngIf",u.CurrentTypeID),be(2),Ze("ngIf",u.Amps),be(),Ze("ngIf",u.Voltage),be(3),Ht(u.Reference),be(2),Ht(u.Comments),be(),Ze("ngIf",x.enableEdit)}}var xy=(()=>{class g{item;enableEdit=!1;onEdit=new Ma;onDelete=new Ma;constructor(){}ngOnInit(){}editConnection(u){this.onEdit.emit(u)}deleteConnection(u){this.onDelete.emit(u)}getConnectorTypeIcon(u){return uo.getIconForConnector(u)}static \u0275fac=function(x){return new(x||g)};static \u0275cmp=lr({type:g,selectors:[["app-equipment-details"]],inputs:{item:"item",enableEdit:"enableEdit"},outputs:{onEdit:"onEdit",onDelete:"onDelete"},standalone:!1,decls:2,vars:1,consts:[[4,"ngFor","ngForOf"],["size","3"],[1,"connector-icon"],["color","primary",4,"ngIf"],[1,"info"],[3,"title"],[4,"ngIf"],["color","primary"],["size","small","color","secondary",3,"click"],["name","create","slot","icon-only"],["size","small","color","danger",3,"click"],["name","trash","slot","icon-only"]],template:function(x,_){x&1&&(ge(0,"ion-grid"),Et(1,VE,26,14,"ion-row",0),ve()),x&2&&(be(),Ze("ngForOf",_.item.Connections))},dependencies:[Vo,Or,Wg,wr,Xd,Kd,Tr,Yd,Jd],styles:[".connector-icon[_ngcontent-%COMP%]{-webkit-mask-size:100%;mask-size:100%;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-position:center;mask-position:center;width:64px;height:64px;background-color:currentColor;-webkit-mask-image:none;mask-image:none}"]})}return g})();function $E(g,m){if(g&1&&(ge(0,"ion-select-option",5),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}function GE(g,m){g&1&&(ge(0,"ion-select-option",6),Le(1,"Other..."),ve())}function ZE(g,m){if(g&1){let u=oi();ge(0,"ion-item")(1,"ion-label",1),Le(2,"Network Operator"),ve(),ge(3,"ion-select",2),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.operatorId,_)||(o.operatorId=_),ut(_)}),Dt("ionChange",function(){ct(u);let _=Ve();return ut(_.onOperatorChange())}),Et(4,$E,2,2,"ion-select-option",3)(5,GE,2,0,"ion-select-option",4),ve()()}if(g&2){let u=Ve();be(3),Xt("ngModel",u.operatorId),be(),Ze("ngForOf",u.operators),be(),Ze("ngIf",u.useFilteredOperators)}}function qE(g,m){if(g&1){let u=oi();ge(0,"ion-item")(1,"ion-searchbar",7),Dt("ionCancel",function(){ct(u);let _=Ve();return ut(_.cancelOperatorLookup())}),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.operatorSearchKeyword,_)||(o.operatorSearchKeyword=_),ut(_)}),Dt("ionInput",function(_){ct(u);let o=Ve();return ut(o.searchOperators(_))}),ve()()}if(g&2){let u=Ve();be(),Xt("ngModel",u.operatorSearchKeyword)}}function WE(g,m){if(g&1){let u=oi();ge(0,"ion-item",9),Dt("click",function(){let _=ct(u).$implicit,o=Ve(2);return ut(o.onOperatorChange(_))}),ge(1,"ion-avatar",10),yt(2,"ion-icon",11),ve(),ge(3,"ion-label")(4,"p"),Le(5),ve(),ge(6,"p"),Le(7),ve()()()}if(g&2){let u=m.$implicit;be(5),Ht(u.Title),be(2),Ht(u.WebsiteURL)}}function HE(g,m){if(g&1&&(dn(0),ge(1,"ion-list"),Et(2,WE,8,2,"ion-item",8),ve(),mn()),g&2){let u=Ve();be(2),Ze("ngForOf",u.operatorSearchResults)}}function XE(g,m){if(g&1){let u=oi();dn(0),ge(1,"ion-item")(2,"ion-avatar",10),yt(3,"ion-icon",12),ve(),ge(4,"ion-label")(5,"p"),Le(6),ve(),ge(7,"p"),Le(8),ve(),ge(9,"ion-button",9),Dt("click",function(){ct(u);let _=Ve();return ut(_.selectedOperator=null)}),Le(10,"Change"),ve()()(),mn()}if(g&2){let u=Ve();be(6),Ht(u.selectedOperator.Title),be(2),Ht(u.selectedOperator.WebsiteURL)}}function KE(g,m){if(g&1){let u=oi();ge(0,"ion-chip")(1,"ion-label"),Le(2),ve(),ge(3,"ion-icon",14),Dt("click",function(){let _=ct(u).$implicit,o=Ve(2);return ut(o.removeOperator(_))}),ve()()}if(g&2){let u=m.$implicit,x=Ve(2);be(2),Ht(x.getOperatorInfo(u).Title)}}function YE(g,m){if(g&1&&(dn(0),Et(1,KE,4,1,"ion-chip",13),mn()),g&2){let u=Ve();be(),Ze("ngForOf",u.operatorList)}}var dT=(()=>{class g{referenceDataManager;changeDetector;operatorId=null;operatorList=null;mode="single";useFilteredOperators=null;operatorChanged=new Ma;operatorRemoved=new Ma;operatorCache=[];operatorSearchResults=[];operatorSearchKeyword="";selectedOperator=null;get operators(){return this.referenceDataManager.getNetworkOperators(this.useFilteredOperators)}constructor(u,x){this.referenceDataManager=u,this.changeDetector=x}ngOnInit(){this.operatorCache=this.referenceDataManager.getNetworkOperators(!1),this.operatorId!=null&&(this.selectedOperator=this.operatorCache.find(u=>u.ID==this.operatorId))}searchOperators(){this.operatorSearchResults=[],this.operatorSearchKeyword.length!=0&&(this.operatorCache?this.operatorSearchResults=this.operatorCache.filter(u=>u.Title.toLowerCase().startsWith(this.operatorSearchKeyword.toLowerCase())||u.Title.toLowerCase().startsWith("("+this.operatorSearchKeyword.toLowerCase())).slice(0,10):this.operatorSearchResults=[])}getOperatorInfo(u){if(this.operatorCache)return this.operatorCache.find(x=>x.ID==u)}onOperatorChange(u=null){return st(this,null,function*(){u==null&&this.operatorId&&(u=this.operatorCache.find(x=>x.ID==this.operatorId)),u!=null&&(this.operatorSearchResults=[],this.selectedOperator=u,this.operatorId=u.ID),this.operatorId?(this.operatorChanged.emit(this.selectedOperator),this.mode!="single"&&(this.selectedOperator=null,this.operatorSearchKeyword="")):this.useFilteredOperators=!1})}removeOperator(u){return st(this,null,function*(){this.operatorId=null,this.operatorRemoved.emit(u)})}cancelOperatorLookup(){this.selectedOperator=null}static \u0275fac=function(x){return new(x||g)(Rt(Gh),Rt(jh))};static \u0275cmp=lr({type:g,selectors:[["app-operator-lookup"]],inputs:{operatorId:"operatorId",operatorList:"operatorList",mode:"mode",useFilteredOperators:"useFilteredOperators"},outputs:{operatorChanged:"operatorChanged",operatorRemoved:"operatorRemoved"},standalone:!1,decls:5,vars:5,consts:[[4,"ngIf"],["position","floating"],[3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["value","",4,"ngIf"],[3,"value"],["value",""],["placeholder","Search network operators","showCancelButton","focus","autocomplete","on",3,"ionCancel","ngModelChange","ionInput","ngModel"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["item-left",""],["name","card"],["name","locate"],[4,"ngFor","ngForOf"],["name","close-circle",3,"click"]],template:function(x,_){x&1&&Et(0,ZE,6,3,"ion-item",0)(1,qE,2,1,"ion-item",0)(2,HE,3,1,"ng-container",0)(3,XE,11,2,"ng-container",0)(4,YE,2,1,"ng-container",0),x&2&&(Ze("ngIf",_.useFilteredOperators&&!_.selectedOperator),be(),Ze("ngIf",!_.useFilteredOperators&&!_.selectedOperator),be(),Ze("ngIf",_.operatorSearchResults.length>0),be(),Ze("ngIf",_.selectedOperator!=null),be(),Ze("ngIf",(_.operatorList==null?null:_.operatorList.length)>0))},dependencies:[Vo,Or,Uh,wr,H1,Tr,jr,qo,za,Kg,mu,fu,ws,La,Go,Zo],encapsulation:2})}return g})();function QE(g,m){g&1&&yt(0,"ion-icon",14)}function eA(g,m){g&1&&yt(0,"ion-icon",14)}function tA(g,m){g&1&&yt(0,"ion-icon",14)}function iA(g,m){if(g&1&&(ge(0,"ion-select-option",26),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}function nA(g,m){if(g&1){let u=oi();dn(0),ge(1,"app-poi-location-editor",15,0),Kt("latitudeChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.Latitude,_)||(o.item.AddressInfo.Latitude=_),ut(_)})("longitudeChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.Longitude,_)||(o.item.AddressInfo.Longitude=_),ut(_)}),Dt("onUseSuggestedAddress",function(_){ct(u);let o=Ve(2);return ut(o.useSuggestedAddress(_))}),ve(),ge(3,"ion-list")(4,"ion-item")(5,"ion-input",16),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.Title,_)||(o.item.AddressInfo.Title=_),ut(_)}),ve()(),ge(6,"ion-item")(7,"ion-input",17),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.AddressLine1,_)||(o.item.AddressInfo.AddressLine1=_),ut(_)}),ve()(),ge(8,"ion-item")(9,"ion-input",18),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.AddressLine2,_)||(o.item.AddressInfo.AddressLine2=_),ut(_)}),ve()(),ge(10,"ion-item")(11,"ion-input",19),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.Town,_)||(o.item.AddressInfo.Town=_),ut(_)}),ve()(),ge(12,"ion-item")(13,"ion-input",20),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.StateOrProvince,_)||(o.item.AddressInfo.StateOrProvince=_),ut(_)}),ve()(),ge(14,"ion-item")(15,"ion-input",21),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.Postcode,_)||(o.item.AddressInfo.Postcode=_),ut(_)}),ve()(),ge(16,"ion-item")(17,"ion-select",22),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.CountryID,_)||(o.item.AddressInfo.CountryID=_),ut(_)}),Dt("ionChange",function(){ct(u);let _=Ve(2);return ut(_.onCountryChange())}),Et(18,iA,2,2,"ion-select-option",23),ve()(),ge(19,"ion-item")(20,"ion-input",24),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.Latitude,_)||(o.item.AddressInfo.Latitude=_),ut(_)}),ve()(),ge(21,"ion-item")(22,"ion-input",25),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.AddressInfo.Longitude,_)||(o.item.AddressInfo.Longitude=_),ut(_)}),ve()()(),mn()}if(g&2){let u=Ve(2);be(),Xt("latitude",u.item.AddressInfo.Latitude)("longitude",u.item.AddressInfo.Longitude),be(4),Xt("ngModel",u.item.AddressInfo.Title),be(2),Xt("ngModel",u.item.AddressInfo.AddressLine1),be(2),Xt("ngModel",u.item.AddressInfo.AddressLine2),be(2),Xt("ngModel",u.item.AddressInfo.Town),be(2),Xt("ngModel",u.item.AddressInfo.StateOrProvince),be(2),Xt("ngModel",u.item.AddressInfo.Postcode),be(2),Xt("ngModel",u.item.AddressInfo.CountryID),be(),Ze("ngForOf",u.countries),be(2),Xt("ngModel",u.item.AddressInfo.Latitude),be(2),Xt("ngModel",u.item.AddressInfo.Longitude)}}function rA(g,m){if(g&1){let u=oi();dn(0),ge(1,"h3"),Le(2,"Locations Nearby"),ve(),ge(3,"p")(4,"strong"),Le(5,"The following locations already exist nearby."),ve()(),ge(6,"div",27)(7,"p"),Le(8,"Ensure you are not adding a duplicate site unless it is for different equipment from another network operator."),ve(),ge(9,"p"),Le(10,"You can edit any of these listings if required instead:"),ve()(),ge(11,"app-poi-list",28),Dt("onEdit",function(_){ct(u);let o=Ve(2);return ut(o.editPOI(_))}),ve(),mn()}if(g&2){let u=Ve(2);be(11),Ze("poiList",u.nearbySites)("enableEditOption",!0)}}function oA(g,m){if(g&1&&(dn(0),Et(1,nA,23,12,"ng-container",10)(2,rA,12,2,"ng-container",10),mn()),g&2){let u=Ve();be(),Ze("ngIf",u.step=="location"),be(),Ze("ngIf",u.step=="poi-nearby")}}function aA(g,m){if(g&1){let u=oi();dn(0),ge(1,"p"),Le(2,"Copied the equipment configuration from:"),ve(),ge(3,"ion-item")(4,"ion-label"),Le(5),yt(6,"br"),Le(7),yt(8,"br"),Le(9),yt(10,"br"),Le(11),yt(12,"br"),Le(13),ve(),ge(14,"ion-button",30),Dt("click",function(){ct(u);let _=Ve(5);return ut(_.changeTemplatePOI())}),Le(15,"Change.."),ve()(),mn()}if(g&2){let u=Ve(5);be(5),Ut(" ",u.selectedTemplatePOI.AddressInfo.Title," "),be(2),Ut(" ",u.selectedTemplatePOI.AddressInfo.AddressLine1," "),be(2),Ut(" ",u.selectedTemplatePOI.Connections[0].ConnectionType==null?null:u.selectedTemplatePOI.Connections[0].ConnectionType.Title," "),be(2),Ut(" ",u.selectedTemplatePOI.Connections[0].PowerKW," "),be(2),Ut(" ",u.selectedTemplatePOI.DateCreated," ")}}function sA(g,m){if(g&1){let u=oi();dn(0),ge(1,"h4"),Le(2,"Similar Sites"),ve(),ge(3,"app-poi-list",31),Dt("onCopy",function(_){ct(u);let o=Ve(6);return ut(o.useTemplatePOI(_))}),ve(),mn()}if(g&2){let u=Ve(6);be(3),Ze("enableCopyOption",!0)("poiList",u.templateSites)}}function lA(g,m){g&1&&(dn(0),ge(1,"p"),Le(2," There are no suggested sites to copy for this network operator. "),ve(),mn())}function cA(g,m){if(g&1&&(dn(0),Et(1,sA,4,2,"ng-container",10)(2,lA,3,0,"ng-container",10),mn()),g&2){let u=Ve(5);be(),Ze("ngIf",u.templateSites.length>0),be(),Ze("ngIf",u.templateSites.length==0)}}function uA(g,m){if(g&1&&(dn(0),Et(1,aA,16,5,"ng-container",10)(2,cA,3,2,"ng-container",10),mn()),g&2){let u=Ve(4);be(),Ze("ngIf",u.selectedTemplatePOI),be(),Ze("ngIf",!u.selectedTemplatePOI)}}function hA(g,m){if(g&1){let u=oi();dn(0),ge(1,"p",27),Le(2,"You can copy the equipment settings from other sites operated by the same network operator or choose 'Next' to skip this step: "),ve(),ge(3,"app-operator-lookup",29),Dt("operatorChanged",function(_){ct(u);let o=Ve(3);return ut(o.onOperatorChange(_))}),ve(),Et(4,uA,3,2,"ng-container",10),mn()}if(g&2){let u=Ve(3);be(3),Ze("operatorId",u.item.OperatorID),be(),Ze("ngIf",u.item.AddressInfo.CountryID&&u.item.OperatorID)}}function pA(g,m){if(g&1&&(dn(0),Et(1,hA,5,2,"ng-container",10),mn()),g&2){let u=Ve(2);be(),Ze("ngIf",!u.skipPOICopy)}}function dA(g,m){if(g&1){let u=oi();dn(0),ge(1,"app-operator-lookup",32),Dt("operatorChanged",function(_){ct(u);let o=Ve(2);return ut(o.onOperatorChange(_))}),ve(),ge(2,"ion-item")(3,"ion-input",33),Kt("ngModelChange",function(_){ct(u);let o=Ve(2);return Zt(o.item.NumberOfPoints,_)||(o.item.NumberOfPoints=_),ut(_)}),ve()(),ge(4,"h4"),Le(5,"Equipment"),ve(),ge(6,"ion-button",34),Dt("click",function(){ct(u);let _=Ve(2);return ut(_.addConnection())}),yt(7,"ion-icon",35),ve(),ge(8,"app-equipment-details",36),Dt("onEdit",function(_){ct(u);let o=Ve(2);return ut(o.editConnection(_))})("onDelete",function(_){ct(u);let o=Ve(2);return ut(o.deleteConnection(_))}),ve(),mn()}if(g&2){let u=Ve(2);be(),Ze("operatorId",u.item.OperatorID)("useFilteredOperators",!1),be(2),Xt("ngModel",u.item.NumberOfPoints),be(5),Ze("item",u.item)("enableEdit",!0)}}function mA(g,m){if(g&1&&(dn(0),Et(1,pA,2,1,"ng-container",10)(2,dA,9,5,"ng-container",10),mn()),g&2){let u=Ve();be(),Ze("ngIf",u.step=="copy-equipment"),be(),Ze("ngIf",u.step=="edit-equipment")}}function fA(g,m){if(g&1&&(ge(0,"p",46)(1,"strong"),Le(2,"Your changes cannot be saved until the following issues are resolved:"),ve(),ge(3,"ion-label",47),Le(4),ve()()),g&2){let u=Ve(2);be(4),Ut(" ",u.validationMsg)}}function gA(g,m){if(g&1&&(ge(0,"ion-select-option",26),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}function _A(g,m){if(g&1&&(ge(0,"ion-select-option",26),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}function yA(g,m){if(g&1){let u=oi();dn(0),Et(1,fA,5,1,"p",37),ge(2,"p"),Le(3,"Please provide any other facts related to this site. Additional comments (your charging experiences etc) can be added as check-in comments once the site is listed."),ve(),ge(4,"ion-item")(5,"ion-select",38),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.item.StatusTypeID,_)||(o.item.StatusTypeID=_),ut(_)}),Et(6,gA,2,2,"ion-select-option",23),ve()(),ge(7,"ion-item")(8,"ion-select",39),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.item.UsageTypeID,_)||(o.item.UsageTypeID=_),ut(_)}),Et(9,_A,2,2,"ion-select-option",23),ve()(),ge(10,"ion-item")(11,"ion-input",40),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.item.UsageCost,_)||(o.item.UsageCost=_),ut(_)}),ve()(),ge(12,"ion-item")(13,"ion-input",41),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.item.GeneralComments,_)||(o.item.GeneralComments=_),ut(_)}),ve()(),ge(14,"ion-item")(15,"ion-input",42),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.item.AddressInfo.ContactTelephone1,_)||(o.item.AddressInfo.ContactTelephone1=_),ut(_)}),ve()(),ge(16,"ion-item")(17,"ion-input",43),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.item.AddressInfo.ContactTelephone2,_)||(o.item.AddressInfo.ContactTelephone2=_),ut(_)}),ve()(),ge(18,"ion-item")(19,"ion-input",44),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.item.AddressInfo.AccessComments,_)||(o.item.AddressInfo.AccessComments=_),ut(_)}),ve()(),ge(20,"ion-item")(21,"ion-input",45),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.item.AddressInfo.RelatedURL,_)||(o.item.AddressInfo.RelatedURL=_),ut(_)}),ve()(),mn()}if(g&2){let u=Ve();be(),Ze("ngIf",u.validationMsg),be(4),Xt("ngModel",u.item.StatusTypeID),be(),Ze("ngForOf",u.statusTypes),be(2),Xt("ngModel",u.item.UsageTypeID),be(),Ze("ngForOf",u.usageTypes),be(2),Xt("ngModel",u.item.UsageCost),be(2),Xt("ngModel",u.item.GeneralComments),be(2),Xt("ngModel",u.item.AddressInfo.ContactTelephone1),be(2),Xt("ngModel",u.item.AddressInfo.ContactTelephone2),be(2),Xt("ngModel",u.item.AddressInfo.AccessComments),be(2),Xt("ngModel",u.item.AddressInfo.RelatedURL)}}function vA(g,m){if(g&1){let u=oi();ge(0,"ion-button",2),Dt("click",function(){ct(u);let _=Ve();return ut(_.previous())}),Le(1," Previous "),yt(2,"ion-icon",48),ve()}}function xA(g,m){if(g&1){let u=oi();ge(0,"ion-button",2),Dt("click",function(){ct(u);let _=Ve();return ut(_.next())}),Le(1," Next "),yt(2,"ion-icon",49),ve()}}function bA(g,m){if(g&1){let u=oi();ge(0,"ion-button",50),Dt("click",function(){ct(u);let _=Ve();return ut(_.save())}),Le(1," Submit "),yt(2,"ion-icon",51),ve()}}var mT=(()=>{class g{appManager;modalController;poiManager;mapping;loadingController;alertController;id;item;step;selectedTab;startPos;useFilteredConnectionTypes=!0;templateSites=[];nearbySites=[];selectedTemplatePOI=null;suggestedAddress=null;suggestedAddressAttribution=null;isNonDuplicateConfirmed=!1;skipPOICopy=!1;validationMsg=null;loading;editorMap;get countries(){return this.appManager.referenceDataManager.getCountries()}get usageTypes(){return this.appManager.referenceDataManager.getUsageTypes()}get statusTypes(){return this.appManager.referenceDataManager.getStatusTypes().filter(u=>u.IsUserSelectable==!0)}get isAddMode(){return this.item.ID<=0}constructor(u,x,_,o,C,B){this.appManager=u,this.modalController=x,this.poiManager=_,this.mapping=o,this.loadingController=C,this.alertController=B,this.initNewItem()}initNewItem(){this.item={ID:-1,DataProviderID:1,DataProvidersReference:null,OperatorsReference:null,OperatorID:1,UsageCost:null,UsageTypeID:4,NumberOfPoints:1,GeneralComments:null,DatePlanned:null,StatusTypeID:50,SubmissionStatusTypeID:null,Connections:[],MetadataValues:[],AddressInfo:{ID:-1,CountryID:18,Title:"",AddressLine1:"",Latitude:0,Longitude:0}},this.step="location",this.selectedTab="location"}get isReadyToSubmit(){return this.validate().isValid&&this.step=="info"}ngOnInit(){}presentLoadingUI(){return st(this,null,function*(){this.loading=yield this.loadingController.create({message:"Please Wait.."}),yield this.loading.present()})}dismissLoadingUI(){return st(this,null,function*(){this.loading&&(yield this.loading.dismiss())})}ionViewDidEnter(){if(this.id!=null)this.editExistingPOI(this.id);else{let u=localStorage.getItem("_editor-operatorid");u&&(this.item.OperatorID=parseInt(u,10)),this.startPos?(this.item.AddressInfo.Latitude=this.startPos.latitude,this.item.AddressInfo.Longitude=this.startPos.longitude):this.mapping&&this.mapping.getMapCenter().subscribe(x=>{x&&(this.item.AddressInfo.Latitude=x.coords.latitude,this.item.AddressInfo.Longitude=x.coords.longitude)})}this.refreshFilteredReferenceData()}previous(){return st(this,null,function*(){switch(this.step){case"info":this.step="edit-equipment";break;case"edit-equipment":this.step=this.isAddMode?"copy-equipment":"location";break;case"copy-equipment":this.step="location";break;case"poi-nearby":this.step="location";break}yield this.initCurrentStep(!1)})}next(){return st(this,null,function*(){if(this.step=="poi-nearby"&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed){(yield this.alertController.create({header:"Confirm",message:"Please confirm you are not adding a duplicate site.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:_=>{}},{text:"Confirm",handler:()=>{this.isNonDuplicateConfirmed=!0,this.next()}}]})).present();return}let u=this.validate(this.step);if(u.isValid){switch(this.step){case"location":this.step=this.isAddMode?"poi-nearby":"edit-equipment";break;case"poi-nearby":this.step=this.isAddMode?"copy-equipment":"edit-equipment";break;case"copy-equipment":this.step="edit-equipment";break;case"edit-equipment":this.step="info";break}yield this.initCurrentStep(!0)}else(yield this.alertController.create({message:u.msg})).present()})}initCurrentStep(u){return st(this,null,function*(){this.step=="poi-nearby"?(this.selectedTab="location",(yield this.refreshNearbySites())==0&&(u?yield this.next():yield this.previous())):this.step=="location"?this.selectedTab="location":this.step=="copy-equipment"?(this.selectedTab="equipment",yield this.refreshTemplateSites()):this.step=="edit-equipment"?this.selectedTab="equipment":this.step=="info"&&(this.selectedTab="info")})}onCountryChange(){return st(this,null,function*(){this.refreshFilteredReferenceData()})}onOperatorChange(u=null){return st(this,null,function*(){u!=null&&this.item.OperatorID!=u.ID&&(this.item.OperatorID=u.ID,localStorage.setItem("_editor-operatorid",this.item.OperatorID.toString()),yield this.refreshTemplateSites())})}useSuggestedAddress(u=null){u&&(this.suggestedAddress=u.suggestedAddress,this.suggestedAddressAttribution=u.suggestedAddressAttribution),Object.assign(this.item.AddressInfo,this.suggestedAddress),this.suggestedAddressAttribution&&(this.item.MetadataValues.find(x=>x.MetadataFieldID==4)||this.item.MetadataValues.push({ID:-1,MetadataFieldID:4,ItemValue:this.suggestedAddressAttribution,MetadataFieldOptionID:null,MetadataFieldOption:null}))}editConnection(u){return st(this,null,function*(){let x=this.item.Connections.find(C=>C.ID==u.ID),_=Object.assign({},x),o=yield this.modalController.create({component:I1,componentProps:{conn:_}});return o.onWillDismiss().then(C=>{C&&C.data&&C.data.item&&this.updateConnection(C.data.item)}),yield o.present()})}deleteConnection(u){return st(this,null,function*(){let x=this.item.Connections.find(o=>o.ID==u.ID);(yield this.alertController.create({header:"Confirm Delete",message:"Are you sure you want to delete this connection information?",buttons:[{text:"No",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"Yes",handler:()=>{this.item.Connections=this.item.Connections.filter(o=>o.ID!=x.ID),this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}}]})).present()})}addConnection(){return st(this,null,function*(){let u={ID:-uo.getRandomInt(1e4),ConnectionTypeID:null,StatusTypeID:50,PowerKW:null,Quantity:1},x=yield this.modalController.create({component:I1,componentProps:{conn:u}});return x.onWillDismiss().then(_=>{_&&_.data&&_.data.item&&this.updateConnection(_.data.item)}),yield x.present()})}refreshFilteredReferenceData(){this.appManager.referenceDataManager.refreshFilteredReferenceData(this.appManager.api,{CountryIds:[this.item.AddressInfo.CountryID]})}updateConnection(u){if(u){let x=this.item.Connections.find(_=>_.ID==u.ID);x?Object.assign(x,u):this.item.Connections.push(u)}this.appManager.referenceDataManager.hydrateCompactPOI(this.item,!0)}validate(u="all"){let x=null;return this.item==null?{isValid:!1,msg:"POI item is not defined"}:((u=="all"||u=="location")&&((!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(x="Location is required"),this.item.AddressInfo.Title==""&&(x="A location title is required"),!this.item.AddressInfo.AddressLine1&&!this.item.AddressInfo.AddressLine2&&(x="An approximate address is required."),this.item.AddressInfo.CountryID||(x="A country selection is required"),(!this.item.AddressInfo.Latitude||!this.item.AddressInfo.Longitude)&&(x="A location latitude and longitude is required")),(u=="all"||u=="poi-nearby")&&this.nearbySites.length>0&&!this.isNonDuplicateConfirmed&&(x="Please confirm that the site is not a duplicate"),(u=="all"||u=="equipment")&&(this.item.OperatorID||(x="Please confirm the charging network or equipment operator."),this.item.Connections.length==0&&(x="Equipment information is required")),x?(this.validationMsg=x,{isValid:!1,msg:x}):(this.validationMsg=null,{isValid:!0,msg:null}))}save(){return st(this,null,function*(){let u=this.validate();if(!u.isValid){alert(u.msg);return}yield this.presentLoadingUI();try{yield this.appManager.submitPOI(this.item),yield this.dismissLoadingUI(),this.appManager.showToastNotification("You submission will be reviewed (if required) and published shortly."),this.modalController.dismiss()}catch(x){yield this.dismissLoadingUI(),x.error&&alert("Sorry, your submission could not be completed at this time. Please try again later.")}})}cancel(){return st(this,null,function*(){this.modalController.dismiss()})}refreshTemplateSites(){return st(this,null,function*(){if(this.item.AddressInfo.CountryID&&this.item.OperatorID){yield this.presentLoadingUI(),this.templateSites=[];let u=new qh;u.countryIdList=[this.item.AddressInfo.CountryID],u.minPowerKW=1,u.operatorIdList=[this.item.OperatorID],u.maxResults=10;let x=yield this.poiManager.fetchPOIList(u);x.sort((_,o)=>new Date(_.DateCreated).getTime()-new Date(o.DateCreated).getTime()),this.templateSites=x,this.dismissLoadingUI()}})}refreshNearbySites(){return st(this,null,function*(){if(this.item.AddressInfo.Latitude&&this.item.AddressInfo.Longitude){yield this.presentLoadingUI(),this.nearbySites=[];let u=new qh;u.latitude=this.item.AddressInfo.Latitude,u.longitude=this.item.AddressInfo.Longitude,u.distance=5,u.distanceUnit="km",u.maxResults=10;let x=yield this.poiManager.fetchPOIList(u);return x.sort((_,o)=>_.Distance-o.Distance),this.nearbySites=x,this.dismissLoadingUI(),x.length}else return 0})}confirmNonDuplicate(){this.isNonDuplicateConfirmed=!0,this.next()}changeTemplatePOI(){this.selectedTemplatePOI=null}editPOI(u){this.editExistingPOI(u.ID)}editExistingPOI(u){return st(this,null,function*(){this.skipPOICopy=!0,this.isNonDuplicateConfirmed=!0,yield this.presentLoadingUI(),this.poiManager.getPOIById(u,!0,!0).then(x=>{this.item=Object.assign({},x),this.item.OperatorID==null&&(this.item.OperatorID=C1.UnknownOperator),this.refreshFilteredReferenceData(),this.dismissLoadingUI()})})}useTemplatePOI(u){this.selectedTemplatePOI=u,Object.assign(this.item.Connections,u.Connections);for(let x of this.item.Connections)x.ID=-uo.getRandomInt(1e4),x.Reference=null,x.Comments=null,x.StatusTypeID=P1.Operational;this.item.UsageCost=u.UsageCost,this.item.UsageTypeID=u.UsageTypeID,this.appManager.referenceDataManager.hydrateCompactPOI(this.item)}skipCopyingPOI(){this.skipPOICopy=!0}static \u0275fac=function(x){return new(x||g)(Rt(Ps),Rt(Ss),Rt(om),Rt(wm),Rt(Nh),Rt(Qg))};static \u0275cmp=lr({type:g,selectors:[["app-poi-editor"]],viewQuery:function(x,_){if(x&1&&z1(vy,5),x&2){let o;R1(o=F1())&&(_.editorMap=o.first)}},standalone:!1,decls:33,vars:14,consts:[["editorMap",""],["slot","end"],[3,"click"],["name","close","slot","start"],[1,"ion-padding"],[3,"ngModel"],["value","location","layout","icon-start",3,"disabled"],["name","caret-forward",4,"ngIf"],["value","equipment","layout","icon-start",3,"disabled"],["value","info","layout","icon-start",3,"disabled"],[4,"ngIf"],["slot","start"],[3,"click",4,"ngIf"],["color","success",3,"click",4,"ngIf"],["name","caret-forward"],[3,"latitudeChange","longitudeChange","onUseSuggestedAddress","latitude","longitude"],["label","Location Name","label-placement","floating","type","text","autocapitalize","words","placeholder","A title for this location",3,"ngModelChange","ngModel"],["label","Address Line 1","label-placement","floating","type","text","autocapitalize","words","placeholder","The nearest street address",3,"ngModelChange","ngModel"],["label","Address Line 2","label-placement","floating","type","text","autocapitalize","words","placeholder","Optional",3,"ngModelChange","ngModel"],["label","Town","label-placement","floating","type","text","autocapitalize","words","placeholder","Town or City",3,"ngModelChange","ngModel"],["label","State or Province","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","Postal Code","label-placement","floating","type","text","autocapitalize","words","placeholder","Optional Postal Code",3,"ngModelChange","ngModel"],["label","Country","label-placement","floating",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["label","Latitude","labelPlacement","floating","type","number","placeholder","Latitude (if entering manually)",3,"ngModelChange","ngModel"],["label","Longitude","labelPlacement","floating","type","number","placeholder","Longitude (if entering manually)",3,"ngModelChange","ngModel"],[3,"value"],[1,"instruction"],[3,"onEdit","poiList","enableEditOption"],[3,"operatorChanged","operatorId"],["slot","start","size","small",3,"click"],[3,"onCopy","enableCopyOption","poiList"],[3,"operatorChanged","operatorId","useFilteredOperators"],["label","Number of Stations or Parking Bays","labelPlacement","floating","min","1","type","number",3,"ngModelChange","ngModel"],["size","small",3,"click"],["name","add","slot","icon-only"],[3,"onEdit","onDelete","item","enableEdit"],["color","warning",4,"ngIf"],["label","Operational Status (All Equipment)","label-placement","floating",3,"ngModelChange","ngModel"],["label","Usage Type","label-placement","floating",3,"ngModelChange","ngModel"],["label","Usage Cost","label-placement","floating","type","text",3,"ngModelChange","ngModel"],["label","General Comments","label-placement","floating","type","text","autocapitalize","sentences",3,"ngModelChange","ngModel"],["label","Main Telephone Number","label-placement","floating","type","tel","placeholder","",3,"ngModelChange","ngModel"],["label","Other Telephone Number","label-placement","floating","type","tel","placeholder","",3,"ngModelChange","ngModel"],["label","Access Comments","label-placement","floating","type","text","autocapitalize","sentences","placeholder","Instructions for access or tips for finding charging location",3,"ngModelChange","ngModel"],["label","Related Website","label-placement","floating","type","url","placeholder","Website related to this site",3,"ngModelChange","ngModel"],["color","warning"],["color","danger"],["name","caret-back","slot","start"],["name","caret-forward","slot","end"],["color","success",3,"click"],["name","send","slot","end"]],template:function(x,_){x&1&&(ge(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),Le(3),ve(),ge(4,"ion-buttons",1)(5,"ion-button",2),Dt("click",function(){return _.cancel()}),yt(6,"ion-icon",3),Le(7," Cancel "),ve()()()(),ge(8,"ion-content",4),dn(9),ge(10,"ion-segment",5)(11,"ion-segment-button",6),Et(12,QE,1,0,"ion-icon",7),ge(13,"ion-label"),Le(14,"Location"),ve()(),ge(15,"ion-segment-button",8),Et(16,eA,1,0,"ion-icon",7),ge(17,"ion-label"),Le(18,"Equipment"),ve()(),ge(19,"ion-segment-button",9),Et(20,tA,1,0,"ion-icon",7),ge(21,"ion-label"),Le(22,"Info"),ve()()(),Et(23,oA,3,2,"ng-container",10)(24,mA,3,2,"ng-container",10)(25,yA,22,11,"ng-container",10),mn(),ve(),ge(26,"ion-footer")(27,"ion-toolbar")(28,"ion-buttons",11),Et(29,vA,3,0,"ion-button",12),ve(),ge(30,"ion-buttons",1),Et(31,xA,3,0,"ion-button",12)(32,bA,3,0,"ion-button",13),ve()()()),x&2&&(be(3),Ht(_.isAddMode?"Add Location":"Edit Location"),be(7),Ze("ngModel",_.selectedTab),be(),Ze("disabled",!0),be(),Ze("ngIf",_.selectedTab=="location"),be(3),Ze("disabled",!0),be(),Ze("ngIf",_.selectedTab=="equipment"),be(3),Ze("disabled",!0),be(),Ze("ngIf",_.selectedTab=="info"),be(3),Ze("ngIf",_.selectedTab=="location"),be(),Ze("ngIf",_.selectedTab=="equipment"),be(),Ze("ngIf",_.selectedTab=="info"),be(4),Ze("ngIf",_.step!="location"),be(2),Ze("ngIf",!_.isReadyToSubmit&&_.step!="info"),be(),Ze("ngIf",_.isReadyToSubmit))},dependencies:[Vo,Or,Go,Zo,wr,Da,Bl,Ol,jl,Tr,Ts,jr,qo,za,Qd,em,mu,fu,Ul,Ra,Hd,ws,La,Jg,hT,xy,vy,dT],styles:['ul.breadcrumb[_ngcontent-%COMP%]{display:inline-flex;margin:0;padding:0}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:inline-flex;margin-right:6px;color:var(--ion-color-light-shade);font-size:10px}ul.breadcrumb[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{color:var(--ion-color-dark-shade)}ul.breadcrumb[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:">";padding-right:4px}']})}return g})();function wA(g,m){g&1&&(ge(0,"div"),yt(1,"ion-spinner"),ve())}function TA(g,m){if(g&1){let u=oi();ge(0,"ion-item",5),Dt("click",function(){let _=ct(u).$implicit,o=Ve(2);return ut(o.placeSelected(_))}),ge(1,"ion-avatar",6),yt(2,"ion-icon",7),ve(),ge(3,"ion-label")(4,"p"),Le(5),ve()()()}if(g&2){let u=m.$implicit;be(5),Ht(u.Address)}}function SA(g,m){if(g&1&&(ge(0,"div",1),Et(1,wA,2,0,"div",2),ge(2,"ion-list"),Et(3,TA,6,1,"ion-item",3),ge(4,"ion-item")(5,"p",4),Le(6),ve()()()()),g&2){let u=Ve();be(),Ze("ngIf",u.searchInProgress),be(2),Ze("ngForOf",u.placeList),be(3),Ut(" ",u.placeAttribution," ")}}var fT=(()=>{class g{logging;changeDetector;platform;http;events;placeSearchType;placeList;searchInProgress=!1;searchKeyword;placeSearchFocused;placeSearchActive=!1;placeAttribution="";selectedPlace;placeChanged=new Ma;mapService;constructor(u,x,_,o,C){this.logging=u,this.changeDetector=x,this.platform=_,this.http=o,this.events=C,this.searchKeyword="",this.searchInProgress=!1,this.mapService=new bm(C,u,o)}ngOnInit(){return st(this,null,function*(){yield this.platform.ready(),this.mapService.initAPI()})}onSearchFocus(){this.placeSearchFocused=!0}onSearchBlur(){this.placeSearchFocused=!1}onSearchCancel(){}getPlacesAutoComplete(u,x){return st(this,null,function*(){this.placeSearchType=x;let _=u.target.value;if(_&&_.length>3){this.logging.log("Starting place lookup for:"+_),this.placeSearchActive=!0,this.searchInProgress=!0,this.searchInProgress=!1,this.placeSearchActive=!0;try{this.placeList=yield this.mapService.placeSearch(_),this.placeList&&this.placeList.length>0&&(this.placeAttribution=this.placeList[0].Attribution);let o=yield this.detectAlternativeSearchResultType(_);o&&this.placeList.unshift(o)}catch{}this.searchInProgress=!1,this.placeSearchActive=!0}else this.searchInProgress=!1,this.placeSearchActive=!1})}ConvertDMSToDD(u,x,_,o){var C=Number(u)+Number(x)/60+Number(_)/3600;return(o=="S"||o=="W")&&(C=C*-1),C}ParseDMS(u){try{var x=u.split(/[^\d\w\.]+/),_=this.ConvertDMSToDD(x[0],x[1],x[2],x[3]),o=this.ConvertDMSToDD(x[4],x[5],x[6],x[7]);return new Un(_,o)}catch{return null}}detectAlternativeSearchResultType(u){return st(this,null,function*(){if(u=u.trim(),u.startsWith("OCM-")&&(u=u.replace("OCM-","")),Number.isInteger(Number(u))){let o=new su;return o.Title="Go to OCM ID",o.Address="OCM-"+u,o.ReferenceID="OCM-"+u,o}let x=u.match(/^\s*((lat|latitude)(:)?)?\s*((\-)?[0-9]+\.[0-9]+)\s*(,?)\s*((lng|lon|longitude)(:)?)?\s*((\-)?[0-9]+\.[0-9]+)\s*$/gi);if(x&&x.length>0){let C=(""+u.match(/((\-)?[0-9]+\.[0-9]+)+/g)).split(","),B=new su;return B.Title="Go to Lat/Lng",B.Address="Lat:"+C[0]+", Lng:"+C[1],B.Location=new Un(parseFloat(C[0]),parseFloat(C[1])),B}else{var _=this.ParseDMS(u);if(_&&!isNaN(_.latitude)&&!isNaN(_.longitude)){let o=new su;return o.Title="Go to Lat/Lng",o.Address="Lat:"+_.latitude+", Lng:"+_.longitude,o.Location=_,o}else return null}})}placeSelected(u){let x=u.Title;this.logging.log("Looking up place details:"+x+"::"+u.ReferenceID),this.selectedPlace=u,this.placeChanged.emit(u),this.placeSearchActive=!1}static \u0275fac=function(x){return new(x||g)(Rt(bn),Rt(jh),Rt(Zd),Rt($o),Rt(Ba))};static \u0275cmp=lr({type:g,selectors:[["place-search"]],inputs:{searchKeyword:"searchKeyword"},outputs:{selectedPlace:"selectedPlace",placeChanged:"placeChanged"},standalone:!1,decls:1,vars:1,consts:[["class","place-search",4,"ngIf"],[1,"place-search"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],[1,"place-attribution"],[3,"click"],["item-left",""],["name","locate"]],template:function(x,_){x&1&&Et(0,SA,7,3,"div",0),x&2&&Ze("ngIf",_.placeSearchActive)},dependencies:[Vo,Or,Uh,Tr,jr,qo,za,Yg],styles:[".place-search[_ngcontent-%COMP%]{position:absolute;z-index:1000}.place-attribution[_ngcontent-%COMP%]{font-size:9px;color:#dcdcdc;max-width:100%}"]})}return g})();function PA(g,m){if(g&1){let u=oi();ge(0,"ion-card")(1,"ion-toolbar")(2,"ion-title",14),Le(3,"Preview"),ve(),ge(4,"ion-buttons",15)(5,"ion-button",5),Dt("click",function(){ct(u);let _=Ve();return ut(_.rotateImage())}),yt(6,"ion-icon",16),ge(7,"ion-label"),Le(8,"Rotate"),ve()()()(),ge(9,"ion-card-content")(10,"ion-list")(11,"ion-item")(12,"ion-label",17),Le(13,"Comment"),ve(),ge(14,"ion-input",18),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.comment,_)||(o.comment=_),ut(_)}),ve()()(),yt(15,"img",19),ve()()}if(g&2){let u=Ve();be(14),Xt("ngModel",u.comment)}}var gT=(()=>{class g{navParams;appManager;nav;modalController;logging;mode;processingQuality;imgData;targetWidth;targetHeight;comment;chargePointId;poi;constructor(u,x,_,o,C){this.navParams=u,this.appManager=x,this.nav=_,this.modalController=o,this.logging=C,this.processingQuality=.8,this.targetWidth=1024,this.targetHeight=800,this.mode=x.platformMode,this.chargePointId=this.navParams.get("id"),this.poi=this.navParams.get("poi"),this.comment=""}processNativeImageSource(u){let x=u,_=document.getElementById("img-upload-canvas"),o=_.getContext("2d"),C=new Image;C.onload=()=>{this.logging.log("img load:"+C.width),_.width=C.width,_.height=C.height,o.fillStyle="rgb(0,0,0)",o.fillRect(0,0,_.width,_.height),o.drawImage(C,0,0,_.width,_.height),this.imgData=_.toDataURL("image/png"),this.processImage()},C.src=x}loadCameraOrLibraryImage(u=!1){this.logging.log("PWA mode: fetching image");let x=new FileReader;x.onload=()=>{this.imgData=x.result,this.processImage()},x.onerror=()=>{},x.readAsDataURL(document.getElementById("img-upload-media").files[0])}isBrowserMode(){return this.appManager.isPlatform("desktop")||this.appManager.isPlatform("hybrid")}processImage(){let u=this;if(this.imgData!=null){let x=document.getElementById("img-upload-canvas"),_=x.getContext("2d"),o=new Image;o.onload=()=>{x.width=o.width,x.height=o.height,_.fillStyle="rgb(0,0,0)",_.fillRect(0,0,x.width,x.height),_.drawImage(o,0,0,x.width,x.height),this.refreshImageFromCanvas()},o.src=this.imgData}else this.logging.log("processImage: nothing to process.")}refreshImageFromCanvas(){let u=document.getElementById("img-upload-canvas");this.imgData=u.toDataURL("image/jpeg",.8),document.getElementById("preview").src=this.imgData}rotateImage(){let u=document.getElementById("img-upload-canvas"),x=new Image;x.src=u.toDataURL(),x.onload=()=>{let _=u.height,o=u.width;u.width=_,u.height=o,_=u.height,o=u.width;let C=u.getContext("2d");C.save(),C.translate(o,_/o),C.rotate(Math.PI/2),C.drawImage(x,0,0),C.restore(),x=null,this.refreshImageFromCanvas()}}performUpload(){return st(this,null,function*(){if(!this.imgData){yield this.appManager.showToastNotification("Select an image to upload.");return}let u={chargePointID:this.chargePointId,comment:this.comment,imageDataBase64:this.imgData};yield this.appManager.showLoadingProgress("Uploading photo..");try{let x=yield this.appManager.submitMediaItem(u);this.appManager.dismissLoadingProgress().then(()=>{this.appManager.showToastNotification("Upload completed"),this.modalController.dismiss()}),this.appManager.analytics.appEvent("MediaUpload","Completed")}catch{yield this.appManager.dismissLoadingProgress(),yield this.appManager.showToastNotification("Upload failed, please try again."),this.appManager.analytics.appEvent("MediaUpload","Failed")}})}cancel(){return st(this,null,function*(){yield this.modalController.dismiss()})}static \u0275fac=function(x){return new(x||g)(Rt(Wd),Rt(Ps),Rt(qd),Rt(Ss),Rt(bn))};static \u0275cmp=lr({type:g,selectors:[["ng-component"]],standalone:!1,decls:32,vars:3,consts:[["inputFile",""],[1,"media-upload"],[1,"ion-padding"],[1,"banner"],[1,"upload"],[3,"click"],["name","camera","aria-label","camera","slot","start"],["type","file","required","","id","img-upload-media",3,"change"],["id","img-upload-canvas",2,"display","none","width","500","height","500","border","1px solid red"],[4,"ngIf"],["slot","secondary"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],["slot","start"],["slot","end"],["name","refresh","slot","start"],["position","floating"],["type","text","placeholder","(optional comment)",3,"ngModelChange","ngModel"],["id","preview",2,"max-width","500px"]],template:function(x,_){if(x&1){let o=oi();ge(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),Le(3," Share Photo "),ve()()(),ge(4,"ion-content",1)(5,"div",2)(6,"div",3)(7,"h1"),Le(8),ve(),ge(9,"p"),Le(10),ve()(),ge(11,"p"),Le(12,"You can upload a photo from your device or take a new photo: "),ve(),ge(13,"div",4)(14,"ion-button",5),Dt("click",function(){ct(o);let B=bd(19);return ut(B.click())}),yt(15,"ion-icon",6),ge(16,"ion-label"),Le(17,"Choose Photo.."),ve()(),ge(18,"input",7,0),Dt("change",function(){return ct(o),ut(_.loadCameraOrLibraryImage())}),ve()(),yt(20,"canvas",8),Et(21,PA,16,1,"ion-card",9),ve()(),ge(22,"ion-footer")(23,"ion-toolbar")(24,"ion-buttons",10)(25,"ion-button",5),Dt("click",function(){return ct(o),ut(_.cancel())}),yt(26,"ion-icon",11),Le(27," Cancel "),ve()(),ge(28,"ion-buttons",12)(29,"ion-button",5),Dt("click",function(){return ct(o),ut(_.performUpload())}),Le(30," Upload "),yt(31,"ion-icon",13),ve()()()()}x&2&&(be(8),Ht(_.poi.AddressInfo.Title),be(2),Ht(_.poi.AddressInfo.AddressLine1),be(11),Ze("ngIf",_.imgData!=null))},dependencies:[Or,Go,Zo,wr,Da,Hg,Xg,Bl,Ol,jl,Tr,Ts,jr,qo,za,Ul,Ra,La],styles:[".upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:fixed;top:-1000px}"]})}return g})();function CA(g,m){if(g&1&&(ge(0,"ion-select-option",19),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}function MA(g,m){if(g&1&&(ge(0,"ion-select-option",19),Le(1),ve()),g&2){let u=m.$implicit;Ze("value",u.ID),be(),Ht(u.Title)}}var _T=(()=>{class g{navParams;appManager;nav;zone;loadingController;modalController;logging;router;commentModel;poi;commentTypes;checkinTypes;constructor(u,x,_,o,C,B,$,Y){this.navParams=u,this.appManager=x,this.nav=_,this.zone=o,this.loadingController=C,this.modalController=B,this.logging=$,this.router=Y,this.commentModel={ChargePointID:this.navParams.get("id"),Comment:"",CheckinStatusTypeID:10,CommentTypeID:10,Rating:null},this.poi=this.navParams.get("poi"),this.commentTypes=x.referenceDataManager.getCommentTypes(!0,!0),this.checkinTypes=x.referenceDataManager.getCheckinStatusTypes(!0,!0)}onPageWillEnter(){}cancel(){this.modalController.dismiss()}add(){return st(this,null,function*(){let u=yield this.loadingController.create({message:"Sending .."});yield u.present(),(yield this.appManager.submitComment(this.commentModel).catch(_=>{this.appManager.showToastNotification("There was a problem submitting your comment."),this.loadingController.dismiss(),this.appManager.analytics.appEvent("Comment","Failed")}))&&(this.logging.log("Comment submitted"),yield u.dismiss(),yield this.modalController.dismiss(),this.appManager.analytics.appEvent("Comment","Submitted"))})}static \u0275fac=function(x){return new(x||g)(Rt(Wd),Rt(Ps),Rt(qd),Rt(D1),Rt(Nh),Rt(Ss),Rt(bn),Rt(Gd))};static \u0275cmp=lr({type:g,selectors:[["ng-component"]],standalone:!1,decls:53,vars:8,consts:[["color","primary"],[1,"comment-page","ion-padding"],[1,"banner"],[1,"ion-padding"],["position","stacked"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","(optional comment)",3,"ngModelChange","ngModel"],["value","5"],["value","4"],["value","3"],["value","2"],["value","1"],["value",""],["slot","secondary"],[3,"click"],["name","close","slot","start"],["slot","primary"],["name","send","slot","end"],[3,"value"]],template:function(x,_){x&1&&(ge(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),Le(3," Add Comment "),ve()()(),ge(4,"ion-content",1)(5,"div",2)(6,"h1"),Le(7),ve(),ge(8,"p"),Le(9),ve()(),ge(10,"p",3),Le(11,"Recent Check-ins are a big help to other drivers when planning their journey. Tell everyone what you thought about this charging location. "),ve(),ge(12,"ion-list")(13,"ion-item")(14,"ion-label",4),Le(15,"Comment Type"),ve(),ge(16,"ion-select",5),Kt("ngModelChange",function(C){return Zt(_.commentModel.CommentTypeID,C)||(_.commentModel.CommentTypeID=C),C}),Et(17,CA,2,2,"ion-select-option",6),ve()(),ge(18,"ion-item")(19,"ion-label",4),Le(20,"What Did You Think?"),ve(),ge(21,"ion-input",7),Kt("ngModelChange",function(C){return Zt(_.commentModel.Comment,C)||(_.commentModel.Comment=C),C}),ve()(),ge(22,"ion-item")(23,"ion-label",4),Le(24,"Did You Successfully Charge?"),ve(),ge(25,"ion-select",5),Kt("ngModelChange",function(C){return Zt(_.commentModel.CheckinStatusTypeID,C)||(_.commentModel.CheckinStatusTypeID=C),C}),Et(26,MA,2,2,"ion-select-option",6),ve()(),ge(27,"ion-item")(28,"ion-label",4),Le(29,"Your Rating"),ve(),ge(30,"ion-select",5),Kt("ngModelChange",function(C){return Zt(_.commentModel.Rating,C)||(_.commentModel.Rating=C),C}),ge(31,"ion-select-option",8),Le(32,"5 - Excellent"),ve(),ge(33,"ion-select-option",9),Le(34,"4 - Good"),ve(),ge(35,"ion-select-option",10),Le(36,"3 - Average"),ve(),ge(37,"ion-select-option",11),Le(38,"2 - Not Good"),ve(),ge(39,"ion-select-option",12),Le(40,"1 - Bad"),ve(),ge(41,"ion-select-option",13),Le(42,"Not Rated"),ve()()()()(),ge(43,"ion-footer")(44,"ion-toolbar")(45,"ion-buttons",14)(46,"ion-button",15),Dt("click",function(){return _.cancel()}),yt(47,"ion-icon",16),Le(48," Cancel "),ve()(),ge(49,"ion-buttons",17)(50,"ion-button",15),Dt("click",function(){return _.add()}),Le(51," Submit "),yt(52,"ion-icon",18),ve()()()()),x&2&&(be(7),Ht(_.poi.AddressInfo.Title),be(2),Ht(_.poi.AddressInfo.AddressLine1),be(7),Xt("ngModel",_.commentModel.CommentTypeID),be(),Ze("ngForOf",_.commentTypes),be(4),Xt("ngModel",_.commentModel.Comment),be(4),Xt("ngModel",_.commentModel.CheckinStatusTypeID),be(),Ze("ngForOf",_.checkinTypes),be(4),Xt("ngModel",_.commentModel.Rating))},dependencies:[Vo,Go,Zo,wr,Da,Bl,Ol,jl,Tr,Ts,jr,qo,za,mu,fu,Ul,Ra,ws,La],encapsulation:2})}return g})();var by=class{baseURL;loginProviderRedirectBaseURL;loginProviderRedirectURL;enableLiveMapQuerying;googleMapsAPIKey;enableStaticMaps;constructor(){this.baseURL="https://map.openchargemap.io",this.loginProviderRedirectBaseURL="https://openchargemap.org/site/loginprovider/?_mode=silent&_forceLogin=true&_redirectURL=",this.loginProviderRedirectURL=this.loginProviderRedirectBaseURL+this.baseURL,this.enableLiveMapQuerying=!0,this.googleMapsAPIKey=Ea.googleMapsKey,this.enableStaticMaps=Ea.enableStaticMaps}};function EA(g,m){if(g&1&&(ge(0,"div")(1,"small"),Le(2),ve()()),g&2){let u=Ve(2);be(2),Ht(u.connectionSummary)}}function AA(g,m){if(g&1&&(ge(0,"div")(1,"small"),Le(2),ve()()),g&2){let u=Ve(2);be(2),Ht(u.poi.OperatorInfo.Title)}}function kA(g,m){g&1&&(ge(0,"div")(1,"small"),Le(2,"[Submission Awaiting Review]"),ve()())}function LA(g,m){if(g&1){let u=oi();dn(0),ge(1,"ion-button",30),Dt("click",function(){ct(u);let _=Ve(2);return ut(_.addFavourite())}),yt(2,"ion-icon",31),ge(3,"ion-label"),Le(4,"Favourite"),ve()(),ge(5,"ion-button",32),Dt("click",function(){ct(u);let _=Ve(2);return ut(_.edit())}),yt(6,"ion-icon",33),ge(7,"ion-label"),Le(8,"Edit"),ve()(),mn()}}function DA(g,m){if(g&1){let u=oi();dn(0),ge(1,"ion-button",34),Dt("click",function(){ct(u);let _=Ve(2);return ut(_.launchNavigation())}),yt(2,"ion-icon",35),ge(3,"ion-label"),Le(4,"Navigate"),ve()(),mn()}}function zA(g,m){if(g&1){let u=oi();dn(0),ge(1,"ion-button",36),Dt("click",function(){ct(u);let _=Ve(2);return ut(_.addComment())}),yt(2,"ion-icon",37),ge(3,"ion-label"),Le(4,"Add Comment"),ve()(),mn()}}function RA(g,m){if(g&1){let u=oi();dn(0),ge(1,"ion-button",38),Dt("click",function(){ct(u);let _=Ve(2);return ut(_.addMedia())}),yt(2,"ion-icon",39),ge(3,"ion-label"),Le(4," Add Photo"),ve()(),mn()}}function FA(g,m){if(g&1&&(ge(0,"div"),Le(1),ve()),g&2){let u=Ve(4);be(),Ut(" ",u.poi.AddressInfo.AddressLine1)}}function BA(g,m){if(g&1&&(ge(0,"div"),Le(1),ve()),g&2){let u=Ve(4);be(),Ut(" ",u.poi.AddressInfo.AddressLine2)}}function OA(g,m){if(g&1&&(ge(0,"div"),Le(1),ve()),g&2){let u=Ve(4);be(),Ut(" ",u.poi.AddressInfo.Town)}}function jA(g,m){if(g&1&&(ge(0,"div"),Le(1),ve()),g&2){let u=Ve(4);be(),Ut(" ",u.poi.AddressInfo.StateOrProvince)}}function UA(g,m){if(g&1&&(ge(0,"div"),Le(1),ve()),g&2){let u=Ve(4);be(),Ut(" ",u.poi.AddressInfo.Postcode)}}function NA(g,m){if(g&1&&(ge(0,"div"),Le(1),ve()),g&2){let u=Ve(4);be(),Ut(" ",u.poi.AddressInfo.Country.Title)}}function VA(g,m){if(g&1&&(ge(0,"p"),Le(1),ve()),g&2){let u=Ve(4);be(),Ut(" ",u.poi.AddressInfo.AccessComments," ")}}function $A(g,m){if(g&1&&(ge(0,"p"),yt(1,"ion-icon",44),ge(2,"span",42),Le(3),ve()()),g&2){let u=Ve(4);be(3),Ht(u.poi.AddressInfo.ContactTelephone1)}}function GA(g,m){if(g&1&&(ge(0,"p"),yt(1,"ion-icon",44),ge(2,"span",42),Le(3),ve()()),g&2){let u=Ve(4);be(3),Ht(u.poi.AddressInfo.ContactTelephone2)}}function ZA(g,m){if(g&1&&(ge(0,"p"),yt(1,"ion-icon",45),ge(2,"span",42),Le(3),ve()()),g&2){let u=Ve(4);be(3),Ht(u.poi.AddressInfo.ContactEmail)}}function qA(g,m){if(g&1&&(ge(0,"p"),yt(1,"ion-icon",46),ge(2,"span",42)(3,"a",47),Le(4),ve()()()),g&2){let u=Ve(4);be(3),Ze("href",wd(u.poi.AddressInfo.RelatedURL),xd),be(),Ht(u.poi.AddressInfo.RelatedURL)}}function WA(g,m){if(g&1&&(ge(0,"ion-card")(1,"ion-card-header")(2,"ion-card-subtitle"),Le(3),vr(4,"translate"),ve()(),ge(5,"ion-card-content")(6,"ion-grid")(7,"ion-row")(8,"ion-col")(9,"ion-label"),Le(10),vr(11,"translate"),ve(),ge(12,"div",42),Et(13,FA,2,1,"div",0)(14,BA,2,1,"div",0)(15,OA,2,1,"div",0)(16,jA,2,1,"div",0)(17,UA,2,1,"div",0)(18,NA,2,1,"div",0),ve()(),ge(19,"ion-col"),Et(20,VA,2,1,"p",0)(21,$A,4,1,"p",0)(22,GA,4,1,"p",0)(23,ZA,4,1,"p",0)(24,qA,5,3,"p",0),ve()(),ge(25,"ion-row")(26,"ion-col")(27,"ion-label",43),Le(28),vr(29,"number"),vr(30,"number"),ve()()()()()()),g&2){let u=Ve(3);be(3),Ut(" ",No(4,15,"ocm.details.location.sectionTitle")," "),be(7),Ut(" ",No(11,17,"ocm.details.location.address")),be(3),Ze("ngIf",u.poi.AddressInfo.AddressLine1),be(),Ze("ngIf",u.poi.AddressInfo.AddressLine2),be(),Ze("ngIf",u.poi.AddressInfo.Town),be(),Ze("ngIf",u.poi.AddressInfo.StateOrProvince),be(),Ze("ngIf",u.poi.AddressInfo.Postcode),be(),Ze("ngIf",u.poi.AddressInfo.Country),be(2),Ze("ngIf",u.poi.AddressInfo.AccessComments),be(),Ze("ngIf",u.poi.AddressInfo.ContactTelephone1),be(),Ze("ngIf",u.poi.AddressInfo.ContactTelephone2),be(),Ze("ngIf",u.poi.AddressInfo.ContactEmail),be(),Ze("ngIf",u.poi.AddressInfo.RelatedURL),be(4),B1(" Lat/Long: ",Td(29,19,u.poi.AddressInfo.Latitude,"1.1-6")," , ",Td(30,22,u.poi.AddressInfo.Longitude,"1.1-6")," ")}}function HA(g,m){if(g&1&&(ge(0,"p")(1,"span",48),Le(2),vr(3,"translate"),ve(),ge(4,"span",42),Le(5),ve()()),g&2){let u=Ve(3);be(2),Ut("",No(3,2,"ocm.details.numberOfPoints"),":"),be(3),Ht(u.poi.NumberOfPoints)}}function XA(g,m){if(g&1&&(ge(0,"p")(1,"span",48),Le(2),vr(3,"translate"),ve(),ge(4,"span",42),Le(5),ve()()),g&2){let u=Ve(3);be(2),Ut("",No(3,2,"ocm.details.operationalStatus"),":"),be(3),Ut(" ",u.poi.StatusType.Title," ")}}function KA(g,m){if(g&1&&(ge(0,"p")(1,"span",48),Le(2),vr(3,"translate"),ve(),ge(4,"span",42),Le(5),ve()()),g&2){let u=Ve(3);be(2),Ut("",No(3,2,"ocm.details.usageType"),":"),be(3),Ht(u.poi.UsageType.Title)}}function YA(g,m){if(g&1&&(ge(0,"p")(1,"span",48),Le(2),vr(3,"translate"),ve(),ge(4,"span",42),Le(5),ve()()),g&2){let u=Ve(3);be(2),Ut("",No(3,2,"ocm.details.usageCost"),":"),be(3),Ut(" ",u.poi.UsageCost)}}function JA(g,m){if(g&1&&(ge(0,"p"),yt(1,"br"),Le(2),vr(3,"translate"),yt(4,"br"),ge(5,"span",42),Le(6),ve()()),g&2){let u=Ve(3);be(2),Ut("",No(3,2,"ocm.details.generalComments"),": "),be(4),Ht(u.poi.GeneralComments)}}function QA(g,m){if(g&1&&(ge(0,"p"),yt(1,"ion-icon",50),Le(2),ve()),g&2){let u=Ve(4);be(2),Ut(" ",u.poi.OperatorInfo.WebsiteURL," ")}}function ek(g,m){if(g&1&&(ge(0,"p"),yt(1,"ion-icon",45),Le(2),ve()),g&2){let u=Ve(4);be(2),Ut(" ",u.poi.OperatorInfo.ContactEmail," ")}}function tk(g,m){if(g&1&&(ge(0,"p"),yt(1,"ion-icon",45),Le(2),ve()),g&2){let u=Ve(4);be(2),Ut(" ",u.poi.OperatorInfo.FaultReportEmail," ")}}function ik(g,m){if(g&1&&(ge(0,"ion-card")(1,"ion-card-header")(2,"ion-card-subtitle"),Le(3),vr(4,"translate"),ve()(),ge(5,"ion-card-content")(6,"div",42)(7,"p",49),Le(8),ve(),Et(9,QA,3,1,"p",0)(10,ek,3,1,"p",0)(11,tk,3,1,"p",0),ve()()()),g&2){let u=Ve(3);be(3),Ut(" ",No(4,5,"ocm.details.operator.sectionTitle")," "),be(5),Ut(" ",u.poi.OperatorInfo.Title," "),be(),Ze("ngIf",u.poi.OperatorInfo.WebsiteURL),be(),Ze("ngIf",u.poi.OperatorInfo.ContactEmail!=null),be(),Ze("ngIf",u.poi.OperatorInfo.FaultReportEmail!=null&&u.poi.OperatorInfo.FaultReportEmail!=u.poi.OperatorInfo.ContactEmail)}}function nk(g,m){if(g&1){let u=oi();ge(0,"a",52),Dt("click",function(){ct(u);let _=Ve(4);return ut(_.launchURL(_.poi.DataProvider.WebsiteURL))}),Le(1),ve()}if(g&2){let u=Ve(4);be(),Ht(u.poi.DataProvider.WebsiteURL)}}function rk(g,m){if(g&1&&(ge(0,"div",42)(1,"h3"),Le(2),vr(3,"translate"),ve(),ge(4,"p"),Le(5),ve(),Et(6,nk,2,1,"a",51),ge(7,"p"),Le(8),ve()()),g&2){let u=Ve(3);be(2),Ut(" ",No(3,4,"ocm.details.dataProvider.sectionTitle")," "),be(3),Ht(u.poi.DataProvider==null?null:u.poi.DataProvider.Title),be(),Ze("ngIf",u.poi.DataProvider.WebsiteURL),be(2),Ht(u.poi.DataProvider==null?null:u.poi.DataProvider.License)}}function ok(g,m){if(g&1&&(ge(0,"div"),Et(1,WA,31,25,"ion-card",0),ge(2,"ion-card")(3,"ion-card-header")(4,"ion-card-subtitle"),Le(5),vr(6,"translate"),ve()(),ge(7,"ion-card-content"),Et(8,HA,6,4,"p",0),yt(9,"app-equipment-details",40),ve()(),ge(10,"ion-card")(11,"ion-card-header")(12,"ion-card-subtitle"),Le(13,"Usage Restrictions"),ve()(),ge(14,"ion-card-content"),Et(15,XA,6,4,"p",0)(16,KA,6,4,"p",0)(17,YA,6,4,"p",0)(18,JA,7,4,"p",0),ve()(),Et(19,ik,12,7,"ion-card",0),ge(20,"ion-card")(21,"ion-card-header"),Le(22),vr(23,"translate"),ve(),ge(24,"ion-card-content"),Et(25,rk,9,6,"div",41),ve()()()),g&2){let u=Ve(2);be(),Ze("ngIf",u.poi.AddressInfo),be(4),Ut(" ",No(6,11,"ocm.details.equipment.sectionTitle")," "),be(3),Ze("ngIf",u.poi.NumberOfPoints!=null),be(),Ze("item",u.poi),be(6),Ze("ngIf",u.poi.StatusType!=null),be(),Ze("ngIf",u.poi.UsageType!=null),be(),Ze("ngIf",u.poi.UsageCost!=null),be(),Ze("ngIf",u.poi.GeneralComments!=null),be(),Ze("ngIf",u.poi.OperatorInfo),be(3),Ut(" ",No(23,13,"ocm.details.advancedDetails")," "),be(3),Ze("ngIf",u.poi.DataProvider)}}function ak(g,m){if(g&1&&yt(0,"img",55),g&2){let u=Ve().$implicit;Ze("src",wd(u.User==null?null:u.User.ProfileImageURL),xd)}}function sk(g,m){if(g&1&&(ge(0,"span"),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ht(u.User.Username)}}function lk(g,m){if(g&1&&(ge(0,"span"),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ht(u.Username)}}function ck(g,m){if(g&1&&(ge(0,"p",42),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ut(" ",u.CommentType==null?null:u.CommentType.Title," ")}}function uk(g,m){if(g&1&&(ge(0,"p")(1,"span",48),Le(2,"Rating:"),ve(),ge(3,"span",42),Le(4),ve()()),g&2){let u=Ve().$implicit;be(4),Ut("",u.Rating," out of 5")}}function hk(g,m){g&1&&(dn(0),yt(1,"ion-icon",56),mn())}function pk(g,m){g&1&&(dn(0),yt(1,"ion-icon",57),mn())}function dk(g,m){if(g&1&&(ge(0,"p"),Et(1,hk,2,0,"ng-container",0)(2,pk,2,0,"ng-container",0),Le(3),ve()),g&2){let u=Ve().$implicit;be(),Ze("ngIf",u.CheckinStatusType.IsPositive===!0),be(),Ze("ngIf",u.CheckinStatusType.IsPositive===!1),be(),Ut(" ",u.CheckinStatusType.Title," ")}}function mk(g,m){if(g&1&&(ge(0,"ion-card")(1,"ion-item")(2,"ion-avatar",23),Et(3,ak,1,2,"img",54),ve(),ge(4,"ion-label"),Et(5,sk,2,1,"span",0)(6,lk,2,1,"span",0),ve(),ge(7,"ion-label",24),Le(8),vr(9,"date"),ve()(),ge(10,"ion-card-content")(11,"p"),Le(12),ve(),Et(13,ck,2,1,"p",41)(14,uk,5,1,"p",0)(15,dk,4,3,"p",0),ve()()),g&2){let u=m.$implicit;be(3),Ze("ngIf",u.User&&u.User.ProfileImageURL),be(2),Ze("ngIf",u.User),be(),Ze("ngIf",!u.User),be(2),Ut(" ",No(9,8,u.DateCreated)," "),be(4),Ht(u.Comment),be(),Ze("ngIf",u.CommentTypeID!=10),be(),Ze("ngIf",u.Rating),be(),Ze("ngIf",u.CheckinStatusType)}}function fk(g,m){if(g&1&&(dn(0),Et(1,mk,16,10,"ion-card",53),mn()),g&2){let u=Ve(3);be(),Ze("ngForOf",u.poi.UserComments)}}function gk(g,m){g&1&&(dn(0),ge(1,"ion-card")(2,"ion-card-content")(3,"p"),Le(4),vr(5,"translate"),ve()()(),mn()),g&2&&(be(4),Ut(" ",No(5,1,"ocm.details.commentsAndRatings.addPrompt")," "))}function _k(g,m){if(g&1&&(ge(0,"div"),Et(1,fk,2,1,"ng-container",0)(2,gk,6,3,"ng-container",0),ve()),g&2){let u=Ve(2);be(),Ze("ngIf",u.poi._hasComments==!0),be(),Ze("ngIf",u.poi._hasComments==!1)}}function yk(g,m){if(g&1&&yt(0,"img",55),g&2){let u=Ve().$implicit;Ze("src",wd(u.User==null?null:u.User.ProfileImageURL),xd)}}function vk(g,m){if(g&1&&(ge(0,"span"),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ht(u.User.Username)}}function xk(g,m){if(g&1&&(ge(0,"span"),Le(1),ve()),g&2){let u=Ve().$implicit;be(),Ht(u.Username)}}function bk(g,m){if(g&1&&(ge(0,"ion-card"),yt(1,"img",55),ge(2,"ion-item")(3,"ion-avatar",23),Et(4,yk,1,2,"img",54),ve(),ge(5,"ion-label"),Et(6,vk,2,1,"span",0)(7,xk,2,1,"span",0),ve(),ge(8,"ion-label",24),Le(9),vr(10,"date"),ve()(),ge(11,"ion-card-content")(12,"p"),Le(13),ve()()()),g&2){let u=m.$implicit;be(),Ze("src",wd(u.ItemMediumURL),xd),be(3),Ze("ngIf",u.User&&u.User.ProfileImageURL),be(2),Ze("ngIf",u.User),be(),Ze("ngIf",!u.User),be(2),Ut(" ",No(10,7,u.DateCreated)," "),be(4),Ht(u.Comment)}}function wk(g,m){if(g&1&&(ge(0,"div"),Et(1,bk,14,9,"ion-card",53),ve()),g&2){let u=Ve(3);be(),Ze("ngForOf",u.poi.MediaItems)}}function Tk(g,m){g&1&&(dn(0),ge(1,"ion-card")(2,"ion-card-content")(3,"p"),Le(4),vr(5,"translate"),ve()()(),mn()),g&2&&(be(4),Ut(" ",No(5,1,"ocm.details.mediaItems.addPrompt")," "))}function Sk(g,m){if(g&1&&(ge(0,"div"),Et(1,wk,2,1,"div",0)(2,Tk,6,3,"ng-container",0),ve()),g&2){let u=Ve(2);be(),Ze("ngIf",u.poi._hasPhotos),be(),Ze("ngIf",u.poi._hasPhotos==!1)}}function Ik(g,m){if(g&1&&(ge(0,"p",58),Le(1),ve()),g&2){let u=Ve(2);be(),Ut(" ",u.json)}}function Pk(g,m){if(g&1){let u=oi();ge(0,"div")(1,"div",1)(2,"div",2)(3,"h2"),Le(4),ve(),ge(5,"div")(6,"small"),Le(7),ve()(),Et(8,EA,3,1,"div",0)(9,AA,3,1,"div",0)(10,kA,3,0,"div",0),ge(11,"ion-badge",3),Le(12),vr(13,"number"),ve()(),ge(14,"ion-fab",4)(15,"ion-fab-button",5),Dt("click",function(){ct(u);let _=Ve();return ut(_.close())}),yt(16,"ion-icon",6),ve()(),ge(17,"ion-fab",7)(18,"ion-fab-button",8),yt(19,"ion-icon",9),ve(),ge(20,"ion-fab-list",10)(21,"ion-fab-button",11),Dt("click",function(){ct(u);let _=Ve();return ut(_.addComment())}),yt(22,"ion-icon",12),ve(),ge(23,"ion-fab-button",13),Dt("click",function(){ct(u);let _=Ve();return ut(_.addMedia())}),yt(24,"ion-icon",14),ve(),ge(25,"ion-fab-button",15),Dt("click",function(){ct(u);let _=Ve();return ut(_.addFavourite())}),yt(26,"ion-icon",16),ve(),ge(27,"ion-fab-button",17),Dt("click",function(){ct(u);let _=Ve();return ut(_.edit())}),yt(28,"ion-icon",18),ve(),ge(29,"ion-fab-button",19),Dt("click",function(){ct(u);let _=Ve();return ut(_.refresh())}),yt(30,"ion-icon",20),ve()()()(),ge(31,"ion-refresher",21),Dt("ionRefresh",function(_){ct(u);let o=Ve();return ut(o.refresh(_))}),yt(32,"ion-refresher-content",22),ve(),ge(33,"ion-toolbar")(34,"ion-buttons",23),Et(35,LA,9,0,"ng-container",0),ve(),ge(36,"ion-buttons",24),Et(37,DA,5,0,"ng-container",0)(38,zA,5,0,"ng-container",0)(39,RA,5,0,"ng-container",0),ve()(),ge(40,"ion-segment",25),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.selectedTab,_)||(o.selectedTab=_),ut(_)}),ge(41,"ion-segment-button",26)(42,"ion-label"),Le(43," Details "),ve()(),ge(44,"ion-segment-button",27)(45,"ion-label"),Le(46),ve()(),ge(47,"ion-segment-button",28)(48,"ion-label"),Le(49),ve()()(),Et(50,ok,26,15,"div",0)(51,_k,3,2,"div",0)(52,Sk,3,2,"div",0)(53,Ik,2,1,"p",29),ve()}if(g&2){let u=Ve();be(),Zg("background-image",u.backdropImage?"url("+u.backdropImage+")":""),be(3),Ut(" ",u.poi.AddressInfo.Title," "),be(3),Ut("OCM-",u.poi.ID),be(),Ze("ngIf",u.connectionSummary),be(),Ze("ngIf",u.poi.OperatorInfo),be(),Ze("ngIf",u.poi.SubmissionStatusTypeID==1),be(2),Ht(Td(13,19,u.avgRating,"1.1-1")),be(23),Ze("ngIf",u.selectedTab=="location"),be(2),Ze("ngIf",u.selectedTab=="location"),be(),Ze("ngIf",u.selectedTab=="comments"),be(),Ze("ngIf",u.selectedTab=="media"),be(),Xt("ngModel",u.selectedTab),be(6),Ut("Comments (",u.poi.UserComments?u.poi.UserComments.length:0,")"),be(3),Ut(" Photos (",u.poi.MediaItems?u.poi.MediaItems.length:0,")"),be(),Ze("ngIf",u.selectedTab=="location"),be(),Ze("ngIf",u.selectedTab=="comments"),be(),Ze("ngIf",u.selectedTab=="media"),be(),Ze("ngIf",u.appManager.isDebugMode==!0)}}function Ck(g,m){g&1&&(ge(0,"div")(1,"h2"),Le(2,"POI Not Found"),ve(),ge(3,"p"),Le(4,"The POI details could not be loaded."),ve()())}var l3=(()=>{class g{appManager;nav;translate;logging;modalController;actionSheetController;poiManager;router;poi;selectedTab;json;hasNavBar=!1;backdropImage;avgRating;connectionSummary;constructor(u,x,_,o,C,B,$,Y){this.appManager=u,this.nav=x,this.translate=_,this.logging=o,this.modalController=C,this.actionSheetController=B,this.poiManager=$,this.router=Y}ngOnChanges(u){if(this.logging.log("In ngOnChanges of POI Details"),!(this.poi==null||this.poi.AddressInfo==null)){if(this.selectedTab="location",this.poi.MediaItems!=null&&this.poi.MediaItems.length>0){this.poi._hasPhotos=!0;for(let x of this.poi.MediaItems)x.ItemMediumURL=x.ItemThumbnailURL.replace(".thmb.",".medi.");this.backdropImage=this.poi.MediaItems[this.poi.MediaItems.length-1].ItemThumbnailURL.replace(".thmb.",".medi.")}else this.poi._hasPhotos=!1,this.backdropImage=null;if(this.poi.UserComments!=null&&this.poi.UserComments.length>0){this.poi._hasComments=!0;try{let x=this.poi.UserComments.filter(_=>_.Rating>0);if(x.length>0){let _=0;for(let o of x)_+=o.Rating;this.avgRating=_/x.length}else this.avgRating=null}catch{}}else this.poi._hasComments=!1;if(this.poi.Connections&&this.poi.Connections.length>0){let x="";for(let _ of this.poi.Connections)x.indexOf(_.ConnectionType.Title)==-1&&(x+=(x!=""?", ":"")+_.ConnectionType.Title);this.connectionSummary=x}}}ngOnInit(){this.logging.log("In ngInit of POI Details")}get staticMapURL(){return"https://maps.googleapis.com/maps/api/staticmap?key="+new by().googleMapsAPIKey+"&center="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude+"&zoom=13&scale=2&size="+this.staticMapSize+"&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:small%7Ccolor:0xff0000%7Clabel:%7C"+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude}get staticMapSize(){return this.appManager.clientWidth===0?"240x100":this.appManager.clientWidth>=800?"640x100":this.appManager.clientWidth>=400?"400x100":"240x100"}continueAddComment(){return st(this,null,function*(){let u=yield this.modalController.create({component:_T,componentProps:{id:this.poi.ID,poi:this.poi}});setTimeout(()=>{this.refresh()},1e3),yield u.present()})}addComment(){return st(this,null,function*(){if(this.appManager.isUserAuthenticated(!0))yield this.continueAddComment();else{let u=yield this.modalController.create({component:r_});u.onDidDismiss().then(()=>st(this,null,function*(){this.appManager.isUserAuthenticated(!0)&&(yield this.continueAddComment())})),yield u.present()}})}continueAddMedia(){return st(this,null,function*(){let u=yield this.modalController.create({component:gT,componentProps:{id:this.poi.ID,poi:this.poi}});u.onDidDismiss().then(()=>{setTimeout(()=>{this.refresh()},1e3)}),yield u.present()})}addMedia(){return st(this,null,function*(){if(this.appManager.isUserAuthenticated(!0))yield this.continueAddMedia();else{let u=yield this.modalController.create({component:r_});u.onDidDismiss().then(()=>st(this,null,function*(){this.appManager.isUserAuthenticated(!0)&&(yield this.continueAddMedia())})),yield u.present()}})}addFavourite(){return st(this,null,function*(){yield(yield this.actionSheetController.create({header:"Add Favourite",buttons:[{text:"Add to Journey",handler:()=>{this.modalController.create({component:hb,componentProps:{poi:this.poi}}).then(x=>x.present())}},{text:"Cancel",role:"cancel",handler:()=>{}}]})).present()})}launchNavigation(){if(this.appManager.isPlatform("ios")){let u="https://maps.apple.com/?ll="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude;this.appManager.launchWebPage(u)}else{let u="https://maps.google.com/?q="+this.poi.AddressInfo.Latitude+","+this.poi.AddressInfo.Longitude;this.appManager.launchWebPage(u)}}launchURL(u){this.appManager.launchWebPage(u)}continueEdit(){return st(this,null,function*(){let u=yield this.modalController.create({component:mT,componentProps:{id:this.poi.ID}});return u.onDidDismiss().then(x=>{this.refresh()}),yield u.present()})}edit(){return st(this,null,function*(){if(uo.isFeatureEnabled("EDIT_POI"))if(this.appManager.isUserAuthenticated(!0))yield this.continueEdit();else{let u=yield this.modalController.create({component:r_});u.onDidDismiss().then(()=>st(this,null,function*(){this.appManager.isUserAuthenticated(!0)&&(yield this.continueEdit())})),yield u.present()}else this.appManager.launchOCMWebPage("/poi/edit/"+this.poi.ID)})}refresh(u=null){this.poi&&this.poiManager.getPOIById(this.poi.ID,!0,!0).then(x=>{x&&(this.poi=x,this.ngOnChanges(null)),u&&u.target.complete()})}close(){this.modalController.dismiss()}static \u0275fac=function(x){return new(x||g)(Rt(Ps),Rt(qd),Rt(Vh),Rt(bn),Rt(Ss),Rt(rb),Rt(om),Rt(Gd))};static \u0275cmp=lr({type:g,selectors:[["poi-details"]],inputs:{poi:"poi"},standalone:!1,features:[$g],decls:2,vars:2,consts:[[4,"ngIf"],[1,"banner"],[1,"banner-content"],["color","primary","title","Average User Rating"],["vertical","top","horizontal","start","slot","fixed"],["size","small","color","medium",3,"click"],["name","close"],["vertical","top","horizontal","end","slot","fixed"],["size","small","color","success"],["name","add"],["side","bottom"],["title","Add a comment or charging check-in",3,"click"],["name","chatbubbles"],["title","Add a Photo",3,"click"],["name","camera"],["title","Add to Favourites",3,"click"],["name","star"],["title","Submit an Edit",3,"click"],["name","create"],["title","Refresh",3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["pullingIcon","caret-down","pullingText","Pull to refresh","refreshingSpinner","circles","refreshingText","Refreshing..."],["slot","start"],["slot","end"],[3,"ngModelChange","ngModel"],["value","location","selected",""],["value","comments"],["value","media"],["style","white-space: pre-wrap;",4,"ngIf"],["size","small","title","Add to Favourites",3,"click"],["name","star","slot","start"],["size","small","title","Submit an Edit",3,"click"],["name","create","slot","start"],["size","small","title","Navigate to this location",3,"click"],["name","navigate","slot","start"],["size","small","title","Add a comment or charging check-in",3,"click"],["name","chatbubbles","slot","start"],["size","small","title","Add a Photo",3,"click"],["name","camera","slot","start"],[3,"item"],["class","details",4,"ngIf"],[1,"details"],[1,"details-minor"],["name","call"],["name","mail"],["name","globe"],["target","_system",3,"href"],[1,"label"],[1,"ion-padding-left"],["name","link"],["href","javascript:void(0)",3,"click",4,"ngIf"],["href","javascript:void(0)",3,"click"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],[3,"src"],["name","checkmark-circle","color","success",2,"font-size","2em"],["name","close-circle","color","danger"],[2,"white-space","pre-wrap"]],template:function(x,_){x&1&&Et(0,Pk,54,22,"div",0)(1,Ck,5,0,"div",0),x&2&&(Ze("ngIf",_.poi!=null&&_.poi.AddressInfo!=null),be(),Ze("ngIf",_.poi==null||_.poi.AddressInfo==null))},dependencies:[Vo,Or,Uh,Wg,wr,Da,Hg,Xg,q1,W1,Xd,X1,K1,Y1,Kd,Tr,jr,qo,eb,tb,Jd,Qd,em,Ra,ws,Go,Zo,xy,Sd,N1,tm],styles:[".banner[_ngcontent-%COMP%]{background-color:#4f712f;color:#ffffffec;padding:1em 3em 1em 6em;text-shadow:#000 1px 1px 1px;min-height:180px;background-size:cover}.banner[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.banner[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{color:unset}.banner-content[_ngcontent-%COMP%]{padding-right:48px}p[_ngcontent-%COMP%]{display:block;padding:4px}"]})}return g})();var yT=(()=>{class g{http;journeyManager;constructor(u,x){this.http=u,this.journeyManager=x}getDirections(u,x){return new Promise((_,o)=>{new google.maps.DirectionsService().route({origin:u,destination:x,travelMode:google.maps.TravelMode.DRIVING},(B,$)=>{$===google.maps.DirectionsStatus.OK?_(B):o($)})})}analyseRoutes(u,x){let _=new Array;return u.routes.forEach(o=>{let C=new sg;C.Title=""+_.length+1,C.JourneyRouteLegs=new Array,C.TotalDistanceKM=0,C.TotalDurationMinutes=0,C.TotalEnergykWh=0,o.legs.forEach(B=>{let $=B.duration.value,Y=B.distance.value/1e3,ne=this.journeyManager.calculateEnergyConsumptionkWh(Y,0,null,x),q=new ag;q.DistanceKM=Y,q.DurationMinutes=$/60,q.EnergyConsumptionkWh=ne,C.JourneyRouteLegs.push(q),C.TotalDistanceKM+=q.DistanceKM,C.TotalDurationMinutes+=q.DurationMinutes,C.TotalEnergykWh=q.EnergyConsumptionkWh}),_.push(C)}),_}static \u0275fac=function(x){return new(x||g)(ii($o),ii(Hh))};static \u0275prov=An({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})();function Ek(g,m){if(g&1){let u=oi();ge(0,"ion-item"),yt(1,"ion-icon",12),ge(2,"ion-searchbar",13),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.routeStart,_)||(o.routeStart=_),ut(_)}),Dt("ionInput",function(_){ct(u),Ve();let o=bd(18);return ut(o.getPlacesAutoComplete(_,"routeStart"))})("ionCancel",function(_){ct(u);let o=Ve();return ut(o.onPlaceSearchCancel(_))}),ve()()}if(g&2){let u=Ve();be(2),Xt("ngModel",u.routeStart),Ze("debounce",500)}}function Ak(g,m){if(g&1){let u=oi();ge(0,"ion-item",14),Dt("click",function(){ct(u);let _=Ve();return ut(_.clearRouteStart())}),yt(1,"ion-icon",12),ge(2,"h2"),Le(3),ve()()}if(g&2){Ve();let u=bd(18);be(3),Ht(u.selectedPlace==null?null:u.selectedPlace.name)}}function kk(g,m){if(g&1){let u=oi();ge(0,"ion-item"),yt(1,"ion-icon",15),ge(2,"ion-searchbar",16),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.routeDestination,_)||(o.routeDestination=_),ut(_)}),Dt("ionInput",function(_){ct(u),Ve();let o=bd(20);return ut(o.getPlacesAutoComplete(_,"routeDestination"))})("ionCancel",function(_){ct(u);let o=Ve();return ut(o.onPlaceSearchCancel(_))}),ve()()}if(g&2){let u=Ve();be(2),Xt("ngModel",u.routeDestination),Ze("debounce",500)}}function Lk(g,m){if(g&1){let u=oi();ge(0,"ion-item",14),Dt("click",function(){ct(u);let _=Ve();return ut(_.clearRouteDestination())}),yt(1,"ion-icon",15),ge(2,"h2"),Le(3),ve()()}if(g&2){Ve();let u=bd(20);be(3),Ht(u.selectedPlace==null?null:u.selectedPlace.name)}}function Dk(g,m){if(g&1){let u=oi();ge(0,"ion-button",14),Dt("click",function(){ct(u);let _=Ve();return ut(_.clearRoute())}),yt(1,"ion-icon",17),Le(2," Clear Route "),ve()}}function zk(g,m){if(g&1){let u=oi();ge(0,"ion-button",14),Dt("click",function(){ct(u);let _=Ve();return ut(_.showSettings())}),Le(1," Show Settings "),yt(2,"ion-icon",18),ve()}}function Rk(g,m){if(g&1){let u=oi();ge(0,"ion-button",14),Dt("click",function(){ct(u);let _=Ve();return ut(_.hideSettings())}),Le(1," Hide Settings "),yt(2,"ion-icon",18),ve()}}function Fk(g,m){g&1&&(ge(0,"p",19),yt(1,"ion-spinner",19),Le(2," Calculating Route.. "),ve())}function Bk(g,m){if(g&1&&(ge(0,"ion-list")(1,"ion-list-header"),Le(2),vr(3,"number"),vr(4,"number"),ve()()),g&2){let u=Ve();be(2),O1(" Total Distance ",Td(3,3,u.selectedJourneyRoute.TotalDistanceKM,"1.0-2")," km, ",u.formatDuration(u.selectedJourneyRoute.TotalDurationMinutes),", ",Td(4,6,u.selectedJourneyRoute.TotalEnergykWh,"1.0-2")," kWh ")}}function Ok(g,m){if(g&1){let u=oi();ge(0,"div")(1,"ion-list")(2,"ion-list-header"),yt(3,"ion-icon",20),Le(4," Route Settings "),ve(),ge(5,"ion-item")(6,"ion-label",21),Le(7),ve(),ge(8,"ion-range",22),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.routeSearchDistance,_)||(o.routeSearchDistance=_),ut(_)}),yt(9,"ion-icon",23)(10,"ion-icon",24),ve()(),ge(11,"ion-item")(12,"ion-label",21),Le(13,"Energy Efficiency (kWh Per km)"),ve(),ge(14,"ion-input",25),Kt("ngModelChange",function(_){ct(u);let o=Ve();return Zt(o.kWhPerKM,_)||(o.kWhPerKM=_),ut(_)}),ve()()()()}if(g&2){let u=Ve();be(7),Ut("Search Distance (",u.routeSearchDistance,")"),be(),Xt("ngModel",u.routeSearchDistance),be(6),Xt("ngModel",u.kWhPerKM)}}var T3=(()=>{class g{mapping;logging;directions;journeyManager;changeDetector;numberPipe;routeSearchDistance=5;journeyRoutes;selectedJourneyRoute;routePolyline;kWhPerKM;routeStartPlace;routeDestinationPlace;routeCalcInProgress=!1;advancedSettingsMode=!1;routeStart="";routeDestination="";constructor(u,x,_,o,C,B){this.mapping=u,this.logging=x,this.directions=_,this.journeyManager=o,this.changeDetector=C,this.numberPipe=B,this.kWhPerKM=.212}get isRouteSet(){return this.routeStartPlace!=null&&this.routeDestinationPlace!=null}showSettings(){this.advancedSettingsMode=!0}hideSettings(){this.advancedSettingsMode=!1}routeStartSelected(u){this.routeStartPlace=u,this.calculateRoute(),this.changeDetector.detectChanges()}routeDestinationSelected(u){this.routeDestinationPlace=u,this.calculateRoute(),this.changeDetector.detectChanges()}clearRouteStart(){this.routeStartPlace=null,this.changeDetector.detectChanges()}clearRouteDestination(){this.routeDestinationPlace=null,this.changeDetector.detectChanges()}clearRoute(){this.routeStartPlace=null,this.routeDestinationPlace=null,this.journeyManager.setRoutePolyline(null),this.mapping.clearPolyline()}formatDuration(u){if(u<=60)return this.numberPipe.transform(u,"1.0-2")+" mins";{let x=Math.round(u/60),_=Math.floor(u-x*60);return x+" hours "+(_>0?_+" mins":"")}}calculateRoute(){this.routeStartPlace!=null&&this.routeDestinationPlace!=null&&(this.logging.log("Fetching route directions.."),this.routeCalcInProgress=!0,this.directions.getDirections(this.routeStartPlace.Location.latitude+","+this.routeStartPlace.Location.longitude,this.routeDestinationPlace.Location.latitude+","+this.routeDestinationPlace.Location.longitude).then(u=>{if(u.routes!=null&&u.routes.length>0){this.logging.log("Got route directions, analysing.."),this.routePolyline=u.routes[0].overview_polyline;let x=u.routes[0].bounds.getSouthWest(),_=u.routes[0].bounds.getNorthEast(),o=new Un(_.lat(),_.lng()),C=new Un(x.lat(),x.lng()),B=new lg(o,C);this.journeyRoutes=this.directions.analyseRoutes(u,this.kWhPerKM),this.journeyRoutes.length>0&&(this.selectedJourneyRoute=this.journeyRoutes[0]),this.journeyManager.setRoutePolyline(this.routePolyline),this.mapping.renderPolyline(this.routePolyline),this.mapping.moveToMapBounds(B)}else this.logging.log("No route returned..");this.routeCalcInProgress=!1}))}static \u0275fac=function(x){return new(x||g)(Rt(wm),Rt(bn),Rt(yT),Rt(Hh),Rt(jh),Rt(Sd))};static \u0275cmp=lr({type:g,selectors:[["route-planner"]],standalone:!1,decls:24,vars:10,consts:[["placeSearchRouteStart",""],["placeSearchRouteDestination",""],[1,"route"],[1,"route-places"],["name","map","slot","start"],[4,"ngIf"],[3,"click",4,"ngIf"],["primary",""],["slot","secondary"],["slot","primary"],[3,"placeChanged"],["class","ion-padding",4,"ngIf"],["name","ionic","item-left",""],["placeholder","Starting Point",3,"ngModelChange","ionInput","ionCancel","ngModel","debounce"],[3,"click"],["name","pin","item-left",""],["placeholder","Destination",3,"ngModelChange","ionInput","ionCancel","ngModel","debounce"],["name","close","slot","start"],["name","cog","slot","end"],[1,"ion-padding"],["name","cog"],["position","stacked"],["min","1","max","200","step","5","snaps","true","pin","true","light","",3,"ngModelChange","ngModel"],["slot","start","small","","name","map"],["slot","end","large","","name","map"],["type","number","min","0.1","max","1",3,"ngModelChange","ngModel"]],template:function(x,_){if(x&1){let o=oi();ge(0,"div",2)(1,"div",3)(2,"ion-list")(3,"ion-list-header"),yt(4,"ion-icon",4),ge(5,"ion-label"),Le(6,"Plan Your Journey"),ve()(),Et(7,Ek,3,2,"ion-item",5)(8,Ak,4,1,"ion-item",6)(9,kk,3,2,"ion-item",5)(10,Lk,4,1,"ion-item",6),ve(),ge(11,"ion-toolbar",7)(12,"ion-buttons",8),Et(13,Dk,3,0,"ion-button",6),ve(),ge(14,"ion-buttons",9),Et(15,zk,3,0,"ion-button",6)(16,Rk,3,0,"ion-button",6),ve()()(),ge(17,"place-search",10,0),Dt("placeChanged",function(B){return ct(o),ut(_.routeStartSelected(B))}),ve(),ge(19,"place-search",10,1),Dt("placeChanged",function(B){return ct(o),ut(_.routeDestinationSelected(B))}),ve(),Et(21,Fk,3,0,"p",11)(22,Bk,5,9,"ion-list",5)(23,Ok,15,3,"div",5),ve()}x&2&&(be(7),Ze("ngIf",_.routeStartPlace==null),be(),Ze("ngIf",_.routeStartPlace!=null),be(),Ze("ngIf",_.routeDestinationPlace==null),be(),Ze("ngIf",_.routeDestinationPlace!=null),be(3),Ze("ngIf",_.isRouteSet),be(2),Ze("ngIf",!_.advancedSettingsMode),be(),Ze("ngIf",_.advancedSettingsMode),be(5),Ze("ngIf",_.routeCalcInProgress),be(),Ze("ngIf",_.selectedJourneyRoute!=null),be(),Ze("ngIf",_.advancedSettingsMode))},dependencies:[Or,wr,Da,Tr,Ts,jr,qo,za,J1,Q1,Kg,Yg,Ra,Hd,La,Jg,nb,Go,Zo,fT,Sd],encapsulation:2})}return g})();var C3=(()=>{class g extends tm{constructor(u,x){super(u,x)}transform(u,...x){let _=super.transform(u,...x);return _==u?x!=null&&x[0].default?x[0].default:x[0].Title?x[0].Title:_:_}static \u0275fac=function(x){return new(x||g)(Rt(Vh,16),Rt(jh,16))};static \u0275pipe=L1({name:"nullableTranslate",type:g,pure:!0,standalone:!1});static \u0275prov=An({token:g,factory:g.\u0275fac})}return g})();var Y3=(()=>{class g{static \u0275fac=function(x){return new(x||g)};static \u0275mod=Gg({type:g});static \u0275inj=Vg({providers:[Sd],imports:[V1,ab,Z1,sb]})}return g})();export{ar as a,bn as b,Gh as c,Un as d,Nl as e,qh as f,rm as g,Ba as h,t_ as i,om as j,Hh as k,YL as l,Ps as m,uo as n,fT as o,by as p,r_ as q,wm as r,hT as s,dT as t,mT as u,l3 as v,T3 as w,C3 as x,Y3 as y};
